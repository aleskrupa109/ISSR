<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISSŘ - Příprava řízení</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        /* ===========================================
           ISSŘ HLAVIČKA
           =========================================== */
        .issr-header {
            background-color: #004289;
            height: 56px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
        }

        .issr-header__logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: white;
        }

        .issr-header__logo-img {
            height: 40px;
            width: auto;
        }

        .issr-header__title {
            font-size: 12px;
            font-weight: 400;
            color: white;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .issr-header__search {
            flex: 1;
            max-width: 500px;
            margin: 0 40px;
        }

        .issr-header__search-input {
            width: 100%;
            height: 32px;
            padding: 0 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        }

        .issr-header__search-input::placeholder {
            color: #adb5bd;
        }

        .issr-header__actions {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
        }

        .issr-header__notification {
            position: relative;
            color: white;
            cursor: pointer;
        }

        .issr-header__notification-icon {
            width: 20px;
            height: 20px;
        }

        .issr-header__notification-badge {
            position: absolute;
            top: -6px;
            right: -8px;
            background-color: #0066cc;
            color: white;
            font-size: 10px;
            font-weight: 600;
            min-width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        .issr-header__user {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .issr-header__user-icon {
            width: 16px;
            height: 16px;
        }

        @media (max-width: 992px) {
            .issr-header__search {
                max-width: 300px;
                margin: 0 20px;
            }
            
            .issr-header__title {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .issr-header {
                padding: 0 16px;
            }
            
            .issr-header__search {
                display: none;
            }
        }

        /* ===========================================
           STYLY STRÁNKY
           =========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif !important;
            font-size: 13px !important;
            color: #333 !important;
            background: #f5f5f5 !important;
            line-height: 1.5 !important;
            text-align: left !important;
        }

        * {
            text-align: left !important;
        }

        .btn, .btn-primary, .btn-secondary, .btn-back, .control-card-action {
            text-align: center !important;
        }

        /* Main layout */
        .main-content {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 56px);
        }

        /* Case header - sticky */
        .case-header {
            background: #fff;
            position: sticky;
            top: 56px;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Workflow stepper */
        .workflow-bar {
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            padding: 10px 32px !important;
            background: #f8f9fa !important;
            border-bottom: 1px solid #e0e0e0 !important;
            flex-wrap: nowrap !important;
        }

        .workflow-stepper {
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            flex-wrap: nowrap !important;
        }

        .workflow-step {
            display: inline-flex !important;
            align-items: center !important;
            gap: 6px !important;
            padding: 6px 12px !important;
            border-radius: 16px !important;
            font-size: 12px !important;
            font-weight: 400 !important;
            color: #5f6368 !important;
            background: #fff !important;
            border: 1px solid #dadce0 !important;
            cursor: default !important;
            transition: all 0.15s !important;
            white-space: nowrap !important;
        }

        .workflow-step .step-number {
            width: 18px !important;
            height: 18px !important;
            min-width: 18px !important;
            border-radius: 50% !important;
            background: #f1f3f4 !important;
            color: #5f6368 !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 10px !important;
            font-weight: 500 !important;
        }

        .workflow-step.active {
            background: #004289 !important;
            border-color: #004289 !important;
            color: #fff !important;
        }

        .workflow-step.active .step-number {
            background: rgba(255,255,255,0.25) !important;
            color: #fff !important;
        }

        .workflow-step.completed {
            background: #e6f4ea !important;
            border-color: #ceead6 !important;
            color: #137333 !important;
        }

        .workflow-step.completed .step-number {
            background: #137333 !important;
            color: #fff !important;
        }

        .workflow-step-connector {
            width: 20px !important;
            height: 2px !important;
            min-width: 20px !important;
            background: #dadce0 !important;
            flex-shrink: 0 !important;
        }

        .workflow-step-connector.completed {
            background: #137333 !important;
        }

        .case-header-main {
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            border-bottom: 1px solid #f0f0f0;
        }

        .case-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* Akční tlačítka v hlavičce */
        .case-header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .header-action-btn:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }
        
        .header-action-btn .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .header-action-btn.has-issues {
            border-color: #f9ab00;
            background: #fef7e0;
        }
        
        .header-action-btn.has-issues:hover {
            background: #feefc3;
            border-color: #f29900;
        }
        
        .header-action-btn.has-issues .material-icons-outlined {
            color: #b06000;
        }
        
        .header-action-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: #ea4335;
            color: #fff;
            border-radius: 9px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .header-action-badge.warning {
            background: #f9ab00;
            color: #202124;
        }
        
        /* Dropdown menu pro Akce řízení */
        .action-dropdown {
            position: relative;
        }
        
        .action-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            min-width: 220px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
        }
        
        .action-dropdown-menu.open {
            display: block;
        }
        
        .action-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            font-size: 13px;
            color: #202124;
            cursor: pointer;
            transition: background 0.1s;
        }
        
        .action-dropdown-item:first-child {
            border-radius: 8px 8px 0 0;
        }
        
        .action-dropdown-item:last-child {
            border-radius: 0 0 8px 8px;
        }
        
        .action-dropdown-item:hover {
            background: #f1f3f4;
        }
        
        .action-dropdown-item .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .action-dropdown-item.danger {
            color: #c5221f;
        }
        
        .action-dropdown-item.danger .material-icons-outlined {
            color: #c5221f;
        }
        
        .action-dropdown-divider {
            height: 1px;
            background: #e8eaed;
            margin: 4px 0;
        }
        
        /* Slideout panel */
        .slideout-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            height: 100vh;
            background: #fff;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
        }
        
        .slideout-panel.open {
            right: 0;
        }
        
        .slideout-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .slideout-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        .slideout-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e8eaed;
            background: #f8f9fa;
        }
        
        .slideout-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 500;
            color: #202124;
        }
        
        .slideout-title .material-icons-outlined {
            font-size: 22px;
            color: #5f6368;
        }
        
        .slideout-close {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
            transition: background 0.15s;
        }
        
        .slideout-close:hover {
            background: #e8eaed;
        }
        
        .slideout-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .slideout-footer {
            padding: 16px 20px;
            border-top: 1px solid #e8eaed;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Sekce v slideout panelu nedostatků */
        .issues-group {
            margin-bottom: 24px;
        }
        
        .issues-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f1f3f4;
            border-radius: 6px;
            margin-bottom: 12px;
        }
        
        .issues-group-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }
        
        .issues-group-title .material-icons-outlined {
            font-size: 18px;
        }
        
        .issues-group-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .issues-group-badge.warning {
            background: #fef7e0;
            color: #b06000;
        }
        
        .issues-group-badge.error {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .issues-group-badge.info {
            background: #e8f4fd;
            color: #004289;
        }
        
        .global-issue-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #e8eaed;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .global-issue-item.resolved {
            background: #e6f4ea;
            border-color: #ceead6;
        }
        
        .global-issue-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .global-issue-icon.warning {
            background: #fef7e0;
            color: #b06000;
        }
        
        .global-issue-icon.error {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .global-issue-icon.resolved {
            background: #ceead6;
            color: #137333;
        }
        
        .global-issue-icon .material-icons-outlined {
            font-size: 14px;
        }
        
        .global-issue-content {
            flex: 1;
        }
        
        .global-issue-text {
            font-size: 13px;
            color: #202124;
            margin-bottom: 4px;
        }
        
        .global-issue-meta {
            font-size: 11px;
            color: #5f6368;
        }
        
        .global-issue-actions {
            display: flex;
            gap: 4px;
        }
        
        .global-issue-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
            transition: all 0.15s;
        }
        
        .global-issue-btn:hover {
            background: #f1f3f4;
        }
        
        .global-issue-btn.resolve:hover {
            background: #e6f4ea;
            border-color: #137333;
            color: #137333;
        }
        
        .global-issue-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Sekce v slideout panelu údaje řízení */
        .data-section {
            margin-bottom: 24px;
        }
        
        .data-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .data-section-title .material-icons-outlined {
            font-size: 18px;
        }
        
        .data-row {
            display: flex;
            align-items: flex-start;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .data-label {
            width: 140px;
            flex-shrink: 0;
            font-size: 12px;
            color: #5f6368;
            padding-top: 2px;
        }
        
        .data-value {
            flex: 1;
            font-size: 13px;
            color: #202124;
        }
        
        .data-value.editable {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .data-edit-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
            opacity: 0;
            transition: all 0.15s;
        }
        
        .data-row:hover .data-edit-btn {
            opacity: 1;
        }
        
        .data-edit-btn:hover {
            background: #e8eaed;
            color: #202124;
        }
        
        .data-edit-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        .data-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .data-list-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .data-list-item .material-icons-outlined {
            font-size: 16px;
            color: #5f6368;
        }

        .btn-back {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #dadce0;
            border-radius: 8px;
            background: #fff;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
        }

        .btn-back:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .case-info {
            flex: 1;
        }

        .case-number {
            font-size: 12px !important;
            color: #5f6368 !important;
            font-family: 'Roboto Mono', monospace !important;
            margin-bottom: 2px !important;
        }

        .case-title {
            font-size: 18px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .case-meta {
            display: flex !important;
            align-items: center !important;
            gap: 16px !important;
            margin-top: 4px !important;
        }

        .case-meta-item {
            display: inline-flex !important;
            align-items: center !important;
            gap: 4px !important;
            font-size: 12px !important;
            color: #5f6368 !important;
        }

        .case-meta-item .material-icons-outlined {
            font-size: 16px;
        }

        .case-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .case-badge.draft {
            background: #fef7e0;
            color: #b06000;
        }

        .case-badge.active {
            background: #e6f4ea;
            color: #137333;
        }

        .case-badge.fast {
            background: #e8f1fa;
            color: #004289;
        }

        /* Document access bar */
        .document-access-bar {
            background: #f8f9fa !important;
            border-top: 1px solid #e0e0e0 !important;
            padding: 10px 32px !important;
            display: flex !important;
            align-items: center !important;
            gap: 16px !important;
        }

        .document-access-label {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-weight: 500 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
        }

        .document-access-buttons {
            display: flex !important;
            gap: 8px !important;
            flex-wrap: nowrap !important;
            margin-left: 24px !important;
        }

        .doc-access-btn {
            display: inline-flex !important;
            align-items: center !important;
            gap: 6px !important;
            padding: 8px 14px !important;
            background: #fff !important;
            border: 1px solid #dadce0 !important;
            border-radius: 6px !important;
            font-size: 13px !important;
            font-weight: 400 !important;
            color: #202124 !important;
            cursor: pointer !important;
            transition: all 0.15s !important;
            text-decoration: none !important;
            white-space: nowrap !important;
            height: auto !important;
            min-height: 0 !important;
            line-height: 1.4 !important;
        }

        .doc-access-btn:hover {
            background: #e8f4fd !important;
            border-color: #004289 !important;
            color: #004289 !important;
        }

        .doc-access-btn .material-icons-outlined {
            font-size: 18px !important;
            color: #5f6368 !important;
        }

        .doc-access-btn:hover .material-icons-outlined {
            color: #004289 !important;
        }

        .doc-access-btn .badge {
            background: #004289 !important;
            color: #fff !important;
            padding: 2px 8px !important;
            border-radius: 10px !important;
            font-size: 11px !important;
            font-weight: 500 !important;
            margin-left: 2px !important;
        }

        /* Page content */
        .page-content {
            flex: 1;
            padding: 24px 32px;
        }

        /* Section header */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-title {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .section-title .material-icons-outlined {
            font-size: 24px !important;
            color: #004289 !important;
        }
        
        .section-customize-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            padding: 0;
            margin-left: 4px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .section-customize-btn:hover {
            background: #f1f3f4;
            border-color: #dadce0;
            color: #1a73e8;
        }
        
        .section-customize-btn .material-icons-outlined {
            font-size: 18px !important;
            color: inherit !important;
        }

        .section-progress {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            font-size: 13px !important;
            color: #5f6368 !important;
        }

        .progress-bar {
            width: 120px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #34a853;
            border-radius: 3px;
            transition: width 0.3s;
        }

        /* Control cards grid */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .control-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.15s;
        }

        .control-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .control-card.disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        .control-card-header {
            padding: 16px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }

        .control-card-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .control-card-icon .material-icons-outlined {
            font-size: 24px;
        }

        /* Status colors */
        .status-waiting .control-card-icon {
            background: #f5f5f5;
            color: #9aa0a6;
        }

        .status-ready .control-card-icon {
            background: #e8f1fa;
            color: #004289;
        }

        .status-in-progress .control-card-icon {
            background: #fef7e0;
            color: #b06000;
        }

        .status-done .control-card-icon {
            background: #e6f4ea;
            color: #137333;
        }

        .status-problem .control-card-icon {
            background: #fce8e6;
            color: #c5221f;
        }

        .control-card-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .status-waiting .control-card-status {
            background: #f5f5f5;
            color: #5f6368;
        }

        .status-ready .control-card-status {
            background: #e8f1fa;
            color: #004289;
        }

        .status-in-progress .control-card-status {
            background: #fef7e0;
            color: #b06000;
        }

        .status-done .control-card-status {
            background: #e6f4ea;
            color: #137333;
        }

        .status-problem .control-card-status {
            background: #fce8e6;
            color: #c5221f;
        }

        .control-card-body {
            padding: 0 16px 16px !important;
        }

        .control-card-title {
            font-size: 15px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .control-card-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            line-height: 1.4 !important;
            margin-bottom: 12px !important;
            font-style: normal !important;
        }

        .control-card-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            border: none;
        }

        .status-waiting .control-card-action {
            background: #f5f5f5;
            color: #9aa0a6;
            cursor: not-allowed;
        }

        .status-ready .control-card-action {
            background: #004289;
            color: #fff;
        }

        .status-ready .control-card-action:hover {
            background: #1b4d7a;
        }

        .status-in-progress .control-card-action {
            background: #fef7e0;
            color: #b06000;
            border: 1px solid #f5e6b3;
        }

        .status-done .control-card-action {
            background: #e6f4ea;
            color: #137333;
            border: 1px solid #ceead6;
        }

        .status-problem .control-card-action {
            background: #fce8e6;
            color: #c5221f;
            border: 1px solid #f5c6c3;
        }

        .control-card-action .material-icons-outlined {
            font-size: 18px;
        }

        /* Summary card */
        .summary-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
        }

        .summary-content {
            flex: 1;
        }

        .summary-title {
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .summary-desc {
            font-size: 13px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .summary-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            border: 1px solid;
            white-space: nowrap;
        }

        .btn-primary {
            background: #004289;
            color: #fff;
            border-color: #004289;
        }

        .btn-primary:hover {
            background: #1b4d7a;
            border-color: #1b4d7a;
        }

        .btn-primary:disabled {
            background: #dadce0;
            border-color: #dadce0;
            color: #9aa0a6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #fff;
            color: #5f6368;
            border-color: #dadce0;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
            border-color: #5f6368;
        }

        .btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Popis stavby sekce */
        .popis-preview {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e8eaed;
            border-radius: 6px;
        }
        
        .popis-preview-text {
            flex: 1;
            font-size: 13px;
            color: #3c4043;
            line-height: 1.5;
            max-height: 60px;
            overflow: hidden;
            position: relative;
        }
        
        .popis-preview-text::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 24px;
            background: linear-gradient(transparent, #f8f9fa);
        }
        
        .popis-edit-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #1a73e8;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.15s;
        }
        
        .popis-edit-btn:hover {
            background: #e8f0fe;
            border-color: #1a73e8;
        }
        
        .popis-edit-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        .popis-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            line-height: 1.6;
            color: #202124;
            resize: vertical;
            min-height: 150px;
        }
        
        .popis-textarea:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .popis-ai-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .popis-ai-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .popis-ai-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .popis-ai-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        .popis-ai-btn .spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .popis-stavby-collapsed:hover {
            background: #f8f9fa;
            border-radius: 4px;
            margin: -4px;
            padding: 4px;
        }
        
        .popis-stavby-collapsed:hover .popis-expand-btn {
            background: #e8f0fe;
            border-color: #1a73e8;
        }
        
        .popis-expand-btn:hover {
            background: #e8f0fe !important;
            border-color: #1a73e8 !important;
        }

        /* Info panel */
        .info-panel {
            background: #e8f1fa;
            border: 1px solid #c5d9f0;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .info-panel .material-icons-outlined {
            font-size: 20px;
            color: #004289;
            flex-shrink: 0;
        }

        .info-panel-content {
            flex: 1;
        }

        .info-panel-title {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #1a4d7c !important;
            margin-bottom: 2px !important;
            font-style: normal !important;
        }

        .info-panel-text {
            font-size: 13px !important;
            color: #1a4d7c !important;
            font-style: normal !important;
        }

        .info-panel.warning {
            background: #fef7e0 !important;
            border-color: #f5e6b3 !important;
        }

        .info-panel.warning .material-icons-outlined {
            color: #b06000 !important;
        }

        .info-panel.warning .info-panel-title {
            color: #7a4200 !important;
        }

        .info-panel.warning .info-panel-text {
            color: #7a4200 !important;
        }

        .info-panel.error {
            background: #fce8e6 !important;
            border-color: #f5c6c3 !important;
        }

        .info-panel.error .material-icons-outlined {
            color: #c5221f !important;
        }

        .info-panel.error .info-panel-title {
            color: #a50e0e !important;
        }

        .info-panel.error .info-panel-text {
            color: #a50e0e !important;
        }

        .info-panel.schedule {
            background: #e8f1fa !important;
            border-color: #c2d9f2 !important;
        }

        .info-panel.schedule .material-icons-outlined {
            color: #004289 !important;
        }

        .info-panel.schedule .info-panel-title {
            color: #003366 !important;
        }

        .info-panel.schedule .info-panel-text {
            color: #003366 !important;
        }

        /* Phase tabs */
        .phase-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            background: #f1f3f4;
            padding: 4px;
            border-radius: 10px;
        }

        .phase-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #5f6368 !important;
            cursor: pointer;
            transition: all 0.2s;
            font-style: normal !important;
        }

        .phase-tab:hover {
            background: #e8eaed;
        }

        .phase-tab.active {
            background: #fff;
            color: #202124 !important;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .phase-tab .material-icons-outlined {
            font-size: 20px;
        }

        .phase-tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: #e8eaed;
            border-radius: 10px;
            font-size: 11px !important;
            font-weight: 600 !important;
        }

        .phase-tab.active .phase-tab-badge {
            background: #e8f0fe;
            color: #1a73e8;
        }

        .phase-tab-badge.done {
            background: #e6f4ea !important;
            color: #137333 !important;
        }

        .phase-content {
            display: none;
        }

        .phase-content.active {
            display: block;
        }

        /* Pozemky overlay styles */
        .parcels-readonly-section {
            margin-bottom: 24px;
        }

        .parcels-readonly-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .parcels-readonly-title .material-icons-outlined {
            font-size: 18px;
            color: #1a73e8;
        }

        .parcels-readonly-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: #e8f0fe;
            color: #1a73e8;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .parcel-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .parcel-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: #e8f0fe;
            border: 1px solid #c2d7f2;
            border-radius: 8px;
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .parcel-chip-icon {
            width: 24px;
            height: 24px;
            background: #1a73e8;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .parcel-chip-icon .material-icons-outlined {
            font-size: 16px;
            color: #fff;
        }

        .parcel-chip-content {
            display: flex;
            flex-direction: column;
        }

        .parcel-chip-number {
            font-weight: 500 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-size: 13px !important;
        }

        .parcel-chip-katastr {
            font-size: 11px !important;
            color: #5f6368 !important;
        }

        .parcel-chip-area {
            color: #5f6368 !important;
            font-size: 12px !important;
            margin-left: auto;
            padding-left: 12px;
        }

        /* Sousední pozemky - interaktivní */
        .parcels-interactive-section {
            margin-top: 0;
        }

        .parcels-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .parcels-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .parcels-section-title .material-icons-outlined {
            font-size: 18px;
            color: #f57c00;
        }

        .parcels-section-count {
            margin-left: auto;
            padding: 2px 8px;
            background: #fff3e0;
            color: #e65100;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .parcels-search-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .parcels-search-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px !important;
            font-style: normal !important;
        }

        .parcels-search-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .btn-search {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: #1a73e8;
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-search:hover {
            background: #1557b0;
        }

        .btn-map {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: #fff;
            color: #5f6368 !important;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-map:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }

        .btn-map .material-icons-outlined {
            font-size: 18px;
        }

        .sousedni-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 280px;
            overflow-y: auto;
        }

        .sousedni-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
        }

        .sousedni-item .parcel-chip-icon {
            background: #f57c00;
        }

        .sousedni-item-content {
            flex: 1;
        }

        .sousedni-item-number {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-style: normal !important;
        }

        .sousedni-item-katastr {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .sousedni-item-owner {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px;
            font-style: normal !important;
        }

        .sousedni-item-remove {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sousedni-item-remove:hover {
            background: #ffecb3;
            color: #e65100;
        }

        .sousedni-empty {
            padding: 32px 24px;
            text-align: center;
            background: #fafafa;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
        }

        .sousedni-empty .material-icons-outlined {
            font-size: 40px;
            color: #bdbdbd;
            margin-bottom: 12px;
        }

        .sousedni-empty-text {
            font-size: 14px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .sousedni-empty-hint {
            font-size: 12px !important;
            color: #9aa0a6 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        /* Auto-detect button */
        .btn-autodetect {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
            margin-bottom: 16px;
        }

        .btn-autodetect:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-autodetect .material-icons-outlined {
            font-size: 18px;
        }
        .status-warning .control-card-icon {
            background: #fef7e0 !important;
            color: #b06000 !important;
        }

        .status-warning .control-card-status {
            background: #fef7e0 !important;
            color: #b06000 !important;
        }

        .status-error .control-card-icon {
            background: #fce8e6 !important;
            color: #c5221f !important;
        }

        .status-error .control-card-status {
            background: #fce8e6 !important;
            color: #c5221f !important;
        }

        /* Výběr příslušného SÚ */
        .su-selection-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
            display: none;
        }

        .su-selection-section.visible {
            display: block;
        }

        .su-selection-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .su-selection-title .material-icons-outlined {
            font-size: 18px;
            color: #f57c00;
        }

        .su-selection-desc {
            font-size: 12px !important;
            color: #795548 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .su-select-wrapper {
            position: relative;
        }

        .su-select {
            width: 100%;
            padding: 12px 40px 12px 14px;
            font-size: 14px !important;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            color: #202124 !important;
            cursor: pointer;
            appearance: none;
            font-style: normal !important;
            font-family: 'Roboto', sans-serif !important;
        }

        .su-select:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .su-select-wrapper {
            position: relative;
        }

        /* Searchable dropdown */
        .su-search-select {
            position: relative;
        }
        
        .su-search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .su-search-icon {
            position: absolute;
            left: 12px;
            color: #5f6368;
            font-size: 20px;
            pointer-events: none;
        }
        
        .su-search-input {
            width: 100%;
            padding: 12px 40px 12px 42px;
            font-size: 14px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            color: #202124;
            font-family: 'Roboto', sans-serif;
            transition: all 0.15s;
        }
        
        .su-search-input:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }
        
        .su-search-input::placeholder {
            color: #9aa0a6;
        }
        
        .su-search-input.selected {
            background: #fff8e1;
            border-color: #f57c00;
        }
        
        .su-search-clear {
            position: absolute;
            right: 8px;
            width: 28px;
            height: 28px;
            display: none;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            color: #5f6368;
        }
        
        .su-search-clear:hover {
            background: #f1f3f4;
            color: #202124;
        }
        
        .su-search-input.selected + .su-search-clear {
            display: flex;
        }
        
        .su-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 320px;
            overflow-y: auto;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
            margin-top: 4px;
        }
        
        .su-dropdown.open {
            display: block;
        }
        
        .su-dropdown-group {
            border-bottom: 1px solid #f1f3f4;
        }
        
        .su-dropdown-group:last-of-type {
            border-bottom: none;
        }
        
        .su-dropdown-group.hidden {
            display: none;
        }
        
        .su-dropdown-group-title {
            padding: 10px 14px 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            color: #5f6368;
            background: #f8f9fa;
            position: sticky;
            top: 0;
        }
        
        .su-dropdown-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            cursor: pointer;
            transition: background 0.1s;
        }
        
        .su-dropdown-option:hover {
            background: #f1f3f4;
        }
        
        .su-dropdown-option.hidden {
            display: none;
        }
        
        .su-dropdown-option.selected {
            background: #fff8e1;
        }
        
        .su-option-name {
            font-size: 13px;
            color: #202124;
        }
        
        .su-option-type {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 2px 6px;
            background: #e8eaed;
            border-radius: 3px;
            color: #5f6368;
        }
        
        .su-dropdown-empty {
            padding: 24px;
            text-align: center;
            color: #9aa0a6;
        }
        
        .su-dropdown-empty .material-icons-outlined {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
        }

        .su-selected-info {
            margin-top: 12px;
            padding: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            display: none;
        }

        .su-selected-info.visible {
            display: block;
        }

        .su-selected-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .su-selected-icon {
            width: 32px;
            height: 32px;
            background: #e8f1fa;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .su-selected-icon .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .su-selected-name {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .su-selected-details {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        .su-selected-details span {
            display: block;
            margin-bottom: 2px;
        }

        /* Kontrola dokumentace - rozšířené styly */
        .doc-check-section {
            margin-bottom: 20px;
        }

        .doc-check-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .doc-check-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .doc-check-title .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .doc-check-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .doc-check-badge.pending {
            background: #f5f5f5;
            color: #5f6368;
        }

        .doc-check-badge.running {
            background: #e8f1fa;
            color: #004289;
        }

        .doc-check-badge.success {
            background: #e6f4ea;
            color: #137333;
        }

        .doc-check-badge.warning {
            background: #fef7e0;
            color: #b06000;
        }

        .doc-check-badge.error {
            background: #fce8e6;
            color: #c5221f;
        }

        /* Seznam dokumentů */
        .doc-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 280px;
            overflow-y: auto;
        }

        .doc-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .doc-item:hover {
            background: #e8f1fa;
            border-color: #c5d9f0;
        }

        .doc-item.checked {
            background: #e6f4ea;
            border-color: #ceead6;
        }

        .doc-item.has-issue {
            background: #fef7e0;
            border-color: #ffe082;
        }

        .doc-item-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #dadce0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .doc-item.checked .doc-item-checkbox {
            background: #137333;
            border-color: #137333;
            color: #fff;
        }

        .doc-item.has-issue .doc-item-checkbox {
            background: #f57c00;
            border-color: #f57c00;
            color: #fff;
        }

        .doc-item-checkbox .material-icons-outlined {
            font-size: 16px;
            display: none;
        }

        .doc-item.checked .doc-item-checkbox .material-icons-outlined,
        .doc-item.has-issue .doc-item-checkbox .material-icons-outlined {
            display: block;
        }

        .doc-item-content {
            flex: 1;
            min-width: 0;
        }

        .doc-item-name {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .doc-item-meta {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
            display: flex;
            gap: 12px;
            margin-top: 2px;
        }

        .doc-item-actions {
            display: flex;
            gap: 4px;
        }

        .doc-item-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .doc-item-btn:hover {
            background: rgba(0,0,0,0.08);
            color: #202124;
        }

        .doc-item-btn.issue-btn:hover {
            background: #fff3e0;
            color: #e65100;
        }

        .doc-item-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Automatická kontrola */
        .auto-check-section {
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .auto-check-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .auto-check-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .auto-check-title .material-icons-outlined {
            font-size: 18px;
            color: #7c3aed;
        }

        .btn-run-check {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 12px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-run-check:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-run-check:disabled {
            background: #dadce0;
            cursor: not-allowed;
        }

        .btn-run-check .material-icons-outlined {
            font-size: 16px;
        }

        /* ED stromová struktura */
        .ed-tree {
            font-size: 13px;
        }

        .ed-tree-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background: #e8f1fa;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .ed-tree-header-top {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ed-tree-header .material-icons-outlined {
            font-size: 20px;
            color: #004289;
        }

        .ed-version-selector {
            display: flex;
            align-items: center;
            padding-top: 8px;
            border-top: 1px solid #c5d9f0;
        }

        .ed-version-select {
            padding: 6px 10px;
            border: 1px solid #c5d9f0;
            border-radius: 4px;
            font-size: 12px;
            background: #fff;
            color: #202124;
            cursor: pointer;
            flex: 1;
        }

        .ed-version-select:focus {
            outline: none;
            border-color: #004289;
            box-shadow: 0 0 0 2px rgba(35, 98, 162, 0.2);
        }

        /* ED Breadcrumb a tlačítko Zpět */
        .ed-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 8px;
        }
        
        .ed-back-btn {
            background: #e8f0fe !important;
            border-color: #1a73e8 !important;
            color: #1a73e8 !important;
        }
        
        .ed-back-btn:hover {
            background: #d2e3fc !important;
        }
        
        /* Kategorie stavby styly */
        .stavba-kategorie-section {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .stavba-kategorie-section .control-section-title {
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .stavba-field {
            margin-bottom: 16px;
        }
        
        .stavba-field:last-child {
            margin-bottom: 0;
        }
        
        .stavba-field-label {
            font-size: 12px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 8px;
        }
        
        .stavba-field-hint {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: #5f6368;
            margin-top: 6px;
        }
        
        .stavba-field-hint .material-icons-outlined {
            font-size: 14px;
        }
        
        .stavba-toggle-group {
            display: flex;
            gap: 8px;
        }
        
        .stavba-toggle {
            cursor: pointer;
        }
        
        .stavba-toggle input {
            display: none;
        }
        
        .stavba-toggle-label {
            display: inline-block;
            padding: 8px 20px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            transition: all 0.15s;
        }
        
        .stavba-toggle input:checked + .stavba-toggle-label {
            background: #e8f0fe;
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .stavba-kategorie-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .stavba-kategorie-option {
            cursor: pointer;
        }
        
        .stavba-kategorie-option input {
            display: none;
        }
        
        .stavba-kategorie-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 8px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            transition: all 0.15s;
        }
        
        .stavba-kategorie-option input:checked + .stavba-kategorie-box {
            background: #e8f0fe;
            border-color: #1a73e8;
        }
        
        .stavba-kategorie-box:hover {
            border-color: #bdc1c6;
        }
        
        .kategorie-name {
            font-size: 13px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 2px;
        }
        
        .kategorie-desc {
            font-size: 10px;
            color: #5f6368;
        }
        
        /* Soubor staveb */
        .stavba-soubor-wrapper {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .stavba-soubor-item {
            border-bottom: 1px solid #e0e0e0;
        }
        
        .stavba-soubor-item:last-child {
            border-bottom: none;
        }
        
        .stavba-soubor-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: #f8f9fa;
            font-size: 12px;
            font-weight: 600;
            color: #202124;
        }
        
        .stavba-soubor-header .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .stavba-soubor-item.hlavni .stavba-soubor-header {
            background: #fff8e1;
        }
        
        .stavba-soubor-item.hlavni .stavba-soubor-header .material-icons-outlined {
            color: #f57c00;
        }
        
        .stavba-soubor-badge {
            font-size: 10px;
            font-weight: 500;
            padding: 2px 6px;
            background: #f57c00;
            color: #fff;
            border-radius: 4px;
            margin-left: auto;
        }
        
        .stavba-soubor-content {
            padding: 12px;
        }
        
        .stavba-soubor-nazev {
            margin-bottom: 10px;
        }
        
        .stavba-input {
            width: 100%;
            padding: 8px 12px;
            font-size: 13px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-family: inherit;
        }
        
        .stavba-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .stavba-kategorie-mini {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .kategorie-mini-option {
            cursor: pointer;
        }
        
        .kategorie-mini-option input {
            display: none;
        }
        
        .kategorie-mini-option span {
            display: inline-block;
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 500;
            background: #f1f3f4;
            border: 1px solid transparent;
            border-radius: 4px;
            color: #5f6368;
            transition: all 0.15s;
        }
        
        .kategorie-mini-option input:checked + span {
            background: #e8f0fe;
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .vedlejsi-stavby-list {
            margin-bottom: 10px;
        }
        
        .vedlejsi-stavba-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }
        
        .vedlejsi-stavba-row .stavba-input {
            flex: 1;
        }
        
        .stavba-select {
            padding: 8px 12px;
            font-size: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            font-family: inherit;
            min-width: 100px;
        }
        
        .stavba-select:focus {
            outline: none;
            border-color: #1a73e8;
        }
        
        .vedlejsi-remove {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            color: #5f6368;
        }
        
        .vedlejsi-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .vedlejsi-remove .material-icons-outlined {
            font-size: 18px;
        }
        
        .btn-add-vedlejsi {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            color: #1a73e8;
            background: transparent;
            border: 1px dashed #1a73e8;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-add-vedlejsi:hover {
            background: #e8f0fe;
        }
        
        .btn-add-vedlejsi .material-icons-outlined {
            font-size: 16px;
        }
        
        .stavba-soubor-summary {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            padding: 10px 12px;
            background: #e8f5e9;
            border-radius: 6px;
            font-size: 12px;
            color: #1b5e20;
        }
        
        .stavba-soubor-summary .material-icons-outlined {
            font-size: 18px;
        }

        .ed-folder {
            margin-left: 0;
            margin-bottom: 2px;
        }

        .ed-folder.nested {
            margin-left: 20px;
        }

        .ed-folder-header {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .ed-folder-header:hover {
            background: #f5f5f5;
        }

        .ed-folder-header .folder-icon {
            font-size: 18px;
            color: #f9a825;
            transition: transform 0.2s;
        }

        .ed-folder.open > .ed-folder-header .folder-icon {
            color: #f57c00;
        }

        .ed-folder-header .folder-name {
            flex: 1;
            font-weight: 500;
            color: #202124;
        }

        .ed-folder-header .folder-count {
            font-size: 11px;
            color: #5f6368;
            padding: 2px 8px;
            background: #f1f3f4;
            border-radius: 10px;
        }

        .ed-folder-content {
            display: none;
            margin-left: 24px;
            padding-left: 12px;
            border-left: 1px solid #e0e0e0;
        }

        .ed-folder.open > .ed-folder-content {
            display: block;
        }

        .ed-file {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .ed-file:hover {
            background: #e8f1fa;
        }

        .ed-file .material-icons-outlined {
            font-size: 16px;
            color: #c62828;
        }

        .ed-file .file-name {
            flex: 1;
            color: #202124;
        }

        .ed-file .file-size {
            font-size: 11px;
            color: #5f6368;
        }

        .ed-file-more {
            padding: 6px 10px;
            font-size: 12px;
            color: #5f6368;
            font-style: italic;
        }

        .ed-folder.empty .ed-folder-header {
            cursor: default;
        }

        .ed-folder.empty .ed-folder-header:hover {
            background: transparent;
        }

        /* Kontrola částí dokumentace */
        .doc-parts-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .doc-part-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .doc-part-item.status-ok {
            background: #e6f4ea;
            border-color: #ceead6;
        }

        .doc-part-item.status-warning {
            background: #fef7e0;
            border-color: #ffe082;
        }

        .doc-part-item.status-error {
            background: #fce8e6;
            border-color: #f5c6c3;
        }

        .doc-part-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .doc-part-letter {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #004289;
            color: #fff;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
        }

        .doc-part-item.status-ok .doc-part-letter {
            background: #137333;
        }

        .doc-part-item.status-warning .doc-part-letter {
            background: #f57c00;
        }

        .doc-part-item.status-error .doc-part-letter {
            background: #c5221f;
        }

        .doc-part-name {
            font-weight: 500;
            color: #202124;
        }

        .doc-part-status {
            display: flex;
            gap: 4px;
        }

        .doc-part-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            color: #9aa0a6;
        }

        .doc-part-btn:hover {
            border-color: #5f6368;
        }

        .doc-part-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Nekontrolováno - šedé zaškrtnutí */
        .doc-part-btn.ok.unchecked {
            background: #f1f3f4;
            border-color: #dadce0;
            color: #9aa0a6;
        }

        .doc-part-btn.ok.active {
            background: #137333;
            border-color: #137333;
            color: #fff;
        }

        .doc-part-btn.warning.active {
            background: #f57c00;
            border-color: #f57c00;
            color: #fff;
        }

        .doc-part-btn.error.active {
            background: #c5221f;
            border-color: #c5221f;
            color: #fff;
        }

        /* Sekce nedostatků podle částí dokumentace */
        .doc-part-item {
            display: flex;
            align-items: center;
        }
        
        .part-issues-section {
            background: #fef7f6;
            border: 1px solid #f5c6c5;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .part-issues-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
            color: #c5221f;
            margin-bottom: 12px;
        }
        
        .part-issues-header .part-letter {
            width: 24px;
            height: 24px;
            background: #c5221f;
            color: #fff;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }
        
        .part-issues-list {
            margin-bottom: 12px;
        }
        
        .part-issue-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #e8eaed;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .part-issue-item:last-child {
            margin-bottom: 0;
        }
        
        .part-issue-icon {
            width: 20px;
            height: 20px;
            background: #fce8e6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .part-issue-icon .material-icons-outlined {
            font-size: 12px;
            color: #c5221f;
        }
        
        .part-issue-content {
            flex: 1;
            font-size: 13px;
            color: #202124;
            line-height: 1.5;
        }
        
        .part-issue-remove {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9aa0a6;
            transition: all 0.15s;
            flex-shrink: 0;
        }
        
        .part-issue-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .part-issue-remove .material-icons-outlined {
            font-size: 16px;
        }
        
        .part-issues-add {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .part-issue-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            background: #fff;
            color: #202124;
            resize: vertical;
            min-height: 70px;
            line-height: 1.5;
        }
        
        .part-issue-textarea:focus {
            outline: none;
            border-color: #c5221f;
            box-shadow: 0 0 0 2px rgba(197, 34, 31, 0.1);
        }
        
        .part-issue-textarea::placeholder {
            color: #9aa0a6;
        }
        
        .btn-add-part-issue {
            align-self: flex-start;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #c5221f;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #c5221f;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-add-part-issue:hover {
            background: #fce8e6;
        }
        
        .btn-add-part-issue .material-icons-outlined {
            font-size: 18px;
        }
        
        .issues-empty {
            text-align: center;
            padding: 30px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #dadce0;
        }
        
        /* Auto issues sekce - modrá varianta */
        #autoIssuesSection {
            background: #e8f4fd;
            border-color: #c2e0ff;
        }
        
        #autoIssuesSection .part-issues-header {
            color: #1a73e8;
        }
        
        #autoIssuesSection .part-issue-icon {
            background: #d2e3fc;
        }
        
        #autoIssuesSection .part-issue-icon .material-icons-outlined {
            color: #1a73e8;
        }

        /* Pozemky - rozšířené styly */
        .pozemky-section {
            margin-bottom: 20px;
        }

        .pozemky-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .pozemky-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .pozemky-section-title .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .pozemky-section-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            background: #e8f1fa;
            color: #004289;
        }

        /* Metoda výběru sousedů */
        .neighbor-method-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .neighbor-method-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: all 0.15s;
        }

        .neighbor-method-btn:hover {
            border-color: #004289;
            background: #f8fbff;
        }

        .neighbor-method-btn.active {
            border-color: #004289;
            background: #e8f1fa;
        }

        .neighbor-method-btn .material-icons-outlined {
            font-size: 24px;
            color: #5f6368;
        }

        .neighbor-method-btn.active .material-icons-outlined {
            color: #004289;
        }

        .neighbor-method-btn span:last-child {
            font-size: 11px;
            color: #5f6368;
            text-align: center;
        }

        .neighbor-method-btn.active span:last-child {
            color: #004289;
            font-weight: 500;
        }

        /* Polygon input */
        .polygon-input-section {
            display: none;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .polygon-input-section.visible {
            display: block;
        }

        .polygon-input-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .polygon-input-label {
            font-size: 13px;
            color: #202124;
            white-space: nowrap;
        }

        .polygon-input {
            width: 80px;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }

        .polygon-input:focus {
            outline: none;
            border-color: #004289;
            box-shadow: 0 0 0 2px rgba(35, 98, 162, 0.2);
        }

        .polygon-input-unit {
            font-size: 13px;
            color: #5f6368;
        }

        .btn-generate-polygon {
            margin-left: auto;
            padding: 8px 16px;
            background: #004289;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-generate-polygon:hover {
            background: #1a4a7a;
        }

        /* Ověření KN */
        .kn-verify-section {
            margin-top: 20px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .kn-verify-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .kn-verify-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .kn-verify-title .material-icons-outlined {
            font-size: 18px;
            color: #7c3aed;
        }

        .btn-verify-kn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-verify-kn:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-verify-kn:disabled {
            background: #dadce0;
            cursor: not-allowed;
        }

        .kn-verify-results {
            display: none;
        }

        .kn-verify-results.visible {
            display: block;
        }

        /* Vlastníci z KN */
        .owner-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .owner-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .owner-item.verified {
            border-color: #ceead6;
            background: #f0faf3;
        }

        .owner-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e8f1fa;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .owner-item-icon .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .owner-item-content {
            flex: 1;
            min-width: 0;
        }

        .owner-item-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .owner-item-parcels {
            font-size: 11px;
            color: #5f6368;
        }

        .owner-item-relations {
            display: flex;
            gap: 6px;
            margin-top: 4px;
        }

        .owner-relation-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }

        .owner-relation-badge.vlastnik {
            background: #e8f1fa;
            color: #004289;
        }

        .owner-relation-badge.zastava {
            background: #fef7e0;
            color: #b06000;
        }

        .owner-relation-badge.vecne-bremeno {
            background: #fce8e6;
            color: #c5221f;
        }

        .owner-item-actions {
            display: flex;
            gap: 4px;
        }

        .owner-item-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .owner-item-btn:hover {
            background: rgba(0,0,0,0.08);
            color: #202124;
        }

        .owner-item-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Účastníci info */
        .ucastnici-info {
            margin-top: 16px;
            padding: 12px;
            background: #e6f4ea;
            border: 1px solid #ceead6;
            border-radius: 8px;
            display: none;
        }

        .ucastnici-info.visible {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ucastnici-info .material-icons-outlined {
            font-size: 20px;
            color: #137333;
        }

        .ucastnici-info-text {
            font-size: 13px;
            color: #137333;
        }

        /* Parcel chip rozšířený */
        .parcel-chip-extended {
            display: flex;
            flex-direction: column;
            padding: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .parcel-chip-extended.verified {
            border-color: #ceead6;
            background: #f0faf3;
        }

        .parcel-chip-extended-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .parcel-chip-extended-info {
            flex: 1;
        }

        .parcel-chip-extended-number {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
        }

        .parcel-chip-extended-katastr {
            font-size: 12px;
            color: #5f6368;
        }

        .parcel-chip-extended-owner {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #5f6368;
        }

        .parcel-chip-extended-owner strong {
            color: #202124;
        }

        /* Pozemky záměru - editovatelné */
        
        /* Přepínač zobrazení pozemků */
        .pozemky-view-toggle {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            margin-left: 8px;
            background: #f1f3f4;
            border-radius: 4px;
            padding: 2px;
        }
        
        .pozemky-view-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 20px;
            border: none;
            background: transparent;
            border-radius: 3px;
            color: #5f6368;
            cursor: pointer;
            padding: 0;
        }
        
        .pozemky-view-btn:hover {
            background: #e0e0e0;
        }
        
        .pozemky-view-btn.active {
            background: #fff;
            color: #1a73e8;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .pozemky-view-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Kompaktní chip prezentace pozemků */
        .pozemky-chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .pozemek-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px 4px 10px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            font-size: 12px;
            color: #202124;
            white-space: nowrap;
            transition: all 0.15s;
        }
        
        .pozemek-chip:hover {
            background: #fff;
            border-color: #dadce0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .pozemek-chip.zamer {
            background: #e8f0fe;
            border-color: #c2d7f7;
        }
        
        .pozemek-chip.zamer:hover {
            background: #d2e3fc;
            border-color: #1a73e8;
        }
        
        .pozemek-chip.soused {
            background: #f1f3f4;
            border-color: #dadce0;
        }
        
        .pozemek-chip .chip-icon {
            font-size: 14px;
            color: #5f6368;
        }
        
        .pozemek-chip.zamer .chip-icon {
            color: #1a73e8;
        }
        
        .pozemek-chip .chip-parcela {
            font-weight: 500;
        }
        
        .pozemek-chip .chip-ku {
            font-size: 10px;
            color: #80868b;
            margin-left: 2px;
        }
        
        .pozemek-chip .chip-remove {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border: none;
            background: transparent;
            border-radius: 50%;
            color: #9aa0a6;
            cursor: pointer;
            padding: 0;
            margin-left: 2px;
        }
        
        .pozemek-chip .chip-remove:hover {
            background: rgba(0,0,0,0.08);
            color: #c5221f;
        }
        
        .pozemek-chip .chip-remove .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Řádkové zobrazení pozemků */
        .pozemky-list-container {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        /* Hlavička tabulky s řazením */
        .pozemky-list-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: #f8f9fa;
            font-size: 11px;
            font-weight: 500;
            color: #5f6368;
            border-bottom: 1px solid #e0e0e0;
            user-select: none;
        }
        
        .pozemky-list-header .header-col {
            display: flex;
            align-items: center;
            gap: 2px;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background 0.15s;
        }
        
        .pozemky-list-header .header-col:hover {
            background: #e8e8e8;
        }
        
        .pozemky-list-header .header-col.active {
            color: #1a73e8;
            background: #e8f0fe;
        }
        
        .pozemky-list-header .header-col .sort-icon {
            font-size: 14px;
            opacity: 0.4;
        }
        
        .pozemky-list-header .header-col.active .sort-icon {
            opacity: 1;
        }
        
        .pozemky-list-header .header-col.asc .sort-icon {
            transform: rotate(180deg);
        }
        
        .pozemky-list-header .col-icon { width: 20px; }
        .pozemky-list-header .col-parcela { min-width: 70px; }
        .pozemky-list-header .col-katastr { min-width: 120px; }
        .pozemky-list-header .col-kod { min-width: 60px; }
        .pozemky-list-header .col-plocha { min-width: 70px; text-align: right; }
        .pozemky-list-header .col-actions { width: 20px; margin-left: auto; }
        
        .pozemek-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: #fff;
            font-size: 12px;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .pozemek-row:last-child {
            border-bottom: none;
        }
        
        .pozemek-row:hover {
            background: #f8f9fa;
        }
        
        .pozemek-row.zamer {
            background: #f8fbff;
        }
        
        .pozemek-row.zamer:hover {
            background: #eef5fc;
        }
        
        .pozemek-row .row-icon {
            font-size: 16px;
            color: #5f6368;
            width: 20px;
            text-align: center;
        }
        
        .pozemek-row.zamer .row-icon {
            color: #1a73e8;
        }
        
        .pozemek-row .row-parcela {
            font-weight: 600;
            min-width: 70px;
            color: #202124;
        }
        
        .pozemek-row .row-katastr {
            color: #5f6368;
            min-width: 120px;
        }
        
        .pozemek-row .row-kod {
            color: #9aa0a6;
            font-size: 11px;
            min-width: 60px;
        }
        
        .pozemek-row .row-plocha {
            color: #5f6368;
            min-width: 70px;
            text-align: right;
        }
        
        .pozemek-row .row-remove {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #9aa0a6;
            cursor: pointer;
            padding: 0;
            margin-left: auto;
        }
        
        .pozemek-row .row-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .pozemek-row .row-remove .material-icons-outlined {
            font-size: 16px;
        }
        }
        
        .parcel-chip-extended-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .parcel-chip-extended .parcel-chip-remove {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #9aa0a6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            flex-shrink: 0;
        }

        .parcel-chip-extended .parcel-chip-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }

        .parcel-chip-extended .parcel-chip-remove .material-icons-outlined {
            font-size: 18px;
        }

        .pozemky-add-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed #e0e0e0;
        }

        .pozemky-add-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .pozemky-add-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            outline: none;
        }

        .pozemky-add-input:focus {
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .pozemky-add-input::placeholder {
            color: #9aa0a6;
        }

        .btn-add-pozemek {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-add-pozemek:hover {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .btn-add-pozemek .material-icons-outlined {
            font-size: 16px;
        }

        .pozemky-empty-note {
            padding: 16px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
            font-size: 12px;
            color: #e65100;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pozemky-empty-note .material-icons-outlined {
            font-size: 18px;
        }

        .auto-check-results {
            display: none;
        }

        .auto-check-results.visible {
            display: block;
        }

        .check-result-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .check-result-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .check-result-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .check-result-icon .material-icons-outlined {
            font-size: 16px;
        }

        .check-result-icon.success {
            background: #e6f4ea;
            color: #137333;
        }

        .check-result-icon.warning {
            background: #fef7e0;
            color: #f57c00;
        }

        .check-result-icon.error {
            background: #fce8e6;
            color: #c5221f;
        }

        .check-result-content {
            flex: 1;
        }

        .check-result-label {
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .check-result-detail {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .check-result-action {
            font-size: 12px !important;
            color: #004289 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .check-result-action:hover {
            text-decoration: underline;
        }

        /* Seznam nedostatků */
        .issues-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
            display: block;
        }

        .issues-section.visible {
            display: block;
        }

        .issues-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .issues-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            font-style: normal !important;
        }

        .issues-title .material-icons-outlined {
            font-size: 18px;
        }

        .issues-count {
            padding: 4px 10px;
            background: #ff6d00;
            color: #fff;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 600 !important;
        }

        .issues-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .issue-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #ffe082;
            border-radius: 6px;
        }

        .issue-item-icon {
            width: 24px;
            height: 24px;
            background: #ff6d00;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .issue-item-icon .material-icons-outlined {
            font-size: 14px;
            color: #fff;
        }

        .issue-item-content {
            flex: 1;
        }

        .issue-item-doc {
            font-size: 12px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            font-style: normal !important;
        }

        .issue-item-text {
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
            margin-top: 2px;
        }

        .issue-item-remove {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #9aa0a6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .issue-item-remove:hover {
            background: #ffecb3;
            color: #e65100;
        }

        .issue-item-remove .material-icons-outlined {
            font-size: 18px;
        }

        /* Přidat nedostatek */
        .add-issue-row {
            display: flex;
            gap: 8px;
        }

        .add-issue-section {
            margin-top: 12px;
        }

        .add-issue-type-toggle {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }

        .issue-type-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #fff;
            color: #5f6368;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .issue-type-btn:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }

        .issue-type-btn.active {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .issue-type-btn .material-icons-outlined {
            font-size: 16px;
        }

        .add-issue-textarea-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .add-issue-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        .add-issue-textarea:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .btn-add-issue-full {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 16px;
            background: #ff6d00;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            align-self: flex-end;
        }

        .btn-add-issue-full:hover {
            background: #e65100;
        }

        .btn-add-issue-full .material-icons-outlined {
            font-size: 18px;
        }

        .add-issue-select {
            width: 180px;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            background: #fff;
            font-style: normal !important;
        }

        .add-issue-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            font-style: normal !important;
        }

        .add-issue-input:focus,
        .add-issue-select:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .btn-add-issue {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 8px 14px;
            background: #ff6d00;
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 12px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-add-issue:hover {
            background: #e65100;
        }

        .btn-add-issue .material-icons-outlined {
            font-size: 16px;
        }

        /* Loading animace pro automatickou kontrolu */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .btn-run-check.loading .material-icons-outlined {
            animation: spin 1s linear infinite;
        }

        /* Control fullscreen overlay */
        .control-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            z-index: 1500;
            display: none;
            flex-direction: column;
        }

        .control-overlay.open {
            display: flex;
        }

        .control-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .control-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .control-close {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-close:hover {
            background: #f1f3f4;
        }

        .control-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .control-title .material-icons-outlined {
            font-size: 24px;
            color: #004289;
        }

        .control-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Left panel - document viewer */
        .control-viewer {
            flex: 0 0 60%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e0e0;
            background: #f5f5f5;
        }

        .viewer-tabs {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
            align-items: center;
        }
        
        .viewer-tabs-left {
            display: flex;
            gap: 4px;
            flex: 1;
            flex-wrap: wrap;
        }
        
        .viewer-tabs-right {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-left: auto;
        }
        
        .btn-vse-ok {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: #fff;
            color: #137333;
            border: 1px solid #137333;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
        }
        
        .btn-vse-ok:hover {
            background: #e6f4ea;
        }
        
        .btn-vse-ok:active {
            background: #137333;
            color: #fff;
            transform: scale(0.98);
        }
        
        .btn-vse-ok .material-icons-outlined {
            font-size: 18px;
        }
        
        .viewer-open-external {
            width: 32px;
            height: 32px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
            transition: all 0.15s;
            flex-shrink: 0;
            margin-left: 8px;
        }
        
        .viewer-open-external:hover {
            background: #e8f4fd;
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .viewer-open-external .material-icons-outlined {
            font-size: 18px;
        }

        .viewer-tab {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px !important;
            color: #5f6368 !important;
            cursor: pointer;
            transition: all 0.15s;
            font-style: normal !important;
        }

        .viewer-tab:hover {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289 !important;
        }

        .viewer-tab.active {
            background: #004289;
            border-color: #004289;
            color: #fff !important;
        }

        .viewer-tab .material-icons-outlined {
            font-size: 16px;
        }

        .viewer-tab .badge {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }

        .viewer-tab:not(.active) .badge {
            background: #e8f1fa;
            color: #004289;
        }

        .viewer-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .viewer-placeholder {
            background: #fff;
            border: 2px dashed #dadce0;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .viewer-placeholder .material-icons-outlined {
            font-size: 64px;
            color: #9aa0a6;
            margin-bottom: 16px;
        }

        .viewer-placeholder-title {
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 8px !important;
            font-style: normal !important;
        }

        .viewer-placeholder-text {
            font-size: 13px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        /* Right panel - control form */
        .control-form {
            flex: 0 0 40%;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        .control-form-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .control-form-footer {
            padding: 16px 24px;
            border-top: 1px solid #e0e0e0;
            background: #fafafa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .control-form-footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-form-footer-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .auto-save-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
        }

        .auto-save-indicator .material-icons-outlined {
            font-size: 16px;
        }

        .auto-save-indicator.saving {
            color: #f57c00;
        }

        .auto-save-indicator.saving .material-icons-outlined {
            animation: spin 1s linear infinite;
        }

        .auto-save-indicator.saved {
            color: #137333;
        }

        /* ==========================================
           KONTROLA ŽÁDOSTI - NOVÝ DESIGN
           ========================================== */
        
        /* Levé okno - strukturovaná data */
        .zadost-data-viewer {
            flex: 0 0 60%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e0e0;
        }
        
        .zadost-data-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            background: #f8f9fa;
        }
        
        .zadost-data-tab {
            display: none;
            padding: 20px;
        }
        
        .zadost-data-tab.active {
            display: block;
        }
        
        .zadost-data-section {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
            transition: border-color 0.2s;
        }
        
        .zadost-data-section.status-ok {
            border-color: #34a853;
        }
        
        .zadost-data-section.status-ok .zadost-data-section-header {
            background: #e6f4ea;
            border-bottom-color: #ceead6;
        }
        
        .zadost-data-section.status-vada {
            border-color: #ea4335;
        }
        
        .zadost-data-section.status-vada .zadost-data-section-header {
            background: #fce8e6;
            border-bottom-color: #f5c6c2;
        }
        
        /* Inline kontrolní panel v sekci */
        .zadost-section-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: #fafafa;
            border-top: 1px solid #e0e0e0;
        }
        
        .zadost-section-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
        }
        
        .zadost-section-status .material-icons-outlined {
            font-size: 16px;
        }
        
        .zadost-section-status.status-ok {
            color: #137333;
        }
        
        .zadost-section-status.status-vada {
            color: #c5221f;
        }
        
        .zadost-section-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .zadost-section-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .zadost-section-btn:hover {
            background: #f8f9fa;
            border-color: #c0c0c0;
        }
        
        .zadost-section-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        .zadost-section-btn.btn-ok {
            color: #137333;
            border-color: #137333;
        }
        
        .zadost-section-btn.btn-ok:hover {
            background: #e6f4ea;
        }
        
        .zadost-section-btn.btn-ok.active {
            background: #137333;
            color: #fff;
            border-color: #137333;
        }
        
        .zadost-section-btn.btn-vada {
            color: #c5221f;
            border-color: #c5221f;
        }
        
        .zadost-section-btn.btn-vada:hover {
            background: #fce8e6;
        }
        
        .zadost-section-btn.btn-vada.active {
            background: #c5221f;
            color: #fff;
            border-color: #c5221f;
        }
        
        /* Pravý panel - Nedostatky */
        .zadost-deficiency-panel {
            flex: 0 0 40%;
            display: flex;
            flex-direction: column;
            background: #fff;
        }
        
        .deficiency-panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
        }
        
        .deficiency-panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 8px;
        }
        
        .deficiency-panel-title .material-icons-outlined {
            font-size: 20px;
            color: #ea4335;
        }
        
        .deficiency-panel-summary {
            display: flex;
            gap: 16px;
            font-size: 12px;
        }
        
        .deficiency-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .deficiency-stat.ok { color: #137333; }
        .deficiency-stat.vada { color: #c5221f; }
        .deficiency-stat.pending { color: #5f6368; }
        
        .deficiency-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .deficiency-empty {
            text-align: center;
            padding: 40px 20px;
            color: #9aa0a6;
        }
        
        .deficiency-empty .material-icons-outlined {
            font-size: 48px;
            margin-bottom: 12px;
            color: #137333;
        }
        
        .deficiency-empty-title {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 4px;
        }
        
        .deficiency-empty-text {
            font-size: 12px;
        }
        
        /* Seznam nedostatků */
        .deficiency-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .deficiency-item {
            background: #fce8e6;
            border: 1px solid #f5c6c2;
            border-radius: 8px;
            padding: 12px;
        }
        
        .deficiency-item-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .deficiency-item-section {
            font-size: 11px;
            font-weight: 600;
            color: #c5221f;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .deficiency-item-remove {
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            color: #c5221f;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .deficiency-item-remove:hover {
            background: rgba(197, 34, 31, 0.1);
        }
        
        .deficiency-item-remove .material-icons-outlined {
            font-size: 16px;
        }
        
        .deficiency-item-text {
            font-size: 13px;
            color: #202124;
            margin-bottom: 8px;
        }
        
        .deficiency-item-textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #f5c6c2;
            border-radius: 4px;
            background: #fff;
            font-size: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }
        
        .deficiency-item-textarea:focus {
            outline: none;
            border-color: #c5221f;
            box-shadow: 0 0 0 2px rgba(197, 34, 31, 0.1);
        }
        
        .deficiency-item-textarea::placeholder {
            color: #9aa0a6;
        }
        
        /* Footer s výsledkem */
        .deficiency-panel-footer {
            padding: 16px;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
        }
        
        .deficiency-result {
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
        }
        
        .deficiency-result.positive {
            background: #e6f4ea;
            border: 1px solid #ceead6;
            color: #137333;
        }
        
        .deficiency-result.negative {
            background: #fce8e6;
            border: 1px solid #f5c6c2;
            color: #c5221f;
        }
        
        .deficiency-result.pending {
            background: #fff8e1;
            border: 1px solid #ffe082;
            color: #e65100;
        }
        
        .deficiency-result .material-icons-outlined {
            font-size: 20px;
        }
        
        .deficiency-panel-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 12px;
        }
        
        /* Badge stavu sekce v hlavičce */
        .section-status-badge {
            margin-left: auto;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .section-status-badge.ok {
            background: #e6f4ea;
            color: #137333;
        }
        
        .section-status-badge.vada {
            background: #fce8e6;
            color: #c5221f;
        }
        
        /* Inline přílohy v sekci */
        .zadost-prilohy-inline {
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .priloha-inline-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .priloha-inline-item .material-icons-outlined {
            font-size: 16px;
        }
        
        .priloha-inline-item.ok {
            background: #e6f4ea;
            color: #137333;
        }
        
        .priloha-inline-item.na {
            color: #9aa0a6;
        }
        
        .priloha-inline-item.pending {
            background: #fff3e0;
            color: #e65100;
            font-weight: 500;
        }
        
        .priloha-inline-item.pending .material-icons-outlined {
            color: #e65100;
        }
        
        /* Náhled formuláře žádosti */
        .formular-preview {
            background: #fff;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 16px;
            font-family: 'Times New Roman', serif;
        }
        
        .formular-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            border-bottom: 2px solid #000;
        }
        
        .formular-logo {
            width: 60px;
            height: 60px;
            border: 2px solid #000;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .formular-logo .material-icons-outlined {
            font-size: 36px;
        }
        
        .formular-title-block {
            flex: 1;
        }
        
        .formular-title {
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .formular-subtitle {
            font-size: 11px;
            color: #444;
            margin-top: 4px;
        }
        
        .formular-cislo {
            text-align: right;
        }
        
        .formular-cislo-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
        }
        
        .formular-cislo-value {
            font-size: 13px;
            font-weight: bold;
            font-family: monospace;
        }
        
        .formular-section {
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .formular-section:last-of-type {
            border-bottom: none;
        }
        
        .formular-section-title {
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: #f0f0f0;
            padding: 6px 10px;
            margin: -16px -20px 16px -20px;
            border-bottom: 1px solid #d0d0d0;
        }
        
        .formular-subsection {
            margin-bottom: 16px;
        }
        
        .formular-subsection:last-child {
            margin-bottom: 0;
        }
        
        .formular-subsection-title {
            font-size: 11px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .formular-field-row {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .formular-field-row:last-child {
            margin-bottom: 0;
        }
        
        .formular-field {
            flex: 1;
        }
        
        .formular-field.full {
            flex: 100%;
        }
        
        .formular-field-label {
            font-size: 9px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        
        .formular-field-value {
            font-size: 12px;
            padding: 4px 8px;
            background: #fafafa;
            border: 1px solid #d0d0d0;
            border-radius: 2px;
            min-height: 20px;
        }
        
        .formular-field.empty .formular-field-value {
            color: #999;
            font-style: italic;
        }
        
        .formular-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #f8f8f8;
            border-top: 1px solid #e0e0e0;
            font-size: 10px;
            color: #666;
        }
        
        /* Akční tlačítka pro ověření zástupce */
        .zastupce-verify-actions {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }
        
        .zastupce-verify-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            color: #3c4043;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .zastupce-verify-btn:hover {
            background: #f1f3f4;
            border-color: #c0c0c0;
        }
        
        .zastupce-verify-btn .material-icons-outlined {
            font-size: 18px;
        }
        
        .zastupce-verify-btn.reza {
            border-color: #34a853;
            color: #137333;
        }
        
        .zastupce-verify-btn.reza:hover {
            background: #e6f4ea;
        }
        
        .zastupce-verify-btn.reza .material-icons-outlined {
            color: #34a853;
        }
        
        .zastupce-verify-btn.prilohy {
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .zastupce-verify-btn.prilohy:hover {
            background: #e8f0fe;
        }
        
        /* REZA Modal */
        .reza-modal-content {
            padding: 0;
        }
        
        .reza-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-bottom: 1px solid #a5d6a7;
        }
        
        .reza-logo {
            width: 48px;
            height: 48px;
            background: #fff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .reza-logo .material-icons-outlined {
            font-size: 28px;
            color: #2e7d32;
        }
        
        .reza-header-text {
            flex: 1;
        }
        
        .reza-title {
            font-size: 16px;
            font-weight: 600;
            color: #1b5e20;
        }
        
        .reza-subtitle {
            font-size: 12px;
            color: #388e3c;
            margin-top: 2px;
        }
        
        .reza-verified-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #2e7d32;
            color: #fff;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .reza-verified-badge .material-icons-outlined {
            font-size: 16px;
        }
        
        .reza-body {
            padding: 20px;
        }
        
        .reza-info-section {
            margin-bottom: 16px;
        }
        
        .reza-info-section:last-child {
            margin-bottom: 0;
        }
        
        .reza-info-title {
            font-size: 11px;
            font-weight: 600;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 8px;
        }
        
        .reza-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .reza-info-item {
            background: #f8f9fa;
            padding: 10px 12px;
            border-radius: 6px;
        }
        
        .reza-info-item.full {
            grid-column: 1 / -1;
        }
        
        .reza-info-label {
            font-size: 10px;
            color: #5f6368;
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        
        .reza-info-value {
            font-size: 13px;
            color: #202124;
            font-weight: 500;
        }
        
        .reza-validity {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .reza-validity .material-icons-outlined {
            font-size: 16px;
        }
        
        .reza-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }
        
        .reza-footer-info {
            font-size: 11px;
            color: #5f6368;
        }
        
        .reza-footer-info a {
            color: #1a73e8;
            text-decoration: none;
        }
        
        .reza-footer-info a:hover {
            text-decoration: underline;
        }
        
        .zadost-data-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: #f1f3f4;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            font-size: 13px;
            color: #202124;
        }
        
        .zadost-data-section-header .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .zadost-data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: #e0e0e0;
        }
        
        .zadost-data-item {
            padding: 12px 16px;
            background: #fff;
        }
        
        .zadost-data-item.full-width {
            grid-column: 1 / -1;
        }
        
        .zadost-data-label {
            font-size: 11px;
            font-weight: 500;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 4px;
        }
        
        .zadost-data-value {
            font-size: 13px;
            color: #202124;
        }
        
        .zadost-data-value.text-block {
            line-height: 1.5;
        }
        
        .zadost-data-empty {
            padding: 24px 16px;
            text-align: center;
            color: #9aa0a6;
            font-size: 13px;
        }
        
        .zadost-data-empty .material-icons-outlined {
            font-size: 32px;
            margin-bottom: 8px;
            display: block;
        }
        
        /* Tabulka pozemků */
        .zadost-data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .zadost-data-table th {
            padding: 10px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
            font-weight: 600;
            color: #5f6368;
            font-size: 11px;
            text-transform: uppercase;
        }
        
        .zadost-data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #f1f3f4;
            color: #202124;
        }
        
        .zadost-data-table tr:last-child td {
            border-bottom: none;
        }
        
        /* Přílohy v levém okně */
        .zadost-prilohy-list {
            padding: 0;
        }
        
        .zadost-priloha-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: #fff;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .zadost-priloha-item:last-child {
            border-bottom: none;
        }
        
        .zadost-priloha-item.not-applicable {
            opacity: 0.6;
        }
        
        .zadost-priloha-item.attached {
            background: #fff;
        }
        
        .priloha-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: #f1f3f4;
            flex-shrink: 0;
        }
        
        .priloha-icon .material-icons-outlined {
            font-size: 20px;
            color: #5f6368;
        }
        
        .zadost-priloha-item.attached .priloha-icon {
            background: #e8f5e9;
        }
        
        .zadost-priloha-item.attached .priloha-icon .material-icons-outlined {
            color: #2e7d32;
        }
        
        .priloha-info {
            flex: 1;
        }
        
        .priloha-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 2px;
        }
        
        .priloha-status {
            font-size: 12px;
            color: #5f6368;
        }
        
        .priloha-link {
            color: #1a73e8;
            text-decoration: none;
        }
        
        .priloha-link:hover {
            text-decoration: underline;
        }
        
        .priloha-action {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            color: #5f6368;
        }
        
        .priloha-action:hover {
            background: #f1f3f4;
        }
        
        /* Pravé okno - checklist */
        .zadost-checklist {
            flex: 0 0 40%;
        }
        
        .checklist-section {
            margin-bottom: 24px;
        }
        
        .checklist-section-title {
            font-size: 14px;
            font-weight: 700;
            color: #202124;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 8px;
            background: #fff;
            transition: all 0.15s;
        }
        
        .checklist-item:hover {
            border-color: #dadce0;
            background: #fafafa;
        }
        
        .checklist-item.disabled {
            opacity: 0.5;
            background: #f8f9fa;
        }
        
        .checklist-item.checked-ok {
            background: #e8f5e9;
            border-color: #81c784;
        }
        
        .checklist-item.checked-error {
            background: #ffebee;
            border-color: #ef9a9a;
        }
        
        .checklist-text {
            font-size: 13px;
            color: #202124;
            flex: 1;
            padding-right: 12px;
        }
        
        .checklist-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }
        
        .checklist-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #dadce0;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .checklist-btn .material-icons-outlined {
            font-size: 18px;
        }
        
        .checklist-btn.ok {
            color: #5f6368;
        }
        
        .checklist-btn.ok:hover,
        .checklist-btn.ok.active {
            background: #e8f5e9;
            border-color: #81c784;
            color: #2e7d32;
        }
        
        .checklist-btn.error {
            color: #5f6368;
        }
        
        .checklist-btn.error:hover,
        .checklist-btn.error.active {
            background: #ffebee;
            border-color: #ef9a9a;
            color: #c62828;
        }
        
        .checklist-btn.na {
            background: #f1f3f4;
            border-color: #e0e0e0;
            color: #9aa0a6;
            cursor: default;
        }

        /* ==========================================
           ÚČASTNÍCI ŘÍZENÍ - STYLY
           ========================================== */
        .ucastnici-tabs {
            display: flex;
            gap: 0;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            padding: 0;
        }
        
        .ucastnici-tab {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 20px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .ucastnici-tab:hover {
            background: #e8f1fa;
            color: #004289;
        }
        
        .ucastnici-tab.active {
            background: #fff;
            color: #004289;
            border-bottom-color: #004289;
        }
        
        .ucastnici-tab .material-icons-outlined {
            font-size: 18px;
        }
        
        .ucastnici-tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: #e8eaed;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            color: #5f6368;
        }
        
        .ucastnici-tab.active .ucastnici-tab-badge {
            background: #e8f1fa;
            color: #004289;
        }
        
        .ucastnici-panel {
            display: none;
            padding: 0;
            overflow-y: auto;
            flex: 1;
        }
        
        .ucastnici-panel.active {
            display: flex;
            flex-direction: column;
        }
        
        .ucastnici-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #fff;
            border-bottom: 1px solid #e8eaed;
        }
        
        .ucastnici-toolbar-left,
        .ucastnici-toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-ucastnici-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-ucastnici-action:hover {
            background: #f8f9fa;
            border-color: #004289;
            color: #004289;
        }
        
        .btn-ucastnici-action.primary {
            background: #004289;
            border-color: #004289;
            color: #fff;
        }
        
        .btn-ucastnici-action.primary:hover {
            background: #003570;
        }
        
        .btn-ucastnici-action .material-icons-outlined {
            font-size: 16px;
        }
        
        .ucastnici-checkbox {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
            cursor: pointer;
        }
        
        .ucastnici-checkbox input {
            cursor: pointer;
        }
        
        /* Skupiny účastníků */
        .ucastnici-group {
            border-bottom: 1px solid #e8eaed;
        }
        
        .ucastnici-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #f8f9fa;
        }
        
        .ucastnici-group-title {
            font-size: 13px;
            font-weight: 600;
            color: #202124;
        }
        
        .ucastnici-group-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-add-ucastnik {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #004289;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-add-ucastnik:hover {
            background: #003570;
        }
        
        .btn-add-ucastnik.secondary {
            background: #fff;
            border: 1px solid #dadce0;
            color: #5f6368;
        }
        
        .btn-add-ucastnik.secondary:hover {
            background: #f8f9fa;
            border-color: #004289;
            color: #004289;
        }
        
        .btn-add-ucastnik .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Tabulka účastníků */
        .ucastnici-table {
            width: 100%;
        }
        
        .ucastnici-row {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            border-bottom: 1px solid #f1f3f4;
            transition: background 0.1s;
        }
        
        .ucastnici-row:hover {
            background: #f8f9fa;
        }
        
        .ucastnici-row:last-child {
            border-bottom: none;
        }
        
        .ucastnici-cell {
            font-size: 13px;
            color: #202124;
        }
        
        .ucastnici-cell.status {
            width: 30px;
            flex-shrink: 0;
        }
        
        .ucastnici-cell.type {
            width: 100px;
            flex-shrink: 0;
            font-size: 11px;
            color: #5f6368;
        }
        
        .ucastnici-cell.name {
            flex: 1;
            font-weight: 500;
            min-width: 150px;
        }
        
        .ucastnici-cell.address {
            flex: 1.5;
            color: #5f6368;
            font-size: 12px;
        }
        
        .ucastnici-cell.actions {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
            width: 150px;
            flex-shrink: 0;
        }
        
        .ucastnici-status {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
        }
        
        .ucastnici-status .material-icons-outlined {
            font-size: 18px;
        }
        
        .ucastnici-status.verified {
            color: #137333;
        }
        
        .ucastnici-status.pending {
            color: #f9ab00;
        }
        
        .ucastnici-status.error {
            color: #c5221f;
        }
        
        .ucastnici-action-btn {
            width: 28px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .ucastnici-action-btn:hover {
            background: #e8eaed;
            color: #202124;
        }
        
        .ucastnici-action-btn.delete:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .ucastnici-action-btn.favorited {
            color: #f9ab00;
        }
        
        .ucastnici-action-btn .material-icons-outlined {
            font-size: 18px;
        }
        
        .ucastnici-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 24px;
            color: #9aa0a6;
            font-size: 13px;
        }
        
        .ucastnici-empty .material-icons-outlined {
            font-size: 20px;
        }
        
        /* Tabulka zástupců a dalších osob */
        .zastupci-table-wrapper {
            overflow-x: auto;
        }
        
        .zastupci-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .zastupci-table th {
            padding: 10px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
            font-weight: 500;
            font-size: 11px;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .zastupci-table td {
            padding: 12px;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: middle;
        }
        
        .zastupci-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .zastupce-zastoupeni {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .zastupce-chip {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            background: #e8f1fa;
            border-radius: 12px;
            font-size: 12px;
            color: #004289;
        }
        
        .zastupce-role {
            display: inline-block;
            padding: 3px 8px;
            background: #f1f3f4;
            border-radius: 4px;
            font-size: 11px;
            color: #5f6368;
        }
        
        .dalsi-osoba-poznamka {
            display: inline-block;
            padding: 3px 8px;
            background: #fff3e0;
            border-radius: 4px;
            font-size: 11px;
            color: #e65100;
            font-style: italic;
        }
        
        /* Toggle switch pro doručování */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #dadce0;
            transition: 0.2s;
            border-radius: 22px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.2s;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: #004289;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(18px);
        }

        /* ==========================================
           OSOBY - DVOUSLOUPCOVÝ LAYOUT
           ========================================== */
        .osoby-layout {
            display: flex;
            gap: 0;
            padding: 0 !important;
            height: 100%;
        }
        
        /* Levý sloupec - Pozemky */
        .osoby-col-pozemky {
            width: 340px;
            min-width: 340px;
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .osoby-pozemky-content {
            flex: 1;
            overflow-y: auto;
        }
        
        /* Pravý sloupec - Účastníci */
        .osoby-col-ucastnici {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #fff;
        }
        
        /* Hlavička sloupce */
        .osoby-col-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            height: 44px;
            background: #004289;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            box-sizing: border-box;
            flex-shrink: 0;
        }
        
        .osoby-col-header .material-icons-outlined {
            font-size: 18px;
        }
        
        .btn-overit-vse-sm {
            margin-left: auto;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #fff;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            color: #004289;
            cursor: pointer;
        }
        
        .btn-overit-vse-sm:hover {
            background: #e8f1fa;
        }
        
        .btn-overit-vse-sm .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Bloky pozemků */
        .pozemky-blok {
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }
        
        .pozemky-blok-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }
        
        .pozemky-blok-header.zamer {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .pozemky-blok-header.soused {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .pozemky-blok-count {
            background: rgba(0,0,0,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
        }
        
        .pozemky-blok-list {
            overflow-y: auto;
        }
        
        .pozemek-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            font-size: 12px;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .pozemek-item:hover {
            background: #fff;
        }
        
        .pozemek-item .pozemek-parcela {
            font-weight: 600;
            min-width: 50px;
            color: #202124;
        }
        
        .pozemek-item .pozemek-ku {
            color: #9aa0a6;
            font-size: 10px;
            min-width: 55px;
        }
        
        .pozemek-item .pozemek-vlastnik {
            flex: 1;
            color: #5f6368;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 11px;
        }
        
        .pozemek-item .pozemek-vlastnik.verified {
            color: #137333;
        }
        
        .pozemek-item .pozemek-status {
            width: 18px;
        }
        
        .pozemek-item .pozemek-status .material-icons-outlined {
            font-size: 16px;
        }
        
        .pozemek-item .pozemek-status.pending {
            color: #f9ab00;
        }
        
        .pozemek-item .pozemek-status.ok {
            color: #137333;
        }
        
        .btn-overit-sm {
            padding: 2px 8px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
        }
        
        .btn-overit-sm:hover {
            border-color: #004289;
            color: #004289;
        }
        
        .btn-overit-sm.done {
            background: #e6f4ea;
            border-color: #137333;
            color: #137333;
            pointer-events: none;
        }
        
        /* Pozemek - rozšířený stav po ověření */
        .pozemek-item.verified {
            flex-wrap: wrap;
            padding-bottom: 8px;
        }
        
        .pozemek-item .pozemek-info-row {
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
            margin-top: 4px;
            padding-left: 0;
        }
        
        .pozemek-overeno-datum {
            font-size: 9px;
            color: #9aa0a6;
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        /* LV tlačítko a dropdown */
        .btn-lv-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .btn-lv {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 6px;
            background: #fff;
            border: 1px solid #1a73e8;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
            color: #1a73e8;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .btn-lv:hover {
            background: #e8f1fa;
        }
        
        .btn-lv .material-icons-outlined {
            font-size: 12px;
        }
        
        .lv-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 2px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            min-width: 150px;
        }
        
        .lv-dropdown.show {
            display: block;
        }
        
        .lv-dropdown-item {
            display: block;
            width: 100%;
            padding: 8px 12px;
            text-align: left;
            background: none;
            border: none;
            font-size: 11px;
            color: #202124;
            cursor: pointer;
        }
        
        .lv-dropdown-item:hover {
            background: #f1f3f4;
        }
        
        .lv-dropdown-item .lv-item-title {
            font-weight: 500;
        }
        
        .lv-dropdown-item .lv-item-desc {
            font-size: 10px;
            color: #5f6368;
            margin-top: 2px;
        }
        
        /* Tabs v hlavičce účastníků */
        .osoby-tabs-inline {
            display: flex;
            gap: 4px;
        }
        
        .osoby-tab-btn {
            padding: 4px 10px;
            background: rgba(255,255,255,0.15);
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .osoby-tab-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .osoby-tab-btn.active {
            background: #fff;
            color: #004289;
        }
        
        .osoby-tab-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: rgba(0,0,0,0.15);
            border-radius: 9px;
            font-size: 10px;
            margin-left: 4px;
        }
        
        .osoby-tab-btn.active .osoby-tab-count {
            background: #e8f1fa;
            color: #004289;
        }
        
        .btn-add-osoba {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #fff;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            color: #004289;
            cursor: pointer;
        }
        
        .btn-add-osoba:hover {
            background: #e8f1fa;
        }
        
        .btn-add-osoba .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Hlavička - akce */
        .osoby-header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        
        .btn-overit-osoby {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
        }
        
        .btn-overit-osoby:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .btn-overit-osoby .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Tlačítko ověřit osobu */
        .btn-overit-osobu {
            padding: 4px;
            background: #fff3e0;
            border: none;
            border-radius: 4px;
            color: #e65100;
            cursor: pointer;
        }
        
        .btn-overit-osobu:hover {
            background: #ffe0b2;
        }
        
        .btn-overit-osobu .material-icons-outlined {
            font-size: 18px;
        }
        
        /* Status ověření */
        .os-status.pending {
            color: #f9ab00;
        }
        
        /* Adresa neověřeno */
        .os-adresa-neovereno {
            color: #9aa0a6;
            font-style: italic;
        }
        
        /* DS info */
        .os-ds-info {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
            padding: 2px 6px;
            background: #e3f2fd;
            border-radius: 3px;
            font-size: 10px;
            color: #1565c0;
        }
        
        .os-ds-info .material-icons-outlined {
            font-size: 12px;
        }
        
        /* Info o pozemcích u vlastníka */
        .os-pozemky {
            display: inline-block;
            padding: 2px 6px;
            background: #f3e5f5;
            border-radius: 3px;
            font-size: 11px;
            color: #7b1fa2;
            margin-left: 4px;
        }
        
        /* Info o zastoupení */
        .os-zastoupen-info {
            display: block;
            margin-top: 4px;
            padding: 3px 8px;
            background: #e3f2fd;
            border-radius: 4px;
            font-size: 11px;
            color: #1565c0;
        }
        
        .os-zastoupen-info .material-icons-outlined {
            font-size: 14px;
            vertical-align: middle;
            margin-right: 4px;
        }
        
        /* Tlačítko doručování */
        .btn-dorucovani {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            overflow: hidden;
        }
        
        .btn-dorucovani .material-icons-outlined {
            font-size: 18px;
            line-height: 1;
        }
        
        .btn-dorucovani.ds {
            background: #e3f2fd;
            border-color: #64b5f6;
            color: #1565c0;
        }
        
        .btn-dorucovani.ds:hover {
            background: #bbdefb;
        }
        
        .btn-dorucovani.posta {
            background: #fff3e0;
            border-color: #ffb74d;
            color: #ef6c00;
        }
        
        .btn-dorucovani.posta:hover {
            background: #ffe0b2;
        }
        
        .btn-dorucovani.nedorucovat {
            background: #ffebee;
            border-color: #ef9a9a;
            color: #c62828;
            position: relative;
        }
        
        .btn-dorucovani.nedorucovat:hover {
            background: #ffcdd2;
        }
        
        .doruc-ceka {
            color: #9aa0a6;
            font-size: 12px;
        }
        
        /* Loading / rotating icon */
        .os-status.loading {
            color: #5f6368;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .rotating {
            animation: rotate 1s linear infinite;
        }
        
        /* Panely tabů */
        .osoby-tab-panel {
            display: none;
            flex: 1;
            overflow-y: auto;
        }
        
        .osoby-tab-panel.active {
            display: block;
        }
        
        .osoby-empty-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #9aa0a6;
        }
        
        .osoby-empty-panel .material-icons-outlined {
            font-size: 48px;
            margin-bottom: 12px;
        }
        
        .osoby-empty-panel p {
            margin-bottom: 16px;
        }
        
        /* Tabulka účastníků */
        .osoby-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .osoby-table thead {
            background: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        
        .osoby-table th {
            padding: 8px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #5f6368;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .osoby-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: middle;
        }
        
        .osoby-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        /* Kategorie řádek */
        .osoby-kategorie-row td {
            padding: 6px 10px !important;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .kategorie-label {
            font-weight: 600;
            font-size: 11px;
            color: #202124;
        }
        
        .btn-nacist-vti {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 12px;
            padding: 3px 10px;
            background: #fff;
            color: #1a73e8;
            border: 1px solid #1a73e8;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-nacist-vti:hover {
            background: #e8f0fe;
        }
        
        .btn-nacist-vti .material-icons-outlined {
            font-size: 14px;
        }
        
        .kategorie-stav {
            margin-left: 8px;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .kategorie-stav.ceka {
            background: #fff3e0;
            color: #e65100;
        }
        
        .kategorie-stav.ok {
            background: #e6f4ea;
            color: #137333;
        }
        
        /* Prázdný řádek */
        .osoby-empty-row td {
            color: #9aa0a6;
            font-style: italic;
            padding: 12px 10px !important;
        }
        
        /* Status ikona */
        .os-status {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
        }
        
        .os-status .material-icons-outlined {
            font-size: 18px;
        }
        
        .os-status.ok {
            color: #137333;
        }
        
        .os-status.pending {
            color: #f9ab00;
        }
        
        .os-status.vecne {
            color: #7b1fa2;
        }
        
        /* Zdroj badge */
        .os-zdroj {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .os-zdroj.zdroj-zadost {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .os-zdroj.zdroj-ku {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .os-zdroj.zdroj-kn {
            background: #e6f4ea;
            color: #137333;
        }
        
        .os-zdroj.vti {
            background: #fff3e0;
            color: #e65100;
        }
        
        .os-zdroj.vdi {
            background: #fce4ec;
            color: #c2185b;
        }
        
        /* Role badge */
        .os-role {
            display: inline-block;
            padding: 2px 8px;
            background: #fff3e0;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
            color: #e65100;
        }
        
        /* Akce tlačítka */
        .os-actions {
            white-space: nowrap;
        }
        
        .os-actions button {
            padding: 4px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
        }
        
        .os-actions button:hover {
            background: #e8eaed;
            color: #202124;
        }
        
        .os-actions button.is-favorited {
            color: #f9ab00;
        }
        
        .os-actions button .material-icons-outlined {
            font-size: 18px;
        }
        
        .text-muted {
            color: #9aa0a6;
        }
        
        .text-center {
            text-align: center;
        }

        /* ==========================================
           ZÁSTUPCI - TOOLBAR A FORMULÁŘ
           ========================================== */
        .zastupci-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .zastupci-toolbar-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .zastupci-toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .zastupci-info {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
        }
        
        .zastupci-info .material-icons-outlined {
            font-size: 16px;
            color: #1a73e8;
        }
        
        .btn-outline {
            background: #fff;
            border: 1px solid #dadce0;
            color: #5f6368;
        }
        
        .btn-outline:hover {
            background: #f8f9fa;
            border-color: #bdc1c6;
        }
        
        /* Doručování toggle */
        .dorucovat-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .dorucovat-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .dorucovat-label {
            font-size: 11px;
            color: #5f6368;
        }
        
        .dorucovat-label.yes {
            color: #137333;
        }
        
        .dorucovat-label.no {
            color: #c5221f;
        }
        
        /* Zastupuje badge */
        .zastupuje-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            background: #e8f1fa;
            border-radius: 4px;
            font-size: 11px;
            color: #1565c0;
            margin-right: 4px;
            margin-bottom: 4px;
        }
        
        .zastupuje-badge .material-icons-outlined {
            font-size: 12px;
        }
        
        .zastupuje-cell {
            max-width: 250px;
        }
        
        /* Modal formulář sekce */
        .form-section {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e8eaed;
        }
        
        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .form-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 12px;
        }
        
        .form-row {
            margin-bottom: 12px;
        }
        
        .form-row-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-row-3col {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-row-ico {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            margin-bottom: 8px;
        }
        
        .btn-verify-ico {
            height: 36px;
            white-space: nowrap;
        }
        
        .form-verify-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .verify-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }
        
        .verify-status.loading {
            color: #5f6368;
        }
        
        .verify-status.success {
            color: #137333;
        }
        
        .verify-status.error {
            color: #c5221f;
        }
        
        .verify-status .material-icons-outlined {
            font-size: 16px;
        }
        
        .form-input[readonly] {
            background: #f8f9fa;
            color: #5f6368;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            margin-bottom: 4px;
        }
        
        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 13px;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .form-radio-group {
            display: flex;
            gap: 16px;
        }
        
        .form-radio {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            cursor: pointer;
        }
        
        .form-radio input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            cursor: pointer;
        }
        
        .form-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .form-hint {
            font-size: 11px;
            color: #5f6368;
            margin: 0;
        }
        
        /* Zastupovaní list */
        .zastupovani-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .zastupovani-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            transition: background 0.1s;
        }
        
        .zastupovani-item:last-child {
            border-bottom: none;
        }
        
        .zastupovani-item:hover {
            background: #f8f9fa;
        }
        
        .zastupovani-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .zastupovani-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .zastupovani-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }
        
        .zastupovani-role {
            font-size: 11px;
            color: #5f6368;
        }

        .btn-save-draft {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background: #fff;
            color: #5f6368;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
        }

        .btn-save-draft:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-save-draft .material-icons-outlined {
            font-size: 18px;
        }

        .control-section {
            margin-bottom: 24px;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .control-section-title {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 12px !important;
            font-style: normal !important;
        }

        .control-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .control-option:last-child {
            margin-bottom: 0;
        }

        .control-option:hover {
            background: #f0f0f0;
            border-color: #dadce0;
        }

        .control-option.selected {
            background: #e8f1fa;
            border-color: #004289;
        }

        .control-option.selected.negative {
            background: #fce8e6;
            border-color: #f5c6c3;
        }

        .control-option input[type="radio"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            accent-color: #004289;
            flex-shrink: 0;
        }

        .control-option-content {
            flex: 1;
        }

        .control-option-label {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .control-option-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px !important;
            font-style: normal !important;
        }

        .control-option.selected.negative .control-option-label {
            color: #a50e0e !important;
        }

        /* Result preview box */
        .result-preview {
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .result-preview.positive {
            background: #e6f4ea;
            border: 1px solid #ceead6;
        }

        .result-preview.negative {
            background: #fce8e6;
            border: 1px solid #f5c6c3;
        }

        .result-preview.warning {
            background: #fef7e0;
            border: 1px solid #f5e6b3;
        }

        .result-preview.neutral {
            background: #f1f3f4;
            border: 1px solid #dadce0;
        }

        .result-preview-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .result-preview.positive .result-preview-title {
            color: #137333 !important;
        }

        .result-preview.negative .result-preview-title {
            color: #a50e0e !important;
        }

        .result-preview.warning .result-preview-title {
            color: #b06000 !important;
        }

        .result-preview.neutral .result-preview-title {
            color: #5f6368 !important;
        }

        .result-preview-title .material-icons-outlined {
            font-size: 20px;
        }

        .result-preview-text {
            font-size: 13px !important;
            font-style: normal !important;
        }

        .result-preview.positive .result-preview-text {
            color: #137333 !important;
        }

        .result-preview.negative .result-preview-text {
            color: #a50e0e !important;
        }

        .result-preview.warning .result-preview-text {
            color: #7a4200 !important;
        }

        .result-preview.neutral .result-preview-text {
            color: #5f6368 !important;
        }

        /* Info box */
        .info-box {
            display: flex;
            gap: 12px;
            padding: 16px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
        }

        .info-box.warning {
            background: #fef7e0;
            border-color: #f9ab00;
        }

        .info-box.error {
            background: #fce8e6;
            border-color: #ea4335;
        }

        .info-box-icon {
            flex-shrink: 0;
        }

        .info-box-icon .material-icons-outlined {
            font-size: 24px;
            color: #f9ab00;
        }

        .info-box.error .info-box-icon .material-icons-outlined {
            color: #ea4335;
        }

        .info-box-content {
            flex: 1;
        }

        .info-box-title {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 4px;
        }

        .info-box-text {
            font-size: 13px;
            color: #5f6368;
            line-height: 1.5;
        }

        .info-box-text ul {
            margin: 8px 0 0 0;
            padding-left: 20px;
        }

        .info-box-text li {
            margin-bottom: 4px;
        }

        /* Checklist items */
        .checklist-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .checklist-item:hover {
            background: #f0f0f0;
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #004289;
            flex-shrink: 0;
        }

        .checklist-item-content {
            flex: 1;
            min-width: 0;
        }

        .checklist-item-title {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .checklist-item-desc {
            font-size: 12px;
            color: #5f6368;
            margin-top: 2px;
        }

        .checklist-item-badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .checklist-item-badge.ok {
            background: #e6f4ea;
            color: #137333;
        }

        .checklist-item-badge.neutral {
            background: #f1f3f4;
            color: #5f6368;
        }

        .checklist-item-badge.warning {
            background: #fef7e0;
            color: #7a4200;
        }

        /* Data card komponenty pro zobrazení načtených dat */
        .data-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .data-row {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #f1f3f4;
            gap: 12px;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-row.empty {
            background: #fafafa;
        }

        .data-row.error {
            background: #fce8e6;
        }

        .data-label {
            width: 180px;
            flex-shrink: 0;
            font-size: 12px;
            color: #5f6368;
            font-weight: 500;
        }

        .data-value {
            flex: 1;
            font-size: 13px;
            color: #202124;
        }

        .data-value.muted {
            color: #9aa0a6;
            font-style: italic;
        }

        .data-value .data-link {
            color: #1a73e8;
            cursor: pointer;
        }

        .data-value .data-link:hover {
            text-decoration: underline;
        }

        .data-status {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .data-status.ok {
            background: #e6f4ea;
            color: #137333;
        }

        .data-status.ok:hover {
            background: #ceead6;
        }

        .data-status.error {
            background: #fce8e6;
            color: #c5221f;
        }

        .data-status.error:hover {
            background: #f5c6c2;
        }

        .data-status.na {
            background: #f1f3f4;
            color: #9aa0a6;
            cursor: default;
        }

        .data-status .material-icons-outlined {
            font-size: 18px;
        }

        .deficiency-note-section {
            margin-top: 16px;
            padding: 16px;
            background: #fef7e0;
            border: 1px solid #f9ab00;
            border-radius: 8px;
        }

        .deficiency-note-section .control-section-title {
            margin-bottom: 12px;
        }

        .deficiency-note-input {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
        }

        .deficiency-note-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .checklist-label {
            flex: 1;
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .checklist-note {
            font-size: 12px !important;
            color: #9aa0a6 !important;
            font-style: italic !important;
        }

        .checklist-item:has(input:not(:checked)) {
            opacity: 0.6;
        }

        /* ==========================================
           IDENTIFIKACE DO/TDI - Porovnávací matice
           ========================================== */
        .identifikace-ai-section {
            background: linear-gradient(135deg, #f0e6ff 0%, #e6f0ff 100%);
            border: 1px solid #d4c4f0;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .identifikace-ai-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .identifikace-ai-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #5b21b6;
        }

        .identifikace-ai-title .material-icons-outlined {
            font-size: 18px;
            color: #7c3aed;
        }

        .btn-ai-analyze {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-ai-analyze:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .btn-ai-analyze:disabled {
            background: #d4c4f0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-ai-analyze .material-icons-outlined {
            font-size: 16px;
        }

        .identifikace-ai-status {
            font-size: 12px;
            color: #5f6368;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .identifikace-ai-status.done {
            color: #137333;
        }

        .identifikace-ai-status .material-icons-outlined {
            font-size: 16px;
        }

        /* Porovnávací matice */
        .subjekty-matrix {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .matrix-header {
            display: grid;
            grid-template-columns: 2fr 80px 80px 90px;
            gap: 8px;
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            font-size: 11px;
            font-weight: 600;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .matrix-header-cell {
            text-align: center;
        }

        .matrix-header-cell:first-child {
            text-align: left;
        }

        .matrix-group {
            border-bottom: 1px solid #e0e0e0;
        }

        .matrix-group:last-child {
            border-bottom: none;
        }

        .matrix-group-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #f8f9fa;
            font-size: 12px;
            font-weight: 600;
            color: #202124;
            cursor: pointer;
        }

        .matrix-group-header .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }

        .matrix-group-header .group-count {
            margin-left: auto;
            padding: 2px 8px;
            background: #e8eaed;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
            color: #5f6368;
        }

        .matrix-row {
            display: grid;
            grid-template-columns: 2fr 80px 80px 90px;
            gap: 8px;
            padding: 10px 16px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            transition: background 0.15s;
        }

        .matrix-row:last-child {
            border-bottom: none;
        }

        .matrix-row:hover {
            background: #f8f9fa;
        }

        .matrix-row.status-ok {
            background: #f0faf3;
        }

        .matrix-row.status-missing {
            background: #fef7e0;
        }

        .matrix-row.status-extra {
            background: #e8f4fd;
        }

        .matrix-row.status-not-required {
            opacity: 0.6;
        }

        .matrix-subjekt {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .matrix-subjekt-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .matrix-subjekt-detail {
            font-size: 11px;
            color: #5f6368;
        }

        .matrix-cell {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-check {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-check .material-icons-outlined {
            font-size: 16px;
        }

        .matrix-check.yes {
            background: #e6f4ea;
            color: #137333;
        }

        .matrix-check.no {
            background: #f5f5f5;
            color: #9aa0a6;
        }

        .matrix-check.missing {
            background: #fce8e6;
            color: #c5221f;
        }

        .matrix-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #004289;
        }

        .matrix-docs-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            color: #1a73e8;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-docs-btn:hover {
            background: #e8f1fa;
        }

        .matrix-docs-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Přidat subjekt */
        .matrix-add-row {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }

        .matrix-add-select {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            background: #fff;
            outline: none;
        }

        .matrix-add-select:focus {
            border-color: #1a73e8;
        }

        .matrix-add-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            outline: none;
        }

        .matrix-add-input:focus {
            border-color: #1a73e8;
        }

        .btn-add-subjekt {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-add-subjekt:hover {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .btn-add-subjekt .material-icons-outlined {
            font-size: 16px;
        }

        /* Výsledek kontroly */
        .identifikace-result {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .identifikace-result-title {
            font-size: 12px;
            font-weight: 600;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 12px;
        }

        .identifikace-result-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .identifikace-result-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .identifikace-result-item .material-icons-outlined {
            font-size: 18px;
        }

        .identifikace-result-item.ok {
            color: #137333;
        }

        .identifikace-result-item.warning {
            color: #b06000;
        }

        .identifikace-result-item.info {
            color: #004289;
        }

        .identifikace-result-item .count {
            font-weight: 600;
        }

        .identifikace-result-item .detail {
            font-size: 12px;
            color: #5f6368;
            margin-left: 4px;
        }

        /* Tooltip pro dokumenty */
        .docs-tooltip {
            position: absolute;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 12px;
            z-index: 100;
            max-width: 280px;
            font-size: 12px;
        }

        .docs-tooltip-title {
            font-weight: 600;
            color: #202124;
            margin-bottom: 8px;
        }

        .docs-tooltip-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 0;
            color: #5f6368;
        }

        .docs-tooltip-item .material-icons-outlined {
            font-size: 16px;
            color: #c62828;
        }

        /* Rozšířená matice - 5 sloupců */
        .matrix-header.extended {
            grid-template-columns: 2fr 70px 70px 100px 80px;
        }

        .matrix-row.extended {
            grid-template-columns: 2fr 70px 70px 100px 80px;
        }

        /* Výsledek dropdown */
        .matrix-vysledek-select {
            padding: 4px 8px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 11px;
            background: #fff;
            cursor: pointer;
            min-width: 90px;
        }

        .matrix-vysledek-select:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .matrix-vysledek-select.kladne {
            background: #e6f4ea;
            border-color: #ceead6;
            color: #137333;
        }

        .matrix-vysledek-select.s-podminkami {
            background: #e8f1fa;
            border-color: #c2d9f2;
            color: #004289;
        }

        .matrix-vysledek-select.zaporne {
            background: #fce8e6;
            border-color: #f5c6c3;
            color: #c5221f;
        }

        /* Tlačítko podmínky */
        .btn-podminky {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            padding: 4px 8px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            background: #fff;
            font-size: 11px;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-podminky:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-podminky.has-podminky {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .btn-podminky .material-icons-outlined {
            font-size: 14px;
        }

        .btn-podminky .podminky-count {
            font-weight: 600;
        }

        /* Modal pro podmínky */
        .podminky-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .podminky-modal-overlay.open {
            display: flex;
        }

        .podminky-modal {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            width: 700px;
            max-width: 95%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .podminky-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .podminky-modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #202124;
        }

        .podminky-modal-title .material-icons-outlined {
            font-size: 24px;
            color: #004289;
        }

        .podminky-modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .podminky-modal-close:hover {
            background: #e8eaed;
        }

        .podminky-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .podminky-modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 0 0 12px 12px;
        }

        /* Sekce v modalu */
        .podminky-section {
            margin-bottom: 20px;
        }

        .podminky-section:last-child {
            margin-bottom: 0;
        }

        .podminky-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 12px;
        }

        /* Info o dokumentu */
        .dokument-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .dokument-info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dokument-info-label {
            font-size: 11px;
            color: #5f6368;
            text-transform: uppercase;
        }

        .dokument-info-value {
            font-size: 13px;
            color: #202124;
        }

        .dokument-info-value input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 13px;
        }

        .dokument-info-value input:focus {
            outline: none;
            border-color: #1a73e8;
        }

        /* Výsledek v modalu */
        .vysledek-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .vysledek-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            flex: 1;
            min-width: 150px;
        }

        .vysledek-option:hover {
            border-color: #9aa0a6;
        }

        .vysledek-option.selected {
            border-color: #004289;
            background: #e8f1fa;
        }

        .vysledek-option.kladne.selected {
            border-color: #137333;
            background: #e6f4ea;
        }

        .vysledek-option.zaporne.selected {
            border-color: #c5221f;
            background: #fce8e6;
        }

        .vysledek-option input {
            display: none;
        }

        .vysledek-option-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vysledek-option-icon .material-icons-outlined {
            font-size: 16px;
        }

        .vysledek-option.kladne .vysledek-option-icon {
            background: #e6f4ea;
            color: #137333;
        }

        .vysledek-option.s-podminkami .vysledek-option-icon {
            background: #e8f1fa;
            color: #004289;
        }

        .vysledek-option.zaporne .vysledek-option-icon {
            background: #fce8e6;
            color: #c5221f;
        }

        .vysledek-option-label {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        /* Seznam podmínek */
        .podminky-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .podminka-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .podminka-item.inactive {
            opacity: 0.5;
            background: #f5f5f5;
        }

        .podminka-checkbox {
            margin-top: 2px;
        }

        .podminka-text {
            flex: 1;
            font-size: 13px;
            color: #202124;
            line-height: 1.5;
        }

        .podminka-text textarea {
            width: 100%;
            min-height: 60px;
            padding: 8px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
        }

        .podminka-text textarea:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .podminka-remove {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: #9aa0a6;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .podminka-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }

        .podminka-remove .material-icons-outlined {
            font-size: 18px;
        }

        /* Přidat podmínku */
        .add-podminka-row {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .add-podminka-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
        }

        .add-podminka-input:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .btn-add-podminka {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 10px 16px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
        }

        .btn-add-podminka:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-add-podminka .material-icons-outlined {
            font-size: 18px;
        }

        /* Poznámka úředníka */
        .poznamka-textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
        }

        .poznamka-textarea:focus {
            outline: none;
            border-color: #1a73e8;
        }

        /* Souhrn pro rozhodnutí */
        .souhrn-rozhodnuti {
            margin-top: 20px;
            padding: 16px;
            background: #f0f7ff;
            border: 1px solid #c2d9f2;
            border-radius: 10px;
        }

        .souhrn-rozhodnuti-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .souhrn-rozhodnuti-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #004289;
        }

        .souhrn-rozhodnuti-title .material-icons-outlined {
            font-size: 20px;
        }

        .btn-report {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #004289;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            transition: background 0.15s;
        }

        .btn-report:hover {
            background: #003066;
        }

        .btn-report .material-icons-outlined {
            font-size: 18px;
        }

        .souhrn-rozhodnuti-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .souhrn-rozhodnuti-actions .btn-report {
            padding: 6px 12px;
            font-size: 12px;
            background: #fff;
            color: #004289;
            border: 1px solid #004289;
        }

        .souhrn-rozhodnuti-actions .btn-report:hover {
            background: #e8f1fa;
        }

        .souhrn-rozhodnuti-actions .btn-report .material-icons-outlined {
            font-size: 16px;
        }

        .souhrn-stats {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        /* Report modal */
        .report-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .report-modal-overlay.open {
            display: flex;
        }

        .report-modal {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            width: 900px;
            max-width: 95%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .report-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .report-modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #202124;
        }

        .report-modal-title .material-icons-outlined {
            font-size: 24px;
            color: #004289;
        }

        .report-modal-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .report-modal-close:hover {
            background: #e8eaed;
        }

        .report-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .btn-download {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-download:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-download .material-icons-outlined {
            font-size: 18px;
        }

        /* Report content styles */
        .report-content {
            font-family: 'Segoe UI', Roboto, sans-serif;
            font-size: 13px;
            line-height: 1.6;
            color: #202124;
        }

        .report-header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #004289;
        }

        .report-header h1 {
            font-size: 18px;
            font-weight: 600;
            color: #004289;
            margin: 0 0 8px 0;
        }

        .report-header .report-meta {
            font-size: 12px;
            color: #5f6368;
        }

        .report-section {
            margin-bottom: 24px;
        }

        .report-section h2 {
            font-size: 14px;
            font-weight: 600;
            color: #202124;
            margin: 0 0 12px 0;
            padding-bottom: 6px;
            border-bottom: 1px solid #e0e0e0;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 12px;
        }

        .report-table th,
        .report-table td {
            padding: 8px 10px;
            text-align: left;
            border: 1px solid #e0e0e0;
            font-size: 12px;
        }

        .report-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #5f6368;
        }

        .report-table tr:nth-child(even) {
            background: #fafafa;
        }

        .report-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .report-status.kladne {
            background: #e6f4ea;
            color: #137333;
        }

        .report-status.s-podminkami {
            background: #e8f1fa;
            color: #004289;
        }

        .report-status.zaporne {
            background: #fce8e6;
            color: #c5221f;
        }

        .report-status.chybi {
            background: #fff3e0;
            color: #e65100;
        }

        .report-podminky-list {
            margin: 0;
            padding-left: 20px;
        }

        .report-podminky-list li {
            margin-bottom: 4px;
        }

        .report-subjekt-block {
            margin-bottom: 16px;
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .report-subjekt-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .report-subjekt-name {
            font-weight: 600;
            color: #202124;
        }

        .report-subjekt-meta {
            font-size: 11px;
            color: #5f6368;
            margin-bottom: 8px;
        }

        .report-no-podminky {
            font-style: italic;
            color: #9aa0a6;
            font-size: 12px;
        }

        .report-podminka-skupina {
            margin-bottom: 16px;
            padding: 12px 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .report-podminka-subjekt {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .report-podminka-subjekt strong {
            color: #202124;
        }

        .report-podminka-subjekt span {
            margin-left: 12px;
            color: #5f6368;
            font-size: 12px;
        }

        .report-podminka-list {
            margin: 0;
            padding-left: 24px;
        }

        .report-podminka-list li {
            margin-bottom: 6px;
            line-height: 1.5;
        }

        .report-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #004289;
            margin: 0 0 8px 0;
        }

        .report-header h3 {
            color: #202124;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
            margin-top: 24px;
            font-size: 14px;
        }

        .report-section h3 {
            color: #202124;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
            margin: 0 0 12px 0;
            font-size: 14px;
        }

        .souhrn-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .souhrn-stat .material-icons-outlined {
            font-size: 18px;
        }

        .souhrn-stat.ok {
            color: #137333;
        }

        .souhrn-stat.podminky {
            color: #004289;
        }

        .souhrn-stat.warning {
            color: #b06000;
        }

        .souhrn-stat.error {
            color: #c5221f;
        }

        /* AI Control Section */
        .ai-control-section {
            background: linear-gradient(135deg, #f0e6ff 0%, #e6f0ff 100%);
            border: 1px solid #d4c4f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-control-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .ai-control-header .material-icons-outlined {
            font-size: 20px;
            color: #7c3aed;
        }

        .btn-ai {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            cursor: pointer;
            transition: all 0.2s;
            font-style: normal !important;
        }

        .btn-ai:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .btn-ai:disabled {
            background: #d4c4f0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-ai .material-icons-outlined {
            font-size: 18px;
        }

        /* AI Result Section */
        .ai-result-section {
            background: #f8f5ff;
            border: 1px solid #e4d9f5;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-result-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            margin-bottom: 16px;
            font-style: normal !important;
        }

        .ai-result-header .material-icons-outlined {
            font-size: 20px;
            color: #7c3aed;
        }

        .ai-result-badge {
            margin-left: auto;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .ai-result-badge.success {
            background: #dcfce7;
            color: #166534;
        }

        .ai-result-badge.loading {
            background: #fef3c7;
            color: #92400e;
        }

        .ai-report-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: #fff;
            border: 1px solid #e4d9f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 16px;
        }

        .ai-report-link:hover {
            background: #f5f0ff;
            border-color: #c4b5fd;
        }

        .ai-report-link .material-icons-outlined:first-child {
            font-size: 24px;
            color: #7c3aed;
        }

        .ai-report-link-content {
            flex: 1;
        }

        .ai-report-link-title {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .ai-report-link-meta {
            font-size: 12px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .ai-report-link .material-icons-outlined:last-child {
            font-size: 18px;
            color: #9aa0a6;
        }

        .ai-summary {
            display: flex;
            gap: 16px;
        }

        .ai-summary-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px !important;
            font-style: normal !important;
        }

        .ai-summary-item .material-icons-outlined {
            font-size: 18px;
        }

        .ai-summary-item.success {
            color: #166534 !important;
        }

        .ai-summary-item.warning {
            color: #92400e !important;
        }

        .ai-summary-item.error {
            color: #991b1b !important;
        }

        /* AI Report Detail */
        .ai-report-detail {
            background: #fff;
            border: 1px solid #e4d9f5;
            border-radius: 12px;
            margin-bottom: 24px;
            max-height: 400px;
            overflow-y: auto;
        }

        .ai-report-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e4d9f5;
            background: #f8f5ff;
            border-radius: 12px 12px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .ai-report-detail-title {
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            font-style: normal !important;
        }

        .ai-report-close {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-report-close:hover {
            background: #e4d9f5;
        }

        .ai-report-content {
            padding: 16px 20px;
        }

        .ai-report-group {
            margin-bottom: 20px;
        }

        .ai-report-group:last-child {
            margin-bottom: 0;
        }

        .ai-report-group-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 600 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .ai-report-group-title .material-icons-outlined {
            font-size: 18px;
        }

        .ai-report-group-title.success {
            color: #166534 !important;
        }

        .ai-report-group-title.warning {
            color: #92400e !important;
        }

        .ai-report-group-title.error {
            color: #991b1b !important;
        }

        .ai-report-item {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 14px 16px;
            margin-bottom: 8px;
        }

        .ai-report-item:last-child {
            margin-bottom: 0;
        }

        .ai-report-item-title {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .ai-report-item-result {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        .ai-report-item-result.success {
            background: #dcfce7;
            color: #166534;
        }

        .ai-report-item-result.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .ai-report-item-result.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .ai-report-item-detail {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
        }

        .ai-report-source {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px !important;
            font-style: normal !important;
        }

        .source-label {
            color: #5f6368 !important;
            flex-shrink: 0;
        }

        .source-path {
            color: #1a73e8 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-size: 11px !important;
        }

        .ai-report-note {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 8px;
            padding: 8px 12px;
            background: #e8f5e9;
            border-radius: 6px;
            font-style: normal !important;
        }

        .ai-report-note.warning {
            background: #fff8e1;
            color: #795548 !important;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .ai-report-note.warning .material-icons-outlined {
            font-size: 16px;
            color: #f57c00;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .ai-report-item.collapsed .ai-report-item-detail {
            display: none;
        }

        .ai-report-item.collapsed {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ai-report-item.collapsed .ai-report-item-title {
            margin-bottom: 0;
        }

        .ai-report-item.collapsed .ai-report-item-result {
            margin-top: 0;
        }

        /* Loading animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .btn-ai.loading {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            to {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
        }
        
        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        @keyframes toastOut {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            to {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
        }

        /* Modal styles - pro pomocné modály */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal,
        .modal-dialog {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            max-width: 560px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal.modal-large {
            max-width: 900px;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .modal-title {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .modal-title .material-icons-outlined {
            font-size: 24px !important;
            color: #004289 !important;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f1f3f4;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid #e0e0e0;
            background: #fafafa;
            flex-shrink: 0;
        }

        /* Form elements in modal */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 6px !important;
        }

        .form-select {
            width: 100% !important;
            padding: 10px 12px !important;
            border: 1px solid #dadce0 !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            color: #202124 !important;
            background: #fff !important;
        }

        .form-select:focus {
            outline: none;
            border-color: #004289;
        }

        .form-check-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-check {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
        }

        .form-check:hover {
            background: #f0f0f0;
        }

        .form-check input[type="radio"],
        .form-check input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            accent-color: #004289;
        }

        .form-check-content {
            flex: 1;
        }

        .form-check-label {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .form-check-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px !important;
            font-style: normal !important;
        }

        /* Result box */
        .result-box {
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .result-box.success {
            background: #e6f4ea;
            border: 1px solid #ceead6;
        }

        .result-box.warning {
            background: #fef7e0;
            border: 1px solid #f5e6b3;
        }

        .result-box.error {
            background: #fce8e6;
            border: 1px solid #f5c6c3;
        }

        .result-box-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .result-box.success .result-box-title {
            color: #137333;
        }

        .result-box.warning .result-box-title {
            color: #b06000;
        }

        .result-box.error .result-box-title {
            color: #c5221f;
        }

        .result-box-title .material-icons-outlined {
            font-size: 20px;
        }

        .result-box-text {
            font-size: 13px;
        }

        .result-box.success .result-box-text {
            color: #137333;
        }

        .result-box.warning .result-box-text {
            color: #7a4200;
        }

        .result-box.error .result-box-text {
            color: #a50e0e;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .control-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .case-header-main {
                padding: 12px 16px;
                flex-direction: column;
                align-items: flex-start;
            }

            .document-access-bar {
                padding: 10px 16px;
                flex-wrap: wrap;
            }

            .page-content {
                padding: 16px;
            }

            .control-grid {
                grid-template-columns: 1fr;
            }

            .summary-card {
                flex-direction: column;
                text-align: center;
            }

            .summary-actions {
                width: 100%;
            }

            .summary-actions .btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- ISSŘ Hlavička -->
    <header class="issr-header">
        <a href="../index.html" class="issr-header__logo">
            <img src="../images/logo-issr.png" alt="ISSŘ Logo" class="issr-header__logo-img">
            <span class="issr-header__title">INFORMAČNÍ SYSTÉM STAVEBNÍHO ŘÍZENÍ</span>
        </a>
        
        <div class="issr-header__search">
            <input type="text" class="issr-header__search-input" placeholder="Hledat">
        </div>
        
        <div class="issr-header__actions">
            <div class="issr-header__notification">
                <svg class="issr-header__notification-icon" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"></path>
                </svg>
                <span class="issr-header__notification-badge">2</span>
            </div>
            
            <div class="issr-header__user">
                <span>Aleš Krupa</span>
                <svg class="issr-header__user-icon" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"></path>
                </svg>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Case header -->
        <header class="case-header">
            <div class="case-header-main">
                <div class="case-header-left">
                    <a href="detail-dokumentu.html" class="btn-back" title="Zpět na detail dokumentu">
                        <span class="material-icons-outlined">arrow_back</span>
                    </a>
                    <div class="case-info">
                        <div class="case-number">R/2026/000147</div>
                        <h1 class="case-title" id="caseTitleHeader">Novostavba RD včetně přípojek</h1>
                        <div class="case-meta">
                            <span class="case-meta-item">
                                <span class="material-icons-outlined">gavel</span>
                                Povolení stavby
                            </span>
                            <span class="case-meta-item">
                                <span class="material-icons-outlined">home</span>
                                Jednoduchá stavba
                            </span>
                            <span class="case-badge draft">Kontrola</span>
                            <span class="case-badge fast">
                                <span class="material-icons-outlined" style="font-size: 14px;">bolt</span>
                                Zrychlené řízení
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Akční tlačítka -->
                <div class="case-header-actions">
                    <button class="header-action-btn" onclick="openSlideout('udajeRizeni')" title="Údaje řízení">
                        <span class="material-icons-outlined">assignment</span>
                        Údaje řízení
                    </button>
                    <button class="header-action-btn has-issues" onclick="openSlideout('prehledNedostatku')" id="btnNedostatky" title="Přehled nedostatků">
                        <span class="material-icons-outlined">warning_amber</span>
                        Nedostatky
                        <span class="header-action-badge warning" id="nedostatkyBadge">0</span>
                    </button>
                    <div class="action-dropdown">
                        <button class="header-action-btn" onclick="toggleActionDropdown()" id="btnAkceRizeni">
                            <span class="material-icons-outlined">more_vert</span>
                            Akce řízení
                            <span class="material-icons-outlined" style="font-size: 16px; margin-left: -2px;">expand_more</span>
                        </button>
                        <div class="action-dropdown-menu" id="akceRizeniDropdown">
                            <div class="action-dropdown-item" onclick="showActionModal('prerusit')">
                                <span class="material-icons-outlined">pause_circle</span>
                                Přerušit řízení
                            </div>
                            <div class="action-dropdown-item" onclick="showActionModal('postoupit')">
                                <span class="material-icons-outlined">send</span>
                                Postoupit řízení
                            </div>
                            <div class="action-dropdown-item" onclick="showActionModal('predat')">
                                <span class="material-icons-outlined">person_add</span>
                                Předat jinému referentovi
                            </div>
                            <div class="action-dropdown-item" onclick="showActionModal('spojit')">
                                <span class="material-icons-outlined">merge</span>
                                Spojit s jiným řízením
                            </div>
                            <div class="action-dropdown-divider"></div>
                            <div class="action-dropdown-item" onclick="showActionModal('historie')">
                                <span class="material-icons-outlined">history</span>
                                Historie řízení
                            </div>
                            <div class="action-dropdown-divider"></div>
                            <div class="action-dropdown-item danger" onclick="showActionModal('zastavit')">
                                <span class="material-icons-outlined">cancel</span>
                                Zastavit řízení (zpětvzetí)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Workflow stepper + document access -->
            <div class="workflow-bar" style="display: flex !important; align-items: center !important; justify-content: space-between !important; padding: 12px 32px !important; background: #f8f9fa !important; flex-wrap: nowrap !important;">
                <!-- Document access buttons - vlevo -->
                <div class="document-access-buttons" style="display: flex !important; gap: 8px !important; flex-wrap: nowrap !important;">
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('zadostModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">description</span>
                        Žádost
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('prilohyModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">attach_file</span>
                        Přílohy
                        <span class="badge" style="background: #e8f4fd !important; color: #004289 !important; padding: 2px 6px !important; border-radius: 10px !important; font-size: 10px !important; font-weight: 500 !important;">12</span>
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('eedModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">folder</span>
                        El. dokumentace
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('dokladyModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">fact_check</span>
                        Dokladová část
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('bimModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">view_in_ar</span>
                        BIM model
                    </a>
                </div>
                <!-- Workflow stepper - vpravo -->
                <div class="workflow-stepper" style="display: flex !important; align-items: center !important; gap: 8px !important; flex-wrap: nowrap !important;">
                    <div class="workflow-step active" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #004289 !important; border: 1px solid #004289 !important; color: #fff !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: rgba(255,255,255,0.2) !important; color: #fff !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">1</span>
                        <span style="font-weight: 400 !important;">Příprava řízení</span>
                    </div>
                    <div class="workflow-step-connector" style="width: 24px !important; height: 2px !important; min-width: 24px !important; background: #dadce0 !important; flex-shrink: 0 !important;"></div>
                    <div class="workflow-step" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #fff !important; border: 1px solid #e0e0e0 !important; color: #5f6368 !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: #e0e0e0 !important; color: #5f6368 !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">2</span>
                        <span style="font-weight: 400 !important;">Projednání</span>
                    </div>
                    <div class="workflow-step-connector" style="width: 24px !important; height: 2px !important; min-width: 24px !important; background: #dadce0 !important; flex-shrink: 0 !important;"></div>
                    <div class="workflow-step" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #fff !important; border: 1px solid #e0e0e0 !important; color: #5f6368 !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: #e0e0e0 !important; color: #5f6368 !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">3</span>
                        <span style="font-weight: 400 !important;">Rozhodnutí</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page content -->
        <div class="page-content">
            <!-- Info panel -->
            <div class="info-panel" id="infoPanel">
                <span class="material-icons-outlined">info</span>
                <div class="info-panel-content">
                    <div class="info-panel-title">Kontrola a příprava řízení</div>
                    <div class="info-panel-text">
                        V tomto kroku proveďte kontroly žádosti a definujte parametry řízení (účastníci, pozemky, dotčené orgány). 
                        Řízení je zahájeno dnem doručení bezvadné žádosti (7. 1. 2026), od tohoto data běží lhůta pro vydání rozhodnutí.
                    </div>
                </div>
            </div>

            <!-- Základní údaje řízení -->
            <div class="rizeni-header-card" style="background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 24px;">
                <div style="display: flex; align-items: flex-start; gap: 24px; flex-wrap: wrap;">
                    <!-- Název stavby - editovatelný -->
                    <div style="flex: 2; min-width: 300px;">
                        <label style="display: block; font-size: 12px; font-weight: 500; color: #5f6368; margin-bottom: 6px;">
                            Název stavby
                            <span style="font-weight: 400; color: #80868b;">(lze upravit)</span>
                        </label>
                        <input type="text" id="nazevStavby" value="Novostavba RD včetně přípojek" 
                            style="width: 100%; padding: 10px 12px; border: 1px solid #dadce0; border-radius: 6px; font-size: 14px; font-family: inherit; color: #202124; background: #fff;"
                            onchange="updateNazevStavby()">
                    </div>
                    <!-- Typ řízení - readonly -->
                    <div style="flex: 1; min-width: 200px;">
                        <label style="display: block; font-size: 12px; font-weight: 500; color: #5f6368; margin-bottom: 6px;">
                            Typ řízení
                            <span style="font-weight: 400; color: #80868b;">(dle žádosti)</span>
                        </label>
                        <div style="padding: 10px 12px; border: 1px solid #e8eaed; border-radius: 6px; font-size: 14px; color: #202124; background: #f8f9fa;">
                            Povolení stavby
                        </div>
                    </div>
                    <!-- Datum doručení -->
                    <div style="flex: 0 0 auto; min-width: 150px;">
                        <label style="display: block; font-size: 12px; font-weight: 500; color: #5f6368; margin-bottom: 6px;">
                            Datum doručení žádosti
                        </label>
                        <div style="padding: 10px 12px; border: 1px solid #e8eaed; border-radius: 6px; font-size: 14px; color: #202124; background: #f8f9fa;">
                            7. 1. 2026
                        </div>
                    </div>
                </div>
                
                <!-- Popis stavby - rozbalovací sekce -->
                <div class="popis-stavby-section" id="popisStavbySection" style="margin-top: 16px; border-top: 1px solid #e8eaed; padding-top: 12px;">
                    <!-- Sbalený stav - pouze titulek a ikona -->
                    <div class="popis-stavby-collapsed" id="popisStavbyCollapsed" style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="expandPopisStavby()">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #5f6368;">description</span>
                            <span style="font-size: 13px; font-weight: 500; color: #3c4043;">Popis stavby</span>
                            <span id="popisStatusBadge" class="popis-status-badge" style="display: none; font-size: 11px; padding: 2px 8px; border-radius: 10px; background: #e8f5e9; color: #137333;">Vyplněno</span>
                        </div>
                        <button class="popis-expand-btn" style="display: flex; align-items: center; gap: 4px; padding: 4px 10px; background: transparent; border: 1px solid #dadce0; border-radius: 4px; font-size: 12px; color: #1a73e8; cursor: pointer;" title="Rozbalit popis">
                            <span class="material-icons-outlined" style="font-size: 16px;">expand_more</span>
                        </button>
                    </div>
                    
                    <!-- Rozbalený editor -->
                    <div id="popisStavbyEditor" class="popis-editor" style="display: none; margin-top: 12px;">
                        <div class="popis-editor-hint" style="font-size: 11px; color: #5f6368; margin-bottom: 8px; line-height: 1.4;">
                            <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle; margin-right: 4px;">info</span>
                            Popis bude použit v úředních dokumentech (vyrozumění o zahájení řízení, oznámení účastníkům). 
                            Měl by obsahovat základní informace o stavbě srozumitelné i pro laiky.
                        </div>
                        <textarea id="popisStavbyTextarea" class="popis-textarea" rows="8" 
                            placeholder="Popište stavbu tak, aby účastníci řízení získali základní představu o záměru...">Předmětem řízení je novostavba rodinného domu o jednom nadzemním podlaží s obytným podkrovím na pozemku parc. č. 1234/5 v k.ú. Horní Lhota. Objekt bude napojen na veřejný vodovod, kanalizaci a elektrickou síť.

Stavba rodinného domu:
Dvoupodlažní objekt (1.NP + podkroví) s půdorysem ve tvaru obdélníka o rozměrech 12,0 × 9,5 m. Zastřešení sedlovou střechou se sklonem 35°. Fasáda bude provedena v kombinaci bílé omítky a dřevěného obkladu. V přízemí se nachází garáž pro jeden osobní automobil, technická místnost, zádveří a obývací pokoj s kuchyňským koutem. V podkroví jsou umístěny tři ložnice a koupelna.

Přípojky inženýrských sítí:
Vodovodní přípojka DN 32 v délce 8,5 m napojena na veřejný vodovod v ulici Pod Lipami.
Kanalizační přípojka DN 150 v délce 12,0 m napojena na veřejnou kanalizaci.
Elektrická přípojka napojena na distribuční síť ČEZ Distribuce.</textarea>
                        
                        <div class="popis-editor-actions" style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px; flex-wrap: wrap; gap: 12px;">
                            <button class="popis-ai-btn" onclick="loadPopisFromAI()" id="popisAiBtn">
                                <span class="material-icons-outlined">auto_awesome</span>
                                <span class="popis-ai-text">Načíst z dokumentace (AI)</span>
                                <span class="popis-ai-loading" style="display: none;">
                                    <span class="material-icons-outlined spinning">sync</span>
                                    Načítám z B. Souhrnná technická zpráva...
                                </span>
                            </button>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-secondary" onclick="cancelPopisStavby()">Zrušit</button>
                                <button class="btn btn-primary" onclick="savePopisStavby()">
                                    <span class="material-icons-outlined">check</span>
                                    Uložit popis
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section header -->
            <div class="section-header">
                <div class="section-title">
                    <span class="material-icons-outlined">checklist</span>
                    Kontrolní panel
                    <button class="section-customize-btn" onclick="openCustomizeControlsModal()" title="Upravit uspořádání kontrol">
                        <span class="material-icons-outlined">tune</span>
                    </button>
                </div>
                <div class="section-progress">
                    <span id="progressText">0 z 9 kontrol</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Control cards -->
            <div class="control-grid">
                <!-- 1. Příslušnost -->
                <div class="control-card status-ready" id="card-prislusnost">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">account_balance</span>
                        </div>
                        <span class="control-card-status">K provedení</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Příslušnost</div>
                        <div class="control-card-desc">Ověření věcné a místní příslušnosti stavebního úřadu</div>
                        <button class="control-card-action" onclick="openControl('controlPrislusnost')">
                            <span class="material-icons-outlined">play_arrow</span>
                            Provést kontrolu
                        </button>
                    </div>
                </div>

                <!-- 2. Kontrola žádosti -->
                <div class="control-card status-waiting disabled" id="card-zadost">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">fact_check</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Kontrola žádosti</div>
                        <div class="control-card-desc">Náležitosti žádosti podle § 184 a § 185 SZ</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve příslušnost
                        </button>
                    </div>
                </div>

                <!-- 3. Dokumentace -->
                <div class="control-card status-waiting disabled" id="card-dokumentace">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">architecture</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Dokumentace</div>
                        <div class="control-card-desc">Kontrola úplnosti, podpisů a formátu projektové dokumentace</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve kontrola žádosti
                        </button>
                    </div>
                </div>

                <!-- 4. Pozemky -->
                <div class="control-card status-waiting disabled" id="card-pozemky">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">terrain</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Pozemky</div>
                        <div class="control-card-desc">Ověření pozemků záměru a identifikace sousedních parcel</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve dokumentace
                        </button>
                    </div>
                </div>

                <!-- 5. Soulad s ÚPD -->
                <div class="control-card status-waiting disabled" id="card-up">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">map</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Soulad s ÚPD</div>
                        <div class="control-card-desc">Kontrola souladu záměru s územně plánovací dokumentací</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 6. Dokladová část (sloučeno z Identifikace DO a Dokladová část) -->
                <div class="control-card status-waiting disabled" id="card-identifikace">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">fact_check</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Dokladová část</div>
                        <div class="control-card-desc">Stanoviska DO a vyjádření vlastníků sítí</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 7. Osoby -->
                <div class="control-card status-waiting disabled" id="card-ucastnici">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">groups</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Osoby</div>
                        <div class="control-card-desc">Ověření vlastníků pozemků a definice osob v řízení</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 9. Zrychlené řízení -->
                <div class="control-card status-waiting disabled" id="card-zrychlene">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">bolt</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Zrychlené řízení</div>
                        <div class="control-card-desc">Ověření podmínek pro zrychlené řízení</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve ostatní kontroly
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary / Action bar -->
            <div class="summary-card">
                <div class="summary-content">
                    <div class="summary-title" id="summaryTitle">Dokončete všechny kontroly</div>
                    <div class="summary-desc" id="summaryDesc">Po dokončení všech kontrol bude možné řízení zahájit.</div>
                </div>
                <div class="summary-actions">
                    <button class="btn btn-primary" id="btnZahajit" disabled onclick="zahajitRizeni()">
                        <span class="material-icons-outlined">play_circle</span>
                        Zahájit řízení
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- ============================================ -->
    <!-- KONTROLNÍ OVERLAYE - DVOUPANELOVÝ LAYOUT -->
    <!-- ============================================ -->

    <!-- Kontrola: Příslušnost (všechny podklady) -->
    <div class="control-overlay" id="controlPrislusnost">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlPrislusnost')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">account_balance</span>
                    Kontrola příslušnosti
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchViewerTab(this, 'prislusnost', 'zadost')">
                            <span class="material-icons-outlined">description</span>
                            Žádost
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'prislusnost', 'prilohy')">
                            <span class="material-icons-outlined">attach_file</span>
                            Přílohy
                            <span class="badge">12</span>
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'prislusnost', 'dokumentace')">
                            <span class="material-icons-outlined">folder</span>
                            El. dokumentace
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'prislusnost', 'doklady')">
                            <span class="material-icons-outlined">fact_check</span>
                            Dokladová část
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('prislusnost')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-prislusnost">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">V ostré verzi by se zde zobrazil náhled dokumentu</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <div class="control-section">
                        <div class="control-section-title">Kontrola příslušnosti stavebního úřadu</div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 16px;">
                            Ověřte, zda je stavební úřad věcně a místně příslušný k projednání této žádosti.
                        </p>
                        
                        <!-- Možnost 1: Příslušný -->
                        <label class="control-option selected" onclick="selectOption(this); updatePrislusnostResult()">
                            <input type="radio" name="prislusnost" value="prislusny" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">
                                    <span class="material-icons-outlined" style="font-size: 18px; color: #137333; vertical-align: middle; margin-right: 6px;">check_circle</span>
                                    Stavební úřad je příslušný
                                </div>
                                <div class="control-option-desc">Stavební úřad je věcně i místně příslušný k projednání žádosti</div>
                            </div>
                        </label>
                        
                        <!-- Možnost 2: Nepříslušný (sloučená) -->
                        <label class="control-option" onclick="selectOption(this, true); updatePrislusnostResult()">
                            <input type="radio" name="prislusnost" value="neprislusny">
                            <div class="control-option-content">
                                <div class="control-option-label">
                                    <span class="material-icons-outlined" style="font-size: 18px; color: #b06000; vertical-align: middle; margin-right: 6px;">send</span>
                                    Stavební úřad není věcně nebo místně příslušný
                                </div>
                                <div class="control-option-desc">Řízení bude postoupeno příslušnému stavebnímu úřadu</div>
                            </div>
                        </label>
                        
                        <!-- Výběr SÚ - zobrazí se při nepříslušnosti -->
                        <div class="su-selection-section" id="vyberSuSection">
                            <div class="su-selection-title">
                                <span class="material-icons-outlined">account_balance</span>
                                Výběr příslušného stavebního úřadu
                            </div>
                            <div class="su-selection-desc">
                                Vyberte stavební úřad, kterému bude řízení postoupeno.
                            </div>
                            <div class="su-select-wrapper">
                                <div class="su-search-select" id="postoupitSuSearchSelect">
                                    <div class="su-search-input-wrapper">
                                        <span class="material-icons-outlined su-search-icon">search</span>
                                        <input type="text" class="su-search-input" id="postoupitSuSearchInput" 
                                            placeholder="Vyhledejte stavební úřad..." 
                                            onclick="openSuDropdown('postoupit')"
                                            oninput="filterSuOptions('postoupit')">
                                        <input type="hidden" id="postoupitSuSelect" value="">
                                        <button class="su-search-clear" onclick="clearSuSelection('postoupit')" title="Vymazat">
                                            <span class="material-icons-outlined">close</span>
                                        </button>
                                    </div>
                                    <div class="su-dropdown" id="postoupitSuDropdown">
                                        <div class="su-dropdown-group" data-group="desu">
                                            <div class="su-dropdown-group-title">DESÚ – Dopravní a energetický stavební úřad</div>
                                            <div class="su-dropdown-option" data-value="desu" data-type="DESÚ" data-info="Dopravní a energetický stavební úřad|Sokolovská 1955/278, Praha 9|podatelna@desu.gov.cz|Dopravní stavby celostátního významu, energetické stavby" data-search="desú centrála praha dopravní energetický">
                                                <span class="su-option-name">DESÚ – centrála Praha</span>
                                                <span class="su-option-type">DESÚ</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-group" data-group="ksu">
                                            <div class="su-dropdown-group-title">Krajské stavební úřady</div>
                                            <div class="su-dropdown-option" data-value="ksu_praha" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad hl. m. Prahy|Jungmannova 35/29, Praha 1|stavebni@praha.eu|Stavby na území hl. m. Prahy spadající do působnosti KSÚ" data-search="ksu krajský praha hlavní město">
                                                <span class="su-option-name">KSÚ hl. m. Prahy</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_stredocesky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Středočeského kraje|Zborovská 11, Praha 5|stavebni@kr-s.cz|Stavby na území Středočeského kraje spadající do působnosti KSÚ" data-search="ksu krajský středočeský střední čechy">
                                                <span class="su-option-name">KSÚ Středočeského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_jihocesky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Jihočeského kraje|U Zimního stadionu 1952/2, České Budějovice|stavebni@kraj-jihocesky.cz|Stavby na území Jihočeského kraje spadající do působnosti KSÚ" data-search="ksu krajský jihočeský jižní čechy české budějovice">
                                                <span class="su-option-name">KSÚ Jihočeského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_plzensky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Plzeňského kraje|Škroupova 18, Plzeň|stavebni@plzensky-kraj.cz|Stavby na území Plzeňského kraje spadající do působnosti KSÚ" data-search="ksu krajský plzeňský plzeň">
                                                <span class="su-option-name">KSÚ Plzeňského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_karlovarsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Karlovarského kraje|Závodní 353/88, Karlovy Vary|stavebni@kr-karlovarsky.cz|Stavby na území Karlovarského kraje spadající do působnosti KSÚ" data-search="ksu krajský karlovarský karlovy vary">
                                                <span class="su-option-name">KSÚ Karlovarského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_ustecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Ústeckého kraje|Velká Hradební 3118/48, Ústí nad Labem|stavebni@kr-ustecky.cz|Stavby na území Ústeckého kraje spadající do působnosti KSÚ" data-search="ksu krajský ústecký ústí nad labem">
                                                <span class="su-option-name">KSÚ Ústeckého kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_liberecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Libereckého kraje|U Jezu 642/2a, Liberec|stavebni@kraj-lbc.cz|Stavby na území Libereckého kraje spadající do působnosti KSÚ" data-search="ksu krajský liberecký liberec">
                                                <span class="su-option-name">KSÚ Libereckého kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_kralovehradecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Královéhradeckého kraje|Pivovarské náměstí 1245, Hradec Králové|stavebni@kr-kralovehradecky.cz|Stavby na území Královéhradeckého kraje spadající do působnosti KSÚ" data-search="ksu krajský královéhradecký hradec králové">
                                                <span class="su-option-name">KSÚ Královéhradeckého kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_pardubicky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Pardubického kraje|Komenského náměstí 125, Pardubice|stavebni@pardubickykraj.cz|Stavby na území Pardubického kraje spadající do působnosti KSÚ" data-search="ksu krajský pardubický pardubice">
                                                <span class="su-option-name">KSÚ Pardubického kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_vysocina" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Kraje Vysočina|Žižkova 57, Jihlava|stavebni@kr-vysocina.cz|Stavby na území Kraje Vysočina spadající do působnosti KSÚ" data-search="ksu krajský vysočina jihlava">
                                                <span class="su-option-name">KSÚ Kraje Vysočina</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_jihomoravsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Jihomoravského kraje|Žerotínovo náměstí 449/3, Brno|stavebni@kr-jihomoravsky.cz|Stavby na území Jihomoravského kraje spadající do působnosti KSÚ" data-search="ksu krajský jihomoravský brno jižní morava">
                                                <span class="su-option-name">KSÚ Jihomoravského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_olomoucky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Olomouckého kraje|Jeremenkova 40a, Olomouc|stavebni@kr-olomoucky.cz|Stavby na území Olomouckého kraje spadající do působnosti KSÚ" data-search="ksu krajský olomoucký olomouc">
                                                <span class="su-option-name">KSÚ Olomouckého kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_zlinsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Zlínského kraje|třída Tomáše Bati 21, Zlín|stavebni@kr-zlinsky.cz|Stavby na území Zlínského kraje spadající do působnosti KSÚ" data-search="ksu krajský zlínský zlín">
                                                <span class="su-option-name">KSÚ Zlínského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_moravskoslezsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Moravskoslezského kraje|28. října 117, Ostrava|stavebni@kr-moravskoslezsky.cz|Stavby na území Moravskoslezského kraje spadající do působnosti KSÚ" data-search="ksu krajský moravskoslezský ostrava slezsko">
                                                <span class="su-option-name">KSÚ Moravskoslezského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-group" data-group="praha">
                                            <div class="su-dropdown-group-title">Praha</div>
                                            <div class="su-dropdown-option" data-value="praha1" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 1|Vodičkova 18, Praha 1|stavebni@praha1.cz|k.ú. Staré Město, Josefov, Malá Strana, Hradčany" data-search="praha 1 staré město josefov malá strana hradčany">
                                                <span class="su-option-name">ÚMČ Praha 1</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="praha2" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 2|náměstí Míru 20, Praha 2|stavebni@praha2.cz|k.ú. Nové Město, Vinohrady, Vyšehrad" data-search="praha 2 nové město vinohrady vyšehrad">
                                                <span class="su-option-name">ÚMČ Praha 2</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="praha3" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 3|Havlíčkovo nám. 700/9, Praha 3|stavebni@praha3.cz|k.ú. Žižkov, Vinohrady" data-search="praha 3 žižkov vinohrady">
                                                <span class="su-option-name">ÚMČ Praha 3</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="praha4" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 4|Antala Staška 2059/80b, Praha 4|stavebni@praha4.cz|k.ú. Braník, Hodkovičky, Krč, Lhotka, Michle, Nusle, Podolí" data-search="praha 4 braník hodkovičky krč lhotka michle nusle podolí">
                                                <span class="su-option-name">ÚMČ Praha 4</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="praha5" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 5|náměstí 14. října 4, Praha 5|stavebni@praha5.cz|k.ú. Smíchov, Košíře, Motol, Radlice, Hlubočepy, Jinonice" data-search="praha 5 smíchov košíře motol radlice hlubočepy jinonice">
                                                <span class="su-option-name">ÚMČ Praha 5</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-group" data-group="stredocesky">
                                            <div class="su-dropdown-group-title">Středočeský kraj</div>
                                            <div class="su-dropdown-option" data-value="kladno" data-type="Obecný stavební úřad" data-info="Magistrát města Kladna|náměstí Starosty Pavla 44, Kladno|stavebni@mestokladno.cz|ORP Kladno" data-search="kladno magistrát orp">
                                                <span class="su-option-name">Magistrát města Kladna</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="benesov" data-type="Obecný stavební úřad" data-info="Městský úřad Benešov|Masarykovo náměstí 100, Benešov|stavebni@benesov-city.cz|ORP Benešov" data-search="benešov městský úřad orp">
                                                <span class="su-option-name">MěÚ Benešov</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="beroun" data-type="Obecný stavební úřad" data-info="Městský úřad Beroun|Husovo náměstí 68, Beroun|stavebni@muberoun.cz|ORP Beroun" data-search="beroun městský úřad orp">
                                                <span class="su-option-name">MěÚ Beroun</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="brandys" data-type="Obecný stavební úřad" data-info="Městský úřad Brandýs n. L. – Stará Boleslav|Masarykovo náměstí 1, Brandýs n. L.|stavebni@brandysko.cz|ORP Brandýs nad Labem" data-search="brandýs nad labem stará boleslav městský úřad orp">
                                                <span class="su-option-name">MěÚ Brandýs nad Labem</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="kolin" data-type="Obecný stavební úřad" data-info="Městský úřad Kolín|Karlovo náměstí 78, Kolín|stavebni@mukolin.cz|ORP Kolín" data-search="kolín městský úřad orp">
                                                <span class="su-option-name">MěÚ Kolín</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="mlboleslav" data-type="Obecný stavební úřad" data-info="Magistrát města Mladá Boleslav|Komenského náměstí 61, Mladá Boleslav|stavebni@mb-net.cz|ORP Mladá Boleslav" data-search="mladá boleslav magistrát orp">
                                                <span class="su-option-name">Magistrát města Mladá Boleslav</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="nymburk" data-type="Obecný stavební úřad" data-info="Městský úřad Nymburk|náměstí Přemyslovců 163, Nymburk|stavebni@meu-nbk.cz|ORP Nymburk" data-search="nymburk městský úřad orp">
                                                <span class="su-option-name">MěÚ Nymburk</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="pribram" data-type="Obecný stavební úřad" data-info="Městský úřad Příbram|Tyršova 108, Příbram|stavebni@pribram.eu|ORP Příbram" data-search="příbram městský úřad orp">
                                                <span class="su-option-name">MěÚ Příbram</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="rakovnik" data-type="Obecný stavební úřad" data-info="Městský úřad Rakovník|Husovo náměstí 27, Rakovník|stavebni@murako.cz|ORP Rakovník" data-search="rakovník městský úřad orp">
                                                <span class="su-option-name">MěÚ Rakovník</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-group" data-group="kralovehradecky">
                                            <div class="su-dropdown-group-title">Královéhradecký kraj</div>
                                            <div class="su-dropdown-option" data-value="hradec" data-type="Obecný stavební úřad" data-info="Magistrát města Hradec Králové|Československé armády 408/51, Hradec Králové|stavebni@mmhk.cz|ORP Hradec Králové" data-search="hradec králové magistrát orp">
                                                <span class="su-option-name">Magistrát města Hradec Králové</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="jaromer" data-type="Obecný stavební úřad" data-info="Městský úřad Jaroměř|náměstí ČSA 16, Jaroměř|stavebni@jaromer-josefov.cz|ORP Jaroměř" data-search="jaroměř městský úřad orp josefov">
                                                <span class="su-option-name">MěÚ Jaroměř</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="nachod" data-type="Obecný stavební úřad" data-info="Městský úřad Náchod|Masarykovo náměstí 40, Náchod|stavebni@mestonachod.cz|ORP Náchod" data-search="náchod městský úřad orp">
                                                <span class="su-option-name">MěÚ Náchod</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="trutnov" data-type="Obecný stavební úřad" data-info="Městský úřad Trutnov|Slovanské náměstí 165, Trutnov|stavebni@trutnov.cz|ORP Trutnov" data-search="trutnov městský úřad orp">
                                                <span class="su-option-name">MěÚ Trutnov</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="jicin" data-type="Obecný stavební úřad" data-info="Městský úřad Jičín|Žižkovo náměstí 18, Jičín|stavebni@mujicin.cz|ORP Jičín" data-search="jičín městský úřad orp">
                                                <span class="su-option-name">MěÚ Jičín</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-empty" style="display: none;">
                                            <span class="material-icons-outlined">search_off</span>
                                            Žádný stavební úřad nebyl nalezen
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="su-selected-info" id="postoupitSuInfo">
                                <div class="su-selected-header">
                                    <div class="su-selected-icon">
                                        <span class="material-icons-outlined">account_balance</span>
                                    </div>
                                    <div class="su-selected-name" id="postoupitSuName">—</div>
                                </div>
                                <div class="su-selected-details" id="postoupitSuDetails">
                                    <span><strong>Adresa:</strong> —</span>
                                    <span><strong>E-mail:</strong> —</span>
                                    <span><strong>Působnost:</strong> —</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Zdůvodnění nepříslušnosti - zobrazí se při nepříslušnosti -->
                    <div class="control-section" id="zduvodneniNeprislusnostiSection" style="display: none;">
                        <div class="control-section-title">Zdůvodnění nepříslušnosti</div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Uveďte zdůvodnění, proč není stavební úřad příslušný k projednání žádosti. 
                            Text bude součástí dokumentu <strong>Postoupení řízení z důvodu nepříslušnosti</strong>.
                        </p>
                        <textarea id="zduvodneniNeprislusnosti" class="form-textarea" rows="5" 
                            placeholder="Uveďte zdůvodnění nepříslušnosti..."
                            oninput="updatePrislusnostButton()"
                            style="width: 100%; padding: 12px; border: 1px solid #dadce0; border-radius: 6px; font-size: 13px; font-family: inherit; resize: vertical; line-height: 1.5;"></textarea>
                    </div>

                    <div class="result-preview positive" id="resultPrislusnost">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Příslušnost potvrzena
                        </div>
                        <div class="result-preview-text">Stavební úřad je věcně i místně příslušný k projednání této žádosti.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSavePrislusnost">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlPrislusnost')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('prislusnost')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completePrislusnost()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Kontrola žádosti (§ 184, § 185 SZ) -->
    <div class="control-overlay" id="controlZadost">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlZadost')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">fact_check</span>
                    Kontrola žádosti
                </div>
            </div>
        </div>
        <div class="control-body">
            <!-- LEVÉ OKNO: Strukturovaná data ze žádosti s inline kontrolami -->
            <div class="control-viewer zadost-data-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchZadostDataTab(this, 'zadost')">
                            <span class="material-icons-outlined">list_alt</span>
                            Žádost
                        </button>
                        <button class="viewer-tab" onclick="switchZadostDataTab(this, 'formular')">
                            <span class="material-icons-outlined">picture_as_pdf</span>
                            Formulář žádosti
                        </button>
                    </div>
                    <div class="viewer-tabs-right">
                        <button class="btn-vse-ok" onclick="setAllSectionsOk()" title="Označit všechny sekce jako v pořádku">
                            <span class="material-icons-outlined">done_all</span>
                            Vše v pořádku
                        </button>
                    </div>
                </div>
                <div class="viewer-content zadost-data-content">
                    <!-- TAB: Žádost - strukturovaná data s inline kontrolami -->
                    <div class="zadost-data-tab active" id="zadostDataZadost">
                        <!-- 1. Údaje o podání -->
                        <div class="zadost-data-section" id="dataSectionPodani" data-section-id="podani">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">assignment_ind</span>
                                Údaje o podání
                                <span class="section-status-badge" id="statusBadgePodani"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Podatel (kdo činí podání)</div>
                                    <div class="zadost-data-value" id="podaniPodatel">Jan Novák</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Vztah k žadateli</div>
                                    <div class="zadost-data-value" id="podaniVztah">
                                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                                            <span class="material-icons-outlined" style="font-size: 18px; color: #34a853;">check_circle</span>
                                            Podatel je sám žadatel
                                        </span>
                                    </div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Věc podání</div>
                                    <div class="zadost-data-value">Žádost o povolení stavby</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Správní orgán</div>
                                    <div class="zadost-data-value">Dopravní a energetický stavební úřad</div>
                                </div>
                            </div>
                            <!-- Akční tlačítka pro ověření (dynamicky zobrazované) -->
                            <div class="zastupce-verify-actions" id="podaniVerifyActions" style="display: none;">
                                <!-- Tlačítka budou doplněna podle typu zastoupení -->
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusPodani">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('podani', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('podani', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 2. Žadatel -->
                        <div class="zadost-data-section" id="dataSectionZadatel" data-section-id="zadatel">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">person</span>
                                Žadatel — Fyzická osoba
                                <span class="section-status-badge" id="statusBadgeZadatel"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Jméno</div>
                                    <div class="zadost-data-value">Jan</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Příjmení</div>
                                    <div class="zadost-data-value">Novák</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Datum narození</div>
                                    <div class="zadost-data-value">15. 3. 1985</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Místo trvalého pobytu</div>
                                    <div class="zadost-data-value">Květná 123, 110 00 Praha 1</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">E-mail</div>
                                    <div class="zadost-data-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fa909b94d494958c9b91ba9f979b9396d49980">[email&#160;protected]</a></div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Telefon</div>
                                    <div class="zadost-data-value">+420 601 234 567</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Datová schránka</div>
                                    <div class="zadost-data-value">abc123x</div>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusZadatel">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('zadatel', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('zadatel', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 3. Zástupce -->
                        <div class="zadost-data-section" id="dataSectionZastupce" data-section-id="zastupce">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">supervisor_account</span>
                                Zástupce na základě plné moci
                                <span class="section-status-badge" id="statusBadgeZastupce"></span>
                            </div>
                            <div class="zadost-data-empty">
                                <span class="material-icons-outlined">person_off</span>
                                Žadatel jedná sám za sebe, zástupce není uveden
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusZastupce">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('zastupce', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('zastupce', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 4. Identifikace záměru -->
                        <div class="zadost-data-section" id="dataSectionZamer" data-section-id="zamer">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">home_work</span>
                                Identifikace záměru
                                <span class="section-status-badge" id="statusBadgeZamer"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item full-width">
                                    <div class="zadost-data-label">Název záměru</div>
                                    <div class="zadost-data-value">Novostavba rodinného domu s garáží</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Místo stavby</div>
                                    <div class="zadost-data-value">Jaroměř, ulice Květná</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Katastrální území</div>
                                    <div class="zadost-data-value">Jaroměř [657336]</div>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusZamer">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('zamer', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('zamer', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 5. Základní charakteristika záměru -->
                        <div class="zadost-data-section" id="dataSectionCharakteristika" data-section-id="charakteristika">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">info</span>
                                Základní charakteristika záměru
                                <span class="section-status-badge" id="statusBadgeCharakteristika"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Druh stavby</div>
                                    <div class="zadost-data-value">Budova pro bydlení — rodinný dům</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Účel užívání</div>
                                    <div class="zadost-data-value">Bydlení</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Charakter stavby</div>
                                    <div class="zadost-data-value">Trvalá stavba</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Zastavěná plocha</div>
                                    <div class="zadost-data-value">185 m²</div>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusCharakteristika">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('charakteristika', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('charakteristika', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 6. Podrobnější informace o záměru -->
                        <div class="zadost-data-section" id="dataSectionPodrobneji" data-section-id="podrobnosti">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">article</span>
                                Podrobnější informace o záměru
                                <span class="section-status-badge" id="statusBadgePodrobnosti"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item full-width">
                                    <div class="zadost-data-label">Popis záměru</div>
                                    <div class="zadost-data-value text-block">Dvoupodlažní rodinný dům s obytným podkrovím a vestavěnou garáží pro 2 vozidla. Stavba bude napojena na veřejnou kanalizaci, vodovod, elektrickou energii a plynovod. Vytápění bude zajištěno tepelným čerpadlem vzduch-voda.</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Počet nadzemních podlaží</div>
                                    <div class="zadost-data-value">2 + podkroví</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Počet podzemních podlaží</div>
                                    <div class="zadost-data-value">0</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Počet bytových jednotek</div>
                                    <div class="zadost-data-value">1</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Obestavěný prostor</div>
                                    <div class="zadost-data-value">1 250 m³</div>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusPodrobnosti">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('podrobnosti', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('podrobnosti', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 7. Pozemky záměru -->
                        <div class="zadost-data-section" id="dataSectionPozemkyZameru" data-section-id="pozemky">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">terrain</span>
                                Pozemky, které jsou předmětem záměru
                                <span class="section-status-badge" id="statusBadgePozemky"></span>
                            </div>
                            <table class="zadost-data-table">
                                <thead>
                                    <tr>
                                        <th>Parcela</th>
                                        <th>K.ú.</th>
                                        <th>Druh pozemku</th>
                                        <th>Výměra</th>
                                        <th>Vlastník</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>st. 123</strong></td>
                                        <td>Jaroměř</td>
                                        <td>Zastavěná plocha a nádvoří</td>
                                        <td>185 m²</td>
                                        <td>Jan Novák</td>
                                    </tr>
                                    <tr>
                                        <td><strong>456/1</strong></td>
                                        <td>Jaroměř</td>
                                        <td>Zahrada</td>
                                        <td>850 m²</td>
                                        <td>Jan Novák</td>
                                    </tr>
                                    <tr>
                                        <td><strong>456/2</strong></td>
                                        <td>Jaroměř</td>
                                        <td>Zahrada</td>
                                        <td>320 m²</td>
                                        <td>Jan Novák</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusPozemky">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('pozemky', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('pozemky', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 8. Přílohy žádosti -->
                        <div class="zadost-data-section" id="dataSectionPrilohyZadosti" data-section-id="prilohy">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">attach_file</span>
                                Přílohy žádosti
                                <span class="section-status-badge" id="statusBadgePrilohy"></span>
                            </div>
                            <div class="zadost-prilohy-inline" id="prilohyList">
                                <!-- Dynamicky generované podle scénáře -->
                                <div class="priloha-inline-item na">
                                    <span class="material-icons-outlined">remove_circle_outline</span>
                                    Plná moc — neaplikuje se (žadatel jedná sám)
                                </div>
                                <div class="priloha-inline-item na">
                                    <span class="material-icons-outlined">remove_circle_outline</span>
                                    Souhlas vlastníka pozemku — neaplikuje se (žadatel je vlastník)
                                </div>
                            </div>
                            <!-- Tlačítko pro otevření příloh -->
                            <div class="zastupce-verify-actions" id="prilohyVerifyActions" style="display: none;">
                                <button class="zastupce-verify-btn prilohy" onclick="openPrilohyModal()">
                                    <span class="material-icons-outlined">folder_open</span>
                                    Otevřít přílohy ke kontrole
                                </button>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusPrilohy">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('prilohy', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('prilohy', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 9. Výjimky z požadavků (zobrazí se jen u scénáře s výjimkami) -->
                        <div class="zadost-data-section" id="dataSectionVyjimky" data-section-id="vyjimky" style="display: none;">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">rule</span>
                                Výjimky z obecných požadavků
                                <span style="margin-left: 8px; padding: 2px 8px; background: #fff3e0; color: #ef6c00; border-radius: 4px; font-size: 10px; font-weight: 600;">ŽÁDÁNO</span>
                                <span class="section-status-badge" id="statusBadgeVyjimky"></span>
                            </div>
                            <div class="zadost-data-grid" id="vyjimkyContent">
                                <!-- Dynamicky generované podle scénáře -->
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusVyjimky">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('vyjimky', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('vyjimky', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TAB: Formulář žádosti - náhled PDF -->
                    <div class="zadost-data-tab" id="zadostDataFormular">
                        <div class="formular-preview">
                            <div class="formular-header">
                                <div class="formular-logo">
                                    <span class="material-icons-outlined">account_balance</span>
                                </div>
                                <div class="formular-title-block">
                                    <div class="formular-title">ŽÁDOST O POVOLENÍ STAVBY</div>
                                    <div class="formular-subtitle">podle § 184 zákona č. 283/2021 Sb., stavební zákon</div>
                                </div>
                                <div class="formular-cislo">
                                    <div class="formular-cislo-label">Číslo jednací</div>
                                    <div class="formular-cislo-value">DESU-12345/2025</div>
                                </div>
                            </div>
                            
                            <div class="formular-section">
                                <div class="formular-section-title">ČÁST A – IDENTIFIKAČNÍ ÚDAJE</div>
                                
                                <div class="formular-subsection">
                                    <div class="formular-subsection-title">A.1 Údaje o stavebníkovi</div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Jméno a příjmení / Název</div>
                                            <div class="formular-field-value">Jan Novák</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Datum narození / IČO</div>
                                            <div class="formular-field-value">15. 3. 1985</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field full">
                                            <div class="formular-field-label">Adresa místa trvalého pobytu / Sídlo</div>
                                            <div class="formular-field-value">Květná 123, 110 00 Praha 1</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Telefon</div>
                                            <div class="formular-field-value">+420 601 234 567</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">E-mail</div>
                                            <div class="formular-field-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1a707b743474756c7b715a7f777b7376347960">[email&#160;protected]</a></div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">ID datové schránky</div>
                                            <div class="formular-field-value">abc123x</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="formular-subsection">
                                    <div class="formular-subsection-title">A.2 Údaje o zástupci stavebníka</div>
                                    <div class="formular-field-row">
                                        <div class="formular-field full empty">
                                            <div class="formular-field-label">Zástupce</div>
                                            <div class="formular-field-value">— neuvedeno —</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="formular-section">
                                <div class="formular-section-title">ČÁST B – ÚDAJE O ZÁMĚRU</div>
                                
                                <div class="formular-subsection">
                                    <div class="formular-subsection-title">B.1 Základní údaje</div>
                                    <div class="formular-field-row">
                                        <div class="formular-field full">
                                            <div class="formular-field-label">Název stavby / záměru</div>
                                            <div class="formular-field-value">Novostavba rodinného domu s garáží</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Místo stavby (obec, ulice)</div>
                                            <div class="formular-field-value">Jaroměř, ulice Květná</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Katastrální území</div>
                                            <div class="formular-field-value">Jaroměř [657336]</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field full">
                                            <div class="formular-field-label">Parcelní čísla pozemků</div>
                                            <div class="formular-field-value">st. 123, 456/1, 456/2</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="formular-subsection">
                                    <div class="formular-subsection-title">B.2 Charakteristika záměru</div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Druh stavby</div>
                                            <div class="formular-field-value">Budova pro bydlení — rodinný dům</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Účel užívání</div>
                                            <div class="formular-field-value">Bydlení</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Zastavěná plocha</div>
                                            <div class="formular-field-value">185 m²</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Obestavěný prostor</div>
                                            <div class="formular-field-value">1 250 m³</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Počet bytů</div>
                                            <div class="formular-field-value">1</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="formular-footer">
                                <div class="formular-page-info">Strana 1 z 3</div>
                                <div class="formular-note">Náhled formuláře dle vyhlášky č. 149/2024 Sb.</div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- PRAVÉ OKNO: Panel nedostatků -->
            <div class="zadost-deficiency-panel">
                <div class="deficiency-panel-header">
                    <div class="deficiency-panel-title">
                        <span class="material-icons-outlined">checklist</span>
                        Přehled kontroly
                    </div>
                    <div class="deficiency-panel-summary" id="deficiencySummary">
                        <span class="deficiency-stat ok">
                            <span class="material-icons-outlined">check_circle</span>
                            <span id="statOkCount">0</span> v pořádku
                        </span>
                        <span class="deficiency-stat vada">
                            <span class="material-icons-outlined">error</span>
                            <span id="statVadaCount">0</span> vad
                        </span>
                        <span class="deficiency-stat pending">
                            <span class="material-icons-outlined">radio_button_unchecked</span>
                            <span id="statPendingCount">8</span> zbývá
                        </span>
                    </div>
                </div>
                
                <div class="deficiency-panel-content" id="deficiencyPanelContent">
                    <!-- Výchozí stav - žádné nedostatky -->
                    <div class="deficiency-empty" id="deficiencyEmpty">
                        <span class="material-icons-outlined">task_alt</span>
                        <div class="deficiency-empty-title">Zatím bez nedostatků</div>
                        <div class="deficiency-empty-text">Projděte jednotlivé sekce žádosti a označte je jako „V pořádku" nebo „Vada".</div>
                    </div>
                    
                    <!-- Seznam nedostatků (dynamicky generovaný) -->
                    <div class="deficiency-list" id="deficiencyList" style="display: none;">
                        <!-- Položky budou přidány JavaScriptem -->
                    </div>
                </div>
                
                <div class="deficiency-panel-footer">
                    <div class="deficiency-result pending" id="deficiencyResult">
                        <span class="material-icons-outlined">hourglass_empty</span>
                        <div>
                            <strong>Kontrola probíhá</strong>
                            <div style="font-size: 11px; margin-top: 2px;">Zkontrolujte všech 8 sekcí žádosti</div>
                        </div>
                    </div>
                    <div class="deficiency-panel-actions">
                        <button class="btn btn-secondary" onclick="closeControl('controlZadost')">Zrušit</button>
                        <button class="btn btn-primary" id="btnConfirmZadost" onclick="completeZadostKontrola()" disabled>
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Pozemky -->
    <div class="control-overlay" id="controlPozemky">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlPozemky')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">terrain</span>
                    Pozemky
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchPozemkyTab(this, 'zadost')">
                            <span class="material-icons-outlined">description</span>
                            Žádost
                        </button>
                        <button class="viewer-tab" onclick="switchPozemkyTab(this, 'situace')">
                            <span class="material-icons-outlined">architecture</span>
                            Situační výkresy
                        </button>
                        <button class="viewer-tab" onclick="switchPozemkyTab(this, 'kn')">
                            <span class="material-icons-outlined">terrain</span>
                            Katastr
                        </button>
                        <button class="viewer-tab" onclick="switchPozemkyTab(this, 'mapa')">
                            <span class="material-icons-outlined">map</span>
                            Mapa
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('pozemky')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-pozemky">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">Pozemky uvedené stavebníkem v žádosti</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Pozemky záměru - ze žádosti, editovatelné -->
                    <div class="pozemky-section">
                        <div class="pozemky-section-header">
                            <div class="pozemky-section-title">
                                <span class="material-icons-outlined">location_on</span>
                                Pozemky záměru
                            </div>
                            <span class="pozemky-section-badge" id="pozemkyZameruCount">5 parcel</span>
                            <div class="pozemky-view-toggle" id="pozemkyZameruToggle">
                                <button class="pozemky-view-btn active" onclick="setPozemkyView('zameru', 'chips')" title="Kompaktní zobrazení">
                                    <span class="material-icons-outlined">view_module</span>
                                </button>
                                <button class="pozemky-view-btn" onclick="setPozemkyView('zameru', 'list')" title="Řádkové zobrazení">
                                    <span class="material-icons-outlined">view_list</span>
                                </button>
                            </div>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Pozemky načtené ze žádosti. V případě chyby můžete seznam upravit.
                        </p>
                        <div id="pozemkyZameruList">
                            <!-- Dynamicky renderováno JavaScriptem -->
                        </div>
                        
                        <!-- Přidání pozemku - volba metody -->
                        <p style="font-size: 12px; color: #5f6368; margin: 16px 0 8px 0; font-weight: 500;">
                            Přidat pozemek:
                        </p>
                        <div class="neighbor-method-selector" style="margin-bottom: 12px;">
                            <button class="neighbor-method-btn active" onclick="selectPozemekMethod('rucne')" data-method="rucne">
                                <span class="material-icons-outlined">edit</span>
                                <span>Ručně</span>
                            </button>
                            <button class="neighbor-method-btn" onclick="selectPozemekMethod('mapa')" data-method="mapa">
                                <span class="material-icons-outlined">map</span>
                                <span>Z mapy</span>
                            </button>
                        </div>
                        
                        <!-- Ruční zadání -->
                        <div class="pozemky-add-section" id="pozemekMethodRucne">
                            <div class="pozemky-add-row" style="flex-wrap: wrap; gap: 8px;">
                                <select class="pozemky-add-input" id="pozemekObec" style="flex: 1; min-width: 150px;" onchange="loadKatastralniUzemi()">
                                    <option value="">Vyberte obec...</option>
                                    <option value="veseli" selected>Veselí nad Lužnicí</option>
                                    <option value="tabor">Tábor</option>
                                    <option value="soběslav">Soběslav</option>
                                    <option value="jiné">Jiná obec...</option>
                                </select>
                                <select class="pozemky-add-input" id="pozemekKU" style="flex: 1; min-width: 150px;">
                                    <option value="">Vyberte k.ú....</option>
                                    <option value="veseli-779091" selected>Veselí nad Lužnicí</option>
                                    <option value="horusice-779091">Horusice</option>
                                </select>
                                <input type="text" class="pozemky-add-input" id="pozemekZameruInput" placeholder="Číslo parcely..." style="flex: 1; min-width: 120px;">
                                <button class="btn-add-pozemek" onclick="addPozemekZameru()">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat
                                </button>
                            </div>
                        </div>
                        
                        <!-- Z mapy -->
                        <div class="pozemky-add-section" id="pozemekMethodMapa" style="display: none;">
                            <div style="background: #f8f9fa; border: 1px dashed #dadce0; border-radius: 8px; padding: 16px; text-align: center;">
                                <span class="material-icons-outlined" style="font-size: 32px; color: #5f6368; display: block; margin-bottom: 8px;">map</span>
                                <p style="font-size: 12px; color: #5f6368; margin: 0;">
                                    Kliknutím na parcelu v mapě vlevo ji přidáte do seznamu pozemků záměru.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Sousední pozemky -->
                    <div class="pozemky-section">
                        <div class="pozemky-section-header">
                            <div class="pozemky-section-title">
                                <span class="material-icons-outlined">grid_view</span>
                                Sousední pozemky
                            </div>
                            <span class="pozemky-section-badge" id="sousedniCount">12 parcel</span>
                            <div class="pozemky-view-toggle" id="sousedniToggle">
                                <button class="pozemky-view-btn active" onclick="setPozemkyView('sousedni', 'chips')" title="Kompaktní zobrazení">
                                    <span class="material-icons-outlined">view_module</span>
                                </button>
                                <button class="pozemky-view-btn" onclick="setPozemkyView('sousedni', 'list')" title="Řádkové zobrazení">
                                    <span class="material-icons-outlined">view_list</span>
                                </button>
                            </div>
                        </div>

                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Vyberte metodu identifikace sousedních pozemků:
                        </p>

                        <!-- Metoda výběru -->
                        <div class="neighbor-method-selector" id="sousedniMethodSelector">
                            <button class="neighbor-method-btn active" onclick="selectNeighborMethod('auto')" data-method="auto">
                                <span class="material-icons-outlined">auto_awesome</span>
                                <span>Automaticky</span>
                            </button>
                            <button class="neighbor-method-btn" onclick="selectNeighborMethod('rucne')" data-method="rucne">
                                <span class="material-icons-outlined">edit</span>
                                <span>Ručně</span>
                            </button>
                            <button class="neighbor-method-btn" onclick="selectNeighborMethod('mapa')" data-method="mapa">
                                <span class="material-icons-outlined">map</span>
                                <span>Z mapy</span>
                            </button>
                        </div>

                        <!-- Automatická metoda -->
                        <div class="neighbor-method-content" id="methodAuto">
                            <button class="btn-autodetect" onclick="autoDetectSousedni()" id="btnAutoDetect">
                                <span class="material-icons-outlined">auto_awesome</span>
                                Automaticky identifikovat sousedy
                            </button>
                        </div>

                        <!-- Ruční metoda -->
                        <div class="neighbor-method-content" id="methodRucne" style="display: none;">
                            <div class="pozemky-add-row" style="flex-wrap: wrap; gap: 8px;">
                                <select class="pozemky-add-input" id="sousedObec" style="flex: 1; min-width: 150px;" onchange="loadSousedKatastralniUzemi()">
                                    <option value="">Vyberte obec...</option>
                                    <option value="veseli" selected>Veselí nad Lužnicí</option>
                                    <option value="tabor">Tábor</option>
                                    <option value="soběslav">Soběslav</option>
                                    <option value="jiné">Jiná obec...</option>
                                </select>
                                <select class="pozemky-add-input" id="sousedKU" style="flex: 1; min-width: 150px;">
                                    <option value="">Vyberte k.ú....</option>
                                    <option value="veseli-779091" selected>Veselí nad Lužnicí</option>
                                    <option value="horusice-779091">Horusice</option>
                                </select>
                                <input type="text" class="pozemky-add-input" id="sousedniSearchInput" placeholder="Číslo parcely..." style="flex: 1; min-width: 120px;">
                                <button class="btn-add-pozemek" onclick="addSousedniRucne()">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat
                                </button>
                            </div>
                        </div>

                        <!-- Z mapy -->
                        <div class="neighbor-method-content" id="methodMapa" style="display: none;">
                            <div style="background: #f8f9fa; border: 1px dashed #dadce0; border-radius: 8px; padding: 16px; text-align: center;">
                                <span class="material-icons-outlined" style="font-size: 32px; color: #5f6368; display: block; margin-bottom: 8px;">map</span>
                                <p style="font-size: 12px; color: #5f6368; margin: 0;">
                                    Kliknutím na parcely v mapě vlevo je přidáte do seznamu sousedních pozemků.
                                </p>
                            </div>
                        </div>

                        <!-- Seznam sousedních parcel -->
                        <div class="sousedni-list" id="sousedniList">
                            <div class="sousedni-empty" id="sousedniEmpty">
                                <span class="material-icons-outlined">grid_view</span>
                                <div class="sousedni-empty-text">Zatím nejsou identifikovány žádné sousední pozemky</div>
                                <div class="sousedni-empty-hint">Použijte některou z metod výše</div>
                            </div>
                        </div>
                    </div>

                    <div class="result-preview positive" id="resultPozemky">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Pozemky identifikovány
                        </div>
                        <div class="result-preview-text">Pozemky záměru a sousední pozemky byly identifikovány. Vlastníci budou určeni v části Osoby.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSavePozemky">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlPozemky')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('pozemky')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmPozemky" onclick="completePozemky()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="control-overlay" id="controlDokumentace">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlDokumentace')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">architecture</span>
                    Kontrola dokumentace
                </div>
            </div>
        </div>
        <div class="control-body">
            <!-- Levý panel - prohlížeč struktury dokumentace -->
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab ed-back-btn" id="edBackBtn" onclick="backToEdStructure()" style="display: none;">
                            <span class="material-icons-outlined">arrow_back</span>
                            Zpět do ED
                        </button>
                        <div class="ed-breadcrumb" id="edBreadcrumb">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #5f6368;">folder_special</span>
                            <span style="font-weight: 500; color: #202124;">Struktura dokumentace</span>
                        </div>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('dokumentace')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content" style="background: #fff;">
                    <!-- Struktura ED -->
                    <div class="ed-tree-container" id="edTreeContainer" style="padding: 16px;">
                        <div class="ed-tree" id="edTree">
                            <div class="ed-tree-header">
                                <div class="ed-tree-header-top">
                                    <span class="material-icons-outlined">folder_special</span>
                                    <strong>SR00X01I35GT</strong>
                                    <span style="color: #5f6368; font-size: 12px; margin-left: 8px;">Novostavba RD včetně přípojek</span>
                                </div>
                                <div class="ed-version-selector">
                                    <label style="font-size: 11px; color: #5f6368; margin-right: 6px;">Verze:</label>
                                    <select class="ed-version-select" id="edVersionSelect" onchange="changeEdVersion()">
                                        <option value="v3" selected>v3 (aktuální) — 10. 1. 2026</option>
                                        <option value="v2">v2 — 18. 12. 2025</option>
                                        <option value="v1">v1 — 2. 12. 2025</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- A. Průvodní zpráva -->
                            <div class="ed-folder" data-section="A">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">A. Průvodní zpráva</span>
                                    <span class="folder-count">1 soubor</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('A.1 Průvodní zpráva.pdf', 'A')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">A.1 Průvodní zpráva.pdf</span>
                                        <span class="file-size">245 kB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- B. Souhrnná technická zpráva -->
                            <div class="ed-folder" data-section="B">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">B. Souhrnná technická zpráva</span>
                                    <span class="folder-count">1 soubor</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('B.1 Souhrnná technická zpráva.pdf', 'B')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">B.1 Souhrnná technická zpráva.pdf</span>
                                        <span class="file-size">1.2 MB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- C. Situační výkresy -->
                            <div class="ed-folder" data-section="C">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">C. Situační výkresy</span>
                                    <span class="folder-count">4 soubory</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('C.1 Situační výkres širších vztahů.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.1 Situační výkres širších vztahů.pdf</span>
                                        <span class="file-size">890 kB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.2 Katastrální situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.2 Katastrální situační výkres.pdf</span>
                                        <span class="file-size">1.1 MB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.3 Koordinační situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.3 Koordinační situační výkres.pdf</span>
                                        <span class="file-size">1.4 MB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.4 Speciální situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.4 Speciální situační výkres.pdf</span>
                                        <span class="file-size">780 kB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- D. Dokumentace objektů -->
                            <div class="ed-folder" data-section="D">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">D. Dokumentace objektů</span>
                                    <span class="folder-count">4 podsložky</span>
                                </div>
                                <div class="ed-folder-content">
                                    <!-- D.1 Dokumentace stavebního objektu -->
                                    <div class="ed-folder nested">
                                        <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                            <span class="material-icons-outlined folder-icon">folder</span>
                                            <span class="folder-name">D.1 Dokumentace stavebního objektu</span>
                                            <span class="folder-count">4 podsložky</span>
                                        </div>
                                        <div class="ed-folder-content">
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.1 Architektonicko-stavební řešení</span>
                                                    <span class="folder-count">12 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.1.01 Technická zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.1.01 Technická zpráva.pdf</span>
                                                        <span class="file-size">520 kB</span>
                                                    </div>
                                                    <div class="ed-file" onclick="previewEdFile('D.1.1.02 Půdorys 1.NP.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.1.02 Půdorys 1.NP.pdf</span>
                                                        <span class="file-size">1.8 MB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 10 souborů</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.2 Stavebně konstrukční řešení</span>
                                                    <span class="folder-count">8 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.2.01 Technická zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.2.01 Technická zpráva.pdf</span>
                                                        <span class="file-size">340 kB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 7 souborů</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.3 Požárně bezpečnostní řešení</span>
                                                    <span class="folder-count">3 soubory</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.3.01 Požární zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.3.01 Požární zpráva.pdf</span>
                                                        <span class="file-size">890 kB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ další 2 soubory</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.4 Technika prostředí staveb</span>
                                                    <span class="folder-count">6 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.4.01 Zdravotně technické instalace.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.4.01 Zdravotně technické instalace.pdf</span>
                                                        <span class="file-size">1.2 MB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 5 souborů</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- D.2 Dokumentace technických a technologických zařízení -->
                                    <div class="ed-folder nested empty">
                                        <div class="ed-folder-header">
                                            <span class="material-icons-outlined folder-icon" style="color: #9aa0a6;">folder_off</span>
                                            <span class="folder-name" style="color: #9aa0a6;">D.2 Dokumentace tech. a technol. zařízení</span>
                                            <span class="folder-count" style="color: #9aa0a6;">prázdné</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Náhled dokumentu -->
                    <div class="ed-preview-container" id="edPreviewContainer" style="display: none; padding: 16px; height: 100%;">
                        <div id="edPreviewContent" style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 8px; padding: 40px;">
                            <span class="material-icons-outlined" style="font-size: 64px; color: #9aa0a6; margin-bottom: 16px;">description</span>
                            <div style="font-size: 14px; color: #5f6368;">Vyberte dokument ze struktury</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pravý panel - kontrolní formulář -->
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Kategorie stavby -->
                    <div class="control-section stavba-kategorie-section">
                        <div class="control-section-title">
                            <span class="material-icons-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 4px;">category</span>
                            Kategorie stavby
                        </div>
                        
                        <!-- Soubor staveb -->
                        <div class="stavba-field">
                            <div class="stavba-field-label">Jde o soubor staveb?</div>
                            <div class="stavba-toggle-group">
                                <label class="stavba-toggle">
                                    <input type="radio" name="souborStaveb" value="ne" checked onchange="toggleSouborStaveb()">
                                    <span class="stavba-toggle-label">Ne</span>
                                </label>
                                <label class="stavba-toggle">
                                    <input type="radio" name="souborStaveb" value="ano" onchange="toggleSouborStaveb()">
                                    <span class="stavba-toggle-label">Ano</span>
                                </label>
                            </div>
                            <div class="stavba-field-hint">
                                <span class="material-icons-outlined">info</span>
                                Údaj přenesen ze žádosti — můžete upravit
                            </div>
                        </div>
                        
                        <!-- Kategorie stavby - jednoduchá -->
                        <div class="stavba-field" id="kategorieJednoduchaField">
                            <div class="stavba-field-label">Kategorie stavby</div>
                            <div class="stavba-kategorie-options">
                                <label class="stavba-kategorie-option">
                                    <input type="radio" name="kategorieStavby" value="vyhrazena">
                                    <span class="stavba-kategorie-box">
                                        <span class="kategorie-name">Vyhrazená</span>
                                        <span class="kategorie-desc">§ 5 vyhl. č. 600/2006</span>
                                    </span>
                                </label>
                                <label class="stavba-kategorie-option">
                                    <input type="radio" name="kategorieStavby" value="ostatni" checked>
                                    <span class="stavba-kategorie-box">
                                        <span class="kategorie-name">Ostatní</span>
                                        <span class="kategorie-desc">Běžné stavby</span>
                                    </span>
                                </label>
                                <label class="stavba-kategorie-option">
                                    <input type="radio" name="kategorieStavby" value="jednoducha">
                                    <span class="stavba-kategorie-box">
                                        <span class="kategorie-name">Jednoduchá</span>
                                        <span class="kategorie-desc">§ 171 SZ</span>
                                    </span>
                                </label>
                                <label class="stavba-kategorie-option">
                                    <input type="radio" name="kategorieStavby" value="drobna">
                                    <span class="stavba-kategorie-box">
                                        <span class="kategorie-name">Drobná</span>
                                        <span class="kategorie-desc">§ 171 SZ</span>
                                    </span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Kategorie stavby - soubor staveb -->
                        <div class="stavba-field" id="kategorieSouborField" style="display: none;">
                            <div class="stavba-soubor-wrapper">
                                <!-- Hlavní stavba -->
                                <div class="stavba-soubor-item hlavni">
                                    <div class="stavba-soubor-header">
                                        <span class="material-icons-outlined">star</span>
                                        Hlavní stavba
                                        <span class="stavba-soubor-badge">určuje kategorii souboru</span>
                                    </div>
                                    <div class="stavba-soubor-content">
                                        <div class="stavba-soubor-nazev">
                                            <input type="text" class="stavba-input" id="hlavniStavbaNazev" value="Rodinný dům" placeholder="Název hlavní stavby">
                                        </div>
                                        <div class="stavba-kategorie-mini">
                                            <label class="kategorie-mini-option">
                                                <input type="radio" name="kategorieHlavni" value="vyhrazena">
                                                <span>Vyhrazená</span>
                                            </label>
                                            <label class="kategorie-mini-option">
                                                <input type="radio" name="kategorieHlavni" value="ostatni" checked>
                                                <span>Ostatní</span>
                                            </label>
                                            <label class="kategorie-mini-option">
                                                <input type="radio" name="kategorieHlavni" value="jednoducha">
                                                <span>Jednoduchá</span>
                                            </label>
                                            <label class="kategorie-mini-option">
                                                <input type="radio" name="kategorieHlavni" value="drobna">
                                                <span>Drobná</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Vedlejší stavby -->
                                <div class="stavba-soubor-item vedlejsi">
                                    <div class="stavba-soubor-header">
                                        <span class="material-icons-outlined">add_circle_outline</span>
                                        Vedlejší stavby
                                    </div>
                                    <div class="stavba-soubor-content">
                                        <div class="vedlejsi-stavby-list" id="vedlejsiStavbyList">
                                            <div class="vedlejsi-stavba-row">
                                                <input type="text" class="stavba-input" value="Garáž" placeholder="Název stavby">
                                                <select class="stavba-select">
                                                    <option value="ostatni">Ostatní</option>
                                                    <option value="jednoducha" selected>Jednoduchá</option>
                                                    <option value="drobna">Drobná</option>
                                                </select>
                                                <button class="vedlejsi-remove" onclick="removeVedlejsiStavba(this)" title="Odebrat">
                                                    <span class="material-icons-outlined">close</span>
                                                </button>
                                            </div>
                                            <div class="vedlejsi-stavba-row">
                                                <input type="text" class="stavba-input" value="Přípojky inženýrských sítí" placeholder="Název stavby">
                                                <select class="stavba-select">
                                                    <option value="ostatni">Ostatní</option>
                                                    <option value="jednoducha">Jednoduchá</option>
                                                    <option value="drobna" selected>Drobná</option>
                                                </select>
                                                <button class="vedlejsi-remove" onclick="removeVedlejsiStavba(this)" title="Odebrat">
                                                    <span class="material-icons-outlined">close</span>
                                                </button>
                                            </div>
                                        </div>
                                        <button class="btn-add-vedlejsi" onclick="addVedlejsiStavba()">
                                            <span class="material-icons-outlined">add</span>
                                            Přidat vedlejší stavbu
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stavba-soubor-summary" id="souborSummary">
                                <span class="material-icons-outlined">info</span>
                                <span>Kategorie souboru staveb: <strong>Ostatní</strong> (podle hlavní stavby)</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Automatická kontrola -->
                    <div class="auto-check-section">
                        <div class="auto-check-header">
                            <div class="auto-check-title">
                                <span class="material-icons-outlined">auto_awesome</span>
                                Automatická kontrola
                            </div>
                            <button class="btn-run-check" id="btnRunAutoCheck" onclick="runDocAutoCheck()">
                                <span class="material-icons-outlined">play_arrow</span>
                                Spustit kontrolu
                            </button>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 0; font-style: normal;" id="autoCheckDesc">
                            Automaticky zkontroluje elektronické podpisy, časová razítka a formát PDF/A.
                        </p>
                        <div class="auto-check-results" id="autoCheckResults">
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconFormat">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Formát PDF/A</div>
                                    <div class="check-result-detail" id="checkDetailFormat">Všechny dokumenty jsou ve správném formátu</div>
                                </div>
                            </div>
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconSignature">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Elektronické podpisy</div>
                                    <div class="check-result-detail" id="checkDetailSignature">Všechny dokumenty jsou platně podepsány</div>
                                </div>
                            </div>
                            <div class="check-result-item" id="checkItemTimestamp">
                                <div class="check-result-icon warning" id="checkIconTimestamp">
                                    <span class="material-icons-outlined">warning</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Časová razítka</div>
                                    <div class="check-result-detail" id="checkDetailTimestamp">1 dokument nemá časové razítko</div>
                                </div>
                                <span class="check-result-added" id="checkTimestampAdded" style="display: none; font-size: 11px; color: #137333;">
                                    <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle;">check</span>
                                    Přidáno do seznamu
                                </span>
                            </div>
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconAuth">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Autorizační razítko</div>
                                    <div class="check-result-detail" id="checkDetailAuth">Projektant má platnou autorizaci ČKAIT</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Kontrola přítomnosti částí dokumentace -->
                    <div class="doc-check-section">
                        <div class="doc-check-header">
                            <div class="doc-check-title">
                                <span class="material-icons-outlined">checklist</span>
                                Kontrola jednotlivých částí dokumentace
                            </div>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px; font-style: normal;">
                            Ověřte, že dokumentace obsahuje všechny požadované části a zkontrolujte správnost jejich obsahu.
                        </p>
                        
                        <div class="doc-parts-list" id="docPartsList">
                            <!-- A. Průvodní zpráva -->
                            <div class="doc-part-item" data-part="A">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">A</span>
                                    <span class="doc-part-name">Průvodní zpráva</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('A', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('A', 'error')" title="Chyba">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- B. Souhrnná technická zpráva -->
                            <div class="doc-part-item" data-part="B">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">B</span>
                                    <span class="doc-part-name">Souhrnná technická zpráva</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('B', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('B', 'error')" title="Chyba">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- C. Situační výkresy -->
                            <div class="doc-part-item" data-part="C">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">C</span>
                                    <span class="doc-part-name">Situační výkresy</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('C', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('C', 'error')" title="Chyba">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- D. Dokumentace objektů -->
                            <div class="doc-part-item" data-part="D">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">D</span>
                                    <span class="doc-part-name">Dokumentace objektů</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('D', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('D', 'error')" title="Chyba">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Zjištěné nedostatky dokumentace - strukturované podle částí -->
                    <div class="issues-section" id="issuesSection">
                        <div class="issues-header">
                            <div class="issues-title">
                                <span class="material-icons-outlined">report_problem</span>
                                Zjištěné nedostatky dokumentace
                            </div>
                            <span class="issues-count" id="issuesCount">0</span>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 16px;">
                            Seznam nedostatků se stane součástí dokumentu <strong>Výzva k doplnění a usnesení o přerušení řízení</strong>.
                        </p>
                        
                        <!-- Automaticky zjištěné nedostatky -->
                        <div class="part-issues-section" id="autoIssuesSection" style="display: none;">
                            <div class="part-issues-header">
                                <span class="material-icons-outlined" style="color: #1a73e8;">auto_awesome</span>
                                Automaticky zjištěné nedostatky
                            </div>
                            <div class="part-issues-list" id="autoIssuesList">
                                <!-- Automatické nedostatky -->
                            </div>
                        </div>
                        
                        <!-- Sekce pro část A -->
                        <div class="part-issues-section" id="partIssuesA" style="display: none;">
                            <div class="part-issues-header">
                                <span class="part-letter">A</span>
                                Nedostatky v části A. Průvodní zpráva
                            </div>
                            <div class="part-issues-list" id="partIssuesListA">
                                <!-- Nedostatky části A -->
                            </div>
                            <div class="part-issues-add">
                                <textarea class="part-issue-textarea" id="partIssueTextA" placeholder="Popište nedostatek v průvodní zprávě..." rows="3"></textarea>
                                <button class="btn-add-part-issue" onclick="addPartIssue('A')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sekce pro část B -->
                        <div class="part-issues-section" id="partIssuesB" style="display: none;">
                            <div class="part-issues-header">
                                <span class="part-letter">B</span>
                                Nedostatky v části B. Souhrnná technická zpráva
                            </div>
                            <div class="part-issues-list" id="partIssuesListB">
                                <!-- Nedostatky části B -->
                            </div>
                            <div class="part-issues-add">
                                <textarea class="part-issue-textarea" id="partIssueTextB" placeholder="Popište nedostatek v souhrnné technické zprávě..." rows="3"></textarea>
                                <button class="btn-add-part-issue" onclick="addPartIssue('B')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sekce pro část C -->
                        <div class="part-issues-section" id="partIssuesC" style="display: none;">
                            <div class="part-issues-header">
                                <span class="part-letter">C</span>
                                Nedostatky v části C. Situační výkresy
                            </div>
                            <div class="part-issues-list" id="partIssuesListC">
                                <!-- Nedostatky části C -->
                            </div>
                            <div class="part-issues-add">
                                <textarea class="part-issue-textarea" id="partIssueTextC" placeholder="Popište nedostatek v situačních výkresech..." rows="3"></textarea>
                                <button class="btn-add-part-issue" onclick="addPartIssue('C')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sekce pro část D -->
                        <div class="part-issues-section" id="partIssuesD" style="display: none;">
                            <div class="part-issues-header">
                                <span class="part-letter">D</span>
                                Nedostatky v části D. Dokumentace objektů
                            </div>
                            <div class="part-issues-list" id="partIssuesListD">
                                <!-- Nedostatky části D -->
                            </div>
                            <div class="part-issues-add">
                                <textarea class="part-issue-textarea" id="partIssueTextD" placeholder="Popište nedostatek v dokumentaci objektů..." rows="3"></textarea>
                                <button class="btn-add-part-issue" onclick="addPartIssue('D')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                        
                        <!-- Prázdný stav -->
                        <div class="issues-empty" id="issuesEmpty">
                            <span class="material-icons-outlined" style="font-size: 32px; color: #9aa0a6; margin-bottom: 8px;">check_circle</span>
                            <div style="font-size: 13px; color: #5f6368;">Zatím nebyly zjištěny žádné nedostatky</div>
                        </div>
                    </div>

                    <div class="result-preview neutral" id="resultDokumentace">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">info</span>
                            Kontrola nebyla dokončena
                        </div>
                        <div class="result-preview-text">Zkontrolujte všechny části dokumentace kliknutím na zaškrtávátko.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveDokumentace">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlDokumentace')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('dokumentace')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmDokumentace" onclick="completeDokumentace()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Kontrola: Identifikace DO a správců TDI -->
    <div class="control-overlay" id="controlIdentifikace">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlIdentifikace')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">hub</span>
                    Identifikace DO a správců TDI
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchViewerTab(this, 'identifikace', 'dtm')">
                            <span class="material-icons-outlined">layers</span>
                            DTM
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'identifikace', 'doklady')">
                            <span class="material-icons-outlined">folder</span>
                            Dokladová část
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'identifikace', 'zadost')">
                            <span class="material-icons-outlined">description</span>
                            Žádost
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('identifikace')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-identifikace">
                        <span class="material-icons-outlined">layers</span>
                        <div class="viewer-placeholder-title">Digitální technická mapa</div>
                        <div class="viewer-placeholder-text">Sítě technické infrastruktury v okolí stavby</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <!-- AI Analýza -->
                    <div class="identifikace-ai-section">
                        <div class="identifikace-ai-header">
                            <div class="identifikace-ai-title">
                                <span class="material-icons-outlined">auto_awesome</span>
                                AI Analýza dokladové části
                            </div>
                            <button class="btn-ai-analyze" id="btnAiAnalyzeDoklady" onclick="aiAnalyzeDoklady()">
                                <span class="material-icons-outlined">search</span>
                                Analyzovat přílohy
                            </button>
                        </div>
                        <div class="identifikace-ai-status" id="aiAnalyzeStatus">
                            <span class="material-icons-outlined">info</span>
                            Spusťte analýzu pro automatické rozpoznání přiložených dokumentů
                        </div>
                    </div>

                    <!-- Porovnávací matice -->
                    <div class="control-section">
                        <div class="control-section-title">Přehled stanovisek a vyjádření</div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Zkontrolujte přiložené doklady, vyhodnoťte jejich obsah a zadejte podmínky pro rozhodnutí.
                        </p>
                    </div>

                    <div class="subjekty-matrix" id="subjektyMatrix">
                        <!-- Header -->
                        <div class="matrix-header extended">
                            <div class="matrix-header-cell">Subjekt</div>
                            <div class="matrix-header-cell">Žádost</div>
                            <div class="matrix-header-cell">Přiloženo</div>
                            <div class="matrix-header-cell">Výsledek</div>
                            <div class="matrix-header-cell">Podmínky</div>
                        </div>

                        <!-- DO skupina -->
                        <div class="matrix-group" data-group="do">
                            <div class="matrix-group-header">
                                <span class="material-icons-outlined">account_balance</span>
                                Dotčené orgány (DO) — závazná stanoviska
                                <span class="group-count" id="countDO">3</span>
                            </div>
                            <div class="matrix-group-content" id="matrixDO">
                                <!-- Dynamicky renderováno -->
                            </div>
                        </div>

                        <!-- VTI skupina -->
                        <div class="matrix-group" data-group="vti">
                            <div class="matrix-group-header">
                                <span class="material-icons-outlined">electric_bolt</span>
                                Vlastníci technické infrastruktury (VTI) — vyjádření
                                <span class="group-count" id="countVTI">4</span>
                            </div>
                            <div class="matrix-group-content" id="matrixVTI">
                                <!-- Dynamicky renderováno -->
                            </div>
                        </div>

                        <!-- VDI skupina -->
                        <div class="matrix-group" data-group="vdi">
                            <div class="matrix-group-header">
                                <span class="material-icons-outlined">directions_car</span>
                                Vlastníci dopravní infrastruktury (VDI) — vyjádření
                                <span class="group-count" id="countVDI">1</span>
                            </div>
                            <div class="matrix-group-content" id="matrixVDI">
                                <!-- Dynamicky renderováno -->
                            </div>
                        </div>

                        <!-- Přidat subjekt -->
                        <div class="matrix-add-row">
                            <select class="matrix-add-select" id="addSubjektTyp">
                                <option value="do">DO - Dotčený orgán</option>
                                <option value="vti">VTI - Vlastník tech. infrastruktury</option>
                                <option value="vdi">VDI - Vlastník dopr. infrastruktury</option>
                            </select>
                            <input type="text" class="matrix-add-input" id="addSubjektNazev" placeholder="Název subjektu...">
                            <button class="btn-add-subjekt" onclick="addSubjekt()">
                                <span class="material-icons-outlined">add</span>
                                Přidat
                            </button>
                        </div>
                    </div>

                    <!-- Souhrn pro rozhodnutí -->
                    <div class="souhrn-rozhodnuti" id="souhrnRozhodnuti">
                        <div class="souhrn-rozhodnuti-header">
                            <div class="souhrn-rozhodnuti-title">
                                <span class="material-icons-outlined">description</span>
                                Data pro rozhodnutí
                            </div>
                            <div class="souhrn-rozhodnuti-actions" id="reportActions" style="display: none;">
                                <button class="btn-report" onclick="showReportModal()" title="Zobrazit náhled reportu">
                                    <span class="material-icons-outlined">visibility</span>
                                    Náhled
                                </button>
                                <button class="btn-report" onclick="downloadReport('json')" title="Stáhnout data jako JSON">
                                    <span class="material-icons-outlined">data_object</span>
                                    JSON
                                </button>
                                <button class="btn-report" onclick="downloadReport('txt')" title="Stáhnout textový report">
                                    <span class="material-icons-outlined">download</span>
                                    TXT
                                </button>
                            </div>
                        </div>
                        <div class="souhrn-stats" id="souhrnStats">
                            <!-- Dynamicky renderováno -->
                        </div>
                    </div>

                    <!-- Výsledek kontroly -->
                    <div class="identifikace-result" id="identifikaceResult">
                        <div class="identifikace-result-title">Výsledek kontroly</div>
                        <div class="identifikace-result-items" id="identifikaceResultItems">
                            <!-- Dynamicky renderováno -->
                        </div>
                    </div>

                    <!-- Result preview -->
                    <div class="result-preview positive" id="resultIdentifikace">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Čeká na dokončení kontroly
                        </div>
                        <div class="result-preview-text">Zkontrolujte seznam subjektů a označte vyžadované.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveIdentifikace">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlIdentifikace')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('identifikace')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmIdentifikace" onclick="completeIdentifikace()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Soulad s ÚPD -->
    <div class="control-overlay" id="controlUP">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlUP')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">map</span>
                    Kontrola souladu s územně plánovací dokumentací
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchViewerTab(this, 'up', 'eed')">
                            <span class="material-icons-outlined">folder</span>
                            El. dokumentace
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'up', 'uplan')">
                            <span class="material-icons-outlined">map</span>
                            Územní plán
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('up')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-up">
                        <span class="material-icons-outlined">architecture</span>
                        <div class="viewer-placeholder-title">Elektronická dokumentace</div>
                        <div class="viewer-placeholder-text">Projektová dokumentace pro ověření souladu s ÚPD</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Existence územního plánu -->
                    <div class="control-section">
                        <div class="control-section-title">Existence územního plánu</div>
                        <div class="control-option" onclick="this.querySelector('input').checked = true; updateUPExistence()">
                            <input type="radio" name="up_existence" value="existuje" checked>
                            <div class="control-option-content">
                                <div class="control-option-title">Územní plán existuje</div>
                                <div class="control-option-desc">Obec má platný územní plán, záměr bude posouzen podle jeho regulativů.</div>
                            </div>
                        </div>
                        <div class="control-option" onclick="this.querySelector('input').checked = true; updateUPExistence()">
                            <input type="radio" name="up_existence" value="neexistuje">
                            <div class="control-option-content">
                                <div class="control-option-title">Územní plán neexistuje</div>
                                <div class="control-option-desc">Obec nemá územní plán. Zastavěným územím je intravilán (§ 325 SZ). Záměr bude posouzen podle § 193 odst. 1 písm. b).</div>
                            </div>
                        </div>
                    </div>

                    <!-- Info box pro případ neexistence ÚP -->
                    <div class="info-box warning" id="upNeexistujeInfo" style="display: none; margin-bottom: 20px;">
                        <div class="info-box-icon">
                            <span class="material-icons-outlined">info</span>
                        </div>
                        <div class="info-box-content">
                            <div class="info-box-title">Postup při neexistenci územního plánu</div>
                            <div class="info-box-text">
                                <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 12px; color: #5f6368;">
                                    <li>Za zastavěné území se považuje <strong>intravilán</strong> (§ 325 odst. 2 SZ)</li>
                                    <li>Záměr se posoudí podle <strong>§ 193 odst. 1 písm. b)</strong> - soulad s cíli a úkoly územního plánování, charakterem území</li>
                                    <li><strong>Zrychlené řízení nelze použít</strong> - podmínkou je existence ÚP (§ 212)</li>
                                    <li>V nezastavěném území omezené možnosti výstavby, nutný souhlas zastupitelstva obce</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- AI kontrola souladu -->
                    <div class="ai-control-section" id="aiControlSection">
                        <div class="ai-control-header">
                            <span class="material-icons-outlined">auto_awesome</span>
                            <span>Automatická kontrola souladu</span>
                        </div>
                        <p style="font-size: 13px; color: #5f6368; margin-bottom: 16px; font-style: normal;">
                            AI porovná projektovou dokumentaci s územně plánovací dokumentací a vytvoří compliance report.
                        </p>
                        <button class="btn btn-ai" id="btnAiKontrola" onclick="runAiCompliance()">
                            <span class="material-icons-outlined">auto_awesome</span>
                            Spustit AI kontrolu souladu
                        </button>
                    </div>

                    <!-- AI výsledek - skrytý dokud se nespustí -->
                    <div class="ai-result-section" id="aiResultSection" style="display: none;">
                        <div class="ai-result-header">
                            <span class="material-icons-outlined">auto_awesome</span>
                            <span>Výsledek AI kontroly</span>
                            <span class="ai-result-badge success">Dokončeno</span>
                        </div>
                        
                        <div class="ai-report-link" onclick="showComplianceReport()">
                            <span class="material-icons-outlined">description</span>
                            <div class="ai-report-link-content">
                                <div class="ai-report-link-title">Compliance report</div>
                                <div class="ai-report-link-meta">Vygenerováno 14. 1. 2026, 10:32</div>
                            </div>
                            <span class="material-icons-outlined">open_in_new</span>
                        </div>

                        <div class="ai-summary">
                            <div class="ai-summary-item success">
                                <span class="material-icons-outlined">check_circle</span>
                                <span>8 položek v souladu</span>
                            </div>
                            <div class="ai-summary-item warning">
                                <span class="material-icons-outlined">warning</span>
                                <span>1 položka k ověření</span>
                            </div>
                            <div class="ai-summary-item error">
                                <span class="material-icons-outlined">cancel</span>
                                <span>0 rozporů</span>
                            </div>
                        </div>
                    </div>

                    <!-- AI report detail - skrytý -->
                    <div class="ai-report-detail" id="aiReportDetail" style="display: none;">
                        <div class="ai-report-detail-header">
                            <span class="ai-report-detail-title">Compliance report</span>
                            <button class="ai-report-close" onclick="hideComplianceReport()">
                                <span class="material-icons-outlined">close</span>
                            </button>
                        </div>
                        
                        <div class="ai-report-content">
                            <div class="ai-report-group">
                                <div class="ai-report-group-title success">
                                    <span class="material-icons-outlined">check_circle</span>
                                    V souladu s ÚPD
                                </div>
                                
                                <div class="ai-report-item">
                                    <div class="ai-report-item-title">Funkční využití pozemku</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                    <div class="ai-report-item-detail">
                                        <div class="ai-report-source">
                                            <span class="source-label">Dokumentace:</span>
                                            <span class="source-path">A. Průvodní zpráva → A.1 Identifikační údaje → účel stavby</span>
                                        </div>
                                        <div class="ai-report-source">
                                            <span class="source-label">Územní plán:</span>
                                            <span class="source-path">Výkres č. 1 Základní členění → plocha BI (bydlení individuální)</span>
                                        </div>
                                        <div class="ai-report-note">Rodinný dům je přípustné využití v ploše BI.</div>
                                    </div>
                                </div>

                                <div class="ai-report-item">
                                    <div class="ai-report-item-title">Koeficient zastavění</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                    <div class="ai-report-item-detail">
                                        <div class="ai-report-source">
                                            <span class="source-label">Dokumentace:</span>
                                            <span class="source-path">C. Situační výkresy → C.2 Zastavovací plán → zastavěná plocha 156 m²</span>
                                        </div>
                                        <div class="ai-report-source">
                                            <span class="source-label">Územní plán:</span>
                                            <span class="source-path">Regulativy → BI-3 → max. koeficient zastavění 0,35</span>
                                        </div>
                                        <div class="ai-report-note">Skutečný koeficient 0,28 (156/560 m²) ≤ povolených 0,35.</div>
                                    </div>
                                </div>

                                <div class="ai-report-item">
                                    <div class="ai-report-item-title">Výška stavby</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                    <div class="ai-report-item-detail">
                                        <div class="ai-report-source">
                                            <span class="source-label">Dokumentace:</span>
                                            <span class="source-path">D. Dokumentace objektů → D.1.1 Architektonické řešení → výška 7,2 m</span>
                                        </div>
                                        <div class="ai-report-source">
                                            <span class="source-label">Územní plán:</span>
                                            <span class="source-path">Regulativy → BI-3 → max. výška 9,0 m</span>
                                        </div>
                                        <div class="ai-report-note">Výška 7,2 m ≤ povolených 9,0 m.</div>
                                    </div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Odstupové vzdálenosti</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Počet podlaží</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Tvar střechy</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Napojení na komunikaci</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Parkování na pozemku</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>
                            </div>

                            <div class="ai-report-group">
                                <div class="ai-report-group-title warning">
                                    <span class="material-icons-outlined">warning</span>
                                    K ověření
                                </div>
                                
                                <div class="ai-report-item">
                                    <div class="ai-report-item-title">Ochranné pásmo lesa</div>
                                    <div class="ai-report-item-result warning">K ověření</div>
                                    <div class="ai-report-item-detail">
                                        <div class="ai-report-source">
                                            <span class="source-label">Dokumentace:</span>
                                            <span class="source-path">C. Situační výkresy → C.3 Koordinační situace → vzdálenost od okraje lesa</span>
                                        </div>
                                        <div class="ai-report-source">
                                            <span class="source-label">Územní plán:</span>
                                            <span class="source-path">Výkres č. 3 Limity využití → ochranné pásmo 50 m od okraje lesa</span>
                                        </div>
                                        <div class="ai-report-note warning">
                                            <span class="material-icons-outlined">info</span>
                                            Stavba se nachází cca 48 m od okraje lesa. AI nedokázala přesně určit vzdálenost z dokumentace. 
                                            Doporučujeme manuální ověření nebo vyžádání stanoviska orgánu státní správy lesů.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="control-section" id="upVysledekSection">
                        <div class="control-section-title">Výsledek kontroly souladu s ÚPD</div>
                        <label class="control-option selected" onclick="selectOption(this); updateUPResult()">
                            <input type="radio" name="up_vysledek" value="soulad" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr je v souladu s územně plánovací dokumentací</div>
                            </div>
                        </label>
                        <label class="control-option" onclick="selectOption(this, true); updateUPResult()">
                            <input type="radio" name="up_vysledek" value="nesoulad">
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr není v souladu s územně plánovací dokumentací</div>
                                <div class="control-option-desc">Žádost bude zamítnuta</div>
                            </div>
                        </label>
                        
                        <!-- Zdůvodnění nesouladu - zobrazí se jen při nesouladu -->
                        <div class="control-section" id="zduvodneniNesouladuSection" style="display: none; margin-top: 16px;">
                            <div class="control-section-title" style="color: #c5221f;">
                                <span class="material-icons-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 4px;">error</span>
                                Zdůvodnění nesouladu s ÚPD
                            </div>
                            <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                                Uveďte konkrétní důvody nesouladu s územně plánovací dokumentací. 
                                Text bude součástí dokumentu <strong>Rozhodnutí o zamítnutí žádosti</strong>.
                            </p>
                            <textarea id="upPoznamky" class="form-textarea" rows="5" 
                                placeholder="Např.: Záměr je v rozporu s regulativy územního plánu - plocha BV (bydlení venkovské) neumožňuje stavbu garáží pro více než 3 vozidla..."
                                oninput="updateUPConfirmButton()"
                                style="width: 100%; padding: 12px; border: 1px solid #f5c6c5; border-radius: 6px; font-size: 13px; font-family: inherit; resize: vertical; line-height: 1.5; background: #fef7f6;"></textarea>
                        </div>
                        
                        <!-- Poznámky pro soulad - běžné poznámky -->
                        <div style="margin-top: 16px;" id="poznamkySouladSection">
                            <label class="form-label" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: #202124;">
                                Poznámky pro rozhodnutí
                                <span style="font-weight: 400; color: #5f6368;">(volitelné)</span>
                            </label>
                            <textarea id="upPoznamkySoulad" class="form-textarea" rows="3" placeholder="Zadejte poznámky k posouzení souladu s územně plánovací dokumentací..." style="width: 100%; padding: 12px; border: 1px solid #dadce0; border-radius: 6px; font-size: 13px; font-family: inherit; resize: vertical; line-height: 1.5;"></textarea>
                        </div>
                    </div>

                    <div class="result-preview positive" id="resultUP">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Záměr je v souladu s ÚPD
                        </div>
                        <div class="result-preview-text">Záměr je v souladu s platnou územně plánovací dokumentací.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveUP">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlUP')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('up')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeUP()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Osoby -->
    <div class="control-overlay" id="controlUcastnici">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlUcastnici')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">groups</span>
                    Osoby
                </div>
            </div>
        </div>
        <div class="control-body" style="display: block;">
            <div class="control-form" style="width: 100%; border-left: none;">
                <div class="control-form-body osoby-layout">
                    
                    <!-- ========== LEVÝ SLOUPEC: POZEMKY ========== -->
                    <div class="osoby-col-pozemky">
                        <div class="osoby-col-header">
                            <span class="material-icons-outlined">terrain</span>
                            Pozemky
                            <button class="btn-overit-vse-sm" onclick="overitVsechnyPozemkyKN()">
                                <span class="material-icons-outlined">verified</span>
                                Načíst osoby z KN
                            </button>
                        </div>
                        
                        <div class="osoby-pozemky-content">
                            <!-- Pozemky záměru -->
                            <div class="pozemky-blok">
                                <div class="pozemky-blok-header zamer">
                                    <span class="pozemky-blok-title">Pozemky záměru</span>
                                    <span class="pozemky-blok-count" id="countZamer">2</span>
                                </div>
                                <div class="pozemky-blok-list" id="listPozemkyZameru">
                                    <div class="pozemek-item" data-parcela="st. 123">
                                        <span class="pozemek-parcela">st. 123</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-st123">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('st. 123', 'Jaroměř')">Ověřit</button>
                                    </div>
                                    <div class="pozemek-item" data-parcela="456/1">
                                        <span class="pozemek-parcela">456/1</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-4561">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('456/1', 'Jaroměř')">Ověřit</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sousední pozemky -->
                            <div class="pozemky-blok">
                                <div class="pozemky-blok-header soused">
                                    <span class="pozemky-blok-title">Sousední pozemky</span>
                                    <span class="pozemky-blok-count" id="countSoused">4</span>
                                </div>
                                <div class="pozemky-blok-list" id="listSousedniPozemky">
                                    <div class="pozemek-item" data-parcela="st. 122">
                                        <span class="pozemek-parcela">st. 122</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-st122">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('st. 122', 'Jaroměř')">Ověřit</button>
                                    </div>
                                    <div class="pozemek-item" data-parcela="st. 124">
                                        <span class="pozemek-parcela">st. 124</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-st124">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('st. 124', 'Jaroměř')">Ověřit</button>
                                    </div>
                                    <div class="pozemek-item" data-parcela="456/2">
                                        <span class="pozemek-parcela">456/2</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-4562">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('456/2', 'Jaroměř')">Ověřit</button>
                                    </div>
                                    <div class="pozemek-item" data-parcela="457">
                                        <span class="pozemek-parcela">457</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-457">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('457', 'Jaroměř')">Ověřit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ========== PRAVÝ SLOUPEC: ÚČASTNÍCI ========== -->
                    <div class="osoby-col-ucastnici">
                        <div class="osoby-col-header">
                            <div class="osoby-tabs-inline">
                                <button class="osoby-tab-btn active" onclick="switchOsobyTab(this, 'ucastnici')">
                                    Účastníci <span class="osoby-tab-count" id="tabCountUcastnici">2</span>
                                </button>
                                <button class="osoby-tab-btn" onclick="switchOsobyTab(this, 'zastupci')">
                                    Zástupci <span class="osoby-tab-count" id="tabCountZastupci">0</span>
                                </button>
                                <button class="osoby-tab-btn" onclick="switchOsobyTab(this, 'dotceneOrgany')">
                                    Dotčené orgány <span class="osoby-tab-count" id="tabCountDotceneOrgany">0</span>
                                </button>
                                <button class="osoby-tab-btn" onclick="switchOsobyTab(this, 'dalsi')">
                                    Další osoby <span class="osoby-tab-count" id="tabCountDalsi">1</span>
                                </button>
                            </div>
                            <div class="osoby-header-actions">
                                <button class="btn-overit-osoby" onclick="overitVsechnyOsoby()">
                                    <span class="material-icons-outlined">verified_user</span>
                                    Ověřit všechny
                                </button>
                                <button class="btn-add-osoba" onclick="addUcastnik('manual')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat
                                </button>
                            </div>
                        </div>
                        
                        <!-- Panel: Účastníci -->
                        <div class="osoby-tab-panel active" id="tabPanelUcastnici">
                            <table class="osoby-table">
                                <thead>
                                    <tr>
                                        <th style="width: 28px;"></th>
                                        <th>Účastník</th>
                                        <th>Adresa / Poznámka</th>
                                        <th style="width: 50px;">Zdroj</th>
                                        <th style="width: 60px;">Doruč.</th>
                                        <th style="width: 110px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyUcastnici">
                                    <!-- Stavebník -->
                                    <tr class="osoby-kategorie-row">
                                        <td colspan="6">
                                            <span class="kategorie-label">Stavebník / Žadatel</span>
                                        </td>
                                    </tr>
                                    <tr data-osoba-id="jan-novak" data-overeno="true">
                                        <td><span class="os-status ok" title="Ověřeno z Portálu stavebníka"><span class="material-icons-outlined">check_circle</span></span></td>
                                        <td><strong>Jan Novák</strong><br><small class="text-muted">Fyzická osoba</small></td>
                                        <td>
                                            Květná 123, 110 00 Praha 1
                                            <span class="os-ds-info"><span class="material-icons-outlined">forward_to_inbox</span> abc123x</span>
                                        </td>
                                        <td><span class="os-zdroj zdroj-zadost">žádost</span></td>
                                        <td>
                                            <button class="btn-dorucovani ds" onclick="toggleDorucovani(this)" title="Doručit do datové schránky" data-stav="ds" data-ds="abc123x">
                                                <span class="material-icons-outlined">forward_to_inbox</span>
                                            </button>
                                        </td>
                                        <td class="os-actions">
                                            <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                                        </td>
                                    </tr>
                                    
                                    <!-- Obec -->
                                    <tr class="osoby-kategorie-row">
                                        <td colspan="6">
                                            <span class="kategorie-label">Obec</span>
                                        </td>
                                    </tr>
                                    <tr data-osoba-id="mesto-jaromer" data-overeno="false">
                                        <td><span class="os-status pending" title="Neověřeno"><span class="material-icons-outlined">help_outline</span></span></td>
                                        <td><strong>Město Jaroměř</strong><br><small class="text-muted">Právnická osoba</small></td>
                                        <td class="os-adresa-neovereno">—</td>
                                        <td><span class="os-zdroj zdroj-ku">k.ú.</span></td>
                                        <td>
                                            <span class="doruc-ceka" title="Čeká na ověření">—</span>
                                        </td>
                                        <td class="os-actions">
                                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku">
                                                <span class="material-icons-outlined">verified_user</span>
                                            </button>
                                            <button class="is-favorited" onclick="toggleOblibeny(this)" title="V oblíbených"><span class="material-icons-outlined">star</span></button>
                                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                                        </td>
                                    </tr>
                                    
                                    <!-- Vlastníci pozemků záměru -->
                                    <tr class="osoby-kategorie-row" id="katVlastniciZameru">
                                        <td colspan="6">
                                            <span class="kategorie-label">Vlastníci pozemků záměru</span>
                                            <span class="kategorie-stav ceka">čeká na ověření z KN</span>
                                        </td>
                                    </tr>
                                    <tr class="osoby-empty-row" id="emptyVlastniciZameru">
                                        <td colspan="6" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">hourglass_empty</span>
                                            Ověřte pozemky záměru
                                        </td>
                                    </tr>
                                    
                                    <!-- Vlastníci sousedních pozemků -->
                                    <tr class="osoby-kategorie-row" id="katVlastniciSousedi">
                                        <td colspan="6">
                                            <span class="kategorie-label">Vlastníci sousedních pozemků</span>
                                            <span class="kategorie-stav ceka">čeká na ověření z KN</span>
                                        </td>
                                    </tr>
                                    <tr class="osoby-empty-row" id="emptyVlastniciSousedi">
                                        <td colspan="6" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">hourglass_empty</span>
                                            Ověřte sousední pozemky
                                        </td>
                                    </tr>
                                    
                                    <!-- Ostatní účastníci -->
                                    <tr class="osoby-kategorie-row">
                                        <td colspan="6">
                                            <span class="kategorie-label">Ostatní účastníci</span>
                                            <button class="btn-nacist-vti" onclick="nacistVTIVDI()">
                                                <span class="material-icons-outlined">download</span>
                                                Načíst VTI/VDI
                                            </button>
                                        </td>
                                    </tr>
                                    <tr class="osoby-empty-row" id="emptyOstatniUcastnici">
                                        <td colspan="6" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">business</span>
                                            Vlastníci infrastruktury — načtěte z Dokladové části
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Panel: Zástupci -->
                        <div class="osoby-tab-panel" id="tabPanelZastupci">
                            <!-- Toolbar zástupců -->
                            <div class="zastupci-toolbar">
                                <div class="zastupci-toolbar-left">
                                    <span class="zastupci-info">
                                        <span class="material-icons-outlined">info</span>
                                        Zástupce doručuje místo zastupovaného účastníka
                                    </span>
                                </div>
                                <div class="zastupci-toolbar-right">
                                    <button class="btn btn-sm btn-secondary" onclick="openPridatZastupceModal()">
                                        <span class="material-icons-outlined">add</span>
                                        Přidat zástupce
                                    </button>
                                    <button class="btn btn-sm btn-outline" onclick="pridatZastupceZOblibenych()">
                                        <span class="material-icons-outlined">star</span>
                                        Z oblíbených
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Tabulka zástupců -->
                            <table class="osoby-table" id="tableZastupci">
                                <thead>
                                    <tr>
                                        <th style="width: 24px;"></th>
                                        <th>Zástupce</th>
                                        <th>Zastupovaný</th>
                                        <th>Role zastupovaného</th>
                                        <th style="width: 90px;">Doručovat</th>
                                        <th style="width: 100px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyZastupci">
                                    <tr class="osoby-empty-row" id="emptyZastupci">
                                        <td colspan="6" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">supervisor_account</span>
                                            Žádní zástupci — přidejte zástupce tlačítkem výše
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Panel: Dotčené orgány -->
                        <div class="osoby-tab-panel" id="tabPanelDotceneOrgany">
                            <!-- Toolbar dotčených orgánů -->
                            <div class="zastupci-toolbar">
                                <div class="zastupci-toolbar-left">
                                    <span class="zastupci-info">
                                        <span class="material-icons-outlined">info</span>
                                        Dotčené orgány jsou načítány z Dokladové části
                                    </span>
                                </div>
                                <div class="zastupci-toolbar-right">
                                    <button class="btn btn-sm btn-secondary" onclick="nacistDotceneOrgany()">
                                        <span class="material-icons-outlined">download</span>
                                        Načíst z Dokladové části
                                    </button>
                                    <button class="btn btn-sm btn-outline" onclick="pridatDotcenyOrgan()">
                                        <span class="material-icons-outlined">add</span>
                                        Přidat ručně
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Tabulka dotčených orgánů -->
                            <table class="osoby-table" id="tableDotceneOrgany">
                                <thead>
                                    <tr>
                                        <th style="width: 24px;"></th>
                                        <th>Dotčený orgán</th>
                                        <th>Typ závazného stanoviska</th>
                                        <th style="width: 90px;">Stav</th>
                                        <th style="width: 100px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyDotceneOrgany">
                                    <tr class="osoby-empty-row" id="emptyDotceneOrgany">
                                        <td colspan="5" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">account_balance</span>
                                            Žádné dotčené orgány — načtěte z Dokladové části
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Panel: Další osoby -->
                        <div class="osoby-tab-panel" id="tabPanelDalsi">
                            <table class="osoby-table">
                                <thead>
                                    <tr>
                                        <th style="width: 24px;"></th>
                                        <th>Osoba</th>
                                        <th>Role</th>
                                        <th style="width: 100px;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="os-status ok"><span class="material-icons-outlined">check_circle</span></span></td>
                                        <td><strong>Ing. arch. Alois Hrejsísemnou</strong><br><small class="text-muted">Fyzická osoba</small></td>
                                        <td><span class="os-role">hlavní projektant</span></td>
                                        <td class="os-actions">
                                            <button class="is-favorited" onclick="toggleOblibeny(this)" title="V oblíbených"><span class="material-icons-outlined">star</span></button>
                                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                                            <button title="Odstranit"><span class="material-icons-outlined">delete</span></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveUcastnici">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlUcastnici')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('ucastnici')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeUcastnici()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit osoby
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Přidat zástupce -->
    <div class="modal-overlay" id="modalPridatZastupce" style="display: none;">
        <div class="modal-dialog" style="max-width: 550px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span class="material-icons-outlined">supervisor_account</span>
                    Přidat zástupce
                </h3>
                <button class="modal-close" onclick="closeModalZastupce()">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Krok 1: Údaje o zástupci -->
                <div class="form-section">
                    <div class="form-section-title">1. Údaje o zástupci</div>
                    
                    <div class="form-row">
                        <label class="form-label">Typ osoby</label>
                        <div class="form-radio-group">
                            <label class="form-radio">
                                <input type="radio" name="zastupce_typ" value="FO" checked onchange="toggleZastupceForm()">
                                <span>Fyzická osoba</span>
                            </label>
                            <label class="form-radio">
                                <input type="radio" name="zastupce_typ" value="PO" onchange="toggleZastupceForm()">
                                <span>Právnická osoba</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- FO formulář -->
                    <div id="zastupceFormFO">
                        <div class="form-row-3col">
                            <div class="form-group">
                                <label class="form-label">Jméno *</label>
                                <input type="text" class="form-input" id="zastupceJmeno" placeholder="Jan">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Příjmení *</label>
                                <input type="text" class="form-input" id="zastupcePrijmeni" placeholder="Novák">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Datum narození *</label>
                                <input type="date" class="form-input" id="zastupceDatumNarozeni">
                            </div>
                        </div>
                        <div class="form-verify-row">
                            <button type="button" class="btn btn-sm btn-outline" onclick="overitZastupceZRejstriku('FO')">
                                <span class="material-icons-outlined">verified_user</span>
                                Ověřit z rejstříku
                            </button>
                            <span class="verify-status" id="verifyStatusFO"></span>
                        </div>
                        
                        <!-- Doplněné údaje po ověření -->
                        <div id="zastupceDetailFO" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Adresa trvalého pobytu</label>
                                <input type="text" class="form-input" id="zastupceAdresaFO" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PO formulář -->
                    <div id="zastupceFormPO" style="display: none;">
                        <div class="form-row-ico">
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label">IČO *</label>
                                <input type="text" class="form-input" id="zastupceICO" placeholder="12345678" maxlength="8">
                            </div>
                            <button type="button" class="btn btn-sm btn-outline btn-verify-ico" onclick="overitZastupceZRejstriku('PO')">
                                <span class="material-icons-outlined">verified_user</span>
                                Ověřit z rejstříku
                            </button>
                        </div>
                        <span class="verify-status" id="verifyStatusPO"></span>
                        
                        <!-- Doplněné údaje po ověření -->
                        <div id="zastupceDetailPO" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Název organizace</label>
                                <input type="text" class="form-input" id="zastupceNazev" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sídlo</label>
                                <input type="text" class="form-input" id="zastupceAdresaPO" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Krok 2: Výběr zastupovaných -->
                <div class="form-section">
                    <div class="form-section-title">2. Zastupované osoby</div>
                    <p class="form-hint">Vyberte účastníky, které bude zástupce zastupovat. Lze vybrat více osob.</p>
                    
                    <div class="zastupovani-list" id="zastupovaniList">
                        <!-- Stavebník -->
                        <label class="zastupovani-item">
                            <input type="checkbox" name="zastupovani" value="jan-novak">
                            <div class="zastupovani-info">
                                <span class="zastupovani-name">Jan Novák</span>
                                <span class="zastupovani-role">Stavebník / Žadatel</span>
                            </div>
                        </label>
                        
                        <!-- Obec -->
                        <label class="zastupovani-item">
                            <input type="checkbox" name="zastupovani" value="mesto-jaromer">
                            <div class="zastupovani-info">
                                <span class="zastupovani-name">Město Jaroměř</span>
                                <span class="zastupovani-role">Obec</span>
                            </div>
                        </label>
                        
                        <!-- Další účastníci se přidají dynamicky po ověření z KN -->
                        <div id="zastupovaniDynamicList"></div>
                    </div>
                </div>
                
                <!-- Krok 3: Nastavení doručování -->
                <div class="form-section">
                    <div class="form-section-title">3. Nastavení doručování</div>
                    
                    <label class="form-checkbox">
                        <input type="checkbox" id="zastupceNedorucovat" checked>
                        <span>Nedoručovat zastupovaným osobám <small class="text-muted">(doporučeno)</small></span>
                    </label>
                    
                    <p class="form-hint" style="margin-top: 8px;">
                        <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle;">info</span>
                        Pokud je zaškrtnuto, dokumenty budou doručovány pouze zástupci, nikoliv zastupovaným osobám.
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModalZastupce()">Zrušit</button>
                <button class="btn btn-primary" onclick="pridatZastupce()">
                    <span class="material-icons-outlined">add</span>
                    Přidat zástupce
                </button>
            </div>
        </div>
    </div>

    <!-- Kontrola: Zrychlené řízení -->
    <div class="control-overlay" id="controlZrychlene">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlZrychlene')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">bolt</span>
                    Podmínky zrychleného řízení
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchViewerTab(this, 'zrychlene', 'zadost')">
                            <span class="material-icons-outlined">description</span>
                            Žádost
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'prilohy')">
                            <span class="material-icons-outlined">attach_file</span>
                            Přílohy
                            <span class="badge">12</span>
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'eed')">
                            <span class="material-icons-outlined">folder</span>
                            El. dokumentace
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'doklady')">
                            <span class="material-icons-outlined">fact_check</span>
                            Dokladová část
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('zrychlene')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-zrychlene">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">Souhrnná kontrola podmínek pro zrychlené řízení</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <div class="control-section">
                        <div class="control-section-title">Podmínky podle § 212 stavebního zákona</div>
                        <p style="font-size: 13px; color: #5f6368; margin-bottom: 16px; font-style: normal;">
                            Ověřte splnění všech podmínek pro zrychlené řízení:
                        </p>
                        
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_uplnost" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Žádost je úplná</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_eia" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr nevyžaduje posouzení vlivů na ŽP</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_up" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr je v souladu s ÚP</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_stanoviska" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Stanoviska DO jsou kladná nebo s podmínkami</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_souhlasy" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Souhlasy účastníků jsou přiloženy</div>
                            </div>
                        </label>
                    </div>

                    <div class="result-preview positive" id="resultZrychlene">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Podmínky splněny
                        </div>
                        <div class="result-preview-text">Všechny podmínky pro zrychlené řízení jsou splněny.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveZrychlene">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlZrychlene')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('zrychlene')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeZrychlene()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- POMOCNÉ MODÁLY PRO NÁHLED DOKUMENTŮ -->
    <!-- ============================================ -->
    <div class="modal-overlay" id="zadostModal" onclick="closeModal('zadostModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">description</span>
                    Žádost o povolení stavby
                </div>
                <button class="modal-close" onclick="closeModal('zadostModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">preview</span>
                    <p style="margin-top: 16px; color: #5f6368;">Náhled žádosti o povolení stavby</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('zadostModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Modal: REZA - Informace o elektronické plné moci -->
    <div class="modal-overlay" id="rezaModal" onclick="closeModal('rezaModal', event)">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header" style="padding: 0; border: none;">
                <div class="reza-header" style="width: 100%; border-radius: 8px 8px 0 0;">
                    <div class="reza-logo">
                        <span class="material-icons-outlined">verified_user</span>
                    </div>
                    <div class="reza-header-text">
                        <div class="reza-title">Registr elektronických zastoupení</div>
                        <div class="reza-subtitle">Ověřená elektronická plná moc</div>
                    </div>
                    <div class="reza-verified-badge">
                        <span class="material-icons-outlined">check_circle</span>
                        Platná
                    </div>
                </div>
                <button class="modal-close" onclick="closeModal('rezaModal')" style="position: absolute; top: 12px; right: 12px; background: rgba(255,255,255,0.9);">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="reza-body" id="rezaModalBody">
                <!-- Obsah bude doplněn dynamicky -->
            </div>
            <div class="reza-footer">
                <div class="reza-footer-info">
                    Údaje z <a href="#">REZA - Registr elektronických zastoupení</a>
                </div>
                <button class="btn btn-secondary" onclick="closeModal('rezaModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Modal: Přílohy pro vyhledání plné moci -->
    <div class="modal-overlay" id="prilohyPMModal" onclick="closeModal('prilohyPMModal', event)">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">attach_file</span>
                    Přílohy žádosti
                </div>
                <button class="modal-close" onclick="closeModal('prilohyPMModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div style="padding: 12px 20px; background: #fff3e0; border-bottom: 1px solid #ffe082;">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: #e65100;">
                        <span class="material-icons-outlined" style="font-size: 20px;">info</span>
                        <span>Vyhledejte a zkontrolujte potřebné dokumenty v přílohách žádosti (PDF).</span>
                    </div>
                </div>
                <div style="padding: 16px 20px;">
                    <div class="zadost-prilohy-list" id="prilohyPMList">
                        <div class="zadost-priloha-item attached" style="background: #fff3e0; border: 1px solid #ffe082;">
                            <div class="priloha-icon" style="color: #e65100;">
                                <span class="material-icons-outlined">description</span>
                            </div>
                            <div class="priloha-info">
                                <div class="priloha-name" style="font-weight: 600;">Plná moc — listinná</div>
                                <div class="priloha-status">Přiloženo jako PDF • plna_moc_novak.pdf • 245 KB</div>
                            </div>
                            <button class="priloha-action" style="background: #e65100; color: #fff; border-radius: 4px; padding: 6px 12px; border: none; cursor: pointer;" title="Otevřít ke kontrole">
                                <span class="material-icons-outlined">visibility</span>
                            </button>
                        </div>
                        
                        <div class="zadost-priloha-item attached">
                            <div class="priloha-icon">
                                <span class="material-icons-outlined">description</span>
                            </div>
                            <div class="priloha-info">
                                <div class="priloha-name">Souhlas vlastníka pozemku</div>
                                <div class="priloha-status">Přiloženo jako PDF • souhlas_vlastnika.pdf • 128 KB</div>
                            </div>
                            <button class="priloha-action" title="Otevřít">
                                <span class="material-icons-outlined">visibility</span>
                            </button>
                        </div>
                        
                        <div class="zadost-priloha-item attached">
                            <div class="priloha-icon">
                                <span class="material-icons-outlined">description</span>
                            </div>
                            <div class="priloha-info">
                                <div class="priloha-name">Čestné prohlášení</div>
                                <div class="priloha-status">Přiloženo jako PDF • cestne_prohlaseni.pdf • 89 KB</div>
                            </div>
                            <button class="priloha-action" title="Otevřít">
                                <span class="material-icons-outlined">visibility</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('prilohyPMModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="prilohyModal" onclick="closeModal('prilohyModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">attach_file</span>
                    Přílohy žádosti
                </div>
                <button class="modal-close" onclick="closeModal('prilohyModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">folder_open</span>
                    <p style="margin-top: 16px; color: #5f6368;">Seznam příloh žádosti (12)</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('prilohyModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="eedModal" onclick="closeModal('eedModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">folder</span>
                    Elektronická dokumentace
                </div>
                <button class="modal-close" onclick="closeModal('eedModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">architecture</span>
                    <p style="margin-top: 16px; color: #5f6368;">Projektová dokumentace v EED</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('eedModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="dokladyModal" onclick="closeModal('dokladyModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">fact_check</span>
                    Dokladová část
                </div>
                <button class="modal-close" onclick="closeModal('dokladyModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">checklist</span>
                    <p style="margin-top: 16px; color: #5f6368;">Stanoviska DO a vyjádření správců sítí</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('dokladyModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Modal pro BIM model -->
    <div class="modal-overlay" id="bimModal" onclick="closeModal('bimModal', event)">
        <div class="modal modal-large" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">view_in_ar</span>
                    BIM model
                </div>
                <button class="modal-close" onclick="closeModal('bimModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <!-- BIM info panel -->
                <div style="padding: 16px 24px; background: #f8f9fa; border-bottom: 1px solid #e0e0e0;">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
                        <div>
                            <div style="font-size: 14px; font-weight: 600; color: #202124; margin-bottom: 4px;">Novostavba rodinného domu s garáží</div>
                            <div style="font-size: 12px; color: #5f6368;">IFC model · Verze 3.0 · Nahrán 10. 1. 2026</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">
                                <span class="material-icons-outlined" style="font-size: 16px; margin-right: 4px;">download</span>
                                Stáhnout IFC
                            </button>
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">
                                <span class="material-icons-outlined" style="font-size: 16px; margin-right: 4px;">open_in_new</span>
                                Otevřít v prohlížeči
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- BIM viewer placeholder -->
                <div style="height: 450px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;">
                    <!-- 3D grid simulace -->
                    <div style="position: absolute; inset: 0; opacity: 0.1; background-image: 
                        linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
                        background-size: 40px 40px;"></div>
                    
                    <!-- Model placeholder -->
                    <div style="position: relative; z-index: 1; text-align: center;">
                        <div style="width: 200px; height: 140px; margin: 0 auto 24px; position: relative;">
                            <!-- Jednoduchá 3D ikona domu -->
                            <svg viewBox="0 0 200 140" style="width: 100%; height: 100%;">
                                <!-- Základna -->
                                <path d="M30 100 L100 130 L170 100 L100 70 Z" fill="#4fc3f7" opacity="0.3"/>
                                <!-- Přední stěna -->
                                <path d="M30 100 L30 50 L100 20 L100 70 Z" fill="#29b6f6" opacity="0.7"/>
                                <!-- Boční stěna -->
                                <path d="M100 70 L100 20 L170 50 L170 100 Z" fill="#0288d1" opacity="0.7"/>
                                <!-- Střecha přední -->
                                <path d="M20 50 L100 10 L100 20 L30 50 Z" fill="#ff7043" opacity="0.8"/>
                                <!-- Střecha boční -->
                                <path d="M100 10 L180 50 L170 50 L100 20 Z" fill="#e64a19" opacity="0.8"/>
                                <!-- Okna -->
                                <rect x="45" y="60" width="20" height="25" fill="#81d4fa" opacity="0.9"/>
                                <rect x="120" y="55" width="20" height="25" fill="#4fc3f7" opacity="0.9"/>
                            </svg>
                        </div>
                        <div style="color: #fff; font-size: 16px; font-weight: 500; margin-bottom: 8px;">
                            <span class="material-icons-outlined" style="font-size: 24px; vertical-align: middle; margin-right: 8px;">view_in_ar</span>
                            3D BIM Model
                        </div>
                        <div style="color: rgba(255,255,255,0.6); font-size: 13px;">
                            V ostré verzi by se zde zobrazil interaktivní 3D model stavby
                        </div>
                    </div>
                    
                    <!-- Ovládací prvky simulace -->
                    <div style="position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px;">
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Otočit vlevo">
                            <span class="material-icons-outlined" style="font-size: 18px;">rotate_left</span>
                        </button>
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Přiblížit">
                            <span class="material-icons-outlined" style="font-size: 18px;">zoom_in</span>
                        </button>
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Oddálit">
                            <span class="material-icons-outlined" style="font-size: 18px;">zoom_out</span>
                        </button>
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Otočit vpravo">
                            <span class="material-icons-outlined" style="font-size: 18px;">rotate_right</span>
                        </button>
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Celá obrazovka">
                            <span class="material-icons-outlined" style="font-size: 18px;">fullscreen</span>
                        </button>
                    </div>
                </div>
                
                <!-- BIM metadata -->
                <div style="padding: 20px 24px; border-top: 1px solid #e0e0e0;">
                    <div style="font-size: 13px; font-weight: 600; color: #202124; margin-bottom: 12px;">Informace o modelu</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Formát</div>
                            <div style="font-size: 13px; color: #202124;">IFC 4.0 (Industry Foundation Classes)</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Velikost souboru</div>
                            <div style="font-size: 13px; color: #202124;">24.8 MB</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Software</div>
                            <div style="font-size: 13px; color: #202124;">Autodesk Revit 2024</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Počet elementů</div>
                            <div style="font-size: 13px; color: #202124;">1,247 objektů</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Zpracoval</div>
                            <div style="font-size: 13px; color: #202124;">Ing. arch. Pavel Projektant</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">LOD (Level of Detail)</div>
                            <div style="font-size: 13px; color: #202124;">LOD 300</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('bimModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Modal pro editaci podmínek subjektu -->
    <div class="podminky-modal-overlay" id="podminkyModal">
        <div class="podminky-modal">
            <div class="podminky-modal-header">
                <div class="podminky-modal-title">
                    <span class="material-icons-outlined">edit_note</span>
                    <span id="podminkyModalTitle">Podmínky subjektu</span>
                </div>
                <button class="podminky-modal-close" onclick="closePodminkyModal()">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="podminky-modal-body">
                <!-- Info o dokumentu -->
                <div class="podminky-section">
                    <div class="podminky-section-title">Informace o dokladu</div>
                    <div class="dokument-info">
                        <div class="dokument-info-item">
                            <div class="dokument-info-label">Typ dokladu</div>
                            <div class="dokument-info-value" id="podminkyDokTyp">—</div>
                        </div>
                        <div class="dokument-info-item">
                            <div class="dokument-info-label">Číslo jednací</div>
                            <div class="dokument-info-value">
                                <input type="text" id="podminkyDokCj" placeholder="Např. MMHK/349238/2025">
                            </div>
                        </div>
                        <div class="dokument-info-item">
                            <div class="dokument-info-label">Datum vydání</div>
                            <div class="dokument-info-value">
                                <input type="date" id="podminkyDokDatum">
                            </div>
                        </div>
                        <div class="dokument-info-item">
                            <div class="dokument-info-label">Soubor</div>
                            <div class="dokument-info-value" id="podminkyDokSoubor">—</div>
                        </div>
                    </div>
                </div>

                <!-- Výsledek posouzení -->
                <div class="podminky-section">
                    <div class="podminky-section-title">Výsledek posouzení</div>
                    <div class="vysledek-options" id="vysledekOptions">
                        <label class="vysledek-option kladne">
                            <input type="radio" name="vysledekRadio" value="kladne">
                            <div class="vysledek-option-icon">
                                <span class="material-icons-outlined">check_circle</span>
                            </div>
                            <span class="vysledek-option-label">Kladné</span>
                        </label>
                        <label class="vysledek-option s-podminkami">
                            <input type="radio" name="vysledekRadio" value="kladne_s_podminkami">
                            <div class="vysledek-option-icon">
                                <span class="material-icons-outlined">task_alt</span>
                            </div>
                            <span class="vysledek-option-label">Kladné s podmínkami</span>
                        </label>
                        <label class="vysledek-option zaporne">
                            <input type="radio" name="vysledekRadio" value="zaporne">
                            <div class="vysledek-option-icon">
                                <span class="material-icons-outlined">cancel</span>
                            </div>
                            <span class="vysledek-option-label">Záporné</span>
                        </label>
                    </div>
                </div>

                <!-- Seznam podmínek -->
                <div class="podminky-section" id="podminkySectionList" style="display: none;">
                    <div class="podminky-section-title">Podmínky pro rozhodnutí</div>
                    <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                        Zadejte podmínky, které budou součástí rozhodnutí o povolení stavby.
                    </p>
                    <div class="podminky-list" id="podminkyList">
                        <!-- Dynamicky renderováno -->
                    </div>
                    <div class="add-podminka-row">
                        <input type="text" class="add-podminka-input" id="addPodminkaText" placeholder="Přidat novou podmínku..." onkeypress="if(event.key==='Enter') addPodminka()">
                        <button class="btn-add-podminka" onclick="addPodminka()">
                            <span class="material-icons-outlined">add</span>
                            Přidat
                        </button>
                    </div>
                </div>

                <!-- Poznámka úředníka -->
                <div class="podminky-section">
                    <div class="podminky-section-title">Poznámka úředníka</div>
                    <textarea class="poznamka-textarea" id="podminkyPoznamka" placeholder="Interní poznámka k tomuto subjektu..."></textarea>
                </div>
            </div>
            <div class="podminky-modal-footer">
                <button class="btn btn-secondary" onclick="closePodminkyModal()">Zrušit</button>
                <button class="btn btn-primary" onclick="savePodminkyModal()">
                    <span class="material-icons-outlined">check</span>
                    Uložit změny
                </button>
            </div>
        </div>
    </div>

    <!-- Modal pro report dat pro rozhodnutí -->
    <div class="report-modal-overlay" id="reportModal">
        <div class="report-modal">
            <div class="report-modal-header">
                <div class="report-modal-title">
                    <span class="material-icons-outlined">summarize</span>
                    Report dokladové části
                </div>
                <div class="report-modal-actions">
                    <button class="btn-download" onclick="downloadReportHTML()">
                        <span class="material-icons-outlined">download</span>
                        Stáhnout HTML
                    </button>
                    <button class="btn-download" onclick="downloadReportJSON()">
                        <span class="material-icons-outlined">data_object</span>
                        Stáhnout JSON
                    </button>
                    <button class="report-modal-close" onclick="closeReportModal()">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
            </div>
            <div class="report-modal-body">
                <div class="report-content" id="reportContent">
                    <!-- Dynamicky generováno -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pro postoupení řízení -->
    <div class="modal-overlay" id="postoupeniModal" onclick="closeModal('postoupeniModal', event)">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header" style="background: #e8f4fd; border-bottom: 1px solid #c2e0ff;">
                <div class="modal-title" style="display: flex; align-items: center; gap: 10px;">
                    <span class="material-icons-outlined" style="color: #1a73e8;">send</span>
                    Postoupení řízení z důvodu nepříslušnosti
                </div>
                <button class="modal-close" onclick="closeModal('postoupeniModal', event)" style="background: transparent; border: none; cursor: pointer; padding: 8px;">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 24px;">
                <div style="background: #f8f9fa; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <div style="font-size: 12px; color: #5f6368; margin-bottom: 4px;">Řízení bude postoupeno:</div>
                    <div style="font-size: 16px; font-weight: 500; color: #202124;" id="postoupeniSuNazev">—</div>
                    <div style="font-size: 13px; color: #5f6368; margin-top: 4px;" id="postoupeniSuAdresa">—</div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 13px; font-weight: 500; color: #202124; margin-bottom: 8px;">Zdůvodnění nepříslušnosti:</div>
                    <div style="font-size: 13px; color: #5f6368; background: #fff; border: 1px solid #e8eaed; border-radius: 6px; padding: 12px; line-height: 1.5;" id="postoupeniZduvodneni">—</div>
                </div>
                
                <div style="background: #fef7e0; border: 1px solid #fdd835; border-radius: 8px; padding: 16px; display: flex; gap: 12px;">
                    <span class="material-icons-outlined" style="color: #b06000; flex-shrink: 0;">info</span>
                    <div>
                        <div style="font-size: 13px; font-weight: 500; color: #202124; margin-bottom: 4px;">Co se stane po postoupení:</div>
                        <ul style="font-size: 12px; color: #5f6368; margin: 0; padding-left: 16px; line-height: 1.6;">
                            <li>Bude vygenerován dokument <strong>Postoupení řízení z důvodu nepříslušnosti</strong></li>
                            <li>Řízení bude interně předáno příslušnému stavebnímu úřadu prostřednictvím ISSŘ</li>
                            <li>Žadatel bude vyrozuměn o postoupení řízení</li>
                            <li>Řízení bude ve Vašem systému označeno jako postoupené</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding: 16px 24px; border-top: 1px solid #e8eaed; display: flex; justify-content: flex-end; gap: 10px; background: #f8f9fa;">
                <button class="btn btn-secondary" onclick="closeModal('postoupeniModal', event)">
                    Zrušit
                </button>
                <button class="btn btn-primary" onclick="confirmPostoupeni()" style="background: #1a73e8;">
                    <span class="material-icons-outlined">send</span>
                    Potvrdit postoupení
                </button>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Globální stav nedostatků - MUSÍ být definován před ostatními funkcemi
        const globalIssues = {
            vyzva: [], // Výzva k doplnění + přerušení
            odlozeni: [], // Odložení žádosti
            postoupeni: [], // Postoupení
            staveni: [], // Stavění lhůty
            zamitnuti: [] // Zamítnutí
        };
        
        // Funkce pro práci s globalIssues
        function addGlobalIssue(type, issue) {
            const id = 'gi-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            globalIssues[type].push({
                id: id,
                text: issue.text,
                source: issue.source || 'manual',
                controlName: issue.controlName || '',
                resolved: false,
                timestamp: new Date().toISOString()
            });
            updateGlobalIssuesBadge();
            return id;
        }
        
        function removeGlobalIssue(type, id) {
            globalIssues[type] = globalIssues[type].filter(i => i.id !== id);
            updateGlobalIssuesBadge();
            renderGlobalIssues();
        }
        
        function resolveGlobalIssue(type, id) {
            const issue = globalIssues[type].find(i => i.id === id);
            if (issue) {
                issue.resolved = !issue.resolved;
                updateGlobalIssuesBadge();
                renderGlobalIssues();
            }
        }
        
        function updateGlobalIssuesBadge() {
            const total = Object.values(globalIssues).reduce((sum, arr) => 
                sum + arr.filter(i => !i.resolved).length, 0);
            
            const badge = document.getElementById('nedostatkyBadge');
            const btn = document.getElementById('btnNedostatky');
            
            if (badge && btn) {
                badge.textContent = total;
                
                if (total > 0) {
                    btn.classList.add('has-issues');
                    badge.style.display = '';
                } else {
                    btn.classList.remove('has-issues');
                    badge.style.display = 'none';
                }
            }
        }
        
        function renderGlobalIssues() {
            const types = [
                { key: 'vyzva', listId: 'listVyzva', badgeId: 'badgeVyzva', emptyText: 'Žádné nedostatky', iconClass: 'warning' },
                { key: 'odlozeni', listId: 'listOdlozeni', badgeId: 'badgeOdlozeni', emptyText: 'Žádné závažné vady', iconClass: 'error' },
                { key: 'postoupeni', listId: 'listPostoupeni', badgeId: 'badgePostoupeni', emptyText: 'SÚ je příslušný', iconClass: 'warning' },
                { key: 'staveni', listId: 'listStaveni', badgeId: 'badgeStaveni', emptyText: 'Všechna stanoviska jsou k dispozici', iconClass: 'warning' },
                { key: 'zamitnuti', listId: 'listZamitnuti', badgeId: 'badgeZamitnuti', emptyText: 'Žádné důvody pro zamítnutí', iconClass: 'error' }
            ];
            
            types.forEach(t => {
                const list = document.getElementById(t.listId);
                const badge = document.getElementById(t.badgeId);
                if (!list || !badge) return;
                
                const issues = globalIssues[t.key];
                const unresolvedCount = issues.filter(i => !i.resolved).length;
                
                badge.textContent = unresolvedCount;
                
                if (issues.length === 0) {
                    list.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                            <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                            ${t.emptyText}
                        </div>
                    `;
                } else {
                    list.innerHTML = issues.map(issue => `
                        <div class="global-issue-item ${issue.resolved ? 'resolved' : ''}">
                            <div class="global-issue-icon ${issue.resolved ? 'resolved' : t.iconClass}">
                                <span class="material-icons-outlined">${issue.resolved ? 'check' : 'warning'}</span>
                            </div>
                            <div class="global-issue-content">
                                <div class="global-issue-text">${issue.text}</div>
                                <div class="global-issue-meta">
                                    ${issue.controlName ? issue.controlName + ' • ' : ''}
                                    ${issue.source === 'auto' ? 'Automaticky zjištěno' : 'Ručně přidáno'}
                                </div>
                            </div>
                            <div class="global-issue-actions">
                                <button class="global-issue-btn resolve" onclick="resolveGlobalIssue('${t.key}', '${issue.id}')" title="${issue.resolved ? 'Označit jako nevyřešené' : 'Označit jako vyřešené'}">
                                    <span class="material-icons-outlined">${issue.resolved ? 'undo' : 'check'}</span>
                                </button>
                                <button class="global-issue-btn" onclick="removeGlobalIssue('${t.key}', '${issue.id}')" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            });
        }

        // State management
        const controls = {
            prislusnost: { done: false, depends: [], result: 'ok' },
            zadost: { done: false, depends: ['prislusnost'], result: 'ok' },
            dokumentace: { done: false, depends: ['prislusnost', 'zadost'], result: 'ok' },
            pozemky: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace'], result: 'ok' },
            up: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace', 'pozemky'], result: 'ok' },
            identifikace: { done: false, depends: ['pozemky'], result: 'ok' },
            ucastnici: { done: false, depends: ['pozemky'], result: 'ok' },
            zrychlene: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace', 'pozemky', 'up', 'identifikace', 'ucastnici'], result: 'ok' }
        };

        // Control overlay functions
        function openControl(controlId) {
            document.getElementById(controlId).classList.add('open');
            document.body.style.overflow = 'hidden';
            
            // Inicializace specifických kontrol
            if (controlId === 'controlIdentifikace') {
                setTimeout(initIdentifikaceMatrix, 100);
            }
        }

        function closeControl(controlId) {
            document.getElementById(controlId).classList.remove('open');
            document.body.style.overflow = '';
        }

        // Modal functions (pro náhled dokumentů z headeru)
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId, event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById(modalId).classList.remove('open');
            document.body.style.overflow = '';
        }
        
        // Otevření REZA modalu s informacemi o elektronickém zastoupení
        function openRezaModal(zastupceData) {
            const body = document.getElementById('rezaModalBody');
            
            // Typ zastoupení
            const typText = zastupceData.typZastoupeni === 'plna-moc' ? 'Plná moc' : 
                           (zastupceData.typZastoupeni === 'povereni' ? 'Pověření' : 'Statutární zástupce');
            
            body.innerHTML = `
                <div class="reza-info-section">
                    <div class="reza-info-title">Zmocnitel (zastoupený)</div>
                    <div class="reza-info-grid">
                        <div class="reza-info-item full">
                            <div class="reza-info-label">Jméno / Název</div>
                            <div class="reza-info-value">${zastupceData.zmocnitel || 'Jan Novák'}</div>
                        </div>
                        <div class="reza-info-item">
                            <div class="reza-info-label">Datum narození / IČO</div>
                            <div class="reza-info-value">${zastupceData.zmocnitelId || '15. 3. 1985'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="reza-info-section">
                    <div class="reza-info-title">Zmocněnec (zástupce)</div>
                    <div class="reza-info-grid">
                        <div class="reza-info-item full">
                            <div class="reza-info-label">Jméno / Název</div>
                            <div class="reza-info-value">${zastupceData.jmeno || ''} ${zastupceData.prijmeni || zastupceData.nazev || ''}</div>
                        </div>
                        <div class="reza-info-item">
                            <div class="reza-info-label">${zastupceData.ico ? 'IČO' : 'Datum narození'}</div>
                            <div class="reza-info-value">${zastupceData.ico || zastupceData.datumNarozeni || '—'}</div>
                        </div>
                        <div class="reza-info-item">
                            <div class="reza-info-label">Datová schránka</div>
                            <div class="reza-info-value">${zastupceData.ds || '—'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="reza-info-section">
                    <div class="reza-info-title">Údaje o zastoupení</div>
                    <div class="reza-info-grid">
                        <div class="reza-info-item">
                            <div class="reza-info-label">Typ zastoupení</div>
                            <div class="reza-info-value">${typText}</div>
                        </div>
                        <div class="reza-info-item">
                            <div class="reza-info-label">Rozsah</div>
                            <div class="reza-info-value">${zastupceData.rozsah || 'Úplná plná moc'}</div>
                        </div>
                        <div class="reza-info-item full">
                            <div class="reza-info-label">Platnost</div>
                            <div class="reza-info-value">
                                <span class="reza-validity">
                                    <span class="material-icons-outlined">check_circle</span>
                                    ${zastupceData.platnostPM || 'Platná bez omezení'}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 16px; padding: 12px; background: #e8f5e9; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                    <span class="material-icons-outlined" style="color: #2e7d32; font-size: 24px;">verified</span>
                    <div>
                        <div style="font-size: 13px; font-weight: 600; color: #1b5e20;">Zastoupení ověřeno v REZA</div>
                        <div style="font-size: 11px; color: #388e3c;">Portál stavebníka ověřil platnost zastoupení při podání žádosti</div>
                    </div>
                </div>
            `;
            
            openModal('rezaModal');
        }
        
        // Otevření modalu s přílohami pro vyhledání plné moci
        function openPrilohyPMModal() {
            openModal('prilohyPMModal');
        }
        
        // Alias pro otevření příloh z tlačítka v sekci Přílohy
        function openPrilohyModal() {
            openModal('prilohyPMModal');
        }
        
        // Scrollování na sekci Přílohy v Kontrole žádosti
        function scrollToPrilohy() {
            const prilohySection = document.getElementById('dataSectionPrilohyZadosti');
            if (prilohySection) {
                prilohySection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Zvýraznění sekce
                prilohySection.style.boxShadow = '0 0 0 3px #1a73e8';
                setTimeout(() => {
                    prilohySection.style.boxShadow = '';
                }, 2000);
            }
        }
        
        // Otevření modalu pro úpravu uspořádání kontrol
        function openCustomizeControlsModal() {
            // Vytvoření jednoduchého modalu s popisem
            const modal = document.createElement('div');
            modal.className = 'modal-overlay open';
            modal.id = 'customizeControlsModal';
            modal.onclick = function(e) { if (e.target === modal) closeCustomizeControlsModal(); };
            
            modal.innerHTML = `
                <div class="modal" onclick="event.stopPropagation()" style="max-width: 500px;">
                    <div class="modal-header">
                        <div class="modal-title">
                            <span class="material-icons-outlined">tune</span>
                            Uspořádání kontrol
                        </div>
                        <button class="modal-close" onclick="closeCustomizeControlsModal()">
                            <span class="material-icons-outlined">close</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 32px 24px; text-align: center;">
                            <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6; margin-bottom: 16px; display: block;">drag_indicator</span>
                            <p style="font-size: 14px; color: #3c4043; margin: 0 0 12px 0; font-weight: 500;">V ostré verzi by zde bylo možné:</p>
                            <ul style="text-align: left; font-size: 13px; color: #5f6368; margin: 0; padding-left: 24px; line-height: 1.8;">
                                <li>Přetahováním změnit pořadí kontrolních karet</li>
                                <li>Skrýt méně důležité kontroly</li>
                                <li>Seskupit související kontroly do záložek</li>
                                <li>Uložit vlastní uspořádání jako výchozí</li>
                            </ul>
                            <p style="font-size: 12px; color: #80868b; margin: 16px 0 0 0;">
                                <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle;">info</span>
                                Závislosti a návaznosti mezi kontrolami zůstanou zachovány.
                            </p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeCustomizeControlsModal()">Zavřít</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }
        
        function closeCustomizeControlsModal() {
            const modal = document.getElementById('customizeControlsModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }
        
        // Aktualizace názvu stavby v hlavičce
        function updateNazevStavby() {
            const input = document.getElementById('nazevStavby');
            const header = document.getElementById('caseTitleHeader');
            if (input && header) {
                header.textContent = input.value || 'Bez názvu';
            }
        }

        // Popis stavby - funkce pro rozbalení/sbalení editoru
        let originalPopisText = '';
        
        function expandPopisStavby() {
            const collapsed = document.getElementById('popisStavbyCollapsed');
            const editor = document.getElementById('popisStavbyEditor');
            const textarea = document.getElementById('popisStavbyTextarea');
            const expandBtn = collapsed ? collapsed.querySelector('.popis-expand-btn .material-icons-outlined') : null;
            
            // Uložit původní text pro případ zrušení
            originalPopisText = textarea.value;
            
            // Skrýt sbalený stav, zobrazit editor
            if (collapsed) collapsed.style.display = 'none';
            if (editor) editor.style.display = 'block';
            
            // Fokus na textarea
            if (textarea) {
                textarea.focus();
                textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            }
        }
        
        function collapsePopisStavby() {
            const collapsed = document.getElementById('popisStavbyCollapsed');
            const editor = document.getElementById('popisStavbyEditor');
            const textarea = document.getElementById('popisStavbyTextarea');
            const statusBadge = document.getElementById('popisStatusBadge');
            
            // Aktualizovat badge podle obsahu
            if (statusBadge && textarea) {
                const text = textarea.value.trim();
                if (text && text.length > 20) {
                    statusBadge.style.display = 'inline';
                } else {
                    statusBadge.style.display = 'none';
                }
            }
            
            // Skrýt editor, zobrazit sbalený stav
            if (editor) editor.style.display = 'none';
            if (collapsed) collapsed.style.display = 'flex';
        }
        
        function savePopisStavby() {
            collapsePopisStavby();
            
            // Vizuální potvrzení uložení
            const collapsed = document.getElementById('popisStavbyCollapsed');
            if (collapsed) {
                collapsed.style.transition = 'background 0.3s';
                collapsed.style.background = '#e6f4ea';
                setTimeout(() => {
                    collapsed.style.background = '';
                }, 1000);
            }
        }
        
        function cancelPopisStavby() {
            const textarea = document.getElementById('popisStavbyTextarea');
            if (textarea) {
                textarea.value = originalPopisText;
            }
            collapsePopisStavby();
        }
        
        function loadPopisFromAI() {
            const btn = document.getElementById('popisAiBtn');
            const textarea = document.getElementById('popisStavbyTextarea');
            const textSpan = btn.querySelector('.popis-ai-text');
            const loadingSpan = btn.querySelector('.popis-ai-loading');
            
            // Zobrazit loading stav
            btn.disabled = true;
            if (textSpan) textSpan.style.display = 'none';
            if (loadingSpan) loadingSpan.style.display = 'inline-flex';
            
            // Simulace AI načítání (2.5 sekundy)
            setTimeout(() => {
                // AI vygenerovaný popis ze souhrnné technické zprávy
                const aiPopis = `Předmětem stavebního záměru je novostavba rodinného domu s garáží a napojení na technickou infrastrukturu na pozemku parc. č. 1234/5 v katastrálním území Horní Lhota, obec Dolní Lhota.

SO 01 – Rodinný dům:
Jedná se o dvoupodlažní nepodsklepený objekt (1.NP + obytné podkroví) obdélníkového půdorysu o rozměrech 12,0 × 9,5 m. Konstrukční systém zděný z keramických tvárnic, zastřešení sedlovou střechou se sklonem 35° s krytinou z betonových tašek. Zastavěná plocha 114 m², obestavěný prostor 687 m³, užitná plocha 168 m².

V 1.NP je navrženo: zádveří, chodba, technická místnost, WC, obývací pokoj s kuchyňským koutem (45 m²) a garáž pro jeden osobní automobil.
V podkroví jsou navrženy: 3 ložnice, koupelna, šatna a chodba.

Vytápění objektu bude zajištěno tepelným čerpadlem vzduch-voda s podlahovým topením. Ohřev TUV zásobníkovým ohřívačem v kombinaci s tepelným čerpadlem.

SO 02 – Zpevněné plochy:
Příjezdová komunikace a chodník ze zámkové dlažby, celková plocha 85 m².

SO 03 – Přípojka vodovodu:
PE potrubí DN 32, délka 8,5 m, napojení na vodovodní řad v ulici Pod Lipami.

SO 04 – Přípojka splaškové kanalizace:
PVC potrubí DN 150, délka 12,0 m, napojení na veřejnou kanalizaci.

SO 05 – Přípojka elektro:
Kabelová přípojka NN napojená na distribuční síť ČEZ Distribuce, a.s.

SO 06 – Oplocení:
Oplocení pozemku plotem výšky 1,8 m s podezdívkou.`;
                
                if (textarea) {
                    textarea.value = aiPopis;
                }
                
                // Vrátit button do původního stavu
                btn.disabled = false;
                if (textSpan) textSpan.style.display = 'inline';
                if (loadingSpan) loadingSpan.style.display = 'none';
                
                // Změnit text buttonu
                if (textSpan) textSpan.textContent = 'Načteno z dokumentace';
                btn.style.background = '#e6f4ea';
                btn.style.borderColor = '#34a853';
                btn.style.color = '#137333';
                
            }, 2500);
        }

        // Escape key closes overlays
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.control-overlay.open').forEach(function(overlay) {
                    overlay.classList.remove('open');
                });
                document.querySelectorAll('.modal-overlay.open').forEach(function(modal) {
                    modal.classList.remove('open');
                });
                document.body.style.overflow = '';
            }
        });

        // Otevření prohlížeče v novém okně (simulace druhého monitoru)
        function openViewerExternal(controlType) {
            const controlNames = {
                'prislusnost': 'Kontrola příslušnosti',
                'kontrolazadosti': 'Kontrola žádosti',
                'pozemky': 'Pozemky',
                'dokumentace': 'Kontrola dokumentace',
                'identifikace': 'Identifikace subjektů',
                'up': 'Soulad s ÚPD',
                'ucastnici': 'Osoby',
                'zrychlene': 'Zrychlené řízení'
            };
            
            const controlName = controlNames[controlType] || controlType;
            
            // Otevřít nové okno s náhledem
            const newWindow = window.open('', '_blank', 'width=900,height=700,menubar=no,toolbar=no,location=no,status=no');
            
            if (newWindow) {
                newWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Prohlížeč dokumentů - ${controlName}</title>
                        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
                        <style>
                            * { margin: 0; padding: 0; box-sizing: border-box; }
                            body { 
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                background: #f5f5f5;
                            }
                            .header {
                                background: #004289;
                                color: #fff;
                                padding: 16px 24px;
                                display: flex;
                                align-items: center;
                                gap: 12px;
                            }
                            .header h1 {
                                font-size: 16px;
                                font-weight: 500;
                            }
                            .header .material-icons-outlined {
                                font-size: 24px;
                            }
                            .tabs {
                                background: #fff;
                                padding: 12px 16px;
                                border-bottom: 1px solid #e0e0e0;
                                display: flex;
                                gap: 8px;
                            }
                            .tab {
                                display: inline-flex;
                                align-items: center;
                                gap: 6px;
                                padding: 8px 14px;
                                background: #f5f5f5;
                                border: 1px solid #e0e0e0;
                                border-radius: 6px;
                                font-size: 13px;
                                color: #5f6368;
                                cursor: pointer;
                            }
                            .tab:hover {
                                background: #e8f1fa;
                                border-color: #004289;
                                color: #004289;
                            }
                            .tab.active {
                                background: #004289;
                                border-color: #004289;
                                color: #fff;
                            }
                            .content {
                                flex: 1;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                text-align: center;
                                padding: 60px 40px;
                                min-height: calc(100vh - 120px);
                            }
                            .placeholder {
                                color: #5f6368;
                            }
                            .placeholder .material-icons-outlined {
                                font-size: 64px;
                                color: #9aa0a6;
                                margin-bottom: 16px;
                            }
                            .placeholder h2 {
                                font-size: 18px;
                                font-weight: 500;
                                color: #202124;
                                margin-bottom: 8px;
                            }
                            .placeholder p {
                                font-size: 13px;
                                color: #5f6368;
                            }
                            .info-badge {
                                display: inline-flex;
                                align-items: center;
                                gap: 6px;
                                margin-top: 20px;
                                padding: 8px 16px;
                                background: #e8f4fd;
                                border-radius: 20px;
                                font-size: 12px;
                                color: #1a73e8;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <span class="material-icons-outlined">monitor</span>
                            <h1>Prohlížeč dokumentů — ${controlName}</h1>
                        </div>
                        <div class="tabs">
                            <button class="tab active">
                                <span class="material-icons-outlined">description</span>
                                Žádost
                            </button>
                            <button class="tab">
                                <span class="material-icons-outlined">attach_file</span>
                                Přílohy
                            </button>
                            <button class="tab">
                                <span class="material-icons-outlined">folder</span>
                                Dokumentace
                            </button>
                        </div>
                        <div class="content">
                            <div class="placeholder">
                                <span class="material-icons-outlined">description</span>
                                <h2>Žádost o povolení stavby</h2>
                                <p>V produkční verzi by se zde zobrazil náhled dokumentu</p>
                                <div class="info-badge">
                                    <span class="material-icons-outlined" style="font-size: 16px;">desktop_windows</span>
                                    Samostatné okno pro druhý monitor
                                </div>
                            </div>
                        </div>
                    </body>
                    </html>
                `);
                newWindow.document.close();
            } else {
                alert('Prohlížeč zablokoval otevření nového okna. Povolte prosím vyskakovací okna pro tuto stránku.');
            }
        }

        // Viewer tab switching
        function switchViewerTab(button, controlType, docType) {
            // Update active tab
            const tabs = button.parentElement.querySelectorAll('.viewer-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            button.classList.add('active');

            // Update viewer content
            const viewer = document.getElementById('viewer-' + controlType);
            const docConfig = {
                zadost: { icon: 'description', title: 'Žádost o povolení stavby', desc: 'Formulář žádosti s údaji o stavebníkovi a záměru' },
                prilohy: { icon: 'attach_file', title: 'Přílohy žádosti (12)', desc: 'Plné moci, souhlasy vlastníků, další dokumenty' },
                dokumentace: { icon: 'architecture', title: 'Elektronická dokumentace', desc: 'Projektová dokumentace v evidenci EED' },
                eed: { icon: 'architecture', title: 'Elektronická dokumentace', desc: 'Projektová dokumentace v evidenci EED' },
                doklady: { icon: 'checklist', title: 'Dokladová část', desc: 'Stanoviska DO a vyjádření správců sítí' },
                dokladova: { icon: 'checklist', title: 'Dokladová část', desc: 'Stanoviska DO a vyjádření správců sítí' },
                kn: { icon: 'terrain', title: 'Katastr nemovitostí', desc: 'Informace o vlastnících pozemků a sousedech' },
                uplan: { icon: 'map', title: 'Územní plán', desc: 'Platný územní plán obce s regulativy' },
                mapa: { icon: 'map', title: 'Mapa parcel', desc: 'Vizuální zobrazení pozemků záměru a sousedů' }
            };

            const config = docConfig[docType] || docConfig.zadost;
            viewer.innerHTML = `
                <span class="material-icons-outlined">${config.icon}</span>
                <div class="viewer-placeholder-title">${config.title}</div>
                <div class="viewer-placeholder-text">${config.desc}</div>
            `;
        }

        // Option selection with visual feedback
        function selectOption(element, isNegative = false) {
            const container = element.closest('.control-section');
            const options = container.querySelectorAll('.control-option');
            
            options.forEach(opt => {
                opt.classList.remove('selected', 'negative');
            });
            
            element.classList.add('selected');
            if (isNegative) {
                element.classList.add('negative');
            }
        }

        // ==========================================
        // POZEMKY A SOUSEDÉ
        // ==========================================
        // ==========================================
        // POZEMKY A SOUSEDÉ - kompletní logika
        // ==========================================
        
        let pozemkyState = {
            method: 'auto',
            viewModeZameru: 'chips',  // 'chips' nebo 'list'
            viewModeSousedni: 'chips',
            sortZameru: { field: null, asc: true },  // řazení pozemků záměru
            sortSousedni: { field: null, asc: true }, // řazení sousedních
            pozemkyZameru: [
                { cislo: 'st. 142', katastr: 'Radonice', kod: '747076', plocha: '560 m²', typ: 'zastavena' },
                { cislo: '248/3', katastr: 'Radonice', kod: '747076', plocha: '1 240 m²', typ: 'pozemkova' },
                { cislo: '248/4', katastr: 'Radonice', kod: '747076', plocha: '320 m²', typ: 'pozemkova' },
                { cislo: 'st. 143', katastr: 'Radonice', kod: '747076', plocha: '180 m²', typ: 'zastavena' },
                { cislo: '251/1', katastr: 'Radonice', kod: '747076', plocha: '890 m²', typ: 'pozemkova' }
            ],
            sousedniParcely: [
                { cislo: '247/1', katastr: 'Radonice', kod: '747076', plocha: '1 120 m²' },
                { cislo: '247/2', katastr: 'Radonice', kod: '747076', plocha: '450 m²' },
                { cislo: '249', katastr: 'Radonice', kod: '747076', plocha: '2 340 m²' },
                { cislo: 'st. 140', katastr: 'Radonice', kod: '747076', plocha: '210 m²' },
                { cislo: 'st. 141', katastr: 'Radonice', kod: '747076', plocha: '185 m²' },
                { cislo: '250/1', katastr: 'Radonice', kod: '747076', plocha: '670 m²' },
                { cislo: '250/2', katastr: 'Radonice', kod: '747076', plocha: '380 m²' },
                { cislo: '252', katastr: 'Radonice', kod: '747076', plocha: '1 560 m²' },
                { cislo: '246/3', katastr: 'Radonice', kod: '747076', plocha: '920 m²' },
                { cislo: 'st. 139', katastr: 'Radonice', kod: '747076', plocha: '240 m²' },
                { cislo: '253/1', katastr: 'Radonice', kod: '747076', plocha: '780 m²' },
                { cislo: '253/2', katastr: 'Radonice', kod: '747076', plocha: '415 m²' }
            ],
            knVerified: false,
            owners: []
        };
        
        // Funkce pro přepínání zobrazení pozemků
        function setPozemkyView(type, mode) {
            if (type === 'zameru') {
                pozemkyState.viewModeZameru = mode;
                // Aktualizace tlačítek
                const toggle = document.getElementById('pozemkyZameruToggle');
                toggle.querySelectorAll('.pozemky-view-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
                });
                renderPozemkyZameru();
            } else if (type === 'sousedni') {
                pozemkyState.viewModeSousedni = mode;
                // Aktualizace tlačítek
                const toggle = document.getElementById('sousedniToggle');
                toggle.querySelectorAll('.pozemky-view-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
                });
                renderSousedniParcely();
            }
        }
        
        // Funkce pro řazení pozemků
        function sortPozemky(type, field) {
            const sortState = type === 'zameru' ? pozemkyState.sortZameru : pozemkyState.sortSousedni;
            
            // Přepnout směr řazení pokud klikáme na stejné pole
            if (sortState.field === field) {
                sortState.asc = !sortState.asc;
            } else {
                sortState.field = field;
                sortState.asc = true;
            }
            
            // Seřadit data
            const data = type === 'zameru' ? pozemkyState.pozemkyZameru : pozemkyState.sousedniParcely;
            
            data.sort((a, b) => {
                let valA = a[field];
                let valB = b[field];
                
                // Speciální řazení pro číslo parcely
                if (field === 'cislo') {
                    valA = parseParcela(valA);
                    valB = parseParcela(valB);
                } else {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }
                
                let result = 0;
                if (typeof valA === 'object') {
                    // Porovnání objektů z parseParcela
                    if (valA.isStavebni !== valB.isStavebni) {
                        result = valA.isStavebni ? -1 : 1;
                    } else if (valA.main !== valB.main) {
                        result = valA.main - valB.main;
                    } else {
                        result = valA.sub - valB.sub;
                    }
                } else {
                    result = valA.localeCompare(valB, 'cs');
                }
                
                return sortState.asc ? result : -result;
            });
            
            // Překreslit
            if (type === 'zameru') {
                renderPozemkyZameru();
            } else {
                renderSousedniParcely();
            }
        }
        
        // Pomocná funkce pro parsování čísla parcely
        function parseParcela(cislo) {
            const isStavebni = cislo.toLowerCase().startsWith('st');
            const cleanNum = cislo.replace(/^st\.?\s*/i, '').trim();
            const parts = cleanNum.split('/');
            return {
                isStavebni: isStavebni,
                main: parseInt(parts[0]) || 0,
                sub: parseInt(parts[1]) || 0
            };
        }

        // Inicializace - renderovat pozemky záměru při načtení
        document.addEventListener('DOMContentLoaded', function() {
            renderPozemkyZameru();
            renderSousedniParcely();
            
            // Inicializace badge pro popis stavby
            const textarea = document.getElementById('popisStavbyTextarea');
            const statusBadge = document.getElementById('popisStatusBadge');
            if (textarea && statusBadge && textarea.value.trim().length > 20) {
                statusBadge.style.display = 'inline';
            }
        });

        function renderPozemkyZameru() {
            const list = document.getElementById('pozemkyZameruList');
            const countBadge = document.getElementById('pozemkyZameruCount');
            const viewMode = pozemkyState.viewModeZameru;
            const sort = pozemkyState.sortZameru;
            
            if (pozemkyState.pozemkyZameru.length === 0) {
                list.innerHTML = `
                    <div class="pozemky-empty-note">
                        <span class="material-icons-outlined">warning</span>
                        Nejsou definovány žádné pozemky záměru. Přidejte alespoň jeden pozemek.
                    </div>
                `;
                countBadge.textContent = '0 parcel';
            } else {
                const pocet = pozemkyState.pozemkyZameru.length;
                countBadge.textContent = pocet + ' ' + (pocet === 1 ? 'parcela' : (pocet < 5 ? 'parcely' : 'parcel'));
                
                let html = '';
                
                if (viewMode === 'chips') {
                    // Kompaktní chip zobrazení
                    html = '<div class="pozemky-chips-container">';
                    pozemkyState.pozemkyZameru.forEach((p, index) => {
                        const icon = p.typ === 'zastavena' ? 'crop_square' : 'grass';
                        html += `
                            <div class="pozemek-chip zamer" title="k.ú. ${p.katastr} [${p.kod}]${p.plocha !== '—' ? ' • ' + p.plocha : ''}">
                                <span class="material-icons-outlined chip-icon">${icon}</span>
                                <span class="chip-parcela">${p.cislo}</span>
                                <span class="chip-ku">${p.katastr.substring(0, 8)}${p.katastr.length > 8 ? '…' : ''}</span>
                                <button class="chip-remove" onclick="removePozemekZameru(${index})" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    // Řádkové zobrazení s hlavičkou
                    const parcelaSortClass = sort.field === 'cislo' ? (sort.asc ? 'active asc' : 'active') : '';
                    const katastrSortClass = sort.field === 'katastr' ? (sort.asc ? 'active asc' : 'active') : '';
                    
                    html = '<div class="pozemky-list-container">';
                    html += `
                        <div class="pozemky-list-header">
                            <span class="col-icon"></span>
                            <span class="header-col col-parcela ${parcelaSortClass}" onclick="sortPozemky('zameru', 'cislo')">
                                Parcela
                                <span class="material-icons-outlined sort-icon">arrow_downward</span>
                            </span>
                            <span class="header-col col-katastr ${katastrSortClass}" onclick="sortPozemky('zameru', 'katastr')">
                                Katastrální území
                                <span class="material-icons-outlined sort-icon">arrow_downward</span>
                            </span>
                            <span class="col-kod">Kód</span>
                            <span class="col-plocha">Plocha</span>
                            <span class="col-actions"></span>
                        </div>
                    `;
                    pozemkyState.pozemkyZameru.forEach((p, index) => {
                        const icon = p.typ === 'zastavena' ? 'crop_square' : 'grass';
                        html += `
                            <div class="pozemek-row zamer">
                                <span class="material-icons-outlined row-icon">${icon}</span>
                                <span class="row-parcela">${p.cislo}</span>
                                <span class="row-katastr">${p.katastr}</span>
                                <span class="row-kod">[${p.kod}]</span>
                                <span class="row-plocha">${p.plocha}</span>
                                <button class="row-remove" onclick="removePozemekZameru(${index})" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                list.innerHTML = html;
            }
            
            updatePozemkyState();
        }

        function addPozemekZameru() {
            const obecSelect = document.getElementById('pozemekObec');
            const kuSelect = document.getElementById('pozemekKU');
            const input = document.getElementById('pozemekZameruInput');
            const value = input.value.trim();
            
            if (!value) {
                alert('Zadejte číslo parcely.');
                return;
            }
            
            // Určení katastrálního území
            let katastr = 'Veselí nad Lužnicí';
            let kod = '779091';
            
            if (kuSelect.value) {
                katastr = kuSelect.options[kuSelect.selectedIndex].text;
                kod = kuSelect.value.split('-')[1] || '779091';
            }
            
            // Určení typu parcely podle čísla
            const isZastavena = value.toLowerCase().startsWith('st.');
            
            pozemkyState.pozemkyZameru.push({
                cislo: value,
                katastr: katastr,
                kod: kod,
                plocha: '—',
                typ: isZastavena ? 'zastavena' : 'pozemkova'
            });
            
            renderPozemkyZameru();
            input.value = '';
        }
        
        function selectPozemekMethod(method) {
            // Update tlačítek - pouze pro pozemky záměru
            const pozemkySection = document.getElementById('pozemekMethodRucne').closest('.pozemky-section');
            pozemkySection.querySelectorAll('.neighbor-method-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.method === method);
            });
            
            // Zobrazení správného obsahu
            document.getElementById('pozemekMethodRucne').style.display = method === 'rucne' ? 'block' : 'none';
            document.getElementById('pozemekMethodMapa').style.display = method === 'mapa' ? 'block' : 'none';
            
            // Při volbě Z mapy přepnout viewer na záložku Mapa
            if (method === 'mapa') {
                const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
                if (mapTab) {
                    switchPozemkyTab(mapTab, 'mapa');
                }
            }
        }
        
        function loadKatastralniUzemi() {
            const obecSelect = document.getElementById('pozemekObec');
            const kuSelect = document.getElementById('pozemekKU');
            const obec = obecSelect.value;
            
            // Reset k.ú. dropdown
            kuSelect.innerHTML = '<option value="">Vyberte k.ú....</option>';
            kuSelect.disabled = true;
            
            if (!obec) return;
            
            // Simulace načtení k.ú. podle obce
            const katastry = {
                'veseli': [
                    { value: 'veseli-779091', text: 'Veselí nad Lužnicí' },
                    { value: 'horusice-779091', text: 'Horusice' }
                ],
                'tabor': [
                    { value: 'tabor-764621', text: 'Tábor' },
                    { value: 'klokoty-764621', text: 'Klokoty' },
                    { value: 'chotoviny-764621', text: 'Chotoviny' }
                ],
                'soběslav': [
                    { value: 'sobeslav-752177', text: 'Soběslav' },
                    { value: 'chlebov-752177', text: 'Chlebov' }
                ]
            };
            
            if (katastry[obec]) {
                katastry[obec].forEach(ku => {
                    const option = document.createElement('option');
                    option.value = ku.value;
                    option.textContent = ku.text;
                    kuSelect.appendChild(option);
                });
                kuSelect.disabled = false;
            }
        }
        
        function openMapForPozemkyZameru() {
            // Přepnutí na záložku Mapa ve vieweru
            const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
            if (mapTab) {
                switchPozemkyTab(mapTab, 'mapa');
            }
            alert('V ostré verzi by se zde otevřela katastrální mapa pro výběr pozemků záměru kliknutím na parcely.');
        }

        function removePozemekZameru(index) {
            pozemkyState.pozemkyZameru.splice(index, 1);
            renderPozemkyZameru();
        }

        function switchPozemkyTab(tabEl, view) {
            const tabs = document.querySelectorAll('#controlPozemky .viewer-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tabEl.classList.add('active');
            
            const viewer = document.getElementById('viewer-pozemky');
            
            const viewConfig = {
                'zadost': { icon: 'description', title: 'Žádost o povolení stavby', text: 'Pozemky uvedené stavebníkem v žádosti' },
                'situace': { icon: 'architecture', title: 'Situační výkresy', text: 'C.1 - C.4 ze složky dokumentace' },
                'kn': { icon: 'terrain', title: 'Katastr nemovitostí', text: 'Nahlížení do katastru nemovitostí' },
                'mapa': { icon: 'map', title: 'Katastrální mapa', text: 'Interaktivní mapa s možností výběru parcel' }
            };
            
            const config = viewConfig[view];
            viewer.innerHTML = `
                <span class="material-icons-outlined">${config.icon}</span>
                <div class="viewer-placeholder-title">${config.title}</div>
                <div class="viewer-placeholder-text">${config.text}</div>
            `;
        }

        function selectNeighborMethod(method) {
            pozemkyState.method = method;
            
            // Update tlačítek - pouze pro sousední pozemky
            const sousedniSelector = document.getElementById('sousedniMethodSelector');
            sousedniSelector.querySelectorAll('.neighbor-method-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.method === method);
            });
            
            // Zobrazení správného obsahu
            document.getElementById('methodAuto').style.display = method === 'auto' ? 'block' : 'none';
            document.getElementById('methodRucne').style.display = method === 'rucne' ? 'block' : 'none';
            document.getElementById('methodMapa').style.display = method === 'mapa' ? 'block' : 'none';
            
            // Při volbě Z mapy přepnout viewer na záložku Mapa
            if (method === 'mapa') {
                const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
                if (mapTab) {
                    switchPozemkyTab(mapTab, 'mapa');
                }
            }
        }
        
        function autoDetectSousedni() {
            const btn = document.getElementById('btnAutoDetect');
            btn.disabled = true;
            btn.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span>Identifikuji sousedy...';
            
            setTimeout(function() {
                pozemkyState.sousedniParcely = [
                    { cislo: '248/1', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '890 m²' },
                    { cislo: '248/2', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '1 120 m²' },
                    { cislo: '249', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '2 340 m²' },
                    { cislo: 'st. 141', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '420 m²' },
                    { cislo: 'st. 143', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '380 m²' }
                ];
                
                renderSousedniParcely();
                btn.disabled = false;
                btn.innerHTML = '<span class="material-icons-outlined">auto_awesome</span>Automaticky identifikovat sousedy';
                updatePozemkyState();
            }, 2000);
        }
        
        function loadSousedKatastralniUzemi() {
            const obecSelect = document.getElementById('sousedObec');
            const kuSelect = document.getElementById('sousedKU');
            const obec = obecSelect.value;
            
            // Reset k.ú. dropdown
            kuSelect.innerHTML = '<option value="">Vyberte k.ú....</option>';
            kuSelect.disabled = true;
            
            if (!obec) return;
            
            // Simulace načtení k.ú. podle obce
            const katastry = {
                'veseli': [
                    { value: 'veseli-779091', text: 'Veselí nad Lužnicí' },
                    { value: 'horusice-779091', text: 'Horusice' }
                ],
                'tabor': [
                    { value: 'tabor-764621', text: 'Tábor' },
                    { value: 'klokoty-764621', text: 'Klokoty' },
                    { value: 'chotoviny-764621', text: 'Chotoviny' }
                ],
                'soběslav': [
                    { value: 'sobeslav-752177', text: 'Soběslav' },
                    { value: 'chlebov-752177', text: 'Chlebov' }
                ]
            };
            
            if (katastry[obec]) {
                katastry[obec].forEach(ku => {
                    const option = document.createElement('option');
                    option.value = ku.value;
                    option.textContent = ku.text;
                    kuSelect.appendChild(option);
                });
                kuSelect.disabled = false;
            }
        }
        
        function addSousedniRucne() {
            const obecSelect = document.getElementById('sousedObec');
            const kuSelect = document.getElementById('sousedKU');
            const input = document.getElementById('sousedniSearchInput');
            const value = input.value.trim();
            
            if (!value) {
                alert('Zadejte číslo parcely.');
                return;
            }
            
            // Určení katastrálního území
            let katastr = 'Veselí nad Lužnicí';
            let kod = '779091';
            
            if (kuSelect.value) {
                katastr = kuSelect.options[kuSelect.selectedIndex].text;
                kod = kuSelect.value.split('-')[1] || '779091';
            }
            
            pozemkyState.sousedniParcely.push({
                cislo: value,
                katastr: katastr,
                kod: kod,
                plocha: '—'
            });
            
            renderSousedniParcely();
            updatePozemkyState();
            input.value = '';
        }
        
        function openMapForSousedni() {
            // Přepnutí na záložku Mapa ve vieweru
            const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
            if (mapTab) {
                switchPozemkyTab(mapTab, 'mapa');
            }
            alert('V ostré verzi by se zde otevřela katastrální mapa pro výběr sousedních pozemků kliknutím na parcely.');
        }

        function renderSousedniParcely() {
            const list = document.getElementById('sousedniList');
            const empty = document.getElementById('sousedniEmpty');
            const count = document.getElementById('sousedniCount');
            const viewMode = pozemkyState.viewModeSousedni;
            const sort = pozemkyState.sortSousedni;
            
            if (pozemkyState.sousedniParcely.length === 0) {
                if (empty) empty.style.display = 'block';
                count.textContent = '0 parcel';
                list.innerHTML = '<div class="sousedni-empty" id="sousedniEmpty"><span class="material-icons-outlined">grid_view</span><div class="sousedni-empty-text">Zatím nejsou identifikovány žádné sousední pozemky</div><div class="sousedni-empty-hint">Použijte některou z metod výše</div></div>';
            } else {
                const pocet = pozemkyState.sousedniParcely.length;
                count.textContent = pocet + ' ' + (pocet === 1 ? 'parcela' : pocet < 5 ? 'parcely' : 'parcel');
                
                let html = '';
                
                if (viewMode === 'chips') {
                    // Kompaktní chip zobrazení
                    html = '<div class="pozemky-chips-container">';
                    pozemkyState.sousedniParcely.forEach((p, index) => {
                        const icon = p.cislo.startsWith('st') ? 'crop_square' : 'grass';
                        html += `
                            <div class="pozemek-chip soused" title="k.ú. ${p.katastr} [${p.kod}]${p.plocha !== '—' ? ' • ' + p.plocha : ''}">
                                <span class="material-icons-outlined chip-icon">${icon}</span>
                                <span class="chip-parcela">${p.cislo}</span>
                                <span class="chip-ku">${p.katastr.substring(0, 8)}${p.katastr.length > 8 ? '…' : ''}</span>
                                <button class="chip-remove" onclick="removeSousedni(${index})" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    // Řádkové zobrazení s hlavičkou
                    const parcelaSortClass = sort.field === 'cislo' ? (sort.asc ? 'active asc' : 'active') : '';
                    const katastrSortClass = sort.field === 'katastr' ? (sort.asc ? 'active asc' : 'active') : '';
                    
                    html = '<div class="pozemky-list-container">';
                    html += `
                        <div class="pozemky-list-header">
                            <span class="col-icon"></span>
                            <span class="header-col col-parcela ${parcelaSortClass}" onclick="sortPozemky('sousedni', 'cislo')">
                                Parcela
                                <span class="material-icons-outlined sort-icon">arrow_downward</span>
                            </span>
                            <span class="header-col col-katastr ${katastrSortClass}" onclick="sortPozemky('sousedni', 'katastr')">
                                Katastrální území
                                <span class="material-icons-outlined sort-icon">arrow_downward</span>
                            </span>
                            <span class="col-kod">Kód</span>
                            <span class="col-plocha">Plocha</span>
                            <span class="col-actions"></span>
                        </div>
                    `;
                    pozemkyState.sousedniParcely.forEach((p, index) => {
                        const icon = p.cislo.startsWith('st') ? 'crop_square' : 'grass';
                        html += `
                            <div class="pozemek-row soused">
                                <span class="material-icons-outlined row-icon">${icon}</span>
                                <span class="row-parcela">${p.cislo}</span>
                                <span class="row-katastr">${p.katastr}</span>
                                <span class="row-kod">[${p.kod}]</span>
                                <span class="row-plocha">${p.plocha}</span>
                                <button class="row-remove" onclick="removeSousedni(${index})" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                list.innerHTML = html;
            }
        }

        function removeSousedni(index) {
            pozemkyState.sousedniParcely.splice(index, 1);
            renderSousedniParcely();
            updatePozemkyState();
        }

        function searchSousedni() {
            const input = document.getElementById('sousedniSearchInput');
            const value = input.value.trim();
            if (!value) return;
            
            pozemkyState.sousedniParcely.push({
                cislo: value,
                katastr: 'Radonice',
                kod: '747076',
                plocha: '—'
            });
            
            renderSousedniParcely();
            input.value = '';
            updatePozemkyState();
        }

        function updatePozemkyState() {
            const btnConfirm = document.getElementById('btnConfirmPozemky');
            const resultBox = document.getElementById('resultPozemky');
            
            const hasPozemkyZameru = pozemkyState.pozemkyZameru.length > 0;
            const hasSousedni = pozemkyState.sousedniParcely.length > 0;
            
            // Tlačítko Potvrdit je aktivní, když jsou definovány pozemky záměru a sousední pozemky
            if (hasPozemkyZameru && hasSousedni) {
                btnConfirm.disabled = false;
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Pozemky identifikovány
                    </div>
                    <div class="result-preview-text">Pozemky záměru (${pozemkyState.pozemkyZameru.length}) a sousední pozemky (${pozemkyState.sousedniParcely.length}) byly identifikovány. Vlastníci budou určeni v části Osoby.</div>
                `;
            } else {
                btnConfirm.disabled = true;
                let missingText = [];
                if (!hasPozemkyZameru) missingText.push('pozemky záměru');
                if (!hasSousedni) missingText.push('sousední pozemky');
                
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Čeká na dokončení
                    </div>
                    <div class="result-preview-text">Chybí: ${missingText.join(', ')}.</div>
                `;
            }
        }

        function completePozemky() {
            controls.pozemky.done = true;
            controls.pozemky.result = 'ok';
            controls.pozemky.pozemkyZameru = pozemkyState.pozemkyZameru;
            controls.pozemky.sousedniParcely = pozemkyState.sousedniParcely;
            closeControl('controlPozemky');
            updateUI();
        }

        // ==========================================
        // KONTROLA ŽÁDOSTI (§ 184 SZ)
        // ==========================================
        function toggleDataStatus(button) {
            const row = button.closest('.data-row');
            const isOk = button.classList.contains('ok');
            
            if (isOk) {
                // Přepni na error
                button.classList.remove('ok');
                button.classList.add('error');
                button.innerHTML = '<span class="material-icons-outlined">cancel</span>';
                button.title = 'Označit jako v pořádku';
                row.classList.add('error');
            } else {
                // Přepni zpět na ok
                button.classList.remove('error');
                button.classList.add('ok');
                button.innerHTML = '<span class="material-icons-outlined">check_circle</span>';
                button.title = 'Označit jako vadné';
                row.classList.remove('error');
            }
            
            updateZadostResult();
        }

        function updateZadostResult() {
            const resultBox = document.getElementById('resultZadost');
            const btnConfirm = document.getElementById('btnConfirmZadost');
            const deficiencySection = document.getElementById('zadostDeficiencySection');
            
            // Počet položek označených jako vadné
            const errorButtons = document.querySelectorAll('#controlZadost .data-status.error');
            const errorCount = errorButtons.length;
            
            if (errorCount > 0) {
                // Zobraz sekci pro poznámku
                deficiencySection.style.display = 'block';
                
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Zjištěny vady v údajích
                    </div>
                    <div class="result-preview-text">${errorCount} ${errorCount === 1 ? 'položka označena' : (errorCount < 5 ? 'položky označeny' : 'položek označeno')} jako vadné. Bude vydána výzva k odstranění vad (§ 185 odst. 2).</div>
                `;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">mail</span>Potvrdit a vydat výzvu';
            } else {
                // Skryj sekci pro poznámku
                deficiencySection.style.display = 'none';
                
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Údaje v žádosti jsou v pořádku
                    </div>
                    <div class="result-preview-text">Všechny údaje byly zkontrolovány a jsou smysluplné.</div>
                `;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
            }
        }

        // ==========================================
        // KONTROLA ŽÁDOSTI - NOVÝ DESIGN
        // ==========================================
        
        // Přepínání záložek v levém okně (strukturovaná data)
        function switchZadostDataTab(btn, tabName) {
            // Deaktivovat všechny záložky
            document.querySelectorAll('.zadost-data-viewer .viewer-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.zadost-data-tab').forEach(t => t.classList.remove('active'));
            
            // Aktivovat vybranou
            btn.classList.add('active');
            let tabId;
            if (tabName === 'zadost') tabId = 'zadostDataZadost';
            else if (tabName === 'formular') tabId = 'zadostDataFormular';
            else tabId = 'zadostDataZadost'; // fallback
            document.getElementById(tabId).classList.add('active');
        }
        
        // Stav kontroly sekcí žádosti
        const zadostSectionState = {
            podani: null,
            zadatel: null,
            zastupce: null,
            zamer: null,
            charakteristika: null,
            podrobnosti: null,
            pozemky: null,
            prilohy: null,
            vyjimky: null
        };
        
        const sectionNames = {
            podani: 'Údaje o podání',
            zadatel: 'Žadatel',
            zastupce: 'Zástupce',
            zamer: 'Identifikace záměru',
            charakteristika: 'Charakteristika záměru',
            podrobnosti: 'Podrobnější informace',
            pozemky: 'Pozemky záměru',
            prilohy: 'Přílohy žádosti',
            vyjimky: 'Výjimky z požadavků'
        };
        
        // Sledování, zda je sekce Zástupce relevantní pro aktuální scénář
        let zastupceRelevant = false;
        
        // Nastavení stavu sekce
        function setSectionStatus(sectionId, status) {
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            if (!section) return;
            
            const statusDiv = document.getElementById('sectionStatus' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const badge = document.getElementById('statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const btnOk = section.querySelector('.btn-ok');
            const btnVada = section.querySelector('.btn-vada');
            
            if (!statusDiv || !badge) return;
            
            // Reset
            section.classList.remove('status-ok', 'status-vada');
            if (btnOk) btnOk.classList.remove('active');
            if (btnVada) btnVada.classList.remove('active');
            badge.className = 'section-status-badge';
            badge.textContent = '';
            
            // Nastavit nový stav
            if (status === 'ok') {
                zadostSectionState[sectionId] = 'ok';
                section.classList.add('status-ok');
                if (btnOk) btnOk.classList.add('active');
                statusDiv.innerHTML = '<span class="material-icons-outlined">check_circle</span> V pořádku';
                statusDiv.className = 'zadost-section-status status-ok';
                badge.classList.add('ok');
                badge.textContent = '✓';
                
                // Propojení: Pokud potvrdím Podání u REZA/statutár, automaticky potvrdit i Zástupce
                if (sectionId === 'podani' && !zastupceRelevant) {
                    // Sekce Zástupce není relevantní, automaticky nastavit na OK
                    const zastSection = document.querySelector('[data-section-id="zastupce"]');
                    if (zastSection && zadostSectionState.zastupce !== 'ok') {
                        setSectionStatus('zastupce', 'ok');
                    }
                }
            } else if (status === 'vada') {
                zadostSectionState[sectionId] = 'vada';
                section.classList.add('status-vada');
                if (btnVada) btnVada.classList.add('active');
                statusDiv.innerHTML = '<span class="material-icons-outlined">error</span> Označeno jako vada';
                statusDiv.className = 'zadost-section-status status-vada';
                badge.classList.add('vada');
                badge.textContent = '!';
                
                // Otevřít panel pro editaci vady
                showDeficiencyEditor(sectionId);
            } else if (status === 'auto-ok') {
                // Automaticky nastaveno na OK (bez možnosti změny)
                zadostSectionState[sectionId] = 'ok';
                section.classList.add('status-ok');
                statusDiv.innerHTML = '<span class="material-icons-outlined">check_circle</span> Automaticky ověřeno';
                statusDiv.className = 'zadost-section-status status-ok';
                badge.classList.add('ok');
                badge.textContent = '✓';
            } else {
                zadostSectionState[sectionId] = null;
                statusDiv.innerHTML = '<span class="material-icons-outlined">radio_button_unchecked</span> Nezkontrolováno';
                statusDiv.className = 'zadost-section-status';
            }
            
            updateDeficiencyPanel();
        }
        
        // Nastavit sekci jako automaticky ověřenou (skrýt tlačítka)
        function setSectionAutoOk(sectionId, reason) {
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            if (!section) return;
            
            zadostSectionState[sectionId] = 'ok';
            section.classList.add('status-ok');
            
            const statusDiv = document.getElementById('sectionStatus' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const badge = document.getElementById('statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const actionsDiv = section.querySelector('.zadost-section-actions');
            
            if (statusDiv) {
                statusDiv.innerHTML = `<span class="material-icons-outlined">check_circle</span> ${reason}`;
                statusDiv.className = 'zadost-section-status status-ok';
            }
            if (badge) {
                badge.className = 'section-status-badge ok';
                badge.textContent = '✓';
            }
            if (actionsDiv) {
                actionsDiv.style.display = 'none';
            }
        }
        
        // Resetovat sekci na standardní stav s tlačítky
        function resetSectionControls(sectionId) {
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            if (!section) return;
            
            const actionsDiv = section.querySelector('.zadost-section-actions');
            if (actionsDiv) {
                actionsDiv.style.display = 'flex';
            }
            
            zadostSectionState[sectionId] = null;
            section.classList.remove('status-ok', 'status-vada');
            
            const statusDiv = document.getElementById('sectionStatus' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const badge = document.getElementById('statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            
            if (statusDiv) {
                statusDiv.innerHTML = '<span class="material-icons-outlined">radio_button_unchecked</span> Nezkontrolováno';
                statusDiv.className = 'zadost-section-status';
            }
            if (badge) {
                badge.className = 'section-status-badge';
                badge.textContent = '';
            }
        }
        
        // Nastavit všechny sekce na OK najednou
        function setAllSectionsOk() {
            const allSections = ['podani', 'zadatel', 'zastupce', 'zamer', 'charakteristika', 'podrobnosti', 'pozemky', 'prilohy', 'vyjimky'];
            
            allSections.forEach(sectionId => {
                const section = document.querySelector(`[data-section-id="${sectionId}"]`);
                // Přeskočit skryté sekce
                if (!section || section.style.display === 'none') return;
                // Přeskočit již nastavené sekce
                if (zadostSectionState[sectionId] === 'ok') return;
                
                // Nastavit na OK
                setSectionStatus(sectionId, 'ok');
            });
            
            // Vizuální potvrzení
            const btn = document.querySelector('.btn-vse-ok');
            if (btn) {
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="material-icons-outlined">check</span> Hotovo!';
                btn.style.background = '#137333';
                btn.style.color = '#fff';
                btn.style.borderColor = '#137333';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                    btn.style.color = '';
                    btn.style.borderColor = '';
                }, 1500);
            }
        }
        
        // Zobrazit editor nedostatku
        function showDeficiencyEditor(sectionId) {
            // Přepnout na deficiency list
            document.getElementById('deficiencyEmpty').style.display = 'none';
            document.getElementById('deficiencyList').style.display = 'block';
        }
        
        // Aktualizovat panel nedostatků
        function updateDeficiencyPanel() {
            let okCount = 0;
            let vadaCount = 0;
            let pendingCount = 0;
            
            const deficiencies = [];
            
            for (const [key, value] of Object.entries(zadostSectionState)) {
                // Přeskočit sekce které nejsou viditelné
                const section = document.querySelector(`[data-section-id="${key}"]`);
                if (!section || section.style.display === 'none') continue;
                
                if (value === 'ok') okCount++;
                else if (value === 'vada') {
                    vadaCount++;
                    deficiencies.push(key);
                }
                else pendingCount++;
            }
            
            // Aktualizovat statistiky
            document.getElementById('statOkCount').textContent = okCount;
            document.getElementById('statVadaCount').textContent = vadaCount;
            document.getElementById('statPendingCount').textContent = pendingCount;
            
            // Aktualizovat seznam nedostatků
            const listEl = document.getElementById('deficiencyList');
            const emptyEl = document.getElementById('deficiencyEmpty');
            
            if (deficiencies.length === 0) {
                listEl.style.display = 'none';
                emptyEl.style.display = 'block';
            } else {
                listEl.style.display = 'block';
                emptyEl.style.display = 'none';
                
                let html = '';
                deficiencies.forEach(sectionId => {
                    html += `
                        <div class="deficiency-item" data-section="${sectionId}">
                            <div class="deficiency-item-header">
                                <div class="deficiency-item-section">${sectionNames[sectionId]}</div>
                                <button class="deficiency-item-remove" onclick="setSectionStatus('${sectionId}', null)" title="Odebrat vadu">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                            <textarea class="deficiency-item-textarea" placeholder="Popište zjištěný nedostatek pro výzvu k doplnění..." 
                                oninput="updateDeficiencyNote('${sectionId}', this.value)">${zadostDeficiencyNotes[sectionId] || ''}</textarea>
                        </div>
                    `;
                });
                listEl.innerHTML = html;
            }
            
            // Aktualizovat výsledek
            const resultEl = document.getElementById('deficiencyResult');
            const btnConfirm = document.getElementById('btnConfirmZadost');
            
            if (pendingCount > 0) {
                resultEl.className = 'deficiency-result pending';
                resultEl.innerHTML = `
                    <span class="material-icons-outlined">hourglass_empty</span>
                    <div>
                        <strong>Kontrola probíhá</strong>
                        <div style="font-size: 11px; margin-top: 2px;">Zbývá zkontrolovat ${pendingCount} ${pendingCount === 1 ? 'sekci' : (pendingCount < 5 ? 'sekce' : 'sekcí')}</div>
                    </div>
                `;
                btnConfirm.disabled = true;
            } else if (vadaCount > 0) {
                resultEl.className = 'deficiency-result negative';
                resultEl.innerHTML = `
                    <span class="material-icons-outlined">error</span>
                    <div>
                        <strong>Žádost má nedostatky</strong>
                        <div style="font-size: 11px; margin-top: 2px;">Nalezeno ${vadaCount} ${vadaCount === 1 ? 'vada' : (vadaCount < 5 ? 'vady' : 'vad')} — bude vydána výzva k doplnění</div>
                    </div>
                `;
                btnConfirm.disabled = false;
            } else {
                resultEl.className = 'deficiency-result positive';
                resultEl.innerHTML = `
                    <span class="material-icons-outlined">check_circle</span>
                    <div>
                        <strong>Žádost je úplná</strong>
                        <div style="font-size: 11px; margin-top: 2px;">Všechny sekce zkontrolovány bez závad</div>
                    </div>
                `;
                btnConfirm.disabled = false;
            }
        }
        
        // Poznámky k nedostatkům
        const zadostDeficiencyNotes = {};
        
        function updateDeficiencyNote(sectionId, value) {
            zadostDeficiencyNotes[sectionId] = value;
        }
        
        // Dokončit kontrolu žádosti
        function completeZadostKontrola() {
            controls.zadost.done = true;
            
            // Spočítat vady z nového stavu sekcí
            let vadaCount = 0;
            const deficiencyNotes = [];
            
            for (const [key, value] of Object.entries(zadostSectionState)) {
                if (value === 'vada') {
                    vadaCount++;
                    if (zadostDeficiencyNotes[key]) {
                        deficiencyNotes.push(`${sectionNames[key]}: ${zadostDeficiencyNotes[key]}`);
                    }
                }
            }
            
            if (vadaCount > 0) {
                controls.zadost.result = 'vady';
                controls.zadost.deficiencyNote = deficiencyNotes.join('\n');
            } else {
                controls.zadost.result = 'ok';
            }
            
            closeControl('controlZadost');
            updateUI();
        }

        function completeZadost() {
            completeZadostKontrola();
        }

        // ==========================================
        // PŘÍSLUŠNOST - update result
        // ==========================================
        function updatePrislusnostResult() {
            const prislusnost = document.querySelector('input[name="prislusnost"]:checked').value;
            const resultBox = document.getElementById('resultPrislusnost');
            const vyberSuSection = document.getElementById('vyberSuSection');
            const zduvodneniSection = document.getElementById('zduvodneniNeprislusnostiSection');

            // Při změně na příslušný - reset výběru
            if (prislusnost === 'prislusny') {
                vyberSuSection.classList.remove('visible');
                document.getElementById('postoupitSuSelect').value = '';
                document.getElementById('postoupitSuSearchInput').value = '';
                document.getElementById('postoupitSuInfo').classList.remove('visible');
                
                // Skrýt zdůvodnění
                if (zduvodneniSection) {
                    zduvodneniSection.style.display = 'none';
                }
                
                // Zobrazit pozitivní výsledek
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Příslušnost potvrzena
                    </div>
                    <div class="result-preview-text">Stavební úřad je věcně i místně příslušný k projednání této žádosti.</div>
                `;
            } else {
                // Nepříslušný - zobrazit výběr SÚ a zdůvodnění
                vyberSuSection.classList.add('visible');
                
                // Zobrazit zdůvodnění
                if (zduvodneniSection) {
                    zduvodneniSection.style.display = 'block';
                }
                
                const selectedSuValue = document.getElementById('postoupitSuSelect').value;
                
                if (selectedSuValue) {
                    // Je vybrán SÚ - zobrazit info o postoupení
                    const selectedOption = document.querySelector(`#postoupitSuDropdown .su-dropdown-option[data-value="${selectedSuValue}"]`);
                    if (selectedOption) {
                        const suName = selectedOption.querySelector('.su-option-name').textContent;
                        const suType = selectedOption.getAttribute('data-type');
                        const info = selectedOption.getAttribute('data-info').split('|');
                        
                        resultBox.className = 'result-preview negative';
                        resultBox.innerHTML = `
                            <div class="result-preview-title">
                                <span class="material-icons-outlined">send</span>
                                Řízení bude postoupeno
                            </div>
                            <div class="result-preview-text">
                                <strong>${suType}</strong><br>
                                ${info[0]}<br>
                                <span style="color: #5f6368; font-size: 12px;">${info[1]}</span>
                            </div>
                        `;
                    }
                } else {
                    // Není vybrán SÚ - vyzvat k výběru
                    resultBox.className = 'result-preview negative';
                    resultBox.innerHTML = `
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">warning</span>
                            Vyberte příslušný stavební úřad
                        </div>
                        <div class="result-preview-text">Pro postoupení řízení je nutné vybrat stavební úřad, kterému bude řízení postoupeno.</div>
                    `;
                }
            }
            
            // Aktualizace stavu tlačítka potvrdit
            updatePrislusnostButton();
        }
        
        function updatePrislusnostButton() {
            const prislusnost = document.querySelector('input[name="prislusnost"]:checked').value;
            const btnConfirm = document.querySelector('#controlPrislusnost .btn-primary');
            const zduvodneniSection = document.getElementById('zduvodneniNeprislusnostiSection');
            const zduvodneni = zduvodneniSection ? document.getElementById('zduvodneniNeprislusnosti').value.trim() : '';
            
            if (prislusnost === 'neprislusny') {
                const selectedSu = document.getElementById('postoupitSuSelect').value;
                // Tlačítko aktivní pouze pokud je vybrán SÚ a zadáno zdůvodnění
                btnConfirm.disabled = !selectedSu || !zduvodneni;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">send</span>Postoupit řízení';
                btnConfirm.onclick = function() { showPostoupeniModal(); };
            } else {
                btnConfirm.disabled = false;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
                btnConfirm.onclick = function() { completePrislusnost(); };
            }
        }
        
        // ==========================================
        // SEARCHABLE DROPDOWN PRO VÝBĚR SÚ
        // ==========================================
        
        // Otevřít dropdown
        function openSuDropdown(type) {
            const dropdownId = type === 'postoupit' ? 'postoupitSuDropdown' : 
                               (type === 'specialni' ? 'specialniSuDropdown' : 'obecnySuDropdown');
            const dropdown = document.getElementById(dropdownId);
            
            // Zavřít ostatní dropdowny
            document.querySelectorAll('.su-dropdown.open').forEach(d => {
                if (d !== dropdown) d.classList.remove('open');
            });
            
            dropdown.classList.add('open');
        }
        
        // Zavřít dropdown při kliknutí mimo
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.su-search-select')) {
                document.querySelectorAll('.su-dropdown.open').forEach(d => d.classList.remove('open'));
            }
        });
        
        // Filtrovat možnosti
        function filterSuOptions(type) {
            const inputId = type === 'postoupit' ? 'postoupitSuSearchInput' : 
                            (type === 'specialni' ? 'specialniSuSearchInput' : 'obecnySuSearchInput');
            const dropdownId = type === 'postoupit' ? 'postoupitSuDropdown' : 
                               (type === 'specialni' ? 'specialniSuDropdown' : 'obecnySuDropdown');
            
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(dropdownId);
            const searchTerm = input.value.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            
            let visibleCount = 0;
            
            dropdown.querySelectorAll('.su-dropdown-group').forEach(group => {
                let groupVisible = false;
                
                group.querySelectorAll('.su-dropdown-option').forEach(option => {
                    const name = option.querySelector('.su-option-name').textContent.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                    const searchData = (option.dataset.search || '').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                    
                    if (name.includes(searchTerm) || searchData.includes(searchTerm)) {
                        option.classList.remove('hidden');
                        groupVisible = true;
                        visibleCount++;
                    } else {
                        option.classList.add('hidden');
                    }
                });
                
                if (groupVisible) {
                    group.classList.remove('hidden');
                } else {
                    group.classList.add('hidden');
                }
            });
            
            // Zobrazit/skrýt prázdný stav
            const emptyState = dropdown.querySelector('.su-dropdown-empty');
            if (visibleCount === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
            
            // Otevřít dropdown při psaní
            dropdown.classList.add('open');
        }
        
        // Vybrat možnost
        function selectSuOption(type, option) {
            const inputId = type === 'postoupit' ? 'postoupitSuSearchInput' : 
                            (type === 'specialni' ? 'specialniSuSearchInput' : 'obecnySuSearchInput');
            const hiddenInputId = type === 'postoupit' ? 'postoupitSuSelect' : 
                                  (type === 'specialni' ? 'specialniSuSelect' : 'obecnySuSelect');
            const dropdownId = type === 'postoupit' ? 'postoupitSuDropdown' : 
                               (type === 'specialni' ? 'specialniSuDropdown' : 'obecnySuDropdown');
            
            const input = document.getElementById(inputId);
            const hiddenInput = document.getElementById(hiddenInputId);
            const dropdown = document.getElementById(dropdownId);
            
            const value = option.dataset.value;
            const name = option.querySelector('.su-option-name').textContent;
            
            // Nastavit hodnotu
            hiddenInput.value = value;
            input.value = name;
            input.classList.add('selected');
            
            // Označit vybranou možnost
            dropdown.querySelectorAll('.su-dropdown-option').forEach(o => o.classList.remove('selected'));
            option.classList.add('selected');
            
            // Zavřít dropdown
            dropdown.classList.remove('open');
            
            // Aktualizovat info box
            if (type === 'postoupit') {
                updatePostoupitSuInfo(option);
            } else if (type === 'specialni') {
                updateSpecialniSuInfo(option);
            } else {
                updateObecnySuInfo(option);
            }
        }
        
        // Vymazat výběr
        function clearSuSelection(type) {
            const inputId = type === 'postoupit' ? 'postoupitSuSearchInput' : 
                            (type === 'specialni' ? 'specialniSuSearchInput' : 'obecnySuSearchInput');
            const hiddenInputId = type === 'postoupit' ? 'postoupitSuSelect' : 
                                  (type === 'specialni' ? 'specialniSuSelect' : 'obecnySuSelect');
            const dropdownId = type === 'postoupit' ? 'postoupitSuDropdown' : 
                               (type === 'specialni' ? 'specialniSuDropdown' : 'obecnySuDropdown');
            const infoBoxId = type === 'postoupit' ? 'postoupitSuInfo' : 
                              (type === 'specialni' ? 'specialniSuInfo' : 'obecnySuInfo');
            
            const input = document.getElementById(inputId);
            const hiddenInput = document.getElementById(hiddenInputId);
            const dropdown = document.getElementById(dropdownId);
            const infoBox = document.getElementById(infoBoxId);
            
            hiddenInput.value = '';
            input.value = '';
            input.classList.remove('selected');
            
            // Reset filtrování
            dropdown.querySelectorAll('.su-dropdown-group, .su-dropdown-option').forEach(el => el.classList.remove('hidden'));
            dropdown.querySelectorAll('.su-dropdown-option').forEach(o => o.classList.remove('selected'));
            dropdown.querySelector('.su-dropdown-empty').style.display = 'none';
            
            // Skrýt info box
            infoBox.classList.remove('visible');
            
            updatePrislusnostResult();
        }
        
        // Inicializace click handlerů pro dropdown options
        document.addEventListener('DOMContentLoaded', function() {
            // Postoupit dropdown (nový sloučený)
            document.querySelectorAll('#postoupitSuDropdown .su-dropdown-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectSuOption('postoupit', this);
                });
            });
            
            // Staré dropdowny pro zpětnou kompatibilitu
            document.querySelectorAll('#specialniSuDropdown .su-dropdown-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectSuOption('specialni', this);
                });
            });
            
            document.querySelectorAll('#obecnySuDropdown .su-dropdown-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectSuOption('obecny', this);
                });
            });
        });
        
        function updatePostoupitSuInfo(option) {
            const infoBox = document.getElementById('postoupitSuInfo');
            const nameEl = document.getElementById('postoupitSuName');
            const detailsEl = document.getElementById('postoupitSuDetails');
            
            if (option) {
                const info = option.dataset.info.split('|');
                const type = option.dataset.type;
                
                nameEl.textContent = info[0];
                detailsEl.innerHTML = `
                    <span><strong>Typ:</strong> ${type}</span>
                    <span><strong>Adresa:</strong> ${info[1]}</span>
                    <span><strong>E-mail:</strong> ${info[2]}</span>
                    <span><strong>Působnost:</strong> ${info[3] || '—'}</span>
                `;
                infoBox.classList.add('visible');
            } else {
                infoBox.classList.remove('visible');
            }
            
            updatePrislusnostResult();
        }
        
        function updateSpecialniSuInfo(option) {
            const infoBox = document.getElementById('specialniSuInfo');
            const nameEl = document.getElementById('specialniSuName');
            const detailsEl = document.getElementById('specialniSuDetails');
            
            if (option) {
                const info = option.dataset.info.split('|');
                const type = option.dataset.type;
                
                nameEl.textContent = info[0];
                detailsEl.innerHTML = `
                    <span><strong>Typ:</strong> ${type}</span>
                    <span><strong>Adresa:</strong> ${info[1]}</span>
                    <span><strong>E-mail:</strong> ${info[2]}</span>
                    <span><strong>Působnost:</strong> ${info[3] || '—'}</span>
                `;
                infoBox.classList.add('visible');
            } else {
                infoBox.classList.remove('visible');
            }
            
            updatePrislusnostResult();
        }
        
        function updateObecnySuInfo(option) {
            const infoBox = document.getElementById('obecnySuInfo');
            const nameEl = document.getElementById('obecnySuName');
            const detailsEl = document.getElementById('obecnySuDetails');
            
            if (option) {
                const info = option.dataset.info.split('|');
                
                nameEl.textContent = info[0];
                detailsEl.innerHTML = `
                    <span><strong>Adresa:</strong> ${info[1]}</span>
                    <span><strong>E-mail:</strong> ${info[2]}</span>
                    <span><strong>Územní obvod:</strong> ${info[3]}</span>
                `;
                infoBox.classList.add('visible');
            } else {
                infoBox.classList.remove('visible');
            }
            
            updatePrislusnostResult();
        }

        // ==========================================
        // DOKUMENTACE - kompletní logika
        // ==========================================
        
        // Funkce pro uložení rozpracované kontroly
        function saveDraft(controlName) {
            const indicator = document.getElementById('autoSave' + controlName.charAt(0).toUpperCase() + controlName.slice(1));
            if (!indicator) return;
            
            // Simulace ukládání
            indicator.className = 'auto-save-indicator saving';
            indicator.innerHTML = '<span class="material-icons-outlined">sync</span><span>Ukládám...</span>';
            
            setTimeout(function() {
                indicator.className = 'auto-save-indicator saved';
                indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Uloženo</span>';
                
                // Zobrazit potvrzení
                setTimeout(function() {
                    indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Automaticky uloženo</span>';
                }, 2000);
            }, 800);
        }
        
        // Trigger automatického ukládání při změně (simulace)
        function triggerAutoSave(controlName) {
            const indicator = document.getElementById('autoSave' + controlName.charAt(0).toUpperCase() + controlName.slice(1));
            if (!indicator) return;
            
            indicator.className = 'auto-save-indicator saving';
            indicator.innerHTML = '<span class="material-icons-outlined">sync</span><span>Ukládám...</span>';
            
            setTimeout(function() {
                indicator.className = 'auto-save-indicator saved';
                indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Automaticky uloženo</span>';
            }, 500);
        }
        
        // Stav kontrol dokumentace
        let docCheckState = {
            autoCheckDone: false,
            partStatus: { A: 'unchecked', B: 'unchecked', C: 'unchecked', D: 'unchecked' },
            issues: [],
            currentVersion: 'v3'
        };
        
        function toggleEdFolder(headerEl) {
            const folder = headerEl.closest('.ed-folder');
            if (folder.classList.contains('empty')) return;
            folder.classList.toggle('open');
        }
        
        // Funkce pro návrat do struktury ED z náhledu
        function backToEdStructure() {
            document.getElementById('edTreeContainer').style.display = 'block';
            document.getElementById('edPreviewContainer').style.display = 'none';
            document.getElementById('edBackBtn').style.display = 'none';
            document.getElementById('edBreadcrumb').style.display = 'flex';
        }
        
        function switchDocViewerTab(tabEl, view) {
            // Tato funkce již není potřeba se starými záložkami
            // Zachována pro zpětnou kompatibilitu
            const treeContainer = document.getElementById('edTreeContainer');
            const previewContainer = document.getElementById('edPreviewContainer');
            
            if (view === 'struktura') {
                treeContainer.style.display = 'block';
                previewContainer.style.display = 'none';
                document.getElementById('edBackBtn').style.display = 'none';
                document.getElementById('edBreadcrumb').style.display = 'flex';
            } else {
                treeContainer.style.display = 'none';
                previewContainer.style.display = 'block';
                document.getElementById('edBackBtn').style.display = 'flex';
                document.getElementById('edBreadcrumb').style.display = 'none';
            }
        }
        
        function previewEdFile(fileName, section) {
            // Přepnout kontejnery
            document.getElementById('edTreeContainer').style.display = 'none';
            document.getElementById('edPreviewContainer').style.display = 'block';
            
            // Zobrazit tlačítko Zpět, skrýt breadcrumb
            document.getElementById('edBackBtn').style.display = 'flex';
            document.getElementById('edBreadcrumb').style.display = 'none';
            
            // Zobrazit náhled
            const previewContent = document.getElementById('edPreviewContent');
            const versionLabel = docCheckState.currentVersion === 'v3' ? '' : ` (${docCheckState.currentVersion})`;
            previewContent.innerHTML = `
                <span class="material-icons-outlined" style="font-size: 64px; color: #c62828; margin-bottom: 16px;">picture_as_pdf</span>
                <div style="font-size: 16px; font-weight: 500; color: #202124; margin-bottom: 8px;">${fileName}${versionLabel}</div>
                <div style="font-size: 13px; color: #5f6368;">V ostré verzi by se zde zobrazil náhled dokumentu</div>
            `;
        }
        
        function changeEdVersion() {
            const select = document.getElementById('edVersionSelect');
            const newVersion = select.value;
            docCheckState.currentVersion = newVersion;
            
            // Simulace načtení jiné verze - zavřeme všechny otevřené složky
            document.querySelectorAll('.ed-folder.open').forEach(folder => {
                folder.classList.remove('open');
            });
            
            // Pokud jsme v náhledu, přepneme zpět na strukturu
            backToEdStructure();
        }
        
        // ==========================================
        // KATEGORIE STAVBY A SOUBOR STAVEB
        // ==========================================
        
        function toggleSouborStaveb() {
            const isSoubor = document.querySelector('input[name="souborStaveb"]:checked').value === 'ano';
            const jednoduchyField = document.getElementById('kategorieJednoduchaField');
            const souborField = document.getElementById('kategorieSouborField');
            
            if (isSoubor) {
                jednoduchyField.style.display = 'none';
                souborField.style.display = 'block';
            } else {
                jednoduchyField.style.display = 'block';
                souborField.style.display = 'none';
            }
        }
        
        function addVedlejsiStavba() {
            const list = document.getElementById('vedlejsiStavbyList');
            const newRow = document.createElement('div');
            newRow.className = 'vedlejsi-stavba-row';
            newRow.innerHTML = `
                <input type="text" class="stavba-input" placeholder="Název stavby">
                <select class="stavba-select">
                    <option value="ostatni">Ostatní</option>
                    <option value="jednoducha">Jednoduchá</option>
                    <option value="drobna">Drobná</option>
                </select>
                <button class="vedlejsi-remove" onclick="removeVedlejsiStavba(this)" title="Odebrat">
                    <span class="material-icons-outlined">close</span>
                </button>
            `;
            list.appendChild(newRow);
        }
        
        function removeVedlejsiStavba(btn) {
            const row = btn.closest('.vedlejsi-stavba-row');
            if (row) {
                row.remove();
            }
        }
        
        function updateSouborSummary() {
            const kategorieHlavni = document.querySelector('input[name="kategorieHlavni"]:checked');
            if (kategorieHlavni) {
                const kategorie = kategorieHlavni.value;
                const kategorieText = {
                    'vyhrazena': 'Vyhrazená',
                    'ostatni': 'Ostatní',
                    'jednoducha': 'Jednoduchá',
                    'drobna': 'Drobná'
                }[kategorie] || 'Ostatní';
                
                const summary = document.getElementById('souborSummary');
                summary.innerHTML = `
                    <span class="material-icons-outlined">info</span>
                    <span>Kategorie souboru staveb: <strong>${kategorieText}</strong> (podle hlavní stavby)</span>
                `;
            }
        }
        
        // Přidání event listeneru pro změnu kategorie hlavní stavby
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input[name="kategorieHlavni"]').forEach(input => {
                input.addEventListener('change', updateSouborSummary);
            });
        });
        
        function setDocPartStatus(part, status) {
            docCheckState.partStatus[part] = status;
            
            // Update UI pro tlačítka
            const item = document.querySelector(`.doc-part-item[data-part="${part}"]`);
            if (!item) return;
            
            item.classList.remove('status-ok', 'status-warning', 'status-error', 'status-unchecked');
            item.classList.add('status-' + status);
            
            // Update buttons - odstranit active a unchecked ze všech
            const buttons = item.querySelectorAll('.doc-part-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active', 'unchecked');
            });
            
            // Nastavit správný stav tlačítku
            const targetBtn = item.querySelector('.doc-part-btn.' + status) || item.querySelector('.doc-part-btn.ok');
            if (status === 'ok') {
                targetBtn.classList.add('active');
            } else if (status === 'unchecked') {
                item.querySelector('.doc-part-btn.ok').classList.add('unchecked');
            } else {
                targetBtn.classList.add('active');
            }
            
            // Zobrazení/skrytí sekce pro nedostatky dané části
            const partSection = document.getElementById('partIssues' + part);
            
            if (status === 'error') {
                if (partSection) {
                    partSection.style.display = 'block';
                    // Focus na textarea
                    setTimeout(() => {
                        const textarea = document.getElementById('partIssueText' + part);
                        if (textarea) textarea.focus();
                    }, 100);
                }
            } else {
                if (partSection) {
                    partSection.style.display = 'none';
                }
                // Odeber všechny nedostatky pro tuto část
                docCheckState.issues = docCheckState.issues.filter(i => i.part !== part);
                const listEl = document.getElementById('partIssuesList' + part);
                if (listEl) listEl.innerHTML = '';
                const textEl = document.getElementById('partIssueText' + part);
                if (textEl) textEl.value = '';
            }
            
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        // Přidání nedostatku k části dokumentace
        function addPartIssue(part) {
            const textarea = document.getElementById('partIssueText' + part);
            const text = textarea.value.trim();
            
            if (!text) {
                textarea.focus();
                return;
            }
            
            const partNames = {
                A: 'Průvodní zpráva',
                B: 'Souhrnná technická zpráva', 
                C: 'Situační výkresy',
                D: 'Dokumentace objektů'
            };
            
            const issueId = 'issue-' + Date.now();
            const fullText = `Část ${part}. ${partNames[part]}: ${text}`;
            
            // Přidat do lokálního stavu
            docCheckState.issues.push({
                id: issueId,
                text: fullText,
                shortText: text,
                part: part,
                source: 'manual'
            });
            
            // Přidat do globálního seznamu
            addGlobalIssue('vyzva', {
                text: fullText,
                source: 'manual',
                controlName: 'Kontrola dokumentace'
            });
            
            // Vyrenderovat nedostatek v UI
            renderPartIssues(part);
            
            // Vyčistit textarea
            textarea.value = '';
            textarea.focus();
            
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        // Odebrání nedostatku z části
        function removePartIssue(issueId, part) {
            const issue = docCheckState.issues.find(i => i.id === issueId);
            docCheckState.issues = docCheckState.issues.filter(i => i.id !== issueId);
            
            // Odebrat z globálního seznamu
            if (issue) {
                const globalIssue = globalIssues.vyzva.find(gi => gi.text === issue.text);
                if (globalIssue) {
                    removeGlobalIssue('vyzva', globalIssue.id);
                }
            }
            
            renderPartIssues(part);
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        // Vyrenderování nedostatků pro konkrétní část
        function renderPartIssues(part) {
            const list = document.getElementById('partIssuesList' + part);
            const partIssues = docCheckState.issues.filter(i => i.part === part);
            
            if (partIssues.length === 0) {
                list.innerHTML = '';
                return;
            }
            
            list.innerHTML = partIssues.map(issue => `
                <div class="part-issue-item" data-issue-id="${issue.id}">
                    <div class="part-issue-icon">
                        <span class="material-icons-outlined">warning</span>
                    </div>
                    <div class="part-issue-content">${issue.shortText || issue.text}</div>
                    <button class="part-issue-remove" onclick="removePartIssue('${issue.id}', '${part}')" title="Odebrat">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
            `).join('');
        }
        
        // Aktualizace viditelnosti celé sekce nedostatků
        function updateIssuesVisibility() {
            const section = document.getElementById('issuesSection');
            const emptyState = document.getElementById('issuesEmpty');
            const countEl = document.getElementById('issuesCount');
            const autoSection = document.getElementById('autoIssuesSection');
            
            const totalIssues = docCheckState.issues.length;
            const autoIssues = docCheckState.issues.filter(i => i.source === 'auto');
            const hasPartSections = ['A', 'B', 'C', 'D'].some(p => docCheckState.partStatus[p] === 'error');
            
            countEl.textContent = totalIssues;
            
            // Zobrazení automatických nedostatků
            if (autoIssues.length > 0) {
                autoSection.style.display = 'block';
                renderAutoIssues();
            } else {
                autoSection.style.display = 'none';
            }
            
            // Zobrazení prázdného stavu
            if (totalIssues === 0 && !hasPartSections) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
        }
        
        // Renderování automatických nedostatků
        function renderAutoIssues() {
            const list = document.getElementById('autoIssuesList');
            const autoIssues = docCheckState.issues.filter(i => i.source === 'auto');
            
            list.innerHTML = autoIssues.map(issue => `
                <div class="part-issue-item" data-issue-id="${issue.id}">
                    <div class="part-issue-icon">
                        <span class="material-icons-outlined">auto_awesome</span>
                    </div>
                    <div class="part-issue-content">${issue.text}</div>
                    <button class="part-issue-remove" onclick="removeAutoIssue('${issue.id}')" title="Odebrat">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
            `).join('');
        }
        
        function removeAutoIssue(issueId) {
            const issue = docCheckState.issues.find(i => i.id === issueId);
            docCheckState.issues = docCheckState.issues.filter(i => i.id !== issueId);
            
            if (issue) {
                const globalIssue = globalIssues.vyzva.find(gi => gi.text === issue.text);
                if (globalIssue) {
                    removeGlobalIssue('vyzva', globalIssue.id);
                }
            }
            
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        function runDocAutoCheck() {
            const btn = document.getElementById('btnRunAutoCheck');
            const desc = document.getElementById('autoCheckDesc');
            const results = document.getElementById('autoCheckResults');
            
            btn.disabled = true;
            btn.classList.add('loading');
            btn.innerHTML = '<span class="material-icons-outlined">sync</span>Probíhá kontrola...';
            
            // Simulace automatické kontroly
            setTimeout(function() {
                btn.classList.remove('loading');
                btn.innerHTML = '<span class="material-icons-outlined">check</span>Kontrola dokončena';
                btn.style.background = '#137333';
                
                desc.style.display = 'none';
                results.classList.add('visible');
                
                // Automaticky přidat zjištěné nedostatky do seznamu
                const timestampIssue = 'Chybí časové razítko u dokumentu D.1.1.02 Půdorys 1.NP.pdf';
                const exists = docCheckState.issues.some(i => i.text === timestampIssue);
                if (!exists) {
                    const issueId = 'issue-auto-' + Date.now();
                    docCheckState.issues.push({ 
                        id: issueId,
                        text: timestampIssue, 
                        source: 'auto' 
                    });
                    
                    // Přidat do globálního seznamu
                    addGlobalIssue('vyzva', {
                        text: timestampIssue,
                        source: 'auto',
                        controlName: 'Automatická kontrola dokumentace'
                    });
                    
                    updateIssuesVisibility();
                    // Zobrazit potvrzení u položky
                    document.getElementById('checkTimestampAdded').style.display = 'inline';
                }
                
                docCheckState.autoCheckDone = true;
                updateDokumentaceResult();
            }, 2000);
        }
        
        function addIssueFromAutoCheck(issueText) {
            // Funkce ponechána pro zpětnou kompatibilitu
            const issueId = 'issue-auto-' + Date.now();
            docCheckState.issues.push({ 
                id: issueId,
                text: issueText, 
                source: 'auto' 
            });
            addGlobalIssue('vyzva', {
                text: issueText,
                source: 'auto',
                controlName: 'Automatická kontrola dokumentace'
            });
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        // Staré funkce - ponechány pro zpětnou kompatibilitu
        function addIssue() {
            // Tato funkce už není používána v novém UI
        }
        
        function addIssueToList(issueText, source = 'manual') {
            // Tato funkce už není používána v novém UI
        }
        
        function removeIssue(issueId) {
            // Tato funkce už není používána v novém UI
        }
        
        function renderIssues() {
            // Nahrazeno funkcí updateIssuesVisibility
            updateIssuesVisibility();
        }
        
        function updateDokumentaceResult() {
            const resultBox = document.getElementById('resultDokumentace');
            const btnConfirm = document.getElementById('btnConfirmDokumentace');
            const issueCount = docCheckState.issues.length;
            const hasProblems = Object.values(docCheckState.partStatus).some(s => s === 'warning' || s === 'error');
            const allChecked = Object.values(docCheckState.partStatus).every(s => s !== 'unchecked');
            
            if (issueCount > 0 || hasProblems) {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Dokumentace vykazuje nedostatky
                    </div>
                    <div class="result-preview-text">
                        Zjištěno ${issueCount} nedostatků. Bude vydána výzva k doplnění a řízení přerušeno.
                    </div>
                `;
            } else if (!allChecked) {
                resultBox.className = 'result-preview neutral';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Kontrola nebyla dokončena
                    </div>
                    <div class="result-preview-text">Zkontrolujte všechny části dokumentace kliknutím na zaškrtávátko.</div>
                `;
            } else {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Dokumentace v pořádku
                    </div>
                    <div class="result-preview-text">Všechny části dokumentace jsou přítomny a úplné.</div>
                `;
            }
            
            // Tlačítko je vždy "Potvrdit kontrolu"
            btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
        }

        // ==========================================
        // DOKLADOVÁ ČÁST - update result
        // ==========================================
        function updateDokladyResult() {
            const vyjadreni = document.querySelector('input[name="vyjadreni_ss"]:checked').value;
            const stanoviska = document.querySelector('input[name="stanoviska_do"]:checked').value;
            const resultBox = document.getElementById('resultDoklady');

            if (vyjadreni === 'kompletni' && stanoviska === 'kompletni') {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Dokladová část v pořádku
                    </div>
                    <div class="result-preview-text">Všechna vyjádření a stanoviska jsou k dispozici.</div>
                `;
            } else if (stanoviska === 'zaporne') {
                resultBox.className = 'result-preview negative';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">cancel</span>
                        Záporné stanovisko DO
                    </div>
                    <div class="result-preview-text">Řízení bude zastaveno z důvodu záporného stanoviska dotčeného orgánu.</div>
                `;
            } else if (vyjadreni === 'chybi') {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Chybí vyjádření
                    </div>
                    <div class="result-preview-text">Bude vydána výzva k doplnění a řízení přerušeno.</div>
                `;
            } else if (stanoviska === 'chybi') {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">schedule</span>
                        Chybí stanovisko DO
                    </div>
                    <div class="result-preview-text">SÚ si stanovisko vyžádá. Běží lhůta 30 dnů.</div>
                `;
            }
        }

        // ==========================================
        // ÚZEMNÍ PLÁN - EXISTENCE
        // ==========================================
        function updateUPExistence() {
            const existence = document.querySelector('input[name="up_existence"]:checked').value;
            const aiSection = document.getElementById('aiControlSection');
            const aiResultSection = document.getElementById('aiResultSection');
            const upNeexistujeInfo = document.getElementById('upNeexistujeInfo');
            const upVysledekSection = document.getElementById('upVysledekSection');
            const resultBox = document.getElementById('resultUP');
            
            if (existence === 'neexistuje') {
                // Skrýt AI kontrolu
                aiSection.style.display = 'none';
                aiResultSection.style.display = 'none';
                upNeexistujeInfo.style.display = 'flex';
                
                // Zobrazit sekci výsledku s upravenými možnostmi
                upVysledekSection.style.display = 'block';
                
                // Upravit result preview
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Územní plán neexistuje
                    </div>
                    <div class="result-preview-text">Záměr bude posouzen podle § 193 SZ. Zastavěným územím je intravilán. Zrychlené řízení nelze použít.</div>
                `;
            } else {
                // Zobrazit AI kontrolu
                aiSection.style.display = 'block';
                upNeexistujeInfo.style.display = 'none';
                
                // Reset result preview
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Záměr je v souladu s ÚP
                    </div>
                    <div class="result-preview-text">Záměr je v souladu s platným územním plánem.</div>
                `;
            }
        }

        // ==========================================
        // AI COMPLIANCE KONTROLA
        // ==========================================
        function runAiCompliance() {
            const btn = document.getElementById('btnAiKontrola');
            const aiSection = document.getElementById('aiControlSection');
            const resultSection = document.getElementById('aiResultSection');
            
            // Změna stavu tlačítka na loading
            btn.disabled = true;
            btn.classList.add('loading');
            btn.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span>Probíhá analýza...';
            
            // Simulace AI zpracování (2.5 sekundy)
            setTimeout(function() {
                // Skrýt tlačítko, zobrazit výsledek
                aiSection.style.display = 'none';
                resultSection.style.display = 'block';
            }, 2500);
        }

        function showComplianceReport() {
            const reportDetail = document.getElementById('aiReportDetail');
            const vysledekSection = document.getElementById('upVysledekSection');
            
            reportDetail.style.display = 'block';
            vysledekSection.style.display = 'none';
        }

        function hideComplianceReport() {
            const reportDetail = document.getElementById('aiReportDetail');
            const vysledekSection = document.getElementById('upVysledekSection');
            
            reportDetail.style.display = 'none';
            vysledekSection.style.display = 'block';
        }

        // ==========================================
        // ÚZEMNĚ PLÁNOVACÍ DOKUMENTACE - update result
        // ==========================================
        function updateUPResult() {
            const vysledek = document.querySelector('input[name="up_vysledek"]:checked').value;
            const resultBox = document.getElementById('resultUP');
            const zduvodneniSection = document.getElementById('zduvodneniNesouladuSection');
            const poznamkySection = document.getElementById('poznamkySouladSection');
            const btnConfirm = document.querySelector('#controlUP .btn-primary');

            if (vysledek === 'soulad') {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Záměr je v souladu s ÚPD
                    </div>
                    <div class="result-preview-text">Záměr je v souladu s platnou územně plánovací dokumentací.</div>
                `;
                zduvodneniSection.style.display = 'none';
                poznamkySection.style.display = 'block';
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
                btnConfirm.disabled = false;
            } else {
                resultBox.className = 'result-preview negative';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">cancel</span>
                        Nesoulad s ÚPD
                    </div>
                    <div class="result-preview-text">Žádost bude zamítnuta z důvodu nesouladu s územně plánovací dokumentací.</div>
                `;
                zduvodneniSection.style.display = 'block';
                poznamkySection.style.display = 'none';
                // Focus na textarea
                setTimeout(() => {
                    document.getElementById('upPoznamky').focus();
                }, 100);
                updateUPConfirmButton();
            }
        }
        
        function updateUPConfirmButton() {
            const vysledek = document.querySelector('input[name="up_vysledek"]:checked').value;
            const btnConfirm = document.querySelector('#controlUP .btn-primary');
            
            if (vysledek === 'nesoulad') {
                const zduvodneni = document.getElementById('upPoznamky').value.trim();
                btnConfirm.innerHTML = '<span class="material-icons-outlined">gavel</span>Zamítnout žádost';
                btnConfirm.disabled = !zduvodneni;
            } else {
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
                btnConfirm.disabled = false;
            }
        }

        // ==========================================
        // ZRYCHLENÉ ŘÍZENÍ - update result
        // ==========================================
        function updateZrychleneResult() {
            const checkboxes = document.querySelectorAll('#controlZrychlene input[type="checkbox"]');
            let allChecked = true;
            
            checkboxes.forEach(cb => {
                const option = cb.closest('.control-option');
                if (cb.checked) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                    allChecked = false;
                }
            });

            const resultBox = document.getElementById('resultZrychlene');
            if (allChecked) {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Podmínky splněny
                    </div>
                    <div class="result-preview-text">Všechny podmínky pro zrychlené řízení jsou splněny.</div>
                `;
            } else {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Podmínky nesplněny
                    </div>
                    <div class="result-preview-text">Řízení bude vedeno standardním způsobem.</div>
                `;
            }
        }

        // ==========================================
        // INFO PANEL UPDATE
        // ==========================================
        function updateInfoPanel() {
            const infoPanel = document.getElementById('infoPanel');
            
            // Zkontroluj stav příslušnosti
            if (controls.prislusnost.done && controls.prislusnost.result === 'neprislusny') {
                const postoupit = controls.prislusnost.postoupit;
                let suNazev = 'příslušnému stavebnímu úřadu';
                
                if (postoupit) {
                    const info = postoupit.info.split('|');
                    suNazev = info[0];
                }
                
                infoPanel.className = 'info-panel error';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">send</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Řízení bude postoupeno</div>
                        <div class="info-panel-text">
                            Stavební úřad není příslušný. Řízení bude postoupeno: <strong>${suNazev}</strong>.<br>
                            Další kontroly nejsou vyžadovány.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj stav dokumentace
            if (controls.dokumentace.done && controls.dokumentace.result === 'vady') {
                infoPanel.className = 'info-panel warning';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">warning</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Dokumentace vykazuje vady</div>
                        <div class="info-panel-text">
                            Bude vydána výzva k doplnění a řízení přerušeno. Po odstranění vad pokračujte v kontrolách.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj vady žádosti
            if (controls.zadost.done && controls.zadost.result === 'vady') {
                infoPanel.className = 'info-panel warning';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">mail</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Žádost vykazuje vady</div>
                        <div class="info-panel-text">
                            Bude vydána výzva k odstranění vad (§ 185 odst. 2) a řízení přerušeno do 10 dnů od zahájení.
                            Můžete pokračovat v kontrolách nebo rovnou vydat výzvu.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj chybějící vyjádření VTI/VDI (vada žádosti)
            if (controls.identifikace.done && controls.identifikace.result === 'vady') {
                const pocet = controls.identifikace.chybiVTI_VDI ? controls.identifikace.chybiVTI_VDI.length : 0;
                infoPanel.className = 'info-panel warning';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">warning</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Chybí vyjádření vlastníků sítí</div>
                        <div class="info-panel-text">
                            Chybí ${pocet} ${pocet === 1 ? 'vyjádření' : 'vyjádření'} VTI/VDI. Jedná se o vadu žádosti.<br>
                            Bude vydána výzva k doplnění stavebníkovi.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj chybějící stanoviska DO (SÚ si vyžádá sám)
            if (controls.identifikace.done && controls.identifikace.result === 'vyzidat_do') {
                const pocet = controls.identifikace.chybiDO ? controls.identifikace.chybiDO.length : 0;
                const doNames = controls.identifikace.chybiDO ? controls.identifikace.chybiDO.join(', ') : '';
                infoPanel.className = 'info-panel schedule';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">schedule_send</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Vyžádat závazná stanoviska DO</div>
                        <div class="info-panel-text">
                            Chybí ${pocet} závazné ${pocet === 1 ? 'stanovisko' : 'stanoviska'} DO: <strong>${doNames}</strong>.<br>
                            SÚ si stanoviska vyžádá. Staví se lhůta pro rozhodnutí. DO mají 30 dnů na vydání stanoviska.
                        </div>
                    </div>
                `;
                return;
            }

            // Standardní stav
            infoPanel.className = 'info-panel';
            infoPanel.innerHTML = `
                <span class="material-icons-outlined">info</span>
                <div class="info-panel-content">
                    <div class="info-panel-title">Kontrola a příprava řízení</div>
                    <div class="info-panel-text">
                        V tomto kroku proveďte kontroly žádosti a definujte parametry řízení (účastníci, pozemky, dotčené orgány). 
                        Řízení je zahájeno dnem doručení bezvadné žádosti (7. 1. 2026), od tohoto data běží lhůta pro vydání rozhodnutí.
                    </div>
                </div>
            `;
        }

        // ==========================================
        // UPDATE UI
        // ==========================================
        function updateUI() {
            let completedCount = 0;
            const totalCount = Object.keys(controls).length;
            const isPrislusny = !controls.prislusnost.done || controls.prislusnost.result === 'ok';
            
            // Kontrola, zda jsou zjištěny vady (pro tlačítko Výzva k doplnění)
            const hasVady = Object.values(controls).some(c => c.done && (c.result === 'vady' || c.result === 'warning'));

            for (const [key, control] of Object.entries(controls)) {
                const card = document.getElementById('card-' + key);
                if (!card) continue;
                
                // Kontroly s vadami neblokují ostatní kontroly - stačí že jsou done
                let dependenciesMet = control.depends.every(dep => controls[dep].done);
                
                // Pokud SÚ není příslušný, nic dalšího nelze dělat
                if (!isPrislusny && key !== 'prislusnost') {
                    dependenciesMet = false;
                }

                // Remove all status classes
                card.classList.remove('status-waiting', 'status-ready', 'status-done', 'status-warning', 'status-error', 'disabled');

                if (control.done) {
                    if (control.result === 'ok') {
                        card.classList.add('status-done');
                    } else if (control.result === 'vady' || control.result === 'warning') {
                        card.classList.add('status-warning');
                    } else {
                        card.classList.add('status-error');
                    }
                    completedCount++;
                    updateCardContent(key, 'done');
                } else if (dependenciesMet) {
                    card.classList.add('status-ready');
                    updateCardContent(key, 'ready');
                } else {
                    card.classList.add('status-waiting', 'disabled');
                    updateCardContent(key, 'waiting');
                }
            }

            // Update progress
            document.getElementById('progressText').textContent = completedCount + ' z ' + totalCount + ' kontrol';
            document.getElementById('progressFill').style.width = (completedCount / totalCount * 100) + '%';

            // Update info panel
            updateInfoPanel();

            // Update summary
            const allDone = Object.values(controls).every(c => c.done);
            const allOk = Object.values(controls).every(c => c.result === 'ok');
            const hasBlocking = Object.values(controls).some(c => c.done && c.result === 'error');
            
            if (!isPrislusny) {
                document.getElementById('summaryTitle').textContent = 'Stavební úřad není příslušný';
                document.getElementById('summaryDesc').textContent = 'Řízení bude postoupeno příslušnému stavebnímu úřadu.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">send</span>Postoupit řízení';
            } else if (allDone && allOk) {
                document.getElementById('summaryTitle').textContent = 'Všechny kontroly dokončeny';
                document.getElementById('summaryDesc').textContent = 'Řízení je připraveno k zahájení. Lhůta začne běžet od 7. 1. 2026.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">play_circle</span>Zahájit řízení';
            } else if (allDone && hasVady && !hasBlocking) {
                // Všechny kontroly hotové, ale jsou vady - nabídnout Výzvu k doplnění
                document.getElementById('summaryTitle').textContent = 'Zjištěny nedostatky v žádosti';
                document.getElementById('summaryDesc').textContent = 'Kontroly dokončeny. Žádost vykazuje nedostatky, bude vydána výzva k doplnění.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">mail</span>Vydat výzvu k doplnění';
            } else if (hasVady) {
                // Jsou vady, ale ne všechny kontroly hotové
                const remaining = Object.values(controls).filter(c => !c.done).length;
                document.getElementById('summaryTitle').textContent = 'Zjištěny nedostatky';
                document.getElementById('summaryDesc').textContent = 'Zjištěny nedostatky. Zbývá ' + remaining + ' kontrol. Dokončete kontroly nebo vydejte výzvu.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">mail</span>Vydat výzvu k doplnění';
            } else if (hasBlocking) {
                document.getElementById('summaryTitle').textContent = 'Řízení nelze pokračovat';
                document.getElementById('summaryDesc').textContent = 'Některé kontroly blokují pokračování řízení.';
                document.getElementById('btnZahajit').disabled = true;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">block</span>Řízení blokováno';
            } else {
                document.getElementById('summaryTitle').textContent = 'Dokončete všechny kontroly';
                const remaining = Object.values(controls).filter(c => !c.done).length;
                document.getElementById('summaryDesc').textContent = 'Zbývá ' + remaining + ' kontrol k dokončení.';
                document.getElementById('btnZahajit').disabled = true;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">play_circle</span>Zahájit řízení';
            }
        }

        function updateCardContent(key, status) {
            const card = document.getElementById('card-' + key);
            const statusBadge = card.querySelector('.control-card-status');
            const actionBtn = card.querySelector('.control-card-action');

            const config = {
                prislusnost: { controlId: 'controlPrislusnost', readyText: 'Provést kontrolu', doneText: 'Příslušný', doneTextNeg: 'Nepříslušný' },
                zadost: { controlId: 'controlZadost', readyText: 'Zkontrolovat žádost', doneText: 'Úplná', doneTextNeg: 'Odložení' },
                dokumentace: { controlId: 'controlDokumentace', readyText: 'Provést kontrolu', doneText: 'V pořádku', doneTextNeg: 'Vykazuje vady' },
                pozemky: { controlId: 'controlPozemky', readyText: 'Identifikovat pozemky', doneText: 'Identifikováno', doneTextNeg: 'Identifikováno' },
                up: { controlId: 'controlUP', readyText: 'Provést kontrolu', doneText: 'V souladu', doneTextNeg: 'Nesoulad' },
                identifikace: { controlId: 'controlIdentifikace', readyText: 'Provést kontrolu', doneText: 'V pořádku', doneTextNeg: 'Chybí doklady' },
                ucastnici: { controlId: 'controlUcastnici', readyText: 'Definovat osoby', doneText: 'Kompletní', doneTextNeg: 'Kompletní' },
                zrychlene: { controlId: 'controlZrychlene', readyText: 'Ověřit podmínky', doneText: 'Splněno', doneTextNeg: 'Nesplněno' }
            };

            const ctrl = controls[key];
            const cfg = config[key];

            if (status === 'done') {
                if (ctrl.result === 'ok') {
                    statusBadge.textContent = 'Hotovo';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">check_circle</span>' + cfg.doneText;
                } else if (ctrl.result === 'vady' || ctrl.result === 'warning') {
                    statusBadge.textContent = 'Vady';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">warning</span>' + cfg.doneTextNeg;
                } else {
                    statusBadge.textContent = 'Blokuje';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">cancel</span>' + cfg.doneTextNeg;
                }
                actionBtn.onclick = function() { openControl(cfg.controlId); };
            } else if (status === 'ready') {
                statusBadge.textContent = 'K provedení';
                actionBtn.innerHTML = '<span class="material-icons-outlined">play_arrow</span>' + cfg.readyText;
                actionBtn.onclick = function() { openControl(cfg.controlId); };
            } else {
                statusBadge.textContent = 'Čeká';
                const waitingOn = ctrl.depends.find(dep => !controls[dep].done);
                const waitingText = {
                    prislusnost: 'Nejprve příslušnost',
                    dokumentace: 'Nejprve dokumentace',
                    pozemky: 'Nejprve pozemky',
                    identifikace: 'Nejprve identifikace',
                    doklady: 'Nejprve doklady',
                    up: 'Nejprve územní plán',
                    ucastnici: 'Nejprve osoby'
                };
                actionBtn.innerHTML = '<span class="material-icons-outlined">lock</span>' + (waitingText[waitingOn] || 'Nejprve ostatní kontroly');
                actionBtn.onclick = null;
            }
        }

        // ==========================================
        // COMPLETE CONTROL FUNCTIONS
        // ==========================================
        function completePrislusnost() {
            const prislusnost = document.querySelector('input[name="prislusnost"]:checked').value;
            
            controls.prislusnost.done = true;
            
            if (prislusnost === 'neprislusny') {
                controls.prislusnost.result = 'neprislusny';
                const selectedValue = document.getElementById('postoupitSuSelect').value;
                const selectedOption = document.querySelector(`#postoupitSuDropdown .su-dropdown-option[data-value="${selectedValue}"]`);
                
                if (selectedOption) {
                    controls.prislusnost.postoupit = {
                        nazev: selectedOption.querySelector('.su-option-name').textContent,
                        typSu: selectedOption.getAttribute('data-type'),
                        info: selectedOption.getAttribute('data-info')
                    };
                }
            } else {
                controls.prislusnost.result = 'ok';
                controls.prislusnost.postoupit = null;
            }
            
            closeControl('controlPrislusnost');
            updateUI();
        }
        
        // Zobrazení modálu pro postoupení řízení
        function showPostoupeniModal() {
            const zduvodneni = document.getElementById('zduvodneniNeprislusnosti').value.trim();
            const selectedValue = document.getElementById('postoupitSuSelect').value;
            const selectedOption = document.querySelector(`#postoupitSuDropdown .su-dropdown-option[data-value="${selectedValue}"]`);
            
            let suNazev = '';
            let suAdresa = '';
            
            if (selectedOption) {
                const info = selectedOption.getAttribute('data-info').split('|');
                suNazev = info[0];
                suAdresa = info[1];
            }
            
            // Naplnit modál
            document.getElementById('postoupeniSuNazev').textContent = suNazev;
            document.getElementById('postoupeniSuAdresa').textContent = suAdresa;
            document.getElementById('postoupeniZduvodneni').textContent = zduvodneni;
            
            // Zavřít kontrolu a otevřít modál
            closeControl('controlPrislusnost');
            openModal('postoupeniModal');
        }
        
        // Potvrzení postoupení řízení
        function confirmPostoupeni() {
            const zduvodneni = document.getElementById('zduvodneniNeprislusnosti').value.trim();
            const selectedValue = document.getElementById('postoupitSuSelect').value;
            const selectedOption = document.querySelector(`#postoupitSuDropdown .su-dropdown-option[data-value="${selectedValue}"]`);
            
            controls.prislusnost.done = true;
            controls.prislusnost.result = 'neprislusny';
            
            if (selectedOption) {
                const typSu = selectedOption.getAttribute('data-type');
                controls.prislusnost.postoupit = {
                    nazev: selectedOption.querySelector('.su-option-name').textContent,
                    typSu: typSu,
                    info: selectedOption.getAttribute('data-info'),
                    zduvodneni: zduvodneni
                };
            }
            
            // Přidat do globálního seznamu nedostatků (typ: postoupení)
            addGlobalIssue('postoupeni', {
                text: 'SÚ není příslušný - řízení postoupeno',
                source: 'auto',
                controlName: 'Kontrola příslušnosti'
            });
            
            closeModal('postoupeniModal', null);
            
            // Zobrazit potvrzení
            showPostoupeniConfirmation();
        }
        
        // Zobrazení potvrzení o postoupení
        function showPostoupeniConfirmation() {
            const info = controls.prislusnost.postoupit.info.split('|');
            const nazev = info[0];
            
            // Vytvořit jednoduchý confirmation toast/banner
            const banner = document.createElement('div');
            banner.className = 'confirmation-banner';
            banner.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: #137333;
                color: #fff;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 3000;
                display: flex;
                align-items: center;
                gap: 12px;
                font-size: 14px;
                animation: slideDown 0.3s ease;
            `;
            banner.innerHTML = `
                <span class="material-icons-outlined" style="font-size: 24px;">check_circle</span>
                <div>
                    <div style="font-weight: 500;">Řízení bylo postoupeno</div>
                    <div style="font-size: 12px; opacity: 0.9; margin-top: 2px;">${nazev}</div>
                </div>
            `;
            
            document.body.appendChild(banner);
            
            // Odstranit po 5 sekundách
            setTimeout(() => {
                banner.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => banner.remove(), 300);
            }, 5000);
            
            updateUI();
        }

        function completeDokumentace() {
            controls.dokumentace.done = true;
            
            const hasProblems = Object.values(docCheckState.partStatus).some(s => s !== 'ok');
            
            if (docCheckState.issues.length > 0 || hasProblems) {
                controls.dokumentace.result = 'vady';
                controls.dokumentace.issues = [...docCheckState.issues];
            } else {
                controls.dokumentace.result = 'ok';
                controls.dokumentace.issues = [];
            }
            
            closeControl('controlDokumentace');
            updateUI();
        }

        // ==========================================
        // DOKLADOVÁ ČÁST - DO, VTI, VDI
        // ==========================================
        let identifikaceState = {
            aiAnalyzaDone: false,
            editingSubjektIndex: null,
            subjekty: [
                // DO - Dotčené orgány
                { 
                    id: 'hzs', typ: 'do', nazev: 'HZS Středočeského kraje', detail: 'Požární ochrana',
                    zeZadosti: true, prilozeno: false, 
                    dokument: { typ: 'zavazne_stanovisko', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null, // null | 'kladne' | 'kladne_s_podminkami' | 'zaporne'
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'khs', typ: 'do', nazev: 'KHS Středočeského kraje', detail: 'Hygiena',
                    zeZadosti: true, prilozeno: false,
                    dokument: { typ: 'zavazne_stanovisko', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'ozp', typ: 'do', nazev: 'OŽP - odbor živ. prostředí', detail: 'Obecní úřad',
                    zeZadosti: false, prilozeno: false,
                    dokument: { typ: 'jes', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                
                // VTI - Vlastníci technické infrastruktury
                { 
                    id: 'cez', typ: 'vti', nazev: 'ČEZ Distribuce, a.s.', detail: 'Elektřina',
                    zeZadosti: true, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'gasnet', typ: 'vti', nazev: 'GasNet, s.r.o.', detail: 'Plyn',
                    zeZadosti: true, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'vak', typ: 'vti', nazev: 'Vodárny Kladno-Mělník', detail: 'Vodovod a kanalizace',
                    zeZadosti: true, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'cetin', typ: 'vti', nazev: 'CETIN, a.s.', detail: 'Telekomunikace',
                    zeZadosti: false, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                
                // VDI - Vlastníci dopravní infrastruktury
                { 
                    id: 'ksus', typ: 'vdi', nazev: 'KSÚS Středočeského kraje', detail: 'Silnice II. a III. třídy',
                    zeZadosti: false, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                }
            ]
        };

        // Inicializace renderování při otevření
        function initIdentifikaceMatrix() {
            renderIdentifikaceMatrix();
            updateIdentifikaceResult();
            updateSouhrnRozhodnuti();
        }

        function renderIdentifikaceMatrix() {
            const groups = {
                do: { container: document.getElementById('matrixDO'), countEl: document.getElementById('countDO'), items: [] },
                vti: { container: document.getElementById('matrixVTI'), countEl: document.getElementById('countVTI'), items: [] },
                vdi: { container: document.getElementById('matrixVDI'), countEl: document.getElementById('countVDI'), items: [] }
            };

            // Rozdělit subjekty do skupin
            identifikaceState.subjekty.forEach((s, index) => {
                if (groups[s.typ]) {
                    groups[s.typ].items.push({ ...s, index });
                }
            });

            // Renderovat každou skupinu
            for (const [typ, group] of Object.entries(groups)) {
                group.countEl.textContent = group.items.length;
                
                let html = '';
                group.items.forEach(s => {
                    const rowClass = getRowStatusClass(s);
                    
                    // Sloupec Žádost
                    const zeZadostiCheck = s.zeZadosti 
                        ? '<div class="matrix-check yes"><span class="material-icons-outlined">check</span></div>'
                        : '<div class="matrix-check no"><span class="material-icons-outlined">remove</span></div>';
                    
                    // Sloupec Přiloženo
                    let prilozenoCheck;
                    if (s.prilozeno) {
                        prilozenoCheck = '<div class="matrix-check yes"><span class="material-icons-outlined">check</span></div>';
                    } else if (identifikaceState.aiAnalyzaDone) {
                        prilozenoCheck = '<div class="matrix-check missing"><span class="material-icons-outlined">close</span></div>';
                    } else {
                        prilozenoCheck = '<div class="matrix-check no"><span class="material-icons-outlined">remove</span></div>';
                    }

                    // Sloupec Výsledek
                    let vysledekHtml = '';
                    if (s.prilozeno) {
                        const vysledekClass = s.vysledek === 'kladne' ? 'kladne' : (s.vysledek === 'kladne_s_podminkami' ? 's-podminkami' : (s.vysledek === 'zaporne' ? 'zaporne' : ''));
                        vysledekHtml = `
                            <select class="matrix-vysledek-select ${vysledekClass}" onchange="setVysledek(${s.index}, this.value)">
                                <option value="" ${!s.vysledek ? 'selected' : ''}>—</option>
                                <option value="kladne" ${s.vysledek === 'kladne' ? 'selected' : ''}>Kladné</option>
                                <option value="kladne_s_podminkami" ${s.vysledek === 'kladne_s_podminkami' ? 'selected' : ''}>S podmínkami</option>
                                <option value="zaporne" ${s.vysledek === 'zaporne' ? 'selected' : ''}>Záporné</option>
                            </select>
                        `;
                    } else {
                        vysledekHtml = '<span style="color: #9aa0a6; font-size: 11px;">—</span>';
                    }

                    // Sloupec Podmínky
                    let podminkyHtml = '';
                    if (s.prilozeno) {
                        const pocetPodminek = s.podminky.filter(p => p.aktivni).length;
                        const hasClass = pocetPodminek > 0 ? 'has-podminky' : '';
                        podminkyHtml = `
                            <button class="btn-podminky ${hasClass}" onclick="openPodminkyModal(${s.index})">
                                <span class="material-icons-outlined">edit_note</span>
                                <span class="podminky-count">${pocetPodminek}</span>
                            </button>
                        `;
                    } else {
                        podminkyHtml = '<span style="color: #9aa0a6; font-size: 11px;">—</span>';
                    }

                    html += `
                        <div class="matrix-row extended ${rowClass}" data-index="${s.index}">
                            <div class="matrix-subjekt">
                                <div class="matrix-subjekt-name">${s.nazev}</div>
                                <div class="matrix-subjekt-detail">${s.detail}</div>
                            </div>
                            <div class="matrix-cell">${zeZadostiCheck}</div>
                            <div class="matrix-cell">${prilozenoCheck}</div>
                            <div class="matrix-cell">${vysledekHtml}</div>
                            <div class="matrix-cell">${podminkyHtml}</div>
                        </div>
                    `;
                });
                group.container.innerHTML = html;
            }
        }

        function getRowStatusClass(s) {
            if (!s.prilozeno && identifikaceState.aiAnalyzaDone) return 'status-missing';
            if (s.prilozeno && s.vysledek === 'zaporne') return 'status-missing';
            if (s.prilozeno && s.vysledek === 'kladne_s_podminkami') return 'status-ok';
            if (s.prilozeno && s.vysledek === 'kladne') return 'status-ok';
            if (s.prilozeno && !s.vysledek) return 'status-extra';
            return '';
        }

        function setVysledek(index, value) {
            identifikaceState.subjekty[index].vysledek = value || null;
            renderIdentifikaceMatrix();
            updateIdentifikaceResult();
            updateSouhrnRozhodnuti();
        }

        // Modal pro podmínky
        function openPodminkyModal(index) {
            identifikaceState.editingSubjektIndex = index;
            const s = identifikaceState.subjekty[index];
            
            // Nastavit titulek
            document.getElementById('podminkyModalTitle').textContent = s.nazev;
            
            // Typ dokladu
            const typLabels = { jes: 'Jednotné environmentální stanovisko', zavazne_stanovisko: 'Závazné stanovisko', vyjadreni: 'Vyjádření' };
            document.getElementById('podminkyDokTyp').textContent = typLabels[s.dokument.typ] || s.dokument.typ;
            
            // Metadata dokumentu
            document.getElementById('podminkyDokCj').value = s.dokument.cisloJednaci || '';
            document.getElementById('podminkyDokDatum').value = s.dokument.datumVydani || '';
            document.getElementById('podminkyDokSoubor').textContent = s.dokument.nazevSouboru || '—';
            
            // Výsledek
            document.querySelectorAll('#vysledekOptions .vysledek-option').forEach(opt => {
                const input = opt.querySelector('input');
                input.checked = input.value === s.vysledek;
                opt.classList.toggle('selected', input.checked);
            });
            
            // Podmínky section viditelnost
            const showPodminky = s.vysledek === 'kladne_s_podminkami';
            document.getElementById('podminkySectionList').style.display = showPodminky ? 'block' : 'none';
            
            // Renderovat podmínky
            renderPodminkyList();
            
            // Poznámka
            document.getElementById('podminkyPoznamka').value = s.poznamka || '';
            
            // Otevřít modal
            document.getElementById('podminkyModal').classList.add('open');
        }

        function closePodminkyModal() {
            document.getElementById('podminkyModal').classList.remove('open');
            identifikaceState.editingSubjektIndex = null;
        }

        function renderPodminkyList() {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            const s = identifikaceState.subjekty[index];
            const list = document.getElementById('podminkyList');
            
            if (s.podminky.length === 0) {
                list.innerHTML = '<p style="color: #5f6368; font-size: 12px; font-style: italic;">Zatím nebyly přidány žádné podmínky.</p>';
                return;
            }
            
            let html = '';
            s.podminky.forEach((p, i) => {
                html += `
                    <div class="podminka-item ${p.aktivni ? '' : 'inactive'}">
                        <input type="checkbox" class="podminka-checkbox" ${p.aktivni ? 'checked' : ''} 
                            onchange="togglePodminka(${i}, this.checked)">
                        <div class="podminka-text">${p.text}</div>
                        <button class="podminka-remove" onclick="removePodminka(${i})">
                            <span class="material-icons-outlined">close</span>
                        </button>
                    </div>
                `;
            });
            list.innerHTML = html;
        }

        function addPodminka() {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            const input = document.getElementById('addPodminkaText');
            const text = input.value.trim();
            if (!text) return;
            
            identifikaceState.subjekty[index].podminky.push({ text: text, aktivni: true });
            input.value = '';
            renderPodminkyList();
        }

        function removePodminka(podminkaIndex) {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            identifikaceState.subjekty[index].podminky.splice(podminkaIndex, 1);
            renderPodminkyList();
        }

        function togglePodminka(podminkaIndex, checked) {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            identifikaceState.subjekty[index].podminky[podminkaIndex].aktivni = checked;
            renderPodminkyList();
        }

        function savePodminkyModal() {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            const s = identifikaceState.subjekty[index];
            
            // Uložit metadata dokumentu
            s.dokument.cisloJednaci = document.getElementById('podminkyDokCj').value;
            s.dokument.datumVydani = document.getElementById('podminkyDokDatum').value;
            
            // Uložit výsledek
            const selectedRadio = document.querySelector('#vysledekOptions input:checked');
            s.vysledek = selectedRadio ? selectedRadio.value : null;
            
            // Uložit poznámku
            s.poznamka = document.getElementById('podminkyPoznamka').value;
            
            closePodminkyModal();
            renderIdentifikaceMatrix();
            updateIdentifikaceResult();
            updateSouhrnRozhodnuti();
        }

        // Event listener pro výsledek radio v modalu
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('#vysledekOptions .vysledek-option').forEach(opt => {
                opt.addEventListener('click', function() {
                    document.querySelectorAll('#vysledekOptions .vysledek-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input').checked = true;
                    
                    // Zobrazit/skrýt podmínky section
                    const showPodminky = this.querySelector('input').value === 'kladne_s_podminkami';
                    document.getElementById('podminkySectionList').style.display = showPodminky ? 'block' : 'none';
                });
            });
        });

        function aiAnalyzeDoklady() {
            const btn = document.getElementById('btnAiAnalyzeDoklady');
            const status = document.getElementById('aiAnalyzeStatus');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span>Analyzuji...';
            status.innerHTML = '<span class="material-icons-outlined">sync</span>Probíhá AI analýza dokladové části...';
            status.className = 'identifikace-ai-status';

            setTimeout(function() {
                // Simulace AI výsledků - dokumenty nalezeny s metadaty a podmínkami
                identifikaceState.subjekty.forEach(s => {
                    if (s.id === 'hzs') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'zavazne_stanovisko', cisloJednaci: 'HSCR-2025-0147', datumVydani: '2025-01-08', nazevSouboru: 'Stanovisko_HZS_2025-01-08.pdf' };
                        s.vysledek = 'kladne';
                    } else if (s.id === 'khs') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'zavazne_stanovisko', cisloJednaci: 'KHS/2025/00891', datumVydani: '2025-01-05', nazevSouboru: 'Vyjadreni_KHS_2025-01-05.pdf' };
                        s.vysledek = 'kladne_s_podminkami';
                        s.podminky = [
                            { text: 'K žádosti o kolaudační rozhodnutí předložit doklad o výsledku laboratorní kontroly vzorku pitné vody.', aktivni: true },
                            { text: 'K žádosti o kolaudační rozhodnutí předložit doklad o měření intenzity el. osvětlení v prostoru kanceláře.', aktivni: true }
                        ];
                    } else if (s.id === 'cez') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'CEZ/2024/987654', datumVydani: '2024-12-15', nazevSouboru: 'Vyjadreni_CEZ_2024-12-15.pdf' };
                        s.vysledek = 'kladne_s_podminkami';
                        s.podminky = [
                            { text: 'Při realizaci stavby dodržet ochranné pásmo elektrického vedení NN.', aktivni: true }
                        ];
                    } else if (s.id === 'gasnet') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'GN/5678/2024', datumVydani: '2024-12-12', nazevSouboru: 'Vyjadreni_GasNet_2024-12-12.pdf' };
                        s.vysledek = 'kladne';
                    } else if (s.id === 'vak') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'VKM/2024/12345', datumVydani: '2024-12-20', nazevSouboru: 'Vyjadreni_VaK_2024-12-20.pdf' };
                        s.vysledek = 'kladne_s_podminkami';
                        s.podminky = [
                            { text: 'Přípojka vodovodu bude provedena podle přiložené situace.', aktivni: true },
                            { text: 'Před záhozem bude provedena tlaková zkouška za účasti zástupce VaK.', aktivni: true }
                        ];
                    } else if (s.id === 'cetin') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'CETIN/2024/98765', datumVydani: '2024-12-18', nazevSouboru: 'Vyjadreni_CETIN_2024-12-18.pdf' };
                        s.vysledek = 'kladne';
                    } else if (s.id === 'ksus') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'KSUS/2025/001234', datumVydani: '2025-01-02', nazevSouboru: 'Stanovisko_KSUS_2025-01-02.pdf' };
                        s.vysledek = 'kladne_s_podminkami';
                        s.podminky = [
                            { text: 'Sjezd bude proveden v souladu s ČSN 73 6110.', aktivni: true }
                        ];
                    }
                    // ozp (DO) zůstává nepřiložen jako příklad chybějícího závazného stanoviska DO
                });

                identifikaceState.aiAnalyzaDone = true;
                
                btn.innerHTML = '<span class="material-icons-outlined">check</span>Analýza dokončena';
                btn.disabled = true;
                
                const nalezeno = identifikaceState.subjekty.filter(s => s.prilozeno).length;
                status.innerHTML = `<span class="material-icons-outlined">check_circle</span>Nalezeno ${nalezeno} dokumentů v dokladové části`;
                status.className = 'identifikace-ai-status done';

                renderIdentifikaceMatrix();
                updateIdentifikaceResult();
                updateSouhrnRozhodnuti();
            }, 2000);
        }

        function showDocsTooltip(index, btnEl) {
            const s = identifikaceState.subjekty[index];
            alert('Dokument: ' + s.dokument.nazevSouboru + '\nČ.j.: ' + s.dokument.cisloJednaci + '\nDatum: ' + s.dokument.datumVydani);
        }

        function addSubjekt() {
            const typSelect = document.getElementById('addSubjektTyp');
            const nazevInput = document.getElementById('addSubjektNazev');
            
            const typ = typSelect.value;
            const nazev = nazevInput.value.trim();
            
            if (!nazev) {
                alert('Zadejte název subjektu');
                return;
            }

            const typLabels = { do: 'Dotčený orgán', vti: 'Technická infrastruktura', vdi: 'Dopravní infrastruktura' };
            const dokTyp = typ === 'do' ? 'zavazne_stanovisko' : 'vyjadreni';

            identifikaceState.subjekty.push({
                id: 'custom_' + Date.now(),
                typ: typ,
                nazev: nazev,
                detail: typLabels[typ],
                zeZadosti: false,
                prilozeno: false,
                dokument: { typ: dokTyp, cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                vysledek: null,
                podminky: [],
                poznamka: ''
            });

            nazevInput.value = '';
            renderIdentifikaceMatrix();
            updateIdentifikaceResult();
            updateSouhrnRozhodnuti();
        }

        function updateSouhrnRozhodnuti() {
            const stats = document.getElementById('souhrnStats');
            const reportActions = document.getElementById('reportActions');
            
            const prilozene = identifikaceState.subjekty.filter(s => s.prilozeno);
            const kladne = prilozene.filter(s => s.vysledek === 'kladne').length;
            const sPodminkami = prilozene.filter(s => s.vysledek === 'kladne_s_podminkami').length;
            const zaporne = prilozene.filter(s => s.vysledek === 'zaporne').length;
            const celkemPodminek = identifikaceState.subjekty.reduce((sum, s) => sum + s.podminky.filter(p => p.aktivni).length, 0);
            const chybiDO = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && s.typ === 'do').length;
            const chybiVTI = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && (s.typ === 'vti' || s.typ === 'vdi')).length;
            
            // Zobrazit tlačítka reportu pokud jsou nějaká data
            if (reportActions) {
                reportActions.style.display = (identifikaceState.aiAnalyzaDone && prilozene.length > 0) ? 'flex' : 'none';
            }
            
            let html = `
                <div class="souhrn-stat ok">
                    <span class="material-icons-outlined">check_circle</span>
                    Kladné: ${kladne}
                </div>
                <div class="souhrn-stat podminky">
                    <span class="material-icons-outlined">task_alt</span>
                    S podmínkami: ${sPodminkami} (celkem ${celkemPodminek} podmínek)
                </div>
            `;
            
            if (zaporne > 0) {
                html += `
                    <div class="souhrn-stat error">
                        <span class="material-icons-outlined">cancel</span>
                        Záporné: ${zaporne}
                    </div>
                `;
            }
            
            if (chybiDO > 0) {
                html += `
                    <div class="souhrn-stat warning">
                        <span class="material-icons-outlined">schedule_send</span>
                        Vyžádat DO: ${chybiDO}
                    </div>
                `;
            }
            
            if (chybiVTI > 0) {
                html += `
                    <div class="souhrn-stat warning">
                        <span class="material-icons-outlined">warning</span>
                        Chybí VTI/VDI: ${chybiVTI}
                    </div>
                `;
            }
            
            stats.innerHTML = html;
        }

        // ==========================================
        // REPORT FUNCTIONS
        // ==========================================
        
        function generateReportData() {
            const typLabels = { do: 'Dotčený orgán', vti: 'Vlastník tech. infrastruktury', vdi: 'Vlastník dopr. infrastruktury' };
            const vysledekLabels = { kladne: 'Kladné', kladne_s_podminkami: 'Kladné s podmínkami', zaporne: 'Záporné' };
            const dokTypLabels = { jes: 'Jednotné environmentální stanovisko', zavazne_stanovisko: 'Závazné stanovisko', vyjadreni: 'Vyjádření' };
            
            return {
                metadata: {
                    datumVytvoreni: new Date().toISOString(),
                    spisZn: 'SR00X01I35GT',
                    nazevZameru: 'Novostavba RD včetně přípojek'
                },
                souhrn: {
                    celkemSubjektu: identifikaceState.subjekty.length,
                    prilozenoDokumentu: identifikaceState.subjekty.filter(s => s.prilozeno).length,
                    kladnych: identifikaceState.subjekty.filter(s => s.vysledek === 'kladne').length,
                    sPodminkami: identifikaceState.subjekty.filter(s => s.vysledek === 'kladne_s_podminkami').length,
                    zapornych: identifikaceState.subjekty.filter(s => s.vysledek === 'zaporne').length,
                    celkemPodminek: identifikaceState.subjekty.reduce((sum, s) => sum + s.podminky.filter(p => p.aktivni).length, 0),
                    chybiDO: identifikaceState.subjekty.filter(s => !s.prilozeno && s.typ === 'do').map(s => s.nazev),
                    chybiVTI_VDI: identifikaceState.subjekty.filter(s => !s.prilozeno && (s.typ === 'vti' || s.typ === 'vdi')).map(s => s.nazev)
                },
                subjekty: identifikaceState.subjekty.map(s => ({
                    id: s.id,
                    nazev: s.nazev,
                    typ: s.typ,
                    typLabel: typLabels[s.typ],
                    detail: s.detail,
                    prilozeno: s.prilozeno,
                    dokument: s.dokument ? {
                        typ: s.dokument.typ,
                        typLabel: dokTypLabels[s.dokument.typ],
                        cisloJednaci: s.dokument.cisloJednaci,
                        datumVydani: s.dokument.datumVydani,
                        nazevSouboru: s.dokument.nazevSouboru
                    } : null,
                    vysledek: s.vysledek,
                    vysledekLabel: vysledekLabels[s.vysledek] || null,
                    podminky: s.podminky.filter(p => p.aktivni).map(p => p.text),
                    poznamka: s.poznamka
                })),
                podminkyProRozhodnuti: identifikaceState.subjekty
                    .filter(s => s.podminky.some(p => p.aktivni))
                    .map(s => ({
                        subjekt: s.nazev,
                        cisloJednaci: s.dokument?.cisloJednaci || '',
                        datumVydani: s.dokument?.datumVydani || '',
                        podminky: s.podminky.filter(p => p.aktivni).map(p => p.text)
                    }))
            };
        }

        function showReportModal() {
            const data = generateReportData();
            const content = document.getElementById('reportContent');
            
            let html = `
                <div class="report-header">
                    <h2>REPORT DOKLADOVÉ ČÁSTI</h2>
                    <p>Spis. zn.: ${data.metadata.spisZn}</p>
                    <p>${data.metadata.nazevZameru}</p>
                    <p style="font-size: 11px; color: #5f6368;">Vygenerováno: ${new Date().toLocaleString('cs-CZ')}</p>
                </div>

                <div class="report-section">
                    <h3>SOUHRN</h3>
                    <table class="report-table">
                        <tr><td>Celkem subjektů:</td><td><strong>${data.souhrn.celkemSubjektu}</strong></td></tr>
                        <tr><td>Přiloženo dokumentů:</td><td><strong>${data.souhrn.prilozenoDokumentu}</strong></td></tr>
                        <tr><td>Kladných:</td><td><strong style="color: #137333;">${data.souhrn.kladnych}</strong></td></tr>
                        <tr><td>S podmínkami:</td><td><strong style="color: #004289;">${data.souhrn.sPodminkami}</strong></td></tr>
                        <tr><td>Záporných:</td><td><strong style="color: #c5221f;">${data.souhrn.zapornych}</strong></td></tr>
                        <tr><td>Celkem podmínek:</td><td><strong>${data.souhrn.celkemPodminek}</strong></td></tr>
                    </table>
            `;
            
            if (data.souhrn.chybiDO.length > 0) {
                html += `<p style="color: #b06000; margin-top: 12px;"><strong>⚠ Chybí závazná stanoviska DO:</strong> ${data.souhrn.chybiDO.join(', ')}</p>`;
            }
            if (data.souhrn.chybiVTI_VDI.length > 0) {
                html += `<p style="color: #b06000;"><strong>⚠ Chybí vyjádření VTI/VDI:</strong> ${data.souhrn.chybiVTI_VDI.join(', ')}</p>`;
            }
            
            html += `</div>`;

            // Přehled stanovisek a vyjádření
            html += `
                <div class="report-section">
                    <h3>PŘEHLED STANOVISEK A VYJÁDŘENÍ</h3>
                    <table class="report-table full-width">
                        <thead>
                            <tr>
                                <th>Subjekt</th>
                                <th>Typ</th>
                                <th>Č.j.</th>
                                <th>Datum</th>
                                <th>Výsledek</th>
                                <th>Podmínek</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.subjekty.filter(s => s.prilozeno).forEach(s => {
                const vysledekClass = s.vysledek === 'kladne' ? 'color: #137333;' : (s.vysledek === 'zaporne' ? 'color: #c5221f;' : 'color: #004289;');
                html += `
                    <tr>
                        <td><strong>${s.nazev}</strong><br><small>${s.detail}</small></td>
                        <td>${s.typLabel}</td>
                        <td>${s.dokument?.cisloJednaci || '—'}</td>
                        <td>${s.dokument?.datumVydani || '—'}</td>
                        <td style="${vysledekClass}">${s.vysledekLabel || '—'}</td>
                        <td>${s.podminky.length}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div>`;

            // Podmínky pro rozhodnutí
            if (data.podminkyProRozhodnuti.length > 0) {
                html += `
                    <div class="report-section">
                        <h3>PODMÍNKY PRO ROZHODNUTÍ</h3>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 16px;">
                            Následující podmínky budou součástí rozhodnutí o povolení stavby.
                        </p>
                `;
                
                let podminkaIndex = 1;
                data.podminkyProRozhodnuti.forEach((skupina, i) => {
                    html += `
                        <div class="report-podminka-skupina">
                            <div class="report-podminka-subjekt">
                                <strong>${skupina.subjekt}</strong>
                                ${skupina.cisloJednaci ? `<span>č.j.: ${skupina.cisloJednaci}</span>` : ''}
                                ${skupina.datumVydani ? `<span>ze dne ${skupina.datumVydani}</span>` : ''}
                            </div>
                            <ol class="report-podminka-list" start="${podminkaIndex}">
                    `;
                    skupina.podminky.forEach(p => {
                        html += `<li>${p}</li>`;
                        podminkaIndex++;
                    });
                    html += `</ol></div>`;
                });
                
                html += `</div>`;
            }

            content.innerHTML = html;
            document.getElementById('reportModal').classList.add('open');
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('open');
        }

        function downloadReport(format) {
            const data = generateReportData();
            
            if (format === 'json') {
                downloadReportJSON(data);
            } else if (format === 'txt') {
                downloadReportTXT(data);
            }
        }

        function downloadReportJSON(data) {
            if (!data) data = generateReportData();
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report_dokladova_cast_${data.metadata.spisZn}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadReportTXT(data) {
            if (!data) data = generateReportData();
            
            let txt = `REPORT DOKLADOVÉ ČÁSTI
${'='.repeat(60)}
Spis. zn.: ${data.metadata.spisZn}
Záměr: ${data.metadata.nazevZameru}
Vygenerováno: ${new Date().toLocaleString('cs-CZ')}

SOUHRN
${'-'.repeat(60)}
Celkem subjektů: ${data.souhrn.celkemSubjektu}
Přiloženo dokumentů: ${data.souhrn.prilozenoDokumentu}
Kladných: ${data.souhrn.kladnych}
S podmínkami: ${data.souhrn.sPodminkami}
Záporných: ${data.souhrn.zapornych}
Celkem podmínek: ${data.souhrn.celkemPodminek}
`;
            
            if (data.souhrn.chybiDO.length > 0) {
                txt += `\n⚠ Chybí závazná stanoviska DO: ${data.souhrn.chybiDO.join(', ')}`;
            }
            if (data.souhrn.chybiVTI_VDI.length > 0) {
                txt += `\n⚠ Chybí vyjádření VTI/VDI: ${data.souhrn.chybiVTI_VDI.join(', ')}`;
            }

            txt += `\n\nPŘEHLED STANOVISEK A VYJÁDŘENÍ
${'-'.repeat(60)}\n`;
            
            data.subjekty.filter(s => s.prilozeno).forEach((s, i) => {
                txt += `
${i + 1}. ${s.nazev} (${s.typLabel})
   Č.j.: ${s.dokument?.cisloJednaci || '—'}
   Datum: ${s.dokument?.datumVydani || '—'}
   Výsledek: ${s.vysledekLabel || '—'}
   Podmínek: ${s.podminky.length}
`;
            });

            if (data.podminkyProRozhodnuti.length > 0) {
                txt += `\n\nPODMÍNKY PRO ROZHODNUTÍ
${'-'.repeat(60)}
Následující podmínky budou součástí rozhodnutí o povolení stavby:\n`;
                
                let podminkaIndex = 1;
                data.podminkyProRozhodnuti.forEach(skupina => {
                    txt += `\n${skupina.subjekt}`;
                    if (skupina.cisloJednaci) txt += ` (č.j.: ${skupina.cisloJednaci}`;
                    if (skupina.datumVydani) txt += ` ze dne ${skupina.datumVydani}`;
                    if (skupina.cisloJednaci) txt += `)`;
                    txt += `:\n`;
                    
                    skupina.podminky.forEach(p => {
                        txt += `   ${podminkaIndex}. ${p}\n`;
                        podminkaIndex++;
                    });
                });
            }

            txt += `\n${'='.repeat(60)}
Konec reportu
`;
            
            const blob = new Blob([txt], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report_dokladova_cast_${data.metadata.spisZn}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadReportHTML() {
            const data = generateReportData();
            const reportContent = document.getElementById('reportContent').innerHTML;
            
            const html = `<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Report dokladové části - ${data.metadata.spisZn}</title>
    <style>
        body { font-family: 'Segoe UI', Roboto, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; }
        h2 { color: #004289; margin: 0; }
        h3 { color: #202124; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px; margin-top: 24px; }
        table { border-collapse: collapse; margin: 12px 0; }
        table.full-width { width: 100%; }
        th, td { padding: 8px 12px; text-align: left; border: 1px solid #e0e0e0; }
        th { background: #f8f9fa; font-weight: 600; }
        .report-header { text-align: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #004289; }
        .report-section { margin-bottom: 24px; }
        .report-podminka-skupina { margin-bottom: 16px; padding: 12px; background: #f8f9fa; border-radius: 8px; }
        .report-podminka-subjekt { font-size: 14px; margin-bottom: 8px; }
        .report-podminka-subjekt span { margin-left: 12px; color: #5f6368; font-size: 12px; }
        .report-podminka-list { margin: 0; padding-left: 24px; }
        .report-podminka-list li { margin-bottom: 6px; }
        small { color: #5f6368; }
    </style>
</head>
<body>
${reportContent}
</body>
</html>`;
            
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report_dokladova_cast_${data.metadata.spisZn}_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function updateIdentifikaceResult() {
            const resultItems = document.getElementById('identifikaceResultItems');
            const resultPreview = document.getElementById('resultIdentifikace');
            
            const prilozene = identifikaceState.subjekty.filter(s => s.prilozeno);
            const chybiDO = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && s.typ === 'do');
            const chybiVTI_VDI = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && (s.typ === 'vti' || s.typ === 'vdi'));
            const zaporne = prilozene.filter(s => s.vysledek === 'zaporne');
            const bezVysledku = prilozene.filter(s => !s.vysledek);

            let html = '';
            
            // Přiložené dokumenty
            html += `
                <div class="identifikace-result-item ok">
                    <span class="material-icons-outlined">description</span>
                    <span>Přiloženo: <span class="count">${prilozene.length}</span> dokumentů</span>
                </div>
            `;

            // Záporné stanovisko
            if (zaporne.length > 0) {
                const zaporneNames = zaporne.map(s => s.nazev).join(', ');
                html += `
                    <div class="identifikace-result-item error">
                        <span class="material-icons-outlined">cancel</span>
                        <span>Záporné stanovisko: <span class="count">${zaporne.length}</span></span>
                        <span class="detail">(${zaporneNames})</span>
                    </div>
                `;
            }

            // Chybějící závazná stanoviska DO - SÚ si vyžádá sám
            if (chybiDO.length > 0) {
                const chybiDONames = chybiDO.map(s => s.nazev).join(', ');
                html += `
                    <div class="identifikace-result-item warning">
                        <span class="material-icons-outlined">schedule_send</span>
                        <span>Vyžádat stanovisko: <span class="count">${chybiDO.length}</span> DO</span>
                        <span class="detail">(${chybiDONames})</span>
                    </div>
                    <div class="identifikace-result-item info" style="margin-left: 26px; font-size: 12px;">
                        <span class="material-icons-outlined">info</span>
                        <span>Staví se lhůta pro rozhodnutí • DO má 30 dnů na vydání stanoviska</span>
                    </div>
                `;
            }

            // Chybějící vyjádření VTI/VDI - vada žádosti
            if (chybiVTI_VDI.length > 0) {
                const chybiVTINames = chybiVTI_VDI.map(s => s.nazev).join(', ');
                html += `
                    <div class="identifikace-result-item warning">
                        <span class="material-icons-outlined">warning</span>
                        <span>Chybí vyjádření: <span class="count">${chybiVTI_VDI.length}</span> VTI/VDI</span>
                        <span class="detail">(${chybiVTINames})</span>
                    </div>
                    <div class="identifikace-result-item info" style="margin-left: 26px; font-size: 12px;">
                        <span class="material-icons-outlined">mail</span>
                        <span>Bude vydána výzva k doplnění stavebníkovi</span>
                    </div>
                `;
            }

            // Dokumenty bez hodnocení
            if (bezVysledku.length > 0 && identifikaceState.aiAnalyzaDone) {
                html += `
                    <div class="identifikace-result-item info">
                        <span class="material-icons-outlined">pending</span>
                        <span>Čeká na vyhodnocení: <span class="count">${bezVysledku.length}</span></span>
                    </div>
                `;
            }

            // Vše v pořádku
            if (chybiDO.length === 0 && chybiVTI_VDI.length === 0 && zaporne.length === 0 && bezVysledku.length === 0 && identifikaceState.aiAnalyzaDone) {
                html += `
                    <div class="identifikace-result-item ok">
                        <span class="material-icons-outlined">check_circle</span>
                        <span>Kontrola dokladové části dokončena</span>
                    </div>
                `;
            }

            resultItems.innerHTML = html;

            // Update result preview
            if (!identifikaceState.aiAnalyzaDone) {
                resultPreview.className = 'result-preview';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Čeká na AI analýzu
                    </div>
                    <div class="result-preview-text">Spusťte AI analýzu dokladové části pro automatické rozpoznání přiložených dokumentů.</div>
                `;
            } else if (zaporne.length > 0) {
                resultPreview.className = 'result-preview negative';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">cancel</span>
                        Záporné stanovisko
                    </div>
                    <div class="result-preview-text">
                        ${zaporne.map(s => s.nazev).join(', ')} vydal(y) záporné stanovisko.<br>
                        Záměru nelze vyhovět nebo je třeba řešit rozpor.
                    </div>
                `;
            } else if (chybiVTI_VDI.length > 0) {
                resultPreview.className = 'result-preview warning';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Chybí vyjádření VTI/VDI
                    </div>
                    <div class="result-preview-text">
                        Chybí ${chybiVTI_VDI.length} vyjádření vlastníků sítí. Vada žádosti → výzva k doplnění.
                    </div>
                `;
            } else if (chybiDO.length > 0) {
                resultPreview.className = 'result-preview warning';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">schedule_send</span>
                        Vyžádat stanoviska DO
                    </div>
                    <div class="result-preview-text">
                        Chybí ${chybiDO.length} závazné stanovisko DO. SÚ si vyžádá. Staví se lhůta.
                    </div>
                `;
            } else if (bezVysledku.length > 0) {
                resultPreview.className = 'result-preview';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">pending</span>
                        Dokončete vyhodnocení
                    </div>
                    <div class="result-preview-text">
                        ${bezVysledku.length} dokumentů čeká na vyhodnocení výsledku (kladné/záporné/s podmínkami).
                    </div>
                `;
            } else {
                const celkemPodminek = identifikaceState.subjekty.reduce((sum, s) => sum + s.podminky.filter(p => p.aktivni).length, 0);
                resultPreview.className = 'result-preview positive';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Dokladová část v pořádku
                    </div>
                    <div class="result-preview-text">
                        Všechny dokumenty zkontrolovány. Celkem ${celkemPodminek} podmínek pro rozhodnutí.
                    </div>
                `;
            }
        }

        function completeIdentifikace() {
            const chybiDO = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && s.typ === 'do');
            const chybiVTI_VDI = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && (s.typ === 'vti' || s.typ === 'vdi'));
            const zaporne = identifikaceState.subjekty.filter(s => s.vysledek === 'zaporne');
            
            controls.identifikace.done = true;
            
            // Uložit kompletní data pro generování rozhodnutí
            controls.identifikace.subjekty = JSON.parse(JSON.stringify(identifikaceState.subjekty));
            controls.identifikace.chybiDO = chybiDO.map(s => s.nazev);
            controls.identifikace.chybiVTI_VDI = chybiVTI_VDI.map(s => s.nazev);
            
            // Data pro rozhodnutí - podmínky seskupené podle subjektu
            controls.identifikace.dataProRozhodnuti = {
                stanoviskaAVyjadreni: identifikaceState.subjekty.filter(s => s.prilozeno).map(s => ({
                    nazev: s.nazev,
                    typ: s.typ,
                    dokument: s.dokument,
                    vysledek: s.vysledek,
                    podminky: s.podminky.filter(p => p.aktivni).map(p => p.text)
                })),
                podminkyProRozhodnuti: identifikaceState.subjekty
                    .filter(s => s.podminky.some(p => p.aktivni))
                    .map(s => ({
                        subjekt: s.nazev,
                        cisloJednaci: s.dokument.cisloJednaci,
                        datumVydani: s.dokument.datumVydani,
                        podminky: s.podminky.filter(p => p.aktivni).map(p => p.text)
                    }))
            };
            
            // Určit výsledek kontroly
            if (zaporne.length > 0) {
                controls.identifikace.result = 'error';
            } else if (chybiVTI_VDI.length > 0) {
                controls.identifikace.result = 'vady';
            } else if (chybiDO.length > 0) {
                controls.identifikace.result = 'vyzidat_do';
            } else {
                controls.identifikace.result = 'ok';
            }
            
            closeControl('controlIdentifikace');
            updateUI();
        }

        // Funkce completeDoklady již není potřeba - sloučena do completeIdentifikace

        function completeUP() {
            const vysledek = document.querySelector('input[name="up_vysledek"]:checked').value;
            const poznamky = document.getElementById('upPoznamky') ? document.getElementById('upPoznamky').value.trim() : '';
            
            controls.up.done = true;
            
            // Nejdříve odeber případné staré záznamy o nesouladu z globalIssues
            globalIssues.zamitnuti = globalIssues.zamitnuti.filter(i => i.controlName !== 'Kontrola souladu s ÚPD');
            
            if (vysledek === 'soulad') {
                controls.up.result = 'ok';
            } else {
                controls.up.result = 'error';
                
                // Přidat do globálního seznamu nedostatků (typ: zamítnutí)
                let issueText = 'Záměr není v souladu s územně plánovací dokumentací';
                if (poznamky) {
                    issueText += ': ' + poznamky;
                }
                
                addGlobalIssue('zamitnuti', {
                    text: issueText,
                    source: 'manual',
                    controlName: 'Kontrola souladu s ÚPD'
                });
            }
            
            updateGlobalIssuesBadge();
            closeControl('controlUP');
            updateUI();
        }

        // ==========================================
        // ÚČASTNÍCI ŘÍZENÍ - FUNKCE
        // ==========================================
        
        // Přepínání záložek účastníků
        function switchUcastniciTab(tabEl, panelId) {
            // Deaktivovat všechny záložky
            const tabs = document.querySelectorAll('.ucastnici-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tabEl.classList.add('active');
            
            // Skrýt všechny panely
            const panels = document.querySelectorAll('.ucastnici-panel');
            panels.forEach(p => p.classList.remove('active'));
            
            // Zobrazit vybraný panel
            const panelMap = {
                'ucastnici': 'panelUcastnici',
                'zastupci': 'panelZastupci',
                'dalsi': 'panelDalsiOsoby'
            };
            document.getElementById(panelMap[panelId]).classList.add('active');
        }
        
        // Ověřit všechny účastníky
        function overitVsechnyUcastniky() {
            const pendingStatuses = document.querySelectorAll('#panelUcastnici .ucastnici-status.pending');
            pendingStatuses.forEach(status => {
                status.classList.remove('pending');
                status.classList.add('verified');
                status.title = 'Ověřeno';
                status.querySelector('.material-icons-outlined').textContent = 'check_circle';
            });
            
            // Zobrazit potvrzení
            showToast('Všichni účastníci byli ověřeni');
        }
        
        // Toggle oblíbených
        function toggleOblibeny(btn) {
            const icon = btn.querySelector('.material-icons-outlined');
            if (btn.classList.contains('favorited')) {
                btn.classList.remove('favorited');
                icon.textContent = 'star_border';
                btn.title = 'Přidat do oblíbených';
            } else {
                btn.classList.add('favorited');
                icon.textContent = 'star';
                btn.title = 'Odebrat z oblíbených';
            }
        }
        
        // Přidání účastníka
        function addUcastnik(skupina, metoda) {
            const metodaText = {
                'manual': 'ručně',
                'lv': 'z listu vlastnictví',
                'oblibene': 'z oblíbených'
            };
            const skupinaText = {
                'stavebnik': 'Stavebník',
                'obec': 'Obec',
                'vlastnik': 'Vlastník pozemku/stavby',
                'soused': 'Vlastník sousedního pozemku',
                'ostatni': 'Ostatní účastníci'
            };
            alert(`Přidání účastníka ${metodaText[metoda]} do skupiny "${skupinaText[skupina]}" - bude implementováno`);
        }
        
        // Přidání zástupce
        function addZastupce(metoda) {
            if (metoda === 'oblibene') {
                alert('Přidání zástupce z oblíbených - bude implementováno');
            } else {
                alert('Přidání nového zástupce - bude implementováno');
            }
        }
        
        // Přidání další osoby
        function addDalsiOsoba(metoda) {
            if (metoda === 'oblibene') {
                alert('Přidání další osoby z oblíbených - bude implementováno');
            } else {
                alert('Přidání nové další osoby - bude implementováno');
            }
        }
        
        // ==========================================
        // OVĚŘENÍ POZEMKŮ Z KATASTRU NEMOVITOSTÍ
        // ==========================================
        
        // Simulovaná data vlastníků pro demo
        const simulatedKNData = {
            'st. 123': { vlastnik: 'Jan Novák', typ: 'FO', adresa: 'Květná 123, 110 00 Praha 1', vecnaPrava: null },
            '456/1': { vlastnik: 'Jan Novák', typ: 'FO', adresa: 'Květná 123, 110 00 Praha 1', vecnaPrava: 'VB: ČEZ' },
            'st. 122': { vlastnik: 'Marie Veselá', typ: 'FO', adresa: 'Růžová 45, 551 01 Jaroměř', vecnaPrava: null },
            'st. 124': { vlastnik: 'Petr Svoboda', typ: 'FO', adresa: 'Lipová 78, 551 01 Jaroměř', vecnaPrava: null },
            '456/2': { vlastnik: 'ČEZ Distribuce, a. s.', typ: 'PO', adresa: 'Teplická 874/8, 405 02 Děčín', vecnaPrava: null },
            '457': { vlastnik: 'Město Jaroměř', typ: 'PO', adresa: 'nám. ČSA 16, 551 01 Jaroměř', vecnaPrava: null }
        };
        
        // Přepínání tabů v sekci účastníků
        function switchOsobyTab(btn, tabId) {
            // Odebrat active ze všech tabů
            document.querySelectorAll('.osoby-tab-btn').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            // Skrýt všechny panely a zobrazit aktivní
            document.querySelectorAll('.osoby-tab-panel').forEach(p => p.classList.remove('active'));
            const panel = document.getElementById('tabPanel' + tabId.charAt(0).toUpperCase() + tabId.slice(1));
            if (panel) panel.classList.add('active');
        }
        
        // Načíst VTI/VDI z Dokladové části
        function nacistVTIVDI() {
            const emptyRow = document.getElementById('emptyOstatniUcastnici');
            if (emptyRow) {
                // Simulace načtení VTI/VDI
                const vtiVdiData = [
                    { nazev: 'ČEZ Distribuce, a.s.', typ: 'VTI', ico: '24729035', ds: 'v95uqfy' },
                    { nazev: 'GasNet, s.r.o.', typ: 'VTI', ico: '27295567', ds: 'rdxzhzt' },
                    { nazev: 'Vodovody a kanalizace Náchod, a.s.', typ: 'VTI', ico: '48172928', ds: 'u9xbgxi' },
                    { nazev: 'Ředitelství silnic a dálnic ČR', typ: 'VDI', ico: '65993390', ds: 'zjq4rhz' }
                ];
                
                let html = '';
                vtiVdiData.forEach(item => {
                    html += `
                        <tr class="osoba-row" data-osoba-id="${item.ico}" data-overeno="false">
                            <td><span class="os-status pending"><span class="material-icons-outlined">help_outline</span></span></td>
                            <td>
                                <strong>${item.nazev}</strong><br>
                                <small class="text-muted">IČO: ${item.ico}</small>
                            </td>
                            <td>
                                <span class="os-ds-info"><span class="material-icons-outlined">forward_to_inbox</span> ${item.ds}</span>
                            </td>
                            <td><span class="os-zdroj ${item.typ.toLowerCase()}">${item.typ}</span></td>
                            <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                            <td class="os-actions">
                                <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                                <button onclick="toggleOblibeny(this)" title="Přidat do oblíbených"><span class="material-icons-outlined">star_border</span></button>
                                <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                <button title="Odstranit"><span class="material-icons-outlined">delete</span></button>
                            </td>
                        </tr>
                    `;
                });
                
                emptyRow.outerHTML = html;
                
                // Aktualizovat počet účastníků
                const countEl = document.getElementById('tabCountUcastnici');
                if (countEl) {
                    const currentCount = parseInt(countEl.textContent) || 0;
                    countEl.textContent = currentCount + vtiVdiData.length;
                }
                
                showToast(`Načteno ${vtiVdiData.length} vlastníků infrastruktury z Dokladové části`);
            }
        }
        
        // Načíst dotčené orgány z Dokladové části
        function nacistDotceneOrgany() {
            const emptyRow = document.getElementById('emptyDotceneOrgany');
            if (emptyRow) {
                // Simulace načtení dotčených orgánů
                const dotceneOrganyData = [
                    { nazev: 'Hasičský záchranný sbor Královéhradeckého kraje', typ: 'Požární ochrana', stav: 'vydáno' },
                    { nazev: 'Krajská hygienická stanice Královéhradeckého kraje', typ: 'Ochrana veřejného zdraví', stav: 'vydáno' },
                    { nazev: 'Městský úřad Jaroměř - odbor životního prostředí', typ: 'Ochrana přírody a krajiny', stav: 'čeká' },
                    { nazev: 'Městský úřad Jaroměř - odbor dopravy', typ: 'Napojení na komunikaci', stav: 'vydáno' }
                ];
                
                let html = '';
                dotceneOrganyData.forEach(item => {
                    const stavClass = item.stav === 'vydáno' ? 'ok' : 'pending';
                    const stavText = item.stav === 'vydáno' ? 'Vydáno' : 'Čeká na vydání';
                    const stavIcon = item.stav === 'vydáno' ? 'check_circle' : 'schedule';
                    
                    html += `
                        <tr class="osoba-row">
                            <td><span class="os-status ${stavClass}"><span class="material-icons-outlined">${stavIcon}</span></span></td>
                            <td>
                                <strong>${item.nazev}</strong><br>
                                <small class="text-muted">Dotčený orgán</small>
                            </td>
                            <td><span class="os-role">${item.typ}</span></td>
                            <td><span class="kategorie-stav ${stavClass === 'ok' ? 'ok' : 'ceka'}">${stavText}</span></td>
                            <td class="os-actions">
                                <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                                <button title="Odstranit"><span class="material-icons-outlined">delete</span></button>
                            </td>
                        </tr>
                    `;
                });
                
                emptyRow.outerHTML = html;
                
                // Aktualizovat počet
                const countEl = document.getElementById('tabCountDotceneOrgany');
                if (countEl) {
                    countEl.textContent = dotceneOrganyData.length;
                }
                
                showToast(`Načteno ${dotceneOrganyData.length} dotčených orgánů z Dokladové části`);
            }
        }
        
        // Přidat dotčený orgán ručně
        function pridatDotcenyOrgan() {
            showToast('Otevírám formulář pro přidání dotčeného orgánu...');
            // TODO: Implementovat modal pro ruční přidání
        }
        
        // Ověřit všechny pozemky najednou
        function overitVsechnyPozemkyKN() {
            const rows = document.querySelectorAll('.pozemek-item');
            let delay = 0;
            
            rows.forEach(row => {
                const parcela = row.getAttribute('data-parcela');
                if (parcela) {
                    setTimeout(() => {
                        overitPozemekKNItem(row, parcela);
                    }, delay);
                    delay += 100;
                }
            });
            
            // Po dokončení přidat vlastníky do tabulky
            setTimeout(() => {
                pridatVlastnikyDoTabulky();
                showToast('Všechny pozemky byly ověřeny z KN');
            }, delay + 100);
        }
        
        // Ověřit jeden pozemek
        function overitPozemekKN(parcela, ku) {
            const row = document.querySelector(`.pozemek-item[data-parcela="${parcela}"]`);
            if (row) {
                overitPozemekKNItem(row, parcela);
                setTimeout(() => pridatVlastnikyDoTabulky(), 200);
            }
        }
        
        // Interní funkce pro ověření pozemku
        function overitPozemekKNItem(row, parcela) {
            const vlastnikEl = row.querySelector('.pozemek-vlastnik');
            const statusEl = row.querySelector('.pozemek-status');
            const btnEl = row.querySelector('.btn-overit-sm');
            
            const data = simulatedKNData[parcela];
            
            if (data) {
                // Přidat třídu verified na řádek
                row.classList.add('verified');
                
                vlastnikEl.textContent = data.vlastnik;
                vlastnikEl.classList.add('verified');
                
                statusEl.className = 'pozemek-status ok';
                statusEl.innerHTML = '<span class="material-icons-outlined">check_circle</span>';
                
                // Nahradit tlačítko Ověřit tlačítkem LV
                const lvId = 'lv-' + parcela.replace(/[^a-zA-Z0-9]/g, '');
                btnEl.outerHTML = `
                    <div class="btn-lv-wrapper">
                        <button class="btn-lv" onclick="toggleLVDropdown('${lvId}')">
                            <span class="material-icons-outlined">description</span>
                            LV
                            <span class="material-icons-outlined">expand_more</span>
                        </button>
                        <div class="lv-dropdown" id="${lvId}">
                            <button class="lv-dropdown-item" onclick="openLV('${parcela}', 'castecny')">
                                <div class="lv-item-title">Částečný výpis</div>
                                <div class="lv-item-desc">Pouze tento pozemek</div>
                            </button>
                            <button class="lv-dropdown-item" onclick="openLV('${parcela}', 'uplny')">
                                <div class="lv-item-title">Úplný výpis</div>
                                <div class="lv-item-desc">Celý list vlastnictví</div>
                            </button>
                        </div>
                    </div>
                `;
                
                // Přidat info řádek s datem ověření
                const today = new Date();
                const dateStr = today.toLocaleDateString('cs-CZ');
                const infoRow = document.createElement('div');
                infoRow.className = 'pozemek-info-row';
                infoRow.innerHTML = `<span class="pozemek-overeno-datum">Ověřeno: ${dateStr}</span>`;
                row.appendChild(infoRow);
            }
        }
        
        // Toggle LV dropdown
        function toggleLVDropdown(id) {
            // Zavřít ostatní dropdowny
            document.querySelectorAll('.lv-dropdown.show').forEach(d => {
                if (d.id !== id) d.classList.remove('show');
            });
            
            const dropdown = document.getElementById(id);
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }
        
        // Otevřít LV (simulace)
        function openLV(parcela, typ) {
            // Zavřít dropdown
            document.querySelectorAll('.lv-dropdown.show').forEach(d => d.classList.remove('show'));
            
            const typText = typ === 'castecny' ? 'Částečný výpis' : 'Úplný výpis';
            showToast(`Otevírám ${typText} LV pro parcelu ${parcela}...`);
            
            // Simulace otevření v novém okně
            setTimeout(() => {
                // V reálu by se otevřel odkaz na ČÚZK nebo interní systém
                console.log(`Otevření LV: parcela=${parcela}, typ=${typ}`);
            }, 500);
        }
        
        // Zavřít dropdowny při kliknutí mimo
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.btn-lv-wrapper')) {
                document.querySelectorAll('.lv-dropdown.show').forEach(d => d.classList.remove('show'));
            }
        });
        
        // Přidat vlastníky do tabulky účastníků
        function pridatVlastnikyDoTabulky() {
            const tbody = document.getElementById('tbodyUcastnici');
            if (!tbody) return;
            
            // Aktualizovat kategorii vlastníků záměru
            const katZameru = document.getElementById('katVlastniciZameru');
            if (katZameru) {
                const stav = katZameru.querySelector('.kategorie-stav');
                if (stav) {
                    stav.className = 'kategorie-stav ok';
                    stav.textContent = 'z KN';
                }
            }
            
            // Odstranit prázdný řádek vlastníků záměru - přidat jako NEOVĚŘENÉ
            const emptyZameru = document.getElementById('emptyVlastniciZameru');
            if (emptyZameru) {
                emptyZameru.outerHTML = `
                    <tr data-osoba-id="jan-novak-kn" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>Jan Novák</strong><br>
                            <small class="text-muted">Fyzická osoba</small>
                            <span class="os-zastoupen-info" id="zastoupenJanNovak" style="display: none;"></span>
                        </td>
                        <td class="os-adresa-neovereno">
                            <span class="os-pozemky">st. 123, 456/1, 456/2</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                    <tr data-osoba-id="cez-distribuce-vb" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>ČEZ Distribuce, a. s.</strong><br>
                            <small class="text-muted">Právnická osoba</small>
                        </td>
                        <td>
                            <span class="os-role">věcné břemeno</span>
                            <span class="os-pozemky">p. 456/1</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button class="is-favorited" onclick="toggleOblibeny(this)" title="V oblíbených"><span class="material-icons-outlined">star</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                `;
            }
            
            // Aktualizovat kategorii vlastníků sousedů
            const katSousedi = document.getElementById('katVlastniciSousedi');
            if (katSousedi) {
                const stav = katSousedi.querySelector('.kategorie-stav');
                if (stav) {
                    stav.className = 'kategorie-stav ok';
                    stav.textContent = 'z KN';
                }
            }
            
            // Odstranit prázdný řádek sousedů - přidat jako NEOVĚŘENÉ
            const emptySousedi = document.getElementById('emptyVlastniciSousedi');
            if (emptySousedi) {
                emptySousedi.outerHTML = `
                    <tr data-osoba-id="marie-vesela" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>Marie Veselá</strong><br>
                            <small class="text-muted">Fyzická osoba</small>
                            <span class="os-zastoupen-info" id="zastoupenMarieVesela" style="display: none;"></span>
                        </td>
                        <td class="os-adresa-neovereno">
                            <span class="os-pozemky">p. 457/1</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                    <tr data-osoba-id="petr-svoboda" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>Petr Svoboda</strong><br>
                            <small class="text-muted">Fyzická osoba</small>
                            <span class="os-zastoupen-info" id="zastoupenPetrSvoboda" style="display: none;"></span>
                        </td>
                        <td class="os-adresa-neovereno">
                            <span class="os-pozemky">p. 457/2, 458</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                    <tr data-osoba-id="cez-distribuce" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>ČEZ Distribuce, a. s.</strong><br>
                            <small class="text-muted">Právnická osoba</small>
                        </td>
                        <td class="os-adresa-neovereno">
                            <span class="os-pozemky">p. 459/1</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button class="is-favorited" onclick="toggleOblibeny(this)" title="V oblíbených"><span class="material-icons-outlined">star</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                `;
            }
            
            // Aktualizovat počty
            const countEl = document.getElementById('tabCountUcastnici');
            if (countEl) countEl.textContent = '7';
        }
        
        // ==========================================
        // OVĚŘOVÁNÍ OSOB - FUNKCE
        // ==========================================
        
        // Simulovaná data z rejstříků ROB/ROS
        const rejstrikData = {
            'jan-novak': { adresa: 'Květná 123, 110 00 Praha 1', ds: 'abc123x', typ: 'FO' },
            'jan-novak-kn': { adresa: 'Květná 123, 110 00 Praha 1', ds: 'abc123x', typ: 'FO' },
            'mesto-jaromer': { adresa: 'nám. ČSA 16, 551 01 Jaroměř', ds: 'xyz789m', typ: 'PO' },
            'cez-distribuce-vb': { adresa: 'Teplická 874/8, 405 02 Děčín', ds: 'cezdis01', typ: 'PO' },
            'cez-distribuce': { adresa: 'Teplická 874/8, 405 02 Děčín', ds: 'cezdis01', typ: 'PO' },
            'marie-vesela': { adresa: 'Růžová 45, 551 01 Jaroměř', ds: null, typ: 'FO' },
            'petr-svoboda': { adresa: 'Lipová 78, 551 01 Jaroměř', ds: null, typ: 'FO' }
        };
        
        // Ověřit všechny neověřené osoby
        function overitVsechnyOsoby() {
            // Ověřit všechny neověřené osoby včetně VTI/VDI
            const neovereneOsoby = document.querySelectorAll('#tabPanelUcastnici tr[data-overeno="false"]');
            
            if (neovereneOsoby.length === 0) {
                showToast('Všechny osoby jsou již ověřeny');
                return;
            }
            
            showToast(`Ověřuji ${neovereneOsoby.length} osob z ROS/ROB...`);
            
            let delay = 0;
            neovereneOsoby.forEach((row, index) => {
                setTimeout(() => {
                    overitOsobuRow(row);
                }, delay);
                delay += 300;
            });
            
            setTimeout(() => {
                showToast('Všechny osoby byly ověřeny');
            }, delay + 200);
        }
        
        // Ověřit jednu osobu (kliknutím na tlačítko)
        function overitOsobu(btn) {
            const row = btn.closest('tr');
            if (!row) return;
            
            overitOsobuRow(row);
            showToast('Osoba byla ověřena');
        }
        
        // Interní funkce pro ověření řádku
        function overitOsobuRow(row) {
            const osobaId = row.getAttribute('data-osoba-id');
            const data = rejstrikData[osobaId];
            
            // Aktualizovat status na ověřeno
            const statusCell = row.querySelector('.os-status');
            if (statusCell) {
                statusCell.className = 'os-status ok';
                statusCell.title = 'Ověřeno z ROB/ROS';
                statusCell.innerHTML = '<span class="material-icons-outlined">check_circle</span>';
            }
            
            // Aktualizovat adresu
            const adresaCell = row.querySelector('td:nth-child(3)');
            if (adresaCell && data) {
                // Zachovat případnou poznámku (věcné břemeno)
                const role = adresaCell.querySelector('.os-role');
                let content = data.adresa;
                
                if (role) {
                    content = role.outerHTML + ' ' + content;
                }
                
                // Přidat DS info pokud existuje
                if (data.ds) {
                    content += ` <span class="os-ds-info"><span class="material-icons-outlined">forward_to_inbox</span> ${data.ds}</span>`;
                }
                
                adresaCell.innerHTML = content;
                adresaCell.classList.remove('os-adresa-neovereno');
            }
            
            // Aktualizovat doručování
            const dorucCell = row.querySelector('td:nth-child(5)');
            if (dorucCell && data) {
                if (data.ds) {
                    // Má datovou schránku - defaultně doručovat do DS
                    dorucCell.innerHTML = `
                        <button class="btn-dorucovani ds" onclick="toggleDorucovani(this)" title="Doručit do datové schránky" data-stav="ds" data-ds="${data.ds}">
                            <span class="material-icons-outlined">forward_to_inbox</span>
                        </button>
                    `;
                } else {
                    // Nemá DS - doručovat poštou
                    dorucCell.innerHTML = `
                        <button class="btn-dorucovani posta" onclick="toggleDorucovani(this)" title="Doručit poštou" data-stav="posta">
                            <span class="material-icons-outlined">mail</span>
                        </button>
                    `;
                }
            }
            
            // Odstranit tlačítko ověřit
            const overitBtn = row.querySelector('.btn-overit-osobu');
            if (overitBtn) {
                overitBtn.remove();
            }
            
            // Označit jako ověřeno
            row.setAttribute('data-overeno', 'true');
        }
        
        // Přepínání způsobu doručování: DS -> Pošta -> Nedoručovat -> DS/Pošta
        function toggleDorucovani(btn) {
            const stav = btn.getAttribute('data-stav');
            const ds = btn.getAttribute('data-ds');
            
            if (stav === 'ds') {
                // DS -> Pošta
                btn.className = 'btn-dorucovani posta';
                btn.setAttribute('data-stav', 'posta');
                btn.title = 'Doručit poštou';
                btn.innerHTML = '<span class="material-icons-outlined">mail</span>';
            } else if (stav === 'posta') {
                // Pošta -> Nedoručovat
                btn.className = 'btn-dorucovani nedorucovat';
                btn.setAttribute('data-stav', 'nedorucovat');
                btn.title = 'Nedoručovat';
                btn.innerHTML = '<span class="material-icons-outlined">do_not_disturb_on</span>';
            } else {
                // Nedoručovat -> DS (pokud má) nebo Pošta
                if (ds) {
                    btn.className = 'btn-dorucovani ds';
                    btn.setAttribute('data-stav', 'ds');
                    btn.title = 'Doručit do datové schránky';
                    btn.innerHTML = '<span class="material-icons-outlined">forward_to_inbox</span>';
                } else {
                    btn.className = 'btn-dorucovani posta';
                    btn.setAttribute('data-stav', 'posta');
                    btn.title = 'Doručit poštou';
                    btn.innerHTML = '<span class="material-icons-outlined">mail</span>';
                }
            }
        }
        
        // ==========================================
        // ZÁSTUPCI - FUNKCE
        // ==========================================
        
        // Stav ověření zástupce
        let zastupceOveren = { FO: false, PO: false };
        
        // Otevřít modal pro přidání zástupce
        function openPridatZastupceModal() {
            // Reset formuláře
            document.getElementById('zastupceJmeno').value = '';
            document.getElementById('zastupcePrijmeni').value = '';
            document.getElementById('zastupceDatumNarozeni').value = '';
            document.getElementById('zastupceICO').value = '';
            document.getElementById('zastupceNazev').value = '';
            
            // Reset ověření
            zastupceOveren = { FO: false, PO: false };
            document.getElementById('verifyStatusFO').innerHTML = '';
            document.getElementById('verifyStatusPO').innerHTML = '';
            document.getElementById('zastupceDetailFO').style.display = 'none';
            document.getElementById('zastupceDetailPO').style.display = 'none';
            document.getElementById('zastupceAdresaFO').value = '';
            document.getElementById('zastupceAdresaPO').value = '';
            
            document.querySelector('input[name="zastupce_typ"][value="FO"]').checked = true;
            toggleZastupceForm();
            
            // Reset checkboxů
            document.querySelectorAll('input[name="zastupovani"]').forEach(cb => cb.checked = false);
            document.getElementById('zastupceNedorucovat').checked = true;
            
            // Aktualizovat seznam zastupovaných (přidat dynamicky načtené vlastníky)
            aktualizovatZastupovaniList();
            
            // Zobrazit modal
            document.getElementById('modalPridatZastupce').style.display = 'flex';
        }
        
        // Zavřít modal zástupce
        function closeModalZastupce() {
            document.getElementById('modalPridatZastupce').style.display = 'none';
        }
        
        // Přepínání mezi FO a PO formulářem
        function toggleZastupceForm() {
            const typ = document.querySelector('input[name="zastupce_typ"]:checked').value;
            document.getElementById('zastupceFormFO').style.display = typ === 'FO' ? 'block' : 'none';
            document.getElementById('zastupceFormPO').style.display = typ === 'PO' ? 'block' : 'none';
        }
        
        // Ověřit zástupce z rejstříku
        function overitZastupceZRejstriku(typ) {
            const statusEl = document.getElementById('verifyStatus' + typ);
            
            if (typ === 'FO') {
                const jmeno = document.getElementById('zastupceJmeno').value.trim();
                const prijmeni = document.getElementById('zastupcePrijmeni').value.trim();
                const datumNar = document.getElementById('zastupceDatumNarozeni').value;
                
                if (!jmeno || !prijmeni || !datumNar) {
                    statusEl.className = 'verify-status error';
                    statusEl.innerHTML = '<span class="material-icons-outlined">error</span> Vyplňte všechna pole';
                    return;
                }
                
                // Simulace ověření
                statusEl.className = 'verify-status loading';
                statusEl.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span> Ověřuji...';
                
                setTimeout(() => {
                    // Simulace úspěšného ověření
                    statusEl.className = 'verify-status success';
                    statusEl.innerHTML = '<span class="material-icons-outlined">check_circle</span> Osoba nalezena v registru obyvatel';
                    
                    // Zobrazit doplněné údaje
                    document.getElementById('zastupceDetailFO').style.display = 'block';
                    document.getElementById('zastupceAdresaFO').value = 'Hlavní 456, 110 00 Praha 1';
                    
                    zastupceOveren.FO = true;
                }, 800);
                
            } else if (typ === 'PO') {
                const ico = document.getElementById('zastupceICO').value.trim();
                
                if (!ico || ico.length !== 8) {
                    statusEl.className = 'verify-status error';
                    statusEl.innerHTML = '<span class="material-icons-outlined">error</span> Zadejte platné IČO (8 číslic)';
                    return;
                }
                
                // Simulace ověření
                statusEl.className = 'verify-status loading';
                statusEl.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span> Ověřuji v ARES...';
                
                setTimeout(() => {
                    // Simulace dat z ARES
                    const aresData = {
                        '12345678': { nazev: 'Advokátní kancelář Novák & Partners s.r.o.', sidlo: 'Václavské náměstí 1, 110 00 Praha 1' },
                        '87654321': { nazev: 'Právní služby Praha a.s.', sidlo: 'Národní 10, 110 00 Praha 1' },
                    };
                    
                    const data = aresData[ico];
                    
                    if (data) {
                        statusEl.className = 'verify-status success';
                        statusEl.innerHTML = '<span class="material-icons-outlined">check_circle</span> Subjekt nalezen v ARES';
                        
                        // Zobrazit doplněné údaje
                        document.getElementById('zastupceDetailPO').style.display = 'block';
                        document.getElementById('zastupceNazev').value = data.nazev;
                        document.getElementById('zastupceAdresaPO').value = data.sidlo;
                        
                        zastupceOveren.PO = true;
                    } else {
                        statusEl.className = 'verify-status error';
                        statusEl.innerHTML = '<span class="material-icons-outlined">error</span> Subjekt nenalezen v ARES';
                        zastupceOveren.PO = false;
                    }
                }, 1000);
            }
        }
        
        // Aktualizovat seznam zastupovaných osob
        function aktualizovatZastupovaniList() {
            const dynamicList = document.getElementById('zastupovaniDynamicList');
            if (!dynamicList) return;
            
            // Přidat vlastníky z KN pokud byli načteni
            const vlastniciRows = document.querySelectorAll('#tbodyUcastnici tr:not(.osoby-kategorie-row):not(.osoby-empty-row)');
            let html = '';
            
            vlastniciRows.forEach((row, index) => {
                const nameEl = row.querySelector('td:nth-child(2) strong');
                if (nameEl) {
                    const name = nameEl.textContent;
                    // Přeskočit již existující v základním seznamu
                    if (name === 'Jan Novák' || name === 'Město Jaroměř') return;
                    
                    const typeEl = row.querySelector('td:nth-child(2) small');
                    const type = typeEl ? typeEl.textContent : '';
                    
                    // Určit roli podle kontextu (zjednodušeně)
                    let role = 'Účastník řízení';
                    const prevRow = row.previousElementSibling;
                    if (prevRow && prevRow.classList.contains('osoby-kategorie-row')) {
                        const katLabel = prevRow.querySelector('.kategorie-label');
                        if (katLabel) role = katLabel.textContent;
                    }
                    
                    html += `
                        <label class="zastupovani-item">
                            <input type="checkbox" name="zastupovani" value="dynamic-${index}">
                            <div class="zastupovani-info">
                                <span class="zastupovani-name">${name}</span>
                                <span class="zastupovani-role">${role}</span>
                            </div>
                        </label>
                    `;
                }
            });
            
            dynamicList.innerHTML = html;
        }
        
        // Přidat zástupce
        function pridatZastupce() {
            const typ = document.querySelector('input[name="zastupce_typ"]:checked').value;
            let jmeno = '';
            let typOsoby = '';
            let adresa = '';
            
            if (typ === 'FO') {
                // Kontrola ověření
                if (!zastupceOveren.FO) {
                    alert('Nejprve ověřte osobu z rejstříku.');
                    return;
                }
                
                const j = document.getElementById('zastupceJmeno').value.trim();
                const p = document.getElementById('zastupcePrijmeni').value.trim();
                jmeno = `${j} ${p}`;
                typOsoby = 'Fyzická osoba';
                adresa = document.getElementById('zastupceAdresaFO').value;
            } else {
                // Kontrola ověření
                if (!zastupceOveren.PO) {
                    alert('Nejprve ověřte subjekt z rejstříku ARES.');
                    return;
                }
                
                jmeno = document.getElementById('zastupceNazev').value.trim();
                typOsoby = 'Právnická osoba';
                adresa = document.getElementById('zastupceAdresaPO').value;
            }
            
            // Získat vybrané zastupované osoby
            const zastupovani = [];
            document.querySelectorAll('input[name="zastupovani"]:checked').forEach(cb => {
                const item = cb.closest('.zastupovani-item');
                const nameEl = item.querySelector('.zastupovani-name');
                const roleEl = item.querySelector('.zastupovani-role');
                if (nameEl) {
                    zastupovani.push({
                        name: nameEl.textContent,
                        role: roleEl ? roleEl.textContent : ''
                    });
                }
            });
            
            if (zastupovani.length === 0) {
                alert('Vyberte alespoň jednu zastupovanou osobu.');
                return;
            }
            
            const nedorucovat = document.getElementById('zastupceNedorucovat').checked;
            
            // Přidat do tabulky
            pridatZastupceDoTabulky(jmeno, typOsoby, zastupovani, nedorucovat);
            
            // Zavřít modal
            closeModalZastupce();
            
            // Aktualizovat počet
            aktualizovatPocetZastupcu();
            
            showToast(`Zástupce ${jmeno} byl přidán`);
        }
        
        // Přidat zástupce do tabulky
        function pridatZastupceDoTabulky(jmeno, typOsoby, zastupovani, nedorucovat) {
            const tbody = document.getElementById('tbodyZastupci');
            if (!tbody) return;
            
            // Odstranit prázdný řádek
            const emptyRow = document.getElementById('emptyZastupci');
            if (emptyRow) emptyRow.remove();
            
            // Vytvořit badges pro zastupované osoby
            const zastupujeBadges = zastupovani.map(z => `
                <span class="zastupuje-badge">
                    <span class="material-icons-outlined">person</span>
                    ${z.name}
                </span>
            `).join('');
            
            // Určit role (první zastupovaný)
            const role = zastupovani[0]?.role || 'Účastník';
            
            // Checkbox pro doručování
            const dorucChecked = !nedorucovat ? 'checked' : '';
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><span class="os-status ok"><span class="material-icons-outlined">check_circle</span></span></td>
                <td>
                    <strong>${jmeno}</strong><br>
                    <small class="text-muted">${typOsoby}</small>
                </td>
                <td class="zastupuje-cell">${zastupujeBadges}</td>
                <td><span class="os-role">${role}</span></td>
                <td>
                    <div class="dorucovat-toggle">
                        <input type="checkbox" ${dorucChecked} onchange="toggleDorucovat(this)" title="Doručovat zástupci">
                        <span class="dorucovat-label ${!nedorucovat ? 'yes' : 'no'}">${!nedorucovat ? 'Ano' : 'Ne'}</span>
                    </div>
                </td>
                <td class="os-actions">
                    <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                    <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                    <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                    <button title="Odstranit" onclick="odstranZastupce(this)"><span class="material-icons-outlined">delete</span></button>
                </td>
            `;
            
            tbody.appendChild(newRow);
            
            // Označit zastupované účastníky v tabulce Účastníci
            zastupovani.forEach(z => {
                oznacitUcastnikaJakoZastoupeneho(z.name, jmeno);
            });
        }
        
        // Označit účastníka jako zastoupeného
        function oznacitUcastnikaJakoZastoupeneho(ucastnikJmeno, zastupceJmeno) {
            // Najít účastníka podle jména
            const rows = document.querySelectorAll('#tabPanelUcastnici tr[data-osoba-id]');
            rows.forEach(row => {
                const jmenoEl = row.querySelector('td:nth-child(2) strong');
                if (jmenoEl && jmenoEl.textContent.trim() === ucastnikJmeno) {
                    // Najít nebo vytvořit element pro info o zastoupení
                    let zastoupenInfo = row.querySelector('.os-zastoupen-info');
                    if (!zastoupenInfo) {
                        const tdJmeno = row.querySelector('td:nth-child(2)');
                        zastoupenInfo = document.createElement('span');
                        zastoupenInfo.className = 'os-zastoupen-info';
                        tdJmeno.appendChild(zastoupenInfo);
                    }
                    
                    zastoupenInfo.innerHTML = `<span class="material-icons-outlined">supervisor_account</span> Zastoupen: ${zastupceJmeno}`;
                    zastoupenInfo.style.display = 'block';
                }
            });
        }
        
        // Toggle doručování
        function toggleDorucovat(checkbox) {
            const label = checkbox.nextElementSibling;
            if (checkbox.checked) {
                label.textContent = 'Ano';
                label.className = 'dorucovat-label yes';
            } else {
                label.textContent = 'Ne';
                label.className = 'dorucovat-label no';
            }
        }
        
        // Odstranit zástupce
        function odstranZastupce(btn) {
            if (!confirm('Opravdu chcete odstranit tohoto zástupce?')) return;
            
            const row = btn.closest('tr');
            row.remove();
            
            aktualizovatPocetZastupcu();
            
            // Pokud není žádný zástupce, zobrazit prázdný řádek
            const tbody = document.getElementById('tbodyZastupci');
            if (tbody && tbody.children.length === 0) {
                tbody.innerHTML = `
                    <tr class="osoby-empty-row" id="emptyZastupci">
                        <td colspan="6" class="text-center text-muted">
                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">supervisor_account</span>
                            Žádní zástupci — přidejte zástupce tlačítkem výše
                        </td>
                    </tr>
                `;
            }
            
            showToast('Zástupce byl odstraněn');
        }
        
        // Aktualizovat počet zástupců
        function aktualizovatPocetZastupcu() {
            const tbody = document.getElementById('tbodyZastupci');
            const countEl = document.getElementById('tabCountZastupci');
            if (!tbody || !countEl) return;
            
            const rows = tbody.querySelectorAll('tr:not(.osoby-empty-row)');
            countEl.textContent = rows.length;
        }
        
        // Přidat zástupce z oblíbených (simulace)
        function pridatZastupceZOblibenych() {
            // Simulace - v reálu by se otevřel modal s oblíbenými
            const oblibeneni = [
                { jmeno: 'JUDr. Pavel Právník', typ: 'Fyzická osoba', adresa: 'Právnická 123, 110 00 Praha 1', datumNar: '1975-05-15' },
                { jmeno: 'Advokátní kancelář Novák & Partners s.r.o.', typ: 'Právnická osoba', ico: '12345678', sidlo: 'Václavské náměstí 1, 110 00 Praha 1' }
            ];
            
            // Zobrazit jednoduchý výběr
            const vyber = prompt(
                'Vyberte oblíbeného zástupce (zadejte číslo):\n\n' +
                oblibeneni.map((o, i) => `${i + 1}. ${o.jmeno}`).join('\n')
            );
            
            if (vyber) {
                const index = parseInt(vyber) - 1;
                if (index >= 0 && index < oblibeneni.length) {
                    const oblibeny = oblibeneni[index];
                    
                    // Reset stavů
                    zastupceOveren = { FO: false, PO: false };
                    document.getElementById('verifyStatusFO').innerHTML = '';
                    document.getElementById('verifyStatusPO').innerHTML = '';
                    document.getElementById('zastupceDetailFO').style.display = 'none';
                    document.getElementById('zastupceDetailPO').style.display = 'none';
                    
                    if (oblibeny.typ === 'Fyzická osoba') {
                        document.querySelector('input[name="zastupce_typ"][value="FO"]').checked = true;
                        const parts = oblibeny.jmeno.split(' ');
                        document.getElementById('zastupceJmeno').value = parts[0] || '';
                        document.getElementById('zastupcePrijmeni').value = parts.slice(1).join(' ') || '';
                        document.getElementById('zastupceDatumNarozeni').value = oblibeny.datumNar || '';
                        
                        // Automaticky nastavit jako ověřeného (z oblíbených)
                        document.getElementById('zastupceDetailFO').style.display = 'block';
                        document.getElementById('zastupceAdresaFO').value = oblibeny.adresa;
                        document.getElementById('verifyStatusFO').className = 'verify-status success';
                        document.getElementById('verifyStatusFO').innerHTML = '<span class="material-icons-outlined">check_circle</span> Z oblíbených';
                        zastupceOveren.FO = true;
                    } else {
                        document.querySelector('input[name="zastupce_typ"][value="PO"]').checked = true;
                        document.getElementById('zastupceICO').value = oblibeny.ico || '';
                        document.getElementById('zastupceNazev').value = oblibeny.jmeno;
                        
                        // Automaticky nastavit jako ověřeného (z oblíbených)
                        document.getElementById('zastupceDetailPO').style.display = 'block';
                        document.getElementById('zastupceAdresaPO').value = oblibeny.sidlo;
                        document.getElementById('verifyStatusPO').className = 'verify-status success';
                        document.getElementById('verifyStatusPO').innerHTML = '<span class="material-icons-outlined">check_circle</span> Z oblíbených';
                        zastupceOveren.PO = true;
                    }
                    
                    toggleZastupceForm();
                    aktualizovatZastupovaniList();
                    document.querySelectorAll('input[name="zastupovani"]').forEach(cb => cb.checked = false);
                    document.getElementById('zastupceNedorucovat').checked = true;
                    document.getElementById('modalPridatZastupce').style.display = 'flex';
                }
            }
        }
        
        // Toast notifikace
        function showToast(message) {
            const existing = document.querySelector('.toast-notification');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.innerHTML = `
                <span class="material-icons-outlined">check_circle</span>
                ${message}
            `;
            toast.style.cssText = `
                position: fixed;
                bottom: 24px;
                left: 50%;
                transform: translateX(-50%);
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 12px 24px;
                background: #323232;
                color: #fff;
                border-radius: 8px;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: toastIn 0.3s ease;
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'toastOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function completeUcastnici() {
            controls.ucastnici.done = true;
            controls.ucastnici.result = 'ok';
            closeControl('controlUcastnici');
            updateUI();
        }

        function completeZrychlene() {
            const checkboxes = document.querySelectorAll('#controlZrychlene input[type="checkbox"]');
            let allChecked = true;
            checkboxes.forEach(cb => { if (!cb.checked) allChecked = false; });
            
            controls.zrychlene.done = true;
            controls.zrychlene.result = allChecked ? 'ok' : 'warning';
            
            closeControl('controlZrychlene');
            updateUI();
        }

        function zahajitRizeni() {
            if (controls.prislusnost.result === 'neprislusny') {
                const postoupit = controls.prislusnost.postoupit;
                let msg = 'Řízení bude postoupeno příslušnému stavebnímu úřadu.\n\n';
                
                if (postoupit) {
                    const info = postoupit.info.split('|');
                    if (postoupit.typ === 'vecna') {
                        msg += `Typ nepříslušnosti: Věcná\n`;
                        msg += `Příslušný úřad: ${postoupit.typSu}\n`;
                        msg += `Název: ${info[0]}\n`;
                        msg += `Adresa: ${info[1]}\n`;
                        msg += `E-mail: ${info[2]}\n`;
                    } else {
                        msg += `Typ nepříslušnosti: Místní\n`;
                        msg += `Příslušný úřad: ${info[0]}\n`;
                        msg += `Adresa: ${info[1]}\n`;
                        msg += `E-mail: ${info[2]}\n`;
                        msg += `Územní obvod: ${info[3]}\n`;
                    }
                }
                
                msg += '\nV ostré verzi by následovalo flow pro postoupení řízení.';
                alert(msg);
            } else {
                // Přechod na krok 3: Projednání
                window.location.href = 'povoleni-3.html';
            }
        }

        // Initialize
        updateUI();

        // Force styles after page load (for Nicepage compatibility)
        function forceWorkflowStyles() {
            const workflowBar = document.querySelector('.workflow-bar');
            if (workflowBar) {
                workflowBar.style.cssText = 'display: flex !important; align-items: center !important; justify-content: space-between !important; padding: 10px 32px !important; background: #f8f9fa !important; border-bottom: 1px solid #e0e0e0 !important; flex-wrap: nowrap !important;';
            }
            
            const stepper = document.querySelector('.workflow-stepper');
            if (stepper) {
                stepper.style.cssText = 'display: flex !important; align-items: center !important; gap: 6px !important; flex-wrap: nowrap !important;';
            }
            
            document.querySelectorAll('.workflow-step').forEach(step => {
                const isCompleted = step.classList.contains('completed');
                const isActive = step.classList.contains('active');
                
                let bg = '#fff', border = '#dadce0', color = '#5f6368';
                if (isCompleted) { bg = '#e6f4ea'; border = '#ceead6'; color = '#137333'; }
                if (isActive) { bg = '#004289'; border = '#004289'; color = '#fff'; }
                
                step.style.cssText = `display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: ${bg} !important; border: 1px solid ${border} !important; color: ${color} !important; white-space: nowrap !important;`;
            });
            
            document.querySelectorAll('.step-number').forEach(num => {
                const step = num.closest('.workflow-step');
                const isCompleted = step && step.classList.contains('completed');
                const isActive = step && step.classList.contains('active');
                
                let bg = '#f1f3f4', color = '#5f6368';
                if (isCompleted) { bg = '#137333'; color = '#fff'; }
                if (isActive) { bg = 'rgba(255,255,255,0.25)'; color = '#fff'; }
                
                num.style.cssText = `width: 18px !important; height: 18px !important; min-width: 18px !important; border-radius: 50% !important; background: ${bg} !important; color: ${color} !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 10px !important; font-weight: 500 !important;`;
            });
            
            document.querySelectorAll('.workflow-step-connector').forEach(conn => {
                const isCompleted = conn.classList.contains('completed');
                const bg = isCompleted ? '#137333' : '#dadce0';
                conn.style.cssText = `width: 20px !important; height: 2px !important; min-width: 20px !important; background: ${bg} !important; flex-shrink: 0 !important;`;
            });
            
            const docButtons = document.querySelector('.workflow-bar .document-access-buttons');
            if (docButtons) {
                docButtons.style.cssText = 'display: flex !important; gap: 8px !important; flex-wrap: nowrap !important; margin-left: 24px !important;';
            }
            
            document.querySelectorAll('.workflow-bar .doc-access-btn').forEach(btn => {
                btn.style.cssText = 'display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 8px 14px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 13px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;';
                
                // Style icons inside buttons
                const icon = btn.querySelector('.material-icons-outlined');
                if (icon) {
                    icon.style.cssText = 'font-size: 18px !important; color: #5f6368 !important;';
                }
            });
        }
        
        // Apply on load
        window.addEventListener('load', forceWorkflowStyles);
        document.addEventListener('DOMContentLoaded', forceWorkflowStyles);
        
    </script>
    
    <!-- Slideout overlay -->
    <div class="slideout-overlay" id="slideoutOverlay" onclick="closeAllSlideouts()"></div>
    
    <!-- Slideout: Přehled nedostatků -->
    <div class="slideout-panel" id="prehledNedostatku">
        <div class="slideout-header">
            <div class="slideout-title">
                <span class="material-icons-outlined">warning_amber</span>
                Přehled nedostatků řízení
            </div>
            <button class="slideout-close" onclick="closeSlideout('prehledNedostatku')">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>
        <div class="slideout-body" id="nedostatkyBody">
            <!-- Typ C: Výzva k doplnění -->
            <div class="issues-group" id="groupVyzva">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #f9ab00;">edit_document</span>
                        Výzva k doplnění + Přerušení řízení
                    </div>
                    <span class="issues-group-badge warning" id="badgeVyzva">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Nedostatky, které povedou k vydání výzvy k doplnění a usnesení o přerušení řízení dle § 185 odst. 1-2.
                </p>
                <div class="issues-group-list" id="listVyzva">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        Žádné nedostatky
                    </div>
                </div>
            </div>
            
            <!-- Typ B: Odložení žádosti -->
            <div class="issues-group" id="groupOdlozeni">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #c5221f;">block</span>
                        Odložení žádosti
                    </div>
                    <span class="issues-group-badge error" id="badgeOdlozeni">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Závažné vady dle § 185 odst. 3 - chybí dokumentace, není zpracována projektantem, nebo není vložena do EED.
                </p>
                <div class="issues-group-list" id="listOdlozeni">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        Žádné závažné vady
                    </div>
                </div>
            </div>
            
            <!-- Typ A: Postoupení -->
            <div class="issues-group" id="groupPostoupeni">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #1a73e8;">send</span>
                        Postoupení řízení
                    </div>
                    <span class="issues-group-badge info" id="badgePostoupeni">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Stavební úřad není příslušný - řízení bude postoupeno příslušnému SÚ.
                </p>
                <div class="issues-group-list" id="listPostoupeni">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        SÚ je příslušný
                    </div>
                </div>
            </div>
            
            <!-- Typ D: Stavění lhůty -->
            <div class="issues-group" id="groupStaveni">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #5f6368;">schedule</span>
                        Stavění lhůty (vyžádání stanovisek)
                    </div>
                    <span class="issues-group-badge info" id="badgeStaveni">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Chybějící stanoviska DO, která si SÚ vyžádá dle § 184 odst. 3. Lhůta pro rozhodnutí se staví.
                </p>
                <div class="issues-group-list" id="listStaveni">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        Všechna stanoviska jsou k dispozici
                    </div>
                </div>
            </div>
            
            <!-- Typ E: Zamítnutí -->
            <div class="issues-group" id="groupZamitnuti">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #c5221f;">gavel</span>
                        Zamítnutí žádosti
                    </div>
                    <span class="issues-group-badge error" id="badgeZamitnuti">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Důvody pro zamítnutí žádosti - např. nesoulad s územně plánovací dokumentací.
                </p>
                <div class="issues-group-list" id="listZamitnuti">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        Žádné důvody pro zamítnutí
                    </div>
                </div>
            </div>
        </div>
        <div class="slideout-footer">
            <button class="btn btn-secondary" onclick="exportNedostatky()">
                <span class="material-icons-outlined">download</span>
                Exportovat
            </button>
            <button class="btn btn-primary" onclick="closeSlideout('prehledNedostatku')">
                Zavřít
            </button>
        </div>
    </div>
    
    <!-- Slideout: Údaje řízení -->
    <div class="slideout-panel" id="udajeRizeni">
        <div class="slideout-header">
            <div class="slideout-title">
                <span class="material-icons-outlined">assignment</span>
                Údaje řízení
            </div>
            <button class="slideout-close" onclick="closeSlideout('udajeRizeni')">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>
        <div class="slideout-body">
            <!-- Základní údaje -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">info</span>
                    Základní údaje
                </div>
                <div class="data-row">
                    <div class="data-label">Číslo řízení</div>
                    <div class="data-value">R/2026/000147</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Název stavby</div>
                    <div class="data-value editable">
                        <span id="udajeNazevStavby">Novostavba RD včetně přípojek</span>
                        <button class="data-edit-btn" onclick="editUdaj('nazevStavby')" title="Upravit">
                            <span class="material-icons-outlined">edit</span>
                        </button>
                    </div>
                </div>
                <div class="data-row">
                    <div class="data-label">Typ řízení</div>
                    <div class="data-value">Povolení stavby</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Druh stavby</div>
                    <div class="data-value">Jednoduchá stavba</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Datum doručení</div>
                    <div class="data-value">7. 1. 2026</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Stav řízení</div>
                    <div class="data-value"><span class="case-badge draft" style="display: inline-block;">Kontrola</span></div>
                </div>
            </div>
            
            <!-- Lhůty -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">schedule</span>
                    Lhůty
                </div>
                <div class="data-row">
                    <div class="data-label">Lhůta pro rozhodnutí</div>
                    <div class="data-value">30 dnů (do 6. 2. 2026)</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Stavění lhůty</div>
                    <div class="data-value" style="color: #137333;">Ne</div>
                </div>
            </div>
            
            <!-- Pozemky -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">landscape</span>
                    Pozemky záměru
                </div>
                <div class="data-list" id="udajePozemky">
                    <div class="data-list-item">
                        <span class="material-icons-outlined">place</span>
                        st. 123/1, k.ú. Veselí nad Lužnicí
                    </div>
                    <div class="data-list-item">
                        <span class="material-icons-outlined">place</span>
                        456/2, k.ú. Veselí nad Lužnicí
                    </div>
                </div>
                <button class="btn btn-secondary" style="margin-top: 12px; width: 100%;" onclick="openControl('controlPozemky')">
                    <span class="material-icons-outlined">edit</span>
                    Upravit pozemky
                </button>
            </div>
            
            <!-- Účastníci -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">groups</span>
                    Osoby
                </div>
                <div class="data-list" id="udajeUcastnici">
                    <div class="data-list-item">
                        <span class="material-icons-outlined">person</span>
                        Marek Vondruška (stavebník)
                    </div>
                    <div class="data-list-item">
                        <span class="material-icons-outlined">person</span>
                        Jana Nová (vlastník sousedního pozemku)
                    </div>
                </div>
                <button class="btn btn-secondary" style="margin-top: 12px; width: 100%;" onclick="openControl('controlUcastnici')">
                    <span class="material-icons-outlined">edit</span>
                    Upravit osoby
                </button>
            </div>
            
            <!-- Referent -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">badge</span>
                    Zpracování
                </div>
                <div class="data-row">
                    <div class="data-label">Referent</div>
                    <div class="data-value">Aleš Krupa</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Přiřazeno od</div>
                    <div class="data-value">7. 1. 2026</div>
                </div>
            </div>
        </div>
        <div class="slideout-footer">
            <button class="btn btn-primary" onclick="closeSlideout('udajeRizeni')">
                Zavřít
            </button>
        </div>
    </div>
    
    <script>
        // Slideout panel funkce
        function openSlideout(panelId) {
            document.getElementById('slideoutOverlay').classList.add('open');
            document.getElementById(panelId).classList.add('open');
            document.body.style.overflow = 'hidden';
            
            if (panelId === 'prehledNedostatku') {
                renderGlobalIssues();
            }
        }
        
        function closeSlideout(panelId) {
            document.getElementById('slideoutOverlay').classList.remove('open');
            document.getElementById(panelId).classList.remove('open');
            document.body.style.overflow = '';
        }
        
        function closeAllSlideouts() {
            document.querySelectorAll('.slideout-panel').forEach(panel => {
                panel.classList.remove('open');
            });
            document.getElementById('slideoutOverlay').classList.remove('open');
            document.body.style.overflow = '';
        }
        
        // Dropdown menu
        function toggleActionDropdown() {
            const dropdown = document.getElementById('akceRizeniDropdown');
            dropdown.classList.toggle('open');
            
            // Close on click outside
            if (dropdown.classList.contains('open')) {
                setTimeout(() => {
                    document.addEventListener('click', closeDropdownOnClickOutside);
                }, 0);
            }
        }
        
        function closeDropdownOnClickOutside(e) {
            const dropdown = document.getElementById('akceRizeniDropdown');
            const btn = document.getElementById('btnAkceRizeni');
            if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
                dropdown.classList.remove('open');
                document.removeEventListener('click', closeDropdownOnClickOutside);
            }
        }
        
        function showActionModal(action) {
            document.getElementById('akceRizeniDropdown').classList.remove('open');
            alert('Akce "' + action + '" - bude implementováno');
        }
        
        function exportNedostatky() {
            alert('Export nedostatků - bude implementováno');
        }
        
        function editUdaj(udaj) {
            alert('Úprava údaje "' + udaj + '" - bude implementováno');
        }
        
        // Inicializace badge při načtení
        document.addEventListener('DOMContentLoaded', function() {
            updateGlobalIssuesBadge();
            initSimulationPanel();
        });
    </script>
    
    <!-- ==========================================
         SIMULAČNÍ PANEL - DevTools pro maketu
         ========================================== -->
    <div class="sim-panel minimized" id="simPanel">
        <div class="sim-panel-header" onclick="toggleSimPanel()">
            <div class="sim-panel-title">
                <span class="material-icons-outlined">science</span>
                <span class="sim-panel-title-text">Simulace</span>
            </div>
            <div class="sim-panel-toggle">
                <span class="material-icons-outlined" id="simPanelToggleIcon">expand_more</span>
            </div>
        </div>
        <div class="sim-panel-body" id="simPanelBody">
            <div class="sim-section">
                <div class="sim-section-title">Scénář žádosti</div>
                <div class="sim-scenarios">
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="zakladni" checked onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Základní</strong>
                            <small>FO žadatel, bez zástupce, vlastník</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="zastupce-pm" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Zástupce — plná moc</strong>
                            <small>FO + zástupce na základě listinné PM</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="zastupce-reza" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Zástupce — REZA</strong>
                            <small>FO + zástupce z registru el. zastupování</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="pravnicka-osoba" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Právnická osoba</strong>
                            <small>PO žadatel (s.r.o.), jednatel</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="osvc" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>OSVČ</strong>
                            <small>Fyzická osoba podnikající</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="spoluvlastnici" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Spoluvlastníci</strong>
                            <small>Více žadatelů — manželé</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="neni-vlastnik" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Není vlastník</strong>
                            <small>Žadatel nemá právo k pozemku</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="s-vyjimkami" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>S výjimkami</strong>
                            <small>Obsahuje žádost o výjimku</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="komplexni" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Komplexní</strong>
                            <small>PO + REZA + není vlastník + výjimka</small>
                        </span>
                    </label>
                </div>
            </div>
            <div class="sim-section">
                <div class="sim-section-title">Aktuální nastavení</div>
                <div class="sim-info" id="simInfo">
                    <div class="sim-info-row">
                        <span class="sim-info-label">Typ žadatele:</span>
                        <span class="sim-info-value" id="simInfoTyp">Fyzická osoba</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Zástupce:</span>
                        <span class="sim-info-value" id="simInfoZastupce">Bez zástupce</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Vlastnictví:</span>
                        <span class="sim-info-value" id="simInfoVlastnictvi">Vlastník pozemku</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Zvláštnosti:</span>
                        <span class="sim-info-value" id="simInfoZvlastnosti">—</span>
                    </div>
                </div>
            </div>
            <div class="sim-actions">
                <button class="sim-btn" onclick="copyScenarioUrl()">
                    <span class="material-icons-outlined">link</span>
                    Kopírovat URL
                </button>
                <button class="sim-btn" onclick="resetScenario()">
                    <span class="material-icons-outlined">refresh</span>
                    Reset
                </button>
            </div>
        </div>
    </div>
    
    <style>
        /* ==========================================
           SIMULAČNÍ PANEL - STYLY
           ========================================== */
        .sim-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 320px;
            background: #1a1a2e;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            z-index: 10000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .sim-panel.minimized {
            width: auto;
        }
        
        .sim-panel.minimized .sim-panel-body {
            display: none;
        }
        
        .sim-panel.minimized .sim-panel-title-text {
            display: none;
        }
        
        .sim-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            user-select: none;
        }
        
        .sim-panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-weight: 600;
            font-size: 13px;
        }
        
        .sim-panel-title .material-icons-outlined {
            font-size: 20px;
        }
        
        .sim-panel-toggle {
            color: rgba(255,255,255,0.8);
        }
        
        .sim-panel-toggle .material-icons-outlined {
            font-size: 20px;
            transition: transform 0.3s;
        }
        
        .sim-panel.minimized .sim-panel-toggle .material-icons-outlined {
            transform: rotate(180deg);
        }
        
        .sim-panel-body {
            padding: 16px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .sim-section {
            margin-bottom: 16px;
        }
        
        .sim-section:last-child {
            margin-bottom: 0;
        }
        
        .sim-section-title {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #8b8b9e;
            margin-bottom: 10px;
        }
        
        .sim-scenarios {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .sim-radio {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #252542;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            border: 1px solid transparent;
        }
        
        .sim-radio:hover {
            background: #2d2d4a;
        }
        
        .sim-radio input {
            margin-top: 3px;
            accent-color: #667eea;
        }
        
        .sim-radio input:checked + .sim-radio-label strong {
            color: #a5b4fc;
        }
        
        .sim-radio:has(input:checked) {
            border-color: #667eea;
            background: #2d2d4a;
        }
        
        .sim-radio-label {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .sim-radio-label strong {
            font-size: 12px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        .sim-radio-label small {
            font-size: 10px;
            color: #8b8b9e;
        }
        
        .sim-info {
            background: #252542;
            border-radius: 8px;
            padding: 12px;
        }
        
        .sim-info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #333355;
        }
        
        .sim-info-row:last-child {
            border-bottom: none;
        }
        
        .sim-info-label {
            font-size: 11px;
            color: #8b8b9e;
        }
        
        .sim-info-value {
            font-size: 11px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        .sim-actions {
            display: flex;
            gap: 8px;
        }
        
        .sim-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 12px;
            background: #252542;
            border: none;
            border-radius: 8px;
            color: #a5b4fc;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .sim-btn:hover {
            background: #333355;
        }
        
        .sim-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Toast pro kopírování URL */
        .sim-toast {
            position: fixed;
            bottom: 100px;
            left: 20px;
            padding: 12px 20px;
            background: #333;
            color: #fff;
            border-radius: 8px;
            font-size: 13px;
            z-index: 10001;
            animation: simToastIn 0.3s ease;
        }
        
        @keyframes simToastIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    
    <script>
        // ==========================================
        // SIMULAČNÍ PANEL - JAVASCRIPT
        // ==========================================
        
        // Definice scénářů
        const scenarios = {
            'zakladni': {
                nazev: 'Základní',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: [],
                zvlastnostiText: '—',
                zadatel: {
                    jmeno: 'Jan',
                    prijmeni: 'Novák',
                    datumNarozeni: '15. 3. 1985',
                    trvaleBytem: 'Květná 123, 110 00 Praha 1',
                    email: 'jan.novak@email.cz',
                    telefon: '+420 601 234 567',
                    ds: 'abc123x'
                }
            },
            'zastupce-pm': {
                nazev: 'Zástupce — plná moc',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: 'pm',
                zastupceText: 'Listinná plná moc',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: ['plna-moc'],
                zvlastnostiText: 'Plná moc v příloze',
                zadatel: {
                    jmeno: 'Marie',
                    prijmeni: 'Svobodová',
                    datumNarozeni: '22. 7. 1978',
                    trvaleBytem: 'Lipová 45, 551 01 Jaroměř',
                    email: 'marie.svobodova@email.cz',
                    telefon: '+420 602 345 678',
                    ds: null
                },
                zastupceData: {
                    jmeno: 'Ing. Pavel',
                    prijmeni: 'Projektant',
                    datumNarozeni: '10. 5. 1970',
                    adresa: 'Projektová 789, 500 02 Hradec Králové',
                    ds: 'proj456x',
                    typPM: 'Listinná plná moc',
                    platnostPM: 'Neomezená'
                }
            },
            'zastupce-reza': {
                nazev: 'Zástupce — REZA',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: 'reza',
                zastupceText: 'REZA (el. zastupování)',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: ['reza'],
                zvlastnostiText: 'Zástupce z REZA',
                zadatel: {
                    jmeno: 'Petr',
                    prijmeni: 'Horák',
                    datumNarozeni: '3. 11. 1982',
                    trvaleBytem: 'Zahradní 567, 551 01 Jaroměř',
                    email: 'petr.horak@email.cz',
                    telefon: '+420 603 456 789',
                    ds: 'horak01'
                },
                zastupceData: {
                    jmeno: 'JUDr. Anna',
                    prijmeni: 'Advokátová',
                    ico: '12345678',
                    adresa: 'Právní 123, 110 00 Praha 1',
                    ds: 'advo123x',
                    typPM: 'REZA — Registr elektronického zastupování',
                    platnostPM: 'Do 31. 12. 2026',
                    rozsah: 'Stavební řízení'
                }
            },
            'pravnicka-osoba': {
                nazev: 'Právnická osoba',
                typZadatele: 'po',
                typZadateleText: 'Právnická osoba',
                zastupce: 'statutar',
                zastupceText: 'Jednatel (statutární orgán)',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: [],
                zvlastnostiText: '—',
                zadatel: {
                    nazev: 'STAVBY NOVÁK s.r.o.',
                    ico: '28563412',
                    sidlo: 'Průmyslová 456, 551 01 Jaroměř',
                    ds: 'stavnov1',
                    jednatel: 'Ing. Jan Novák'
                }
            },
            'osvc': {
                nazev: 'OSVČ',
                typZadatele: 'fo-podnikatel',
                typZadateleText: 'Fyzická osoba podnikající',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: [],
                zvlastnostiText: '—',
                zadatel: {
                    jmeno: 'Karel',
                    prijmeni: 'Podnikavý',
                    datumNarozeni: '18. 9. 1975',
                    trvaleBytem: 'Obchodní 321, 551 01 Jaroměř',
                    ico: '87654321',
                    misto: 'Obchodní 321, 551 01 Jaroměř',
                    email: 'karel@podnikavy.cz',
                    telefon: '+420 604 567 890',
                    ds: 'podn321x'
                }
            },
            'spoluvlastnici': {
                nazev: 'Spoluvlastníci',
                typZadatele: 'fo-vice',
                typZadateleText: 'Více žadatelů (manželé)',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: true,
                vlastnikText: 'Spoluvlastníci pozemku',
                zvlastnosti: ['vice-zadatelu'],
                zvlastnostiText: '2 žadatelé',
                zadatele: [
                    {
                        jmeno: 'Jan',
                        prijmeni: 'Manžel',
                        datumNarozeni: '5. 4. 1980',
                        trvaleBytem: 'Rodinná 111, 551 01 Jaroměř',
                        email: 'jan.manzel@email.cz',
                        telefon: '+420 605 678 901',
                        ds: 'manz01'
                    },
                    {
                        jmeno: 'Jana',
                        prijmeni: 'Manželová',
                        datumNarozeni: '12. 8. 1982',
                        trvaleBytem: 'Rodinná 111, 551 01 Jaroměř',
                        email: 'jana.manzelova@email.cz',
                        telefon: '+420 606 789 012',
                        ds: null
                    }
                ]
            },
            'neni-vlastnik': {
                nazev: 'Není vlastník',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: false,
                vlastnikText: 'NENÍ vlastník pozemku',
                zvlastnosti: ['souhlas-vlastnika'],
                zvlastnostiText: 'Souhlas vlastníka § 187',
                zadatel: {
                    jmeno: 'Tomáš',
                    prijmeni: 'Nájemce',
                    datumNarozeni: '25. 1. 1990',
                    trvaleBytem: 'Nájemní 222, 551 01 Jaroměř',
                    email: 'tomas.najemce@email.cz',
                    telefon: '+420 607 890 123',
                    ds: null
                },
                vlastnikPozemku: {
                    jmeno: 'Město Jaroměř',
                    typ: 'po',
                    souhlas: true
                }
            },
            's-vyjimkami': {
                nazev: 'S výjimkami',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: ['vyjimka'],
                zvlastnostiText: 'Žádost o výjimku',
                zadatel: {
                    jmeno: 'Jiří',
                    prijmeni: 'Výjimečný',
                    datumNarozeni: '14. 2. 1978',
                    trvaleBytem: 'Speciální 444, 551 01 Jaroměř',
                    email: 'jiri@vyjimecny.cz',
                    telefon: '+420 609 012 345',
                    ds: 'vyji444'
                },
                vyjimka: {
                    typ: 'Odstupová vzdálenost',
                    popis: 'Snížení odstupové vzdálenosti od hranice pozemku z 2 m na 1,5 m',
                    oduvodneni: 'Stávající zástavba, terénní podmínky'
                }
            },
            'komplexni': {
                nazev: 'Komplexní',
                typZadatele: 'po',
                typZadateleText: 'Právnická osoba',
                zastupce: 'reza',
                zastupceText: 'REZA (el. zastupování)',
                vlastnik: false,
                vlastnikText: 'NENÍ vlastník pozemku',
                zvlastnosti: ['reza', 'souhlas-vlastnika', 'vyjimka'],
                zvlastnostiText: 'REZA + Souhlas + Výjimka',
                zadatel: {
                    nazev: 'DEVELOPMENT PLUS a.s.',
                    ico: '99887766',
                    sidlo: 'Developerská 999, 110 00 Praha 1',
                    ds: 'devplus1'
                },
                zastupceData: {
                    nazev: 'PROJEKTY PRO VÁS s.r.o.',
                    ico: '11223344',
                    sidlo: 'Projekční 555, 500 02 Hradec Králové',
                    ds: 'projvas1',
                    typPM: 'REZA — Registr elektronického zastupování',
                    platnostPM: 'Do 31. 12. 2027',
                    rozsah: 'Veškerá stavební řízení'
                },
                vlastnikPozemku: {
                    jmeno: 'Státní pozemkový úřad',
                    typ: 'po',
                    souhlas: true
                },
                vyjimka: {
                    typ: 'Požární odstup',
                    popis: 'Snížení požárního odstupu od sousední budovy',
                    oduvodneni: 'Kompenzováno protipožárním opatřením'
                }
            }
        };
        
        let currentScenario = 'zakladni';
        
        // Inicializace panelu
        function initSimulationPanel() {
            // Načíst scénář z URL
            const urlParams = new URLSearchParams(window.location.search);
            const scenarFromUrl = urlParams.get('scenar');
            
            if (scenarFromUrl && scenarios[scenarFromUrl]) {
                currentScenario = scenarFromUrl;
                document.querySelector(`input[name="scenar"][value="${scenarFromUrl}"]`).checked = true;
                applyScenario(scenarFromUrl, false);
            }
        }
        
        // Přepnout panel (minimalizovat/maximalizovat)
        function toggleSimPanel() {
            const panel = document.getElementById('simPanel');
            panel.classList.toggle('minimized');
        }
        
        // Aplikovat scénář
        function applyScenario(scenarioId, updateUrl = true) {
            currentScenario = scenarioId;
            const scenario = scenarios[scenarioId];
            
            if (!scenario) return;
            
            // Aktualizovat info panel
            document.getElementById('simInfoTyp').textContent = scenario.typZadateleText;
            document.getElementById('simInfoZastupce').textContent = scenario.zastupceText;
            document.getElementById('simInfoVlastnictvi').textContent = scenario.vlastnikText;
            document.getElementById('simInfoZvlastnosti').textContent = scenario.zvlastnostiText;
            
            // Aktualizovat URL
            if (updateUrl) {
                const url = new URL(window.location);
                url.searchParams.set('scenar', scenarioId);
                window.history.replaceState({}, '', url);
            }
            
            // Aktualizovat data v kontrole žádosti
            updateKontrolaZadostiData(scenario);
            
            // Aktualizovat checklist
            updateKontrolaZadostiChecklist(scenario);
            
            // Toast
            showSimToast(`Scénář: ${scenario.nazev}`);
        }
        
        // Aktualizovat strukturovaná data v kontrole žádosti
        function updateKontrolaZadostiData(scenario) {
            const sectionZadatel = document.getElementById('dataSectionZadatel');
            const sectionZastupce = document.getElementById('dataSectionZastupce');
            
            if (!sectionZadatel) return;
            
            // Helper funkce pro generování kontrolních prvků
            function getSectionControls(sectionId) {
                const currentStatus = zadostSectionState[sectionId];
                let statusHtml = '';
                let btnOkActive = '';
                let btnVadaActive = '';
                
                if (currentStatus === 'ok') {
                    statusHtml = '<span class="material-icons-outlined">check_circle</span> V pořádku';
                    btnOkActive = ' active';
                } else if (currentStatus === 'vada') {
                    statusHtml = '<span class="material-icons-outlined">error</span> Označeno jako vada';
                    btnVadaActive = ' active';
                } else {
                    statusHtml = '<span class="material-icons-outlined">radio_button_unchecked</span> Nezkontrolováno';
                }
                
                return `
                    <div class="zadost-section-controls">
                        <div class="zadost-section-status${currentStatus ? ' status-' + currentStatus : ''}" id="sectionStatus${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}">
                            ${statusHtml}
                        </div>
                        <div class="zadost-section-actions">
                            <button class="zadost-section-btn btn-ok${btnOkActive}" onclick="setSectionStatus('${sectionId}', 'ok')">
                                <span class="material-icons-outlined">check</span>
                                V pořádku
                            </button>
                            <button class="zadost-section-btn btn-vada${btnVadaActive}" onclick="setSectionStatus('${sectionId}', 'vada')">
                                <span class="material-icons-outlined">error_outline</span>
                                Vada
                            </button>
                        </div>
                    </div>
                `;
            }
            
            // Helper pro status badge v hlavičce
            function getStatusBadge(sectionId) {
                const currentStatus = zadostSectionState[sectionId];
                if (currentStatus === 'ok') {
                    return '<span class="section-status-badge ok" id="statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1) + '">✓</span>';
                } else if (currentStatus === 'vada') {
                    return '<span class="section-status-badge vada" id="statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1) + '">!</span>';
                }
                return '<span class="section-status-badge" id="statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1) + '"></span>';
            }
            
            // Aktualizovat sekci Údaje o podání (podatel vs. žadatel)
            const podaniPodatel = document.getElementById('podaniPodatel');
            const podaniVztah = document.getElementById('podaniVztah');
            const podaniVerifyActions = document.getElementById('podaniVerifyActions');
            
            if (podaniPodatel && podaniVztah && podaniVerifyActions) {
                // Určit jméno podavatele
                let podatelJmeno = '';
                if (scenario.zastupce && scenario.zastupceData) {
                    // Podatel je zástupce
                    const zast = scenario.zastupceData;
                    podatelJmeno = zast.nazev || (zast.jmeno + ' ' + zast.prijmeni);
                } else if (scenario.typZadatele === 'po' && scenario.zadatel) {
                    // Podatel je jednatel PO
                    podatelJmeno = scenario.zadatel.jednatel || scenario.zadatel.nazev;
                } else if (scenario.zadatel) {
                    // Podatel je sám žadatel
                    podatelJmeno = scenario.zadatel.jmeno + ' ' + scenario.zadatel.prijmeni;
                } else if (scenario.zadatele && scenario.zadatele[0]) {
                    // Více žadatelů - první je podatel
                    podatelJmeno = scenario.zadatele[0].jmeno + ' ' + scenario.zadatele[0].prijmeni;
                }
                
                podaniPodatel.textContent = podatelJmeno;
                
                // Určit vztah k žadateli a akční tlačítka
                const isReza = scenario.zastupce === 'reza';
                const isPM = scenario.zastupce === 'pm';
                const isPovereni = scenario.zastupce === 'povereni';
                const isStatutar = scenario.zastupce === 'statutar';
                
                if (!scenario.zastupce || scenario.zastupce === null) {
                    // Podatel je sám žadatel
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #34a853;">check_circle</span>
                            Podatel je sám žadatel
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'none';
                } else if (isReza) {
                    // Zástupce s elektronickou plnou mocí (REZA)
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #1a73e8;">supervisor_account</span>
                            Zástupce na základě plné moci
                            <span style="padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 4px; font-size: 10px; font-weight: 600;">REZA</span>
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'flex';
                    podaniVerifyActions.innerHTML = `
                        <button class="zastupce-verify-btn reza" onclick="openRezaModal(scenarios[currentScenario].zastupceData || {})">
                            <span class="material-icons-outlined">verified_user</span>
                            Zobrazit plnou moc v REZA
                        </button>
                    `;
                } else if (isPM) {
                    // Zástupce s listinnou plnou mocí
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #e65100;">supervisor_account</span>
                            Zástupce na základě plné moci
                            <span style="padding: 2px 8px; background: #fff3e0; color: #e65100; border-radius: 4px; font-size: 10px; font-weight: 600;">LISTINNÁ</span>
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'flex';
                    podaniVerifyActions.innerHTML = `
                        <button class="zastupce-verify-btn prilohy" onclick="openPrilohyPMModal()">
                            <span class="material-icons-outlined">search</span>
                            Najít plnou moc v přílohách
                        </button>
                    `;
                } else if (isPovereni) {
                    // Pověřená osoba
                    const isPovereniReza = scenario.povereniTyp === 'reza';
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #7b1fa2;">badge</span>
                            Pověřená osoba
                            <span style="padding: 2px 8px; background: ${isPovereniReza ? '#e8f5e9' : '#fff3e0'}; color: ${isPovereniReza ? '#2e7d32' : '#e65100'}; border-radius: 4px; font-size: 10px; font-weight: 600;">${isPovereniReza ? 'REZA' : 'LISTINNÉ'}</span>
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'flex';
                    if (isPovereniReza) {
                        podaniVerifyActions.innerHTML = `
                            <button class="zastupce-verify-btn reza" onclick="openRezaModal({typZastoupeni: 'povereni', ...scenarios[currentScenario].zastupceData})">
                                <span class="material-icons-outlined">verified_user</span>
                                Zobrazit pověření v REZA
                            </button>
                        `;
                    } else {
                        podaniVerifyActions.innerHTML = `
                            <button class="zastupce-verify-btn prilohy" onclick="openPrilohyPMModal()">
                                <span class="material-icons-outlined">search</span>
                                Najít pověření v přílohách
                            </button>
                        `;
                    }
                } else if (isStatutar) {
                    // Statutární zástupce
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #2e7d32;">verified</span>
                            Statutární zástupce právnické osoby
                            <span style="padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 4px; font-size: 10px; font-weight: 600;">REZA</span>
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'flex';
                    podaniVerifyActions.innerHTML = `
                        <button class="zastupce-verify-btn reza" onclick="openRezaModal({typZastoupeni: 'statutar', jmeno: '${scenario.zadatel?.jednatel || ""}', zmocnitel: '${scenario.zadatel?.nazev || ""}', zmocnitelId: '${scenario.zadatel?.ico || ""}'})">
                            <span class="material-icons-outlined">verified_user</span>
                            Ověřeno v REZA
                        </button>
                    `;
                }
            }
            
            // Aktualizovat sekci žadatele
            if (scenario.typZadatele === 'fo') {
                const z = scenario.zadatel;
                sectionZadatel.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">person</span>
                        Žadatel — Fyzická osoba
                        ${getStatusBadge('zadatel')}
                    </div>
                    <div class="zadost-data-grid">
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Jméno</div>
                            <div class="zadost-data-value">${z.jmeno}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Příjmení</div>
                            <div class="zadost-data-value">${z.prijmeni}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datum narození</div>
                            <div class="zadost-data-value">${z.datumNarozeni}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Místo trvalého pobytu</div>
                            <div class="zadost-data-value">${z.trvaleBytem}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">E-mail</div>
                            <div class="zadost-data-value">${z.email}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Telefon</div>
                            <div class="zadost-data-value">${z.telefon}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datová schránka</div>
                            <div class="zadost-data-value">${z.ds || '<span style="color:#9aa0a6;">Nemá zřízenu</span>'}</div>
                        </div>
                    </div>
                    ${getSectionControls('zadatel')}
                `;
            } else if (scenario.typZadatele === 'fo-podnikatel') {
                const z = scenario.zadatel;
                sectionZadatel.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">badge</span>
                        Žadatel — Fyzická osoba podnikající
                        ${getStatusBadge('zadatel')}
                    </div>
                    <div class="zadost-data-grid">
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Jméno</div>
                            <div class="zadost-data-value">${z.jmeno}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Příjmení</div>
                            <div class="zadost-data-value">${z.prijmeni}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datum narození</div>
                            <div class="zadost-data-value">${z.datumNarozeni}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Místo trvalého pobytu</div>
                            <div class="zadost-data-value">${z.trvaleBytem}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">IČO</div>
                            <div class="zadost-data-value"><strong>${z.ico}</strong></div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Místo podnikání</div>
                            <div class="zadost-data-value">${z.misto}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">E-mail</div>
                            <div class="zadost-data-value">${z.email}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datová schránka</div>
                            <div class="zadost-data-value">${z.ds}</div>
                        </div>
                    </div>
                    ${getSectionControls('zadatel')}
                `;
            } else if (scenario.typZadatele === 'po') {
                const z = scenario.zadatel;
                sectionZadatel.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">business</span>
                        Žadatel — Právnická osoba
                        ${getStatusBadge('zadatel')}
                    </div>
                    <div class="zadost-data-grid">
                        <div class="zadost-data-item full-width">
                            <div class="zadost-data-label">Název / Obchodní firma</div>
                            <div class="zadost-data-value"><strong>${z.nazev}</strong></div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">IČO</div>
                            <div class="zadost-data-value"><strong>${z.ico}</strong></div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Sídlo</div>
                            <div class="zadost-data-value">${z.sidlo}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datová schránka</div>
                            <div class="zadost-data-value">${z.ds}</div>
                        </div>
                        ${z.jednatel ? `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Jednatel</div>
                            <div class="zadost-data-value">${z.jednatel}</div>
                        </div>
                        ` : ''}
                    </div>
                    ${getSectionControls('zadatel')}
                `;
            } else if (scenario.typZadatele === 'fo-vice') {
                let html = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">group</span>
                        Žadatelé — Spoluvlastníci (${scenario.zadatele.length})
                        ${getStatusBadge('zadatel')}
                    </div>
                `;
                scenario.zadatele.forEach((z, index) => {
                    html += `
                        <div style="padding: 8px 16px; background: #f8f9fa; font-weight: 600; font-size: 12px; color: #5f6368; border-bottom: 1px solid #e0e0e0;">
                            Žadatel ${index + 1}
                        </div>
                        <div class="zadost-data-grid">
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Jméno</div>
                                <div class="zadost-data-value">${z.jmeno}</div>
                            </div>
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Příjmení</div>
                                <div class="zadost-data-value">${z.prijmeni}</div>
                            </div>
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Datum narození</div>
                                <div class="zadost-data-value">${z.datumNarozeni}</div>
                            </div>
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Trvalé bydliště</div>
                                <div class="zadost-data-value">${z.trvaleBytem}</div>
                            </div>
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Datová schránka</div>
                                <div class="zadost-data-value">${z.ds || '<span style="color:#9aa0a6;">Nemá zřízenu</span>'}</div>
                            </div>
                        </div>
                    `;
                });
                html += getSectionControls('zadatel');
                sectionZadatel.innerHTML = html;
            }
            
            // Aktualizovat CSS třídu sekce podle stavu
            sectionZadatel.classList.remove('status-ok', 'status-vada');
            if (zadostSectionState.zadatel === 'ok') {
                sectionZadatel.classList.add('status-ok');
            } else if (zadostSectionState.zadatel === 'vada') {
                sectionZadatel.classList.add('status-vada');
            }
            
            // Aktualizovat sekci zástupce
            // Určit, zda je sekce Zástupce relevantní (potřebuje ruční kontrolu)
            const isRezaZastupce = scenario.zastupce === 'reza';
            const isPmZastupce = scenario.zastupce === 'pm';
            const isStatutarZastupce = scenario.zastupce === 'statutar';
            
            // Zástupce je relevantní jen u listinné PM (potřeba najít v přílohách)
            zastupceRelevant = isPmZastupce;
            
            if (scenario.zastupce && scenario.zastupceData) {
                const zast = scenario.zastupceData;
                const isReza = scenario.zastupce === 'reza';
                const isPO = zast.ico && zast.nazev;
                
                // Určit typ zastoupení pro tlačítka
                const typZastoupeni = zast.typZastoupeni || 'plna-moc'; // plna-moc, povereni
                
                let zastupceHtml = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">supervisor_account</span>
                        Zástupce na základě ${isReza ? 'REZA' : 'plné moci'}
                        ${isReza ? '<span style="margin-left: 8px; padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 4px; font-size: 10px; font-weight: 600;">REZA</span>' : '<span style="margin-left: 8px; padding: 2px 8px; background: #fff3e0; color: #e65100; border-radius: 4px; font-size: 10px; font-weight: 600;">LISTINNÁ</span>'}
                        ${getStatusBadge('zastupce')}
                    </div>
                    <div class="zadost-data-grid">
                `;
                
                if (isPO) {
                    zastupceHtml += `
                        <div class="zadost-data-item full-width">
                            <div class="zadost-data-label">Název / Obchodní firma</div>
                            <div class="zadost-data-value"><strong>${zast.nazev}</strong></div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">IČO</div>
                            <div class="zadost-data-value">${zast.ico}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Sídlo</div>
                            <div class="zadost-data-value">${zast.sidlo}</div>
                        </div>
                    `;
                } else {
                    zastupceHtml += `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Jméno a příjmení</div>
                            <div class="zadost-data-value">${zast.jmeno} ${zast.prijmeni}</div>
                        </div>
                        ${zast.datumNarozeni ? `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datum narození</div>
                            <div class="zadost-data-value">${zast.datumNarozeni}</div>
                        </div>
                        ` : ''}
                        ${zast.ico ? `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">IČO</div>
                            <div class="zadost-data-value">${zast.ico}</div>
                        </div>
                        ` : ''}
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Adresa</div>
                            <div class="zadost-data-value">${zast.adresa}</div>
                        </div>
                    `;
                }
                
                zastupceHtml += `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datová schránka</div>
                            <div class="zadost-data-value">${zast.ds}</div>
                        </div>
                        <div class="zadost-data-item full-width" style="background: ${isReza ? '#e8f5e9' : '#fff3e0'};">
                            <div class="zadost-data-label">Typ zmocnění</div>
                            <div class="zadost-data-value">${zast.typPM}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Platnost</div>
                            <div class="zadost-data-value">${zast.platnostPM}</div>
                        </div>
                        ${zast.rozsah ? `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Rozsah zmocnění</div>
                            <div class="zadost-data-value">${zast.rozsah}</div>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                // Přidat ověřovací tlačítka a kontroly podle typu
                if (isReza) {
                    // REZA - automaticky ověřeno, jen info tlačítko
                    zastupceHtml += `
                    <div class="zastupce-verify-actions">
                        <button class="zastupce-verify-btn reza" onclick="openRezaModal(${JSON.stringify(zast).replace(/"/g, '&quot;')})">
                            <span class="material-icons-outlined">verified_user</span>
                            Zobrazit v REZA
                        </button>
                    </div>
                    <div class="zadost-section-controls">
                        <div class="zadost-section-status status-ok" id="sectionStatusZastupce">
                            <span class="material-icons-outlined">check_circle</span> Ověřeno v REZA
                        </div>
                    </div>
                    `;
                    // Automaticky nastavit na OK
                    setTimeout(() => setSectionAutoOk('zastupce', 'Ověřeno v REZA'), 100);
                } else {
                    // Listinná PM - potřeba ruční kontroly
                    zastupceHtml += `
                    <div class="zastupce-verify-actions">
                        <button class="zastupce-verify-btn prilohy" onclick="openPrilohyPMModal()">
                            <span class="material-icons-outlined">search</span>
                            Najít plnou moc v přílohách
                        </button>
                    </div>
                    `;
                    zastupceHtml += getSectionControls('zastupce');
                }
                
                sectionZastupce.innerHTML = zastupceHtml;
            } else if (scenario.zastupce === 'statutar') {
                sectionZastupce.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">supervisor_account</span>
                        Zástupce — Statutární orgán
                        <span style="margin-left: 8px; padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 4px; font-size: 10px; font-weight: 600;">REZA</span>
                        ${getStatusBadge('zastupce')}
                    </div>
                    <div class="zadost-data-empty" style="background: #e8f5e9; color: #2e7d32;">
                        <span class="material-icons-outlined">verified</span>
                        Za právnickou osobu jedná jednatel jako statutární orgán
                    </div>
                    <div class="zastupce-verify-actions">
                        <button class="zastupce-verify-btn reza" onclick="openRezaModal({typZastoupeni: 'statutar', jmeno: '${scenario.zadatel?.jednatel || "Ing. Pavel Horák"}', zmocnitel: '${scenario.zadatel?.nazev || ""}', zmocnitelId: '${scenario.zadatel?.ico || ""}'})">
                            <span class="material-icons-outlined">verified_user</span>
                            Ověřeno v REZA
                        </button>
                    </div>
                    <div class="zadost-section-controls">
                        <div class="zadost-section-status status-ok" id="sectionStatusZastupce">
                            <span class="material-icons-outlined">check_circle</span> Ověřeno v REZA
                        </div>
                    </div>
                `;
                // Automaticky nastavit na OK
                setTimeout(() => setSectionAutoOk('zastupce', 'Ověřeno v REZA'), 100);
            } else {
                // Žádný zástupce - automaticky OK
                sectionZastupce.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">supervisor_account</span>
                        Zástupce
                        ${getStatusBadge('zastupce')}
                    </div>
                    <div class="zadost-data-empty">
                        <span class="material-icons-outlined">person_off</span>
                        Žadatel jedná sám za sebe, zástupce není uveden
                    </div>
                    <div class="zadost-section-controls">
                        <div class="zadost-section-status status-ok" id="sectionStatusZastupce">
                            <span class="material-icons-outlined">check_circle</span> Není potřeba kontrolovat
                        </div>
                    </div>
                `;
                // Automaticky nastavit na OK
                setTimeout(() => setSectionAutoOk('zastupce', 'Není potřeba kontrolovat'), 100);
            }
            
            // Aktualizovat CSS třídu sekce zástupce podle stavu
            sectionZastupce.classList.remove('status-ok', 'status-vada');
            if (zadostSectionState.zastupce === 'ok') {
                sectionZastupce.classList.add('status-ok');
            } else if (zadostSectionState.zastupce === 'vada') {
                sectionZastupce.classList.add('status-vada');
            }
            
            // Aktualizovat sekci Přílohy podle scénáře
            const prilohyList = document.getElementById('prilohyList');
            const prilohyVerifyActions = document.getElementById('prilohyVerifyActions');
            
            if (prilohyList) {
                let prilohyHtml = '';
                
                // Plná moc
                if (scenario.zastupce === 'pm') {
                    prilohyHtml += `
                        <div class="priloha-inline-item pending">
                            <span class="material-icons-outlined">description</span>
                            Plná moc — <strong>ke kontrole</strong>
                        </div>
                    `;
                    prilohyVerifyActions.style.display = 'flex';
                } else if (scenario.zastupce === 'reza' || scenario.zastupce === 'statutar') {
                    prilohyHtml += `
                        <div class="priloha-inline-item na">
                            <span class="material-icons-outlined">remove_circle_outline</span>
                            Plná moc — ověřeno v REZA
                        </div>
                    `;
                } else {
                    prilohyHtml += `
                        <div class="priloha-inline-item na">
                            <span class="material-icons-outlined">remove_circle_outline</span>
                            Plná moc — neaplikuje se (žadatel jedná sám)
                        </div>
                    `;
                }
                
                // Souhlas vlastníka pozemku
                if (!scenario.vlastnik) {
                    prilohyHtml += `
                        <div class="priloha-inline-item pending">
                            <span class="material-icons-outlined">description</span>
                            Souhlas vlastníka pozemku — <strong>ke kontrole</strong>
                        </div>
                    `;
                    prilohyVerifyActions.style.display = 'flex';
                } else {
                    prilohyHtml += `
                        <div class="priloha-inline-item na">
                            <span class="material-icons-outlined">remove_circle_outline</span>
                            Souhlas vlastníka pozemku — neaplikuje se (žadatel je vlastník)
                        </div>
                    `;
                }
                
                // Pokud nejsou žádné přílohy ke kontrole, skrýt tlačítko
                if (!scenario.zastupce || scenario.zastupce !== 'pm') {
                    if (scenario.vlastnik) {
                        prilohyVerifyActions.style.display = 'none';
                    }
                }
                
                prilohyList.innerHTML = prilohyHtml;
            }
            
            // Aktualizovat sekci výjimek
            const sectionVyjimky = document.getElementById('dataSectionVyjimky');
            if (sectionVyjimky) {
                if (scenario.vyjimka) {
                    // Zobrazit sekci výjimek
                    sectionVyjimky.style.display = 'block';
                    sectionVyjimky.innerHTML = `
                        <div class="zadost-data-section-header">
                            <span class="material-icons-outlined">rule</span>
                            Výjimky z obecných požadavků
                            <span style="margin-left: 8px; padding: 2px 8px; background: #fff3e0; color: #ef6c00; border-radius: 4px; font-size: 10px; font-weight: 600;">ŽÁDÁNO</span>
                            ${getStatusBadge('vyjimky')}
                        </div>
                        <div class="zadost-data-grid">
                            <div class="zadost-data-item full-width">
                                <div class="zadost-data-label">Typ výjimky</div>
                                <div class="zadost-data-value"><strong>${scenario.vyjimka.typ}</strong></div>
                            </div>
                            <div class="zadost-data-item full-width">
                                <div class="zadost-data-label">Popis</div>
                                <div class="zadost-data-value">${scenario.vyjimka.popis}</div>
                            </div>
                            <div class="zadost-data-item full-width">
                                <div class="zadost-data-label">Odůvodnění žadatele</div>
                                <div class="zadost-data-value" style="background: #fffde7; padding: 8px; border-radius: 4px; font-style: italic;">${scenario.vyjimka.oduvodneni}</div>
                            </div>
                        </div>
                        ${getSectionControls('vyjimky')}
                    `;
                    // Reset stavu výjimek
                    resetSectionControls('vyjimky');
                } else {
                    // Skrýt sekci výjimek a nastavit automaticky OK
                    sectionVyjimky.style.display = 'none';
                    zadostSectionState.vyjimky = 'ok';
                }
            }
            
            // Aktualizovat deficiency panel
            setTimeout(() => updateDeficiencyPanel(), 150);
        }
        
        // Aktualizovat checklist podle scénáře
        function updateKontrolaZadostiChecklist(scenario) {
            const checklist = document.querySelector('.zadost-checklist');
            if (!checklist) return;
            
            // Reset všech položek
            checklist.querySelectorAll('.checklist-item').forEach(item => {
                item.classList.remove('disabled', 'checked-ok', 'checked-error');
                const actions = item.querySelector('.checklist-actions');
                if (actions) {
                    actions.innerHTML = `
                        <button class="checklist-btn ok" onclick="toggleChecklistItem(this, 'ok')" title="V pořádku">
                            <span class="material-icons-outlined">check</span>
                        </button>
                        <button class="checklist-btn error" onclick="toggleChecklistItem(this, 'error')" title="Vadné">
                            <span class="material-icons-outlined">close</span>
                        </button>
                    `;
                }
            });
            
            // Nastavit disabled položky podle scénáře
            const setDisabled = (text) => {
                checklist.querySelectorAll('.checklist-item').forEach(item => {
                    if (item.querySelector('.checklist-text').textContent.includes(text)) {
                        item.classList.add('disabled');
                        item.querySelector('.checklist-actions').innerHTML = `
                            <button class="checklist-btn na" disabled title="Neaplikuje se">
                                <span class="material-icons-outlined">remove</span>
                            </button>
                        `;
                    }
                });
            };
            
            const setEnabled = (text) => {
                checklist.querySelectorAll('.checklist-item').forEach(item => {
                    if (item.querySelector('.checklist-text').textContent.includes(text)) {
                        item.classList.remove('disabled');
                        item.querySelector('.checklist-actions').innerHTML = `
                            <button class="checklist-btn ok" onclick="toggleChecklistItem(this, 'ok')" title="V pořádku">
                                <span class="material-icons-outlined">check</span>
                            </button>
                            <button class="checklist-btn error" onclick="toggleChecklistItem(this, 'error')" title="Vadné">
                                <span class="material-icons-outlined">close</span>
                            </button>
                        `;
                    }
                });
            };
            
            // Typ žadatele
            if (scenario.typZadatele === 'fo') {
                setDisabled('Fyzická osoba podnikající');
                setDisabled('Právnická osoba uvedla');
            } else if (scenario.typZadatele === 'fo-podnikatel') {
                setDisabled('Právnická osoba uvedla');
                setEnabled('Fyzická osoba podnikající');
            } else if (scenario.typZadatele === 'po') {
                setDisabled('Fyzická osoba uvedla jméno');
                setDisabled('Fyzická osoba podnikající');
                setEnabled('Právnická osoba uvedla');
            } else if (scenario.typZadatele === 'fo-vice') {
                setDisabled('Fyzická osoba podnikající');
                setDisabled('Právnická osoba uvedla');
            }
            
            // Plná moc
            if (scenario.zastupce === 'pm' || scenario.zastupce === 'reza') {
                setEnabled('Plná moc');
            } else {
                setDisabled('Plná moc');
            }
            
            // Vlastnictví
            if (!scenario.vlastnik) {
                setEnabled('Souhlas vlastníka');
                setEnabled('Čestné prohlášení');
            } else {
                setDisabled('Souhlas vlastníka');
                setDisabled('Čestné prohlášení');
            }
            
            // Výjimky
            if (scenario.vyjimka) {
                setEnabled('Popis a odůvodnění výjimky');
            } else {
                setDisabled('Popis a odůvodnění výjimky');
            }
        }
        
        // Kopírovat URL scénáře
        function copyScenarioUrl() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                showSimToast('URL zkopírována do schránky');
            });
        }
        
        // Reset na základní scénář
        function resetScenario() {
            document.querySelector('input[name="scenar"][value="zakladni"]').checked = true;
            applyScenario('zakladni');
        }
        
        // Toast pro simulační panel
        function showSimToast(message) {
            const existing = document.querySelector('.sim-toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = 'sim-toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 2000);
        }
        
        // Inicializace při načtení stránky
        document.addEventListener('DOMContentLoaded', function() {
            initSimulationPanel();
        });
    </script>
</body>
</html>
