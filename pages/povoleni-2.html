<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISSŘ - Kontrola řízení</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        /* ===========================================
           ISSŘ HLAVIČKA
           =========================================== */
        .issr-header {
            background-color: #004289;
            height: 56px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
        }

        .issr-header__logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: white;
        }

        .issr-header__logo-img {
            height: 40px;
            width: auto;
        }

        .issr-header__title {
            font-size: 12px;
            font-weight: 400;
            color: white;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .issr-header__search {
            flex: 1;
            max-width: 500px;
            margin: 0 40px;
        }

        .issr-header__search-input {
            width: 100%;
            height: 32px;
            padding: 0 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        }

        .issr-header__search-input::placeholder {
            color: #adb5bd;
        }

        .issr-header__actions {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
        }

        .issr-header__notification {
            position: relative;
            color: white;
            cursor: pointer;
        }

        .issr-header__notification-icon {
            width: 20px;
            height: 20px;
        }

        .issr-header__notification-badge {
            position: absolute;
            top: -6px;
            right: -8px;
            background-color: #0066cc;
            color: white;
            font-size: 10px;
            font-weight: 600;
            min-width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        .issr-header__user {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .issr-header__user-icon {
            width: 16px;
            height: 16px;
        }

        @media (max-width: 992px) {
            .issr-header__search {
                max-width: 300px;
                margin: 0 20px;
            }
            
            .issr-header__title {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .issr-header {
                padding: 0 16px;
            }
            
            .issr-header__search {
                display: none;
            }
        }

        /* ===========================================
           STYLY STRÁNKY
           =========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif !important;
            font-size: 13px !important;
            color: #333 !important;
            background: #f5f5f5 !important;
            line-height: 1.5 !important;
            text-align: left !important;
        }

        * {
            text-align: left !important;
        }

        .btn, .btn-primary, .btn-secondary, .btn-back, .control-card-action {
            text-align: center !important;
        }

        /* Main layout */
        .main-content {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 56px);
        }

        /* Case header - sticky */
        .case-header {
            background: #fff;
            position: sticky;
            top: 56px;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Workflow stepper */
        .workflow-bar {
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            padding: 10px 32px !important;
            background: #f8f9fa !important;
            border-bottom: 1px solid #e0e0e0 !important;
            flex-wrap: nowrap !important;
        }

        .workflow-stepper {
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            flex-wrap: nowrap !important;
        }

        .workflow-step {
            display: inline-flex !important;
            align-items: center !important;
            gap: 6px !important;
            padding: 6px 12px !important;
            border-radius: 16px !important;
            font-size: 12px !important;
            font-weight: 400 !important;
            color: #5f6368 !important;
            background: #fff !important;
            border: 1px solid #dadce0 !important;
            cursor: default !important;
            transition: all 0.15s !important;
            white-space: nowrap !important;
        }

        .workflow-step .step-number {
            width: 18px !important;
            height: 18px !important;
            min-width: 18px !important;
            border-radius: 50% !important;
            background: #f1f3f4 !important;
            color: #5f6368 !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 10px !important;
            font-weight: 500 !important;
        }

        .workflow-step.active {
            background: #004289 !important;
            border-color: #004289 !important;
            color: #fff !important;
        }

        .workflow-step.active .step-number {
            background: rgba(255,255,255,0.25) !important;
            color: #fff !important;
        }

        .workflow-step.completed {
            background: #e6f4ea !important;
            border-color: #ceead6 !important;
            color: #137333 !important;
        }

        .workflow-step.completed .step-number {
            background: #137333 !important;
            color: #fff !important;
        }

        .workflow-step-connector {
            width: 20px !important;
            height: 2px !important;
            min-width: 20px !important;
            background: #dadce0 !important;
            flex-shrink: 0 !important;
        }

        .workflow-step-connector.completed {
            background: #137333 !important;
        }

        .case-header-main {
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            border-bottom: 1px solid #f0f0f0;
        }

        .case-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn-back {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #dadce0;
            border-radius: 8px;
            background: #fff;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
        }

        .btn-back:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .case-info {
            flex: 1;
        }

        .case-number {
            font-size: 12px !important;
            color: #5f6368 !important;
            font-family: 'Roboto Mono', monospace !important;
            margin-bottom: 2px !important;
        }

        .case-title {
            font-size: 18px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .case-meta {
            display: flex !important;
            align-items: center !important;
            gap: 16px !important;
            margin-top: 4px !important;
        }

        .case-meta-item {
            display: inline-flex !important;
            align-items: center !important;
            gap: 4px !important;
            font-size: 12px !important;
            color: #5f6368 !important;
        }

        .case-meta-item .material-icons-outlined {
            font-size: 16px;
        }

        .case-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .case-badge.draft {
            background: #fef7e0;
            color: #b06000;
        }

        .case-badge.active {
            background: #e6f4ea;
            color: #137333;
        }

        .case-badge.fast {
            background: #e8f1fa;
            color: #004289;
        }

        /* Document access bar */
        .document-access-bar {
            background: #f8f9fa !important;
            border-top: 1px solid #e0e0e0 !important;
            padding: 10px 32px !important;
            display: flex !important;
            align-items: center !important;
            gap: 16px !important;
        }

        .document-access-label {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-weight: 500 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
        }

        .document-access-buttons {
            display: flex !important;
            gap: 8px !important;
            flex-wrap: nowrap !important;
            margin-left: 24px !important;
        }

        .doc-access-btn {
            display: inline-flex !important;
            align-items: center !important;
            gap: 6px !important;
            padding: 8px 14px !important;
            background: #fff !important;
            border: 1px solid #dadce0 !important;
            border-radius: 6px !important;
            font-size: 13px !important;
            font-weight: 400 !important;
            color: #202124 !important;
            cursor: pointer !important;
            transition: all 0.15s !important;
            text-decoration: none !important;
            white-space: nowrap !important;
            height: auto !important;
            min-height: 0 !important;
            line-height: 1.4 !important;
        }

        .doc-access-btn:hover {
            background: #e8f4fd !important;
            border-color: #004289 !important;
            color: #004289 !important;
        }

        .doc-access-btn .material-icons-outlined {
            font-size: 18px !important;
            color: #5f6368 !important;
        }

        .doc-access-btn:hover .material-icons-outlined {
            color: #004289 !important;
        }

        .doc-access-btn .badge {
            background: #004289 !important;
            color: #fff !important;
            padding: 2px 8px !important;
            border-radius: 10px !important;
            font-size: 11px !important;
            font-weight: 500 !important;
            margin-left: 2px !important;
        }

        /* Page content */
        .page-content {
            flex: 1;
            padding: 24px 32px;
        }

        /* Section header */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-title {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .section-title .material-icons-outlined {
            font-size: 24px !important;
            color: #004289 !important;
        }

        .section-progress {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            font-size: 13px !important;
            color: #5f6368 !important;
        }

        .progress-bar {
            width: 120px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #34a853;
            border-radius: 3px;
            transition: width 0.3s;
        }

        /* Control cards grid */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .control-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.15s;
        }

        .control-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .control-card.disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        .control-card-header {
            padding: 16px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }

        .control-card-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .control-card-icon .material-icons-outlined {
            font-size: 24px;
        }

        /* Status colors */
        .status-waiting .control-card-icon {
            background: #f5f5f5;
            color: #9aa0a6;
        }

        .status-ready .control-card-icon {
            background: #e8f1fa;
            color: #004289;
        }

        .status-in-progress .control-card-icon {
            background: #fef7e0;
            color: #b06000;
        }

        .status-done .control-card-icon {
            background: #e6f4ea;
            color: #137333;
        }

        .status-problem .control-card-icon {
            background: #fce8e6;
            color: #c5221f;
        }

        .control-card-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .status-waiting .control-card-status {
            background: #f5f5f5;
            color: #5f6368;
        }

        .status-ready .control-card-status {
            background: #e8f1fa;
            color: #004289;
        }

        .status-in-progress .control-card-status {
            background: #fef7e0;
            color: #b06000;
        }

        .status-done .control-card-status {
            background: #e6f4ea;
            color: #137333;
        }

        .status-problem .control-card-status {
            background: #fce8e6;
            color: #c5221f;
        }

        .control-card-body {
            padding: 0 16px 16px !important;
        }

        .control-card-title {
            font-size: 15px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .control-card-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            line-height: 1.4 !important;
            margin-bottom: 12px !important;
            font-style: normal !important;
        }

        .control-card-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            border: none;
        }

        .status-waiting .control-card-action {
            background: #f5f5f5;
            color: #9aa0a6;
            cursor: not-allowed;
        }

        .status-ready .control-card-action {
            background: #004289;
            color: #fff;
        }

        .status-ready .control-card-action:hover {
            background: #1b4d7a;
        }

        .status-in-progress .control-card-action {
            background: #fef7e0;
            color: #b06000;
            border: 1px solid #f5e6b3;
        }

        .status-done .control-card-action {
            background: #e6f4ea;
            color: #137333;
            border: 1px solid #ceead6;
        }

        .status-problem .control-card-action {
            background: #fce8e6;
            color: #c5221f;
            border: 1px solid #f5c6c3;
        }

        .control-card-action .material-icons-outlined {
            font-size: 18px;
        }

        /* Summary card */
        .summary-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
        }

        .summary-content {
            flex: 1;
        }

        .summary-title {
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .summary-desc {
            font-size: 13px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .summary-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            border: 1px solid;
            white-space: nowrap;
        }

        .btn-primary {
            background: #004289;
            color: #fff;
            border-color: #004289;
        }

        .btn-primary:hover {
            background: #1b4d7a;
            border-color: #1b4d7a;
        }

        .btn-primary:disabled {
            background: #dadce0;
            border-color: #dadce0;
            color: #9aa0a6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #fff;
            color: #5f6368;
            border-color: #dadce0;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
            border-color: #5f6368;
        }

        .btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Info panel */
        .info-panel {
            background: #e8f1fa;
            border: 1px solid #c5d9f0;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .info-panel .material-icons-outlined {
            font-size: 20px;
            color: #004289;
            flex-shrink: 0;
        }

        .info-panel-content {
            flex: 1;
        }

        .info-panel-title {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #1a4d7c !important;
            margin-bottom: 2px !important;
            font-style: normal !important;
        }

        .info-panel-text {
            font-size: 13px !important;
            color: #1a4d7c !important;
            font-style: normal !important;
        }

        .info-panel.warning {
            background: #fef7e0 !important;
            border-color: #f5e6b3 !important;
        }

        .info-panel.warning .material-icons-outlined {
            color: #b06000 !important;
        }

        .info-panel.warning .info-panel-title {
            color: #7a4200 !important;
        }

        .info-panel.warning .info-panel-text {
            color: #7a4200 !important;
        }

        .info-panel.error {
            background: #fce8e6 !important;
            border-color: #f5c6c3 !important;
        }

        .info-panel.error .material-icons-outlined {
            color: #c5221f !important;
        }

        .info-panel.error .info-panel-title {
            color: #a50e0e !important;
        }

        .info-panel.error .info-panel-text {
            color: #a50e0e !important;
        }

        /* Phase tabs */
        .phase-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            background: #f1f3f4;
            padding: 4px;
            border-radius: 10px;
        }

        .phase-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #5f6368 !important;
            cursor: pointer;
            transition: all 0.2s;
            font-style: normal !important;
        }

        .phase-tab:hover {
            background: #e8eaed;
        }

        .phase-tab.active {
            background: #fff;
            color: #202124 !important;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .phase-tab .material-icons-outlined {
            font-size: 20px;
        }

        .phase-tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: #e8eaed;
            border-radius: 10px;
            font-size: 11px !important;
            font-weight: 600 !important;
        }

        .phase-tab.active .phase-tab-badge {
            background: #e8f0fe;
            color: #1a73e8;
        }

        .phase-tab-badge.done {
            background: #e6f4ea !important;
            color: #137333 !important;
        }

        .phase-content {
            display: none;
        }

        .phase-content.active {
            display: block;
        }

        /* Pozemky overlay styles */
        .parcels-readonly-section {
            margin-bottom: 24px;
        }

        .parcels-readonly-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .parcels-readonly-title .material-icons-outlined {
            font-size: 18px;
            color: #1a73e8;
        }

        .parcels-readonly-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: #e8f0fe;
            color: #1a73e8;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .parcel-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .parcel-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: #e8f0fe;
            border: 1px solid #c2d7f2;
            border-radius: 8px;
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .parcel-chip-icon {
            width: 24px;
            height: 24px;
            background: #1a73e8;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .parcel-chip-icon .material-icons-outlined {
            font-size: 16px;
            color: #fff;
        }

        .parcel-chip-content {
            display: flex;
            flex-direction: column;
        }

        .parcel-chip-number {
            font-weight: 500 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-size: 13px !important;
        }

        .parcel-chip-katastr {
            font-size: 11px !important;
            color: #5f6368 !important;
        }

        .parcel-chip-area {
            color: #5f6368 !important;
            font-size: 12px !important;
            margin-left: auto;
            padding-left: 12px;
        }

        /* Sousední pozemky - interaktivní */
        .parcels-interactive-section {
            margin-top: 0;
        }

        .parcels-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .parcels-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .parcels-section-title .material-icons-outlined {
            font-size: 18px;
            color: #f57c00;
        }

        .parcels-section-count {
            margin-left: auto;
            padding: 2px 8px;
            background: #fff3e0;
            color: #e65100;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .parcels-search-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .parcels-search-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px !important;
            font-style: normal !important;
        }

        .parcels-search-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .btn-search {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: #1a73e8;
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-search:hover {
            background: #1557b0;
        }

        .btn-map {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: #fff;
            color: #5f6368 !important;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-map:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }

        .btn-map .material-icons-outlined {
            font-size: 18px;
        }

        .sousedni-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 280px;
            overflow-y: auto;
        }

        .sousedni-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
        }

        .sousedni-item .parcel-chip-icon {
            background: #f57c00;
        }

        .sousedni-item-content {
            flex: 1;
        }

        .sousedni-item-number {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-style: normal !important;
        }

        .sousedni-item-katastr {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .sousedni-item-owner {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px;
            font-style: normal !important;
        }

        .sousedni-item-remove {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sousedni-item-remove:hover {
            background: #ffecb3;
            color: #e65100;
        }

        .sousedni-empty {
            padding: 32px 24px;
            text-align: center;
            background: #fafafa;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
        }

        .sousedni-empty .material-icons-outlined {
            font-size: 40px;
            color: #bdbdbd;
            margin-bottom: 12px;
        }

        .sousedni-empty-text {
            font-size: 14px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .sousedni-empty-hint {
            font-size: 12px !important;
            color: #9aa0a6 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        /* Auto-detect button */
        .btn-autodetect {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
            margin-bottom: 16px;
        }

        .btn-autodetect:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-autodetect .material-icons-outlined {
            font-size: 18px;
        }
        .status-warning .control-card-icon {
            background: #fef7e0 !important;
            color: #b06000 !important;
        }

        .status-warning .control-card-status {
            background: #fef7e0 !important;
            color: #b06000 !important;
        }

        .status-error .control-card-icon {
            background: #fce8e6 !important;
            color: #c5221f !important;
        }

        .status-error .control-card-status {
            background: #fce8e6 !important;
            color: #c5221f !important;
        }

        /* Výběr příslušného SÚ */
        .su-selection-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
            display: none;
        }

        .su-selection-section.visible {
            display: block;
        }

        .su-selection-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .su-selection-title .material-icons-outlined {
            font-size: 18px;
            color: #f57c00;
        }

        .su-selection-desc {
            font-size: 12px !important;
            color: #795548 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .su-select-wrapper {
            position: relative;
        }

        .su-select {
            width: 100%;
            padding: 12px 40px 12px 14px;
            font-size: 14px !important;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            color: #202124 !important;
            cursor: pointer;
            appearance: none;
            font-style: normal !important;
            font-family: 'Roboto', sans-serif !important;
        }

        .su-select:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .su-select-wrapper::after {
            content: "expand_more";
            font-family: "Material Icons Outlined";
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #5f6368;
            pointer-events: none;
            font-size: 20px;
        }

        .su-select option {
            padding: 8px;
        }

        .su-selected-info {
            margin-top: 12px;
            padding: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            display: none;
        }

        .su-selected-info.visible {
            display: block;
        }

        .su-selected-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .su-selected-icon {
            width: 32px;
            height: 32px;
            background: #e8f1fa;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .su-selected-icon .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .su-selected-name {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .su-selected-details {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        .su-selected-details span {
            display: block;
            margin-bottom: 2px;
        }

        /* Kontrola dokumentace - rozšířené styly */
        .doc-check-section {
            margin-bottom: 20px;
        }

        .doc-check-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .doc-check-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .doc-check-title .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .doc-check-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .doc-check-badge.pending {
            background: #f5f5f5;
            color: #5f6368;
        }

        .doc-check-badge.running {
            background: #e8f1fa;
            color: #004289;
        }

        .doc-check-badge.success {
            background: #e6f4ea;
            color: #137333;
        }

        .doc-check-badge.warning {
            background: #fef7e0;
            color: #b06000;
        }

        .doc-check-badge.error {
            background: #fce8e6;
            color: #c5221f;
        }

        /* Seznam dokumentů */
        .doc-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 280px;
            overflow-y: auto;
        }

        .doc-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .doc-item:hover {
            background: #e8f1fa;
            border-color: #c5d9f0;
        }

        .doc-item.checked {
            background: #e6f4ea;
            border-color: #ceead6;
        }

        .doc-item.has-issue {
            background: #fef7e0;
            border-color: #ffe082;
        }

        .doc-item-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #dadce0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .doc-item.checked .doc-item-checkbox {
            background: #137333;
            border-color: #137333;
            color: #fff;
        }

        .doc-item.has-issue .doc-item-checkbox {
            background: #f57c00;
            border-color: #f57c00;
            color: #fff;
        }

        .doc-item-checkbox .material-icons-outlined {
            font-size: 16px;
            display: none;
        }

        .doc-item.checked .doc-item-checkbox .material-icons-outlined,
        .doc-item.has-issue .doc-item-checkbox .material-icons-outlined {
            display: block;
        }

        .doc-item-content {
            flex: 1;
            min-width: 0;
        }

        .doc-item-name {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .doc-item-meta {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
            display: flex;
            gap: 12px;
            margin-top: 2px;
        }

        .doc-item-actions {
            display: flex;
            gap: 4px;
        }

        .doc-item-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .doc-item-btn:hover {
            background: rgba(0,0,0,0.08);
            color: #202124;
        }

        .doc-item-btn.issue-btn:hover {
            background: #fff3e0;
            color: #e65100;
        }

        .doc-item-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Automatická kontrola */
        .auto-check-section {
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .auto-check-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .auto-check-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .auto-check-title .material-icons-outlined {
            font-size: 18px;
            color: #7c3aed;
        }

        .btn-run-check {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 12px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-run-check:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-run-check:disabled {
            background: #dadce0;
            cursor: not-allowed;
        }

        .btn-run-check .material-icons-outlined {
            font-size: 16px;
        }

        /* ED stromová struktura */
        .ed-tree {
            font-size: 13px;
        }

        .ed-tree-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background: #e8f1fa;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .ed-tree-header-top {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ed-tree-header .material-icons-outlined {
            font-size: 20px;
            color: #004289;
        }

        .ed-version-selector {
            display: flex;
            align-items: center;
            padding-top: 8px;
            border-top: 1px solid #c5d9f0;
        }

        .ed-version-select {
            padding: 6px 10px;
            border: 1px solid #c5d9f0;
            border-radius: 4px;
            font-size: 12px;
            background: #fff;
            color: #202124;
            cursor: pointer;
            flex: 1;
        }

        .ed-version-select:focus {
            outline: none;
            border-color: #004289;
            box-shadow: 0 0 0 2px rgba(35, 98, 162, 0.2);
        }

        .ed-folder {
            margin-left: 0;
            margin-bottom: 2px;
        }

        .ed-folder.nested {
            margin-left: 20px;
        }

        .ed-folder-header {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .ed-folder-header:hover {
            background: #f5f5f5;
        }

        .ed-folder-header .folder-icon {
            font-size: 18px;
            color: #f9a825;
            transition: transform 0.2s;
        }

        .ed-folder.open > .ed-folder-header .folder-icon {
            color: #f57c00;
        }

        .ed-folder-header .folder-name {
            flex: 1;
            font-weight: 500;
            color: #202124;
        }

        .ed-folder-header .folder-count {
            font-size: 11px;
            color: #5f6368;
            padding: 2px 8px;
            background: #f1f3f4;
            border-radius: 10px;
        }

        .ed-folder-content {
            display: none;
            margin-left: 24px;
            padding-left: 12px;
            border-left: 1px solid #e0e0e0;
        }

        .ed-folder.open > .ed-folder-content {
            display: block;
        }

        .ed-file {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .ed-file:hover {
            background: #e8f1fa;
        }

        .ed-file .material-icons-outlined {
            font-size: 16px;
            color: #c62828;
        }

        .ed-file .file-name {
            flex: 1;
            color: #202124;
        }

        .ed-file .file-size {
            font-size: 11px;
            color: #5f6368;
        }

        .ed-file-more {
            padding: 6px 10px;
            font-size: 12px;
            color: #5f6368;
            font-style: italic;
        }

        .ed-folder.empty .ed-folder-header {
            cursor: default;
        }

        .ed-folder.empty .ed-folder-header:hover {
            background: transparent;
        }

        /* Kontrola částí dokumentace */
        .doc-parts-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .doc-part-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .doc-part-item.status-ok {
            background: #e6f4ea;
            border-color: #ceead6;
        }

        .doc-part-item.status-warning {
            background: #fef7e0;
            border-color: #ffe082;
        }

        .doc-part-item.status-error {
            background: #fce8e6;
            border-color: #f5c6c3;
        }

        .doc-part-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .doc-part-letter {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #004289;
            color: #fff;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
        }

        .doc-part-item.status-ok .doc-part-letter {
            background: #137333;
        }

        .doc-part-item.status-warning .doc-part-letter {
            background: #f57c00;
        }

        .doc-part-item.status-error .doc-part-letter {
            background: #c5221f;
        }

        .doc-part-name {
            font-weight: 500;
            color: #202124;
        }

        .doc-part-status {
            display: flex;
            gap: 4px;
        }

        .doc-part-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            color: #9aa0a6;
        }

        .doc-part-btn:hover {
            border-color: #5f6368;
        }

        .doc-part-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Nekontrolováno - šedé zaškrtnutí */
        .doc-part-btn.ok.unchecked {
            background: #f1f3f4;
            border-color: #dadce0;
            color: #9aa0a6;
        }

        .doc-part-btn.ok.active {
            background: #137333;
            border-color: #137333;
            color: #fff;
        }

        .doc-part-btn.warning.active {
            background: #f57c00;
            border-color: #f57c00;
            color: #fff;
        }

        .doc-part-btn.error.active {
            background: #c5221f;
            border-color: #c5221f;
            color: #fff;
        }

        /* Pozemky - rozšířené styly */
        .pozemky-section {
            margin-bottom: 20px;
        }

        .pozemky-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .pozemky-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .pozemky-section-title .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .pozemky-section-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            background: #e8f1fa;
            color: #004289;
        }

        /* Metoda výběru sousedů */
        .neighbor-method-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .neighbor-method-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: all 0.15s;
        }

        .neighbor-method-btn:hover {
            border-color: #004289;
            background: #f8fbff;
        }

        .neighbor-method-btn.active {
            border-color: #004289;
            background: #e8f1fa;
        }

        .neighbor-method-btn .material-icons-outlined {
            font-size: 24px;
            color: #5f6368;
        }

        .neighbor-method-btn.active .material-icons-outlined {
            color: #004289;
        }

        .neighbor-method-btn span:last-child {
            font-size: 11px;
            color: #5f6368;
            text-align: center;
        }

        .neighbor-method-btn.active span:last-child {
            color: #004289;
            font-weight: 500;
        }

        /* Polygon input */
        .polygon-input-section {
            display: none;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .polygon-input-section.visible {
            display: block;
        }

        .polygon-input-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .polygon-input-label {
            font-size: 13px;
            color: #202124;
            white-space: nowrap;
        }

        .polygon-input {
            width: 80px;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }

        .polygon-input:focus {
            outline: none;
            border-color: #004289;
            box-shadow: 0 0 0 2px rgba(35, 98, 162, 0.2);
        }

        .polygon-input-unit {
            font-size: 13px;
            color: #5f6368;
        }

        .btn-generate-polygon {
            margin-left: auto;
            padding: 8px 16px;
            background: #004289;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-generate-polygon:hover {
            background: #1a4a7a;
        }

        /* Ověření KN */
        .kn-verify-section {
            margin-top: 20px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .kn-verify-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .kn-verify-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .kn-verify-title .material-icons-outlined {
            font-size: 18px;
            color: #7c3aed;
        }

        .btn-verify-kn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-verify-kn:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-verify-kn:disabled {
            background: #dadce0;
            cursor: not-allowed;
        }

        .kn-verify-results {
            display: none;
        }

        .kn-verify-results.visible {
            display: block;
        }

        /* Vlastníci z KN */
        .owner-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .owner-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .owner-item.verified {
            border-color: #ceead6;
            background: #f0faf3;
        }

        .owner-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e8f1fa;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .owner-item-icon .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .owner-item-content {
            flex: 1;
            min-width: 0;
        }

        .owner-item-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .owner-item-parcels {
            font-size: 11px;
            color: #5f6368;
        }

        .owner-item-relations {
            display: flex;
            gap: 6px;
            margin-top: 4px;
        }

        .owner-relation-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }

        .owner-relation-badge.vlastnik {
            background: #e8f1fa;
            color: #004289;
        }

        .owner-relation-badge.zastava {
            background: #fef7e0;
            color: #b06000;
        }

        .owner-relation-badge.vecne-bremeno {
            background: #fce8e6;
            color: #c5221f;
        }

        .owner-item-actions {
            display: flex;
            gap: 4px;
        }

        .owner-item-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .owner-item-btn:hover {
            background: rgba(0,0,0,0.08);
            color: #202124;
        }

        .owner-item-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Účastníci info */
        .ucastnici-info {
            margin-top: 16px;
            padding: 12px;
            background: #e6f4ea;
            border: 1px solid #ceead6;
            border-radius: 8px;
            display: none;
        }

        .ucastnici-info.visible {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ucastnici-info .material-icons-outlined {
            font-size: 20px;
            color: #137333;
        }

        .ucastnici-info-text {
            font-size: 13px;
            color: #137333;
        }

        /* Parcel chip rozšířený */
        .parcel-chip-extended {
            display: flex;
            flex-direction: column;
            padding: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .parcel-chip-extended.verified {
            border-color: #ceead6;
            background: #f0faf3;
        }

        .parcel-chip-extended-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .parcel-chip-extended-info {
            flex: 1;
        }

        .parcel-chip-extended-number {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
        }

        .parcel-chip-extended-katastr {
            font-size: 12px;
            color: #5f6368;
        }

        .parcel-chip-extended-owner {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #5f6368;
        }

        .parcel-chip-extended-owner strong {
            color: #202124;
        }

        .auto-check-results {
            display: none;
        }

        .auto-check-results.visible {
            display: block;
        }

        .check-result-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .check-result-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .check-result-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .check-result-icon .material-icons-outlined {
            font-size: 16px;
        }

        .check-result-icon.success {
            background: #e6f4ea;
            color: #137333;
        }

        .check-result-icon.warning {
            background: #fef7e0;
            color: #f57c00;
        }

        .check-result-icon.error {
            background: #fce8e6;
            color: #c5221f;
        }

        .check-result-content {
            flex: 1;
        }

        .check-result-label {
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .check-result-detail {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .check-result-action {
            font-size: 12px !important;
            color: #004289 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .check-result-action:hover {
            text-decoration: underline;
        }

        /* Seznam nedostatků */
        .issues-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
            display: none;
        }

        .issues-section.visible {
            display: block;
        }

        .issues-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .issues-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            font-style: normal !important;
        }

        .issues-title .material-icons-outlined {
            font-size: 18px;
        }

        .issues-count {
            padding: 4px 10px;
            background: #ff6d00;
            color: #fff;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 600 !important;
        }

        .issues-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .issue-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #ffe082;
            border-radius: 6px;
        }

        .issue-item-icon {
            width: 24px;
            height: 24px;
            background: #ff6d00;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .issue-item-icon .material-icons-outlined {
            font-size: 14px;
            color: #fff;
        }

        .issue-item-content {
            flex: 1;
        }

        .issue-item-doc {
            font-size: 12px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            font-style: normal !important;
        }

        .issue-item-text {
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
            margin-top: 2px;
        }

        .issue-item-remove {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #9aa0a6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .issue-item-remove:hover {
            background: #ffecb3;
            color: #e65100;
        }

        .issue-item-remove .material-icons-outlined {
            font-size: 18px;
        }

        /* Přidat nedostatek */
        .add-issue-row {
            display: flex;
            gap: 8px;
        }

        .add-issue-section {
            margin-top: 12px;
        }

        .add-issue-type-toggle {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }

        .issue-type-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #fff;
            color: #5f6368;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .issue-type-btn:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }

        .issue-type-btn.active {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .issue-type-btn .material-icons-outlined {
            font-size: 16px;
        }

        .add-issue-textarea-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .add-issue-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        .add-issue-textarea:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .btn-add-issue-full {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 16px;
            background: #ff6d00;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            align-self: flex-end;
        }

        .btn-add-issue-full:hover {
            background: #e65100;
        }

        .btn-add-issue-full .material-icons-outlined {
            font-size: 18px;
        }

        .add-issue-select {
            width: 180px;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            background: #fff;
            font-style: normal !important;
        }

        .add-issue-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            font-style: normal !important;
        }

        .add-issue-input:focus,
        .add-issue-select:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .btn-add-issue {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 8px 14px;
            background: #ff6d00;
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 12px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-add-issue:hover {
            background: #e65100;
        }

        .btn-add-issue .material-icons-outlined {
            font-size: 16px;
        }

        /* Loading animace pro automatickou kontrolu */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .btn-run-check.loading .material-icons-outlined {
            animation: spin 1s linear infinite;
        }

        /* Control fullscreen overlay */
        .control-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            z-index: 1500;
            display: none;
            flex-direction: column;
        }

        .control-overlay.open {
            display: flex;
        }

        .control-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .control-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .control-close {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-close:hover {
            background: #f1f3f4;
        }

        .control-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .control-title .material-icons-outlined {
            font-size: 24px;
            color: #004289;
        }

        .control-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Left panel - document viewer */
        .control-viewer {
            flex: 0 0 60%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e0e0;
            background: #f5f5f5;
        }

        .viewer-tabs {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .viewer-tab {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px !important;
            color: #5f6368 !important;
            cursor: pointer;
            transition: all 0.15s;
            font-style: normal !important;
        }

        .viewer-tab:hover {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289 !important;
        }

        .viewer-tab.active {
            background: #004289;
            border-color: #004289;
            color: #fff !important;
        }

        .viewer-tab .material-icons-outlined {
            font-size: 16px;
        }

        .viewer-tab .badge {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }

        .viewer-tab:not(.active) .badge {
            background: #e8f1fa;
            color: #004289;
        }

        .viewer-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .viewer-placeholder {
            background: #fff;
            border: 2px dashed #dadce0;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .viewer-placeholder .material-icons-outlined {
            font-size: 64px;
            color: #9aa0a6;
            margin-bottom: 16px;
        }

        .viewer-placeholder-title {
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 8px !important;
            font-style: normal !important;
        }

        .viewer-placeholder-text {
            font-size: 13px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        /* Right panel - control form */
        .control-form {
            flex: 0 0 40%;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        .control-form-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .control-form-footer {
            padding: 16px 24px;
            border-top: 1px solid #e0e0e0;
            background: #fafafa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .control-form-footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-form-footer-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .auto-save-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
        }

        .auto-save-indicator .material-icons-outlined {
            font-size: 16px;
        }

        .auto-save-indicator.saving {
            color: #f57c00;
        }

        .auto-save-indicator.saving .material-icons-outlined {
            animation: spin 1s linear infinite;
        }

        .auto-save-indicator.saved {
            color: #137333;
        }

        .btn-save-draft {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background: #fff;
            color: #5f6368;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
        }

        .btn-save-draft:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-save-draft .material-icons-outlined {
            font-size: 18px;
        }

        .control-section {
            margin-bottom: 24px;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .control-section-title {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 12px !important;
            font-style: normal !important;
        }

        .control-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .control-option:last-child {
            margin-bottom: 0;
        }

        .control-option:hover {
            background: #f0f0f0;
            border-color: #dadce0;
        }

        .control-option.selected {
            background: #e8f1fa;
            border-color: #004289;
        }

        .control-option.selected.negative {
            background: #fce8e6;
            border-color: #f5c6c3;
        }

        .control-option input[type="radio"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            accent-color: #004289;
            flex-shrink: 0;
        }

        .control-option-content {
            flex: 1;
        }

        .control-option-label {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .control-option-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px !important;
            font-style: normal !important;
        }

        .control-option.selected.negative .control-option-label {
            color: #a50e0e !important;
        }

        /* Result preview box */
        .result-preview {
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .result-preview.positive {
            background: #e6f4ea;
            border: 1px solid #ceead6;
        }

        .result-preview.negative {
            background: #fce8e6;
            border: 1px solid #f5c6c3;
        }

        .result-preview.warning {
            background: #fef7e0;
            border: 1px solid #f5e6b3;
        }

        .result-preview.neutral {
            background: #f1f3f4;
            border: 1px solid #dadce0;
        }

        .result-preview-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .result-preview.positive .result-preview-title {
            color: #137333 !important;
        }

        .result-preview.negative .result-preview-title {
            color: #a50e0e !important;
        }

        .result-preview.warning .result-preview-title {
            color: #b06000 !important;
        }

        .result-preview.neutral .result-preview-title {
            color: #5f6368 !important;
        }

        .result-preview-title .material-icons-outlined {
            font-size: 20px;
        }

        .result-preview-text {
            font-size: 13px !important;
            font-style: normal !important;
        }

        .result-preview.positive .result-preview-text {
            color: #137333 !important;
        }

        .result-preview.negative .result-preview-text {
            color: #a50e0e !important;
        }

        .result-preview.warning .result-preview-text {
            color: #7a4200 !important;
        }

        .result-preview.neutral .result-preview-text {
            color: #5f6368 !important;
        }

        /* Info box */
        .info-box {
            display: flex;
            gap: 12px;
            padding: 16px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
        }

        .info-box.warning {
            background: #fef7e0;
            border-color: #f9ab00;
        }

        .info-box.error {
            background: #fce8e6;
            border-color: #ea4335;
        }

        .info-box-icon {
            flex-shrink: 0;
        }

        .info-box-icon .material-icons-outlined {
            font-size: 24px;
            color: #f9ab00;
        }

        .info-box.error .info-box-icon .material-icons-outlined {
            color: #ea4335;
        }

        .info-box-content {
            flex: 1;
        }

        .info-box-title {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 4px;
        }

        .info-box-text {
            font-size: 13px;
            color: #5f6368;
            line-height: 1.5;
        }

        .info-box-text ul {
            margin: 8px 0 0 0;
            padding-left: 20px;
        }

        .info-box-text li {
            margin-bottom: 4px;
        }

        /* Checklist items */
        .checklist-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .checklist-item:hover {
            background: #f0f0f0;
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #004289;
            flex-shrink: 0;
        }

        .checklist-item-content {
            flex: 1;
            min-width: 0;
        }

        .checklist-item-title {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .checklist-item-desc {
            font-size: 12px;
            color: #5f6368;
            margin-top: 2px;
        }

        .checklist-item-badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .checklist-item-badge.ok {
            background: #e6f4ea;
            color: #137333;
        }

        .checklist-item-badge.neutral {
            background: #f1f3f4;
            color: #5f6368;
        }

        .checklist-item-badge.warning {
            background: #fef7e0;
            color: #7a4200;
        }

        /* Data card komponenty pro zobrazení načtených dat */
        .data-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .data-row {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #f1f3f4;
            gap: 12px;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-row.empty {
            background: #fafafa;
        }

        .data-row.error {
            background: #fce8e6;
        }

        .data-label {
            width: 180px;
            flex-shrink: 0;
            font-size: 12px;
            color: #5f6368;
            font-weight: 500;
        }

        .data-value {
            flex: 1;
            font-size: 13px;
            color: #202124;
        }

        .data-value.muted {
            color: #9aa0a6;
            font-style: italic;
        }

        .data-value .data-link {
            color: #1a73e8;
            cursor: pointer;
        }

        .data-value .data-link:hover {
            text-decoration: underline;
        }

        .data-status {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .data-status.ok {
            background: #e6f4ea;
            color: #137333;
        }

        .data-status.ok:hover {
            background: #ceead6;
        }

        .data-status.error {
            background: #fce8e6;
            color: #c5221f;
        }

        .data-status.error:hover {
            background: #f5c6c2;
        }

        .data-status.na {
            background: #f1f3f4;
            color: #9aa0a6;
            cursor: default;
        }

        .data-status .material-icons-outlined {
            font-size: 18px;
        }

        .deficiency-note-section {
            margin-top: 16px;
            padding: 16px;
            background: #fef7e0;
            border: 1px solid #f9ab00;
            border-radius: 8px;
        }

        .deficiency-note-section .control-section-title {
            margin-bottom: 12px;
        }

        .deficiency-note-input {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
        }

        .deficiency-note-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .checklist-label {
            flex: 1;
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .checklist-note {
            font-size: 12px !important;
            color: #9aa0a6 !important;
            font-style: italic !important;
        }

        .checklist-item:has(input:not(:checked)) {
            opacity: 0.6;
        }

        /* AI Control Section */
        .ai-control-section {
            background: linear-gradient(135deg, #f0e6ff 0%, #e6f0ff 100%);
            border: 1px solid #d4c4f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-control-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .ai-control-header .material-icons-outlined {
            font-size: 20px;
            color: #7c3aed;
        }

        .btn-ai {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            cursor: pointer;
            transition: all 0.2s;
            font-style: normal !important;
        }

        .btn-ai:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .btn-ai:disabled {
            background: #d4c4f0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-ai .material-icons-outlined {
            font-size: 18px;
        }

        /* AI Result Section */
        .ai-result-section {
            background: #f8f5ff;
            border: 1px solid #e4d9f5;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-result-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            margin-bottom: 16px;
            font-style: normal !important;
        }

        .ai-result-header .material-icons-outlined {
            font-size: 20px;
            color: #7c3aed;
        }

        .ai-result-badge {
            margin-left: auto;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .ai-result-badge.success {
            background: #dcfce7;
            color: #166534;
        }

        .ai-result-badge.loading {
            background: #fef3c7;
            color: #92400e;
        }

        .ai-report-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: #fff;
            border: 1px solid #e4d9f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 16px;
        }

        .ai-report-link:hover {
            background: #f5f0ff;
            border-color: #c4b5fd;
        }

        .ai-report-link .material-icons-outlined:first-child {
            font-size: 24px;
            color: #7c3aed;
        }

        .ai-report-link-content {
            flex: 1;
        }

        .ai-report-link-title {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .ai-report-link-meta {
            font-size: 12px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .ai-report-link .material-icons-outlined:last-child {
            font-size: 18px;
            color: #9aa0a6;
        }

        .ai-summary {
            display: flex;
            gap: 16px;
        }

        .ai-summary-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px !important;
            font-style: normal !important;
        }

        .ai-summary-item .material-icons-outlined {
            font-size: 18px;
        }

        .ai-summary-item.success {
            color: #166534 !important;
        }

        .ai-summary-item.warning {
            color: #92400e !important;
        }

        .ai-summary-item.error {
            color: #991b1b !important;
        }

        /* AI Report Detail */
        .ai-report-detail {
            background: #fff;
            border: 1px solid #e4d9f5;
            border-radius: 12px;
            margin-bottom: 24px;
            max-height: 400px;
            overflow-y: auto;
        }

        .ai-report-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e4d9f5;
            background: #f8f5ff;
            border-radius: 12px 12px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .ai-report-detail-title {
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            font-style: normal !important;
        }

        .ai-report-close {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-report-close:hover {
            background: #e4d9f5;
        }

        .ai-report-content {
            padding: 16px 20px;
        }

        .ai-report-group {
            margin-bottom: 20px;
        }

        .ai-report-group:last-child {
            margin-bottom: 0;
        }

        .ai-report-group-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 600 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .ai-report-group-title .material-icons-outlined {
            font-size: 18px;
        }

        .ai-report-group-title.success {
            color: #166534 !important;
        }

        .ai-report-group-title.warning {
            color: #92400e !important;
        }

        .ai-report-group-title.error {
            color: #991b1b !important;
        }

        .ai-report-item {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 14px 16px;
            margin-bottom: 8px;
        }

        .ai-report-item:last-child {
            margin-bottom: 0;
        }

        .ai-report-item-title {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .ai-report-item-result {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        .ai-report-item-result.success {
            background: #dcfce7;
            color: #166534;
        }

        .ai-report-item-result.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .ai-report-item-result.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .ai-report-item-detail {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
        }

        .ai-report-source {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px !important;
            font-style: normal !important;
        }

        .source-label {
            color: #5f6368 !important;
            flex-shrink: 0;
        }

        .source-path {
            color: #1a73e8 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-size: 11px !important;
        }

        .ai-report-note {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 8px;
            padding: 8px 12px;
            background: #e8f5e9;
            border-radius: 6px;
            font-style: normal !important;
        }

        .ai-report-note.warning {
            background: #fff8e1;
            color: #795548 !important;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .ai-report-note.warning .material-icons-outlined {
            font-size: 16px;
            color: #f57c00;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .ai-report-item.collapsed .ai-report-item-detail {
            display: none;
        }

        .ai-report-item.collapsed {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ai-report-item.collapsed .ai-report-item-title {
            margin-bottom: 0;
        }

        .ai-report-item.collapsed .ai-report-item-result {
            margin-top: 0;
        }

        /* Loading animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .btn-ai.loading {
            animation: pulse 1.5s infinite;
        }

        /* Modal styles - pro pomocné modály */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            max-width: 560px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .modal-title {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .modal-title .material-icons-outlined {
            font-size: 24px !important;
            color: #004289 !important;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f1f3f4;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid #e0e0e0;
            background: #fafafa;
            flex-shrink: 0;
        }

        /* Form elements in modal */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 6px !important;
        }

        .form-select {
            width: 100% !important;
            padding: 10px 12px !important;
            border: 1px solid #dadce0 !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            color: #202124 !important;
            background: #fff !important;
        }

        .form-select:focus {
            outline: none;
            border-color: #004289;
        }

        .form-check-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-check {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
        }

        .form-check:hover {
            background: #f0f0f0;
        }

        .form-check input[type="radio"],
        .form-check input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            accent-color: #004289;
        }

        .form-check-content {
            flex: 1;
        }

        .form-check-label {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .form-check-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px !important;
            font-style: normal !important;
        }

        /* Result box */
        .result-box {
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .result-box.success {
            background: #e6f4ea;
            border: 1px solid #ceead6;
        }

        .result-box.warning {
            background: #fef7e0;
            border: 1px solid #f5e6b3;
        }

        .result-box.error {
            background: #fce8e6;
            border: 1px solid #f5c6c3;
        }

        .result-box-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .result-box.success .result-box-title {
            color: #137333;
        }

        .result-box.warning .result-box-title {
            color: #b06000;
        }

        .result-box.error .result-box-title {
            color: #c5221f;
        }

        .result-box-title .material-icons-outlined {
            font-size: 20px;
        }

        .result-box-text {
            font-size: 13px;
        }

        .result-box.success .result-box-text {
            color: #137333;
        }

        .result-box.warning .result-box-text {
            color: #7a4200;
        }

        .result-box.error .result-box-text {
            color: #a50e0e;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .control-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .case-header-main {
                padding: 12px 16px;
                flex-direction: column;
                align-items: flex-start;
            }

            .document-access-bar {
                padding: 10px 16px;
                flex-wrap: wrap;
            }

            .page-content {
                padding: 16px;
            }

            .control-grid {
                grid-template-columns: 1fr;
            }

            .summary-card {
                flex-direction: column;
                text-align: center;
            }

            .summary-actions {
                width: 100%;
            }

            .summary-actions .btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- ISSŘ Hlavička -->
    <header class="issr-header">
        <a href="../index.html" class="issr-header__logo">
            <img src="../images/logo-issr.png" alt="ISSŘ Logo" class="issr-header__logo-img">
            <span class="issr-header__title">INFORMAČNÍ SYSTÉM STAVEBNÍHO ŘÍZENÍ</span>
        </a>
        
        <div class="issr-header__search">
            <input type="text" class="issr-header__search-input" placeholder="Hledat">
        </div>
        
        <div class="issr-header__actions">
            <div class="issr-header__notification">
                <svg class="issr-header__notification-icon" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"></path>
                </svg>
                <span class="issr-header__notification-badge">2</span>
            </div>
            
            <div class="issr-header__user">
                <span>Aleš Krupa</span>
                <svg class="issr-header__user-icon" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"></path>
                </svg>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Case header -->
        <header class="case-header">
            <div class="case-header-main">
                <div class="case-header-left">
                    <a href="povoleni_1.html" class="btn-back" title="Zpět">
                        <span class="material-icons-outlined">arrow_back</span>
                    </a>
                    <div class="case-info">
                        <div class="case-number">R/2026/000147</div>
                        <h1 class="case-title">Novostavba RD včetně přípojek</h1>
                        <div class="case-meta">
                            <span class="case-meta-item">
                                <span class="material-icons-outlined">gavel</span>
                                Povolení stavby
                            </span>
                            <span class="case-meta-item">
                                <span class="material-icons-outlined">home</span>
                                Jednoduchá stavba
                            </span>
                            <span class="case-badge draft">Kontrola</span>
                            <span class="case-badge fast">
                                <span class="material-icons-outlined" style="font-size: 14px;">bolt</span>
                                Zrychlené řízení
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Workflow stepper + document access -->
            <div class="workflow-bar" style="display: flex !important; align-items: center !important; justify-content: space-between !important; padding: 12px 32px !important; background: #f8f9fa !important; flex-wrap: nowrap !important;">
                <!-- Document access buttons - vlevo -->
                <div class="document-access-buttons" style="display: flex !important; gap: 8px !important; flex-wrap: nowrap !important;">
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('zadostModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">description</span>
                        Žádost
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('prilohyModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">attach_file</span>
                        Přílohy
                        <span class="badge" style="background: #e8f4fd !important; color: #004289 !important; padding: 2px 6px !important; border-radius: 10px !important; font-size: 10px !important; font-weight: 500 !important;">12</span>
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('eedModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">folder</span>
                        El. dokumentace
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('dokladyModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">fact_check</span>
                        Dokladová část
                    </a>
                </div>
                <!-- Workflow stepper - vpravo -->
                <div class="workflow-stepper" style="display: flex !important; align-items: center !important; gap: 8px !important; flex-wrap: nowrap !important;">
                    <div class="workflow-step completed" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #e6f4ea !important; border: 1px solid #ceead6 !important; color: #137333 !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: #34a853 !important; color: #fff !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">✓</span>
                        <span style="font-weight: 400 !important;">Založení řízení</span>
                    </div>
                    <div class="workflow-step-connector" style="width: 24px !important; height: 2px !important; min-width: 24px !important; background: #dadce0 !important; flex-shrink: 0 !important;"></div>
                    <div class="workflow-step active" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #004289 !important; border: 1px solid #004289 !important; color: #fff !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: rgba(255,255,255,0.2) !important; color: #fff !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">2</span>
                        <span style="font-weight: 400 !important;">Kontrola a zahájení</span>
                    </div>
                    <div class="workflow-step-connector" style="width: 24px !important; height: 2px !important; min-width: 24px !important; background: #dadce0 !important; flex-shrink: 0 !important;"></div>
                    <div class="workflow-step" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #fff !important; border: 1px solid #e0e0e0 !important; color: #5f6368 !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: #e0e0e0 !important; color: #5f6368 !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">3</span>
                        <span style="font-weight: 400 !important;">Projednání</span>
                    </div>
                    <div class="workflow-step-connector" style="width: 24px !important; height: 2px !important; min-width: 24px !important; background: #dadce0 !important; flex-shrink: 0 !important;"></div>
                    <div class="workflow-step" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #fff !important; border: 1px solid #e0e0e0 !important; color: #5f6368 !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: #e0e0e0 !important; color: #5f6368 !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">4</span>
                        <span style="font-weight: 400 !important;">Rozhodnutí</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page content -->
        <div class="page-content">
            <!-- Info panel -->
            <div class="info-panel" id="infoPanel">
                <span class="material-icons-outlined">info</span>
                <div class="info-panel-content">
                    <div class="info-panel-title">Probíhá kontrola před zahájením řízení</div>
                    <div class="info-panel-text">
                        Proveďte všechny kontroly níže. Po jejich dokončení bude možné řízení zahájit. 
                        Lhůta pro vydání rozhodnutí začne běžet od data doručení bezvadné žádosti (7. 1. 2026).
                    </div>
                </div>
            </div>

            <!-- Section header -->
            <div class="section-header">
                <div class="section-title">
                    <span class="material-icons-outlined">checklist</span>
                    Kontrolní panel
                </div>
                <div class="section-progress">
                    <span id="progressText">0 z 9 kontrol</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Control cards -->
            <div class="control-grid">
                <!-- 1. Příslušnost -->
                <div class="control-card status-ready" id="card-prislusnost">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">account_balance</span>
                        </div>
                        <span class="control-card-status">K provedení</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Příslušnost</div>
                        <div class="control-card-desc">Ověření věcné a místní příslušnosti stavebního úřadu</div>
                        <button class="control-card-action" onclick="openControl('controlPrislusnost')">
                            <span class="material-icons-outlined">play_arrow</span>
                            Provést kontrolu
                        </button>
                    </div>
                </div>

                <!-- 2. Kontrola žádosti -->
                <div class="control-card status-waiting disabled" id="card-zadost">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">fact_check</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Kontrola žádosti</div>
                        <div class="control-card-desc">Náležitosti žádosti podle § 184 a § 185 SZ</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve příslušnost
                        </button>
                    </div>
                </div>

                <!-- 3. Dokumentace -->
                <div class="control-card status-waiting disabled" id="card-dokumentace">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">architecture</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Dokumentace</div>
                        <div class="control-card-desc">Kontrola úplnosti, podpisů a formátu projektové dokumentace</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve kontrola žádosti
                        </button>
                    </div>
                </div>

                <!-- 4. Pozemky a sousedé -->
                <div class="control-card status-waiting disabled" id="card-pozemky">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">terrain</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Pozemky a sousedé</div>
                        <div class="control-card-desc">Ověření pozemků záměru a identifikace sousedních parcel</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve dokumentace
                        </button>
                    </div>
                </div>

                <!-- 5. Územní plán -->
                <div class="control-card status-waiting disabled" id="card-up">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">map</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Územní plán</div>
                        <div class="control-card-desc">Kontrola souladu záměru s územním plánem</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 6. Identifikace DO a správců TDI -->
                <div class="control-card status-waiting disabled" id="card-identifikace">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">hub</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Identifikace DO a TDI</div>
                        <div class="control-card-desc">Identifikace dotčených orgánů a správců technické infrastruktury</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 7. Dokladová část -->
                <div class="control-card status-waiting disabled" id="card-doklady">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">fact_check</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Dokladová část</div>
                        <div class="control-card-desc">Kontrola stanovisek DO a vyjádření správců sítí</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve identifikace
                        </button>
                    </div>
                </div>

                <!-- 8. Účastníci -->
                <div class="control-card status-waiting disabled" id="card-ucastnici">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">groups</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Účastníci řízení</div>
                        <div class="control-card-desc">Definice účastníků na základě pozemků a sousedů</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 9. Zrychlené řízení -->
                <div class="control-card status-waiting disabled" id="card-zrychlene">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">bolt</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Zrychlené řízení</div>
                        <div class="control-card-desc">Ověření podmínek pro zrychlené řízení</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve ostatní kontroly
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary / Action bar -->
            <div class="summary-card">
                <div class="summary-content">
                    <div class="summary-title" id="summaryTitle">Dokončete všechny kontroly</div>
                    <div class="summary-desc" id="summaryDesc">Po dokončení všech kontrol bude možné řízení zahájit.</div>
                </div>
                <div class="summary-actions">
                    <button class="btn btn-primary" id="btnZahajit" disabled onclick="zahajitRizeni()">
                        <span class="material-icons-outlined">play_circle</span>
                        Zahájit řízení
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- ============================================ -->
    <!-- KONTROLNÍ OVERLAYE - DVOUPANELOVÝ LAYOUT -->
    <!-- ============================================ -->

    <!-- Kontrola: Příslušnost (všechny podklady) -->
    <div class="control-overlay" id="controlPrislusnost">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlPrislusnost')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">account_balance</span>
                    Kontrola příslušnosti
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchViewerTab(this, 'prislusnost', 'zadost')">
                        <span class="material-icons-outlined">description</span>
                        Žádost
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'prislusnost', 'prilohy')">
                        <span class="material-icons-outlined">attach_file</span>
                        Přílohy
                        <span class="badge">12</span>
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'prislusnost', 'dokumentace')">
                        <span class="material-icons-outlined">folder</span>
                        El. dokumentace
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'prislusnost', 'doklady')">
                        <span class="material-icons-outlined">fact_check</span>
                        Dokladová část
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-prislusnost">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">V ostré verzi by se zde zobrazil náhled dokumentu</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <div class="control-section">
                        <div class="control-section-title">Věcná příslušnost</div>
                        <label class="control-option selected" onclick="selectOption(this); updatePrislusnostResult()">
                            <input type="radio" name="vecna_prislusnost" value="ano" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">Stavební úřad je věcně příslušný</div>
                                <div class="control-option-desc">Typ stavby spadá do působnosti obecného SÚ</div>
                            </div>
                        </label>
                        <label class="control-option" onclick="selectOption(this, true); updatePrislusnostResult()">
                            <input type="radio" name="vecna_prislusnost" value="ne">
                            <div class="control-option-content">
                                <div class="control-option-label">Stavební úřad není věcně příslušný</div>
                                <div class="control-option-desc">Řízení bude postoupeno DESÚ nebo krajskému stavebnímu úřadu</div>
                            </div>
                        </label>
                        
                        <!-- Výběr příslušného SÚ - zobrazí se při věcné nepříslušnosti -->
                        <div class="su-selection-section" id="specialniSuSection">
                            <div class="su-selection-title">
                                <span class="material-icons-outlined">domain</span>
                                Výběr věcně příslušného stavebního úřadu
                            </div>
                            <div class="su-selection-desc">
                                Vyberte stavební úřad, kterému bude řízení postoupeno podle typu stavby.
                            </div>
                            <div class="su-select-wrapper">
                                <select class="su-select" id="specialniSuSelect" onchange="updateSpecialniSuInfo()">
                                    <option value="">— Vyberte stavební úřad —</option>
                                    <optgroup label="DESÚ – Dopravní a energetický stavební úřad">
                                        <option value="desu" data-type="DESÚ" data-info="Dopravní a energetický stavební úřad|Sokolovská 1955/278, Praha 9|podatelna@desu.gov.cz|Dopravní stavby celostátního významu, energetické stavby">DESÚ – centrála Praha</option>
                                    </optgroup>
                                    <optgroup label="Krajské stavební úřady">
                                        <option value="ksu_praha" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad hl. m. Prahy|Jungmannova 35/29, Praha 1|stavebni@praha.eu|Stavby na území hl. m. Prahy spadající do působnosti KSÚ">KSÚ hl. m. Prahy</option>
                                        <option value="ksu_stredocesky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Středočeského kraje|Zborovská 11, Praha 5|stavebni@kr-s.cz|Stavby na území Středočeského kraje spadající do působnosti KSÚ">KSÚ Středočeského kraje</option>
                                        <option value="ksu_jihocesky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Jihočeského kraje|U Zimního stadionu 1952/2, České Budějovice|stavebni@kraj-jihocesky.cz|Stavby na území Jihočeského kraje spadající do působnosti KSÚ">KSÚ Jihočeského kraje</option>
                                        <option value="ksu_plzensky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Plzeňského kraje|Škroupova 18, Plzeň|stavebni@plzensky-kraj.cz|Stavby na území Plzeňského kraje spadající do působnosti KSÚ">KSÚ Plzeňského kraje</option>
                                        <option value="ksu_karlovarsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Karlovarského kraje|Závodní 353/88, Karlovy Vary|stavebni@kr-karlovarsky.cz|Stavby na území Karlovarského kraje spadající do působnosti KSÚ">KSÚ Karlovarského kraje</option>
                                        <option value="ksu_ustecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Ústeckého kraje|Velká Hradební 3118/48, Ústí nad Labem|stavebni@kr-ustecky.cz|Stavby na území Ústeckého kraje spadající do působnosti KSÚ">KSÚ Ústeckého kraje</option>
                                        <option value="ksu_liberecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Libereckého kraje|U Jezu 642/2a, Liberec|stavebni@kraj-lbc.cz|Stavby na území Libereckého kraje spadající do působnosti KSÚ">KSÚ Libereckého kraje</option>
                                        <option value="ksu_kralovehradecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Královéhradeckého kraje|Pivovarské náměstí 1245, Hradec Králové|stavebni@kr-kralovehradecky.cz|Stavby na území Královéhradeckého kraje spadající do působnosti KSÚ">KSÚ Královéhradeckého kraje</option>
                                        <option value="ksu_pardubicky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Pardubického kraje|Komenského náměstí 125, Pardubice|stavebni@pardubickykraj.cz|Stavby na území Pardubického kraje spadající do působnosti KSÚ">KSÚ Pardubického kraje</option>
                                        <option value="ksu_vysocina" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Kraje Vysočina|Žižkova 57, Jihlava|stavebni@kr-vysocina.cz|Stavby na území Kraje Vysočina spadající do působnosti KSÚ">KSÚ Kraje Vysočina</option>
                                        <option value="ksu_jihomoravsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Jihomoravského kraje|Žerotínovo náměstí 449/3, Brno|stavebni@kr-jihomoravsky.cz|Stavby na území Jihomoravského kraje spadající do působnosti KSÚ">KSÚ Jihomoravského kraje</option>
                                        <option value="ksu_olomoucky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Olomouckého kraje|Jeremenkova 40a, Olomouc|stavebni@kr-olomoucky.cz|Stavby na území Olomouckého kraje spadající do působnosti KSÚ">KSÚ Olomouckého kraje</option>
                                        <option value="ksu_zlinsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Zlínského kraje|třída Tomáše Bati 21, Zlín|stavebni@kr-zlinsky.cz|Stavby na území Zlínského kraje spadající do působnosti KSÚ">KSÚ Zlínského kraje</option>
                                        <option value="ksu_moravskoslezsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Moravskoslezského kraje|28. října 117, Ostrava|stavebni@kr-moravskoslezsky.cz|Stavby na území Moravskoslezského kraje spadající do působnosti KSÚ">KSÚ Moravskoslezského kraje</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="su-selected-info" id="specialniSuInfo">
                                <div class="su-selected-header">
                                    <div class="su-selected-icon">
                                        <span class="material-icons-outlined">account_balance</span>
                                    </div>
                                    <div class="su-selected-name" id="specialniSuName">—</div>
                                </div>
                                <div class="su-selected-details" id="specialniSuDetails">
                                    <span><strong>Adresa:</strong> —</span>
                                    <span><strong>E-mail:</strong> —</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="control-section" id="mistniPrislusnostSection">
                        <div class="control-section-title">Místní příslušnost</div>
                        <label class="control-option selected" onclick="selectOption(this); updatePrislusnostResult()">
                            <input type="radio" name="mistni_prislusnost" value="ano" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">Stavební úřad je místně příslušný</div>
                                <div class="control-option-desc">Stavba se nachází v územním obvodu tohoto SÚ</div>
                            </div>
                        </label>
                        <label class="control-option" onclick="selectOption(this, true); updatePrislusnostResult()">
                            <input type="radio" name="mistni_prislusnost" value="ne">
                            <div class="control-option-content">
                                <div class="control-option-label">Stavební úřad není místně příslušný</div>
                                <div class="control-option-desc">Řízení bude postoupeno místně příslušnému SÚ</div>
                            </div>
                        </label>
                        
                        <!-- Výběr obecného SÚ - zobrazí se při místní nepříslušnosti -->
                        <div class="su-selection-section" id="obecnySuSection">
                            <div class="su-selection-title">
                                <span class="material-icons-outlined">location_on</span>
                                Výběr místně příslušného stavebního úřadu
                            </div>
                            <div class="su-selection-desc">
                                Vyberte stavební úřad podle umístění stavby. Zobrazeny jsou úřady v okolí.
                            </div>
                            <div class="su-select-wrapper">
                                <select class="su-select" id="obecnySuSelect" onchange="updateObecnySuInfo()">
                                    <option value="">— Vyberte stavební úřad —</option>
                                    <optgroup label="Praha a okolí">
                                        <option value="praha1" data-info="Úřad městské části Praha 1|Vodičkova 18, Praha 1|stavebni@praha1.cz|k.ú. Staré Město, Josefov, Malá Strana, Hradčany">ÚMČ Praha 1</option>
                                        <option value="praha2" data-info="Úřad městské části Praha 2|náměstí Míru 20, Praha 2|stavebni@praha2.cz|k.ú. Nové Město, Vinohrady, Vyšehrad">ÚMČ Praha 2</option>
                                        <option value="praha3" data-info="Úřad městské části Praha 3|Havlíčkovo nám. 700/9, Praha 3|stavebni@praha3.cz|k.ú. Žižkov, Vinohrady">ÚMČ Praha 3</option>
                                        <option value="praha4" data-info="Úřad městské části Praha 4|Antala Staška 2059/80b, Praha 4|stavebni@praha4.cz|k.ú. Braník, Hodkovičky, Krč, Lhotka, Michle, Nusle, Podolí">ÚMČ Praha 4</option>
                                        <option value="praha5" data-info="Úřad městské části Praha 5|náměstí 14. října 4, Praha 5|stavebni@praha5.cz|k.ú. Smíchov, Košíře, Motol, Radlice, Hlubočepy, Jinonice">ÚMČ Praha 5</option>
                                    </optgroup>
                                    <optgroup label="Středočeský kraj">
                                        <option value="kladno" data-info="Magistrát města Kladna|náměstí Starosty Pavla 44, Kladno|stavebni@mestokladno.cz|ORP Kladno">Magistrát města Kladna</option>
                                        <option value="benesov" data-info="Městský úřad Benešov|Masarykovo náměstí 100, Benešov|stavebni@benesov-city.cz|ORP Benešov">MěÚ Benešov</option>
                                        <option value="beroun" data-info="Městský úřad Beroun|Husovo náměstí 68, Beroun|stavebni@muberoun.cz|ORP Beroun">MěÚ Beroun</option>
                                        <option value="brandys" data-info="Městský úřad Brandýs n. L. – Stará Boleslav|Masarykovo náměstí 1, Brandýs n. L.|stavebni@brandysko.cz|ORP Brandýs nad Labem">MěÚ Brandýs nad Labem</option>
                                        <option value="ceskybrod" data-info="Městský úřad Český Brod|náměstí Husovo 70, Český Brod|stavebni@cesbrod.cz|ORP Český Brod">MěÚ Český Brod</option>
                                        <option value="kolin" data-info="Městský úřad Kolín|Karlovo náměstí 78, Kolín|stavebni@mukolin.cz|ORP Kolín">MěÚ Kolín</option>
                                        <option value="kutnahora" data-info="Městský úřad Kutná Hora|Havlíčkovo náměstí 552/1, Kutná Hora|stavebni@kutnahora.cz|ORP Kutná Hora">MěÚ Kutná Hora</option>
                                        <option value="melnik" data-info="Městský úřad Mělník|náměstí Míru 1, Mělník|stavebni@melnik.cz|ORP Mělník">MěÚ Mělník</option>
                                        <option value="mlboleslav" data-info="Magistrát města Mladá Boleslav|Komenského náměstí 61, Mladá Boleslav|stavebni@mb-net.cz|ORP Mladá Boleslav">Magistrát města Mladá Boleslav</option>
                                        <option value="nymburk" data-info="Městský úřad Nymburk|náměstí Přemyslovců 163, Nymburk|stavebni@meu-nbk.cz|ORP Nymburk">MěÚ Nymburk</option>
                                        <option value="podebrady" data-info="Městský úřad Poděbrady|Jiřího náměstí 20/I, Poděbrady|stavebni@mesto-podebrady.cz|ORP Poděbrady">MěÚ Poděbrady</option>
                                        <option value="pribram" data-info="Městský úřad Příbram|Tyršova 108, Příbram|stavebni@pribram.eu|ORP Příbram">MěÚ Příbram</option>
                                        <option value="rakovnik" data-info="Městský úřad Rakovník|Husovo náměstí 27, Rakovník|stavebni@murako.cz|ORP Rakovník">MěÚ Rakovník</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="su-selected-info" id="obecnySuInfo">
                                <div class="su-selected-header">
                                    <div class="su-selected-icon">
                                        <span class="material-icons-outlined">account_balance</span>
                                    </div>
                                    <div class="su-selected-name" id="obecnySuName">—</div>
                                </div>
                                <div class="su-selected-details" id="obecnySuDetails">
                                    <span><strong>Adresa:</strong> —</span>
                                    <span><strong>E-mail:</strong> —</span>
                                    <span><strong>Územní obvod:</strong> —</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="result-preview positive" id="resultPrislusnost">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Příslušnost potvrzena
                        </div>
                        <div class="result-preview-text">Stavební úřad je věcně i místně příslušný k projednání této žádosti.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSavePrislusnost">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlPrislusnost')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('prislusnost')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completePrislusnost()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Kontrola žádosti (§ 184, § 185 SZ) -->
    <div class="control-overlay" id="controlZadost">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlZadost')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">fact_check</span>
                    Kontrola žádosti
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchViewerTab(this, 'kontrolazadosti', 'zadost')">
                        <span class="material-icons-outlined">description</span>
                        Žádost
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'kontrolazadosti', 'prilohy')">
                        <span class="material-icons-outlined">attach_file</span>
                        Přílohy
                        <span class="badge">12</span>
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'kontrolazadosti', 'dokumentace')">
                        <span class="material-icons-outlined">folder</span>
                        El. dokumentace
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'kontrolazadosti', 'doklady')">
                        <span class="material-icons-outlined">fact_check</span>
                        Dokladová část
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-kontrolazadosti">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">Formulář žádosti s údaji o stavebníkovi a záměru</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Údaje o žadateli -->
                    <div class="control-section">
                        <div class="control-section-title">Žadatel</div>
                        <div class="data-card" id="dataZadatel">
                            <div class="data-row" data-field="zadatel-jmeno">
                                <div class="data-label">Jméno a příjmení</div>
                                <div class="data-value">Jan Novák</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zadatel-adresa">
                                <div class="data-label">Adresa trvalého pobytu</div>
                                <div class="data-value">Hlavní 123, 110 00 Praha 1</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zadatel-narozeni">
                                <div class="data-label">Datum narození</div>
                                <div class="data-value">15. 3. 1985</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zadatel-email">
                                <div class="data-label">E-mail</div>
                                <div class="data-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="711b101f5f1f1e07101a31141c10181d5f120b">[email&#160;protected]</a></div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zadatel-telefon">
                                <div class="data-label">Telefon</div>
                                <div class="data-value">+420 601 234 567</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zadatel-ds">
                                <div class="data-label">Datová schránka</div>
                                <div class="data-value">abc1234</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Zástupce -->
                    <div class="control-section">
                        <div class="control-section-title">Zástupce na základě plné moci</div>
                        <div class="data-card" id="dataZastupce">
                            <div class="data-row empty" data-field="zastupce">
                                <div class="data-label">Zástupce</div>
                                <div class="data-value muted">Žadatel jedná sám za sebe</div>
                                <button class="data-status na" disabled title="Neaplikuje se">
                                    <span class="material-icons-outlined">remove</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Údaje o záměru -->
                    <div class="control-section">
                        <div class="control-section-title">Záměr</div>
                        <div class="data-card" id="dataZamer">
                            <div class="data-row" data-field="zamer-nazev">
                                <div class="data-label">Název záměru</div>
                                <div class="data-value">Novostavba rodinného domu</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zamer-ucel">
                                <div class="data-label">Účel</div>
                                <div class="data-value">Bydlení</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zamer-druh">
                                <div class="data-label">Druh stavby</div>
                                <div class="data-value">Rodinný dům</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zamer-zpusob">
                                <div class="data-label">Způsob provádění</div>
                                <div class="data-value">Dodavatelsky</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zamer-doba">
                                <div class="data-label">Předpokládaná doba provádění</div>
                                <div class="data-value">24 měsíců</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="zamer-charakter">
                                <div class="data-label">Charakter stavby</div>
                                <div class="data-value">Trvalá stavba</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Pozemky -->
                    <div class="control-section">
                        <div class="control-section-title">Pozemky</div>
                        <div class="data-card" id="dataPozemky">
                            <div class="data-row" data-field="pozemky-parcely">
                                <div class="data-label">Parcelní čísla</div>
                                <div class="data-value">st. 123, 456/1, 456/2</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="pozemky-ku">
                                <div class="data-label">Katastrální území</div>
                                <div class="data-value">Horní Počernice [643394]</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="pozemky-vlastnik">
                                <div class="data-label">Vlastník pozemku</div>
                                <div class="data-value">Jan Novák (žadatel)</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Přílohy -->
                    <div class="control-section">
                        <div class="control-section-title">Přílohy žádosti</div>
                        <div class="data-card" id="dataPrilohy">
                            <div class="data-row" data-field="priloha-dokumentace">
                                <div class="data-label">Projektová dokumentace</div>
                                <div class="data-value">Vložena do EED <span class="data-link">EED-2025-00123</span></div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row" data-field="priloha-dtm">
                                <div class="data-label">Vyjádření vlastníků sítí z DTM</div>
                                <div class="data-value">12 vyjádření přiloženo</div>
                                <button class="data-status ok" onclick="toggleDataStatus(this)" title="Označit jako vadné">
                                    <span class="material-icons-outlined">check_circle</span>
                                </button>
                            </div>
                            <div class="data-row empty" data-field="priloha-souhlas">
                                <div class="data-label">Souhlas vlastníka pozemku</div>
                                <div class="data-value muted">Nevyžaduje se (žadatel = vlastník)</div>
                                <button class="data-status na" disabled title="Neaplikuje se">
                                    <span class="material-icons-outlined">remove</span>
                                </button>
                            </div>
                            <div class="data-row empty" data-field="priloha-planovaci">
                                <div class="data-label">Plánovací smlouva</div>
                                <div class="data-value muted">Nevyžaduje se</div>
                                <button class="data-status na" disabled title="Neaplikuje se">
                                    <span class="material-icons-outlined">remove</span>
                                </button>
                            </div>
                            <div class="data-row empty" data-field="priloha-eia">
                                <div class="data-label">Závěr zjišťovacího řízení EIA</div>
                                <div class="data-value muted">Nevyžaduje se</div>
                                <button class="data-status na" disabled title="Neaplikuje se">
                                    <span class="material-icons-outlined">remove</span>
                                </button>
                            </div>
                            <div class="data-row empty" data-field="priloha-vyjimka">
                                <div class="data-label">Specifikace výjimek z požadavků</div>
                                <div class="data-value muted">Nevyžaduje se</div>
                                <button class="data-status na" disabled title="Neaplikuje se">
                                    <span class="material-icons-outlined">remove</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Poznámka k vadám -->
                    <div class="deficiency-note-section" id="zadostDeficiencySection" style="display: none;">
                        <div class="control-section-title">
                            <span class="material-icons-outlined" style="font-size: 18px; vertical-align: middle; color: #ea4335;">warning</span>
                            Poznámka k označeným vadám
                        </div>
                        <textarea class="deficiency-note-input" id="zadostDeficiencyNote" placeholder="Popište zjištěné vady pro výzvu k doplnění..."></textarea>
                    </div>

                    <!-- Result preview -->
                    <div class="result-preview positive" id="resultZadost">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Údaje v žádosti jsou v pořádku
                        </div>
                        <div class="result-preview-text">Všechny údaje byly zkontrolovány a jsou smysluplné.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveZadost">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlZadost')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('zadost')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmZadost" onclick="completeZadost()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Pozemky a sousedé -->
    <div class="control-overlay" id="controlPozemky">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlPozemky')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">terrain</span>
                    Pozemky a sousedé
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchPozemkyTab(this, 'zadost')">
                        <span class="material-icons-outlined">description</span>
                        Žádost
                    </button>
                    <button class="viewer-tab" onclick="switchPozemkyTab(this, 'situace')">
                        <span class="material-icons-outlined">architecture</span>
                        Situační výkresy
                    </button>
                    <button class="viewer-tab" onclick="switchPozemkyTab(this, 'kn')">
                        <span class="material-icons-outlined">terrain</span>
                        Katastr
                    </button>
                    <button class="viewer-tab" onclick="switchPozemkyTab(this, 'mapa')">
                        <span class="material-icons-outlined">map</span>
                        Mapa
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-pozemky">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">Pozemky uvedené stavebníkem v žádosti</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Pozemky záměru - ze žádosti -->
                    <div class="pozemky-section">
                        <div class="pozemky-section-header">
                            <div class="pozemky-section-title">
                                <span class="material-icons-outlined">location_on</span>
                                Pozemky záměru
                            </div>
                            <span class="pozemky-section-badge">Ze žádosti</span>
                        </div>
                        <div id="pozemkyZameruList">
                            <div class="parcel-chip-extended" data-parcel="st142">
                                <div class="parcel-chip-extended-header">
                                    <div class="parcel-chip-icon">
                                        <span class="material-icons-outlined">crop_square</span>
                                    </div>
                                    <div class="parcel-chip-extended-info">
                                        <div class="parcel-chip-extended-number">st. 142</div>
                                        <div class="parcel-chip-extended-katastr">k.ú. Radonice [747076] • 560 m²</div>
                                    </div>
                                </div>
                                <div class="parcel-chip-extended-owner" id="ownerSt142" style="display: none;">
                                    <strong>Vlastník:</strong> <span id="ownerNameSt142">—</span>
                                </div>
                            </div>
                            <div class="parcel-chip-extended" data-parcel="248-3">
                                <div class="parcel-chip-extended-header">
                                    <div class="parcel-chip-icon">
                                        <span class="material-icons-outlined">grass</span>
                                    </div>
                                    <div class="parcel-chip-extended-info">
                                        <div class="parcel-chip-extended-number">p.č. 248/3</div>
                                        <div class="parcel-chip-extended-katastr">k.ú. Radonice [747076] • 1 240 m²</div>
                                    </div>
                                </div>
                                <div class="parcel-chip-extended-owner" id="owner248-3" style="display: none;">
                                    <strong>Vlastník:</strong> <span id="ownerName248-3">—</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sousední pozemky -->
                    <div class="pozemky-section">
                        <div class="pozemky-section-header">
                            <div class="pozemky-section-title">
                                <span class="material-icons-outlined">grid_view</span>
                                Sousední pozemky
                            </div>
                            <span class="pozemky-section-badge" id="sousedniCount">0 parcel</span>
                        </div>

                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Vyberte metodu identifikace sousedních pozemků:
                        </p>

                        <!-- Metoda výběru -->
                        <div class="neighbor-method-selector">
                            <button class="neighbor-method-btn active" onclick="selectNeighborMethod('auto')" data-method="auto">
                                <span class="material-icons-outlined">auto_awesome</span>
                                <span>Automaticky</span>
                            </button>
                            <button class="neighbor-method-btn" onclick="selectNeighborMethod('manual')" data-method="manual">
                                <span class="material-icons-outlined">touch_app</span>
                                <span>Ručně z mapy</span>
                            </button>
                            <button class="neighbor-method-btn" onclick="selectNeighborMethod('polygon')" data-method="polygon">
                                <span class="material-icons-outlined">hexagon</span>
                                <span>Ochranné pásmo</span>
                            </button>
                        </div>

                        <!-- Auto metoda -->
                        <div class="neighbor-method-content" id="methodAuto">
                            <button class="btn-autodetect" onclick="autoDetectSousedni()" id="btnAutoDetect">
                                <span class="material-icons-outlined">auto_awesome</span>
                                Automaticky identifikovat sousedy
                            </button>
                        </div>

                        <!-- Ruční metoda -->
                        <div class="neighbor-method-content" id="methodManual" style="display: none;">
                            <div class="parcels-search-row">
                                <input type="text" class="parcels-search-input" placeholder="Zadejte č. parcely nebo vyberte z mapy..." id="sousedniSearchInput">
                                <button class="btn-search" onclick="searchSousedni()">
                                    <span class="material-icons-outlined">search</span>
                                </button>
                                <button class="btn-map" onclick="openMapForSousedni()">
                                    <span class="material-icons-outlined">map</span>
                                </button>
                            </div>
                        </div>

                        <!-- Polygon metoda -->
                        <div class="polygon-input-section" id="methodPolygon">
                            <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                                Zadejte vzdálenost ochranného pásma od hranice pozemků záměru. Všechny pozemky v tomto pásmu budou označeny jako sousední.
                            </p>
                            <div class="polygon-input-row">
                                <span class="polygon-input-label">Ochranné pásmo:</span>
                                <input type="number" class="polygon-input" id="polygonDistance" value="50" min="1" max="500">
                                <span class="polygon-input-unit">metrů</span>
                                <button class="btn-generate-polygon" onclick="generatePolygonNeighbors()">
                                    <span class="material-icons-outlined">hexagon</span>
                                    Vygenerovat
                                </button>
                            </div>
                        </div>

                        <!-- Seznam sousedních parcel -->
                        <div class="sousedni-list" id="sousedniList">
                            <div class="sousedni-empty" id="sousedniEmpty">
                                <span class="material-icons-outlined">grid_view</span>
                                <div class="sousedni-empty-text">Zatím nejsou identifikovány žádné sousední pozemky</div>
                                <div class="sousedni-empty-hint">Použijte některou z metod výše</div>
                            </div>
                        </div>
                    </div>

                    <div class="result-preview positive" id="resultPozemky">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Pozemky identifikovány
                        </div>
                        <div class="result-preview-text">Pozemky záměru a sousední pozemky byly identifikovány. Vlastníci budou určeni v části Účastníci řízení.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSavePozemky">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlPozemky')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('pozemky')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmPozemky" onclick="completePozemky()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="control-overlay" id="controlDokumentace">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlDokumentace')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">architecture</span>
                    Kontrola dokumentace
                </div>
            </div>
        </div>
        <div class="control-body">
            <!-- Levý panel - prohlížeč struktury dokumentace -->
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchDocViewerTab(this, 'struktura')">
                        <span class="material-icons-outlined">folder</span>
                        Struktura ED
                    </button>
                    <button class="viewer-tab" onclick="switchDocViewerTab(this, 'nahled')">
                        <span class="material-icons-outlined">description</span>
                        Náhled dokumentu
                    </button>
                </div>
                <div class="viewer-content" style="background: #fff;">
                    <!-- Struktura ED -->
                    <div class="ed-tree-container" id="edTreeContainer" style="padding: 16px;">
                        <div class="ed-tree" id="edTree">
                            <div class="ed-tree-header">
                                <div class="ed-tree-header-top">
                                    <span class="material-icons-outlined">folder_special</span>
                                    <strong>SR00X01I35GT</strong>
                                    <span style="color: #5f6368; font-size: 12px; margin-left: 8px;">Novostavba RD včetně přípojek</span>
                                </div>
                                <div class="ed-version-selector">
                                    <label style="font-size: 11px; color: #5f6368; margin-right: 6px;">Verze:</label>
                                    <select class="ed-version-select" id="edVersionSelect" onchange="changeEdVersion()">
                                        <option value="v3" selected>v3 (aktuální) — 10. 1. 2026</option>
                                        <option value="v2">v2 — 18. 12. 2025</option>
                                        <option value="v1">v1 — 2. 12. 2025</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- A. Průvodní zpráva -->
                            <div class="ed-folder" data-section="A">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">A. Průvodní zpráva</span>
                                    <span class="folder-count">1 soubor</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('A.1 Průvodní zpráva.pdf', 'A')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">A.1 Průvodní zpráva.pdf</span>
                                        <span class="file-size">245 kB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- B. Souhrnná technická zpráva -->
                            <div class="ed-folder" data-section="B">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">B. Souhrnná technická zpráva</span>
                                    <span class="folder-count">1 soubor</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('B.1 Souhrnná technická zpráva.pdf', 'B')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">B.1 Souhrnná technická zpráva.pdf</span>
                                        <span class="file-size">1.2 MB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- C. Situační výkresy -->
                            <div class="ed-folder" data-section="C">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">C. Situační výkresy</span>
                                    <span class="folder-count">4 soubory</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('C.1 Situační výkres širších vztahů.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.1 Situační výkres širších vztahů.pdf</span>
                                        <span class="file-size">890 kB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.2 Katastrální situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.2 Katastrální situační výkres.pdf</span>
                                        <span class="file-size">1.1 MB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.3 Koordinační situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.3 Koordinační situační výkres.pdf</span>
                                        <span class="file-size">1.4 MB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.4 Speciální situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.4 Speciální situační výkres.pdf</span>
                                        <span class="file-size">780 kB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- D. Dokumentace objektů -->
                            <div class="ed-folder" data-section="D">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">D. Dokumentace objektů</span>
                                    <span class="folder-count">4 podsložky</span>
                                </div>
                                <div class="ed-folder-content">
                                    <!-- D.1 Dokumentace stavebního objektu -->
                                    <div class="ed-folder nested">
                                        <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                            <span class="material-icons-outlined folder-icon">folder</span>
                                            <span class="folder-name">D.1 Dokumentace stavebního objektu</span>
                                            <span class="folder-count">4 podsložky</span>
                                        </div>
                                        <div class="ed-folder-content">
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.1 Architektonicko-stavební řešení</span>
                                                    <span class="folder-count">12 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.1.01 Technická zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.1.01 Technická zpráva.pdf</span>
                                                        <span class="file-size">520 kB</span>
                                                    </div>
                                                    <div class="ed-file" onclick="previewEdFile('D.1.1.02 Půdorys 1.NP.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.1.02 Půdorys 1.NP.pdf</span>
                                                        <span class="file-size">1.8 MB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 10 souborů</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.2 Stavebně konstrukční řešení</span>
                                                    <span class="folder-count">8 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.2.01 Technická zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.2.01 Technická zpráva.pdf</span>
                                                        <span class="file-size">340 kB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 7 souborů</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.3 Požárně bezpečnostní řešení</span>
                                                    <span class="folder-count">3 soubory</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.3.01 Požární zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.3.01 Požární zpráva.pdf</span>
                                                        <span class="file-size">890 kB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ další 2 soubory</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.4 Technika prostředí staveb</span>
                                                    <span class="folder-count">6 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.4.01 Zdravotně technické instalace.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.4.01 Zdravotně technické instalace.pdf</span>
                                                        <span class="file-size">1.2 MB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 5 souborů</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- D.2 Dokumentace technických a technologických zařízení -->
                                    <div class="ed-folder nested empty">
                                        <div class="ed-folder-header">
                                            <span class="material-icons-outlined folder-icon" style="color: #9aa0a6;">folder_off</span>
                                            <span class="folder-name" style="color: #9aa0a6;">D.2 Dokumentace tech. a technol. zařízení</span>
                                            <span class="folder-count" style="color: #9aa0a6;">prázdné</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Náhled dokumentu -->
                    <div class="ed-preview-container" id="edPreviewContainer" style="display: none; padding: 16px; height: 100%;">
                        <div id="edPreviewContent" style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 8px; padding: 40px;">
                            <span class="material-icons-outlined" style="font-size: 64px; color: #9aa0a6; margin-bottom: 16px;">description</span>
                            <div style="font-size: 14px; color: #5f6368;">Vyberte dokument ze struktury</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pravý panel - kontrolní formulář -->
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Automatická kontrola -->
                    <div class="auto-check-section">
                        <div class="auto-check-header">
                            <div class="auto-check-title">
                                <span class="material-icons-outlined">auto_awesome</span>
                                Automatická kontrola
                            </div>
                            <button class="btn-run-check" id="btnRunAutoCheck" onclick="runDocAutoCheck()">
                                <span class="material-icons-outlined">play_arrow</span>
                                Spustit kontrolu
                            </button>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 0; font-style: normal;" id="autoCheckDesc">
                            Automaticky zkontroluje elektronické podpisy, časová razítka a formát PDF/A.
                        </p>
                        <div class="auto-check-results" id="autoCheckResults">
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconFormat">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Formát PDF/A</div>
                                    <div class="check-result-detail" id="checkDetailFormat">Všechny dokumenty jsou ve správném formátu</div>
                                </div>
                            </div>
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconSignature">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Elektronické podpisy</div>
                                    <div class="check-result-detail" id="checkDetailSignature">Všechny dokumenty jsou platně podepsány</div>
                                </div>
                            </div>
                            <div class="check-result-item">
                                <div class="check-result-icon warning" id="checkIconTimestamp">
                                    <span class="material-icons-outlined">warning</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Časová razítka</div>
                                    <div class="check-result-detail" id="checkDetailTimestamp">1 dokument nemá časové razítko</div>
                                </div>
                                <span class="check-result-action" onclick="addIssueFromAutoCheck('Chybí časové razítko u dokumentu D.1.1.02 Půdorys 1.NP.pdf')">+ Přidat</span>
                            </div>
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconAuth">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Autorizační razítko</div>
                                    <div class="check-result-detail" id="checkDetailAuth">Projektant má platnou autorizaci ČKAIT</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Kontrola přítomnosti částí dokumentace -->
                    <div class="doc-check-section">
                        <div class="doc-check-header">
                            <div class="doc-check-title">
                                <span class="material-icons-outlined">checklist</span>
                                Přítomnost částí dokumentace
                            </div>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px; font-style: normal;">
                            Ověřte, že dokumentace obsahuje všechny požadované části. Prohlédněte strukturu vlevo.
                        </p>
                        
                        <div class="doc-parts-list" id="docPartsList">
                            <!-- A. Průvodní zpráva -->
                            <div class="doc-part-item" data-part="A">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">A</span>
                                    <span class="doc-part-name">Průvodní zpráva</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('A', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn warning" onclick="setDocPartStatus('A', 'warning')" title="Neúplné">
                                        <span class="material-icons-outlined">warning</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('A', 'error')" title="Chyby">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- B. Souhrnná technická zpráva -->
                            <div class="doc-part-item" data-part="B">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">B</span>
                                    <span class="doc-part-name">Souhrnná technická zpráva</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('B', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn warning" onclick="setDocPartStatus('B', 'warning')" title="Neúplné">
                                        <span class="material-icons-outlined">warning</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('B', 'error')" title="Chyby">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- C. Situační výkresy -->
                            <div class="doc-part-item" data-part="C">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">C</span>
                                    <span class="doc-part-name">Situační výkresy</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('C', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn warning" onclick="setDocPartStatus('C', 'warning')" title="Neúplné">
                                        <span class="material-icons-outlined">warning</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('C', 'error')" title="Chyby">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- D. Dokumentace objektů -->
                            <div class="doc-part-item" data-part="D">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">D</span>
                                    <span class="doc-part-name">Dokumentace objektů</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('D', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn warning" onclick="setDocPartStatus('D', 'warning')" title="Neúplné">
                                        <span class="material-icons-outlined">warning</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('D', 'error')" title="Chyby">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seznam nedostatků -->
                    <div class="issues-section" id="issuesSection">
                        <div class="issues-header">
                            <div class="issues-title">
                                <span class="material-icons-outlined">report_problem</span>
                                Seznam nedostatků
                            </div>
                            <span class="issues-count" id="issuesCount">0</span>
                        </div>
                        <div class="issues-list" id="issuesList">
                            <!-- Nedostatky se přidávají dynamicky -->
                        </div>
                        <div class="add-issue-section">
                            <div class="add-issue-type-toggle">
                                <button class="issue-type-btn active" onclick="toggleIssueInputType('short')" id="btnIssueShort">
                                    <span class="material-icons-outlined">short_text</span>
                                    Krátký text
                                </button>
                                <button class="issue-type-btn" onclick="toggleIssueInputType('long')" id="btnIssueLong">
                                    <span class="material-icons-outlined">notes</span>
                                    Dlouhý text
                                </button>
                            </div>
                            <div class="add-issue-row" id="issueInputShort">
                                <input type="text" class="add-issue-input" id="addIssueText" placeholder="Popište nedostatek..." onkeypress="if(event.key==='Enter') addIssue()">
                                <button class="btn-add-issue" onclick="addIssue()">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat
                                </button>
                            </div>
                            <div class="add-issue-textarea-row" id="issueInputLong" style="display: none;">
                                <textarea class="add-issue-textarea" id="addIssueTextLong" placeholder="Popište nedostatek podrobněji..." rows="4"></textarea>
                                <button class="btn-add-issue-full" onclick="addIssueLong()">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="result-preview neutral" id="resultDokumentace">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">info</span>
                            Kontrola nebyla dokončena
                        </div>
                        <div class="result-preview-text">Zkontrolujte všechny části dokumentace kliknutím na zaškrtávátko.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveDokumentace">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlDokumentace')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('dokumentace')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmDokumentace" onclick="completeDokumentace()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Kontrola: Identifikace DO a správců TDI -->
    <div class="control-overlay" id="controlIdentifikace">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlIdentifikace')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">hub</span>
                    Identifikace DO a správců TDI
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchViewerTab(this, 'identifikace', 'eed')">
                        <span class="material-icons-outlined">folder</span>
                        El. dokumentace
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'identifikace', 'zadost')">
                        <span class="material-icons-outlined">description</span>
                        Žádost
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-identifikace">
                        <span class="material-icons-outlined">architecture</span>
                        <div class="viewer-placeholder-title">Elektronická dokumentace</div>
                        <div class="viewer-placeholder-text">Situační výkresy a technické zprávy pro identifikaci dotčené infrastruktury</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <p style="font-size: 13px; color: #5f6368; margin-bottom: 20px; font-style: normal;">
                        Na základě dokumentace identifikujte všechny dotčené orgány a správce technické a dopravní infrastruktury, 
                        od kterých je třeba získat stanoviska nebo vyjádření.
                    </p>
                    
                    <div class="control-section">
                        <div class="control-section-title">Dotčené orgány (DO)</div>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" checked>
                                <span class="checklist-label">Hasičský záchranný sbor</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" checked>
                                <span class="checklist-label">Krajská hygienická stanice</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" checked>
                                <span class="checklist-label">Odbor životního prostředí</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox">
                                <span class="checklist-label">Památková péče</span>
                                <span class="checklist-note">(neaplikuje se)</span>
                            </label>
                        </div>
                    </div>

                    <div class="control-section">
                        <div class="control-section-title">Správci technické infrastruktury (TDI)</div>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" checked>
                                <span class="checklist-label">ČEZ Distribuce (elektřina)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" checked>
                                <span class="checklist-label">GasNet (plyn)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" checked>
                                <span class="checklist-label">Vodovody a kanalizace (VaK)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox" checked>
                                <span class="checklist-label">CETIN (telekomunikace)</span>
                            </label>
                        </div>
                    </div>

                    <div class="control-section">
                        <div class="control-section-title">Správci dopravní infrastruktury</div>
                        <div class="checklist-items">
                            <label class="checklist-item">
                                <input type="checkbox" checked>
                                <span class="checklist-label">Správa silnic (místní komunikace)</span>
                            </label>
                            <label class="checklist-item">
                                <input type="checkbox">
                                <span class="checklist-label">SŽDC (dráhy)</span>
                                <span class="checklist-note">(neaplikuje se)</span>
                            </label>
                        </div>
                    </div>

                    <div class="result-preview positive" id="resultIdentifikace">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Subjekty identifikovány
                        </div>
                        <div class="result-preview-text">Identifikováno 3 DO a 5 správců infrastruktury. Seznam bude použit pro kontrolu dokladové části.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveIdentifikace">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlIdentifikace')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('identifikace')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeIdentifikace()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Dokladová část -->
    <div class="control-overlay" id="controlDoklady">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlDoklady')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">fact_check</span>
                    Kontrola dokladové části
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchViewerTab(this, 'doklady', 'dokladova')">
                        <span class="material-icons-outlined">fact_check</span>
                        Dokladová část
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-doklady">
                        <span class="material-icons-outlined">checklist</span>
                        <div class="viewer-placeholder-title">Dokladová část</div>
                        <div class="viewer-placeholder-text">Stanoviska DO a vyjádření správců sítí</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <p style="font-size: 13px; color: #5f6368; margin-bottom: 20px; font-style: normal;">
                        Zkontrolujte existenci a obsah vyjádření a stanovisek od subjektů identifikovaných v předchozím kroku 
                        (3 DO, 5 správců infrastruktury).
                    </p>
                    
                    <div class="control-section">
                        <div class="control-section-title">Vyjádření správců sítí</div>
                        <label class="control-option selected" onclick="selectOption(this); updateDokladyResult()">
                            <input type="radio" name="vyjadreni_ss" value="kompletni" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">Všechna vyjádření jsou k dispozici</div>
                                <div class="control-option-desc">Vyjádření od všech 5 správců infrastruktury</div>
                            </div>
                        </label>
                        <label class="control-option" onclick="selectOption(this, true); updateDokladyResult()">
                            <input type="radio" name="vyjadreni_ss" value="chybi">
                            <div class="control-option-content">
                                <div class="control-option-label">Chybí vyjádření správců sítí</div>
                                <div class="control-option-desc">Výzva k doplnění + přerušení řízení</div>
                            </div>
                        </label>
                    </div>

                    <div class="control-section">
                        <div class="control-section-title">Stanoviska dotčených orgánů</div>
                        <label class="control-option selected" onclick="selectOption(this); updateDokladyResult()">
                            <input type="radio" name="stanoviska_do" value="kompletni" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">Všechna stanoviska jsou k dispozici a kladná</div>
                                <div class="control-option-desc">Stanoviska od všech 3 dotčených orgánů</div>
                            </div>
                        </label>
                        <label class="control-option" onclick="selectOption(this, true); updateDokladyResult()">
                            <input type="radio" name="stanoviska_do" value="chybi">
                            <div class="control-option-content">
                                <div class="control-option-label">Chybí stanovisko DO</div>
                                <div class="control-option-desc">SÚ si stanovisko vyžádá (běží lhůta 30 dnů)</div>
                            </div>
                        </label>
                        <label class="control-option" onclick="selectOption(this, true); updateDokladyResult()">
                            <input type="radio" name="stanoviska_do" value="zaporne">
                            <div class="control-option-content">
                                <div class="control-option-label">Stanovisko DO je záporné</div>
                                <div class="control-option-desc">Řízení bude zastaveno</div>
                            </div>
                        </label>
                    </div>

                    <div class="result-preview positive" id="resultDoklady">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Dokladová část v pořádku
                        </div>
                        <div class="result-preview-text">Všechna vyjádření a stanoviska jsou k dispozici.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveDoklady">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlDoklady')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('doklady')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeDoklady()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Územní plán -->
    <div class="control-overlay" id="controlUP">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlUP')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">map</span>
                    Kontrola souladu s územním plánem
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchViewerTab(this, 'up', 'eed')">
                        <span class="material-icons-outlined">folder</span>
                        El. dokumentace
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'up', 'uplan')">
                        <span class="material-icons-outlined">map</span>
                        Územní plán
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-up">
                        <span class="material-icons-outlined">architecture</span>
                        <div class="viewer-placeholder-title">Elektronická dokumentace</div>
                        <div class="viewer-placeholder-text">Projektová dokumentace pro ověření souladu s ÚP</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Existence územního plánu -->
                    <div class="control-section">
                        <div class="control-section-title">Existence územního plánu</div>
                        <div class="control-option" onclick="this.querySelector('input').checked = true; updateUPExistence()">
                            <input type="radio" name="up_existence" value="existuje" checked>
                            <div class="control-option-content">
                                <div class="control-option-title">Územní plán existuje</div>
                                <div class="control-option-desc">Obec má platný územní plán, záměr bude posouzen podle jeho regulativů.</div>
                            </div>
                        </div>
                        <div class="control-option" onclick="this.querySelector('input').checked = true; updateUPExistence()">
                            <input type="radio" name="up_existence" value="neexistuje">
                            <div class="control-option-content">
                                <div class="control-option-title">Územní plán neexistuje</div>
                                <div class="control-option-desc">Obec nemá územní plán. Zastavěným územím je intravilán (§ 325 SZ). Záměr bude posouzen podle § 193 odst. 1 písm. b).</div>
                            </div>
                        </div>
                    </div>

                    <!-- Info box pro případ neexistence ÚP -->
                    <div class="info-box warning" id="upNeexistujeInfo" style="display: none; margin-bottom: 20px;">
                        <div class="info-box-icon">
                            <span class="material-icons-outlined">info</span>
                        </div>
                        <div class="info-box-content">
                            <div class="info-box-title">Postup při neexistenci územního plánu</div>
                            <div class="info-box-text">
                                <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 12px; color: #5f6368;">
                                    <li>Za zastavěné území se považuje <strong>intravilán</strong> (§ 325 odst. 2 SZ)</li>
                                    <li>Záměr se posoudí podle <strong>§ 193 odst. 1 písm. b)</strong> - soulad s cíli a úkoly územního plánování, charakterem území</li>
                                    <li><strong>Zrychlené řízení nelze použít</strong> - podmínkou je existence ÚP (§ 212)</li>
                                    <li>V nezastavěném území omezené možnosti výstavby, nutný souhlas zastupitelstva obce</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- AI kontrola souladu -->
                    <div class="ai-control-section" id="aiControlSection">
                        <div class="ai-control-header">
                            <span class="material-icons-outlined">auto_awesome</span>
                            <span>Automatická kontrola souladu</span>
                        </div>
                        <p style="font-size: 13px; color: #5f6368; margin-bottom: 16px; font-style: normal;">
                            AI porovná projektovou dokumentaci s územním plánem a vytvoří compliance report.
                        </p>
                        <button class="btn btn-ai" id="btnAiKontrola" onclick="runAiCompliance()">
                            <span class="material-icons-outlined">auto_awesome</span>
                            Spustit AI kontrolu souladu
                        </button>
                    </div>

                    <!-- AI výsledek - skrytý dokud se nespustí -->
                    <div class="ai-result-section" id="aiResultSection" style="display: none;">
                        <div class="ai-result-header">
                            <span class="material-icons-outlined">auto_awesome</span>
                            <span>Výsledek AI kontroly</span>
                            <span class="ai-result-badge success">Dokončeno</span>
                        </div>
                        
                        <div class="ai-report-link" onclick="showComplianceReport()">
                            <span class="material-icons-outlined">description</span>
                            <div class="ai-report-link-content">
                                <div class="ai-report-link-title">Compliance report</div>
                                <div class="ai-report-link-meta">Vygenerováno 14. 1. 2026, 10:32</div>
                            </div>
                            <span class="material-icons-outlined">open_in_new</span>
                        </div>

                        <div class="ai-summary">
                            <div class="ai-summary-item success">
                                <span class="material-icons-outlined">check_circle</span>
                                <span>8 položek v souladu</span>
                            </div>
                            <div class="ai-summary-item warning">
                                <span class="material-icons-outlined">warning</span>
                                <span>1 položka k ověření</span>
                            </div>
                            <div class="ai-summary-item error">
                                <span class="material-icons-outlined">cancel</span>
                                <span>0 rozporů</span>
                            </div>
                        </div>
                    </div>

                    <!-- AI report detail - skrytý -->
                    <div class="ai-report-detail" id="aiReportDetail" style="display: none;">
                        <div class="ai-report-detail-header">
                            <span class="ai-report-detail-title">Compliance report</span>
                            <button class="ai-report-close" onclick="hideComplianceReport()">
                                <span class="material-icons-outlined">close</span>
                            </button>
                        </div>
                        
                        <div class="ai-report-content">
                            <div class="ai-report-group">
                                <div class="ai-report-group-title success">
                                    <span class="material-icons-outlined">check_circle</span>
                                    V souladu s ÚP
                                </div>
                                
                                <div class="ai-report-item">
                                    <div class="ai-report-item-title">Funkční využití pozemku</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                    <div class="ai-report-item-detail">
                                        <div class="ai-report-source">
                                            <span class="source-label">Dokumentace:</span>
                                            <span class="source-path">A. Průvodní zpráva → A.1 Identifikační údaje → účel stavby</span>
                                        </div>
                                        <div class="ai-report-source">
                                            <span class="source-label">Územní plán:</span>
                                            <span class="source-path">Výkres č. 1 Základní členění → plocha BI (bydlení individuální)</span>
                                        </div>
                                        <div class="ai-report-note">Rodinný dům je přípustné využití v ploše BI.</div>
                                    </div>
                                </div>

                                <div class="ai-report-item">
                                    <div class="ai-report-item-title">Koeficient zastavění</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                    <div class="ai-report-item-detail">
                                        <div class="ai-report-source">
                                            <span class="source-label">Dokumentace:</span>
                                            <span class="source-path">C. Situační výkresy → C.2 Zastavovací plán → zastavěná plocha 156 m²</span>
                                        </div>
                                        <div class="ai-report-source">
                                            <span class="source-label">Územní plán:</span>
                                            <span class="source-path">Regulativy → BI-3 → max. koeficient zastavění 0,35</span>
                                        </div>
                                        <div class="ai-report-note">Skutečný koeficient 0,28 (156/560 m²) ≤ povolených 0,35.</div>
                                    </div>
                                </div>

                                <div class="ai-report-item">
                                    <div class="ai-report-item-title">Výška stavby</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                    <div class="ai-report-item-detail">
                                        <div class="ai-report-source">
                                            <span class="source-label">Dokumentace:</span>
                                            <span class="source-path">D. Dokumentace objektů → D.1.1 Architektonické řešení → výška 7,2 m</span>
                                        </div>
                                        <div class="ai-report-source">
                                            <span class="source-label">Územní plán:</span>
                                            <span class="source-path">Regulativy → BI-3 → max. výška 9,0 m</span>
                                        </div>
                                        <div class="ai-report-note">Výška 7,2 m ≤ povolených 9,0 m.</div>
                                    </div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Odstupové vzdálenosti</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Počet podlaží</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Tvar střechy</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Napojení na komunikaci</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>

                                <div class="ai-report-item collapsed">
                                    <div class="ai-report-item-title">Parkování na pozemku</div>
                                    <div class="ai-report-item-result success">Soulad</div>
                                </div>
                            </div>

                            <div class="ai-report-group">
                                <div class="ai-report-group-title warning">
                                    <span class="material-icons-outlined">warning</span>
                                    K ověření
                                </div>
                                
                                <div class="ai-report-item">
                                    <div class="ai-report-item-title">Ochranné pásmo lesa</div>
                                    <div class="ai-report-item-result warning">K ověření</div>
                                    <div class="ai-report-item-detail">
                                        <div class="ai-report-source">
                                            <span class="source-label">Dokumentace:</span>
                                            <span class="source-path">C. Situační výkresy → C.3 Koordinační situace → vzdálenost od okraje lesa</span>
                                        </div>
                                        <div class="ai-report-source">
                                            <span class="source-label">Územní plán:</span>
                                            <span class="source-path">Výkres č. 3 Limity využití → ochranné pásmo 50 m od okraje lesa</span>
                                        </div>
                                        <div class="ai-report-note warning">
                                            <span class="material-icons-outlined">info</span>
                                            Stavba se nachází cca 48 m od okraje lesa. AI nedokázala přesně určit vzdálenost z dokumentace. 
                                            Doporučujeme manuální ověření nebo vyžádání stanoviska orgánu státní správy lesů.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="control-section" id="upVysledekSection">
                        <div class="control-section-title">Výsledek kontroly souladu s ÚP</div>
                        <label class="control-option selected" onclick="selectOption(this); updateUPResult()">
                            <input type="radio" name="up_vysledek" value="soulad" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr je v souladu s územním plánem</div>
                            </div>
                        </label>
                        <label class="control-option" onclick="selectOption(this, true); updateUPResult()">
                            <input type="radio" name="up_vysledek" value="nesoulad">
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr není v souladu s územním plánem</div>
                                <div class="control-option-desc">Žádost bude zamítnuta</div>
                            </div>
                        </label>
                    </div>

                    <div class="result-preview positive" id="resultUP">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Záměr je v souladu s ÚP
                        </div>
                        <div class="result-preview-text">Záměr je v souladu s platným územním plánem.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveUP">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlUP')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('up')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeUP()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Účastníci řízení -->
    <div class="control-overlay" id="controlUcastnici">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlUcastnici')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">groups</span>
                    Účastníci řízení
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchViewerTab(this, 'ucastnici', 'zadost')">
                        <span class="material-icons-outlined">description</span>
                        Žádost
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'ucastnici', 'prilohy')">
                        <span class="material-icons-outlined">attach_file</span>
                        Přílohy
                        <span class="badge">12</span>
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'ucastnici', 'kn')">
                        <span class="material-icons-outlined">terrain</span>
                        Katastr nemovitostí
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-ucastnici">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">Údaje o stavebníkovi a dalších osobách ze žádosti</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <div class="control-section">
                        <div class="control-section-title">Stav účastníků řízení</div>
                        <p style="font-size: 13px; color: #5f6368; margin-bottom: 16px; font-style: normal;">
                            V ostré verzi by zde bylo rozhraní pro správu účastníků řízení 
                            podle skupin (stavebník, vlastníci, sousedé, DO, další osoby).
                        </p>
                        <label class="control-option selected" onclick="selectOption(this)">
                            <input type="radio" name="ucastnici_stav" value="komplet" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">Seznam účastníků je kompletní</div>
                                <div class="control-option-desc">Všichni účastníci jsou zadáni a ověřeni</div>
                            </div>
                        </label>
                    </div>

                    <div class="result-preview positive" id="resultUcastnici">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Účastníci definováni
                        </div>
                        <div class="result-preview-text">Seznam účastníků řízení je kompletní.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveUcastnici">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlUcastnici')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('ucastnici')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeUcastnici()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Zrychlené řízení -->
    <div class="control-overlay" id="controlZrychlene">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlZrychlene')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">bolt</span>
                    Podmínky zrychleného řízení
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <button class="viewer-tab active" onclick="switchViewerTab(this, 'zrychlene', 'zadost')">
                        <span class="material-icons-outlined">description</span>
                        Žádost
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'prilohy')">
                        <span class="material-icons-outlined">attach_file</span>
                        Přílohy
                        <span class="badge">12</span>
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'eed')">
                        <span class="material-icons-outlined">folder</span>
                        El. dokumentace
                    </button>
                    <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'doklady')">
                        <span class="material-icons-outlined">fact_check</span>
                        Dokladová část
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-zrychlene">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">Souhrnná kontrola podmínek pro zrychlené řízení</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <div class="control-section">
                        <div class="control-section-title">Podmínky podle § 212 stavebního zákona</div>
                        <p style="font-size: 13px; color: #5f6368; margin-bottom: 16px; font-style: normal;">
                            Ověřte splnění všech podmínek pro zrychlené řízení:
                        </p>
                        
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_uplnost" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Žádost je úplná</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_eia" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr nevyžaduje posouzení vlivů na ŽP</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_up" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr je v souladu s ÚP</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_stanoviska" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Stanoviska DO jsou kladná nebo s podmínkami</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_souhlasy" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Souhlasy účastníků jsou přiloženy</div>
                            </div>
                        </label>
                    </div>

                    <div class="result-preview positive" id="resultZrychlene">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Podmínky splněny
                        </div>
                        <div class="result-preview-text">Všechny podmínky pro zrychlené řízení jsou splněny.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveZrychlene">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlZrychlene')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('zrychlene')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeZrychlene()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- POMOCNÉ MODÁLY PRO NÁHLED DOKUMENTŮ -->
    <!-- ============================================ -->
    <div class="modal-overlay" id="zadostModal" onclick="closeModal('zadostModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">description</span>
                    Žádost o povolení stavby
                </div>
                <button class="modal-close" onclick="closeModal('zadostModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">preview</span>
                    <p style="margin-top: 16px; color: #5f6368;">Náhled žádosti o povolení stavby</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('zadostModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="prilohyModal" onclick="closeModal('prilohyModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">attach_file</span>
                    Přílohy žádosti
                </div>
                <button class="modal-close" onclick="closeModal('prilohyModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">folder_open</span>
                    <p style="margin-top: 16px; color: #5f6368;">Seznam příloh žádosti (12)</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('prilohyModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="eedModal" onclick="closeModal('eedModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">folder</span>
                    Elektronická dokumentace
                </div>
                <button class="modal-close" onclick="closeModal('eedModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">architecture</span>
                    <p style="margin-top: 16px; color: #5f6368;">Projektová dokumentace v EED</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('eedModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="dokladyModal" onclick="closeModal('dokladyModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">fact_check</span>
                    Dokladová část
                </div>
                <button class="modal-close" onclick="closeModal('dokladyModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">checklist</span>
                    <p style="margin-top: 16px; color: #5f6368;">Stanoviska DO a vyjádření správců sítí</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('dokladyModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <script>
        // State management
        const controls = {
            prislusnost: { done: false, depends: [], result: 'ok' },
            zadost: { done: false, depends: ['prislusnost'], result: 'ok' },
            dokumentace: { done: false, depends: ['prislusnost', 'zadost'], result: 'ok' },
            pozemky: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace'], result: 'ok' },
            up: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace', 'pozemky'], result: 'ok' },
            identifikace: { done: false, depends: ['pozemky'], result: 'ok' },
            doklady: { done: false, depends: ['identifikace'], result: 'ok' },
            ucastnici: { done: false, depends: ['pozemky'], result: 'ok' },
            zrychlene: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace', 'pozemky', 'up', 'identifikace', 'doklady', 'ucastnici'], result: 'ok' }
        };

        // Control overlay functions
        function openControl(controlId) {
            document.getElementById(controlId).classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeControl(controlId) {
            document.getElementById(controlId).classList.remove('open');
            document.body.style.overflow = '';
        }

        // Modal functions (pro náhled dokumentů z headeru)
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId, event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById(modalId).classList.remove('open');
            document.body.style.overflow = '';
        }

        // Escape key closes overlays
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.control-overlay.open').forEach(function(overlay) {
                    overlay.classList.remove('open');
                });
                document.querySelectorAll('.modal-overlay.open').forEach(function(modal) {
                    modal.classList.remove('open');
                });
                document.body.style.overflow = '';
            }
        });

        // Viewer tab switching
        function switchViewerTab(button, controlType, docType) {
            // Update active tab
            const tabs = button.parentElement.querySelectorAll('.viewer-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            button.classList.add('active');

            // Update viewer content
            const viewer = document.getElementById('viewer-' + controlType);
            const docConfig = {
                zadost: { icon: 'description', title: 'Žádost o povolení stavby', desc: 'Formulář žádosti s údaji o stavebníkovi a záměru' },
                prilohy: { icon: 'attach_file', title: 'Přílohy žádosti (12)', desc: 'Plné moci, souhlasy vlastníků, další dokumenty' },
                dokumentace: { icon: 'architecture', title: 'Elektronická dokumentace', desc: 'Projektová dokumentace v evidenci EED' },
                eed: { icon: 'architecture', title: 'Elektronická dokumentace', desc: 'Projektová dokumentace v evidenci EED' },
                doklady: { icon: 'checklist', title: 'Dokladová část', desc: 'Stanoviska DO a vyjádření správců sítí' },
                dokladova: { icon: 'checklist', title: 'Dokladová část', desc: 'Stanoviska DO a vyjádření správců sítí' },
                kn: { icon: 'terrain', title: 'Katastr nemovitostí', desc: 'Informace o vlastnících pozemků a sousedech' },
                uplan: { icon: 'map', title: 'Územní plán', desc: 'Platný územní plán obce s regulativy' },
                mapa: { icon: 'map', title: 'Mapa parcel', desc: 'Vizuální zobrazení pozemků záměru a sousedů' }
            };

            const config = docConfig[docType] || docConfig.zadost;
            viewer.innerHTML = `
                <span class="material-icons-outlined">${config.icon}</span>
                <div class="viewer-placeholder-title">${config.title}</div>
                <div class="viewer-placeholder-text">${config.desc}</div>
            `;
        }

        // Option selection with visual feedback
        function selectOption(element, isNegative = false) {
            const container = element.closest('.control-section');
            const options = container.querySelectorAll('.control-option');
            
            options.forEach(opt => {
                opt.classList.remove('selected', 'negative');
            });
            
            element.classList.add('selected');
            if (isNegative) {
                element.classList.add('negative');
            }
        }

        // ==========================================
        // POZEMKY A SOUSEDÉ
        // ==========================================
        // ==========================================
        // POZEMKY A SOUSEDÉ - kompletní logika
        // ==========================================
        
        let pozemkyState = {
            method: 'auto',
            sousedniParcely: [],
            knVerified: false,
            owners: []
        };

        function switchPozemkyTab(tabEl, view) {
            const tabs = document.querySelectorAll('#controlPozemky .viewer-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tabEl.classList.add('active');
            
            const viewer = document.getElementById('viewer-pozemky');
            
            const viewConfig = {
                'zadost': { icon: 'description', title: 'Žádost o povolení stavby', text: 'Pozemky uvedené stavebníkem v žádosti' },
                'situace': { icon: 'architecture', title: 'Situační výkresy', text: 'C.1 - C.4 ze složky dokumentace' },
                'kn': { icon: 'terrain', title: 'Katastr nemovitostí', text: 'Nahlížení do katastru nemovitostí' },
                'mapa': { icon: 'map', title: 'Katastrální mapa', text: 'Interaktivní mapa s možností výběru parcel' }
            };
            
            const config = viewConfig[view];
            viewer.innerHTML = `
                <span class="material-icons-outlined">${config.icon}</span>
                <div class="viewer-placeholder-title">${config.title}</div>
                <div class="viewer-placeholder-text">${config.text}</div>
            `;
        }

        function selectNeighborMethod(method) {
            pozemkyState.method = method;
            
            // Update tlačítek
            document.querySelectorAll('.neighbor-method-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.method === method);
            });
            
            // Zobrazení správného obsahu
            document.getElementById('methodAuto').style.display = method === 'auto' ? 'block' : 'none';
            document.getElementById('methodManual').style.display = method === 'manual' ? 'block' : 'none';
            document.getElementById('methodPolygon').classList.toggle('visible', method === 'polygon');
        }

        function autoDetectSousedni() {
            const btn = document.getElementById('btnAutoDetect');
            btn.disabled = true;
            btn.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span>Identifikuji sousedy...';
            
            setTimeout(function() {
                pozemkyState.sousedniParcely = [
                    { cislo: '248/1', katastr: 'Radonice', kod: '747076', plocha: '890 m²' },
                    { cislo: '248/2', katastr: 'Radonice', kod: '747076', plocha: '1 120 m²' },
                    { cislo: '249', katastr: 'Radonice', kod: '747076', plocha: '2 340 m²' },
                    { cislo: 'st. 141', katastr: 'Radonice', kod: '747076', plocha: '420 m²' },
                    { cislo: 'st. 143', katastr: 'Radonice', kod: '747076', plocha: '380 m²' }
                ];
                
                renderSousedniParcely();
                btn.disabled = false;
                btn.innerHTML = '<span class="material-icons-outlined">auto_awesome</span>Automaticky identifikovat sousedy';
                updatePozemkyState();
            }, 2000);
        }

        function generatePolygonNeighbors() {
            const distance = document.getElementById('polygonDistance').value;
            const btn = document.querySelector('.btn-generate-polygon');
            btn.disabled = true;
            btn.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span>Generuji...';
            
            setTimeout(function() {
                // Simulace - ochranné pásmo najde více parcel
                pozemkyState.sousedniParcely = [
                    { cislo: '248/1', katastr: 'Radonice', kod: '747076', plocha: '890 m²' },
                    { cislo: '248/2', katastr: 'Radonice', kod: '747076', plocha: '1 120 m²' },
                    { cislo: '249', katastr: 'Radonice', kod: '747076', plocha: '2 340 m²' },
                    { cislo: 'st. 141', katastr: 'Radonice', kod: '747076', plocha: '420 m²' },
                    { cislo: 'st. 143', katastr: 'Radonice', kod: '747076', plocha: '380 m²' },
                    { cislo: '250/1', katastr: 'Radonice', kod: '747076', plocha: '1 560 m²' },
                    { cislo: '250/2', katastr: 'Radonice', kod: '747076', plocha: '980 m²' },
                    { cislo: '247', katastr: 'Radonice', kod: '747076', plocha: '3 200 m²' }
                ];
                
                renderSousedniParcely();
                btn.disabled = false;
                btn.innerHTML = '<span class="material-icons-outlined">hexagon</span>Vygenerovat';
                updatePozemkyState();
            }, 1500);
        }

        function renderSousedniParcely() {
            const list = document.getElementById('sousedniList');
            const empty = document.getElementById('sousedniEmpty');
            const count = document.getElementById('sousedniCount');
            
            if (pozemkyState.sousedniParcely.length === 0) {
                empty.style.display = 'block';
                count.textContent = '0 parcel';
                list.innerHTML = '<div class="sousedni-empty" id="sousedniEmpty"><span class="material-icons-outlined">grid_view</span><div class="sousedni-empty-text">Zatím nejsou identifikovány žádné sousední pozemky</div><div class="sousedni-empty-hint">Použijte některou z metod výše</div></div>';
            } else {
                const pocet = pozemkyState.sousedniParcely.length;
                count.textContent = pocet + ' ' + (pocet === 1 ? 'parcela' : pocet < 5 ? 'parcely' : 'parcel');
                
                let html = '';
                pozemkyState.sousedniParcely.forEach((p, index) => {
                    html += `
                        <div class="sousedni-item">
                            <div class="parcel-chip-icon">
                                <span class="material-icons-outlined">${p.cislo.startsWith('st') ? 'crop_square' : 'grass'}</span>
                            </div>
                            <div class="sousedni-item-content">
                                <div class="sousedni-item-number">${p.cislo}</div>
                                <div class="sousedni-item-katastr">k.ú. ${p.katastr} [${p.kod}] • ${p.plocha}</div>
                            </div>
                            <button class="sousedni-item-remove" onclick="removeSousedni(${index})">
                                <span class="material-icons-outlined">close</span>
                            </button>
                        </div>
                    `;
                });
                list.innerHTML = html;
            }
        }

        function removeSousedni(index) {
            pozemkyState.sousedniParcely.splice(index, 1);
            renderSousedniParcely();
            updatePozemkyState();
        }

        function searchSousedni() {
            const input = document.getElementById('sousedniSearchInput');
            const value = input.value.trim();
            if (!value) return;
            
            pozemkyState.sousedniParcely.push({
                cislo: value,
                katastr: 'Radonice',
                kod: '747076',
                plocha: '—'
            });
            
            renderSousedniParcely();
            input.value = '';
            updatePozemkyState();
        }

        function openMapForSousedni() {
            const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
            if (mapTab) {
                switchPozemkyTab(mapTab, 'mapa');
            }
        }

        function updatePozemkyState() {
            const btnConfirm = document.getElementById('btnConfirmPozemky');
            
            // Tlačítko Potvrdit je aktivní, když jsou identifikovány sousední pozemky
            if (pozemkyState.sousedniParcely.length > 0) {
                btnConfirm.disabled = false;
            } else {
                btnConfirm.disabled = true;
            }
        }

        function completePozemky() {
            controls.pozemky.done = true;
            controls.pozemky.result = 'ok';
            controls.pozemky.sousedniParcely = pozemkyState.sousedniParcely;
            closeControl('controlPozemky');
            updateUI();
        }

        // ==========================================
        // KONTROLA ŽÁDOSTI (§ 184 SZ)
        // ==========================================
        function toggleDataStatus(button) {
            const row = button.closest('.data-row');
            const isOk = button.classList.contains('ok');
            
            if (isOk) {
                // Přepni na error
                button.classList.remove('ok');
                button.classList.add('error');
                button.innerHTML = '<span class="material-icons-outlined">cancel</span>';
                button.title = 'Označit jako v pořádku';
                row.classList.add('error');
            } else {
                // Přepni zpět na ok
                button.classList.remove('error');
                button.classList.add('ok');
                button.innerHTML = '<span class="material-icons-outlined">check_circle</span>';
                button.title = 'Označit jako vadné';
                row.classList.remove('error');
            }
            
            updateZadostResult();
        }

        function updateZadostResult() {
            const resultBox = document.getElementById('resultZadost');
            const btnConfirm = document.getElementById('btnConfirmZadost');
            const deficiencySection = document.getElementById('zadostDeficiencySection');
            
            // Počet položek označených jako vadné
            const errorButtons = document.querySelectorAll('#controlZadost .data-status.error');
            const errorCount = errorButtons.length;
            
            if (errorCount > 0) {
                // Zobraz sekci pro poznámku
                deficiencySection.style.display = 'block';
                
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Zjištěny vady v údajích
                    </div>
                    <div class="result-preview-text">${errorCount} ${errorCount === 1 ? 'položka označena' : (errorCount < 5 ? 'položky označeny' : 'položek označeno')} jako vadné. Bude vydána výzva k odstranění vad (§ 185 odst. 2).</div>
                `;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">mail</span>Potvrdit a vydat výzvu';
            } else {
                // Skryj sekci pro poznámku
                deficiencySection.style.display = 'none';
                
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Údaje v žádosti jsou v pořádku
                    </div>
                    <div class="result-preview-text">Všechny údaje byly zkontrolovány a jsou smysluplné.</div>
                `;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
            }
        }

        function completeZadost() {
            controls.zadost.done = true;
            
            const errorButtons = document.querySelectorAll('#controlZadost .data-status.error');
            
            if (errorButtons.length > 0) {
                controls.zadost.result = 'vady';
                controls.zadost.deficiencyNote = document.getElementById('zadostDeficiencyNote').value;
            } else {
                controls.zadost.result = 'ok';
            }
            
            closeControl('controlZadost');
            updateUI();
        }

        // ==========================================
        // PŘÍSLUŠNOST - update result
        // ==========================================
        function updatePrislusnostResult() {
            const vecna = document.querySelector('input[name="vecna_prislusnost"]:checked').value;
            const mistni = document.querySelector('input[name="mistni_prislusnost"]:checked').value;
            const resultBox = document.getElementById('resultPrislusnost');
            const mistniSection = document.getElementById('mistniPrislusnostSection');
            const specialniSuSection = document.getElementById('specialniSuSection');
            const obecnySuSection = document.getElementById('obecnySuSection');

            // Reset výběrů při změně
            if (vecna === 'ano') {
                specialniSuSection.classList.remove('visible');
                document.getElementById('specialniSuSelect').value = '';
                document.getElementById('specialniSuInfo').classList.remove('visible');
            }
            
            if (mistni === 'ano') {
                obecnySuSection.classList.remove('visible');
                document.getElementById('obecnySuSelect').value = '';
                document.getElementById('obecnySuInfo').classList.remove('visible');
            }

            // Pokud není věcně příslušný, skryj místní příslušnost a zobraz výběr příslušného SÚ
            if (vecna === 'ne') {
                mistniSection.style.display = 'none';
                specialniSuSection.classList.add('visible');
                obecnySuSection.classList.remove('visible');
                
                const selectedSu = document.getElementById('specialniSuSelect');
                const selectedOption = selectedSu.options[selectedSu.selectedIndex];
                
                if (selectedSu.value) {
                    const suName = selectedOption.text;
                    const suType = selectedOption.getAttribute('data-type');
                    resultBox.className = 'result-preview negative';
                    resultBox.innerHTML = `
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">send</span>
                            Řízení bude postoupeno
                        </div>
                        <div class="result-preview-text">
                            <strong>${suType}</strong><br>
                            ${suName}
                        </div>
                    `;
                } else {
                    resultBox.className = 'result-preview negative';
                    resultBox.innerHTML = `
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">warning</span>
                            Vyberte příslušný stavební úřad
                        </div>
                        <div class="result-preview-text">Pro postoupení řízení je nutné vybrat věcně příslušný stavební úřad.</div>
                    `;
                }
            } else {
                mistniSection.style.display = 'block';
                specialniSuSection.classList.remove('visible');
                
                if (mistni === 'ne') {
                    obecnySuSection.classList.add('visible');
                    
                    const selectedSu = document.getElementById('obecnySuSelect');
                    const selectedOption = selectedSu.options[selectedSu.selectedIndex];
                    
                    if (selectedSu.value) {
                        const suName = selectedOption.text;
                        const info = selectedOption.getAttribute('data-info').split('|');
                        resultBox.className = 'result-preview negative';
                        resultBox.innerHTML = `
                            <div class="result-preview-title">
                                <span class="material-icons-outlined">send</span>
                                Řízení bude postoupeno
                            </div>
                            <div class="result-preview-text">
                                <strong>${info[0]}</strong><br>
                                ${info[1]}
                            </div>
                        `;
                    } else {
                        resultBox.className = 'result-preview negative';
                        resultBox.innerHTML = `
                            <div class="result-preview-title">
                                <span class="material-icons-outlined">warning</span>
                                Vyberte příslušný stavební úřad
                            </div>
                            <div class="result-preview-text">Pro postoupení řízení je nutné vybrat místně příslušný stavební úřad.</div>
                        `;
                    }
                } else {
                    obecnySuSection.classList.remove('visible');
                    resultBox.className = 'result-preview positive';
                    resultBox.innerHTML = `
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Příslušnost potvrzena
                        </div>
                        <div class="result-preview-text">Stavební úřad je věcně i místně příslušný k projednání této žádosti.</div>
                    `;
                }
            }
            
            // Aktualizace stavu tlačítka potvrdit
            updatePrislusnostButton();
        }
        
        function updatePrislusnostButton() {
            const vecna = document.querySelector('input[name="vecna_prislusnost"]:checked').value;
            const mistni = document.querySelector('input[name="mistni_prislusnost"]:checked').value;
            const btnConfirm = document.querySelector('#controlPrislusnost .btn-primary');
            
            if (vecna === 'ne') {
                const selectedSu = document.getElementById('specialniSuSelect').value;
                btnConfirm.disabled = !selectedSu;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
            } else if (mistni === 'ne') {
                const selectedSu = document.getElementById('obecnySuSelect').value;
                btnConfirm.disabled = !selectedSu;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
            } else {
                btnConfirm.disabled = false;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
            }
        }
        
        function updateSpecialniSuInfo() {
            const select = document.getElementById('specialniSuSelect');
            const infoBox = document.getElementById('specialniSuInfo');
            const nameEl = document.getElementById('specialniSuName');
            const detailsEl = document.getElementById('specialniSuDetails');
            
            if (select.value) {
                const option = select.options[select.selectedIndex];
                const info = option.getAttribute('data-info').split('|');
                const type = option.getAttribute('data-type');
                
                nameEl.textContent = info[0];
                detailsEl.innerHTML = `
                    <span><strong>Typ:</strong> ${type}</span>
                    <span><strong>Adresa:</strong> ${info[1]}</span>
                    <span><strong>E-mail:</strong> ${info[2]}</span>
                    <span><strong>Působnost:</strong> ${info[3] || '—'}</span>
                `;
                infoBox.classList.add('visible');
            } else {
                infoBox.classList.remove('visible');
            }
            
            updatePrislusnostResult();
        }
        
        function updateObecnySuInfo() {
            const select = document.getElementById('obecnySuSelect');
            const infoBox = document.getElementById('obecnySuInfo');
            const nameEl = document.getElementById('obecnySuName');
            const detailsEl = document.getElementById('obecnySuDetails');
            
            if (select.value) {
                const option = select.options[select.selectedIndex];
                const info = option.getAttribute('data-info').split('|');
                
                nameEl.textContent = info[0];
                detailsEl.innerHTML = `
                    <span><strong>Adresa:</strong> ${info[1]}</span>
                    <span><strong>E-mail:</strong> ${info[2]}</span>
                    <span><strong>Územní obvod:</strong> ${info[3]}</span>
                `;
                infoBox.classList.add('visible');
            } else {
                infoBox.classList.remove('visible');
            }
            
            updatePrislusnostResult();
        }

        // ==========================================
        // DOKUMENTACE - kompletní logika
        // ==========================================
        
        // Funkce pro uložení rozpracované kontroly
        function saveDraft(controlName) {
            const indicator = document.getElementById('autoSave' + controlName.charAt(0).toUpperCase() + controlName.slice(1));
            if (!indicator) return;
            
            // Simulace ukládání
            indicator.className = 'auto-save-indicator saving';
            indicator.innerHTML = '<span class="material-icons-outlined">sync</span><span>Ukládám...</span>';
            
            setTimeout(function() {
                indicator.className = 'auto-save-indicator saved';
                indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Uloženo</span>';
                
                // Zobrazit potvrzení
                setTimeout(function() {
                    indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Automaticky uloženo</span>';
                }, 2000);
            }, 800);
        }
        
        // Trigger automatického ukládání při změně (simulace)
        function triggerAutoSave(controlName) {
            const indicator = document.getElementById('autoSave' + controlName.charAt(0).toUpperCase() + controlName.slice(1));
            if (!indicator) return;
            
            indicator.className = 'auto-save-indicator saving';
            indicator.innerHTML = '<span class="material-icons-outlined">sync</span><span>Ukládám...</span>';
            
            setTimeout(function() {
                indicator.className = 'auto-save-indicator saved';
                indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Automaticky uloženo</span>';
            }, 500);
        }
        
        // Stav kontrol dokumentace
        let docCheckState = {
            autoCheckDone: false,
            partStatus: { A: 'unchecked', B: 'unchecked', C: 'unchecked', D: 'unchecked' },
            issues: [],
            currentVersion: 'v3'
        };
        
        function toggleEdFolder(headerEl) {
            const folder = headerEl.closest('.ed-folder');
            if (folder.classList.contains('empty')) return;
            folder.classList.toggle('open');
        }
        
        function switchDocViewerTab(tabEl, view) {
            // Přepnout aktivní záložku
            const tabs = document.querySelectorAll('#controlDokumentace .viewer-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tabEl.classList.add('active');
            
            // Přepnout kontejnery
            const treeContainer = document.getElementById('edTreeContainer');
            const previewContainer = document.getElementById('edPreviewContainer');
            
            if (view === 'struktura') {
                treeContainer.style.display = 'block';
                previewContainer.style.display = 'none';
            } else {
                treeContainer.style.display = 'none';
                previewContainer.style.display = 'block';
            }
        }
        
        function previewEdFile(fileName, section) {
            // Přepnout na záložku náhled
            const tabs = document.querySelectorAll('#controlDokumentace .viewer-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tabs[1].classList.add('active');
            
            // Přepnout kontejnery
            document.getElementById('edTreeContainer').style.display = 'none';
            document.getElementById('edPreviewContainer').style.display = 'block';
            
            // Zobrazit náhled
            const previewContent = document.getElementById('edPreviewContent');
            const versionLabel = docCheckState.currentVersion === 'v3' ? '' : ` (${docCheckState.currentVersion})`;
            previewContent.innerHTML = `
                <span class="material-icons-outlined" style="font-size: 64px; color: #c62828; margin-bottom: 16px;">picture_as_pdf</span>
                <div style="font-size: 16px; font-weight: 500; color: #202124; margin-bottom: 8px;">${fileName}${versionLabel}</div>
                <div style="font-size: 13px; color: #5f6368;">V ostré verzi by se zde zobrazil náhled dokumentu</div>
            `;
        }
        
        function changeEdVersion() {
            const select = document.getElementById('edVersionSelect');
            const newVersion = select.value;
            docCheckState.currentVersion = newVersion;
            
            // Simulace načtení jiné verze - zavřeme všechny otevřené složky
            document.querySelectorAll('.ed-folder.open').forEach(folder => {
                folder.classList.remove('open');
            });
            
            // Pokud jsme v náhledu, přepneme zpět na strukturu
            const tabs = document.querySelectorAll('#controlDokumentace .viewer-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tabs[0].classList.add('active');
            document.getElementById('edTreeContainer').style.display = 'block';
            document.getElementById('edPreviewContainer').style.display = 'none';
        }
        
        function setDocPartStatus(part, status) {
            docCheckState.partStatus[part] = status;
            
            // Update UI
            const item = document.querySelector(`.doc-part-item[data-part="${part}"]`);
            item.classList.remove('status-ok', 'status-warning', 'status-error', 'status-unchecked');
            item.classList.add('status-' + status);
            
            // Update buttons - odstranit active a unchecked ze všech
            const buttons = item.querySelectorAll('.doc-part-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active', 'unchecked');
            });
            
            // Nastavit správný stav tlačítku
            const targetBtn = item.querySelector('.doc-part-btn.' + status) || item.querySelector('.doc-part-btn.ok');
            if (status === 'ok') {
                targetBtn.classList.add('active');
            } else if (status === 'unchecked') {
                item.querySelector('.doc-part-btn.ok').classList.add('unchecked');
            } else {
                targetBtn.classList.add('active');
            }
            
            // Pokud je warning nebo error, nabídni přidání nedostatku
            if (status === 'warning' || status === 'error') {
                const partNames = {
                    A: 'Průvodní zpráva',
                    B: 'Souhrnná technická zpráva', 
                    C: 'Situační výkresy',
                    D: 'Dokumentace objektů'
                };
                const issueText = status === 'error' 
                    ? `Chyby v části ${part}. ${partNames[part]}`
                    : `Neúplná část ${part}. ${partNames[part]}`;
                
                // Zkontroluj zda už takový nedostatek neexistuje
                const exists = docCheckState.issues.some(i => i.text.startsWith(`Chyby v části ${part}`) || i.text.startsWith(`Neúplná část ${part}`));
                if (!exists) {
                    addIssueToList(issueText);
                }
            } else {
                // Pokud je OK nebo unchecked, odeber případný nedostatek pro tuto část
                docCheckState.issues = docCheckState.issues.filter(i => 
                    !i.text.startsWith(`Chyby v části ${part}`) && !i.text.startsWith(`Neúplná část ${part}`)
                );
                renderIssues();
            }
            
            updateDokumentaceResult();
        }
        
        // Toggle mezi krátkým a dlouhým textem pro nedostatky
        function toggleIssueInputType(type) {
            const btnShort = document.getElementById('btnIssueShort');
            const btnLong = document.getElementById('btnIssueLong');
            const inputShort = document.getElementById('issueInputShort');
            const inputLong = document.getElementById('issueInputLong');
            
            if (type === 'short') {
                btnShort.classList.add('active');
                btnLong.classList.remove('active');
                inputShort.style.display = 'flex';
                inputLong.style.display = 'none';
            } else {
                btnShort.classList.remove('active');
                btnLong.classList.add('active');
                inputShort.style.display = 'none';
                inputLong.style.display = 'flex';
            }
        }
        
        // Přidání nedostatku z dlouhého textu
        function addIssueLong() {
            const textarea = document.getElementById('addIssueTextLong');
            const text = textarea.value.trim();
            if (!text) return;
            
            addIssueToList(text);
            textarea.value = '';
        }
        
        function runDocAutoCheck() {
            const btn = document.getElementById('btnRunAutoCheck');
            const desc = document.getElementById('autoCheckDesc');
            const results = document.getElementById('autoCheckResults');
            
            btn.disabled = true;
            btn.classList.add('loading');
            btn.innerHTML = '<span class="material-icons-outlined">sync</span>Probíhá kontrola...';
            
            // Simulace automatické kontroly
            setTimeout(function() {
                btn.classList.remove('loading');
                btn.innerHTML = '<span class="material-icons-outlined">check</span>Kontrola dokončena';
                btn.style.background = '#137333';
                
                desc.style.display = 'none';
                results.classList.add('visible');
                
                docCheckState.autoCheckDone = true;
                updateDokumentaceResult();
            }, 2000);
        }
        
        function addIssueFromAutoCheck(issueText) {
            addIssueToList(issueText);
        }
        
        function addIssue() {
            const textInput = document.getElementById('addIssueText');
            const issueText = textInput.value.trim();
            
            if (!issueText) {
                alert('Zadejte popis nedostatku');
                return;
            }
            
            addIssueToList(issueText);
            textInput.value = '';
        }
        
        function addIssueToList(issueText) {
            const issueId = 'issue-' + Date.now();
            
            // Zkontroluj duplicitu
            if (docCheckState.issues.some(i => i.text === issueText)) {
                return;
            }
            
            docCheckState.issues.push({
                id: issueId,
                text: issueText
            });
            
            renderIssues();
            updateDokumentaceResult();
        }
        
        function removeIssue(issueId) {
            docCheckState.issues = docCheckState.issues.filter(i => i.id !== issueId);
            renderIssues();
            updateDokumentaceResult();
        }
        
        function renderIssues() {
            const list = document.getElementById('issuesList');
            const section = document.getElementById('issuesSection');
            const countEl = document.getElementById('issuesCount');
            
            if (docCheckState.issues.length === 0) {
                section.classList.remove('visible');
                list.innerHTML = '';
                countEl.textContent = '0';
                return;
            }
            
            section.classList.add('visible');
            countEl.textContent = docCheckState.issues.length;
            
            list.innerHTML = docCheckState.issues.map(issue => `
                <div class="issue-item" data-issue-id="${issue.id}">
                    <div class="issue-item-icon">
                        <span class="material-icons-outlined">warning</span>
                    </div>
                    <div class="issue-item-content">
                        <div class="issue-item-text">${issue.text}</div>
                    </div>
                    <button class="issue-item-remove" onclick="removeIssue('${issue.id}')" title="Odebrat">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
            `).join('');
        }
        
        function updateDokumentaceResult() {
            const resultBox = document.getElementById('resultDokumentace');
            const btnConfirm = document.getElementById('btnConfirmDokumentace');
            const issueCount = docCheckState.issues.length;
            const hasProblems = Object.values(docCheckState.partStatus).some(s => s === 'warning' || s === 'error');
            const allChecked = Object.values(docCheckState.partStatus).every(s => s !== 'unchecked');
            
            if (issueCount > 0 || hasProblems) {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Dokumentace vykazuje nedostatky
                    </div>
                    <div class="result-preview-text">
                        Zjištěno ${issueCount} nedostatků. Bude vydána výzva k doplnění a řízení přerušeno.
                    </div>
                `;
            } else if (!allChecked) {
                resultBox.className = 'result-preview neutral';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Kontrola nebyla dokončena
                    </div>
                    <div class="result-preview-text">Zkontrolujte všechny části dokumentace kliknutím na zaškrtávátko.</div>
                `;
            } else {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Dokumentace v pořádku
                    </div>
                    <div class="result-preview-text">Všechny části dokumentace jsou přítomny a úplné.</div>
                `;
            }
            
            // Tlačítko je vždy "Potvrdit kontrolu"
            btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
        }

        // ==========================================
        // DOKLADOVÁ ČÁST - update result
        // ==========================================
        function updateDokladyResult() {
            const vyjadreni = document.querySelector('input[name="vyjadreni_ss"]:checked').value;
            const stanoviska = document.querySelector('input[name="stanoviska_do"]:checked').value;
            const resultBox = document.getElementById('resultDoklady');

            if (vyjadreni === 'kompletni' && stanoviska === 'kompletni') {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Dokladová část v pořádku
                    </div>
                    <div class="result-preview-text">Všechna vyjádření a stanoviska jsou k dispozici.</div>
                `;
            } else if (stanoviska === 'zaporne') {
                resultBox.className = 'result-preview negative';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">cancel</span>
                        Záporné stanovisko DO
                    </div>
                    <div class="result-preview-text">Řízení bude zastaveno z důvodu záporného stanoviska dotčeného orgánu.</div>
                `;
            } else if (vyjadreni === 'chybi') {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Chybí vyjádření
                    </div>
                    <div class="result-preview-text">Bude vydána výzva k doplnění a řízení přerušeno.</div>
                `;
            } else if (stanoviska === 'chybi') {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">schedule</span>
                        Chybí stanovisko DO
                    </div>
                    <div class="result-preview-text">SÚ si stanovisko vyžádá. Běží lhůta 30 dnů.</div>
                `;
            }
        }

        // ==========================================
        // ÚZEMNÍ PLÁN - EXISTENCE
        // ==========================================
        function updateUPExistence() {
            const existence = document.querySelector('input[name="up_existence"]:checked').value;
            const aiSection = document.getElementById('aiControlSection');
            const aiResultSection = document.getElementById('aiResultSection');
            const upNeexistujeInfo = document.getElementById('upNeexistujeInfo');
            const upVysledekSection = document.getElementById('upVysledekSection');
            const resultBox = document.getElementById('resultUP');
            
            if (existence === 'neexistuje') {
                // Skrýt AI kontrolu
                aiSection.style.display = 'none';
                aiResultSection.style.display = 'none';
                upNeexistujeInfo.style.display = 'flex';
                
                // Zobrazit sekci výsledku s upravenými možnostmi
                upVysledekSection.style.display = 'block';
                
                // Upravit result preview
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Územní plán neexistuje
                    </div>
                    <div class="result-preview-text">Záměr bude posouzen podle § 193 SZ. Zastavěným územím je intravilán. Zrychlené řízení nelze použít.</div>
                `;
            } else {
                // Zobrazit AI kontrolu
                aiSection.style.display = 'block';
                upNeexistujeInfo.style.display = 'none';
                
                // Reset result preview
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Záměr je v souladu s ÚP
                    </div>
                    <div class="result-preview-text">Záměr je v souladu s platným územním plánem.</div>
                `;
            }
        }

        // ==========================================
        // AI COMPLIANCE KONTROLA
        // ==========================================
        function runAiCompliance() {
            const btn = document.getElementById('btnAiKontrola');
            const aiSection = document.getElementById('aiControlSection');
            const resultSection = document.getElementById('aiResultSection');
            
            // Změna stavu tlačítka na loading
            btn.disabled = true;
            btn.classList.add('loading');
            btn.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span>Probíhá analýza...';
            
            // Simulace AI zpracování (2.5 sekundy)
            setTimeout(function() {
                // Skrýt tlačítko, zobrazit výsledek
                aiSection.style.display = 'none';
                resultSection.style.display = 'block';
            }, 2500);
        }

        function showComplianceReport() {
            const reportDetail = document.getElementById('aiReportDetail');
            const vysledekSection = document.getElementById('upVysledekSection');
            
            reportDetail.style.display = 'block';
            vysledekSection.style.display = 'none';
        }

        function hideComplianceReport() {
            const reportDetail = document.getElementById('aiReportDetail');
            const vysledekSection = document.getElementById('upVysledekSection');
            
            reportDetail.style.display = 'none';
            vysledekSection.style.display = 'block';
        }

        // ==========================================
        // ÚZEMNÍ PLÁN - update result
        // ==========================================
        function updateUPResult() {
            const vysledek = document.querySelector('input[name="up_vysledek"]:checked').value;
            const resultBox = document.getElementById('resultUP');

            if (vysledek === 'soulad') {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Záměr je v souladu s ÚP
                    </div>
                    <div class="result-preview-text">Záměr je v souladu s platným územním plánem.</div>
                `;
            } else {
                resultBox.className = 'result-preview negative';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">cancel</span>
                        Nesoulad s územním plánem
                    </div>
                    <div class="result-preview-text">Žádost bude zamítnuta z důvodu nesouladu s územním plánem.</div>
                `;
            }
        }

        // ==========================================
        // ZRYCHLENÉ ŘÍZENÍ - update result
        // ==========================================
        function updateZrychleneResult() {
            const checkboxes = document.querySelectorAll('#controlZrychlene input[type="checkbox"]');
            let allChecked = true;
            
            checkboxes.forEach(cb => {
                const option = cb.closest('.control-option');
                if (cb.checked) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                    allChecked = false;
                }
            });

            const resultBox = document.getElementById('resultZrychlene');
            if (allChecked) {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Podmínky splněny
                    </div>
                    <div class="result-preview-text">Všechny podmínky pro zrychlené řízení jsou splněny.</div>
                `;
            } else {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Podmínky nesplněny
                    </div>
                    <div class="result-preview-text">Řízení bude vedeno standardním způsobem.</div>
                `;
            }
        }

        // ==========================================
        // INFO PANEL UPDATE
        // ==========================================
        function updateInfoPanel() {
            const infoPanel = document.getElementById('infoPanel');
            
            // Zkontroluj stav příslušnosti
            if (controls.prislusnost.done && controls.prislusnost.result === 'neprislusny') {
                const postoupit = controls.prislusnost.postoupit;
                let suNazev = 'příslušnému stavebnímu úřadu';
                
                if (postoupit) {
                    const info = postoupit.info.split('|');
                    suNazev = info[0];
                }
                
                infoPanel.className = 'info-panel error';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">send</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Řízení bude postoupeno</div>
                        <div class="info-panel-text">
                            Stavební úřad není příslušný. Řízení bude postoupeno: <strong>${suNazev}</strong>.<br>
                            Další kontroly nejsou vyžadovány.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj stav dokumentace
            if (controls.dokumentace.done && controls.dokumentace.result === 'vady') {
                infoPanel.className = 'info-panel warning';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">warning</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Dokumentace vykazuje vady</div>
                        <div class="info-panel-text">
                            Bude vydána výzva k doplnění a řízení přerušeno. Po odstranění vad pokračujte v kontrolách.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj vady žádosti
            if (controls.zadost.done && controls.zadost.result === 'vady') {
                infoPanel.className = 'info-panel warning';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">mail</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Žádost vykazuje vady</div>
                        <div class="info-panel-text">
                            Bude vydána výzva k odstranění vad (§ 185 odst. 2) a řízení přerušeno do 10 dnů od zahájení.
                            Můžete pokračovat v kontrolách nebo rovnou vydat výzvu.
                        </div>
                    </div>
                `;
                return;
            }

            // Standardní stav
            infoPanel.className = 'info-panel';
            infoPanel.innerHTML = `
                <span class="material-icons-outlined">info</span>
                <div class="info-panel-content">
                    <div class="info-panel-title">Probíhá kontrola před zahájením řízení</div>
                    <div class="info-panel-text">
                        Proveďte všechny kontroly níže. Po jejich dokončení bude možné řízení zahájit. 
                        Lhůta pro vydání rozhodnutí začne běžet od data doručení bezvadné žádosti (7. 1. 2026).
                    </div>
                </div>
            `;
        }

        // ==========================================
        // UPDATE UI
        // ==========================================
        function updateUI() {
            let completedCount = 0;
            const totalCount = Object.keys(controls).length;
            const isPrislusny = !controls.prislusnost.done || controls.prislusnost.result === 'ok';
            
            // Kontrola, zda jsou zjištěny vady (pro tlačítko Výzva k doplnění)
            const hasVady = Object.values(controls).some(c => c.done && (c.result === 'vady' || c.result === 'warning'));

            for (const [key, control] of Object.entries(controls)) {
                const card = document.getElementById('card-' + key);
                if (!card) continue;
                
                // Kontroly s vadami neblokují ostatní kontroly - stačí že jsou done
                let dependenciesMet = control.depends.every(dep => controls[dep].done);
                
                // Pokud SÚ není příslušný, nic dalšího nelze dělat
                if (!isPrislusny && key !== 'prislusnost') {
                    dependenciesMet = false;
                }

                // Remove all status classes
                card.classList.remove('status-waiting', 'status-ready', 'status-done', 'status-warning', 'status-error', 'disabled');

                if (control.done) {
                    if (control.result === 'ok') {
                        card.classList.add('status-done');
                    } else if (control.result === 'vady' || control.result === 'warning') {
                        card.classList.add('status-warning');
                    } else {
                        card.classList.add('status-error');
                    }
                    completedCount++;
                    updateCardContent(key, 'done');
                } else if (dependenciesMet) {
                    card.classList.add('status-ready');
                    updateCardContent(key, 'ready');
                } else {
                    card.classList.add('status-waiting', 'disabled');
                    updateCardContent(key, 'waiting');
                }
            }

            // Update progress
            document.getElementById('progressText').textContent = completedCount + ' z ' + totalCount + ' kontrol';
            document.getElementById('progressFill').style.width = (completedCount / totalCount * 100) + '%';

            // Update info panel
            updateInfoPanel();

            // Update summary
            const allDone = Object.values(controls).every(c => c.done);
            const allOk = Object.values(controls).every(c => c.result === 'ok');
            const hasBlocking = Object.values(controls).some(c => c.done && c.result === 'error');
            
            if (!isPrislusny) {
                document.getElementById('summaryTitle').textContent = 'Stavební úřad není příslušný';
                document.getElementById('summaryDesc').textContent = 'Řízení bude postoupeno příslušnému stavebnímu úřadu.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">send</span>Postoupit řízení';
            } else if (allDone && allOk) {
                document.getElementById('summaryTitle').textContent = 'Všechny kontroly dokončeny';
                document.getElementById('summaryDesc').textContent = 'Řízení je připraveno k zahájení. Lhůta začne běžet od 7. 1. 2026.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">play_circle</span>Zahájit řízení';
            } else if (allDone && hasVady && !hasBlocking) {
                // Všechny kontroly hotové, ale jsou vady - nabídnout Výzvu k doplnění
                document.getElementById('summaryTitle').textContent = 'Zjištěny nedostatky v žádosti';
                document.getElementById('summaryDesc').textContent = 'Kontroly dokončeny. Žádost vykazuje nedostatky, bude vydána výzva k doplnění.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">mail</span>Vydat výzvu k doplnění';
            } else if (hasVady) {
                // Jsou vady, ale ne všechny kontroly hotové
                const remaining = Object.values(controls).filter(c => !c.done).length;
                document.getElementById('summaryTitle').textContent = 'Zjištěny nedostatky';
                document.getElementById('summaryDesc').textContent = 'Zjištěny nedostatky. Zbývá ' + remaining + ' kontrol. Dokončete kontroly nebo vydejte výzvu.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">mail</span>Vydat výzvu k doplnění';
            } else if (hasBlocking) {
                document.getElementById('summaryTitle').textContent = 'Řízení nelze pokračovat';
                document.getElementById('summaryDesc').textContent = 'Některé kontroly blokují pokračování řízení.';
                document.getElementById('btnZahajit').disabled = true;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">block</span>Řízení blokováno';
            } else {
                document.getElementById('summaryTitle').textContent = 'Dokončete všechny kontroly';
                const remaining = Object.values(controls).filter(c => !c.done).length;
                document.getElementById('summaryDesc').textContent = 'Zbývá ' + remaining + ' kontrol k dokončení.';
                document.getElementById('btnZahajit').disabled = true;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">play_circle</span>Zahájit řízení';
            }
        }

        function updateCardContent(key, status) {
            const card = document.getElementById('card-' + key);
            const statusBadge = card.querySelector('.control-card-status');
            const actionBtn = card.querySelector('.control-card-action');

            const config = {
                prislusnost: { controlId: 'controlPrislusnost', readyText: 'Provést kontrolu', doneText: 'Příslušný', doneTextNeg: 'Nepříslušný' },
                zadost: { controlId: 'controlZadost', readyText: 'Zkontrolovat žádost', doneText: 'Úplná', doneTextNeg: 'Odložení' },
                dokumentace: { controlId: 'controlDokumentace', readyText: 'Provést kontrolu', doneText: 'V pořádku', doneTextNeg: 'Vykazuje vady' },
                pozemky: { controlId: 'controlPozemky', readyText: 'Identifikovat pozemky', doneText: 'Identifikováno', doneTextNeg: 'Identifikováno' },
                up: { controlId: 'controlUP', readyText: 'Provést kontrolu', doneText: 'V souladu', doneTextNeg: 'Nesoulad' },
                identifikace: { controlId: 'controlIdentifikace', readyText: 'Identifikovat subjekty', doneText: 'Identifikováno', doneTextNeg: 'Identifikováno' },
                doklady: { controlId: 'controlDoklady', readyText: 'Provést kontrolu', doneText: 'V pořádku', doneTextNeg: 'Chybí doklady' },
                ucastnici: { controlId: 'controlUcastnici', readyText: 'Definovat účastníky', doneText: 'Kompletní', doneTextNeg: 'Kompletní' },
                zrychlene: { controlId: 'controlZrychlene', readyText: 'Ověřit podmínky', doneText: 'Splněno', doneTextNeg: 'Nesplněno' }
            };

            const ctrl = controls[key];
            const cfg = config[key];

            if (status === 'done') {
                if (ctrl.result === 'ok') {
                    statusBadge.textContent = 'Hotovo';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">check_circle</span>' + cfg.doneText;
                } else if (ctrl.result === 'vady' || ctrl.result === 'warning') {
                    statusBadge.textContent = 'Vady';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">warning</span>' + cfg.doneTextNeg;
                } else {
                    statusBadge.textContent = 'Blokuje';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">cancel</span>' + cfg.doneTextNeg;
                }
                actionBtn.onclick = function() { openControl(cfg.controlId); };
            } else if (status === 'ready') {
                statusBadge.textContent = 'K provedení';
                actionBtn.innerHTML = '<span class="material-icons-outlined">play_arrow</span>' + cfg.readyText;
                actionBtn.onclick = function() { openControl(cfg.controlId); };
            } else {
                statusBadge.textContent = 'Čeká';
                const waitingOn = ctrl.depends.find(dep => !controls[dep].done);
                const waitingText = {
                    prislusnost: 'Nejprve příslušnost',
                    dokumentace: 'Nejprve dokumentace',
                    pozemky: 'Nejprve pozemky',
                    identifikace: 'Nejprve identifikace',
                    doklady: 'Nejprve doklady',
                    up: 'Nejprve územní plán',
                    ucastnici: 'Nejprve účastníci'
                };
                actionBtn.innerHTML = '<span class="material-icons-outlined">lock</span>' + (waitingText[waitingOn] || 'Nejprve ostatní kontroly');
                actionBtn.onclick = null;
            }
        }

        // ==========================================
        // COMPLETE CONTROL FUNCTIONS
        // ==========================================
        function completePrislusnost() {
            const vecna = document.querySelector('input[name="vecna_prislusnost"]:checked').value;
            const mistni = document.querySelector('input[name="mistni_prislusnost"]:checked').value;
            
            controls.prislusnost.done = true;
            
            if (vecna === 'ne') {
                controls.prislusnost.result = 'neprislusny';
                const select = document.getElementById('specialniSuSelect');
                const option = select.options[select.selectedIndex];
                controls.prislusnost.postoupit = {
                    typ: 'vecna',
                    nazev: option.text,
                    typSu: option.getAttribute('data-type'),
                    info: option.getAttribute('data-info')
                };
            } else if (mistni === 'ne') {
                controls.prislusnost.result = 'neprislusny';
                const select = document.getElementById('obecnySuSelect');
                const option = select.options[select.selectedIndex];
                controls.prislusnost.postoupit = {
                    typ: 'mistni',
                    nazev: option.text,
                    info: option.getAttribute('data-info')
                };
            } else {
                controls.prislusnost.result = 'ok';
                controls.prislusnost.postoupit = null;
            }
            
            closeControl('controlPrislusnost');
            updateUI();
        }

        function completeDokumentace() {
            controls.dokumentace.done = true;
            
            const hasProblems = Object.values(docCheckState.partStatus).some(s => s !== 'ok');
            
            if (docCheckState.issues.length > 0 || hasProblems) {
                controls.dokumentace.result = 'vady';
                controls.dokumentace.issues = [...docCheckState.issues];
            } else {
                controls.dokumentace.result = 'ok';
                controls.dokumentace.issues = [];
            }
            
            closeControl('controlDokumentace');
            updateUI();
        }

        function completeIdentifikace() {
            controls.identifikace.done = true;
            controls.identifikace.result = 'ok';
            closeControl('controlIdentifikace');
            updateUI();
        }

        function completeDoklady() {
            const vyjadreni = document.querySelector('input[name="vyjadreni_ss"]:checked').value;
            const stanoviska = document.querySelector('input[name="stanoviska_do"]:checked').value;
            
            controls.doklady.done = true;
            if (vyjadreni === 'kompletni' && stanoviska === 'kompletni') {
                controls.doklady.result = 'ok';
            } else if (stanoviska === 'zaporne') {
                controls.doklady.result = 'error';
            } else {
                controls.doklady.result = 'warning';
            }
            
            closeControl('controlDoklady');
            updateUI();
        }

        function completeUP() {
            const vysledek = document.querySelector('input[name="up_vysledek"]:checked').value;
            
            controls.up.done = true;
            if (vysledek === 'soulad') {
                controls.up.result = 'ok';
            } else {
                controls.up.result = 'error';
            }
            
            closeControl('controlUP');
            updateUI();
        }

        function completeUcastnici() {
            controls.ucastnici.done = true;
            controls.ucastnici.result = 'ok';
            closeControl('controlUcastnici');
            updateUI();
        }

        function completeZrychlene() {
            const checkboxes = document.querySelectorAll('#controlZrychlene input[type="checkbox"]');
            let allChecked = true;
            checkboxes.forEach(cb => { if (!cb.checked) allChecked = false; });
            
            controls.zrychlene.done = true;
            controls.zrychlene.result = allChecked ? 'ok' : 'warning';
            
            closeControl('controlZrychlene');
            updateUI();
        }

        function zahajitRizeni() {
            if (controls.prislusnost.result === 'neprislusny') {
                const postoupit = controls.prislusnost.postoupit;
                let msg = 'Řízení bude postoupeno příslušnému stavebnímu úřadu.\n\n';
                
                if (postoupit) {
                    const info = postoupit.info.split('|');
                    if (postoupit.typ === 'vecna') {
                        msg += `Typ nepříslušnosti: Věcná\n`;
                        msg += `Příslušný úřad: ${postoupit.typSu}\n`;
                        msg += `Název: ${info[0]}\n`;
                        msg += `Adresa: ${info[1]}\n`;
                        msg += `E-mail: ${info[2]}\n`;
                    } else {
                        msg += `Typ nepříslušnosti: Místní\n`;
                        msg += `Příslušný úřad: ${info[0]}\n`;
                        msg += `Adresa: ${info[1]}\n`;
                        msg += `E-mail: ${info[2]}\n`;
                        msg += `Územní obvod: ${info[3]}\n`;
                    }
                }
                
                msg += '\nV ostré verzi by následovalo flow pro postoupení řízení.';
                alert(msg);
            } else {
                alert('Řízení zahájeno!\n\nDatum zahájení: 7. 1. 2026 (datum doručení bezvadné žádosti)\nLhůta pro rozhodnutí: 30 dnů (jednoduchá stavba)\n\nV ostré verzi by se přešlo na obrazovku probíhajícího řízení.');
            }
        }

        // Initialize
        updateUI();

        // Force styles after page load (for Nicepage compatibility)
        function forceWorkflowStyles() {
            const workflowBar = document.querySelector('.workflow-bar');
            if (workflowBar) {
                workflowBar.style.cssText = 'display: flex !important; align-items: center !important; justify-content: space-between !important; padding: 10px 32px !important; background: #f8f9fa !important; border-bottom: 1px solid #e0e0e0 !important; flex-wrap: nowrap !important;';
            }
            
            const stepper = document.querySelector('.workflow-stepper');
            if (stepper) {
                stepper.style.cssText = 'display: flex !important; align-items: center !important; gap: 6px !important; flex-wrap: nowrap !important;';
            }
            
            document.querySelectorAll('.workflow-step').forEach(step => {
                const isCompleted = step.classList.contains('completed');
                const isActive = step.classList.contains('active');
                
                let bg = '#fff', border = '#dadce0', color = '#5f6368';
                if (isCompleted) { bg = '#e6f4ea'; border = '#ceead6'; color = '#137333'; }
                if (isActive) { bg = '#004289'; border = '#004289'; color = '#fff'; }
                
                step.style.cssText = `display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: ${bg} !important; border: 1px solid ${border} !important; color: ${color} !important; white-space: nowrap !important;`;
            });
            
            document.querySelectorAll('.step-number').forEach(num => {
                const step = num.closest('.workflow-step');
                const isCompleted = step && step.classList.contains('completed');
                const isActive = step && step.classList.contains('active');
                
                let bg = '#f1f3f4', color = '#5f6368';
                if (isCompleted) { bg = '#137333'; color = '#fff'; }
                if (isActive) { bg = 'rgba(255,255,255,0.25)'; color = '#fff'; }
                
                num.style.cssText = `width: 18px !important; height: 18px !important; min-width: 18px !important; border-radius: 50% !important; background: ${bg} !important; color: ${color} !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 10px !important; font-weight: 500 !important;`;
            });
            
            document.querySelectorAll('.workflow-step-connector').forEach(conn => {
                const isCompleted = conn.classList.contains('completed');
                const bg = isCompleted ? '#137333' : '#dadce0';
                conn.style.cssText = `width: 20px !important; height: 2px !important; min-width: 20px !important; background: ${bg} !important; flex-shrink: 0 !important;`;
            });
            
            const docButtons = document.querySelector('.workflow-bar .document-access-buttons');
            if (docButtons) {
                docButtons.style.cssText = 'display: flex !important; gap: 8px !important; flex-wrap: nowrap !important; margin-left: 24px !important;';
            }
            
            document.querySelectorAll('.workflow-bar .doc-access-btn').forEach(btn => {
                btn.style.cssText = 'display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 8px 14px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 13px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;';
                
                // Style icons inside buttons
                const icon = btn.querySelector('.material-icons-outlined');
                if (icon) {
                    icon.style.cssText = 'font-size: 18px !important; color: #5f6368 !important;';
                }
            });
        }
        
        // Apply on load
        window.addEventListener('load', forceWorkflowStyles);
        document.addEventListener('DOMContentLoaded', forceWorkflowStyles);
        
    </script>
</body>
</html>
