<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISSŘ - Příprava řízení</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        /* ===========================================
           ISSŘ HLAVIČKA
           =========================================== */
        .issr-header {
            background-color: #004289;
            height: 56px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
        }

        .issr-header__logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: white;
        }

        .issr-header__logo-img {
            height: 40px;
            width: auto;
        }

        .issr-header__title {
            font-size: 12px;
            font-weight: 400;
            color: white;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .issr-header__search {
            flex: 1;
            max-width: 500px;
            margin: 0 40px;
        }

        .issr-header__search-input {
            width: 100%;
            height: 32px;
            padding: 0 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        }

        .issr-header__search-input::placeholder {
            color: #adb5bd;
        }

        .issr-header__actions {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
        }

        .issr-header__notification {
            position: relative;
            color: white;
            cursor: pointer;
        }

        .issr-header__notification-icon {
            width: 20px;
            height: 20px;
        }

        .issr-header__notification-badge {
            position: absolute;
            top: -6px;
            right: -8px;
            background-color: #0066cc;
            color: white;
            font-size: 10px;
            font-weight: 600;
            min-width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        .issr-header__user {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .issr-header__user-icon {
            width: 16px;
            height: 16px;
        }

        @media (max-width: 992px) {
            .issr-header__search {
                max-width: 300px;
                margin: 0 20px;
            }
            
            .issr-header__title {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .issr-header {
                padding: 0 16px;
            }
            
            .issr-header__search {
                display: none;
            }
        }

        /* ===========================================
           STYLY STRÁNKY
           =========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif !important;
            font-size: 13px !important;
            color: #333 !important;
            background: #f5f5f5 !important;
            line-height: 1.5 !important;
            text-align: left !important;
        }

        * {
            text-align: left !important;
        }

        .btn, .btn-primary, .btn-secondary, .btn-back, .control-card-action {
            text-align: center !important;
        }

        /* Main layout */
        .main-content {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 56px);
        }

        /* Case header - sticky */
        .case-header {
            background: #fff;
            position: sticky;
            top: 56px;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Workflow stepper */
        .workflow-bar {
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            padding: 10px 32px !important;
            background: #f8f9fa !important;
            border-bottom: 1px solid #e0e0e0 !important;
            flex-wrap: nowrap !important;
        }

        .workflow-stepper {
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            flex-wrap: nowrap !important;
        }

        .workflow-step {
            display: inline-flex !important;
            align-items: center !important;
            gap: 6px !important;
            padding: 6px 12px !important;
            border-radius: 16px !important;
            font-size: 12px !important;
            font-weight: 400 !important;
            color: #5f6368 !important;
            background: #fff !important;
            border: 1px solid #dadce0 !important;
            cursor: default !important;
            transition: all 0.15s !important;
            white-space: nowrap !important;
        }

        .workflow-step .step-number {
            width: 18px !important;
            height: 18px !important;
            min-width: 18px !important;
            border-radius: 50% !important;
            background: #f1f3f4 !important;
            color: #5f6368 !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 10px !important;
            font-weight: 500 !important;
        }

        .workflow-step.active {
            background: #004289 !important;
            border-color: #004289 !important;
            color: #fff !important;
        }

        .workflow-step.active .step-number {
            background: rgba(255,255,255,0.25) !important;
            color: #fff !important;
        }

        .workflow-step.completed {
            background: #e6f4ea !important;
            border-color: #ceead6 !important;
            color: #137333 !important;
        }

        .workflow-step.completed .step-number {
            background: #137333 !important;
            color: #fff !important;
        }

        .workflow-step-connector {
            width: 20px !important;
            height: 2px !important;
            min-width: 20px !important;
            background: #dadce0 !important;
            flex-shrink: 0 !important;
        }

        .workflow-step-connector.completed {
            background: #137333 !important;
        }

        .case-header-main {
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            border-bottom: 1px solid #f0f0f0;
        }

        .case-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* Akční tlačítka v hlavičce */
        .case-header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .header-action-btn:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }
        
        .header-action-btn .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .header-action-btn.has-issues {
            border-color: #f9ab00;
            background: #fef7e0;
        }
        
        .header-action-btn.has-issues:hover {
            background: #feefc3;
            border-color: #f29900;
        }
        
        .header-action-btn.has-issues .material-icons-outlined {
            color: #b06000;
        }
        
        .header-action-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: #ea4335;
            color: #fff;
            border-radius: 9px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .header-action-badge.warning {
            background: #f9ab00;
            color: #202124;
        }
        
        /* Dropdown menu pro Akce řízení */
        .action-dropdown {
            position: relative;
        }
        
        .action-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            min-width: 220px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
        }
        
        .action-dropdown-menu.open {
            display: block;
        }
        
        .action-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            font-size: 13px;
            color: #202124;
            cursor: pointer;
            transition: background 0.1s;
        }
        
        .action-dropdown-item:first-child {
            border-radius: 8px 8px 0 0;
        }
        
        .action-dropdown-item:last-child {
            border-radius: 0 0 8px 8px;
        }
        
        .action-dropdown-item:hover {
            background: #f1f3f4;
        }
        
        .action-dropdown-item .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .action-dropdown-item.danger {
            color: #c5221f;
        }
        
        .action-dropdown-item.danger .material-icons-outlined {
            color: #c5221f;
        }
        
        .action-dropdown-divider {
            height: 1px;
            background: #e8eaed;
            margin: 4px 0;
        }
        
        /* Slideout panel */
        .slideout-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            height: 100vh;
            background: #fff;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
        }
        
        .slideout-panel.open {
            right: 0;
        }
        
        .slideout-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .slideout-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        .slideout-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e8eaed;
            background: #f8f9fa;
        }
        
        .slideout-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 500;
            color: #202124;
        }
        
        .slideout-title .material-icons-outlined {
            font-size: 22px;
            color: #5f6368;
        }
        
        .slideout-close {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
            transition: background 0.15s;
        }
        
        .slideout-close:hover {
            background: #e8eaed;
        }
        
        .slideout-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .slideout-footer {
            padding: 16px 20px;
            border-top: 1px solid #e8eaed;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Sekce v slideout panelu nedostatků */
        .issues-group {
            margin-bottom: 24px;
        }
        
        .issues-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f1f3f4;
            border-radius: 6px;
            margin-bottom: 12px;
        }
        
        .issues-group-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }
        
        .issues-group-title .material-icons-outlined {
            font-size: 18px;
        }
        
        .issues-group-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .issues-group-badge.warning {
            background: #fef7e0;
            color: #b06000;
        }
        
        .issues-group-badge.error {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .issues-group-badge.info {
            background: #e8f4fd;
            color: #004289;
        }
        
        .global-issue-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #e8eaed;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .global-issue-item.resolved {
            background: #e6f4ea;
            border-color: #ceead6;
        }
        
        .global-issue-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .global-issue-icon.warning {
            background: #fef7e0;
            color: #b06000;
        }
        
        .global-issue-icon.error {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .global-issue-icon.resolved {
            background: #ceead6;
            color: #137333;
        }
        
        .global-issue-icon .material-icons-outlined {
            font-size: 14px;
        }
        
        .global-issue-content {
            flex: 1;
        }
        
        .global-issue-text {
            font-size: 13px;
            color: #202124;
            margin-bottom: 4px;
        }
        
        .global-issue-meta {
            font-size: 11px;
            color: #5f6368;
        }
        
        .global-issue-actions {
            display: flex;
            gap: 4px;
        }
        
        .global-issue-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
            transition: all 0.15s;
        }
        
        .global-issue-btn:hover {
            background: #f1f3f4;
        }
        
        .global-issue-btn.resolve:hover {
            background: #e6f4ea;
            border-color: #137333;
            color: #137333;
        }
        
        .global-issue-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Sekce v slideout panelu údaje řízení */
        .data-section {
            margin-bottom: 24px;
        }
        
        .data-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .data-section-title .material-icons-outlined {
            font-size: 18px;
        }
        
        .data-row {
            display: flex;
            align-items: flex-start;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .data-label {
            width: 140px;
            flex-shrink: 0;
            font-size: 12px;
            color: #5f6368;
            padding-top: 2px;
        }
        
        .data-value {
            flex: 1;
            font-size: 13px;
            color: #202124;
        }
        
        .data-value.editable {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .data-edit-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
            opacity: 0;
            transition: all 0.15s;
        }
        
        .data-row:hover .data-edit-btn {
            opacity: 1;
        }
        
        .data-edit-btn:hover {
            background: #e8eaed;
            color: #202124;
        }
        
        .data-edit-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        .data-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .data-list-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .data-list-item .material-icons-outlined {
            font-size: 16px;
            color: #5f6368;
        }

        .btn-back {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #dadce0;
            border-radius: 8px;
            background: #fff;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
        }

        .btn-back:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .case-info {
            flex: 1;
        }

        .case-number {
            font-size: 12px !important;
            color: #5f6368 !important;
            font-family: 'Roboto Mono', monospace !important;
            margin-bottom: 2px !important;
        }

        .case-title {
            font-size: 18px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .case-meta {
            display: flex !important;
            align-items: center !important;
            gap: 16px !important;
            margin-top: 4px !important;
        }

        .case-meta-item {
            display: inline-flex !important;
            align-items: center !important;
            gap: 4px !important;
            font-size: 12px !important;
            color: #5f6368 !important;
        }

        .case-meta-item .material-icons-outlined {
            font-size: 16px;
        }

        .case-meta-link {
            text-decoration: none;
            color: #1a73e8 !important;
            cursor: pointer;
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 4px;
            transition: background 0.15s;
        }
        .case-meta-link:hover {
            background: #e8f0fe;
        }
        .case-meta-link .material-icons-outlined {
            color: #1a73e8;
        }

        .case-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .case-badge.draft {
            background: #fef7e0;
            color: #b06000;
        }

        .case-badge.active {
            background: #e6f4ea;
            color: #137333;
        }

        .case-badge.fast {
            background: #e8f1fa;
            color: #004289;
        }

        /* Document access bar */
        .document-access-bar {
            background: #f8f9fa !important;
            border-top: 1px solid #e0e0e0 !important;
            padding: 10px 32px !important;
            display: flex !important;
            align-items: center !important;
            gap: 16px !important;
        }

        .document-access-label {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-weight: 500 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
        }

        .document-access-buttons {
            display: flex !important;
            gap: 8px !important;
            flex-wrap: nowrap !important;
            margin-left: 24px !important;
        }

        .doc-access-btn {
            display: inline-flex !important;
            align-items: center !important;
            gap: 6px !important;
            padding: 8px 14px !important;
            background: #fff !important;
            border: 1px solid #dadce0 !important;
            border-radius: 6px !important;
            font-size: 13px !important;
            font-weight: 400 !important;
            color: #202124 !important;
            cursor: pointer !important;
            transition: all 0.15s !important;
            text-decoration: none !important;
            white-space: nowrap !important;
            height: auto !important;
            min-height: 0 !important;
            line-height: 1.4 !important;
        }

        .doc-access-btn:hover {
            background: #e8f4fd !important;
            border-color: #004289 !important;
            color: #004289 !important;
        }

        .doc-access-btn .material-icons-outlined {
            font-size: 18px !important;
            color: #5f6368 !important;
        }

        .doc-access-btn:hover .material-icons-outlined {
            color: #004289 !important;
        }

        .doc-access-btn .badge {
            background: #004289 !important;
            color: #fff !important;
            padding: 2px 8px !important;
            border-radius: 10px !important;
            font-size: 11px !important;
            font-weight: 500 !important;
            margin-left: 2px !important;
        }

        /* Page content */
        .page-content {
            flex: 1;
            padding: 24px 32px;
        }

        /* Section header */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-title {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .section-title .material-icons-outlined {
            font-size: 24px !important;
            color: #004289 !important;
        }
        
        .section-customize-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            padding: 0;
            margin-left: 4px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .section-customize-btn:hover {
            background: #f1f3f4;
            border-color: #dadce0;
            color: #1a73e8;
        }
        
        .section-customize-btn .material-icons-outlined {
            font-size: 18px !important;
            color: inherit !important;
        }

        .section-progress {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            font-size: 13px !important;
            color: #5f6368 !important;
        }

        .progress-bar {
            width: 120px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #34a853;
            border-radius: 3px;
            transition: width 0.3s;
        }

        /* Control cards grid */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .control-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.15s;
        }

        .control-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .control-card.disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        .control-card-header {
            padding: 16px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }

        .control-card-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .control-card-icon .material-icons-outlined {
            font-size: 24px;
        }

        /* Status colors */
        .status-waiting .control-card-icon {
            background: #f5f5f5;
            color: #9aa0a6;
        }

        .status-ready .control-card-icon {
            background: #e8f1fa;
            color: #004289;
        }

        .status-in-progress .control-card-icon {
            background: #fef7e0;
            color: #b06000;
        }

        .status-done .control-card-icon {
            background: #e6f4ea;
            color: #137333;
        }

        .status-problem .control-card-icon {
            background: #fce8e6;
            color: #c5221f;
        }

        .control-card-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .status-waiting .control-card-status {
            background: #f5f5f5;
            color: #5f6368;
        }

        .status-ready .control-card-status {
            background: #e8f1fa;
            color: #004289;
        }

        .status-in-progress .control-card-status {
            background: #fef7e0;
            color: #b06000;
        }

        .status-done .control-card-status {
            background: #e6f4ea;
            color: #137333;
        }

        .status-problem .control-card-status {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .status-blocked .control-card-status {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .status-blocked .control-card-icon {
            background: #f5f5f5;
            color: #9aa0a6;
        }
        
        .status-blocked .control-card-title {
            color: #9aa0a6 !important;
        }
        
        .status-blocked .control-card-desc {
            color: #c5221f !important;
        }

        .control-card-body {
            padding: 0 16px 16px !important;
        }

        .control-card-title {
            font-size: 15px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .control-card-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            line-height: 1.4 !important;
            margin-bottom: 12px !important;
            font-style: normal !important;
        }

        .control-card-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            border: none;
        }

        .status-waiting .control-card-action {
            background: #f5f5f5;
            color: #9aa0a6;
            cursor: not-allowed;
        }

        .status-ready .control-card-action {
            background: #004289;
            color: #fff;
        }

        .status-ready .control-card-action:hover {
            background: #1b4d7a;
        }

        .status-in-progress .control-card-action {
            background: #fef7e0;
            color: #b06000;
            border: 1px solid #f5e6b3;
        }

        .status-done .control-card-action {
            background: #e6f4ea;
            color: #137333;
            border: 1px solid #ceead6;
        }

        .status-problem .control-card-action {
            background: #fce8e6;
            color: #c5221f;
            border: 1px solid #f5c6c3;
        }

        .control-card-action .material-icons-outlined {
            font-size: 18px;
        }

        /* Summary card */
        .summary-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
        }

        .summary-content {
            flex: 1;
        }

        .summary-title {
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .summary-desc {
            font-size: 13px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .summary-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
            border: 1px solid;
            white-space: nowrap;
        }

        .btn-primary {
            background: #004289;
            color: #fff;
            border-color: #004289;
        }

        .btn-primary:hover {
            background: #1b4d7a;
            border-color: #1b4d7a;
        }

        .btn-primary:disabled {
            background: #dadce0;
            border-color: #dadce0;
            color: #9aa0a6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #fff;
            color: #5f6368;
            border-color: #dadce0;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
            border-color: #5f6368;
        }

        .btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Popis stavby sekce */
        .popis-preview {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e8eaed;
            border-radius: 6px;
        }
        
        .popis-preview-text {
            flex: 1;
            font-size: 13px;
            color: #3c4043;
            line-height: 1.5;
            max-height: 60px;
            overflow: hidden;
            position: relative;
        }
        
        .popis-preview-text::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 24px;
            background: linear-gradient(transparent, #f8f9fa);
        }
        
        .popis-edit-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #1a73e8;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.15s;
        }
        
        .popis-edit-btn:hover {
            background: #e8f0fe;
            border-color: #1a73e8;
        }
        
        .popis-edit-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        .popis-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            line-height: 1.6;
            color: #202124;
            resize: vertical;
            min-height: 150px;
        }
        
        .popis-textarea:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .popis-ai-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .popis-ai-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .popis-ai-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .popis-ai-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        .popis-ai-btn .spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .popis-stavby-collapsed:hover {
            background: #f8f9fa;
            border-radius: 4px;
            margin: -4px;
            padding: 4px;
        }
        
        .popis-stavby-collapsed:hover .popis-expand-btn {
            background: #e8f0fe;
            border-color: #1a73e8;
        }
        
        .popis-expand-btn:hover {
            background: #e8f0fe !important;
            border-color: #1a73e8 !important;
        }

        /* Info panel */
        .info-panel {
            background: #e8f1fa;
            border: 1px solid #c5d9f0;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .info-panel .material-icons-outlined {
            font-size: 20px;
            color: #004289;
            flex-shrink: 0;
        }

        .info-panel-content {
            flex: 1;
        }

        .info-panel-title {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #1a4d7c !important;
            margin-bottom: 2px !important;
            font-style: normal !important;
        }

        .info-panel-text {
            font-size: 13px !important;
            color: #1a4d7c !important;
            font-style: normal !important;
        }

        .info-panel.warning {
            background: #fef7e0 !important;
            border-color: #f5e6b3 !important;
        }

        .info-panel.warning .material-icons-outlined {
            color: #b06000 !important;
        }

        .info-panel.warning .info-panel-title {
            color: #7a4200 !important;
        }

        .info-panel.warning .info-panel-text {
            color: #7a4200 !important;
        }

        .info-panel.error {
            background: #fce8e6 !important;
            border-color: #f5c6c3 !important;
        }

        .info-panel.error .material-icons-outlined {
            color: #c5221f !important;
        }

        .info-panel.error .info-panel-title {
            color: #a50e0e !important;
        }

        .info-panel.error .info-panel-text {
            color: #a50e0e !important;
        }

        .info-panel.schedule {
            background: #e8f1fa !important;
            border-color: #c2d9f2 !important;
        }

        .info-panel.schedule .material-icons-outlined {
            color: #004289 !important;
        }

        .info-panel.schedule .info-panel-title {
            color: #003366 !important;
        }

        .info-panel.schedule .info-panel-text {
            color: #003366 !important;
        }

        /* Phase tabs */
        .phase-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            background: #f1f3f4;
            padding: 4px;
            border-radius: 10px;
        }

        .phase-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #5f6368 !important;
            cursor: pointer;
            transition: all 0.2s;
            font-style: normal !important;
        }

        .phase-tab:hover {
            background: #e8eaed;
        }

        .phase-tab.active {
            background: #fff;
            color: #202124 !important;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .phase-tab .material-icons-outlined {
            font-size: 20px;
        }

        .phase-tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: #e8eaed;
            border-radius: 10px;
            font-size: 11px !important;
            font-weight: 600 !important;
        }

        .phase-tab.active .phase-tab-badge {
            background: #e8f0fe;
            color: #1a73e8;
        }

        .phase-tab-badge.done {
            background: #e6f4ea !important;
            color: #137333 !important;
        }

        .phase-content {
            display: none;
        }

        .phase-content.active {
            display: block;
        }

        /* Pozemky overlay styles */
        .parcels-readonly-section {
            margin-bottom: 24px;
        }

        .parcels-readonly-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .parcels-readonly-title .material-icons-outlined {
            font-size: 18px;
            color: #1a73e8;
        }

        .parcels-readonly-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: #e8f0fe;
            color: #1a73e8;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .parcel-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .parcel-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: #e8f0fe;
            border: 1px solid #c2d7f2;
            border-radius: 8px;
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .parcel-chip-icon {
            width: 24px;
            height: 24px;
            background: #1a73e8;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .parcel-chip-icon .material-icons-outlined {
            font-size: 16px;
            color: #fff;
        }

        .parcel-chip-content {
            display: flex;
            flex-direction: column;
        }

        .parcel-chip-number {
            font-weight: 500 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-size: 13px !important;
        }

        .parcel-chip-katastr {
            font-size: 11px !important;
            color: #5f6368 !important;
        }

        .parcel-chip-area {
            color: #5f6368 !important;
            font-size: 12px !important;
            margin-left: auto;
            padding-left: 12px;
        }

        /* Sousední pozemky - interaktivní */
        .parcels-interactive-section {
            margin-top: 0;
        }

        .parcels-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .parcels-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .parcels-section-title .material-icons-outlined {
            font-size: 18px;
            color: #f57c00;
        }

        .parcels-section-count {
            margin-left: auto;
            padding: 2px 8px;
            background: #fff3e0;
            color: #e65100;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .parcels-search-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .parcels-search-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px !important;
            font-style: normal !important;
        }

        .parcels-search-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .btn-search {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: #1a73e8;
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-search:hover {
            background: #1557b0;
        }

        .btn-map {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: #fff;
            color: #5f6368 !important;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-map:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }

        .btn-map .material-icons-outlined {
            font-size: 18px;
        }

        .sousedni-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 280px;
            overflow-y: auto;
        }

        .sousedni-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
        }

        .sousedni-item .parcel-chip-icon {
            background: #f57c00;
        }

        .sousedni-item-content {
            flex: 1;
        }

        .sousedni-item-number {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-style: normal !important;
        }

        .sousedni-item-katastr {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .sousedni-item-owner {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px;
            font-style: normal !important;
        }

        .sousedni-item-remove {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sousedni-item-remove:hover {
            background: #ffecb3;
            color: #e65100;
        }

        .sousedni-empty {
            padding: 32px 24px;
            text-align: center;
            background: #fafafa;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
        }

        .sousedni-empty .material-icons-outlined {
            font-size: 40px;
            color: #bdbdbd;
            margin-bottom: 12px;
        }

        .sousedni-empty-text {
            font-size: 14px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .sousedni-empty-hint {
            font-size: 12px !important;
            color: #9aa0a6 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        /* Auto-detect button */
        .btn-autodetect {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 13px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
            margin-bottom: 16px;
        }

        .btn-autodetect:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-autodetect .material-icons-outlined {
            font-size: 18px;
        }
        .status-warning .control-card-icon {
            background: #fef7e0 !important;
            color: #b06000 !important;
        }

        .status-warning .control-card-status {
            background: #fef7e0 !important;
            color: #b06000 !important;
        }

        .status-error .control-card-icon {
            background: #fce8e6 !important;
            color: #c5221f !important;
        }

        .status-error .control-card-status {
            background: #fce8e6 !important;
            color: #c5221f !important;
        }

        /* Výběr příslušného SÚ */
        .su-selection-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
            display: none;
        }

        .su-selection-section.visible {
            display: block;
        }

        .su-selection-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .su-selection-title .material-icons-outlined {
            font-size: 18px;
            color: #f57c00;
        }

        .su-selection-desc {
            font-size: 12px !important;
            color: #795548 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .su-select-wrapper {
            position: relative;
        }

        .su-select {
            width: 100%;
            padding: 12px 40px 12px 14px;
            font-size: 14px !important;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            color: #202124 !important;
            cursor: pointer;
            appearance: none;
            font-style: normal !important;
            font-family: 'Roboto', sans-serif !important;
        }

        .su-select:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .su-select-wrapper {
            position: relative;
        }

        /* Searchable dropdown */
        .su-search-select {
            position: relative;
        }
        
        .su-search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .su-search-icon {
            position: absolute;
            left: 12px;
            color: #5f6368;
            font-size: 20px;
            pointer-events: none;
        }
        
        .su-search-input {
            width: 100%;
            padding: 12px 40px 12px 42px;
            font-size: 14px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            color: #202124;
            font-family: 'Roboto', sans-serif;
            transition: all 0.15s;
        }
        
        .su-search-input:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }
        
        .su-search-input::placeholder {
            color: #9aa0a6;
        }
        
        .su-search-input.selected {
            background: #fff8e1;
            border-color: #f57c00;
        }
        
        .su-search-clear {
            position: absolute;
            right: 8px;
            width: 28px;
            height: 28px;
            display: none;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            color: #5f6368;
        }
        
        .su-search-clear:hover {
            background: #f1f3f4;
            color: #202124;
        }
        
        .su-search-input.selected + .su-search-clear {
            display: flex;
        }
        
        .su-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 320px;
            overflow-y: auto;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
            margin-top: 4px;
        }
        
        .su-dropdown.open {
            display: block;
        }
        
        .su-dropdown-group {
            border-bottom: 1px solid #f1f3f4;
        }
        
        .su-dropdown-group:last-of-type {
            border-bottom: none;
        }
        
        .su-dropdown-group.hidden {
            display: none;
        }
        
        .su-dropdown-group-title {
            padding: 10px 14px 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            color: #5f6368;
            background: #f8f9fa;
            position: sticky;
            top: 0;
        }
        
        .su-dropdown-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            cursor: pointer;
            transition: background 0.1s;
        }
        
        .su-dropdown-option:hover {
            background: #f1f3f4;
        }
        
        .su-dropdown-option.hidden {
            display: none;
        }
        
        .su-dropdown-option.selected {
            background: #fff8e1;
        }
        
        .su-option-name {
            font-size: 13px;
            color: #202124;
        }
        
        .su-option-type {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 2px 6px;
            background: #e8eaed;
            border-radius: 3px;
            color: #5f6368;
        }
        
        .su-dropdown-empty {
            padding: 24px;
            text-align: center;
            color: #9aa0a6;
        }
        
        .su-dropdown-empty .material-icons-outlined {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
        }

        .su-selected-info {
            margin-top: 12px;
            padding: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            display: none;
        }

        .su-selected-info.visible {
            display: block;
        }

        .su-selected-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .su-selected-icon {
            width: 32px;
            height: 32px;
            background: #e8f1fa;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .su-selected-icon .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .su-selected-name {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .su-selected-details {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        .su-selected-details span {
            display: block;
            margin-bottom: 2px;
        }

        /* Kontrola dokumentace - rozšířené styly */
        .doc-check-section {
            margin-bottom: 20px;
        }

        .doc-check-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .doc-check-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .doc-check-title .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .doc-check-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .doc-check-badge.pending {
            background: #f5f5f5;
            color: #5f6368;
        }

        .doc-check-badge.running {
            background: #e8f1fa;
            color: #004289;
        }

        .doc-check-badge.success {
            background: #e6f4ea;
            color: #137333;
        }

        .doc-check-badge.warning {
            background: #fef7e0;
            color: #b06000;
        }

        .doc-check-badge.error {
            background: #fce8e6;
            color: #c5221f;
        }

        /* Seznam dokumentů */
        .doc-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 280px;
            overflow-y: auto;
        }

        .doc-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .doc-item:hover {
            background: #e8f1fa;
            border-color: #c5d9f0;
        }

        .doc-item.checked {
            background: #e6f4ea;
            border-color: #ceead6;
        }

        .doc-item.has-issue {
            background: #fef7e0;
            border-color: #ffe082;
        }

        .doc-item-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #dadce0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .doc-item.checked .doc-item-checkbox {
            background: #137333;
            border-color: #137333;
            color: #fff;
        }

        .doc-item.has-issue .doc-item-checkbox {
            background: #f57c00;
            border-color: #f57c00;
            color: #fff;
        }

        .doc-item-checkbox .material-icons-outlined {
            font-size: 16px;
            display: none;
        }

        .doc-item.checked .doc-item-checkbox .material-icons-outlined,
        .doc-item.has-issue .doc-item-checkbox .material-icons-outlined {
            display: block;
        }

        .doc-item-content {
            flex: 1;
            min-width: 0;
        }

        .doc-item-name {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .doc-item-meta {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
            display: flex;
            gap: 12px;
            margin-top: 2px;
        }

        .doc-item-actions {
            display: flex;
            gap: 4px;
        }

        .doc-item-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .doc-item-btn:hover {
            background: rgba(0,0,0,0.08);
            color: #202124;
        }

        .doc-item-btn.issue-btn:hover {
            background: #fff3e0;
            color: #e65100;
        }

        .doc-item-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Automatická kontrola */
        .auto-check-section {
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .auto-check-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .auto-check-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .auto-check-title .material-icons-outlined {
            font-size: 18px;
            color: #7c3aed;
        }

        .btn-run-check {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 12px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-run-check:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-run-check:disabled {
            background: #dadce0;
            cursor: not-allowed;
        }

        .btn-run-check .material-icons-outlined {
            font-size: 16px;
        }

        /* ED stromová struktura */
        .ed-tree {
            font-size: 13px;
        }

        .ed-tree-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background: #e8f1fa;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .ed-tree-header-top {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ed-tree-header .material-icons-outlined {
            font-size: 20px;
            color: #004289;
        }

        .ed-version-selector {
            display: flex;
            align-items: center;
            padding-top: 8px;
            border-top: 1px solid #c5d9f0;
        }

        .ed-version-select {
            padding: 6px 10px;
            border: 1px solid #c5d9f0;
            border-radius: 4px;
            font-size: 12px;
            background: #fff;
            color: #202124;
            cursor: pointer;
            flex: 1;
        }

        .ed-version-select:focus {
            outline: none;
            border-color: #004289;
            box-shadow: 0 0 0 2px rgba(35, 98, 162, 0.2);
        }

        /* ED Breadcrumb a tlačítko Zpět */
        .ed-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 8px;
        }
        
        .ed-back-btn {
            background: #e8f0fe !important;
            border-color: #1a73e8 !important;
            color: #1a73e8 !important;
        }
        
        .ed-back-btn:hover {
            background: #d2e3fc !important;
        }
        
        /* Kategorie stavby styly */
        .stavba-kategorie-section {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .stavba-kategorie-section .control-section-title {
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .stavba-field {
            margin-bottom: 16px;
        }
        
        .stavba-field:last-child {
            margin-bottom: 0;
        }
        
        .stavba-field-label {
            font-size: 12px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 8px;
        }
        
        .stavba-field-hint {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: #5f6368;
            margin-top: 6px;
        }
        
        .stavba-field-hint .material-icons-outlined {
            font-size: 14px;
        }
        
        .stavba-toggle-group {
            display: flex;
            gap: 8px;
        }
        
        .stavba-toggle {
            cursor: pointer;
        }
        
        .stavba-toggle input {
            display: none;
        }
        
        .stavba-toggle-label {
            display: inline-block;
            padding: 8px 20px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            transition: all 0.15s;
        }
        
        .stavba-toggle input:checked + .stavba-toggle-label {
            background: #e8f0fe;
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .stavba-kategorie-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .stavba-kategorie-option {
            cursor: pointer;
        }
        
        .stavba-kategorie-option input {
            display: none;
        }
        
        .stavba-kategorie-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 8px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            transition: all 0.15s;
        }
        
        .stavba-kategorie-option input:checked + .stavba-kategorie-box {
            background: #e8f0fe;
            border-color: #1a73e8;
        }
        
        .stavba-kategorie-box:hover {
            border-color: #bdc1c6;
        }
        
        .kategorie-name {
            font-size: 13px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 2px;
        }
        
        .kategorie-desc {
            font-size: 10px;
            color: #5f6368;
        }
        
        /* Soubor staveb */
        .stavba-soubor-wrapper {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .stavba-soubor-item {
            border-bottom: 1px solid #e0e0e0;
        }
        
        .stavba-soubor-item:last-child {
            border-bottom: none;
        }
        
        .stavba-soubor-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: #f8f9fa;
            font-size: 12px;
            font-weight: 600;
            color: #202124;
        }
        
        .stavba-soubor-header .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .stavba-soubor-item.hlavni .stavba-soubor-header {
            background: #fff8e1;
        }
        
        .stavba-soubor-item.hlavni .stavba-soubor-header .material-icons-outlined {
            color: #f57c00;
        }
        
        .stavba-soubor-badge {
            font-size: 10px;
            font-weight: 500;
            padding: 2px 6px;
            background: #f57c00;
            color: #fff;
            border-radius: 4px;
            margin-left: auto;
        }
        
        .stavba-soubor-content {
            padding: 12px;
        }
        
        .stavba-soubor-nazev {
            margin-bottom: 10px;
        }
        
        .stavba-input {
            width: 100%;
            padding: 8px 12px;
            font-size: 13px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-family: inherit;
        }
        
        .stavba-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .stavba-kategorie-mini {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .kategorie-mini-option {
            cursor: pointer;
        }
        
        .kategorie-mini-option input {
            display: none;
        }
        
        .kategorie-mini-option span {
            display: inline-block;
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 500;
            background: #f1f3f4;
            border: 1px solid transparent;
            border-radius: 4px;
            color: #5f6368;
            transition: all 0.15s;
        }
        
        .kategorie-mini-option input:checked + span {
            background: #e8f0fe;
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .vedlejsi-stavby-list {
            margin-bottom: 10px;
        }
        
        .vedlejsi-stavba-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }
        
        .vedlejsi-stavba-row .stavba-input {
            flex: 1;
        }
        
        .stavba-select {
            padding: 8px 12px;
            font-size: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            font-family: inherit;
            min-width: 100px;
        }
        
        .stavba-select:focus {
            outline: none;
            border-color: #1a73e8;
        }
        
        .vedlejsi-remove {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            color: #5f6368;
        }
        
        .vedlejsi-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .vedlejsi-remove .material-icons-outlined {
            font-size: 18px;
        }
        
        .btn-add-vedlejsi {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            color: #1a73e8;
            background: transparent;
            border: 1px dashed #1a73e8;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-add-vedlejsi:hover {
            background: #e8f0fe;
        }
        
        .btn-add-vedlejsi .material-icons-outlined {
            font-size: 16px;
        }
        
        .stavba-soubor-summary {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            padding: 10px 12px;
            background: #e8f5e9;
            border-radius: 6px;
            font-size: 12px;
            color: #1b5e20;
        }
        
        .stavba-soubor-summary .material-icons-outlined {
            font-size: 18px;
        }

        .ed-folder {
            margin-left: 0;
            margin-bottom: 2px;
        }

        .ed-folder.nested {
            margin-left: 20px;
        }

        .ed-folder-header {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .ed-folder-header:hover {
            background: #f5f5f5;
        }

        .ed-folder-header .folder-icon {
            font-size: 18px;
            color: #f9a825;
            transition: transform 0.2s;
        }

        .ed-folder.open > .ed-folder-header .folder-icon {
            color: #f57c00;
        }

        .ed-folder-header .folder-name {
            flex: 1;
            font-weight: 500;
            color: #202124;
        }

        .ed-folder-header .folder-count {
            font-size: 11px;
            color: #5f6368;
            padding: 2px 8px;
            background: #f1f3f4;
            border-radius: 10px;
        }

        .ed-folder-content {
            display: none;
            margin-left: 24px;
            padding-left: 12px;
            border-left: 1px solid #e0e0e0;
        }

        .ed-folder.open > .ed-folder-content {
            display: block;
        }

        .ed-file {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .ed-file:hover {
            background: #e8f1fa;
        }

        .ed-file .material-icons-outlined {
            font-size: 16px;
            color: #c62828;
        }

        .ed-file .file-name {
            flex: 1;
            color: #202124;
        }

        .ed-file .file-size {
            font-size: 11px;
            color: #5f6368;
        }

        .ed-file-more {
            padding: 6px 10px;
            font-size: 12px;
            color: #5f6368;
            font-style: italic;
        }

        .ed-folder.empty .ed-folder-header {
            cursor: default;
        }

        .ed-folder.empty .ed-folder-header:hover {
            background: transparent;
        }

        /* Kontrola částí dokumentace */
        .doc-parts-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .doc-part-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .doc-part-item.status-ok {
            background: #e6f4ea;
            border-color: #ceead6;
        }

        .doc-part-item.status-warning {
            background: #fef7e0;
            border-color: #ffe082;
        }

        .doc-part-item.status-error {
            background: #fce8e6;
            border-color: #f5c6c3;
        }

        .doc-part-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .doc-part-letter {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #004289;
            color: #fff;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
        }

        .doc-part-item.status-ok .doc-part-letter {
            background: #137333;
        }

        .doc-part-item.status-warning .doc-part-letter {
            background: #f57c00;
        }

        .doc-part-item.status-error .doc-part-letter {
            background: #c5221f;
        }

        .doc-part-name {
            font-weight: 500;
            color: #202124;
        }

        .doc-part-status {
            display: flex;
            gap: 4px;
        }

        .doc-part-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            color: #9aa0a6;
        }

        .doc-part-btn:hover {
            border-color: #5f6368;
        }

        .doc-part-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Nekontrolováno - šedé zaškrtnutí */
        .doc-part-btn.ok.unchecked {
            background: #f1f3f4;
            border-color: #dadce0;
            color: #9aa0a6;
        }

        .doc-part-btn.ok.active {
            background: #137333;
            border-color: #137333;
            color: #fff;
        }

        .doc-part-btn.warning.active {
            background: #f57c00;
            border-color: #f57c00;
            color: #fff;
        }

        .doc-part-btn.error.active {
            background: #c5221f;
            border-color: #c5221f;
            color: #fff;
        }

        /* Sekce nedostatků podle částí dokumentace */
        .doc-part-item {
            display: flex;
            align-items: center;
        }
        
        .part-issues-section {
            background: #fef7f6;
            border: 1px solid #f5c6c5;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .part-issues-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
            color: #c5221f;
            margin-bottom: 12px;
        }
        
        .part-issues-header .part-letter {
            width: 24px;
            height: 24px;
            background: #c5221f;
            color: #fff;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }
        
        .part-issues-list {
            margin-bottom: 12px;
        }
        
        .part-issue-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #e8eaed;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .part-issue-item:last-child {
            margin-bottom: 0;
        }
        
        .part-issue-icon {
            width: 20px;
            height: 20px;
            background: #fce8e6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .part-issue-icon .material-icons-outlined {
            font-size: 12px;
            color: #c5221f;
        }
        
        .part-issue-content {
            flex: 1;
            font-size: 13px;
            color: #202124;
            line-height: 1.5;
        }
        
        .part-issue-remove {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9aa0a6;
            transition: all 0.15s;
            flex-shrink: 0;
        }
        
        .part-issue-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .part-issue-remove .material-icons-outlined {
            font-size: 16px;
        }
        
        .part-issues-add {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .part-issue-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            background: #fff;
            color: #202124;
            resize: vertical;
            min-height: 70px;
            line-height: 1.5;
        }
        
        .part-issue-textarea:focus {
            outline: none;
            border-color: #c5221f;
            box-shadow: 0 0 0 2px rgba(197, 34, 31, 0.1);
        }
        
        .part-issue-textarea::placeholder {
            color: #9aa0a6;
        }
        
        .btn-add-part-issue {
            align-self: flex-start;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #c5221f;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #c5221f;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-add-part-issue:hover {
            background: #fce8e6;
        }
        
        .btn-add-part-issue .material-icons-outlined {
            font-size: 18px;
        }
        
        .issues-empty {
            text-align: center;
            padding: 30px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #dadce0;
        }
        
        /* Auto issues sekce - modrá varianta */
        #autoIssuesSection {
            background: #e8f4fd;
            border-color: #c2e0ff;
        }
        
        #autoIssuesSection .part-issues-header {
            color: #1a73e8;
        }
        
        #autoIssuesSection .part-issue-icon {
            background: #d2e3fc;
        }
        
        #autoIssuesSection .part-issue-icon .material-icons-outlined {
            color: #1a73e8;
        }

        /* Pozemky - rozšířené styly */
        .pozemky-section {
            margin-bottom: 20px;
        }

        .pozemky-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .pozemky-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .pozemky-section-title .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .pozemky-section-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            background: #e8f1fa;
            color: #004289;
        }

        /* Metoda výběru sousedů */
        .neighbor-method-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .neighbor-method-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: all 0.15s;
        }

        .neighbor-method-btn:hover {
            border-color: #004289;
            background: #f8fbff;
        }

        .neighbor-method-btn.active {
            border-color: #004289;
            background: #e8f1fa;
        }

        .neighbor-method-btn .material-icons-outlined {
            font-size: 24px;
            color: #5f6368;
        }

        .neighbor-method-btn.active .material-icons-outlined {
            color: #004289;
        }

        .neighbor-method-btn span:last-child {
            font-size: 11px;
            color: #5f6368;
            text-align: center;
        }

        .neighbor-method-btn.active span:last-child {
            color: #004289;
            font-weight: 500;
        }

        /* Polygon input */
        .polygon-input-section {
            display: none;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .polygon-input-section.visible {
            display: block;
        }

        .polygon-input-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .polygon-input-label {
            font-size: 13px;
            color: #202124;
            white-space: nowrap;
        }

        .polygon-input {
            width: 80px;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }

        .polygon-input:focus {
            outline: none;
            border-color: #004289;
            box-shadow: 0 0 0 2px rgba(35, 98, 162, 0.2);
        }

        .polygon-input-unit {
            font-size: 13px;
            color: #5f6368;
        }

        .btn-generate-polygon {
            margin-left: auto;
            padding: 8px 16px;
            background: #004289;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-generate-polygon:hover {
            background: #1a4a7a;
        }

        /* Ověření KN */
        .kn-verify-section {
            margin-top: 20px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .kn-verify-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .kn-verify-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .kn-verify-title .material-icons-outlined {
            font-size: 18px;
            color: #7c3aed;
        }

        .btn-verify-kn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-verify-kn:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
        }

        .btn-verify-kn:disabled {
            background: #dadce0;
            cursor: not-allowed;
        }

        .kn-verify-results {
            display: none;
        }

        .kn-verify-results.visible {
            display: block;
        }

        /* Vlastníci z KN */
        .owner-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .owner-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .owner-item.verified {
            border-color: #ceead6;
            background: #f0faf3;
        }

        .owner-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e8f1fa;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .owner-item-icon .material-icons-outlined {
            font-size: 18px;
            color: #004289;
        }

        .owner-item-content {
            flex: 1;
            min-width: 0;
        }

        .owner-item-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .owner-item-parcels {
            font-size: 11px;
            color: #5f6368;
        }

        .owner-item-relations {
            display: flex;
            gap: 6px;
            margin-top: 4px;
        }

        .owner-relation-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }

        .owner-relation-badge.vlastnik {
            background: #e8f1fa;
            color: #004289;
        }

        .owner-relation-badge.zastava {
            background: #fef7e0;
            color: #b06000;
        }

        .owner-relation-badge.vecne-bremeno {
            background: #fce8e6;
            color: #c5221f;
        }

        .owner-item-actions {
            display: flex;
            gap: 4px;
        }

        .owner-item-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .owner-item-btn:hover {
            background: rgba(0,0,0,0.08);
            color: #202124;
        }

        .owner-item-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Účastníci info */
        .ucastnici-info {
            margin-top: 16px;
            padding: 12px;
            background: #e6f4ea;
            border: 1px solid #ceead6;
            border-radius: 8px;
            display: none;
        }

        .ucastnici-info.visible {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ucastnici-info .material-icons-outlined {
            font-size: 20px;
            color: #137333;
        }

        .ucastnici-info-text {
            font-size: 13px;
            color: #137333;
        }

        /* Parcel chip rozšířený */
        .parcel-chip-extended {
            display: flex;
            flex-direction: column;
            padding: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .parcel-chip-extended.verified {
            border-color: #ceead6;
            background: #f0faf3;
        }

        .parcel-chip-extended-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .parcel-chip-extended-info {
            flex: 1;
        }

        .parcel-chip-extended-number {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
        }

        .parcel-chip-extended-katastr {
            font-size: 12px;
            color: #5f6368;
        }

        .parcel-chip-extended-owner {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #5f6368;
        }

        .parcel-chip-extended-owner strong {
            color: #202124;
        }

        /* Pozemky záměru - editovatelné */
        
        /* Přepínač zobrazení pozemků */
        .pozemky-view-toggle {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            margin-left: 8px;
            background: #f1f3f4;
            border-radius: 4px;
            padding: 2px;
        }
        
        .pozemky-view-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 20px;
            border: none;
            background: transparent;
            border-radius: 3px;
            color: #5f6368;
            cursor: pointer;
            padding: 0;
        }
        
        .pozemky-view-btn:hover {
            background: #e0e0e0;
        }
        
        .pozemky-view-btn.active {
            background: #fff;
            color: #1a73e8;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .pozemky-view-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Kompaktní chip prezentace pozemků */
        .pozemky-chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .pozemek-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px 4px 10px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            font-size: 12px;
            color: #202124;
            white-space: nowrap;
            transition: all 0.15s;
        }
        
        .pozemek-chip:hover {
            background: #fff;
            border-color: #dadce0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .pozemek-chip.zamer {
            background: #e8f0fe;
            border-color: #c2d7f7;
        }
        
        .pozemek-chip.zamer:hover {
            background: #d2e3fc;
            border-color: #1a73e8;
        }
        
        .pozemek-chip.soused {
            background: #f1f3f4;
            border-color: #dadce0;
        }
        
        .pozemek-chip .chip-icon {
            font-size: 14px;
            color: #5f6368;
        }
        
        .pozemek-chip.zamer .chip-icon {
            color: #1a73e8;
        }
        
        .pozemek-chip .chip-parcela {
            font-weight: 500;
        }
        
        .pozemek-chip .chip-ku {
            font-size: 10px;
            color: #80868b;
            margin-left: 2px;
        }
        
        .pozemek-chip .chip-remove {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border: none;
            background: transparent;
            border-radius: 50%;
            color: #9aa0a6;
            cursor: pointer;
            padding: 0;
            margin-left: 2px;
        }
        
        .pozemek-chip .chip-remove:hover {
            background: rgba(0,0,0,0.08);
            color: #c5221f;
        }
        
        .pozemek-chip .chip-remove .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Řádkové zobrazení pozemků */
        .pozemky-list-container {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        /* Hlavička tabulky s řazením */
        .pozemky-list-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: #f8f9fa;
            font-size: 11px;
            font-weight: 500;
            color: #5f6368;
            border-bottom: 1px solid #e0e0e0;
            user-select: none;
        }
        
        .pozemky-list-header .header-col {
            display: flex;
            align-items: center;
            gap: 2px;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background 0.15s;
        }
        
        .pozemky-list-header .header-col:hover {
            background: #e8e8e8;
        }
        
        .pozemky-list-header .header-col.active {
            color: #1a73e8;
            background: #e8f0fe;
        }
        
        .pozemky-list-header .header-col .sort-icon {
            font-size: 14px;
            opacity: 0.4;
        }
        
        .pozemky-list-header .header-col.active .sort-icon {
            opacity: 1;
        }
        
        .pozemky-list-header .header-col.asc .sort-icon {
            transform: rotate(180deg);
        }
        
        .pozemky-list-header .col-icon { width: 20px; }
        .pozemky-list-header .col-parcela { min-width: 70px; }
        .pozemky-list-header .col-katastr { min-width: 120px; }
        .pozemky-list-header .col-kod { min-width: 60px; }
        .pozemky-list-header .col-plocha { min-width: 70px; text-align: right; }
        .pozemky-list-header .col-actions { width: 20px; margin-left: auto; }
        
        .pozemek-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: #fff;
            font-size: 12px;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .pozemek-row:last-child {
            border-bottom: none;
        }
        
        .pozemek-row:hover {
            background: #f8f9fa;
        }
        
        .pozemek-row.zamer {
            background: #f8fbff;
        }
        
        .pozemek-row.zamer:hover {
            background: #eef5fc;
        }
        
        .pozemek-row .row-icon {
            font-size: 16px;
            color: #5f6368;
            width: 20px;
            text-align: center;
        }
        
        .pozemek-row.zamer .row-icon {
            color: #1a73e8;
        }
        
        .pozemek-row .row-parcela {
            font-weight: 600;
            min-width: 70px;
            color: #202124;
        }
        
        .pozemek-row .row-katastr {
            color: #5f6368;
            min-width: 120px;
        }
        
        .pozemek-row .row-kod {
            color: #9aa0a6;
            font-size: 11px;
            min-width: 60px;
        }
        
        .pozemek-row .row-plocha {
            color: #5f6368;
            min-width: 70px;
            text-align: right;
        }
        
        .pozemek-row .row-remove {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #9aa0a6;
            cursor: pointer;
            padding: 0;
            margin-left: auto;
        }
        
        .pozemek-row .row-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .pozemek-row .row-remove .material-icons-outlined {
            font-size: 16px;
        }
        }
        
        .parcel-chip-extended-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .parcel-chip-extended .parcel-chip-remove {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #9aa0a6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            flex-shrink: 0;
        }

        .parcel-chip-extended .parcel-chip-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }

        .parcel-chip-extended .parcel-chip-remove .material-icons-outlined {
            font-size: 18px;
        }

        /* ==========================================
           SESKUPENÉ ZOBRAZENÍ POZEMKŮ PODLE K.Ú.
           ========================================== */
        .pozemky-grouped-container {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        /* Vyhledávací panel */
        .pozemky-grouped-search {
            display: flex;
            gap: 8px;
            padding: 10px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .pozemky-search-field {
            position: relative;
            flex: 1;
        }
        
        .pozemky-search-field .material-icons-outlined {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: #9aa0a6;
            pointer-events: none;
        }
        
        .pozemky-search-input {
            width: 100%;
            padding: 7px 10px 7px 34px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            background: #fff;
        }
        
        .pozemky-search-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
        }
        
        .pozemky-search-input::placeholder {
            color: #9aa0a6;
        }
        
        .pozemky-filter-select {
            min-width: 160px;
            padding: 7px 30px 7px 10px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            background: #fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='%235f6368'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E") no-repeat right 8px center;
            appearance: none;
            cursor: pointer;
        }
        
        .pozemky-filter-select:focus {
            outline: none;
            border-color: #1a73e8;
        }
        
        /* Skupina k.ú. */
        .pozemky-ku-group {
            border-bottom: 1px solid #e0e0e0;
        }
        
        .pozemky-ku-group:last-child {
            border-bottom: none;
        }
        
        .pozemky-ku-group.hidden {
            display: none;
        }
        
        .pozemky-ku-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: #fff;
            cursor: pointer;
            user-select: none;
            transition: background 0.15s;
        }
        
        .pozemky-ku-header:hover {
            background: #f8f9fa;
        }
        
        .pozemky-ku-header.expanded {
            background: #e8f0fe;
            border-bottom: 1px solid #c2dbfc;
        }
        
        .pozemky-ku-expand {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: transform 0.2s, background 0.15s;
        }
        
        .pozemky-ku-header:hover .pozemky-ku-expand {
            background: #e0e0e0;
        }
        
        .pozemky-ku-header.expanded .pozemky-ku-expand {
            transform: rotate(90deg);
            background: #c2dbfc;
        }
        
        .pozemky-ku-expand .material-icons-outlined {
            font-size: 20px;
            color: #5f6368;
        }
        
        .pozemky-ku-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pozemky-ku-name {
            font-size: 13px;
            font-weight: 600;
            color: #202124;
        }
        
        .pozemky-ku-code {
            font-size: 11px;
            color: #9aa0a6;
        }
        
        .pozemky-ku-count {
            padding: 2px 8px;
            background: #e8eaed;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            color: #5f6368;
        }
        
        .pozemky-ku-header.expanded .pozemky-ku-count {
            background: #1a73e8;
            color: #fff;
        }
        
        /* Seznam pozemků ve skupině */
        .pozemky-ku-content {
            display: none;
            background: #fafbfc;
        }
        
        .pozemky-ku-group.expanded .pozemky-ku-content {
            display: block;
        }
        
        .pozemky-ku-list {
            padding: 0;
        }
        
        .pozemky-ku-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px 8px 46px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 12px;
            transition: background 0.15s;
        }
        
        .pozemky-ku-row:last-child {
            border-bottom: none;
        }
        
        .pozemky-ku-row:hover {
            background: #f0f4f9;
        }
        
        .pozemky-ku-row.highlighted {
            background: #fff8e1;
            animation: highlightPulse 1s ease;
        }
        
        @keyframes highlightPulse {
            0%, 100% { background: #fff8e1; }
            50% { background: #fff3c4; }
        }
        
        .pozemky-ku-row.hidden {
            display: none;
        }
        
        .pozemky-ku-row .row-icon {
            font-size: 16px;
            color: #5f6368;
            width: 20px;
            text-align: center;
        }
        
        .pozemky-ku-row.zamer .row-icon {
            color: #1a73e8;
        }
        
        .pozemky-ku-row .row-parcela {
            font-weight: 600;
            min-width: 80px;
            color: #202124;
        }
        
        .pozemky-ku-row .row-typ {
            color: #5f6368;
            min-width: 100px;
        }
        
        .pozemky-ku-row .row-plocha {
            color: #5f6368;
            min-width: 70px;
            text-align: right;
        }
        
        .pozemky-ku-row .row-remove {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #9aa0a6;
            cursor: pointer;
            padding: 0;
            margin-left: auto;
        }
        
        .pozemky-ku-row .row-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .pozemky-ku-row .row-remove .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Prázdný stav vyhledávání */
        .pozemky-no-results {
            padding: 24px;
            text-align: center;
            color: #5f6368;
            font-size: 13px;
        }
        
        .pozemky-no-results .material-icons-outlined {
            font-size: 32px;
            color: #9aa0a6;
            display: block;
            margin-bottom: 8px;
        }

        /* ==========================================
           INTERAKTIVNÍ KATASTRÁLNÍ MAPA
           ========================================== */
        .katastr-map-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #f5f7f5;
        }
        
        /* Horní panel s ovládáním */
        .katastr-map-toolbar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        
        .katastr-map-title {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            color: #202124;
        }
        
        .katastr-map-title .material-icons-outlined {
            font-size: 18px;
            color: #1a73e8;
        }
        
        .katastr-map-zoom {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: auto;
        }
        
        .katastr-zoom-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        
        .katastr-zoom-btn:hover {
            background: #f1f3f4;
            border-color: #1a73e8;
        }
        
        .katastr-zoom-btn .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .katastr-zoom-level {
            font-size: 11px;
            color: #5f6368;
            min-width: 40px;
            text-align: center;
        }
        
        .katastr-layers-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 5px 10px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 4px;
            font-size: 11px;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .katastr-layers-btn:hover {
            background: #f1f3f4;
        }
        
        .katastr-layers-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Hlavní oblast mapy */
        .katastr-map-viewport {
            flex: 1;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }
        
        .katastr-map-viewport:active {
            cursor: grabbing;
        }
        
        .katastr-map-svg {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        /* Styly pro parcely */
        .parcela-polygon {
            stroke: #5f6368;
            stroke-width: 1;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        /* Typy parcel */
        .parcela-polygon.typ-ornapuda {
            fill: #f5e6c8;
        }
        
        .parcela-polygon.typ-travni {
            fill: #c8e6c9;
        }
        
        .parcela-polygon.typ-zastavena {
            fill: #ffcdd2;
        }
        
        .parcela-polygon.typ-les {
            fill: #a5d6a7;
        }
        
        .parcela-polygon.typ-voda {
            fill: #b3e5fc;
        }
        
        .parcela-polygon.typ-zahrada {
            fill: #dcedc8;
        }
        
        .parcela-polygon.typ-ostatni {
            fill: #e0e0e0;
        }
        
        /* Hover efekt */
        .parcela-polygon:hover {
            stroke: #1a73e8;
            stroke-width: 2;
            filter: brightness(1.05);
        }
        
        /* Vybraná parcela */
        .parcela-polygon.selected {
            stroke: #f9a825;
            stroke-width: 3;
            filter: brightness(1.1);
        }
        
        /* Pozemky záměru */
        .parcela-polygon.zamer {
            stroke: #1a73e8;
            stroke-width: 2;
            stroke-dasharray: none;
        }
        
        .parcela-polygon.zamer::after {
            content: '';
        }
        
        /* Sousední pozemky */
        .parcela-polygon.soused {
            stroke: #34a853;
            stroke-width: 2;
        }
        
        /* Budovy */
        .budova-polygon {
            fill: #795548;
            stroke: #5d4037;
            stroke-width: 1;
            cursor: pointer;
        }
        
        .budova-polygon:hover {
            fill: #8d6e63;
        }
        
        /* Čísla parcel */
        .parcela-label {
            font-size: 10px;
            font-family: Arial, sans-serif;
            fill: #37474f;
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
            font-weight: 500;
        }
        
        .parcela-label.large {
            font-size: 12px;
        }
        
        .parcela-label.stavebni {
            font-size: 9px;
            fill: #5d4037;
        }
        
        /* Hranice k.ú. */
        .ku-boundary {
            fill: none;
            stroke: #e91e63;
            stroke-width: 2;
            stroke-dasharray: 8 4;
            pointer-events: none;
        }
        
        /* Cesty */
        .cesta-line {
            fill: none;
            stroke: #9e9e9e;
            stroke-width: 6;
        }
        
        .cesta-line.hlavni {
            stroke: #ffc107;
            stroke-width: 8;
        }
        
        /* Mini mapa v rohu */
        .katastr-minimap {
            position: absolute;
            bottom: 12px;
            left: 12px;
            width: 120px;
            height: 90px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .katastr-minimap svg {
            width: 100%;
            height: 100%;
        }
        
        .minimap-viewport {
            fill: rgba(26, 115, 232, 0.2);
            stroke: #1a73e8;
            stroke-width: 2;
        }
        
        /* Měřítko */
        .katastr-scale {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: rgba(255,255,255,0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            color: #5f6368;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .katastr-scale-bar {
            width: 50px;
            height: 4px;
            background: linear-gradient(to right, #202124 50%, transparent 50%);
            background-size: 10px 4px;
            border: 1px solid #202124;
        }
        
        /* Legenda */
        .katastr-legend {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(255,255,255,0.95);
            border: 1px solid #dadce0;
            border-radius: 6px;
            padding: 8px 10px;
            font-size: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .katastr-legend-title {
            font-weight: 600;
            margin-bottom: 6px;
            color: #202124;
        }
        
        .katastr-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 3px;
        }
        
        .katastr-legend-color {
            width: 14px;
            height: 10px;
            border-radius: 2px;
            border: 1px solid rgba(0,0,0,0.2);
        }
        
        /* Info panel vybrané parcely */
        .katastr-info-panel {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            min-width: 280px;
        }
        
        .katastr-info-panel.visible {
            display: block;
        }
        
        .katastr-info-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .katastr-info-parcela {
            font-size: 16px;
            font-weight: 700;
            color: #202124;
        }
        
        .katastr-info-close {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .katastr-info-close:hover {
            background: #f1f3f4;
        }
        
        .katastr-info-close .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .katastr-info-details {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 4px 12px;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .katastr-info-label {
            color: #5f6368;
        }
        
        .katastr-info-value {
            color: #202124;
            font-weight: 500;
        }
        
        .katastr-info-actions {
            display: flex;
            gap: 8px;
        }
        
        .katastr-info-btn {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.15s;
        }
        
        .katastr-info-btn:hover {
            background: #f1f3f4;
        }
        
        .katastr-info-btn.primary {
            background: #1a73e8;
            border-color: #1a73e8;
            color: #fff;
        }
        
        .katastr-info-btn.primary:hover {
            background: #1557b0;
        }
        
        .katastr-info-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Tooltip při hoveru */
        .katastr-tooltip {
            position: absolute;
            background: rgba(32, 33, 36, 0.9);
            color: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            pointer-events: none;
            z-index: 100;
            white-space: nowrap;
            display: none;
        }
        
        .katastr-tooltip.visible {
            display: block;
        }
        
        /* Vyhledávání k.ú. */
        .katastr-search-container {
            position: relative;
            display: flex;
            align-items: center;
            background: #f1f3f4;
            border-radius: 6px;
            padding: 0 10px;
            flex: 1;
            max-width: 280px;
        }
        
        .katastr-search-container > .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .katastr-search-input {
            border: none;
            background: transparent;
            padding: 7px 10px;
            font-size: 12px;
            width: 100%;
            outline: none;
        }
        
        .katastr-search-input::placeholder {
            color: #9aa0a6;
        }
        
        .katastr-search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 4px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 200;
            display: none;
            max-height: 280px;
            overflow-y: auto;
        }
        
        .katastr-search-dropdown.visible {
            display: block;
        }
        
        .katastr-search-group {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .katastr-search-group:last-child {
            border-bottom: none;
        }
        
        .katastr-search-group-title {
            padding: 4px 12px;
            font-size: 10px;
            font-weight: 600;
            color: #9aa0a6;
            text-transform: uppercase;
        }
        
        .katastr-search-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            color: #202124;
        }
        
        .katastr-search-item:hover {
            background: #f1f3f4;
        }
        
        .katastr-search-item .material-icons-outlined {
            font-size: 16px;
            color: #5f6368;
        }
        
        /* Toolbar separator a nástroje */
        .katastr-tools-separator {
            width: 1px;
            height: 24px;
            background: #dadce0;
            margin: 0 4px;
        }
        
        .katastr-tool-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        
        .katastr-tool-btn:hover {
            background: #f1f3f4;
            border-color: #1a73e8;
        }
        
        .katastr-tool-btn.active {
            background: #e8f0fe;
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .katastr-tool-btn .material-icons-outlined {
            font-size: 18px;
            color: inherit;
        }
        
        /* Polygon selection banner */
        .katastr-polygon-banner {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: #e8f0fe;
            border-bottom: 1px solid #c2dbfc;
            font-size: 12px;
            color: #1a73e8;
        }
        
        .katastr-polygon-banner .material-icons-outlined {
            font-size: 18px;
        }
        
        .katastr-polygon-banner button {
            margin-left: auto;
            padding: 4px 12px;
            border: 1px solid #1a73e8;
            background: #fff;
            border-radius: 4px;
            font-size: 11px;
            color: #1a73e8;
            cursor: pointer;
        }
        
        .katastr-polygon-banner button:hover {
            background: #fff;
            border-color: #1557b0;
            color: #1557b0;
        }
        
        /* Polygon selection SVG */
        .selection-polygon {
            fill: rgba(26, 115, 232, 0.1);
            stroke: #1a73e8;
            stroke-width: 2;
            stroke-dasharray: 5 3;
        }
        
        .selection-point {
            fill: #1a73e8;
            stroke: #fff;
            stroke-width: 2;
            cursor: pointer;
        }
        
        .selection-line {
            stroke: #1a73e8;
            stroke-width: 2;
            stroke-dasharray: 5 3;
            fill: none;
        }
        
        /* VÝRAZNĚJŠÍ OZNAČENÍ POZEMKŮ ZÁMĚRU A SOUSEDNÍCH */
        
        /* Pozemky záměru - modrý šrafovaný vzor + silné ohraničení */
        .parcela-polygon.zamer {
            stroke: #1565c0 !important;
            stroke-width: 3 !important;
            filter: none;
        }
        
        .parcela-overlay-zamer {
            fill: url(#zamerPattern);
            stroke: none;
            pointer-events: none;
        }
        
        /* Sousední pozemky - zelený tečkovaný vzor + silné ohraničení */
        .parcela-polygon.soused {
            stroke: #2e7d32 !important;
            stroke-width: 3 !important;
            stroke-dasharray: 6 3;
            filter: none;
        }
        
        .parcela-overlay-soused {
            fill: url(#sousedPattern);
            stroke: none;
            pointer-events: none;
        }
        
        /* Info panel - tlačítko pro odstranění */
        .katastr-info-btn.danger {
            background: #fff;
            border-color: #ea4335;
            color: #ea4335;
        }
        
        .katastr-info-btn.danger:hover {
            background: #fce8e6;
        }
        
        .katastr-info-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Výběrová tabulka pro polygon selection */
        .katastr-selection-panel {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            min-width: 300px;
        }
        
        .katastr-selection-panel.visible {
            display: block;
        }
        
        .katastr-selection-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .katastr-selection-title {
            font-size: 14px;
            font-weight: 600;
            color: #202124;
        }
        
        .katastr-selection-count {
            font-size: 12px;
            color: #5f6368;
        }
        
        .katastr-selection-list {
            max-height: 120px;
            overflow-y: auto;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        
        .katastr-selection-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            font-size: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .katastr-selection-item:last-child {
            border-bottom: none;
        }
        
        .katastr-selection-actions {
            display: flex;
            gap: 8px;
        }

        /* ==========================================
           KONTROLA SOULADU S ÚPD - ULTRA KOMPAKTNÍ
           ========================================== */
        
        /* Layout switch */
        .upd-layout-switch {
            display: flex;
            gap: 2px;
            background: #f1f3f4;
            padding: 2px;
            border-radius: 4px;
        }
        
        .upd-layout-btn {
            width: 32px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
        }
        
        .upd-layout-btn:hover {
            background: #e0e0e0;
        }
        
        .upd-layout-btn.active {
            background: #fff;
            color: #1a73e8;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .upd-layout-btn .material-icons-outlined {
            font-size: 18px;
        }
        
        /* Control body layouts */
        #controlUP .control-body {
            display: flex;
            flex-direction: row;
        }
        
        #controlUP.layout-horizontal .control-body {
            flex-direction: column;
        }
        
        /* Vertical layout (default) - panels stacked, control on right */
        .upd-viewers-stack {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1px;
            background: #ccc;
            min-width: 0;
        }
        
        /* Horizontal layout - panels side by side, control on bottom right */
        #controlUP.layout-horizontal .upd-viewers-stack {
            flex-direction: row;
        }
        
        .upd-viewers-stack {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1px;
            background: #ccc;
            min-width: 0;
        }
        
        .upd-viewer-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
            min-height: 0;
        }
        
        .upd-viewer-toolbar {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        
        .upd-viewer-tabs {
            display: flex;
            gap: 2px;
        }
        
        .upd-vtab {
            padding: 3px 8px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
        }
        
        .upd-vtab:hover { background: #f1f3f4; }
        .upd-vtab.active { background: #1a73e8; border-color: #1a73e8; color: #fff; }
        
        .upd-viewer-btn {
            margin-left: auto;
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
        }
        
        .upd-viewer-btn:hover { background: #e0e0e0; }
        .upd-viewer-btn .material-icons-outlined { font-size: 16px; }
        
        .upd-viewer-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            overflow: hidden;
            position: relative;
        }
        
        /* Image container pro zoom/pan */
        .upd-image-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
            cursor: grab;
            position: relative;
        }
        
        .upd-image-container:active {
            cursor: grabbing;
        }
        
        .upd-image-container img {
            position: absolute;
            transform-origin: 0 0;
            max-width: none;
            user-select: none;
            -webkit-user-drag: none;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .upd-image-container img.loaded {
            opacity: 1;
        }
        
        /* Zoom controls */
        .upd-zoom-controls {
            display: flex;
            gap: 2px;
            margin-left: auto;
        }
        
        .upd-zoom-btn {
            width: 24px;
            height: 24px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #5f6368;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upd-zoom-btn:hover {
            background: #f1f3f4;
        }
        
        /* Iframe fallback */
        .upd-iframe-fallback {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: #f5f5f5;
            color: #9aa0a6;
        }
        
        .upd-iframe-fallback .material-icons-outlined {
            font-size: 40px;
        }
        
        .upd-viewer-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: #bbb;
        }
        
        .upd-viewer-placeholder .material-icons-outlined { font-size: 48px; }
        
        .upd-link {
            padding: 4px 10px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 3px;
            font-size: 11px;
            color: #1a73e8;
            text-decoration: none;
        }
        
        .upd-link:hover { background: #e8f0fe; }
        
        /* Pravý panel - vertikální layout */
        .upd-control-panel {
            width: 150px;
            flex-shrink: 0;
            background: #f8f9fa;
            border-left: 1px solid #e0e0e0;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            overflow-y: auto;
        }
        
        .upd-check-item {
            background: #fff;
            border-radius: 4px;
            padding: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .upd-check-item.done-ok { background: #e6f4ea; border-color: #34a853; }
        .upd-check-item.done-error { background: #fce8e6; border-color: #ea4335; }
        
        .upd-check-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        
        .upd-check-label {
            font-size: 12px;
            font-weight: 600;
            color: #202124;
        }
        
        .upd-check-status {
            font-size: 14px;
            font-weight: 600;
        }
        
        .upd-check-status.ok { color: #137333; }
        .upd-check-status.error { color: #c5221f; }
        
        .upd-check-mini-label {
            font-size: 10px;
            color: #5f6368;
            margin: 6px 0 4px;
        }
        
        .upd-check-buttons {
            display: flex;
            gap: 6px;
        }
        
        .upd-btn-yes, .upd-btn-no {
            flex: 1;
            padding: 6px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        
        .upd-btn-yes:hover { background: #e6f4ea; border-color: #34a853; }
        .upd-btn-no:hover { background: #fce8e6; border-color: #ea4335; }
        .upd-btn-yes.selected { background: #34a853; border-color: #34a853; color: #fff; }
        .upd-btn-no.selected { background: #ea4335; border-color: #ea4335; color: #fff; }
        
        .upd-note-input {
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            border: 1px solid #f5c6c5;
            border-radius: 4px;
            font-size: 11px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
            background: #fff;
        }
        
        .upd-note-input:focus { outline: none; border-color: #ea4335; }
        
        .upd-no-up-info {
            margin-top: 6px;
            padding: 4px 8px;
            background: #fff8e1;
            border-radius: 3px;
            font-size: 10px;
            color: #e65100;
            text-align: center;
        }
        
        /* Horizontální layout - kontroly dole */
        #controlUP.layout-horizontal .upd-control-panel {
            width: 100%;
            height: 56px;
            flex-direction: row;
            align-items: center;
            justify-content: flex-end;
            border-left: none;
            border-top: 1px solid #e0e0e0;
            padding: 8px 16px;
            gap: 20px;
            overflow-x: auto;
            overflow-y: hidden;
            flex-shrink: 0;
        }
        
        #controlUP.layout-horizontal .upd-check-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            min-width: auto;
            max-width: none;
            padding: 6px 12px;
        }
        
        #controlUP.layout-horizontal .upd-check-row {
            margin-bottom: 0;
        }
        
        #controlUP.layout-horizontal .upd-check-buttons {
            gap: 4px;
        }
        
        #controlUP.layout-horizontal .upd-btn-yes,
        #controlUP.layout-horizontal .upd-btn-no {
            padding: 4px 8px;
            min-width: 32px;
        }
        
        #controlUP.layout-horizontal .upd-check-mini-label {
            margin: 0;
            white-space: nowrap;
        }
        
        /* ÚP kontrola v horizontálním layoutu */
        #controlUP.layout-horizontal .upd-check-item#checkUp > #upSouladSection {
            display: none;
            flex-direction: row;
            align-items: center;
            gap: 8px;
        }
        
        #controlUP.layout-horizontal .upd-check-item#checkUp > #upSouladSection[style*="block"] {
            display: flex !important;
        }
        
        #controlUP.layout-horizontal .upd-check-item#checkUp > .upd-no-up-info {
            margin-top: 0;
            white-space: nowrap;
        }
        
        /* Skrýt textarea v horizontálním layoutu - používáme modal */
        #controlUP.layout-horizontal .upd-note-input {
            display: none !important;
        }
        
        /* Indikátor nesouladu - malá ikonka */
        .upd-nesoulad-indicator {
            display: none;
            width: 22px;
            height: 22px;
            background: #ea4335;
            border-radius: 4px;
            color: #fff;
            font-size: 12px;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 4px;
            flex-shrink: 0;
        }
        
        .upd-nesoulad-indicator:hover {
            background: #c5221f;
        }
        
        .upd-nesoulad-indicator.visible {
            display: flex;
        }
        
        /* Modální dialog pro nesoulad */
        .upd-nesoulad-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .upd-nesoulad-modal.open {
            display: flex;
        }
        
        .upd-nesoulad-modal-content {
            background: #fff;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .upd-nesoulad-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .upd-nesoulad-modal-title {
            font-size: 16px;
            font-weight: 600;
            color: #c5221f;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .upd-nesoulad-modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
        }
        
        .upd-nesoulad-modal-close:hover {
            background: #f1f3f4;
        }
        
        .upd-nesoulad-modal-body {
            padding: 20px;
        }
        
        .upd-nesoulad-modal-body label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 8px;
        }
        
        .upd-nesoulad-modal-textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            line-height: 1.5;
        }
        
        .upd-nesoulad-modal-textarea:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26,115,232,0.2);
        }
        
        .upd-nesoulad-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 16px 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .btn-sm {
            padding: 4px 10px !important;
            font-size: 11px !important;
        }
        
        .btn-sm .material-icons-outlined {
            font-size: 14px !important;
        }

        .pozemky-add-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed #e0e0e0;
        }

        .pozemky-add-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .pozemky-add-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            outline: none;
        }

        .pozemky-add-input:focus {
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .pozemky-add-input::placeholder {
            color: #9aa0a6;
        }

        .btn-add-pozemek {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-add-pozemek:hover {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .btn-add-pozemek .material-icons-outlined {
            font-size: 16px;
        }

        .pozemky-empty-note {
            padding: 16px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
            font-size: 12px;
            color: #e65100;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pozemky-empty-note .material-icons-outlined {
            font-size: 18px;
        }

        .auto-check-results {
            display: none;
        }

        .auto-check-results.visible {
            display: block;
        }

        .check-result-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .check-result-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .check-result-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .check-result-icon .material-icons-outlined {
            font-size: 16px;
        }

        .check-result-icon.success {
            background: #e6f4ea;
            color: #137333;
        }

        .check-result-icon.warning {
            background: #fef7e0;
            color: #f57c00;
        }

        .check-result-icon.error {
            background: #fce8e6;
            color: #c5221f;
        }

        .check-result-content {
            flex: 1;
        }

        .check-result-label {
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .check-result-detail {
            font-size: 11px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .check-result-action {
            font-size: 12px !important;
            color: #004289 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .check-result-action:hover {
            text-decoration: underline;
        }

        /* Seznam nedostatků */
        .issues-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff8e1;
            border: 1px solid #ffe082;
            border-radius: 8px;
            display: block;
        }

        .issues-section.visible {
            display: block;
        }

        .issues-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .issues-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            font-style: normal !important;
        }

        .issues-title .material-icons-outlined {
            font-size: 18px;
        }

        .issues-count {
            padding: 4px 10px;
            background: #ff6d00;
            color: #fff;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 600 !important;
        }

        .issues-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .issue-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #fff;
            border: 1px solid #ffe082;
            border-radius: 6px;
        }

        .issue-item-icon {
            width: 24px;
            height: 24px;
            background: #ff6d00;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .issue-item-icon .material-icons-outlined {
            font-size: 14px;
            color: #fff;
        }

        .issue-item-content {
            flex: 1;
        }

        .issue-item-doc {
            font-size: 12px !important;
            font-weight: 500 !important;
            color: #e65100 !important;
            font-style: normal !important;
        }

        .issue-item-text {
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
            margin-top: 2px;
        }

        .issue-item-remove {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 4px;
            color: #9aa0a6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .issue-item-remove:hover {
            background: #ffecb3;
            color: #e65100;
        }

        .issue-item-remove .material-icons-outlined {
            font-size: 18px;
        }

        /* Přidat nedostatek */
        .add-issue-row {
            display: flex;
            gap: 8px;
        }

        .add-issue-section {
            margin-top: 12px;
        }

        .add-issue-type-toggle {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }

        .issue-type-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #fff;
            color: #5f6368;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .issue-type-btn:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }

        .issue-type-btn.active {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .issue-type-btn .material-icons-outlined {
            font-size: 16px;
        }

        .add-issue-textarea-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .add-issue-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        .add-issue-textarea:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .btn-add-issue-full {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 16px;
            background: #ff6d00;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            align-self: flex-end;
        }

        .btn-add-issue-full:hover {
            background: #e65100;
        }

        .btn-add-issue-full .material-icons-outlined {
            font-size: 18px;
        }

        .add-issue-select {
            width: 180px;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            background: #fff;
            font-style: normal !important;
        }

        .add-issue-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px !important;
            font-style: normal !important;
        }

        .add-issue-input:focus,
        .add-issue-select:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }

        .btn-add-issue {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 8px 14px;
            background: #ff6d00;
            color: #fff !important;
            border: none;
            border-radius: 6px;
            font-size: 12px !important;
            font-weight: 500 !important;
            cursor: pointer;
            font-style: normal !important;
        }

        .btn-add-issue:hover {
            background: #e65100;
        }

        .btn-add-issue .material-icons-outlined {
            font-size: 16px;
        }

        /* Loading animace pro automatickou kontrolu */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .btn-run-check.loading .material-icons-outlined {
            animation: spin 1s linear infinite;
        }

        /* Control fullscreen overlay */
        .control-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            z-index: 1500;
            display: none;
            flex-direction: column;
        }

        .control-overlay.open {
            display: flex;
        }

        .control-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
            position: relative;
        }

        .control-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .control-header-center {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
        }

        .control-close {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-close:hover {
            background: #f1f3f4;
        }

        .control-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .control-title .material-icons-outlined {
            font-size: 24px;
            color: #004289;
        }

        .control-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Left panel - document viewer */
        .control-viewer {
            flex: 0 0 60%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e0e0;
            background: #f5f5f5;
        }

        .viewer-tabs {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
            align-items: center;
        }
        
        .viewer-tabs-left {
            display: flex;
            gap: 4px;
            flex: 1;
            flex-wrap: wrap;
        }
        
        .viewer-tabs-right {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-left: auto;
        }
        
        .btn-vse-ok {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: #fff;
            color: #137333;
            border: 1px solid #137333;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
        }
        
        .btn-vse-ok:hover {
            background: #e6f4ea;
        }
        
        .btn-vse-ok:active {
            background: #137333;
            color: #fff;
            transform: scale(0.98);
        }
        
        .btn-vse-ok .material-icons-outlined {
            font-size: 18px;
        }
        
        .viewer-open-external {
            width: 32px;
            height: 32px;
            border: 1px solid #dadce0;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6368;
            transition: all 0.15s;
            flex-shrink: 0;
            margin-left: 8px;
        }
        
        .viewer-open-external:hover {
            background: #e8f4fd;
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .viewer-open-external .material-icons-outlined {
            font-size: 18px;
        }

        .viewer-tab {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px !important;
            color: #5f6368 !important;
            cursor: pointer;
            transition: all 0.15s;
            font-style: normal !important;
        }

        .viewer-tab:hover {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289 !important;
        }

        .viewer-tab.active {
            background: #004289;
            border-color: #004289;
            color: #fff !important;
        }

        .viewer-tab .material-icons-outlined {
            font-size: 16px;
        }

        .viewer-tab .badge {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }

        .viewer-tab:not(.active) .badge {
            background: #e8f1fa;
            color: #004289;
        }

        .viewer-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }
        
        /* Viewer bez padding pro mapu */
        .viewer-content:has(.katastr-map-container) {
            padding: 0;
            overflow: hidden;
        }
        
        #viewer-pozemky:not(.viewer-placeholder) {
            height: 100%;
        }

        .viewer-placeholder {
            background: #fff;
            border: 2px dashed #dadce0;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .viewer-placeholder .material-icons-outlined {
            font-size: 64px;
            color: #9aa0a6;
            margin-bottom: 16px;
        }

        .viewer-placeholder-title {
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 8px !important;
            font-style: normal !important;
        }

        .viewer-placeholder-text {
            font-size: 13px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        /* Right panel - control form */
        .control-form {
            flex: 0 0 40%;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        .control-form-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .control-form-footer {
            padding: 16px 24px;
            border-top: 1px solid #e0e0e0;
            background: #fafafa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .control-form-footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-form-footer-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .auto-save-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
        }

        .auto-save-indicator .material-icons-outlined {
            font-size: 16px;
        }

        .auto-save-indicator.saving {
            color: #f57c00;
        }

        .auto-save-indicator.saving .material-icons-outlined {
            animation: spin 1s linear infinite;
        }

        .auto-save-indicator.saved {
            color: #137333;
        }

        /* ==========================================
           KONTROLA ŽÁDOSTI - NOVÝ DESIGN
           ========================================== */
        
        /* Levé okno - strukturovaná data */
        .zadost-data-viewer {
            flex: 0 0 60%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e0e0;
        }
        
        .zadost-data-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            background: #f8f9fa;
        }
        
        .zadost-data-tab {
            display: none;
            padding: 20px;
        }
        
        .zadost-data-tab.active {
            display: block;
        }
        
        /* ==========================================
           ZNOVUPOUŽITELNÉ KOMPONENTY - READ-ONLY ŽÁDOST
           ========================================== */
        .zadost-readonly-content {
            padding: 16px;
            overflow-y: auto;
            max-height: 100%;
        }
        
        .zadost-readonly-section {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        
        .zadost-readonly-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
            font-weight: 600;
            color: #202124;
        }
        
        .zadost-readonly-header .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .zadost-readonly-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1px;
            background: #e0e0e0;
        }
        
        .zadost-readonly-item {
            background: #fff;
            padding: 10px 14px;
        }
        
        .zadost-readonly-item.full-width {
            grid-column: 1 / -1;
        }
        
        .zadost-readonly-label {
            font-size: 11px;
            color: #5f6368;
            margin-bottom: 3px;
        }
        
        .zadost-readonly-value {
            font-size: 13px;
            color: #202124;
            font-weight: 500;
        }
        
        .zadost-readonly-value .material-icons-outlined {
            font-size: 16px;
            margin-right: 4px;
        }
        
        .zadost-readonly-table {
            padding: 12px 14px;
        }
        
        .zadost-readonly-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .zadost-readonly-table th {
            text-align: left;
            padding: 8px 10px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            font-weight: 600;
            color: #5f6368;
        }
        
        .zadost-readonly-table td {
            padding: 8px 10px;
            border: 1px solid #e0e0e0;
            color: #202124;
        }
        
        /* Reusable tab content containers */
        .reusable-zadost-data,
        .reusable-formular-preview {
            height: 100%;
            overflow-y: auto;
        }
        
        .reusable-zadost-data {
            display: none;
        }
        
        .reusable-zadost-data.active,
        .reusable-formular-preview.active {
            display: block;
        }
        
        .zadost-data-section {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
            transition: border-color 0.2s;
        }
        
        .zadost-data-section.status-ok {
            border-color: #34a853;
        }
        
        .zadost-data-section.status-ok .zadost-data-section-header {
            background: #e6f4ea;
            border-bottom-color: #ceead6;
        }
        
        .zadost-data-section.status-vada {
            border-color: #ea4335;
        }
        
        .zadost-data-section.status-vada .zadost-data-section-header {
            background: #fce8e6;
            border-bottom-color: #f5c6c2;
        }
        
        /* Inline kontrolní panel v sekci */
        .zadost-section-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: #fafafa;
            border-top: 1px solid #e0e0e0;
        }
        
        .zadost-section-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
        }
        
        .zadost-section-status .material-icons-outlined {
            font-size: 16px;
        }
        
        .zadost-section-status.status-ok {
            color: #137333;
        }
        
        .zadost-section-status.status-vada {
            color: #c5221f;
        }
        
        .zadost-section-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .zadost-section-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .zadost-section-btn:hover {
            background: #f8f9fa;
            border-color: #c0c0c0;
        }
        
        .zadost-section-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        .zadost-section-btn.btn-ok {
            color: #137333;
            border-color: #137333;
        }
        
        .zadost-section-btn.btn-ok:hover {
            background: #e6f4ea;
        }
        
        .zadost-section-btn.btn-ok.active {
            background: #137333;
            color: #fff;
            border-color: #137333;
        }
        
        .zadost-section-btn.btn-vada {
            color: #c5221f;
            border-color: #c5221f;
        }
        
        .zadost-section-btn.btn-vada:hover {
            background: #fce8e6;
        }
        
        .zadost-section-btn.btn-vada.active {
            background: #c5221f;
            color: #fff;
            border-color: #c5221f;
        }
        
        /* Pravý panel - Nedostatky */
        .zadost-deficiency-panel {
            flex: 0 0 40%;
            display: flex;
            flex-direction: column;
            background: #fff;
        }
        
        .deficiency-panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
        }
        
        .deficiency-panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 8px;
        }
        
        .deficiency-panel-title .material-icons-outlined {
            font-size: 20px;
            color: #ea4335;
        }
        
        .deficiency-panel-summary {
            display: flex;
            gap: 16px;
            font-size: 12px;
        }
        
        .deficiency-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .deficiency-stat.ok { color: #137333; }
        .deficiency-stat.vada { color: #c5221f; }
        .deficiency-stat.pending { color: #5f6368; }
        
        .deficiency-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .deficiency-empty {
            text-align: center;
            padding: 40px 20px;
            color: #9aa0a6;
        }
        
        .deficiency-empty .material-icons-outlined {
            font-size: 48px;
            margin-bottom: 12px;
            color: #137333;
        }
        
        .deficiency-empty-title {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 4px;
        }
        
        .deficiency-empty-text {
            font-size: 12px;
        }
        
        /* Seznam nedostatků */
        .deficiency-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .deficiency-item {
            background: #fce8e6;
            border: 1px solid #f5c6c2;
            border-radius: 8px;
            padding: 12px;
        }
        
        .deficiency-item-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .deficiency-item-section {
            font-size: 11px;
            font-weight: 600;
            color: #c5221f;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .deficiency-item-remove {
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            color: #c5221f;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .deficiency-item-remove:hover {
            background: rgba(197, 34, 31, 0.1);
        }
        
        .deficiency-item-remove .material-icons-outlined {
            font-size: 16px;
        }
        
        .deficiency-item-text {
            font-size: 13px;
            color: #202124;
            margin-bottom: 8px;
        }
        
        .deficiency-item-textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #f5c6c2;
            border-radius: 4px;
            background: #fff;
            font-size: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }
        
        .deficiency-item-textarea:focus {
            outline: none;
            border-color: #c5221f;
            box-shadow: 0 0 0 2px rgba(197, 34, 31, 0.1);
        }
        
        .deficiency-item-textarea::placeholder {
            color: #9aa0a6;
        }
        
        /* Footer s výsledkem */
        .deficiency-panel-footer {
            padding: 16px;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
        }
        
        .deficiency-result {
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
        }
        
        .deficiency-result.positive {
            background: #e6f4ea;
            border: 1px solid #ceead6;
            color: #137333;
        }
        
        .deficiency-result.negative {
            background: #fce8e6;
            border: 1px solid #f5c6c2;
            color: #c5221f;
        }
        
        .deficiency-result.pending {
            background: #fff8e1;
            border: 1px solid #ffe082;
            color: #e65100;
        }
        
        .deficiency-result .material-icons-outlined {
            font-size: 20px;
        }
        
        .deficiency-panel-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 12px;
        }
        
        /* Přepínání režimů pravého panelu */
        .zadost-panel-mode {
            display: none;
            flex-direction: column;
            height: 100%;
        }
        .zadost-panel-mode.active {
            display: flex;
        }
        
        /* Režim kontroly formuláře - checklist */
        .formular-checklist-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .formular-checklist-intro {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #e8f0fe;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 12px;
            color: #1a73e8;
        }
        
        .formular-checklist-intro .material-icons-outlined {
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .formular-checklist {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .formular-check-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            transition: all 0.15s;
        }
        
        .formular-check-item.status-ok {
            border-color: #ceead6;
            background: #f6fef8;
        }
        
        .formular-check-item.status-vada {
            border-color: #f5c6c2;
            background: #fef6f5;
        }
        
        .formular-check-item.status-skip {
            border-color: #e0e0e0;
            background: #f8f9fa;
            opacity: 0.7;
        }
        
        .formular-check-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
        }
        
        .formular-check-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #f1f3f4;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .formular-check-icon .material-icons-outlined {
            font-size: 20px;
            color: #5f6368;
        }
        
        .formular-check-item.status-ok .formular-check-icon {
            background: #e6f4ea;
        }
        .formular-check-item.status-ok .formular-check-icon .material-icons-outlined {
            color: #137333;
        }
        
        .formular-check-item.status-vada .formular-check-icon {
            background: #fce8e6;
        }
        .formular-check-item.status-vada .formular-check-icon .material-icons-outlined {
            color: #c5221f;
        }
        
        .formular-check-title {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }
        
        .formular-check-status {
            display: flex;
            align-items: center;
        }
        
        .formular-check-status .material-icons-outlined {
            font-size: 22px;
            color: #9aa0a6;
        }
        
        .formular-check-item.status-ok .formular-check-status .material-icons-outlined {
            color: #137333;
        }
        
        .formular-check-item.status-vada .formular-check-status .material-icons-outlined {
            color: #c5221f;
        }
        
        .formular-check-item.status-skip .formular-check-status .material-icons-outlined {
            color: #9aa0a6;
        }
        
        .formular-check-actions {
            display: flex;
            gap: 8px;
            padding: 0 14px 12px;
        }
        
        .formular-btn-ok,
        .formular-btn-vada,
        .formular-btn-skip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            border: 1px solid;
        }
        
        .formular-btn-ok {
            background: #fff;
            border-color: #ceead6;
            color: #137333;
        }
        .formular-btn-ok:hover {
            background: #e6f4ea;
        }
        .formular-btn-ok .material-icons-outlined {
            font-size: 16px;
        }
        
        .formular-btn-vada {
            background: #fff;
            border-color: #f5c6c2;
            color: #c5221f;
        }
        .formular-btn-vada:hover {
            background: #fce8e6;
        }
        .formular-btn-vada .material-icons-outlined {
            font-size: 16px;
        }
        
        .formular-btn-skip {
            background: #fff;
            border-color: #e0e0e0;
            color: #5f6368;
        }
        .formular-btn-skip:hover {
            background: #f1f3f4;
        }
        .formular-btn-skip .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Skrýt tlačítka po označení */
        .formular-check-item.status-ok .formular-check-actions,
        .formular-check-item.status-vada .formular-check-actions,
        .formular-check-item.status-skip .formular-check-actions {
            display: none;
        }
        
        .formular-check-vada-input {
            padding: 0 14px 12px;
        }
        
        .formular-check-vada-input textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #f5c6c2;
            border-radius: 6px;
            background: #fff;
            font-size: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }
        
        .formular-check-vada-input textarea:focus {
            outline: none;
            border-color: #c5221f;
            box-shadow: 0 0 0 2px rgba(197, 34, 31, 0.1);
        }
        
        .formular-check-vada-input textarea::placeholder {
            color: #9aa0a6;
        }
        
        /* Hlavička panelu formuláře s tlačítkem */
        .deficiency-panel-header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .btn-vse-ok-small {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #e6f4ea;
            border: 1px solid #ceead6;
            border-radius: 6px;
            color: #137333;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        .btn-vse-ok-small:hover {
            background: #ceead6;
        }
        .btn-vse-ok-small .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Tlačítko Změnit */
        .formular-check-change {
            padding: 0 14px 12px;
        }
        
        .formular-btn-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            color: #5f6368;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        .formular-btn-change:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }
        .formular-btn-change .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Přílohy viewer */
        .prilohy-viewer {
            padding: 20px;
        }
        
        .prilohy-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .prilohy-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.15s;
        }
        .prilohy-item:hover {
            border-color: #1a73e8;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        
        .prilohy-item-icon {
            width: 40px;
            height: 40px;
            background: #f1f3f4;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .prilohy-item-icon .material-icons-outlined {
            font-size: 22px;
            color: #5f6368;
        }
        
        .prilohy-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .prilohy-item-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .prilohy-item-meta {
            font-size: 11px;
            color: #5f6368;
            margin-top: 2px;
        }
        
        .prilohy-item-btn {
            width: 36px;
            height: 36px;
            background: transparent;
            border: 1px solid #dadce0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s;
            flex-shrink: 0;
        }
        .prilohy-item-btn:hover {
            background: #e8f0fe;
            border-color: #1a73e8;
        }
        .prilohy-item-btn .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        .prilohy-item-btn:hover .material-icons-outlined {
            color: #1a73e8;
        }
        
        .prilohy-note {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-top: 16px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 12px;
            color: #5f6368;
        }
        .prilohy-note .material-icons-outlined {
            font-size: 18px;
            color: #9aa0a6;
            flex-shrink: 0;
        }
        
        /* Kompaktní verze seznamu příloh (v sekci žádosti) */
        .prilohy-list-compact {
            margin-top: 12px;
        }
        .prilohy-list-compact .prilohy-item {
            padding: 10px 12px;
        }
        .prilohy-list-compact .prilohy-item-icon {
            width: 36px;
            height: 36px;
        }
        .prilohy-list-compact .prilohy-item-icon .material-icons-outlined {
            font-size: 20px;
        }
        .prilohy-list-compact .prilohy-item-btn {
            width: 32px;
            height: 32px;
        }
        .prilohy-list-compact .prilohy-item-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Stav neaplikuje se */
        .prilohy-item.prilohy-item-na {
            background: #f8f9fa;
            border-color: #e0e0e0;
            opacity: 0.7;
        }
        .prilohy-item.prilohy-item-na:hover {
            border-color: #e0e0e0;
            box-shadow: none;
        }
        .prilohy-item-na .prilohy-item-icon {
            background: #f1f3f4;
        }
        .prilohy-item-na .prilohy-item-icon .material-icons-outlined {
            color: #9aa0a6;
        }
        .prilohy-item-na .prilohy-item-name {
            color: #5f6368;
        }
        .prilohy-item-na .prilohy-item-meta {
            font-style: italic;
        }
        
        /* Záložka Přílohy - disabled stav */
        .viewer-tab.tab-disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* ==========================================
           DOKLADOVÁ ČÁST - NÁHLED V KONTROLE ŽÁDOSTI
           ========================================== */
        .doklady-viewer {
            padding: 16px;
            overflow-y: auto;
            max-height: 100%;
        }
        
        .doklady-section {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        
        .doklady-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
            font-weight: 600;
            color: #202124;
        }
        
        .doklady-section-header .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .doklady-count {
            margin-left: auto;
            background: #e8eaed;
            color: #5f6368;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .doklady-list {
            display: flex;
            flex-direction: column;
        }
        
        .doklady-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .doklady-item:last-child {
            border-bottom: none;
        }
        
        .doklady-item-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .doklady-item-icon .material-icons-outlined {
            font-size: 18px;
        }
        
        .doklady-item.status-ok .doklady-item-icon {
            background: #e6f4ea;
        }
        .doklady-item.status-ok .doklady-item-icon .material-icons-outlined {
            color: #34a853;
        }
        
        .doklady-item.status-pending .doklady-item-icon {
            background: #fff3e0;
        }
        .doklady-item.status-pending .doklady-item-icon .material-icons-outlined {
            color: #e65100;
        }
        
        .doklady-item.status-error .doklady-item-icon {
            background: #fce8e6;
        }
        .doklady-item.status-error .doklady-item-icon .material-icons-outlined {
            color: #ea4335;
        }
        
        .doklady-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .doklady-item-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .doklady-item-meta {
            font-size: 11px;
            color: #5f6368;
            margin-top: 2px;
        }
        
        .doklady-item-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .doklady-item-btn:hover:not(:disabled) {
            background: #f1f3f4;
        }
        
        .doklady-item-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .doklady-item-btn .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .doklady-note {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 12px;
            color: #5f6368;
            margin-top: 8px;
        }
        
        .doklady-note .material-icons-outlined {
            font-size: 16px;
            color: #9aa0a6;
            flex-shrink: 0;
            margin-top: 1px;
        }
        
        /* Badge stavu sekce v hlavičce */
        .section-status-badge {
            margin-left: auto;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .section-status-badge.ok {
            background: #e6f4ea;
            color: #137333;
        }
        
        .section-status-badge.vada {
            background: #fce8e6;
            color: #c5221f;
        }
        
        /* Inline přílohy v sekci */
        .zadost-prilohy-inline {
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .priloha-inline-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .priloha-inline-item .material-icons-outlined {
            font-size: 16px;
        }
        
        .priloha-inline-item.ok {
            background: #e6f4ea;
            color: #137333;
        }
        
        .priloha-inline-item.na {
            color: #9aa0a6;
        }
        
        .priloha-inline-item.pending {
            background: #fff3e0;
            color: #e65100;
            font-weight: 500;
        }
        
        .priloha-inline-item.pending .material-icons-outlined {
            color: #e65100;
        }
        
        /* Náhled formuláře žádosti */
        .formular-preview {
            background: #fff;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 16px;
            font-family: 'Times New Roman', serif;
        }
        
        .formular-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            border-bottom: 2px solid #000;
        }
        
        .formular-logo {
            width: 60px;
            height: 60px;
            border: 2px solid #000;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .formular-logo .material-icons-outlined {
            font-size: 36px;
        }
        
        .formular-title-block {
            flex: 1;
        }
        
        .formular-title {
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .formular-subtitle {
            font-size: 11px;
            color: #444;
            margin-top: 4px;
        }
        
        .formular-cislo {
            text-align: right;
        }
        
        .formular-cislo-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
        }
        
        .formular-cislo-value {
            font-size: 13px;
            font-weight: bold;
            font-family: monospace;
        }
        
        .formular-section {
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .formular-section:last-of-type {
            border-bottom: none;
        }
        
        .formular-section-title {
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: #f0f0f0;
            padding: 6px 10px;
            margin: -16px -20px 16px -20px;
            border-bottom: 1px solid #d0d0d0;
        }
        
        .formular-subsection {
            margin-bottom: 16px;
        }
        
        .formular-subsection:last-child {
            margin-bottom: 0;
        }
        
        .formular-subsection-title {
            font-size: 11px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .formular-field-row {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .formular-field-row:last-child {
            margin-bottom: 0;
        }
        
        .formular-field {
            flex: 1;
        }
        
        .formular-field.full {
            flex: 100%;
        }
        
        .formular-field-label {
            font-size: 9px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        
        .formular-field-value {
            font-size: 12px;
            padding: 4px 8px;
            background: #fafafa;
            border: 1px solid #d0d0d0;
            border-radius: 2px;
            min-height: 20px;
        }
        
        .formular-field.empty .formular-field-value {
            color: #999;
            font-style: italic;
        }
        
        .formular-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #f8f8f8;
            border-top: 1px solid #e0e0e0;
            font-size: 10px;
            color: #666;
        }
        
        .formular-fields {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .formular-fields .formular-field.full-width {
            grid-column: 1 / -1;
        }
        
        .formular-page-info {
            font-weight: 500;
        }
        
        .formular-note {
            font-style: italic;
        }
        
        /* Akční tlačítka pro ověření zástupce */
        .zastupce-verify-actions {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }
        
        .zastupce-verify-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            color: #3c4043;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .zastupce-verify-btn:hover {
            background: #f1f3f4;
            border-color: #c0c0c0;
        }
        
        .zastupce-verify-btn .material-icons-outlined {
            font-size: 18px;
        }
        
        .zastupce-verify-btn.reza {
            border-color: #34a853;
            color: #137333;
        }
        
        .zastupce-verify-btn.reza:hover {
            background: #e6f4ea;
        }
        
        .zastupce-verify-btn.reza .material-icons-outlined {
            color: #34a853;
        }
        
        .zastupce-verify-btn.prilohy {
            border-color: #1a73e8;
            color: #1a73e8;
        }
        
        .zastupce-verify-btn.prilohy:hover {
            background: #e8f0fe;
        }
        
        /* REZA Modal */
        .reza-modal-content {
            padding: 0;
        }
        
        .reza-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-bottom: 1px solid #a5d6a7;
        }
        
        .reza-logo {
            width: 48px;
            height: 48px;
            background: #fff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .reza-logo .material-icons-outlined {
            font-size: 28px;
            color: #2e7d32;
        }
        
        .reza-header-text {
            flex: 1;
        }
        
        .reza-title {
            font-size: 16px;
            font-weight: 600;
            color: #1b5e20;
        }
        
        .reza-subtitle {
            font-size: 12px;
            color: #388e3c;
            margin-top: 2px;
        }
        
        .reza-verified-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #2e7d32;
            color: #fff;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .reza-verified-badge .material-icons-outlined {
            font-size: 16px;
        }
        
        .reza-body {
            padding: 20px;
        }
        
        .reza-info-section {
            margin-bottom: 16px;
        }
        
        .reza-info-section:last-child {
            margin-bottom: 0;
        }
        
        .reza-info-title {
            font-size: 11px;
            font-weight: 600;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 8px;
        }
        
        .reza-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .reza-info-item {
            background: #f8f9fa;
            padding: 10px 12px;
            border-radius: 6px;
        }
        
        .reza-info-item.full {
            grid-column: 1 / -1;
        }
        
        .reza-info-label {
            font-size: 10px;
            color: #5f6368;
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        
        .reza-info-value {
            font-size: 13px;
            color: #202124;
            font-weight: 500;
        }
        
        .reza-validity {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .reza-validity .material-icons-outlined {
            font-size: 16px;
        }
        
        .reza-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }
        
        .reza-footer-info {
            font-size: 11px;
            color: #5f6368;
        }
        
        .reza-footer-info a {
            color: #1a73e8;
            text-decoration: none;
        }
        
        .reza-footer-info a:hover {
            text-decoration: underline;
        }
        
        .zadost-data-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: #f1f3f4;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            font-size: 13px;
            color: #202124;
        }
        
        .zadost-data-section-header .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }
        
        .zadost-data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: #e0e0e0;
        }
        
        .zadost-data-item {
            padding: 12px 16px;
            background: #fff;
        }
        
        .zadost-data-item.full-width {
            grid-column: 1 / -1;
        }
        
        .zadost-data-label {
            font-size: 11px;
            font-weight: 500;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 4px;
        }
        
        .zadost-data-value {
            font-size: 13px;
            color: #202124;
        }
        
        .zadost-data-value.text-block {
            line-height: 1.5;
        }
        
        .zadost-data-empty {
            padding: 24px 16px;
            text-align: center;
            color: #9aa0a6;
            font-size: 13px;
        }
        
        .zadost-data-empty .material-icons-outlined {
            font-size: 32px;
            margin-bottom: 8px;
            display: block;
        }
        
        /* Tabulka pozemků */
        .zadost-data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .zadost-data-table th {
            padding: 10px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
            font-weight: 600;
            color: #5f6368;
            font-size: 11px;
            text-transform: uppercase;
        }
        
        .zadost-data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #f1f3f4;
            color: #202124;
        }
        
        .zadost-data-table tr:last-child td {
            border-bottom: none;
        }
        
        /* Přílohy v levém okně */
        .zadost-prilohy-list {
            padding: 0;
        }
        
        .zadost-priloha-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: #fff;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .zadost-priloha-item:last-child {
            border-bottom: none;
        }
        
        .zadost-priloha-item.not-applicable {
            opacity: 0.6;
        }
        
        .zadost-priloha-item.attached {
            background: #fff;
        }
        
        .priloha-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: #f1f3f4;
            flex-shrink: 0;
        }
        
        .priloha-icon .material-icons-outlined {
            font-size: 20px;
            color: #5f6368;
        }
        
        .zadost-priloha-item.attached .priloha-icon {
            background: #e8f5e9;
        }
        
        .zadost-priloha-item.attached .priloha-icon .material-icons-outlined {
            color: #2e7d32;
        }
        
        .priloha-info {
            flex: 1;
        }
        
        .priloha-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 2px;
        }
        
        .priloha-status {
            font-size: 12px;
            color: #5f6368;
        }
        
        .priloha-link {
            color: #1a73e8;
            text-decoration: none;
        }
        
        .priloha-link:hover {
            text-decoration: underline;
        }
        
        .priloha-action {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            color: #5f6368;
        }
        
        .priloha-action:hover {
            background: #f1f3f4;
        }
        
        /* Pravé okno - checklist */
        .zadost-checklist {
            flex: 0 0 40%;
        }
        
        .checklist-section {
            margin-bottom: 24px;
        }
        
        .checklist-section-title {
            font-size: 14px;
            font-weight: 700;
            color: #202124;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 8px;
            background: #fff;
            transition: all 0.15s;
        }
        
        .checklist-item:hover {
            border-color: #dadce0;
            background: #fafafa;
        }
        
        .checklist-item.disabled {
            opacity: 0.5;
            background: #f8f9fa;
        }
        
        .checklist-item.checked-ok {
            background: #e8f5e9;
            border-color: #81c784;
        }
        
        .checklist-item.checked-error {
            background: #ffebee;
            border-color: #ef9a9a;
        }
        
        .checklist-text {
            font-size: 13px;
            color: #202124;
            flex: 1;
            padding-right: 12px;
        }
        
        .checklist-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }
        
        .checklist-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #dadce0;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .checklist-btn .material-icons-outlined {
            font-size: 18px;
        }
        
        .checklist-btn.ok {
            color: #5f6368;
        }
        
        .checklist-btn.ok:hover,
        .checklist-btn.ok.active {
            background: #e8f5e9;
            border-color: #81c784;
            color: #2e7d32;
        }
        
        .checklist-btn.error {
            color: #5f6368;
        }
        
        .checklist-btn.error:hover,
        .checklist-btn.error.active {
            background: #ffebee;
            border-color: #ef9a9a;
            color: #c62828;
        }
        
        .checklist-btn.na {
            background: #f1f3f4;
            border-color: #e0e0e0;
            color: #9aa0a6;
            cursor: default;
        }

        /* ==========================================
           ÚČASTNÍCI ŘÍZENÍ - STYLY
           ========================================== */
        .ucastnici-tabs {
            display: flex;
            gap: 0;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            padding: 0;
        }
        
        .ucastnici-tab {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 20px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .ucastnici-tab:hover {
            background: #e8f1fa;
            color: #004289;
        }
        
        .ucastnici-tab.active {
            background: #fff;
            color: #004289;
            border-bottom-color: #004289;
        }
        
        .ucastnici-tab .material-icons-outlined {
            font-size: 18px;
        }
        
        .ucastnici-tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: #e8eaed;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            color: #5f6368;
        }
        
        .ucastnici-tab.active .ucastnici-tab-badge {
            background: #e8f1fa;
            color: #004289;
        }
        
        .ucastnici-panel {
            display: none;
            padding: 0;
            overflow-y: auto;
            flex: 1;
        }
        
        .ucastnici-panel.active {
            display: flex;
            flex-direction: column;
        }
        
        .ucastnici-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #fff;
            border-bottom: 1px solid #e8eaed;
        }
        
        .ucastnici-toolbar-left,
        .ucastnici-toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-ucastnici-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-ucastnici-action:hover {
            background: #f8f9fa;
            border-color: #004289;
            color: #004289;
        }
        
        .btn-ucastnici-action.primary {
            background: #004289;
            border-color: #004289;
            color: #fff;
        }
        
        .btn-ucastnici-action.primary:hover {
            background: #003570;
        }
        
        .btn-ucastnici-action .material-icons-outlined {
            font-size: 16px;
        }
        
        .ucastnici-checkbox {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
            cursor: pointer;
        }
        
        .ucastnici-checkbox input {
            cursor: pointer;
        }
        
        /* Skupiny účastníků */
        .ucastnici-group {
            border-bottom: 1px solid #e8eaed;
        }
        
        .ucastnici-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #f8f9fa;
        }
        
        .ucastnici-group-title {
            font-size: 13px;
            font-weight: 600;
            color: #202124;
        }
        
        .ucastnici-group-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-add-ucastnik {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: #004289;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-add-ucastnik:hover {
            background: #003570;
        }
        
        .btn-add-ucastnik.secondary {
            background: #fff;
            border: 1px solid #dadce0;
            color: #5f6368;
        }
        
        .btn-add-ucastnik.secondary:hover {
            background: #f8f9fa;
            border-color: #004289;
            color: #004289;
        }
        
        .btn-add-ucastnik .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Tabulka účastníků */
        .ucastnici-table {
            width: 100%;
        }
        
        .ucastnici-row {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            border-bottom: 1px solid #f1f3f4;
            transition: background 0.1s;
        }
        
        .ucastnici-row:hover {
            background: #f8f9fa;
        }
        
        .ucastnici-row:last-child {
            border-bottom: none;
        }
        
        .ucastnici-cell {
            font-size: 13px;
            color: #202124;
        }
        
        .ucastnici-cell.status {
            width: 30px;
            flex-shrink: 0;
        }
        
        .ucastnici-cell.type {
            width: 100px;
            flex-shrink: 0;
            font-size: 11px;
            color: #5f6368;
        }
        
        .ucastnici-cell.name {
            flex: 1;
            font-weight: 500;
            min-width: 150px;
        }
        
        .ucastnici-cell.address {
            flex: 1.5;
            color: #5f6368;
            font-size: 12px;
        }
        
        .ucastnici-cell.actions {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
            width: 150px;
            flex-shrink: 0;
        }
        
        .ucastnici-status {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
        }
        
        .ucastnici-status .material-icons-outlined {
            font-size: 18px;
        }
        
        .ucastnici-status.verified {
            color: #137333;
        }
        
        .ucastnici-status.pending {
            color: #f9ab00;
        }
        
        .ucastnici-status.error {
            color: #c5221f;
        }
        
        .ucastnici-action-btn {
            width: 28px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .ucastnici-action-btn:hover {
            background: #e8eaed;
            color: #202124;
        }
        
        .ucastnici-action-btn.delete:hover {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .ucastnici-action-btn.favorited {
            color: #f9ab00;
        }
        
        .ucastnici-action-btn .material-icons-outlined {
            font-size: 18px;
        }
        
        .ucastnici-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 24px;
            color: #9aa0a6;
            font-size: 13px;
        }
        
        .ucastnici-empty .material-icons-outlined {
            font-size: 20px;
        }
        
        /* Tabulka zástupců a dalších osob */
        .zastupci-table-wrapper {
            overflow-x: auto;
        }
        
        .zastupci-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .zastupci-table th {
            padding: 10px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
            font-weight: 500;
            font-size: 11px;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .zastupci-table td {
            padding: 12px;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: middle;
        }
        
        .zastupci-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .zastupce-zastoupeni {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .zastupce-chip {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            background: #e8f1fa;
            border-radius: 12px;
            font-size: 12px;
            color: #004289;
        }
        
        .zastupce-role {
            display: inline-block;
            padding: 3px 8px;
            background: #f1f3f4;
            border-radius: 4px;
            font-size: 11px;
            color: #5f6368;
        }
        
        .dalsi-osoba-poznamka {
            display: inline-block;
            padding: 3px 8px;
            background: #fff3e0;
            border-radius: 4px;
            font-size: 11px;
            color: #e65100;
            font-style: italic;
        }
        
        /* Toggle switch pro doručování */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #dadce0;
            transition: 0.2s;
            border-radius: 22px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.2s;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: #004289;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(18px);
        }

        /* ==========================================
           OSOBY - DVOUSLOUPCOVÝ LAYOUT
           ========================================== */
        .osoby-layout {
            display: flex;
            gap: 0;
            padding: 0 !important;
            height: 100%;
        }
        
        /* Levý sloupec - Pozemky */
        .osoby-col-pozemky {
            width: 340px;
            min-width: 340px;
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .osoby-pozemky-content {
            flex: 1;
            overflow-y: auto;
        }
        
        /* Pravý sloupec - Účastníci */
        .osoby-col-ucastnici {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #fff;
        }
        
        /* Hlavička sloupce */
        .osoby-col-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            height: 44px;
            background: #004289;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            box-sizing: border-box;
            flex-shrink: 0;
        }
        
        .osoby-col-header .material-icons-outlined {
            font-size: 18px;
        }
        
        .btn-overit-vse-sm {
            margin-left: auto;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #fff;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            color: #004289;
            cursor: pointer;
        }
        
        .btn-overit-vse-sm:hover {
            background: #e8f1fa;
        }
        
        .btn-overit-vse-sm .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Bloky pozemků */
        .pozemky-blok {
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }
        
        .pozemky-blok-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }
        
        .pozemky-blok-header.zamer {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .pozemky-blok-header.soused {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .pozemky-blok-count {
            background: rgba(0,0,0,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
        }
        
        .pozemky-blok-list {
            overflow-y: auto;
        }
        
        .pozemek-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            font-size: 12px;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .pozemek-item:hover {
            background: #fff;
        }
        
        .pozemek-item .pozemek-parcela {
            font-weight: 600;
            min-width: 50px;
            color: #202124;
        }
        
        .pozemek-item .pozemek-ku {
            color: #9aa0a6;
            font-size: 10px;
            min-width: 55px;
        }
        
        .pozemek-item .pozemek-vlastnik {
            flex: 1;
            color: #5f6368;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 11px;
        }
        
        .pozemek-item .pozemek-vlastnik.verified {
            color: #137333;
        }
        
        .pozemek-item .pozemek-status {
            width: 18px;
        }
        
        .pozemek-item .pozemek-status .material-icons-outlined {
            font-size: 16px;
        }
        
        .pozemek-item .pozemek-status.pending {
            color: #f9ab00;
        }
        
        .pozemek-item .pozemek-status.ok {
            color: #137333;
        }
        
        .btn-overit-sm {
            padding: 2px 8px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
        }
        
        .btn-overit-sm:hover {
            border-color: #004289;
            color: #004289;
        }
        
        .btn-overit-sm.done {
            background: #e6f4ea;
            border-color: #137333;
            color: #137333;
            pointer-events: none;
        }
        
        /* Pozemek - rozšířený stav po ověření */
        .pozemek-item.verified {
            flex-wrap: wrap;
            padding-bottom: 8px;
        }
        
        .pozemek-item .pozemek-info-row {
            display: flex;
            align-items: center;
            gap: 6px;
            width: 100%;
            margin-top: 4px;
            padding-left: 0;
        }
        
        .pozemek-overeno-datum {
            font-size: 9px;
            color: #9aa0a6;
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        /* LV tlačítko a dropdown */
        .btn-lv-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .btn-lv {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 6px;
            background: #fff;
            border: 1px solid #1a73e8;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
            color: #1a73e8;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .btn-lv:hover {
            background: #e8f1fa;
        }
        
        .btn-lv .material-icons-outlined {
            font-size: 12px;
        }
        
        .lv-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 2px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            min-width: 150px;
        }
        
        .lv-dropdown.show {
            display: block;
        }
        
        .lv-dropdown-item {
            display: block;
            width: 100%;
            padding: 8px 12px;
            text-align: left;
            background: none;
            border: none;
            font-size: 11px;
            color: #202124;
            cursor: pointer;
        }
        
        .lv-dropdown-item:hover {
            background: #f1f3f4;
        }
        
        .lv-dropdown-item .lv-item-title {
            font-weight: 500;
        }
        
        .lv-dropdown-item .lv-item-desc {
            font-size: 10px;
            color: #5f6368;
            margin-top: 2px;
        }
        
        /* Tabs v hlavičce účastníků */
        .osoby-tabs-inline {
            display: flex;
            gap: 4px;
        }
        
        .osoby-tab-btn {
            padding: 4px 10px;
            background: rgba(255,255,255,0.15);
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .osoby-tab-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .osoby-tab-btn.active {
            background: #fff;
            color: #004289;
        }
        
        .osoby-tab-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: rgba(0,0,0,0.15);
            border-radius: 9px;
            font-size: 10px;
            margin-left: 4px;
        }
        
        .osoby-tab-btn.active .osoby-tab-count {
            background: #e8f1fa;
            color: #004289;
        }
        
        .btn-add-osoba {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #fff;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            color: #004289;
            cursor: pointer;
        }
        
        .btn-add-osoba:hover {
            background: #e8f1fa;
        }
        
        .btn-add-osoba .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Hlavička - akce */
        .osoby-header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        
        .btn-overit-osoby {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
        }
        
        .btn-overit-osoby:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .btn-overit-osoby .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Tlačítko ověřit osobu */
        .btn-overit-osobu {
            padding: 4px;
            background: #fff3e0;
            border: none;
            border-radius: 4px;
            color: #e65100;
            cursor: pointer;
        }
        
        .btn-overit-osobu:hover {
            background: #ffe0b2;
        }
        
        .btn-overit-osobu .material-icons-outlined {
            font-size: 18px;
        }
        
        /* Status ověření */
        .os-status.pending {
            color: #f9ab00;
        }
        
        /* Adresa neověřeno */
        .os-adresa-neovereno {
            color: #9aa0a6;
            font-style: italic;
        }
        
        /* DS info */
        .os-ds-info {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
            padding: 2px 6px;
            background: #e3f2fd;
            border-radius: 3px;
            font-size: 10px;
            color: #1565c0;
        }
        
        .os-ds-info .material-icons-outlined {
            font-size: 12px;
        }
        
        /* Info o pozemcích u vlastníka */
        .os-pozemky {
            display: inline-block;
            padding: 2px 6px;
            background: #f3e5f5;
            border-radius: 3px;
            font-size: 11px;
            color: #7b1fa2;
            margin-left: 4px;
        }
        
        /* Info o zastoupení */
        .os-zastoupen-info {
            display: block;
            margin-top: 4px;
            padding: 3px 8px;
            background: #e3f2fd;
            border-radius: 4px;
            font-size: 11px;
            color: #1565c0;
        }
        
        .os-zastoupen-info .material-icons-outlined {
            font-size: 14px;
            vertical-align: middle;
            margin-right: 4px;
        }
        
        /* Tlačítko doručování */
        .btn-dorucovani {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            overflow: hidden;
        }
        
        .btn-dorucovani .material-icons-outlined {
            font-size: 18px;
            line-height: 1;
        }
        
        .btn-dorucovani.ds {
            background: #e3f2fd;
            border-color: #64b5f6;
            color: #1565c0;
        }
        
        .btn-dorucovani.ds:hover {
            background: #bbdefb;
        }
        
        .btn-dorucovani.posta {
            background: #fff3e0;
            border-color: #ffb74d;
            color: #ef6c00;
        }
        
        .btn-dorucovani.posta:hover {
            background: #ffe0b2;
        }
        
        .btn-dorucovani.nedorucovat {
            background: #ffebee;
            border-color: #ef9a9a;
            color: #c62828;
            position: relative;
        }
        
        .btn-dorucovani.nedorucovat:hover {
            background: #ffcdd2;
        }
        
        .doruc-ceka {
            color: #9aa0a6;
            font-size: 12px;
        }
        
        /* Loading / rotating icon */
        .os-status.loading {
            color: #5f6368;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .rotating {
            animation: rotate 1s linear infinite;
        }
        
        /* Panely tabů */
        .osoby-tab-panel {
            display: none;
            flex: 1;
            overflow-y: auto;
        }
        
        .osoby-tab-panel.active {
            display: block;
        }
        
        .osoby-empty-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #9aa0a6;
        }
        
        .osoby-empty-panel .material-icons-outlined {
            font-size: 48px;
            margin-bottom: 12px;
        }
        
        .osoby-empty-panel p {
            margin-bottom: 16px;
        }
        
        /* Tabulka účastníků */
        .osoby-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .osoby-table thead {
            background: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        
        .osoby-table th {
            padding: 8px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #5f6368;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .osoby-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: middle;
        }
        
        .osoby-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        /* Kategorie řádek */
        .osoby-kategorie-row td {
            padding: 6px 10px !important;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .kategorie-label {
            font-weight: 600;
            font-size: 11px;
            color: #202124;
        }
        
        .btn-nacist-vti {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 12px;
            padding: 3px 10px;
            background: #fff;
            color: #1a73e8;
            border: 1px solid #1a73e8;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-nacist-vti:hover {
            background: #e8f0fe;
        }
        
        .btn-nacist-vti .material-icons-outlined {
            font-size: 14px;
        }
        
        .kategorie-stav {
            margin-left: 8px;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .kategorie-stav.ceka {
            background: #fff3e0;
            color: #e65100;
        }
        
        .kategorie-stav.ok {
            background: #e6f4ea;
            color: #137333;
        }
        
        /* Prázdný řádek */
        .osoby-empty-row td {
            color: #9aa0a6;
            font-style: italic;
            padding: 12px 10px !important;
        }
        
        /* Status ikona */
        .os-status {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
        }
        
        .os-status .material-icons-outlined {
            font-size: 18px;
        }
        
        .os-status.ok {
            color: #137333;
        }
        
        .os-status.pending {
            color: #f9ab00;
        }
        
        .os-status.vecne {
            color: #7b1fa2;
        }
        
        /* Zdroj badge */
        .os-zdroj {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .os-zdroj.zdroj-zadost {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .os-zdroj.zdroj-ku {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .os-zdroj.zdroj-kn {
            background: #e6f4ea;
            color: #137333;
        }
        
        .os-zdroj.vti {
            background: #fff3e0;
            color: #e65100;
        }
        
        .os-zdroj.vdi {
            background: #fce4ec;
            color: #c2185b;
        }
        
        /* Role badge */
        .os-role {
            display: inline-block;
            padding: 2px 8px;
            background: #fff3e0;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
            color: #e65100;
        }
        
        /* Akce tlačítka */
        .os-actions {
            white-space: nowrap;
        }
        
        .os-actions button {
            padding: 4px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: #5f6368;
            cursor: pointer;
        }
        
        .os-actions button:hover {
            background: #e8eaed;
            color: #202124;
        }
        
        .os-actions button.is-favorited {
            color: #f9ab00;
        }
        
        .os-actions button .material-icons-outlined {
            font-size: 18px;
        }
        
        .text-muted {
            color: #9aa0a6;
        }
        
        .text-center {
            text-align: center;
        }

        /* ==========================================
           ZÁSTUPCI - TOOLBAR A FORMULÁŘ
           ========================================== */
        .zastupci-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .zastupci-toolbar-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .zastupci-toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .zastupci-info {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5f6368;
        }
        
        .zastupci-info .material-icons-outlined {
            font-size: 16px;
            color: #1a73e8;
        }
        
        .btn-outline {
            background: #fff;
            border: 1px solid #dadce0;
            color: #5f6368;
        }
        
        .btn-outline:hover {
            background: #f8f9fa;
            border-color: #bdc1c6;
        }
        
        /* Doručování toggle */
        .dorucovat-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .dorucovat-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .dorucovat-label {
            font-size: 11px;
            color: #5f6368;
        }
        
        .dorucovat-label.yes {
            color: #137333;
        }
        
        .dorucovat-label.no {
            color: #c5221f;
        }
        
        /* Zastupuje badge */
        .zastupuje-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            background: #e8f1fa;
            border-radius: 4px;
            font-size: 11px;
            color: #1565c0;
            margin-right: 4px;
            margin-bottom: 4px;
        }
        
        .zastupuje-badge .material-icons-outlined {
            font-size: 12px;
        }
        
        .zastupuje-cell {
            max-width: 250px;
        }
        
        /* Modal formulář sekce */
        .form-section {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e8eaed;
        }
        
        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .form-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 12px;
        }
        
        .form-row {
            margin-bottom: 12px;
        }
        
        .form-row-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-row-3col {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-row-ico {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            margin-bottom: 8px;
        }
        
        .btn-verify-ico {
            height: 36px;
            white-space: nowrap;
        }
        
        .form-verify-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .verify-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }
        
        .verify-status.loading {
            color: #5f6368;
        }
        
        .verify-status.success {
            color: #137333;
        }
        
        .verify-status.error {
            color: #c5221f;
        }
        
        .verify-status .material-icons-outlined {
            font-size: 16px;
        }
        
        .form-input[readonly] {
            background: #f8f9fa;
            color: #5f6368;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            margin-bottom: 4px;
        }
        
        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 13px;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .form-radio-group {
            display: flex;
            gap: 16px;
        }
        
        .form-radio {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            cursor: pointer;
        }
        
        .form-radio input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            cursor: pointer;
        }
        
        .form-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .form-hint {
            font-size: 11px;
            color: #5f6368;
            margin: 0;
        }
        
        /* Zastupovaní list */
        .zastupovani-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .zastupovani-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            transition: background 0.1s;
        }
        
        .zastupovani-item:last-child {
            border-bottom: none;
        }
        
        .zastupovani-item:hover {
            background: #f8f9fa;
        }
        
        .zastupovani-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .zastupovani-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .zastupovani-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }
        
        .zastupovani-role {
            font-size: 11px;
            color: #5f6368;
        }

        .btn-save-draft {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background: #fff;
            color: #5f6368;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
        }

        .btn-save-draft:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-save-draft .material-icons-outlined {
            font-size: 18px;
        }

        .control-section {
            margin-bottom: 24px;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .control-section-title {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 12px !important;
            font-style: normal !important;
        }

        .control-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .control-option:last-child {
            margin-bottom: 0;
        }

        .control-option:hover {
            background: #f0f0f0;
            border-color: #dadce0;
        }

        .control-option.selected {
            background: #e8f1fa;
            border-color: #004289;
        }

        .control-option.selected.negative {
            background: #fce8e6;
            border-color: #f5c6c3;
        }

        .control-option input[type="radio"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            accent-color: #004289;
            flex-shrink: 0;
        }

        .control-option-content {
            flex: 1;
        }

        .control-option-label {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .control-option-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px !important;
            font-style: normal !important;
        }

        .control-option.selected.negative .control-option-label {
            color: #a50e0e !important;
        }

        /* Result preview box */
        .result-preview {
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .result-preview.positive {
            background: #e6f4ea;
            border: 1px solid #ceead6;
        }

        .result-preview.negative {
            background: #fce8e6;
            border: 1px solid #f5c6c3;
        }

        .result-preview.warning {
            background: #fef7e0;
            border: 1px solid #f5e6b3;
        }

        .result-preview.neutral {
            background: #f1f3f4;
            border: 1px solid #dadce0;
        }

        .result-preview-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            margin-bottom: 4px !important;
            font-style: normal !important;
        }

        .result-preview.positive .result-preview-title {
            color: #137333 !important;
        }

        .result-preview.negative .result-preview-title {
            color: #a50e0e !important;
        }

        .result-preview.warning .result-preview-title {
            color: #b06000 !important;
        }

        .result-preview.neutral .result-preview-title {
            color: #5f6368 !important;
        }

        .result-preview-title .material-icons-outlined {
            font-size: 20px;
        }

        .result-preview-text {
            font-size: 13px !important;
            font-style: normal !important;
        }

        .result-preview.positive .result-preview-text {
            color: #137333 !important;
        }

        .result-preview.negative .result-preview-text {
            color: #a50e0e !important;
        }

        .result-preview.warning .result-preview-text {
            color: #7a4200 !important;
        }

        .result-preview.neutral .result-preview-text {
            color: #5f6368 !important;
        }

        /* Info box */
        .info-box {
            display: flex;
            gap: 12px;
            padding: 16px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
        }

        .info-box.warning {
            background: #fef7e0;
            border-color: #f9ab00;
        }

        .info-box.error {
            background: #fce8e6;
            border-color: #ea4335;
        }

        .info-box-icon {
            flex-shrink: 0;
        }

        .info-box-icon .material-icons-outlined {
            font-size: 24px;
            color: #f9ab00;
        }

        .info-box.error .info-box-icon .material-icons-outlined {
            color: #ea4335;
        }

        .info-box-content {
            flex: 1;
        }

        .info-box-title {
            font-size: 14px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 4px;
        }

        .info-box-text {
            font-size: 13px;
            color: #5f6368;
            line-height: 1.5;
        }

        .info-box-text ul {
            margin: 8px 0 0 0;
            padding-left: 20px;
        }

        .info-box-text li {
            margin-bottom: 4px;
        }

        /* Checklist items */
        .checklist-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .checklist-item:hover {
            background: #f0f0f0;
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #004289;
            flex-shrink: 0;
        }

        .checklist-item-content {
            flex: 1;
            min-width: 0;
        }

        .checklist-item-title {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .checklist-item-desc {
            font-size: 12px;
            color: #5f6368;
            margin-top: 2px;
        }

        .checklist-item-badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .checklist-item-badge.ok {
            background: #e6f4ea;
            color: #137333;
        }

        .checklist-item-badge.neutral {
            background: #f1f3f4;
            color: #5f6368;
        }

        .checklist-item-badge.warning {
            background: #fef7e0;
            color: #7a4200;
        }

        /* Data card komponenty pro zobrazení načtených dat */
        .data-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .data-row {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #f1f3f4;
            gap: 12px;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-row.empty {
            background: #fafafa;
        }

        .data-row.error {
            background: #fce8e6;
        }

        .data-label {
            width: 180px;
            flex-shrink: 0;
            font-size: 12px;
            color: #5f6368;
            font-weight: 500;
        }

        .data-value {
            flex: 1;
            font-size: 13px;
            color: #202124;
        }

        .data-value.muted {
            color: #9aa0a6;
            font-style: italic;
        }

        .data-value .data-link {
            color: #1a73e8;
            cursor: pointer;
        }

        .data-value .data-link:hover {
            text-decoration: underline;
        }

        .data-status {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .data-status.ok {
            background: #e6f4ea;
            color: #137333;
        }

        .data-status.ok:hover {
            background: #ceead6;
        }

        .data-status.error {
            background: #fce8e6;
            color: #c5221f;
        }

        .data-status.error:hover {
            background: #f5c6c2;
        }

        .data-status.na {
            background: #f1f3f4;
            color: #9aa0a6;
            cursor: default;
        }

        .data-status .material-icons-outlined {
            font-size: 18px;
        }

        .deficiency-note-section {
            margin-top: 16px;
            padding: 16px;
            background: #fef7e0;
            border: 1px solid #f9ab00;
            border-radius: 8px;
        }

        .deficiency-note-section .control-section-title {
            margin-bottom: 12px;
        }

        .deficiency-note-input {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
        }

        .deficiency-note-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .checklist-label {
            flex: 1;
            font-size: 13px !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .checklist-note {
            font-size: 12px !important;
            color: #9aa0a6 !important;
            font-style: italic !important;
        }

        .checklist-item:has(input:not(:checked)) {
            opacity: 0.6;
        }

        /* ==========================================
           IDENTIFIKACE DO/TDI - Porovnávací matice
           ========================================== */
        .identifikace-ai-section {
            background: linear-gradient(135deg, #f0e6ff 0%, #e6f0ff 100%);
            border: 1px solid #d4c4f0;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .identifikace-ai-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .identifikace-ai-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #5b21b6;
        }

        .identifikace-ai-title .material-icons-outlined {
            font-size: 18px;
            color: #7c3aed;
        }

        .btn-ai-analyze {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-ai-analyze:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .btn-ai-analyze:disabled {
            background: #d4c4f0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-ai-analyze .material-icons-outlined {
            font-size: 16px;
        }

        .identifikace-ai-status {
            font-size: 12px;
            color: #5f6368;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .identifikace-ai-status.done {
            color: #137333;
        }

        .identifikace-ai-status .material-icons-outlined {
            font-size: 16px;
        }

        /* Porovnávací matice */
        .subjekty-matrix {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .matrix-header {
            display: grid;
            grid-template-columns: 2fr 80px 80px 90px;
            gap: 8px;
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            font-size: 11px;
            font-weight: 600;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .matrix-header-cell {
            text-align: center;
        }

        .matrix-header-cell:first-child {
            text-align: left;
        }

        .matrix-group {
            border-bottom: 1px solid #e0e0e0;
        }

        .matrix-group:last-child {
            border-bottom: none;
        }

        .matrix-group-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #f8f9fa;
            font-size: 12px;
            font-weight: 600;
            color: #202124;
            cursor: pointer;
        }

        .matrix-group-header .material-icons-outlined {
            font-size: 18px;
            color: #5f6368;
        }

        .matrix-group-header .group-count {
            margin-left: auto;
            padding: 2px 8px;
            background: #e8eaed;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
            color: #5f6368;
        }

        .matrix-row {
            display: grid;
            grid-template-columns: 2fr 80px 80px 90px;
            gap: 8px;
            padding: 10px 16px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            transition: background 0.15s;
        }

        .matrix-row:last-child {
            border-bottom: none;
        }

        .matrix-row:hover {
            background: #f8f9fa;
        }

        .matrix-row.status-ok {
            background: #f0faf3;
        }

        .matrix-row.status-missing {
            background: #fef7e0;
        }

        .matrix-row.status-extra {
            background: #e8f4fd;
        }

        .matrix-row.status-not-required {
            opacity: 0.6;
        }

        .matrix-subjekt {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .matrix-subjekt-name {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        .matrix-subjekt-detail {
            font-size: 11px;
            color: #5f6368;
        }

        .matrix-cell {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-check {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-check .material-icons-outlined {
            font-size: 16px;
        }

        .matrix-check.yes {
            background: #e6f4ea;
            color: #137333;
        }

        .matrix-check.no {
            background: #f5f5f5;
            color: #9aa0a6;
        }

        .matrix-check.missing {
            background: #fce8e6;
            color: #c5221f;
        }

        .matrix-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #004289;
        }

        .matrix-docs-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            color: #1a73e8;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-docs-btn:hover {
            background: #e8f1fa;
        }

        .matrix-docs-btn .material-icons-outlined {
            font-size: 18px;
        }

        /* Přidat subjekt */
        .matrix-add-row {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }

        .matrix-add-select {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            background: #fff;
            outline: none;
        }

        .matrix-add-select:focus {
            border-color: #1a73e8;
        }

        .matrix-add-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            outline: none;
        }

        .matrix-add-input:focus {
            border-color: #1a73e8;
        }

        .btn-add-subjekt {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-add-subjekt:hover {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .btn-add-subjekt .material-icons-outlined {
            font-size: 16px;
        }

        /* Výsledek kontroly */
        .identifikace-result {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .identifikace-result-title {
            font-size: 12px;
            font-weight: 600;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 12px;
        }

        .identifikace-result-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .identifikace-result-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .identifikace-result-item .material-icons-outlined {
            font-size: 18px;
        }

        .identifikace-result-item.ok {
            color: #137333;
        }

        .identifikace-result-item.warning {
            color: #b06000;
        }

        .identifikace-result-item.info {
            color: #004289;
        }

        .identifikace-result-item .count {
            font-weight: 600;
        }

        .identifikace-result-item .detail {
            font-size: 12px;
            color: #5f6368;
            margin-left: 4px;
        }

        /* Tooltip pro dokumenty */
        .docs-tooltip {
            position: absolute;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 12px;
            z-index: 100;
            max-width: 280px;
            font-size: 12px;
        }

        .docs-tooltip-title {
            font-weight: 600;
            color: #202124;
            margin-bottom: 8px;
        }

        .docs-tooltip-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 0;
            color: #5f6368;
        }

        .docs-tooltip-item .material-icons-outlined {
            font-size: 16px;
            color: #c62828;
        }

        /* Rozšířená matice - 5 sloupců */
        .matrix-header.extended {
            grid-template-columns: 2fr 70px 70px 100px 80px;
        }

        .matrix-row.extended {
            grid-template-columns: 2fr 70px 70px 100px 80px;
        }

        /* Výsledek dropdown */
        .matrix-vysledek-select {
            padding: 4px 8px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 11px;
            background: #fff;
            cursor: pointer;
            min-width: 90px;
        }

        .matrix-vysledek-select:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .matrix-vysledek-select.kladne {
            background: #e6f4ea;
            border-color: #ceead6;
            color: #137333;
        }

        .matrix-vysledek-select.s-podminkami {
            background: #e8f1fa;
            border-color: #c2d9f2;
            color: #004289;
        }

        .matrix-vysledek-select.zaporne {
            background: #fce8e6;
            border-color: #f5c6c3;
            color: #c5221f;
        }

        /* Tlačítko podmínky */
        .btn-podminky {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            padding: 4px 8px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            background: #fff;
            font-size: 11px;
            color: #5f6368;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-podminky:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-podminky.has-podminky {
            background: #e8f1fa;
            border-color: #004289;
            color: #004289;
        }

        .btn-podminky .material-icons-outlined {
            font-size: 14px;
        }

        .btn-podminky .podminky-count {
            font-weight: 600;
        }

        /* Modal pro podmínky */
        .podminky-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .podminky-modal-overlay.open {
            display: flex;
        }

        .podminky-modal {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            width: 700px;
            max-width: 95%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .podminky-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .podminky-modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #202124;
        }

        .podminky-modal-title .material-icons-outlined {
            font-size: 24px;
            color: #004289;
        }

        .podminky-modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .podminky-modal-close:hover {
            background: #e8eaed;
        }

        .podminky-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .podminky-modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 0 0 12px 12px;
        }

        /* Sekce v modalu */
        .podminky-section {
            margin-bottom: 20px;
        }

        .podminky-section:last-child {
            margin-bottom: 0;
        }

        .podminky-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 12px;
        }

        /* Info o dokumentu */
        .dokument-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .dokument-info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dokument-info-label {
            font-size: 11px;
            color: #5f6368;
            text-transform: uppercase;
        }

        .dokument-info-value {
            font-size: 13px;
            color: #202124;
        }

        .dokument-info-value input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 13px;
        }

        .dokument-info-value input:focus {
            outline: none;
            border-color: #1a73e8;
        }

        /* Výsledek v modalu */
        .vysledek-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .vysledek-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            flex: 1;
            min-width: 150px;
        }

        .vysledek-option:hover {
            border-color: #9aa0a6;
        }

        .vysledek-option.selected {
            border-color: #004289;
            background: #e8f1fa;
        }

        .vysledek-option.kladne.selected {
            border-color: #137333;
            background: #e6f4ea;
        }

        .vysledek-option.zaporne.selected {
            border-color: #c5221f;
            background: #fce8e6;
        }

        .vysledek-option input {
            display: none;
        }

        .vysledek-option-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vysledek-option-icon .material-icons-outlined {
            font-size: 16px;
        }

        .vysledek-option.kladne .vysledek-option-icon {
            background: #e6f4ea;
            color: #137333;
        }

        .vysledek-option.s-podminkami .vysledek-option-icon {
            background: #e8f1fa;
            color: #004289;
        }

        .vysledek-option.zaporne .vysledek-option-icon {
            background: #fce8e6;
            color: #c5221f;
        }

        .vysledek-option-label {
            font-size: 13px;
            font-weight: 500;
            color: #202124;
        }

        /* Seznam podmínek */
        .podminky-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .podminka-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .podminka-item.inactive {
            opacity: 0.5;
            background: #f5f5f5;
        }

        .podminka-checkbox {
            margin-top: 2px;
        }

        .podminka-text {
            flex: 1;
            font-size: 13px;
            color: #202124;
            line-height: 1.5;
        }

        .podminka-text textarea {
            width: 100%;
            min-height: 60px;
            padding: 8px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
        }

        .podminka-text textarea:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .podminka-remove {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: #9aa0a6;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .podminka-remove:hover {
            background: #fce8e6;
            color: #c5221f;
        }

        .podminka-remove .material-icons-outlined {
            font-size: 18px;
        }

        /* Přidat podmínku */
        .add-podminka-row {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .add-podminka-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
        }

        .add-podminka-input:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .btn-add-podminka {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 10px 16px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #5f6368;
            cursor: pointer;
        }

        .btn-add-podminka:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-add-podminka .material-icons-outlined {
            font-size: 18px;
        }

        /* Poznámka úředníka */
        .poznamka-textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
        }

        .poznamka-textarea:focus {
            outline: none;
            border-color: #1a73e8;
        }

        /* Souhrn pro rozhodnutí */
        .souhrn-rozhodnuti {
            margin-top: 20px;
            padding: 16px;
            background: #f0f7ff;
            border: 1px solid #c2d9f2;
            border-radius: 10px;
        }

        .souhrn-rozhodnuti-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .souhrn-rozhodnuti-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #004289;
        }

        .souhrn-rozhodnuti-title .material-icons-outlined {
            font-size: 20px;
        }

        .btn-report {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #004289;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            transition: background 0.15s;
        }

        .btn-report:hover {
            background: #003066;
        }

        .btn-report .material-icons-outlined {
            font-size: 18px;
        }

        .souhrn-rozhodnuti-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .souhrn-rozhodnuti-actions .btn-report {
            padding: 6px 12px;
            font-size: 12px;
            background: #fff;
            color: #004289;
            border: 1px solid #004289;
        }

        .souhrn-rozhodnuti-actions .btn-report:hover {
            background: #e8f1fa;
        }

        .souhrn-rozhodnuti-actions .btn-report .material-icons-outlined {
            font-size: 16px;
        }

        .souhrn-stats {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        /* Report modal */
        .report-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .report-modal-overlay.open {
            display: flex;
        }

        .report-modal {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            width: 900px;
            max-width: 95%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .report-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .report-modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #202124;
        }

        .report-modal-title .material-icons-outlined {
            font-size: 24px;
            color: #004289;
        }

        .report-modal-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .report-modal-close:hover {
            background: #e8eaed;
        }

        .report-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .btn-download {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #202124;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-download:hover {
            background: #f1f3f4;
            border-color: #5f6368;
        }

        .btn-download .material-icons-outlined {
            font-size: 18px;
        }

        /* Report content styles */
        .report-content {
            font-family: 'Segoe UI', Roboto, sans-serif;
            font-size: 13px;
            line-height: 1.6;
            color: #202124;
        }

        .report-header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #004289;
        }

        .report-header h1 {
            font-size: 18px;
            font-weight: 600;
            color: #004289;
            margin: 0 0 8px 0;
        }

        .report-header .report-meta {
            font-size: 12px;
            color: #5f6368;
        }

        .report-section {
            margin-bottom: 24px;
        }

        .report-section h2 {
            font-size: 14px;
            font-weight: 600;
            color: #202124;
            margin: 0 0 12px 0;
            padding-bottom: 6px;
            border-bottom: 1px solid #e0e0e0;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 12px;
        }

        .report-table th,
        .report-table td {
            padding: 8px 10px;
            text-align: left;
            border: 1px solid #e0e0e0;
            font-size: 12px;
        }

        .report-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #5f6368;
        }

        .report-table tr:nth-child(even) {
            background: #fafafa;
        }

        .report-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .report-status.kladne {
            background: #e6f4ea;
            color: #137333;
        }

        .report-status.s-podminkami {
            background: #e8f1fa;
            color: #004289;
        }

        .report-status.zaporne {
            background: #fce8e6;
            color: #c5221f;
        }

        .report-status.chybi {
            background: #fff3e0;
            color: #e65100;
        }

        .report-podminky-list {
            margin: 0;
            padding-left: 20px;
        }

        .report-podminky-list li {
            margin-bottom: 4px;
        }

        .report-subjekt-block {
            margin-bottom: 16px;
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .report-subjekt-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .report-subjekt-name {
            font-weight: 600;
            color: #202124;
        }

        .report-subjekt-meta {
            font-size: 11px;
            color: #5f6368;
            margin-bottom: 8px;
        }

        .report-no-podminky {
            font-style: italic;
            color: #9aa0a6;
            font-size: 12px;
        }

        .report-podminka-skupina {
            margin-bottom: 16px;
            padding: 12px 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .report-podminka-subjekt {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .report-podminka-subjekt strong {
            color: #202124;
        }

        .report-podminka-subjekt span {
            margin-left: 12px;
            color: #5f6368;
            font-size: 12px;
        }

        .report-podminka-list {
            margin: 0;
            padding-left: 24px;
        }

        .report-podminka-list li {
            margin-bottom: 6px;
            line-height: 1.5;
        }

        .report-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #004289;
            margin: 0 0 8px 0;
        }

        .report-header h3 {
            color: #202124;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
            margin-top: 24px;
            font-size: 14px;
        }

        .report-section h3 {
            color: #202124;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
            margin: 0 0 12px 0;
            font-size: 14px;
        }

        .souhrn-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .souhrn-stat .material-icons-outlined {
            font-size: 18px;
        }

        .souhrn-stat.ok {
            color: #137333;
        }

        .souhrn-stat.podminky {
            color: #004289;
        }

        .souhrn-stat.warning {
            color: #b06000;
        }

        .souhrn-stat.error {
            color: #c5221f;
        }

        /* AI Control Section */
        .ai-control-section {
            background: linear-gradient(135deg, #f0e6ff 0%, #e6f0ff 100%);
            border: 1px solid #d4c4f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-control-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .ai-control-header .material-icons-outlined {
            font-size: 20px;
            color: #7c3aed;
        }

        .btn-ai {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff !important;
            border: none;
            border-radius: 8px;
            font-size: 14px !important;
            font-weight: 500 !important;
            cursor: pointer;
            transition: all 0.2s;
            font-style: normal !important;
        }

        .btn-ai:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .btn-ai:disabled {
            background: #d4c4f0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-ai .material-icons-outlined {
            font-size: 18px;
        }

        /* AI Result Section */
        .ai-result-section {
            background: #f8f5ff;
            border: 1px solid #e4d9f5;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .ai-result-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            margin-bottom: 16px;
            font-style: normal !important;
        }

        .ai-result-header .material-icons-outlined {
            font-size: 20px;
            color: #7c3aed;
        }

        .ai-result-badge {
            margin-left: auto;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        .ai-result-badge.success {
            background: #dcfce7;
            color: #166534;
        }

        .ai-result-badge.loading {
            background: #fef3c7;
            color: #92400e;
        }

        .ai-report-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: #fff;
            border: 1px solid #e4d9f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 16px;
        }

        .ai-report-link:hover {
            background: #f5f0ff;
            border-color: #c4b5fd;
        }

        .ai-report-link .material-icons-outlined:first-child {
            font-size: 24px;
            color: #7c3aed;
        }

        .ai-report-link-content {
            flex: 1;
        }

        .ai-report-link-title {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .ai-report-link-meta {
            font-size: 12px !important;
            color: #5f6368 !important;
            font-style: normal !important;
        }

        .ai-report-link .material-icons-outlined:last-child {
            font-size: 18px;
            color: #9aa0a6;
        }

        .ai-summary {
            display: flex;
            gap: 16px;
        }

        .ai-summary-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px !important;
            font-style: normal !important;
        }

        .ai-summary-item .material-icons-outlined {
            font-size: 18px;
        }

        .ai-summary-item.success {
            color: #166534 !important;
        }

        .ai-summary-item.warning {
            color: #92400e !important;
        }

        .ai-summary-item.error {
            color: #991b1b !important;
        }

        /* AI Report Detail */
        .ai-report-detail {
            background: #fff;
            border: 1px solid #e4d9f5;
            border-radius: 12px;
            margin-bottom: 24px;
            max-height: 400px;
            overflow-y: auto;
        }

        .ai-report-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e4d9f5;
            background: #f8f5ff;
            border-radius: 12px 12px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .ai-report-detail-title {
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #5b21b6 !important;
            font-style: normal !important;
        }

        .ai-report-close {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-report-close:hover {
            background: #e4d9f5;
        }

        .ai-report-content {
            padding: 16px 20px;
        }

        .ai-report-group {
            margin-bottom: 20px;
        }

        .ai-report-group:last-child {
            margin-bottom: 0;
        }

        .ai-report-group-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px !important;
            font-weight: 600 !important;
            margin-bottom: 12px;
            font-style: normal !important;
        }

        .ai-report-group-title .material-icons-outlined {
            font-size: 18px;
        }

        .ai-report-group-title.success {
            color: #166534 !important;
        }

        .ai-report-group-title.warning {
            color: #92400e !important;
        }

        .ai-report-group-title.error {
            color: #991b1b !important;
        }

        .ai-report-item {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 14px 16px;
            margin-bottom: 8px;
        }

        .ai-report-item:last-child {
            margin-bottom: 0;
        }

        .ai-report-item-title {
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .ai-report-item-result {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px !important;
            font-weight: 500 !important;
            margin-top: 4px;
            font-style: normal !important;
        }

        .ai-report-item-result.success {
            background: #dcfce7;
            color: #166534;
        }

        .ai-report-item-result.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .ai-report-item-result.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .ai-report-item-detail {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
        }

        .ai-report-source {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px !important;
            font-style: normal !important;
        }

        .source-label {
            color: #5f6368 !important;
            flex-shrink: 0;
        }

        .source-path {
            color: #1a73e8 !important;
            font-family: 'Roboto Mono', monospace !important;
            font-size: 11px !important;
        }

        .ai-report-note {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 8px;
            padding: 8px 12px;
            background: #e8f5e9;
            border-radius: 6px;
            font-style: normal !important;
        }

        .ai-report-note.warning {
            background: #fff8e1;
            color: #795548 !important;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .ai-report-note.warning .material-icons-outlined {
            font-size: 16px;
            color: #f57c00;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .ai-report-item.collapsed .ai-report-item-detail {
            display: none;
        }

        .ai-report-item.collapsed {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ai-report-item.collapsed .ai-report-item-title {
            margin-bottom: 0;
        }

        .ai-report-item.collapsed .ai-report-item-result {
            margin-top: 0;
        }

        /* Loading animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .btn-ai.loading {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            to {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
        }
        
        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        @keyframes toastOut {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            to {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
        }

        /* Modal styles - pro pomocné modály */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal,
        .modal-dialog {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            max-width: 560px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal.modal-large {
            max-width: 900px;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .modal-title {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            font-size: 16px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .modal-title .material-icons-outlined {
            font-size: 24px !important;
            color: #004289 !important;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: #5f6368;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f1f3f4;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid #e0e0e0;
            background: #fafafa;
            flex-shrink: 0;
        }

        /* Form elements in modal */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            margin-bottom: 6px !important;
        }

        .form-select {
            width: 100% !important;
            padding: 10px 12px !important;
            border: 1px solid #dadce0 !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            color: #202124 !important;
            background: #fff !important;
        }

        .form-select:focus {
            outline: none;
            border-color: #004289;
        }

        .form-check-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-check {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
        }

        .form-check:hover {
            background: #f0f0f0;
        }

        .form-check input[type="radio"],
        .form-check input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            accent-color: #004289;
        }

        .form-check-content {
            flex: 1;
        }

        .form-check-label {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #202124 !important;
            font-style: normal !important;
        }

        .form-check-desc {
            font-size: 12px !important;
            color: #5f6368 !important;
            margin-top: 2px !important;
            font-style: normal !important;
        }

        /* Result box */
        .result-box {
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .result-box.success {
            background: #e6f4ea;
            border: 1px solid #ceead6;
        }

        .result-box.warning {
            background: #fef7e0;
            border: 1px solid #f5e6b3;
        }

        .result-box.error {
            background: #fce8e6;
            border: 1px solid #f5c6c3;
        }

        .result-box-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .result-box.success .result-box-title {
            color: #137333;
        }

        .result-box.warning .result-box-title {
            color: #b06000;
        }

        .result-box.error .result-box-title {
            color: #c5221f;
        }

        .result-box-title .material-icons-outlined {
            font-size: 20px;
        }

        .result-box-text {
            font-size: 13px;
        }

        .result-box.success .result-box-text {
            color: #137333;
        }

        .result-box.warning .result-box-text {
            color: #7a4200;
        }

        .result-box.error .result-box-text {
            color: #a50e0e;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .control-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .case-header-main {
                padding: 12px 16px;
                flex-direction: column;
                align-items: flex-start;
            }

            .document-access-bar {
                padding: 10px 16px;
                flex-wrap: wrap;
            }

            .page-content {
                padding: 16px;
            }

            .control-grid {
                grid-template-columns: 1fr;
            }

            .summary-card {
                flex-direction: column;
                text-align: center;
            }

            .summary-actions {
                width: 100%;
            }

            .summary-actions .btn {
                flex: 1;
            }
        }
    
        /* ================================================
           BLOCK EDITOR: Výzva k doplnění + Usnesení
           ================================================ */
        .editor-layout { display: flex; flex: 1; overflow: hidden; }
        .editor-sidebar { width: 220px; border-right: 1px solid #e0e0e0; background: #f8f9fa; overflow-y: auto; flex-shrink: 0; padding: 10px 0; }
        .editor-sidebar .sidebar-section { padding: 0 10px; margin-bottom: 10px; }
        .editor-sidebar .sidebar-section-title { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: .4px; color: #5f6368; margin-bottom: 4px; padding: 0 6px; }
        .editor-sidebar .sidebar-item { display: flex; align-items: center; gap: 5px; padding: 5px 6px; border-radius: 4px; cursor: pointer; font-size: 11px; margin-bottom: 1px; }
        .editor-sidebar .sidebar-item:hover { background: #e8eaed; }
        .editor-sidebar .sidebar-item.active { background: #d2e3fc; color: #004289; font-weight: 500; }
        .si-icon { width: 16px; height: 16px; border-radius: 3px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .si-icon.auto { background: #e8eaed; color: #5f6368; }
        .si-icon.semi { background: #d2e3fc; color: #004289; }
        .si-icon.free { background: #fef7e0; color: #e37400; }
        .si-icon .material-icons-outlined { font-size: 11px; }
        .sidebar-legend { padding: 8px 10px; border-top: 1px solid #e0e0e0; margin-top: 6px; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 9px; color: #5f6368; margin-bottom: 2px; }
        .legend-dot { width: 8px; height: 8px; border-radius: 2px; flex-shrink: 0; }

        .editor-main { flex: 1; overflow-y: auto; padding: 20px; background: #eef1f5; }
        .editor-paper { max-width: 680px; margin: 0 auto; background: white; box-shadow: 0 1px 3px rgba(60,64,67,.3), 0 4px 8px 3px rgba(60,64,67,.15); border-radius: 3px; padding: 32px 40px; min-height: 700px; }
        .doc-block { position: relative; margin-bottom: 2px; padding: 7px 9px; border-radius: 3px; transition: all .12s; border-left: 3px solid transparent; }
        .doc-block.auto { border-left-color: #dadce0; background: #f1f3f4; }
        .doc-block.semi { border-left-color: #a8c7fa; background: #e8f0fe; cursor: pointer; }
        .doc-block.semi:hover { background: #d2e3fc; }
        .doc-block.free { border-left-color: #f9ab00; background: #fffdf5; }
        .doc-block.free:hover { background: #fff8e1; }
        .block-label { position: absolute; top: 2px; right: 2px; display: none; font-size: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: .3px; padding: 1px 4px; border-radius: 2px; opacity: .7; align-items: center; gap: 2px; }
        .doc-block:hover .block-label { display: flex; }
        .block-label.auto-label { background: #e8eaed; color: #5f6368; }
        .block-label.semi-label { background: #d2e3fc; color: #004289; }
        .block-label.free-label { background: #fef7e0; color: #e37400; }
        .block-label .material-icons-outlined { font-size: 9px; }
        .block-body { font-size: 11px; line-height: 1.55; color: #333; }
        .block-body p { margin-bottom: 5px; text-align: justify; }
        .block-urad { text-align: center; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .block-sub { text-align: center; font-size: 10px; color: #555; margin-top: 1px; }
        .block-header-text { text-align: center; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin: 5px 0; }

        .deficiency-list-editor { margin: 4px 0; }
        .deficiency-item-ed { display: flex; align-items: flex-start; gap: 7px; padding: 7px 9px; background: white; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 3px; }
        .deficiency-item-ed.from-control { border-left: 3px solid #004289; }
        .deficiency-item-ed.user-added { border-left: 3px solid #f9ab00; }
        .def-cb { width: 15px; height: 15px; border-radius: 3px; border: 2px solid #dadce0; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; margin-top: 1px; }
        .def-cb.checked { background: #004289; border-color: #004289; color: white; }
        .def-cb .material-icons-outlined { font-size: 11px; }
        .def-body-ed { flex: 1; }
        .def-source-ed { font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: .3px; margin-bottom: 1px; }
        .def-source-ed.control { color: #004289; }
        .def-source-ed.manual { color: #e37400; }
        .def-text-ed { font-size: 11px; line-height: 1.4; color: #202124; }
        .def-sub-ed { margin-left: 18px; margin-top: 3px; }
        .def-sub-item-ed { display: flex; align-items: flex-start; gap: 5px; padding: 2px 0; font-size: 10px; }

        .add-def-btn { display: flex; align-items: center; gap: 5px; padding: 7px 10px; border: 2px dashed #dadce0; border-radius: 4px; background: none; color: #5f6368; cursor: pointer; font-size: 11px; font-family: inherit; width: 100%; }
        .add-def-btn:hover { border-color: #004289; color: #004289; background: #e8f0fe; }
        .free-text-ed { min-height: 50px; padding: 7px 9px; border: 1px solid #f9ab00; border-radius: 4px; background: white; font-family: 'Roboto', sans-serif; font-size: 11px; line-height: 1.5; color: #333; outline: none; width: 100%; display: block; }
        .free-text-ed:focus { border-color: #004289; box-shadow: 0 0 0 2px #d2e3fc; }

        .lhuta-sel { display: flex; gap: 6px; padding: 4px 0; }
        .lhuta-opt { display: flex; align-items: center; gap: 5px; padding: 7px 10px; border: 2px solid #e0e0e0; border-radius: 5px; cursor: pointer; flex: 1; font-size: 11px; }
        .lhuta-opt:hover { border-color: #004289; }
        .lhuta-opt.selected { border-color: #004289; background: #e8f0fe; }
        .lhuta-radio-ed { width: 13px; height: 13px; border-radius: 50%; border: 2px solid #dadce0; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .lhuta-opt.selected .lhuta-radio-ed { border-color: #004289; }
        .lhuta-opt.selected .lhuta-radio-ed::after { content: ''; width: 7px; height: 7px; border-radius: 50%; background: #004289; }
        .lhuta-inp { width: 45px; padding: 2px 5px; border: 1px solid #dadce0; border-radius: 3px; font-size: 11px; text-align: center; }

        .editor-props-panel { width: 240px; border-left: 1px solid #e0e0e0; background: #fff; overflow-y: auto; flex-shrink: 0; padding: 12px; }
        .editor-props-panel .props-section { margin-bottom: 14px; }
        .editor-props-panel .props-title { font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: .3px; color: #5f6368; margin-bottom: 5px; }
        .editor-props-panel .props-stat { display: flex; justify-content: space-between; padding: 4px 0; font-size: 11px; border-bottom: 1px solid #f1f3f4; }
        .editor-props-panel .props-stat:last-child { border: none; }
        .ds-tag { font-size: 9px; padding: 2px 5px; background: #f1f3f4; border-radius: 8px; color: #5f6368; display: inline-block; margin: 1px; }

    </style>
</head>
<body>
    <!-- ISSŘ Hlavička -->
    <header class="issr-header">
        <a href="../index.html" class="issr-header__logo">
            <img src="../images/logo-issr.png" alt="ISSŘ Logo" class="issr-header__logo-img">
            <span class="issr-header__title">INFORMAČNÍ SYSTÉM STAVEBNÍHO ŘÍZENÍ</span>
        </a>
        
        <div class="issr-header__search">
            <input type="text" class="issr-header__search-input" placeholder="Hledat">
        </div>
        
        <div class="issr-header__actions">
            <div class="issr-header__notification">
                <svg class="issr-header__notification-icon" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"></path>
                </svg>
                <span class="issr-header__notification-badge">2</span>
            </div>
            
            <div class="issr-header__user">
                <span>Aleš Krupa</span>
                <svg class="issr-header__user-icon" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"></path>
                </svg>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Case header -->
        <header class="case-header">
            <div class="case-header-main">
                <div class="case-header-left">
                    <a href="detail-dokumentu.html" class="btn-back" title="Zpět na detail dokumentu">
                        <span class="material-icons-outlined">arrow_back</span>
                    </a>
                    <div class="case-info">
                        <div class="case-number">R/2026/000147</div>
                        <h1 class="case-title" id="caseTitleHeader">Novostavba RD včetně přípojek</h1>
                        <div class="case-meta">
                            <a href="../pages/detail-zameru.html" class="case-meta-item case-meta-link" title="Otevřít detail záměru">
                                <span class="material-icons-outlined">inventory_2</span>
                                Záměr Z/2026/1457
                            </a>
                            <span class="case-meta-item">
                                <span class="material-icons-outlined">gavel</span>
                                Povolení stavby
                            </span>
                            <span class="case-meta-item">
                                <span class="material-icons-outlined">home</span>
                                Jednoduchá stavba
                            </span>
                            <span class="case-badge draft">Kontrola</span>
                            <span class="case-badge fast" id="badgeZrychlene">
                                <span class="material-icons-outlined" style="font-size: 14px;">bolt</span>
                                Zrychlené řízení
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Akční tlačítka -->
                <div class="case-header-actions">
                    <button class="header-action-btn" onclick="openSlideout('udajeRizeni')" title="Údaje řízení">
                        <span class="material-icons-outlined">assignment</span>
                        Údaje řízení
                    </button>
                    <button class="header-action-btn has-issues" onclick="openSlideout('prehledNedostatku')" id="btnNedostatky" title="Přehled nedostatků">
                        <span class="material-icons-outlined">warning_amber</span>
                        Nedostatky
                        <span class="header-action-badge warning" id="nedostatkyBadge">0</span>
                    </button>
                    <div class="action-dropdown">
                        <button class="header-action-btn" onclick="toggleActionDropdown()" id="btnAkceRizeni">
                            <span class="material-icons-outlined">more_vert</span>
                            Akce řízení
                            <span class="material-icons-outlined" style="font-size: 16px; margin-left: -2px;">expand_more</span>
                        </button>
                        <div class="action-dropdown-menu" id="akceRizeniDropdown">
                            <div class="action-dropdown-item" onclick="showActionModal('prerusit')">
                                <span class="material-icons-outlined">pause_circle</span>
                                Přerušit řízení
                            </div>
                            <div class="action-dropdown-item" onclick="showActionModal('postoupit')">
                                <span class="material-icons-outlined">send</span>
                                Postoupit řízení
                            </div>
                            <div class="action-dropdown-item" onclick="showActionModal('predat')">
                                <span class="material-icons-outlined">person_add</span>
                                Předat jinému referentovi
                            </div>
                            <div class="action-dropdown-item" onclick="showActionModal('spojit')">
                                <span class="material-icons-outlined">merge</span>
                                Spojit s jiným řízením
                            </div>
                            <div class="action-dropdown-divider"></div>
                            <div class="action-dropdown-item" onclick="showActionModal('historie')">
                                <span class="material-icons-outlined">history</span>
                                Historie řízení
                            </div>
                            <div class="action-dropdown-divider"></div>
                            <div class="action-dropdown-item danger" onclick="showActionModal('zastavit')">
                                <span class="material-icons-outlined">cancel</span>
                                Zastavit řízení (zpětvzetí)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Workflow stepper + document access -->
            <div class="workflow-bar" style="display: flex !important; align-items: center !important; justify-content: space-between !important; padding: 12px 32px !important; background: #f8f9fa !important; flex-wrap: nowrap !important;">
                <!-- Document access buttons - vlevo -->
                <div class="document-access-buttons" style="display: flex !important; gap: 8px !important; flex-wrap: nowrap !important;">
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('zadostModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">description</span>
                        Žádost
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('prilohyModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">attach_file</span>
                        Přílohy
                        <span class="badge" style="background: #e8f4fd !important; color: #004289 !important; padding: 2px 6px !important; border-radius: 10px !important; font-size: 10px !important; font-weight: 500 !important;">12</span>
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('eedModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">folder</span>
                        El. dokumentace
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('dokladyModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">fact_check</span>
                        Dokladová část
                    </a>
                    <a href="#" class="doc-access-btn" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 12px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;" onclick="openModal('bimModal'); return false;">
                        <span class="material-icons-outlined" style="font-size: 16px !important; color: #5f6368 !important;">view_in_ar</span>
                        BIM model
                    </a>
                </div>
                <!-- Workflow stepper - vpravo -->
                <div class="workflow-stepper" style="display: flex !important; align-items: center !important; gap: 8px !important; flex-wrap: nowrap !important;">
                    <div class="workflow-step active" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #004289 !important; border: 1px solid #004289 !important; color: #fff !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: rgba(255,255,255,0.2) !important; color: #fff !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">1</span>
                        <span style="font-weight: 400 !important;">Příprava řízení</span>
                    </div>
                    <div class="workflow-step-connector" style="width: 24px !important; height: 2px !important; min-width: 24px !important; background: #dadce0 !important; flex-shrink: 0 !important;"></div>
                    <div class="workflow-step" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #fff !important; border: 1px solid #e0e0e0 !important; color: #5f6368 !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: #e0e0e0 !important; color: #5f6368 !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">2</span>
                        <span style="font-weight: 400 !important;">Projednání</span>
                    </div>
                    <div class="workflow-step-connector" style="width: 24px !important; height: 2px !important; min-width: 24px !important; background: #dadce0 !important; flex-shrink: 0 !important;"></div>
                    <div class="workflow-step" style="display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: #fff !important; border: 1px solid #e0e0e0 !important; color: #5f6368 !important; white-space: nowrap !important;">
                        <span class="step-number" style="width: 20px !important; height: 20px !important; min-width: 20px !important; border-radius: 50% !important; background: #e0e0e0 !important; color: #5f6368 !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 11px !important; font-weight: 500 !important;">3</span>
                        <span style="font-weight: 400 !important;">Rozhodnutí</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page content -->
        <div class="page-content">
            <!-- Info panel -->
            <div class="info-panel" id="infoPanel">
                <span class="material-icons-outlined">info</span>
                <div class="info-panel-content">
                    <div class="info-panel-title">Kontrola a příprava řízení</div>
                    <div class="info-panel-text">
                        V tomto kroku proveďte kontroly žádosti a definujte parametry řízení (účastníci, pozemky, dotčené orgány). 
                        Řízení je zahájeno dnem doručení bezvadné žádosti (7. 1. 2026), od tohoto data běží lhůta pro vydání rozhodnutí.
                    </div>
                </div>
            </div>

            <!-- Základní údaje řízení -->
            <div class="rizeni-header-card" style="background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 24px;">
                <div style="display: flex; align-items: flex-start; gap: 24px; flex-wrap: wrap;">
                    <!-- Název stavby - editovatelný -->
                    <div style="flex: 2; min-width: 300px;">
                        <label style="display: block; font-size: 12px; font-weight: 500; color: #5f6368; margin-bottom: 6px;">
                            Název stavby
                            <span style="font-weight: 400; color: #80868b;">(lze upravit)</span>
                        </label>
                        <input type="text" id="nazevStavby" value="Novostavba RD včetně přípojek" 
                            style="width: 100%; padding: 10px 12px; border: 1px solid #dadce0; border-radius: 6px; font-size: 14px; font-family: inherit; color: #202124; background: #fff;"
                            onchange="updateNazevStavby()">
                    </div>
                    <!-- Typ řízení - readonly -->
                    <div style="flex: 1; min-width: 200px;">
                        <label style="display: block; font-size: 12px; font-weight: 500; color: #5f6368; margin-bottom: 6px;">
                            Typ řízení
                            <span style="font-weight: 400; color: #80868b;">(dle žádosti)</span>
                        </label>
                        <div style="padding: 10px 12px; border: 1px solid #e8eaed; border-radius: 6px; font-size: 14px; color: #202124; background: #f8f9fa;">
                            Povolení stavby
                        </div>
                    </div>
                    <!-- Datum doručení -->
                    <div style="flex: 0 0 auto; min-width: 150px;">
                        <label style="display: block; font-size: 12px; font-weight: 500; color: #5f6368; margin-bottom: 6px;">
                            Datum doručení žádosti
                        </label>
                        <div style="padding: 10px 12px; border: 1px solid #e8eaed; border-radius: 6px; font-size: 14px; color: #202124; background: #f8f9fa;">
                            7. 1. 2026
                        </div>
                    </div>
                </div>
                
                <!-- Popis stavby - rozbalovací sekce -->
                <div class="popis-stavby-section" id="popisStavbySection" style="margin-top: 16px; border-top: 1px solid #e8eaed; padding-top: 12px;">
                    <!-- Sbalený stav - pouze titulek a ikona -->
                    <div class="popis-stavby-collapsed" id="popisStavbyCollapsed" style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="expandPopisStavby()">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #5f6368;">description</span>
                            <span style="font-size: 13px; font-weight: 500; color: #3c4043;">Popis stavby</span>
                            <span id="popisStatusBadge" class="popis-status-badge" style="display: none; font-size: 11px; padding: 2px 8px; border-radius: 10px; background: #e8f5e9; color: #137333;">Vyplněno</span>
                        </div>
                        <button class="popis-expand-btn" style="display: flex; align-items: center; gap: 4px; padding: 4px 10px; background: transparent; border: 1px solid #dadce0; border-radius: 4px; font-size: 12px; color: #1a73e8; cursor: pointer;" title="Rozbalit popis">
                            <span class="material-icons-outlined" style="font-size: 16px;">expand_more</span>
                        </button>
                    </div>
                    
                    <!-- Rozbalený editor -->
                    <div id="popisStavbyEditor" class="popis-editor" style="display: none; margin-top: 12px;">
                        <div class="popis-editor-hint" style="font-size: 11px; color: #5f6368; margin-bottom: 8px; line-height: 1.4;">
                            <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle; margin-right: 4px;">info</span>
                            Popis bude použit v úředních dokumentech (vyrozumění o zahájení řízení, oznámení účastníkům). 
                            Měl by obsahovat základní informace o stavbě srozumitelné i pro laiky.
                        </div>
                        <textarea id="popisStavbyTextarea" class="popis-textarea" rows="8" 
                            placeholder="Popište stavbu tak, aby účastníci řízení získali základní představu o záměru...">Předmětem řízení je novostavba rodinného domu o jednom nadzemním podlaží s obytným podkrovím na pozemku parc. č. 1234/5 v k.ú. Horní Lhota. Objekt bude napojen na veřejný vodovod, kanalizaci a elektrickou síť.

Stavba rodinného domu:
Dvoupodlažní objekt (1.NP + podkroví) s půdorysem ve tvaru obdélníka o rozměrech 12,0 × 9,5 m. Zastřešení sedlovou střechou se sklonem 35°. Fasáda bude provedena v kombinaci bílé omítky a dřevěného obkladu. V přízemí se nachází garáž pro jeden osobní automobil, technická místnost, zádveří a obývací pokoj s kuchyňským koutem. V podkroví jsou umístěny tři ložnice a koupelna.

Přípojky inženýrských sítí:
Vodovodní přípojka DN 32 v délce 8,5 m napojena na veřejný vodovod v ulici Pod Lipami.
Kanalizační přípojka DN 150 v délce 12,0 m napojena na veřejnou kanalizaci.
Elektrická přípojka napojena na distribuční síť ČEZ Distribuce.</textarea>
                        
                        <div class="popis-editor-actions" style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px; flex-wrap: wrap; gap: 12px;">
                            <button class="popis-ai-btn" onclick="loadPopisFromAI()" id="popisAiBtn">
                                <span class="material-icons-outlined">auto_awesome</span>
                                <span class="popis-ai-text">Načíst z dokumentace (AI)</span>
                                <span class="popis-ai-loading" style="display: none;">
                                    <span class="material-icons-outlined spinning">sync</span>
                                    Načítám z B. Souhrnná technická zpráva...
                                </span>
                            </button>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-secondary" onclick="cancelPopisStavby()">Zrušit</button>
                                <button class="btn btn-primary" onclick="savePopisStavby()">
                                    <span class="material-icons-outlined">check</span>
                                    Uložit popis
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section header -->
            <div class="section-header">
                <div class="section-title">
                    <span class="material-icons-outlined">checklist</span>
                    Kontrolní panel
                    <button class="section-customize-btn" onclick="openCustomizeControlsModal()" title="Upravit uspořádání kontrol">
                        <span class="material-icons-outlined">tune</span>
                    </button>
                </div>
                <div class="section-progress">
                    <span id="progressText">0 z 9 kontrol</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Control cards -->
            <div class="control-grid">
                <!-- 1. Příslušnost -->
                <div class="control-card status-ready" id="card-prislusnost">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">account_balance</span>
                        </div>
                        <span class="control-card-status">K provedení</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Příslušnost</div>
                        <div class="control-card-desc">Ověření věcné a místní příslušnosti stavebního úřadu</div>
                        <button class="control-card-action" onclick="openControl('controlPrislusnost')">
                            <span class="material-icons-outlined">play_arrow</span>
                            Provést kontrolu
                        </button>
                    </div>
                </div>

                <!-- 2. Kontrola žádosti -->
                <div class="control-card status-waiting disabled" id="card-zadost">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">fact_check</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Kontrola žádosti</div>
                        <div class="control-card-desc">Náležitosti žádosti podle § 184 a § 185 SZ</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve příslušnost
                        </button>
                    </div>
                </div>

                <!-- 3. Dokumentace -->
                <div class="control-card status-waiting disabled" id="card-dokumentace">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">architecture</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Dokumentace</div>
                        <div class="control-card-desc">Kontrola úplnosti, podpisů a formátu projektové dokumentace</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve kontrola žádosti
                        </button>
                    </div>
                </div>

                <!-- 4. Pozemky -->
                <div class="control-card status-waiting disabled" id="card-pozemky">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">terrain</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Pozemky</div>
                        <div class="control-card-desc">Ověření pozemků záměru a identifikace sousedních parcel</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve dokumentace
                        </button>
                    </div>
                </div>

                <!-- 5. Soulad s ÚPD -->
                <div class="control-card status-waiting disabled" id="card-up">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">map</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Soulad s ÚPD</div>
                        <div class="control-card-desc">Kontrola souladu záměru s územně plánovací dokumentací</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 6. Dokladová část (sloučeno z Identifikace DO a Dokladová část) -->
                <div class="control-card status-waiting disabled" id="card-identifikace">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">fact_check</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Dokladová část</div>
                        <div class="control-card-desc">Stanoviska DO a vyjádření vlastníků sítí</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 7. Osoby -->
                <div class="control-card status-waiting disabled" id="card-ucastnici">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">groups</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Osoby</div>
                        <div class="control-card-desc">Ověření vlastníků pozemků a definice osob v řízení</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve pozemky
                        </button>
                    </div>
                </div>

                <!-- 9. Zrychlené řízení -->
                <div class="control-card status-waiting disabled" id="card-zrychlene">
                    <div class="control-card-header">
                        <div class="control-card-icon">
                            <span class="material-icons-outlined">bolt</span>
                        </div>
                        <span class="control-card-status">Čeká</span>
                    </div>
                    <div class="control-card-body">
                        <div class="control-card-title">Zrychlené řízení</div>
                        <div class="control-card-desc">Ověření podmínek pro zrychlené řízení</div>
                        <button class="control-card-action">
                            <span class="material-icons-outlined">lock</span>
                            Nejprve ostatní kontroly
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary / Action bar -->
            <div class="summary-card">
                <div class="summary-content">
                    <div class="summary-title" id="summaryTitle">Dokončete všechny kontroly</div>
                    <div class="summary-desc" id="summaryDesc">Po dokončení všech kontrol bude možné řízení zahájit.</div>
                </div>
                <div class="summary-actions">
                    <button class="btn btn-primary" id="btnZahajit" disabled onclick="zahajitRizeni()">
                        <span class="material-icons-outlined">play_circle</span>
                        Zahájit řízení
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- ============================================ -->
    <!-- KONTROLNÍ OVERLAYE - DVOUPANELOVÝ LAYOUT -->
    <!-- ============================================ -->

    <!-- Kontrola: Příslušnost (všechny podklady) -->
    <div class="control-overlay" id="controlPrislusnost">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlPrislusnost')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">account_balance</span>
                    Kontrola příslušnosti
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left" id="prislusnostViewerTabs">
                        <!-- Portál stavebníka -->
                        <button class="viewer-tab active prislusnost-tab-portal" onclick="switchPrislusnostViewerTab(this, 'zadost')">
                            <span class="material-icons-outlined">list_alt</span>
                            Žádost
                        </button>
                        <!-- Vložená žádost -->
                        <button class="viewer-tab prislusnost-tab-vlozena" onclick="switchPrislusnostViewerTab(this, 'formular')" style="display: none;">
                            <span class="material-icons-outlined">picture_as_pdf</span>
                            Formulář žádosti
                        </button>
                        <!-- Společné záložky -->
                        <button class="viewer-tab" onclick="switchPrislusnostViewerTab(this, 'prilohy')">
                            <span class="material-icons-outlined">attach_file</span>
                            Přílohy
                            <span class="badge">12</span>
                        </button>
                        <button class="viewer-tab" onclick="switchPrislusnostViewerTab(this, 'dokumentace')">
                            <span class="material-icons-outlined">folder</span>
                            El. dokumentace
                        </button>
                        <button class="viewer-tab" onclick="switchPrislusnostViewerTab(this, 'doklady')">
                            <span class="material-icons-outlined">fact_check</span>
                            Dokladová část
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('prislusnost')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content" id="prislusnostViewerContent">
                    <!-- TAB: Žádost - strukturovaná data (read-only) -->
                    <div class="reusable-zadost-data active" id="prislusnostTabZadost">
                        <!-- Bude naplněno JavaScriptem -->
                    </div>
                    
                    <!-- TAB: Formulář žádosti - PDF simulace -->
                    <div class="reusable-formular-preview" id="prislusnostTabFormular" style="display: none;">
                        <!-- Bude naplněno JavaScriptem -->
                    </div>
                    
                    <!-- TAB: Přílohy -->
                    <div class="viewer-placeholder" id="prislusnostTabPrilohy" style="display: none;">
                        <span class="material-icons-outlined">attach_file</span>
                        <div class="viewer-placeholder-title">Přílohy žádosti</div>
                        <div class="viewer-placeholder-text">V ostré verzi by se zde zobrazil seznam příloh</div>
                    </div>
                    
                    <!-- TAB: El. dokumentace -->
                    <div class="viewer-placeholder" id="prislusnostTabDokumentace" style="display: none;">
                        <span class="material-icons-outlined">folder</span>
                        <div class="viewer-placeholder-title">Elektronická dokumentace</div>
                        <div class="viewer-placeholder-text">V ostré verzi by se zde zobrazila projektová dokumentace</div>
                    </div>
                    
                    <!-- TAB: Dokladová část -->
                    <div class="viewer-placeholder" id="prislusnostTabDoklady" style="display: none;">
                        <span class="material-icons-outlined">fact_check</span>
                        <div class="viewer-placeholder-title">Dokladová část</div>
                        <div class="viewer-placeholder-text">V ostré verzi by se zde zobrazila stanoviska DO</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <div class="control-section">
                        <div class="control-section-title">Kontrola příslušnosti stavebního úřadu</div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 16px;">
                            Ověřte, zda je stavební úřad věcně a místně příslušný k projednání této žádosti.
                        </p>
                        
                        <!-- Možnost 1: Příslušný -->
                        <label class="control-option selected" id="optionPrislusny" onclick="selectOption(this); updatePrislusnostResult()">
                            <input type="radio" name="prislusnost" value="prislusny" checked>
                            <div class="control-option-content">
                                <div class="control-option-label">
                                    <span class="material-icons-outlined" style="font-size: 18px; color: #137333; vertical-align: middle; margin-right: 6px;">check_circle</span>
                                    Stavební úřad je příslušný
                                </div>
                                <div class="control-option-desc" id="optionPrislusnyDesc">Stavební úřad je věcně i místně příslušný k projednání žádosti</div>
                            </div>
                        </label>
                        
                        <!-- Možnost 2: Nepříslušný (sloučená) - skryto od 1.1.2028 -->
                        <label class="control-option" id="optionNeprislusny" onclick="selectOption(this, true); updatePrislusnostResult()">
                            <input type="radio" name="prislusnost" value="neprislusny">
                            <div class="control-option-content">
                                <div class="control-option-label">
                                    <span class="material-icons-outlined" style="font-size: 18px; color: #b06000; vertical-align: middle; margin-right: 6px;">send</span>
                                    Stavební úřad není věcně nebo místně příslušný
                                </div>
                                <div class="control-option-desc">Řízení bude postoupeno příslušnému stavebnímu úřadu</div>
                            </div>
                        </label>
                        
                        <!-- Info box pro jednotnou stavební správu (od 1.1.2028) -->
                        <div class="platnost-info-box" id="infoJednotnaSprava" style="display: none;">
                            <div class="platnost-info-icon">
                                <span class="material-icons-outlined">info</span>
                            </div>
                            <div class="platnost-info-content">
                                <div class="platnost-info-title">Jednotná státní stavební správa</div>
                                <div class="platnost-info-text">Od 1. 1. 2028 je zavedena jednotná státní stavební správa. Postoupení řízení pro nepříslušnost se již neprovádí — případné interní směrování probíhá automaticky v rámci JSSÚ.</div>
                            </div>
                        </div>
                        
                        <!-- Výběr SÚ - zobrazí se při nepříslušnosti -->
                        <div class="su-selection-section" id="vyberSuSection">
                            <div class="su-selection-title">
                                <span class="material-icons-outlined">account_balance</span>
                                Výběr příslušného stavebního úřadu
                            </div>
                            <div class="su-selection-desc">
                                Vyberte stavební úřad, kterému bude řízení postoupeno.
                            </div>
                            <div class="su-select-wrapper">
                                <div class="su-search-select" id="postoupitSuSearchSelect">
                                    <div class="su-search-input-wrapper">
                                        <span class="material-icons-outlined su-search-icon">search</span>
                                        <input type="text" class="su-search-input" id="postoupitSuSearchInput" 
                                            placeholder="Vyhledejte stavební úřad..." 
                                            onclick="openSuDropdown('postoupit')"
                                            oninput="filterSuOptions('postoupit')">
                                        <input type="hidden" id="postoupitSuSelect" value="">
                                        <button class="su-search-clear" onclick="clearSuSelection('postoupit')" title="Vymazat">
                                            <span class="material-icons-outlined">close</span>
                                        </button>
                                    </div>
                                    <div class="su-dropdown" id="postoupitSuDropdown">
                                        <div class="su-dropdown-group" data-group="desu">
                                            <div class="su-dropdown-group-title">DESÚ – Dopravní a energetický stavební úřad</div>
                                            <div class="su-dropdown-option" data-value="desu" data-type="DESÚ" data-info="Dopravní a energetický stavební úřad|Sokolovská 1955/278, Praha 9|podatelna@desu.gov.cz|Dopravní stavby celostátního významu, energetické stavby" data-search="desú centrála praha dopravní energetický">
                                                <span class="su-option-name">DESÚ – centrála Praha</span>
                                                <span class="su-option-type">DESÚ</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-group" data-group="ksu">
                                            <div class="su-dropdown-group-title">Krajské stavební úřady</div>
                                            <div class="su-dropdown-option" data-value="ksu_praha" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad hl. m. Prahy|Jungmannova 35/29, Praha 1|stavebni@praha.eu|Stavby na území hl. m. Prahy spadající do působnosti KSÚ" data-search="ksu krajský praha hlavní město">
                                                <span class="su-option-name">KSÚ hl. m. Prahy</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_stredocesky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Středočeského kraje|Zborovská 11, Praha 5|stavebni@kr-s.cz|Stavby na území Středočeského kraje spadající do působnosti KSÚ" data-search="ksu krajský středočeský střední čechy">
                                                <span class="su-option-name">KSÚ Středočeského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_jihocesky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Jihočeského kraje|U Zimního stadionu 1952/2, České Budějovice|stavebni@kraj-jihocesky.cz|Stavby na území Jihočeského kraje spadající do působnosti KSÚ" data-search="ksu krajský jihočeský jižní čechy české budějovice">
                                                <span class="su-option-name">KSÚ Jihočeského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_plzensky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Plzeňského kraje|Škroupova 18, Plzeň|stavebni@plzensky-kraj.cz|Stavby na území Plzeňského kraje spadající do působnosti KSÚ" data-search="ksu krajský plzeňský plzeň">
                                                <span class="su-option-name">KSÚ Plzeňského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_karlovarsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Karlovarského kraje|Závodní 353/88, Karlovy Vary|stavebni@kr-karlovarsky.cz|Stavby na území Karlovarského kraje spadající do působnosti KSÚ" data-search="ksu krajský karlovarský karlovy vary">
                                                <span class="su-option-name">KSÚ Karlovarského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_ustecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Ústeckého kraje|Velká Hradební 3118/48, Ústí nad Labem|stavebni@kr-ustecky.cz|Stavby na území Ústeckého kraje spadající do působnosti KSÚ" data-search="ksu krajský ústecký ústí nad labem">
                                                <span class="su-option-name">KSÚ Ústeckého kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_liberecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Libereckého kraje|U Jezu 642/2a, Liberec|stavebni@kraj-lbc.cz|Stavby na území Libereckého kraje spadající do působnosti KSÚ" data-search="ksu krajský liberecký liberec">
                                                <span class="su-option-name">KSÚ Libereckého kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_kralovehradecky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Královéhradeckého kraje|Pivovarské náměstí 1245, Hradec Králové|stavebni@kr-kralovehradecky.cz|Stavby na území Královéhradeckého kraje spadající do působnosti KSÚ" data-search="ksu krajský královéhradecký hradec králové">
                                                <span class="su-option-name">KSÚ Královéhradeckého kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_pardubicky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Pardubického kraje|Komenského náměstí 125, Pardubice|stavebni@pardubickykraj.cz|Stavby na území Pardubického kraje spadající do působnosti KSÚ" data-search="ksu krajský pardubický pardubice">
                                                <span class="su-option-name">KSÚ Pardubického kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_vysocina" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Kraje Vysočina|Žižkova 57, Jihlava|stavebni@kr-vysocina.cz|Stavby na území Kraje Vysočina spadající do působnosti KSÚ" data-search="ksu krajský vysočina jihlava">
                                                <span class="su-option-name">KSÚ Kraje Vysočina</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_jihomoravsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Jihomoravského kraje|Žerotínovo náměstí 449/3, Brno|stavebni@kr-jihomoravsky.cz|Stavby na území Jihomoravského kraje spadající do působnosti KSÚ" data-search="ksu krajský jihomoravský brno jižní morava">
                                                <span class="su-option-name">KSÚ Jihomoravského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_olomoucky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Olomouckého kraje|Jeremenkova 40a, Olomouc|stavebni@kr-olomoucky.cz|Stavby na území Olomouckého kraje spadající do působnosti KSÚ" data-search="ksu krajský olomoucký olomouc">
                                                <span class="su-option-name">KSÚ Olomouckého kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_zlinsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Zlínského kraje|třída Tomáše Bati 21, Zlín|stavebni@kr-zlinsky.cz|Stavby na území Zlínského kraje spadající do působnosti KSÚ" data-search="ksu krajský zlínský zlín">
                                                <span class="su-option-name">KSÚ Zlínského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="ksu_moravskoslezsky" data-type="Krajský stavební úřad" data-info="Krajský stavební úřad Moravskoslezského kraje|28. října 117, Ostrava|stavebni@kr-moravskoslezsky.cz|Stavby na území Moravskoslezského kraje spadající do působnosti KSÚ" data-search="ksu krajský moravskoslezský ostrava slezsko">
                                                <span class="su-option-name">KSÚ Moravskoslezského kraje</span>
                                                <span class="su-option-type">KSÚ</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-group" data-group="praha">
                                            <div class="su-dropdown-group-title">Praha</div>
                                            <div class="su-dropdown-option" data-value="praha1" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 1|Vodičkova 18, Praha 1|stavebni@praha1.cz|k.ú. Staré Město, Josefov, Malá Strana, Hradčany" data-search="praha 1 staré město josefov malá strana hradčany">
                                                <span class="su-option-name">ÚMČ Praha 1</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="praha2" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 2|náměstí Míru 20, Praha 2|stavebni@praha2.cz|k.ú. Nové Město, Vinohrady, Vyšehrad" data-search="praha 2 nové město vinohrady vyšehrad">
                                                <span class="su-option-name">ÚMČ Praha 2</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="praha3" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 3|Havlíčkovo nám. 700/9, Praha 3|stavebni@praha3.cz|k.ú. Žižkov, Vinohrady" data-search="praha 3 žižkov vinohrady">
                                                <span class="su-option-name">ÚMČ Praha 3</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="praha4" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 4|Antala Staška 2059/80b, Praha 4|stavebni@praha4.cz|k.ú. Braník, Hodkovičky, Krč, Lhotka, Michle, Nusle, Podolí" data-search="praha 4 braník hodkovičky krč lhotka michle nusle podolí">
                                                <span class="su-option-name">ÚMČ Praha 4</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="praha5" data-type="Obecný stavební úřad" data-info="Úřad městské části Praha 5|náměstí 14. října 4, Praha 5|stavebni@praha5.cz|k.ú. Smíchov, Košíře, Motol, Radlice, Hlubočepy, Jinonice" data-search="praha 5 smíchov košíře motol radlice hlubočepy jinonice">
                                                <span class="su-option-name">ÚMČ Praha 5</span>
                                                <span class="su-option-type">Praha</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-group" data-group="stredocesky">
                                            <div class="su-dropdown-group-title">Středočeský kraj</div>
                                            <div class="su-dropdown-option" data-value="kladno" data-type="Obecný stavební úřad" data-info="Magistrát města Kladna|náměstí Starosty Pavla 44, Kladno|stavebni@mestokladno.cz|ORP Kladno" data-search="kladno magistrát orp">
                                                <span class="su-option-name">Magistrát města Kladna</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="benesov" data-type="Obecný stavební úřad" data-info="Městský úřad Benešov|Masarykovo náměstí 100, Benešov|stavebni@benesov-city.cz|ORP Benešov" data-search="benešov městský úřad orp">
                                                <span class="su-option-name">MěÚ Benešov</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="beroun" data-type="Obecný stavební úřad" data-info="Městský úřad Beroun|Husovo náměstí 68, Beroun|stavebni@muberoun.cz|ORP Beroun" data-search="beroun městský úřad orp">
                                                <span class="su-option-name">MěÚ Beroun</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="brandys" data-type="Obecný stavební úřad" data-info="Městský úřad Brandýs n. L. – Stará Boleslav|Masarykovo náměstí 1, Brandýs n. L.|stavebni@brandysko.cz|ORP Brandýs nad Labem" data-search="brandýs nad labem stará boleslav městský úřad orp">
                                                <span class="su-option-name">MěÚ Brandýs nad Labem</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="kolin" data-type="Obecný stavební úřad" data-info="Městský úřad Kolín|Karlovo náměstí 78, Kolín|stavebni@mukolin.cz|ORP Kolín" data-search="kolín městský úřad orp">
                                                <span class="su-option-name">MěÚ Kolín</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="mlboleslav" data-type="Obecný stavební úřad" data-info="Magistrát města Mladá Boleslav|Komenského náměstí 61, Mladá Boleslav|stavebni@mb-net.cz|ORP Mladá Boleslav" data-search="mladá boleslav magistrát orp">
                                                <span class="su-option-name">Magistrát města Mladá Boleslav</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="nymburk" data-type="Obecný stavební úřad" data-info="Městský úřad Nymburk|náměstí Přemyslovců 163, Nymburk|stavebni@meu-nbk.cz|ORP Nymburk" data-search="nymburk městský úřad orp">
                                                <span class="su-option-name">MěÚ Nymburk</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="pribram" data-type="Obecný stavební úřad" data-info="Městský úřad Příbram|Tyršova 108, Příbram|stavebni@pribram.eu|ORP Příbram" data-search="příbram městský úřad orp">
                                                <span class="su-option-name">MěÚ Příbram</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="rakovnik" data-type="Obecný stavební úřad" data-info="Městský úřad Rakovník|Husovo náměstí 27, Rakovník|stavebni@murako.cz|ORP Rakovník" data-search="rakovník městský úřad orp">
                                                <span class="su-option-name">MěÚ Rakovník</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-group" data-group="kralovehradecky">
                                            <div class="su-dropdown-group-title">Královéhradecký kraj</div>
                                            <div class="su-dropdown-option" data-value="hradec" data-type="Obecný stavební úřad" data-info="Magistrát města Hradec Králové|Československé armády 408/51, Hradec Králové|stavebni@mmhk.cz|ORP Hradec Králové" data-search="hradec králové magistrát orp">
                                                <span class="su-option-name">Magistrát města Hradec Králové</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="jaromer" data-type="Obecný stavební úřad" data-info="Městský úřad Jaroměř|náměstí ČSA 16, Jaroměř|stavebni@jaromer-josefov.cz|ORP Jaroměř" data-search="jaroměř městský úřad orp josefov">
                                                <span class="su-option-name">MěÚ Jaroměř</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="nachod" data-type="Obecný stavební úřad" data-info="Městský úřad Náchod|Masarykovo náměstí 40, Náchod|stavebni@mestonachod.cz|ORP Náchod" data-search="náchod městský úřad orp">
                                                <span class="su-option-name">MěÚ Náchod</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="trutnov" data-type="Obecný stavební úřad" data-info="Městský úřad Trutnov|Slovanské náměstí 165, Trutnov|stavebni@trutnov.cz|ORP Trutnov" data-search="trutnov městský úřad orp">
                                                <span class="su-option-name">MěÚ Trutnov</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                            <div class="su-dropdown-option" data-value="jicin" data-type="Obecný stavební úřad" data-info="Městský úřad Jičín|Žižkovo náměstí 18, Jičín|stavebni@mujicin.cz|ORP Jičín" data-search="jičín městský úřad orp">
                                                <span class="su-option-name">MěÚ Jičín</span>
                                                <span class="su-option-type">ORP</span>
                                            </div>
                                        </div>
                                        <div class="su-dropdown-empty" style="display: none;">
                                            <span class="material-icons-outlined">search_off</span>
                                            Žádný stavební úřad nebyl nalezen
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="su-selected-info" id="postoupitSuInfo">
                                <div class="su-selected-header">
                                    <div class="su-selected-icon">
                                        <span class="material-icons-outlined">account_balance</span>
                                    </div>
                                    <div class="su-selected-name" id="postoupitSuName">—</div>
                                </div>
                                <div class="su-selected-details" id="postoupitSuDetails">
                                    <span><strong>Adresa:</strong> —</span>
                                    <span><strong>E-mail:</strong> —</span>
                                    <span><strong>Působnost:</strong> —</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Zdůvodnění nepříslušnosti - zobrazí se při nepříslušnosti -->
                    <div class="control-section" id="zduvodneniNeprislusnostiSection" style="display: none;">
                        <div class="control-section-title">Zdůvodnění nepříslušnosti</div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Uveďte zdůvodnění, proč není stavební úřad příslušný k projednání žádosti. 
                            Text bude součástí dokumentu <strong>Postoupení řízení z důvodu nepříslušnosti</strong>.
                        </p>
                        <textarea id="zduvodneniNeprislusnosti" class="form-textarea" rows="5" 
                            placeholder="Uveďte zdůvodnění nepříslušnosti..."
                            oninput="updatePrislusnostButton()"
                            style="width: 100%; padding: 12px; border: 1px solid #dadce0; border-radius: 6px; font-size: 13px; font-family: inherit; resize: vertical; line-height: 1.5;"></textarea>
                    </div>

                    <div class="result-preview positive" id="resultPrislusnost">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Příslušnost potvrzena
                        </div>
                        <div class="result-preview-text">Stavební úřad je věcně i místně příslušný k projednání této žádosti.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSavePrislusnost">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlPrislusnost')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('prislusnost')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completePrislusnost()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Kontrola žádosti (§ 184, § 185 SZ) -->
    <div class="control-overlay" id="controlZadost">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlZadost')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">fact_check</span>
                    Kontrola žádosti
                </div>
            </div>
        </div>
        <div class="control-body">
            <!-- LEVÉ OKNO: Strukturovaná data ze žádosti s inline kontrolami -->
            <div class="control-viewer zadost-data-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" id="tabZadost" onclick="switchZadostDataTab(this, 'zadost')">
                            <span class="material-icons-outlined">list_alt</span>
                            Žádost
                        </button>
                        <button class="viewer-tab" id="tabFormular" onclick="switchZadostDataTab(this, 'formular')">
                            <span class="material-icons-outlined">picture_as_pdf</span>
                            Formulář žádosti
                        </button>
                        <button class="viewer-tab" id="tabPrilohy" onclick="switchZadostDataTab(this, 'prilohy')" style="display: none;">
                            <span class="material-icons-outlined">attach_file</span>
                            Přílohy
                        </button>
                        <button class="viewer-tab" id="tabDoklady" onclick="switchZadostDataTab(this, 'doklady')">
                            <span class="material-icons-outlined">fact_check</span>
                            Dokladová část
                        </button>
                    </div>
                    <div class="viewer-tabs-right">
                        <button class="btn-vse-ok" id="btnVseOkZadost" onclick="setAllSectionsOk()" title="Označit všechny sekce jako v pořádku">
                            <span class="material-icons-outlined">done_all</span>
                            Vše v pořádku
                        </button>
                    </div>
                </div>
                <div class="viewer-content zadost-data-content">
                    <!-- TAB: Žádost - strukturovaná data s inline kontrolami -->
                    <div class="zadost-data-tab active" id="zadostDataZadost">
                        <!-- 1. Údaje o podání -->
                        <div class="zadost-data-section" id="dataSectionPodani" data-section-id="podani">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">assignment_ind</span>
                                Údaje o podání
                                <span class="section-status-badge" id="statusBadgePodani"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Podatel (kdo činí podání)</div>
                                    <div class="zadost-data-value" id="podaniPodatel">Jan Novák</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Vztah k žadateli</div>
                                    <div class="zadost-data-value" id="podaniVztah">
                                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                                            <span class="material-icons-outlined" style="font-size: 18px; color: #34a853;">check_circle</span>
                                            Podatel je sám žadatel
                                        </span>
                                    </div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Věc podání</div>
                                    <div class="zadost-data-value">Žádost o povolení stavby</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Správní orgán</div>
                                    <div class="zadost-data-value">Dopravní a energetický stavební úřad</div>
                                </div>
                            </div>
                            <!-- Akční tlačítka pro ověření (dynamicky zobrazované) -->
                            <div class="zastupce-verify-actions" id="podaniVerifyActions" style="display: none;">
                                <!-- Tlačítka budou doplněna podle typu zastoupení -->
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusPodani">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('podani', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('podani', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 2. Žadatel -->
                        <div class="zadost-data-section" id="dataSectionZadatel" data-section-id="zadatel">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">person</span>
                                Žadatel — Fyzická osoba
                                <span class="section-status-badge" id="statusBadgeZadatel"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Jméno</div>
                                    <div class="zadost-data-value">Jan</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Příjmení</div>
                                    <div class="zadost-data-value">Novák</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Datum narození</div>
                                    <div class="zadost-data-value">15. 3. 1985</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Místo trvalého pobytu</div>
                                    <div class="zadost-data-value">Květná 123, 110 00 Praha 1</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">E-mail</div>
                                    <div class="zadost-data-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fa909b94d494958c9b91ba9f979b9396d49980">[email&#160;protected]</a></div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Telefon</div>
                                    <div class="zadost-data-value">+420 601 234 567</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Datová schránka</div>
                                    <div class="zadost-data-value">abc123x</div>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusZadatel">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('zadatel', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('zadatel', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 3. Zástupce -->
                        <div class="zadost-data-section" id="dataSectionZastupce" data-section-id="zastupce">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">supervisor_account</span>
                                Zástupce na základě plné moci
                                <span class="section-status-badge" id="statusBadgeZastupce"></span>
                            </div>
                            <div class="zadost-data-empty">
                                <span class="material-icons-outlined">person_off</span>
                                Žadatel jedná sám za sebe, zástupce není uveden
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusZastupce">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('zastupce', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('zastupce', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 4. Identifikace záměru -->
                        <div class="zadost-data-section" id="dataSectionZamer" data-section-id="zamer">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">home_work</span>
                                Identifikace záměru
                                <span class="section-status-badge" id="statusBadgeZamer"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item full-width">
                                    <div class="zadost-data-label">Název záměru</div>
                                    <div class="zadost-data-value">Novostavba rodinného domu s garáží</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Místo stavby</div>
                                    <div class="zadost-data-value">Jaroměř, ulice Květná</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Katastrální území</div>
                                    <div class="zadost-data-value">Jaroměř [657336]</div>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusZamer">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('zamer', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('zamer', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 5. Základní charakteristika záměru -->
                        <div class="zadost-data-section" id="dataSectionCharakteristika" data-section-id="charakteristika">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">info</span>
                                Základní charakteristika záměru
                                <span class="section-status-badge" id="statusBadgeCharakteristika"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Druh stavby</div>
                                    <div class="zadost-data-value">Budova pro bydlení — rodinný dům</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Účel užívání</div>
                                    <div class="zadost-data-value">Bydlení</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Charakter stavby</div>
                                    <div class="zadost-data-value">Trvalá stavba</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Zastavěná plocha</div>
                                    <div class="zadost-data-value">185 m²</div>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusCharakteristika">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('charakteristika', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('charakteristika', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 6. Podrobnější informace o záměru -->
                        <div class="zadost-data-section" id="dataSectionPodrobneji" data-section-id="podrobnosti">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">article</span>
                                Podrobnější informace o záměru
                                <span class="section-status-badge" id="statusBadgePodrobnosti"></span>
                            </div>
                            <div class="zadost-data-grid">
                                <div class="zadost-data-item full-width">
                                    <div class="zadost-data-label">Popis záměru</div>
                                    <div class="zadost-data-value text-block">Dvoupodlažní rodinný dům s obytným podkrovím a vestavěnou garáží pro 2 vozidla. Stavba bude napojena na veřejnou kanalizaci, vodovod, elektrickou energii a plynovod. Vytápění bude zajištěno tepelným čerpadlem vzduch-voda.</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Počet nadzemních podlaží</div>
                                    <div class="zadost-data-value">2 + podkroví</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Počet podzemních podlaží</div>
                                    <div class="zadost-data-value">0</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Počet bytových jednotek</div>
                                    <div class="zadost-data-value">1</div>
                                </div>
                                <div class="zadost-data-item">
                                    <div class="zadost-data-label">Obestavěný prostor</div>
                                    <div class="zadost-data-value">1 250 m³</div>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusPodrobnosti">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('podrobnosti', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('podrobnosti', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 7. Pozemky záměru -->
                        <div class="zadost-data-section" id="dataSectionPozemkyZameru" data-section-id="pozemky">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">terrain</span>
                                Pozemky, které jsou předmětem záměru
                                <span class="section-status-badge" id="statusBadgePozemky"></span>
                            </div>
                            <table class="zadost-data-table">
                                <thead>
                                    <tr>
                                        <th>Parcela</th>
                                        <th>K.ú.</th>
                                        <th>Druh pozemku</th>
                                        <th>Výměra</th>
                                        <th>Vlastník</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>st. 123</strong></td>
                                        <td>Jaroměř</td>
                                        <td>Zastavěná plocha a nádvoří</td>
                                        <td>185 m²</td>
                                        <td>Jan Novák</td>
                                    </tr>
                                    <tr>
                                        <td><strong>456/1</strong></td>
                                        <td>Jaroměř</td>
                                        <td>Zahrada</td>
                                        <td>850 m²</td>
                                        <td>Jan Novák</td>
                                    </tr>
                                    <tr>
                                        <td><strong>456/2</strong></td>
                                        <td>Jaroměř</td>
                                        <td>Zahrada</td>
                                        <td>320 m²</td>
                                        <td>Jan Novák</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusPozemky">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('pozemky', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('pozemky', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 8. Přílohy žádosti -->
                        <div class="zadost-data-section" id="dataSectionPrilohyZadosti" data-section-id="prilohy">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">attach_file</span>
                                Přílohy žádosti
                                <span class="section-status-badge" id="statusBadgePrilohy"></span>
                            </div>
                            <div class="prilohy-list prilohy-list-compact" id="prilohyList">
                                <div class="prilohy-item">
                                    <div class="prilohy-item-icon">
                                        <span class="material-icons-outlined">picture_as_pdf</span>
                                    </div>
                                    <div class="prilohy-item-info">
                                        <div class="prilohy-item-name">Projektová dokumentace.pdf</div>
                                        <div class="prilohy-item-meta">PDF • 24.5 MB • Nahráno 5. 1. 2026</div>
                                    </div>
                                    <button class="prilohy-item-btn" title="Zobrazit">
                                        <span class="material-icons-outlined">visibility</span>
                                    </button>
                                </div>
                                <div class="prilohy-item">
                                    <div class="prilohy-item-icon">
                                        <span class="material-icons-outlined">picture_as_pdf</span>
                                    </div>
                                    <div class="prilohy-item-info">
                                        <div class="prilohy-item-name">Situační výkres.pdf</div>
                                        <div class="prilohy-item-meta">PDF • 3.2 MB • Nahráno 5. 1. 2026</div>
                                    </div>
                                    <button class="prilohy-item-btn" title="Zobrazit">
                                        <span class="material-icons-outlined">visibility</span>
                                    </button>
                                </div>
                                <div class="prilohy-item">
                                    <div class="prilohy-item-icon">
                                        <span class="material-icons-outlined">picture_as_pdf</span>
                                    </div>
                                    <div class="prilohy-item-info">
                                        <div class="prilohy-item-name">Vyjádření sousedů.pdf</div>
                                        <div class="prilohy-item-meta">PDF • 890 KB • Nahráno 5. 1. 2026</div>
                                    </div>
                                    <button class="prilohy-item-btn" title="Zobrazit">
                                        <span class="material-icons-outlined">visibility</span>
                                    </button>
                                </div>
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusPrilohy">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('prilohy', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('prilohy', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 9. Výjimky z požadavků (zobrazí se jen u scénáře s výjimkami) -->
                        <div class="zadost-data-section" id="dataSectionVyjimky" data-section-id="vyjimky" style="display: none;">
                            <div class="zadost-data-section-header">
                                <span class="material-icons-outlined">rule</span>
                                Výjimky z obecných požadavků
                                <span style="margin-left: 8px; padding: 2px 8px; background: #fff3e0; color: #ef6c00; border-radius: 4px; font-size: 10px; font-weight: 600;">ŽÁDÁNO</span>
                                <span class="section-status-badge" id="statusBadgeVyjimky"></span>
                            </div>
                            <div class="zadost-data-grid" id="vyjimkyContent">
                                <!-- Dynamicky generované podle scénáře -->
                            </div>
                            <div class="zadost-section-controls">
                                <div class="zadost-section-status" id="sectionStatusVyjimky">
                                    <span class="material-icons-outlined">radio_button_unchecked</span>
                                    Nezkontrolováno
                                </div>
                                <div class="zadost-section-actions">
                                    <button class="zadost-section-btn btn-ok" onclick="setSectionStatus('vyjimky', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="zadost-section-btn btn-vada" onclick="setSectionStatus('vyjimky', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TAB: Formulář žádosti - náhled PDF -->
                    <div class="zadost-data-tab" id="zadostDataFormular">
                        <div class="formular-preview">
                            <div class="formular-header">
                                <div class="formular-logo">
                                    <span class="material-icons-outlined">account_balance</span>
                                </div>
                                <div class="formular-title-block">
                                    <div class="formular-title">ŽÁDOST O POVOLENÍ STAVBY</div>
                                    <div class="formular-subtitle">podle § 184 zákona č. 283/2021 Sb., stavební zákon</div>
                                </div>
                                <div class="formular-cislo">
                                    <div class="formular-cislo-label">Číslo jednací</div>
                                    <div class="formular-cislo-value">DESU-12345/2025</div>
                                </div>
                            </div>
                            
                            <div class="formular-section">
                                <div class="formular-section-title">ČÁST A – IDENTIFIKAČNÍ ÚDAJE</div>
                                
                                <div class="formular-subsection">
                                    <div class="formular-subsection-title">A.1 Údaje o stavebníkovi</div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Jméno a příjmení / Název</div>
                                            <div class="formular-field-value">Jan Novák</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Datum narození / IČO</div>
                                            <div class="formular-field-value">15. 3. 1985</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field full">
                                            <div class="formular-field-label">Adresa místa trvalého pobytu / Sídlo</div>
                                            <div class="formular-field-value">Květná 123, 110 00 Praha 1</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Telefon</div>
                                            <div class="formular-field-value">+420 601 234 567</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">E-mail</div>
                                            <div class="formular-field-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1a707b743474756c7b715a7f777b7376347960">[email&#160;protected]</a></div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">ID datové schránky</div>
                                            <div class="formular-field-value">abc123x</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="formular-subsection">
                                    <div class="formular-subsection-title">A.2 Údaje o zástupci stavebníka</div>
                                    <div class="formular-field-row">
                                        <div class="formular-field full empty">
                                            <div class="formular-field-label">Zástupce</div>
                                            <div class="formular-field-value">— neuvedeno —</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="formular-section">
                                <div class="formular-section-title">ČÁST B – ÚDAJE O ZÁMĚRU</div>
                                
                                <div class="formular-subsection">
                                    <div class="formular-subsection-title">B.1 Základní údaje</div>
                                    <div class="formular-field-row">
                                        <div class="formular-field full">
                                            <div class="formular-field-label">Název stavby / záměru</div>
                                            <div class="formular-field-value">Novostavba rodinného domu s garáží</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Místo stavby (obec, ulice)</div>
                                            <div class="formular-field-value">Jaroměř, ulice Květná</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Katastrální území</div>
                                            <div class="formular-field-value">Jaroměř [657336]</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field full">
                                            <div class="formular-field-label">Parcelní čísla pozemků</div>
                                            <div class="formular-field-value">st. 123, 456/1, 456/2</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="formular-subsection">
                                    <div class="formular-subsection-title">B.2 Charakteristika záměru</div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Druh stavby</div>
                                            <div class="formular-field-value">Budova pro bydlení — rodinný dům</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Účel užívání</div>
                                            <div class="formular-field-value">Bydlení</div>
                                        </div>
                                    </div>
                                    <div class="formular-field-row">
                                        <div class="formular-field">
                                            <div class="formular-field-label">Zastavěná plocha</div>
                                            <div class="formular-field-value">185 m²</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Obestavěný prostor</div>
                                            <div class="formular-field-value">1 250 m³</div>
                                        </div>
                                        <div class="formular-field">
                                            <div class="formular-field-label">Počet bytů</div>
                                            <div class="formular-field-value">1</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="formular-footer">
                                <div class="formular-page-info">Strana 1 z 3</div>
                                <div class="formular-note">Náhled formuláře dle vyhlášky č. 149/2024 Sb.</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TAB: Přílohy (aktivní pouze v režimu Formulář) -->
                    <div class="zadost-data-tab" id="zadostDataPrilohy">
                        <div class="prilohy-viewer">
                            <div class="prilohy-list">
                                <div class="prilohy-item">
                                    <div class="prilohy-item-icon">
                                        <span class="material-icons-outlined">picture_as_pdf</span>
                                    </div>
                                    <div class="prilohy-item-info">
                                        <div class="prilohy-item-name">Projektová dokumentace.pdf</div>
                                        <div class="prilohy-item-meta">PDF • 24.5 MB • Nahráno 5. 1. 2026</div>
                                    </div>
                                    <button class="prilohy-item-btn" title="Zobrazit">
                                        <span class="material-icons-outlined">visibility</span>
                                    </button>
                                </div>
                                <div class="prilohy-item">
                                    <div class="prilohy-item-icon">
                                        <span class="material-icons-outlined">picture_as_pdf</span>
                                    </div>
                                    <div class="prilohy-item-info">
                                        <div class="prilohy-item-name">Plná moc.pdf</div>
                                        <div class="prilohy-item-meta">PDF • 156 KB • Nahráno 5. 1. 2026</div>
                                    </div>
                                    <button class="prilohy-item-btn" title="Zobrazit">
                                        <span class="material-icons-outlined">visibility</span>
                                    </button>
                                </div>
                                <div class="prilohy-item">
                                    <div class="prilohy-item-icon">
                                        <span class="material-icons-outlined">picture_as_pdf</span>
                                    </div>
                                    <div class="prilohy-item-info">
                                        <div class="prilohy-item-name">Vyjádření sousedů.pdf</div>
                                        <div class="prilohy-item-meta">PDF • 890 KB • Nahráno 5. 1. 2026</div>
                                    </div>
                                    <button class="prilohy-item-btn" title="Zobrazit">
                                        <span class="material-icons-outlined">visibility</span>
                                    </button>
                                </div>
                                <div class="prilohy-item">
                                    <div class="prilohy-item-icon">
                                        <span class="material-icons-outlined">image</span>
                                    </div>
                                    <div class="prilohy-item-info">
                                        <div class="prilohy-item-name">Fotodokumentace_pozemku.jpg</div>
                                        <div class="prilohy-item-meta">JPEG • 2.1 MB • Nahráno 5. 1. 2026</div>
                                    </div>
                                    <button class="prilohy-item-btn" title="Zobrazit">
                                        <span class="material-icons-outlined">visibility</span>
                                    </button>
                                </div>
                            </div>
                            <div class="prilohy-note">
                                <span class="material-icons-outlined">info</span>
                                Kliknutím na ikonu oka zobrazíte náhled přílohy. Kontrolu příloh proveďte v pravém panelu.
                            </div>
                        </div>
                    </div>
                    
                    <!-- TAB: Dokladová část -->
                    <div class="zadost-data-tab" id="zadostDataDoklady">
                        <div class="doklady-viewer">
                            <!-- Dotčené orgány -->
                            <div class="doklady-section">
                                <div class="doklady-section-header">
                                    <span class="material-icons-outlined">account_balance</span>
                                    Dotčené orgány (DO) — závazná stanoviska
                                    <span class="doklady-count">3</span>
                                </div>
                                <div class="doklady-list">
                                    <div class="doklady-item status-ok">
                                        <div class="doklady-item-icon">
                                            <span class="material-icons-outlined">check_circle</span>
                                        </div>
                                        <div class="doklady-item-info">
                                            <div class="doklady-item-name">HZS hl. m. Prahy</div>
                                            <div class="doklady-item-meta">Požární ochrana • Kladné stanovisko</div>
                                        </div>
                                        <button class="doklady-item-btn" title="Zobrazit">
                                            <span class="material-icons-outlined">visibility</span>
                                        </button>
                                    </div>
                                    <div class="doklady-item status-ok">
                                        <div class="doklady-item-icon">
                                            <span class="material-icons-outlined">check_circle</span>
                                        </div>
                                        <div class="doklady-item-info">
                                            <div class="doklady-item-name">KHS Středočeského kraje</div>
                                            <div class="doklady-item-meta">Hygiena • Kladné s podmínkami</div>
                                        </div>
                                        <button class="doklady-item-btn" title="Zobrazit">
                                            <span class="material-icons-outlined">visibility</span>
                                        </button>
                                    </div>
                                    <div class="doklady-item status-pending">
                                        <div class="doklady-item-icon">
                                            <span class="material-icons-outlined">schedule</span>
                                        </div>
                                        <div class="doklady-item-info">
                                            <div class="doklady-item-name">OŽP Praha 4</div>
                                            <div class="doklady-item-meta">Životní prostředí • Čeká na vyjádření</div>
                                        </div>
                                        <button class="doklady-item-btn" title="Zobrazit" disabled>
                                            <span class="material-icons-outlined">visibility_off</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Vlastníci technické infrastruktury -->
                            <div class="doklady-section">
                                <div class="doklady-section-header">
                                    <span class="material-icons-outlined">electric_bolt</span>
                                    Vlastníci technické infrastruktury (VTI)
                                    <span class="doklady-count">4</span>
                                </div>
                                <div class="doklady-list">
                                    <div class="doklady-item status-ok">
                                        <div class="doklady-item-icon">
                                            <span class="material-icons-outlined">check_circle</span>
                                        </div>
                                        <div class="doklady-item-info">
                                            <div class="doklady-item-name">PREdistribuce, a.s.</div>
                                            <div class="doklady-item-meta">Elektřina • Bez připomínek</div>
                                        </div>
                                        <button class="doklady-item-btn" title="Zobrazit">
                                            <span class="material-icons-outlined">visibility</span>
                                        </button>
                                    </div>
                                    <div class="doklady-item status-ok">
                                        <div class="doklady-item-icon">
                                            <span class="material-icons-outlined">check_circle</span>
                                        </div>
                                        <div class="doklady-item-info">
                                            <div class="doklady-item-name">Pražské vodovody a kanalizace</div>
                                            <div class="doklady-item-meta">Vodovod a kanalizace • S podmínkami</div>
                                        </div>
                                        <button class="doklady-item-btn" title="Zobrazit">
                                            <span class="material-icons-outlined">visibility</span>
                                        </button>
                                    </div>
                                    <div class="doklady-item status-ok">
                                        <div class="doklady-item-icon">
                                            <span class="material-icons-outlined">check_circle</span>
                                        </div>
                                        <div class="doklady-item-info">
                                            <div class="doklady-item-name">Pražská plynárenská</div>
                                            <div class="doklady-item-meta">Plyn • Bez připomínek</div>
                                        </div>
                                        <button class="doklady-item-btn" title="Zobrazit">
                                            <span class="material-icons-outlined">visibility</span>
                                        </button>
                                    </div>
                                    <div class="doklady-item status-ok">
                                        <div class="doklady-item-icon">
                                            <span class="material-icons-outlined">check_circle</span>
                                        </div>
                                        <div class="doklady-item-info">
                                            <div class="doklady-item-name">CETIN a.s.</div>
                                            <div class="doklady-item-meta">Telekomunikace • Bez připomínek</div>
                                        </div>
                                        <button class="doklady-item-btn" title="Zobrazit">
                                            <span class="material-icons-outlined">visibility</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="doklady-note">
                                <span class="material-icons-outlined">info</span>
                                Toto je náhled dokladové části. Úplnou správu stanovisek proveďte v kontrole „Dokladová část".
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- PRAVÉ OKNO: Panel kontroly -->
            <div class="zadost-deficiency-panel">
                <!-- REŽIM: Elektronická žádost (výchozí) -->
                <div class="zadost-panel-mode active" id="panelModeZadost">
                    <div class="deficiency-panel-header">
                        <div class="deficiency-panel-title">
                            <span class="material-icons-outlined">checklist</span>
                            Přehled kontroly
                        </div>
                        <div class="deficiency-panel-summary" id="deficiencySummary">
                            <span class="deficiency-stat ok">
                                <span class="material-icons-outlined">check_circle</span>
                                <span id="statOkCount">0</span> v pořádku
                            </span>
                            <span class="deficiency-stat vada">
                                <span class="material-icons-outlined">error</span>
                                <span id="statVadaCount">0</span> vad
                            </span>
                            <span class="deficiency-stat pending">
                                <span class="material-icons-outlined">radio_button_unchecked</span>
                                <span id="statPendingCount">8</span> zbývá
                            </span>
                        </div>
                    </div>
                    
                    <div class="deficiency-panel-content" id="deficiencyPanelContent">
                        <!-- Výchozí stav - žádné nedostatky -->
                        <div class="deficiency-empty" id="deficiencyEmpty">
                            <span class="material-icons-outlined">task_alt</span>
                            <div class="deficiency-empty-title">Zatím bez nedostatků</div>
                            <div class="deficiency-empty-text">Projděte jednotlivé sekce žádosti a označte je jako „V pořádku" nebo „Vada".</div>
                        </div>
                        
                        <!-- Seznam nedostatků (dynamicky generovaný) -->
                        <div class="deficiency-list" id="deficiencyList" style="display: none;">
                            <!-- Položky budou přidány JavaScriptem -->
                        </div>
                    </div>
                    
                    <div class="deficiency-panel-footer">
                        <div class="deficiency-result pending" id="deficiencyResult">
                            <span class="material-icons-outlined">hourglass_empty</span>
                            <div>
                                <strong>Kontrola probíhá</strong>
                                <div style="font-size: 11px; margin-top: 2px;">Zkontrolujte všech 8 sekcí žádosti</div>
                            </div>
                        </div>
                        <div class="deficiency-panel-actions">
                            <button class="btn btn-secondary" onclick="closeControl('controlZadost')">Zrušit</button>
                            <button class="btn btn-primary" id="btnConfirmZadost" onclick="completeZadostKontrola()" disabled>
                                <span class="material-icons-outlined">check</span>
                                Potvrdit kontrolu
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- REŽIM: Listinný formulář -->
                <div class="zadost-panel-mode" id="panelModeFormular">
                    <div class="deficiency-panel-header">
                        <div class="deficiency-panel-header-top">
                            <div class="deficiency-panel-title">
                                <span class="material-icons-outlined">fact_check</span>
                                Kontrola formuláře
                            </div>
                            <button class="btn-vse-ok-small" onclick="setAllFormularStepsOk()" title="Označit vše jako v pořádku">
                                <span class="material-icons-outlined">done_all</span>
                                Vše v pořádku
                            </button>
                        </div>
                        <div class="deficiency-panel-summary" id="formularSummary">
                            <span class="deficiency-stat ok">
                                <span class="material-icons-outlined">check_circle</span>
                                <span id="formularOkCount">0</span> v pořádku
                            </span>
                            <span class="deficiency-stat vada">
                                <span class="material-icons-outlined">error</span>
                                <span id="formularVadaCount">0</span> vad
                            </span>
                        </div>
                    </div>
                    
                    <div class="formular-checklist-content">
                        <div class="formular-checklist-intro">
                            <span class="material-icons-outlined">info</span>
                            Prohlédněte si naskenovaný formulář vlevo a postupně zkontrolujte jednotlivé části.
                        </div>
                        
                        <!-- Checklist kroků -->
                        <div class="formular-checklist" id="formularChecklist">
                            <!-- Krok 1: Údaje o podání -->
                            <div class="formular-check-item" id="formularCheckPodani" data-step="podani">
                                <div class="formular-check-header">
                                    <div class="formular-check-icon">
                                        <span class="material-icons-outlined">assignment_ind</span>
                                    </div>
                                    <div class="formular-check-title">Údaje o podání</div>
                                    <div class="formular-check-status" id="formularStatusPodani">
                                        <span class="material-icons-outlined">radio_button_unchecked</span>
                                    </div>
                                </div>
                                <div class="formular-check-actions">
                                    <button class="formular-btn-ok" onclick="setFormularStepStatus('podani', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="formular-btn-vada" onclick="setFormularStepStatus('podani', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                                <div class="formular-check-change" id="formularChangePodani" style="display: none;">
                                    <button class="formular-btn-change" onclick="resetFormularStepStatus('podani')">
                                        <span class="material-icons-outlined">edit</span>
                                        Změnit
                                    </button>
                                </div>
                                <div class="formular-check-vada-input" id="formularVadaInputPodani" style="display: none;">
                                    <textarea placeholder="Popište zjištěnou vadu..." id="formularVadaTextPodani"></textarea>
                                </div>
                            </div>
                            
                            <!-- Krok 2: Žadatel -->
                            <div class="formular-check-item" id="formularCheckZadatel" data-step="zadatel">
                                <div class="formular-check-header">
                                    <div class="formular-check-icon">
                                        <span class="material-icons-outlined">person</span>
                                    </div>
                                    <div class="formular-check-title">Žadatel</div>
                                    <div class="formular-check-status" id="formularStatusZadatel">
                                        <span class="material-icons-outlined">radio_button_unchecked</span>
                                    </div>
                                </div>
                                <div class="formular-check-actions">
                                    <button class="formular-btn-ok" onclick="setFormularStepStatus('zadatel', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="formular-btn-vada" onclick="setFormularStepStatus('zadatel', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                                <div class="formular-check-change" id="formularChangeZadatel" style="display: none;">
                                    <button class="formular-btn-change" onclick="resetFormularStepStatus('zadatel')">
                                        <span class="material-icons-outlined">edit</span>
                                        Změnit
                                    </button>
                                </div>
                                <div class="formular-check-vada-input" id="formularVadaInputZadatel" style="display: none;">
                                    <textarea placeholder="Popište zjištěnou vadu..." id="formularVadaTextZadatel"></textarea>
                                </div>
                            </div>
                            
                            <!-- Krok 3: Zástupce -->
                            <div class="formular-check-item" id="formularCheckZastupce" data-step="zastupce">
                                <div class="formular-check-header">
                                    <div class="formular-check-icon">
                                        <span class="material-icons-outlined">supervisor_account</span>
                                    </div>
                                    <div class="formular-check-title">Zástupce</div>
                                    <div class="formular-check-status" id="formularStatusZastupce">
                                        <span class="material-icons-outlined">radio_button_unchecked</span>
                                    </div>
                                </div>
                                <div class="formular-check-actions">
                                    <button class="formular-btn-ok" onclick="setFormularStepStatus('zastupce', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="formular-btn-vada" onclick="setFormularStepStatus('zastupce', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                    <button class="formular-btn-skip" onclick="setFormularStepStatus('zastupce', 'skip')">
                                        <span class="material-icons-outlined">remove</span>
                                        Neuveden
                                    </button>
                                </div>
                                <div class="formular-check-change" id="formularChangeZastupce" style="display: none;">
                                    <button class="formular-btn-change" onclick="resetFormularStepStatus('zastupce')">
                                        <span class="material-icons-outlined">edit</span>
                                        Změnit
                                    </button>
                                </div>
                                <div class="formular-check-vada-input" id="formularVadaInputZastupce" style="display: none;">
                                    <textarea placeholder="Popište zjištěnou vadu..." id="formularVadaTextZastupce"></textarea>
                                </div>
                            </div>
                            
                            <!-- Krok 4: Identifikace záměru -->
                            <div class="formular-check-item" id="formularCheckZamer" data-step="zamer">
                                <div class="formular-check-header">
                                    <div class="formular-check-icon">
                                        <span class="material-icons-outlined">domain</span>
                                    </div>
                                    <div class="formular-check-title">Identifikace záměru</div>
                                    <div class="formular-check-status" id="formularStatusZamer">
                                        <span class="material-icons-outlined">radio_button_unchecked</span>
                                    </div>
                                </div>
                                <div class="formular-check-actions">
                                    <button class="formular-btn-ok" onclick="setFormularStepStatus('zamer', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="formular-btn-vada" onclick="setFormularStepStatus('zamer', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                                <div class="formular-check-change" id="formularChangeZamer" style="display: none;">
                                    <button class="formular-btn-change" onclick="resetFormularStepStatus('zamer')">
                                        <span class="material-icons-outlined">edit</span>
                                        Změnit
                                    </button>
                                </div>
                                <div class="formular-check-vada-input" id="formularVadaInputZamer" style="display: none;">
                                    <textarea placeholder="Popište zjištěnou vadu..." id="formularVadaTextZamer"></textarea>
                                </div>
                            </div>
                            
                            <!-- Krok 5: Pozemky -->
                            <div class="formular-check-item" id="formularCheckPozemky" data-step="pozemky">
                                <div class="formular-check-header">
                                    <div class="formular-check-icon">
                                        <span class="material-icons-outlined">grid_on</span>
                                    </div>
                                    <div class="formular-check-title">Pozemky záměru</div>
                                    <div class="formular-check-status" id="formularStatusPozemky">
                                        <span class="material-icons-outlined">radio_button_unchecked</span>
                                    </div>
                                </div>
                                <div class="formular-check-actions">
                                    <button class="formular-btn-ok" onclick="setFormularStepStatus('pozemky', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="formular-btn-vada" onclick="setFormularStepStatus('pozemky', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                                <div class="formular-check-change" id="formularChangePozemky" style="display: none;">
                                    <button class="formular-btn-change" onclick="resetFormularStepStatus('pozemky')">
                                        <span class="material-icons-outlined">edit</span>
                                        Změnit
                                    </button>
                                </div>
                                <div class="formular-check-vada-input" id="formularVadaInputPozemky" style="display: none;">
                                    <textarea placeholder="Popište zjištěnou vadu..." id="formularVadaTextPozemky"></textarea>
                                </div>
                            </div>
                            
                            <!-- Krok 6: Přílohy -->
                            <div class="formular-check-item" id="formularCheckPrilohy" data-step="prilohy">
                                <div class="formular-check-header">
                                    <div class="formular-check-icon">
                                        <span class="material-icons-outlined">attach_file</span>
                                    </div>
                                    <div class="formular-check-title">Přílohy žádosti</div>
                                    <div class="formular-check-status" id="formularStatusPrilohy">
                                        <span class="material-icons-outlined">radio_button_unchecked</span>
                                    </div>
                                </div>
                                <div class="formular-check-actions">
                                    <button class="formular-btn-ok" onclick="setFormularStepStatus('prilohy', 'ok')">
                                        <span class="material-icons-outlined">check</span>
                                        V pořádku
                                    </button>
                                    <button class="formular-btn-vada" onclick="setFormularStepStatus('prilohy', 'vada')">
                                        <span class="material-icons-outlined">error_outline</span>
                                        Vada
                                    </button>
                                </div>
                                <div class="formular-check-change" id="formularChangePrilohy" style="display: none;">
                                    <button class="formular-btn-change" onclick="resetFormularStepStatus('prilohy')">
                                        <span class="material-icons-outlined">edit</span>
                                        Změnit
                                    </button>
                                </div>
                                <div class="formular-check-vada-input" id="formularVadaInputPrilohy" style="display: none;">
                                    <textarea placeholder="Popište zjištěnou vadu..." id="formularVadaTextPrilohy"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="deficiency-panel-footer">
                        <div class="deficiency-result pending" id="formularResult">
                            <span class="material-icons-outlined">hourglass_empty</span>
                            <div>
                                <strong>Kontrola probíhá</strong>
                                <div style="font-size: 11px; margin-top: 2px;">Zkontrolujte všechny části formuláře</div>
                            </div>
                        </div>
                        <div class="deficiency-panel-actions">
                            <button class="btn btn-secondary" onclick="closeControl('controlZadost')">Zrušit</button>
                            <button class="btn btn-primary" id="btnConfirmFormular" onclick="completeFormularKontrola()" disabled>
                                <span class="material-icons-outlined">check</span>
                                Potvrdit kontrolu
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Pozemky -->
    <div class="control-overlay" id="controlPozemky">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlPozemky')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">terrain</span>
                    Pozemky
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchPozemkyTab(this, 'zadost')">
                            <span class="material-icons-outlined">description</span>
                            Žádost
                        </button>
                        <button class="viewer-tab" onclick="switchPozemkyTab(this, 'situace')">
                            <span class="material-icons-outlined">architecture</span>
                            Situační výkresy
                        </button>
                        <button class="viewer-tab" onclick="switchPozemkyTab(this, 'kn')">
                            <span class="material-icons-outlined">terrain</span>
                            Katastr
                        </button>
                        <button class="viewer-tab" onclick="switchPozemkyTab(this, 'mapa')">
                            <span class="material-icons-outlined">map</span>
                            Mapa
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('pozemky')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-pozemky">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">Pozemky uvedené stavebníkem v žádosti</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Pozemky záměru - ze žádosti, editovatelné -->
                    <div class="pozemky-section">
                        <div class="pozemky-section-header">
                            <div class="pozemky-section-title">
                                <span class="material-icons-outlined">location_on</span>
                                Pozemky záměru
                            </div>
                            <span class="pozemky-section-badge" id="pozemkyZameruCount">5 parcel</span>
                            <div class="pozemky-view-toggle" id="pozemkyZameruToggle">
                                <button class="pozemky-view-btn active" onclick="setPozemkyView('zameru', 'chips')" title="Kompaktní zobrazení">
                                    <span class="material-icons-outlined">view_module</span>
                                </button>
                                <button class="pozemky-view-btn" onclick="setPozemkyView('zameru', 'list')" title="Řádkové zobrazení">
                                    <span class="material-icons-outlined">view_list</span>
                                </button>
                                <button class="pozemky-view-btn" onclick="setPozemkyView('zameru', 'grouped')" title="Seskupené podle k.ú.">
                                    <span class="material-icons-outlined">folder_open</span>
                                </button>
                            </div>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Pozemky načtené ze žádosti. V případě chyby můžete seznam upravit.
                        </p>
                        <div id="pozemkyZameruList">
                            <!-- Dynamicky renderováno JavaScriptem -->
                        </div>
                        
                        <!-- Přidání pozemku - volba metody -->
                        <p style="font-size: 12px; color: #5f6368; margin: 16px 0 8px 0; font-weight: 500;">
                            Přidat pozemek:
                        </p>
                        <div class="neighbor-method-selector" style="margin-bottom: 12px;">
                            <button class="neighbor-method-btn active" onclick="selectPozemekMethod('rucne')" data-method="rucne">
                                <span class="material-icons-outlined">edit</span>
                                <span>Ručně</span>
                            </button>
                            <button class="neighbor-method-btn" onclick="selectPozemekMethod('mapa')" data-method="mapa">
                                <span class="material-icons-outlined">map</span>
                                <span>Z mapy</span>
                            </button>
                        </div>
                        
                        <!-- Ruční zadání -->
                        <div class="pozemky-add-section" id="pozemekMethodRucne">
                            <div class="pozemky-add-row" style="flex-wrap: wrap; gap: 8px;">
                                <select class="pozemky-add-input" id="pozemekObec" style="flex: 1; min-width: 150px;" onchange="loadKatastralniUzemi()">
                                    <option value="">Vyberte obec...</option>
                                    <option value="veseli" selected>Veselí nad Lužnicí</option>
                                    <option value="tabor">Tábor</option>
                                    <option value="soběslav">Soběslav</option>
                                    <option value="jiné">Jiná obec...</option>
                                </select>
                                <select class="pozemky-add-input" id="pozemekKU" style="flex: 1; min-width: 150px;">
                                    <option value="">Vyberte k.ú....</option>
                                    <option value="veseli-779091" selected>Veselí nad Lužnicí</option>
                                    <option value="horusice-779091">Horusice</option>
                                </select>
                                <input type="text" class="pozemky-add-input" id="pozemekZameruInput" placeholder="Číslo parcely..." style="flex: 1; min-width: 120px;">
                                <button class="btn-add-pozemek" onclick="addPozemekZameru()">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat
                                </button>
                            </div>
                        </div>
                        
                        <!-- Z mapy -->
                        <div class="pozemky-add-section" id="pozemekMethodMapa" style="display: none;">
                            <div style="background: #f8f9fa; border: 1px dashed #dadce0; border-radius: 8px; padding: 16px; text-align: center;">
                                <span class="material-icons-outlined" style="font-size: 32px; color: #5f6368; display: block; margin-bottom: 8px;">map</span>
                                <p style="font-size: 12px; color: #5f6368; margin: 0;">
                                    Kliknutím na parcelu v mapě vlevo ji přidáte do seznamu pozemků záměru.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Sousední pozemky -->
                    <div class="pozemky-section">
                        <div class="pozemky-section-header">
                            <div class="pozemky-section-title">
                                <span class="material-icons-outlined">grid_view</span>
                                Sousední pozemky
                            </div>
                            <span class="pozemky-section-badge" id="sousedniCount">12 parcel</span>
                            <div class="pozemky-view-toggle" id="sousedniToggle">
                                <button class="pozemky-view-btn active" onclick="setPozemkyView('sousedni', 'chips')" title="Kompaktní zobrazení">
                                    <span class="material-icons-outlined">view_module</span>
                                </button>
                                <button class="pozemky-view-btn" onclick="setPozemkyView('sousedni', 'list')" title="Řádkové zobrazení">
                                    <span class="material-icons-outlined">view_list</span>
                                </button>
                                <button class="pozemky-view-btn" onclick="setPozemkyView('sousedni', 'grouped')" title="Seskupené podle k.ú.">
                                    <span class="material-icons-outlined">folder_open</span>
                                </button>
                            </div>
                        </div>

                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Vyberte metodu identifikace sousedních pozemků:
                        </p>

                        <!-- Metoda výběru -->
                        <div class="neighbor-method-selector" id="sousedniMethodSelector">
                            <button class="neighbor-method-btn active" onclick="selectNeighborMethod('auto')" data-method="auto">
                                <span class="material-icons-outlined">auto_awesome</span>
                                <span>Automaticky</span>
                            </button>
                            <button class="neighbor-method-btn" onclick="selectNeighborMethod('rucne')" data-method="rucne">
                                <span class="material-icons-outlined">edit</span>
                                <span>Ručně</span>
                            </button>
                            <button class="neighbor-method-btn" onclick="selectNeighborMethod('mapa')" data-method="mapa">
                                <span class="material-icons-outlined">map</span>
                                <span>Z mapy</span>
                            </button>
                        </div>

                        <!-- Automatická metoda -->
                        <div class="neighbor-method-content" id="methodAuto">
                            <button class="btn-autodetect" onclick="autoDetectSousedni()" id="btnAutoDetect">
                                <span class="material-icons-outlined">auto_awesome</span>
                                Automaticky identifikovat sousedy
                            </button>
                        </div>

                        <!-- Ruční metoda -->
                        <div class="neighbor-method-content" id="methodRucne" style="display: none;">
                            <div class="pozemky-add-row" style="flex-wrap: wrap; gap: 8px;">
                                <select class="pozemky-add-input" id="sousedObec" style="flex: 1; min-width: 150px;" onchange="loadSousedKatastralniUzemi()">
                                    <option value="">Vyberte obec...</option>
                                    <option value="veseli" selected>Veselí nad Lužnicí</option>
                                    <option value="tabor">Tábor</option>
                                    <option value="soběslav">Soběslav</option>
                                    <option value="jiné">Jiná obec...</option>
                                </select>
                                <select class="pozemky-add-input" id="sousedKU" style="flex: 1; min-width: 150px;">
                                    <option value="">Vyberte k.ú....</option>
                                    <option value="veseli-779091" selected>Veselí nad Lužnicí</option>
                                    <option value="horusice-779091">Horusice</option>
                                </select>
                                <input type="text" class="pozemky-add-input" id="sousedniSearchInput" placeholder="Číslo parcely..." style="flex: 1; min-width: 120px;">
                                <button class="btn-add-pozemek" onclick="addSousedniRucne()">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat
                                </button>
                            </div>
                        </div>

                        <!-- Z mapy -->
                        <div class="neighbor-method-content" id="methodMapa" style="display: none;">
                            <div style="background: #f8f9fa; border: 1px dashed #dadce0; border-radius: 8px; padding: 16px; text-align: center;">
                                <span class="material-icons-outlined" style="font-size: 32px; color: #5f6368; display: block; margin-bottom: 8px;">map</span>
                                <p style="font-size: 12px; color: #5f6368; margin: 0;">
                                    Kliknutím na parcely v mapě vlevo je přidáte do seznamu sousedních pozemků.
                                </p>
                            </div>
                        </div>

                        <!-- Seznam sousedních parcel -->
                        <div class="sousedni-list" id="sousedniList">
                            <div class="sousedni-empty" id="sousedniEmpty">
                                <span class="material-icons-outlined">grid_view</span>
                                <div class="sousedni-empty-text">Zatím nejsou identifikovány žádné sousední pozemky</div>
                                <div class="sousedni-empty-hint">Použijte některou z metod výše</div>
                            </div>
                        </div>
                    </div>

                    <div class="result-preview positive" id="resultPozemky">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Pozemky identifikovány
                        </div>
                        <div class="result-preview-text">Pozemky záměru a sousední pozemky byly identifikovány. Vlastníci budou určeni v části Osoby.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSavePozemky">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlPozemky')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('pozemky')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmPozemky" onclick="completePozemky()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="control-overlay" id="controlDokumentace">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlDokumentace')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">architecture</span>
                    Kontrola dokumentace
                </div>
            </div>
        </div>
        <div class="control-body">
            <!-- Levý panel - prohlížeč struktury dokumentace -->
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab ed-back-btn" id="edBackBtn" onclick="backToEdStructure()" style="display: none;">
                            <span class="material-icons-outlined">arrow_back</span>
                            Zpět do ED
                        </button>
                        <div class="ed-breadcrumb" id="edBreadcrumb">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #5f6368;">folder_special</span>
                            <span style="font-weight: 500; color: #202124;">Struktura dokumentace</span>
                        </div>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('dokumentace')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content" style="background: #fff;">
                    <!-- Struktura ED -->
                    <div class="ed-tree-container" id="edTreeContainer" style="padding: 16px;">
                        <div class="ed-tree" id="edTree">
                            <div class="ed-tree-header">
                                <div class="ed-tree-header-top">
                                    <span class="material-icons-outlined">folder_special</span>
                                    <strong>SR00X01I35GT</strong>
                                    <span style="color: #5f6368; font-size: 12px; margin-left: 8px;">Novostavba RD včetně přípojek</span>
                                </div>
                                <div class="ed-version-selector">
                                    <label style="font-size: 11px; color: #5f6368; margin-right: 6px;">Verze:</label>
                                    <select class="ed-version-select" id="edVersionSelect" onchange="changeEdVersion()">
                                        <option value="v3" selected>v3 (aktuální) — 10. 1. 2026</option>
                                        <option value="v2">v2 — 18. 12. 2025</option>
                                        <option value="v1">v1 — 2. 12. 2025</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- A. Průvodní zpráva -->
                            <div class="ed-folder" data-section="A">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">A. Průvodní zpráva</span>
                                    <span class="folder-count">1 soubor</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('A.1 Průvodní zpráva.pdf', 'A')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">A.1 Průvodní zpráva.pdf</span>
                                        <span class="file-size">245 kB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- B. Souhrnná technická zpráva -->
                            <div class="ed-folder" data-section="B">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">B. Souhrnná technická zpráva</span>
                                    <span class="folder-count">1 soubor</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('B.1 Souhrnná technická zpráva.pdf', 'B')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">B.1 Souhrnná technická zpráva.pdf</span>
                                        <span class="file-size">1.2 MB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- C. Situační výkresy -->
                            <div class="ed-folder" data-section="C">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">C. Situační výkresy</span>
                                    <span class="folder-count">4 soubory</span>
                                </div>
                                <div class="ed-folder-content">
                                    <div class="ed-file" onclick="previewEdFile('C.1 Situační výkres širších vztahů.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.1 Situační výkres širších vztahů.pdf</span>
                                        <span class="file-size">890 kB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.2 Katastrální situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.2 Katastrální situační výkres.pdf</span>
                                        <span class="file-size">1.1 MB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.3 Koordinační situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.3 Koordinační situační výkres.pdf</span>
                                        <span class="file-size">1.4 MB</span>
                                    </div>
                                    <div class="ed-file" onclick="previewEdFile('C.4 Speciální situační výkres.pdf', 'C')">
                                        <span class="material-icons-outlined">description</span>
                                        <span class="file-name">C.4 Speciální situační výkres.pdf</span>
                                        <span class="file-size">780 kB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- D. Dokumentace objektů -->
                            <div class="ed-folder" data-section="D">
                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                    <span class="material-icons-outlined folder-icon">folder</span>
                                    <span class="folder-name">D. Dokumentace objektů</span>
                                    <span class="folder-count">4 podsložky</span>
                                </div>
                                <div class="ed-folder-content">
                                    <!-- D.1 Dokumentace stavebního objektu -->
                                    <div class="ed-folder nested">
                                        <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                            <span class="material-icons-outlined folder-icon">folder</span>
                                            <span class="folder-name">D.1 Dokumentace stavebního objektu</span>
                                            <span class="folder-count">4 podsložky</span>
                                        </div>
                                        <div class="ed-folder-content">
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.1 Architektonicko-stavební řešení</span>
                                                    <span class="folder-count">12 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.1.01 Technická zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.1.01 Technická zpráva.pdf</span>
                                                        <span class="file-size">520 kB</span>
                                                    </div>
                                                    <div class="ed-file" onclick="previewEdFile('D.1.1.02 Půdorys 1.NP.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.1.02 Půdorys 1.NP.pdf</span>
                                                        <span class="file-size">1.8 MB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 10 souborů</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.2 Stavebně konstrukční řešení</span>
                                                    <span class="folder-count">8 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.2.01 Technická zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.2.01 Technická zpráva.pdf</span>
                                                        <span class="file-size">340 kB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 7 souborů</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.3 Požárně bezpečnostní řešení</span>
                                                    <span class="folder-count">3 soubory</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.3.01 Požární zpráva.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.3.01 Požární zpráva.pdf</span>
                                                        <span class="file-size">890 kB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ další 2 soubory</div>
                                                </div>
                                            </div>
                                            <div class="ed-folder nested">
                                                <div class="ed-folder-header" onclick="toggleEdFolder(this)">
                                                    <span class="material-icons-outlined folder-icon">folder</span>
                                                    <span class="folder-name">D.1.4 Technika prostředí staveb</span>
                                                    <span class="folder-count">6 souborů</span>
                                                </div>
                                                <div class="ed-folder-content">
                                                    <div class="ed-file" onclick="previewEdFile('D.1.4.01 Zdravotně technické instalace.pdf', 'D')">
                                                        <span class="material-icons-outlined">description</span>
                                                        <span class="file-name">D.1.4.01 Zdravotně technické instalace.pdf</span>
                                                        <span class="file-size">1.2 MB</span>
                                                    </div>
                                                    <div class="ed-file-more">+ dalších 5 souborů</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- D.2 Dokumentace technických a technologických zařízení -->
                                    <div class="ed-folder nested empty">
                                        <div class="ed-folder-header">
                                            <span class="material-icons-outlined folder-icon" style="color: #9aa0a6;">folder_off</span>
                                            <span class="folder-name" style="color: #9aa0a6;">D.2 Dokumentace tech. a technol. zařízení</span>
                                            <span class="folder-count" style="color: #9aa0a6;">prázdné</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Náhled dokumentu -->
                    <div class="ed-preview-container" id="edPreviewContainer" style="display: none; padding: 16px; height: 100%;">
                        <div id="edPreviewContent" style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 8px; padding: 40px;">
                            <span class="material-icons-outlined" style="font-size: 64px; color: #9aa0a6; margin-bottom: 16px;">description</span>
                            <div style="font-size: 14px; color: #5f6368;">Vyberte dokument ze struktury</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pravý panel - kontrolní formulář -->
            <div class="control-form">
                <div class="control-form-body">
                    <!-- Kategorie stavby -->
                    <div class="control-section stavba-kategorie-section">
                        <div class="control-section-title">
                            <span class="material-icons-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 4px;">category</span>
                            Kategorie stavby
                        </div>
                        
                        <!-- Soubor staveb -->
                        <div class="stavba-field">
                            <div class="stavba-field-label">Jde o soubor staveb?</div>
                            <div class="stavba-toggle-group">
                                <label class="stavba-toggle">
                                    <input type="radio" name="souborStaveb" value="ne" checked onchange="toggleSouborStaveb()">
                                    <span class="stavba-toggle-label">Ne</span>
                                </label>
                                <label class="stavba-toggle">
                                    <input type="radio" name="souborStaveb" value="ano" onchange="toggleSouborStaveb()">
                                    <span class="stavba-toggle-label">Ano</span>
                                </label>
                            </div>
                            <div class="stavba-field-hint">
                                <span class="material-icons-outlined">info</span>
                                Údaj přenesen ze žádosti — můžete upravit
                            </div>
                        </div>
                        
                        <!-- Kategorie stavby - jednoduchá -->
                        <div class="stavba-field" id="kategorieJednoduchaField">
                            <div class="stavba-field-label">Kategorie stavby</div>
                            <div class="stavba-kategorie-options">
                                <label class="stavba-kategorie-option">
                                    <input type="radio" name="kategorieStavby" value="vyhrazena">
                                    <span class="stavba-kategorie-box">
                                        <span class="kategorie-name">Vyhrazená</span>
                                        <span class="kategorie-desc">§ 5 vyhl. č. 600/2006</span>
                                    </span>
                                </label>
                                <label class="stavba-kategorie-option">
                                    <input type="radio" name="kategorieStavby" value="ostatni" checked>
                                    <span class="stavba-kategorie-box">
                                        <span class="kategorie-name">Ostatní</span>
                                        <span class="kategorie-desc">Běžné stavby</span>
                                    </span>
                                </label>
                                <label class="stavba-kategorie-option">
                                    <input type="radio" name="kategorieStavby" value="jednoducha">
                                    <span class="stavba-kategorie-box">
                                        <span class="kategorie-name">Jednoduchá</span>
                                        <span class="kategorie-desc">§ 171 SZ</span>
                                    </span>
                                </label>
                                <label class="stavba-kategorie-option">
                                    <input type="radio" name="kategorieStavby" value="drobna">
                                    <span class="stavba-kategorie-box">
                                        <span class="kategorie-name">Drobná</span>
                                        <span class="kategorie-desc">§ 171 SZ</span>
                                    </span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Kategorie stavby - soubor staveb -->
                        <div class="stavba-field" id="kategorieSouborField" style="display: none;">
                            <div class="stavba-soubor-wrapper">
                                <!-- Hlavní stavba -->
                                <div class="stavba-soubor-item hlavni">
                                    <div class="stavba-soubor-header">
                                        <span class="material-icons-outlined">star</span>
                                        Hlavní stavba
                                        <span class="stavba-soubor-badge">určuje kategorii souboru</span>
                                    </div>
                                    <div class="stavba-soubor-content">
                                        <div class="stavba-soubor-nazev">
                                            <input type="text" class="stavba-input" id="hlavniStavbaNazev" value="Rodinný dům" placeholder="Název hlavní stavby">
                                        </div>
                                        <div class="stavba-kategorie-mini">
                                            <label class="kategorie-mini-option">
                                                <input type="radio" name="kategorieHlavni" value="vyhrazena">
                                                <span>Vyhrazená</span>
                                            </label>
                                            <label class="kategorie-mini-option">
                                                <input type="radio" name="kategorieHlavni" value="ostatni" checked>
                                                <span>Ostatní</span>
                                            </label>
                                            <label class="kategorie-mini-option">
                                                <input type="radio" name="kategorieHlavni" value="jednoducha">
                                                <span>Jednoduchá</span>
                                            </label>
                                            <label class="kategorie-mini-option">
                                                <input type="radio" name="kategorieHlavni" value="drobna">
                                                <span>Drobná</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Vedlejší stavby -->
                                <div class="stavba-soubor-item vedlejsi">
                                    <div class="stavba-soubor-header">
                                        <span class="material-icons-outlined">add_circle_outline</span>
                                        Vedlejší stavby
                                    </div>
                                    <div class="stavba-soubor-content">
                                        <div class="vedlejsi-stavby-list" id="vedlejsiStavbyList">
                                            <div class="vedlejsi-stavba-row">
                                                <input type="text" class="stavba-input" value="Garáž" placeholder="Název stavby">
                                                <select class="stavba-select">
                                                    <option value="ostatni">Ostatní</option>
                                                    <option value="jednoducha" selected>Jednoduchá</option>
                                                    <option value="drobna">Drobná</option>
                                                </select>
                                                <button class="vedlejsi-remove" onclick="removeVedlejsiStavba(this)" title="Odebrat">
                                                    <span class="material-icons-outlined">close</span>
                                                </button>
                                            </div>
                                            <div class="vedlejsi-stavba-row">
                                                <input type="text" class="stavba-input" value="Přípojky inženýrských sítí" placeholder="Název stavby">
                                                <select class="stavba-select">
                                                    <option value="ostatni">Ostatní</option>
                                                    <option value="jednoducha">Jednoduchá</option>
                                                    <option value="drobna" selected>Drobná</option>
                                                </select>
                                                <button class="vedlejsi-remove" onclick="removeVedlejsiStavba(this)" title="Odebrat">
                                                    <span class="material-icons-outlined">close</span>
                                                </button>
                                            </div>
                                        </div>
                                        <button class="btn-add-vedlejsi" onclick="addVedlejsiStavba()">
                                            <span class="material-icons-outlined">add</span>
                                            Přidat vedlejší stavbu
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stavba-soubor-summary" id="souborSummary">
                                <span class="material-icons-outlined">info</span>
                                <span>Kategorie souboru staveb: <strong>Ostatní</strong> (podle hlavní stavby)</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Automatická kontrola -->
                    <div class="auto-check-section">
                        <div class="auto-check-header">
                            <div class="auto-check-title">
                                <span class="material-icons-outlined">auto_awesome</span>
                                Automatická kontrola
                            </div>
                            <button class="btn-run-check" id="btnRunAutoCheck" onclick="runDocAutoCheck()">
                                <span class="material-icons-outlined">play_arrow</span>
                                Spustit kontrolu
                            </button>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 0; font-style: normal;" id="autoCheckDesc">
                            Automaticky zkontroluje elektronické podpisy, časová razítka a formát PDF/A.
                        </p>
                        <div class="auto-check-results" id="autoCheckResults">
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconFormat">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Formát PDF/A</div>
                                    <div class="check-result-detail" id="checkDetailFormat">Všechny dokumenty jsou ve správném formátu</div>
                                </div>
                            </div>
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconSignature">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Elektronické podpisy</div>
                                    <div class="check-result-detail" id="checkDetailSignature">Všechny dokumenty jsou platně podepsány</div>
                                </div>
                            </div>
                            <div class="check-result-item" id="checkItemTimestamp">
                                <div class="check-result-icon warning" id="checkIconTimestamp">
                                    <span class="material-icons-outlined">warning</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Časová razítka</div>
                                    <div class="check-result-detail" id="checkDetailTimestamp">1 dokument nemá časové razítko</div>
                                </div>
                                <span class="check-result-added" id="checkTimestampAdded" style="display: none; font-size: 11px; color: #137333;">
                                    <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle;">check</span>
                                    Přidáno do seznamu
                                </span>
                            </div>
                            <div class="check-result-item">
                                <div class="check-result-icon success" id="checkIconAuth">
                                    <span class="material-icons-outlined">check</span>
                                </div>
                                <div class="check-result-content">
                                    <div class="check-result-label">Autorizační razítko</div>
                                    <div class="check-result-detail" id="checkDetailAuth">Projektant má platnou autorizaci ČKAIT</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Kontrola přítomnosti částí dokumentace -->
                    <div class="doc-check-section">
                        <div class="doc-check-header">
                            <div class="doc-check-title">
                                <span class="material-icons-outlined">checklist</span>
                                Kontrola jednotlivých částí dokumentace
                            </div>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px; font-style: normal;">
                            Ověřte, že dokumentace obsahuje všechny požadované části a zkontrolujte správnost jejich obsahu.
                        </p>
                        
                        <div class="doc-parts-list" id="docPartsList">
                            <!-- A. Průvodní zpráva -->
                            <div class="doc-part-item" data-part="A">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">A</span>
                                    <span class="doc-part-name">Průvodní zpráva</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('A', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('A', 'error')" title="Chyba">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- B. Souhrnná technická zpráva -->
                            <div class="doc-part-item" data-part="B">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">B</span>
                                    <span class="doc-part-name">Souhrnná technická zpráva</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('B', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('B', 'error')" title="Chyba">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- C. Situační výkresy -->
                            <div class="doc-part-item" data-part="C">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">C</span>
                                    <span class="doc-part-name">Situační výkresy</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('C', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('C', 'error')" title="Chyba">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- D. Dokumentace objektů -->
                            <div class="doc-part-item" data-part="D">
                                <div class="doc-part-info">
                                    <span class="doc-part-letter">D</span>
                                    <span class="doc-part-name">Dokumentace objektů</span>
                                </div>
                                <div class="doc-part-status">
                                    <button class="doc-part-btn ok unchecked" onclick="setDocPartStatus('D', 'ok')" title="V pořádku">
                                        <span class="material-icons-outlined">check</span>
                                    </button>
                                    <button class="doc-part-btn error" onclick="setDocPartStatus('D', 'error')" title="Chyba">
                                        <span class="material-icons-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Zjištěné nedostatky dokumentace - strukturované podle částí -->
                    <div class="issues-section" id="issuesSection">
                        <div class="issues-header">
                            <div class="issues-title">
                                <span class="material-icons-outlined">report_problem</span>
                                Zjištěné nedostatky dokumentace
                            </div>
                            <span class="issues-count" id="issuesCount">0</span>
                        </div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 16px;">
                            Seznam nedostatků se stane součástí dokumentu <strong>Výzva k doplnění a usnesení o přerušení řízení</strong>.
                        </p>
                        
                        <!-- Automaticky zjištěné nedostatky -->
                        <div class="part-issues-section" id="autoIssuesSection" style="display: none;">
                            <div class="part-issues-header">
                                <span class="material-icons-outlined" style="color: #1a73e8;">auto_awesome</span>
                                Automaticky zjištěné nedostatky
                            </div>
                            <div class="part-issues-list" id="autoIssuesList">
                                <!-- Automatické nedostatky -->
                            </div>
                        </div>
                        
                        <!-- Sekce pro část A -->
                        <div class="part-issues-section" id="partIssuesA" style="display: none;">
                            <div class="part-issues-header">
                                <span class="part-letter">A</span>
                                Nedostatky v části A. Průvodní zpráva
                            </div>
                            <div class="part-issues-list" id="partIssuesListA">
                                <!-- Nedostatky části A -->
                            </div>
                            <div class="part-issues-add">
                                <textarea class="part-issue-textarea" id="partIssueTextA" placeholder="Popište nedostatek v průvodní zprávě..." rows="3"></textarea>
                                <button class="btn-add-part-issue" onclick="addPartIssue('A')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sekce pro část B -->
                        <div class="part-issues-section" id="partIssuesB" style="display: none;">
                            <div class="part-issues-header">
                                <span class="part-letter">B</span>
                                Nedostatky v části B. Souhrnná technická zpráva
                            </div>
                            <div class="part-issues-list" id="partIssuesListB">
                                <!-- Nedostatky části B -->
                            </div>
                            <div class="part-issues-add">
                                <textarea class="part-issue-textarea" id="partIssueTextB" placeholder="Popište nedostatek v souhrnné technické zprávě..." rows="3"></textarea>
                                <button class="btn-add-part-issue" onclick="addPartIssue('B')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sekce pro část C -->
                        <div class="part-issues-section" id="partIssuesC" style="display: none;">
                            <div class="part-issues-header">
                                <span class="part-letter">C</span>
                                Nedostatky v části C. Situační výkresy
                            </div>
                            <div class="part-issues-list" id="partIssuesListC">
                                <!-- Nedostatky části C -->
                            </div>
                            <div class="part-issues-add">
                                <textarea class="part-issue-textarea" id="partIssueTextC" placeholder="Popište nedostatek v situačních výkresech..." rows="3"></textarea>
                                <button class="btn-add-part-issue" onclick="addPartIssue('C')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sekce pro část D -->
                        <div class="part-issues-section" id="partIssuesD" style="display: none;">
                            <div class="part-issues-header">
                                <span class="part-letter">D</span>
                                Nedostatky v části D. Dokumentace objektů
                            </div>
                            <div class="part-issues-list" id="partIssuesListD">
                                <!-- Nedostatky části D -->
                            </div>
                            <div class="part-issues-add">
                                <textarea class="part-issue-textarea" id="partIssueTextD" placeholder="Popište nedostatek v dokumentaci objektů..." rows="3"></textarea>
                                <button class="btn-add-part-issue" onclick="addPartIssue('D')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat nedostatek
                                </button>
                            </div>
                        </div>
                        
                        <!-- Prázdný stav -->
                        <div class="issues-empty" id="issuesEmpty">
                            <span class="material-icons-outlined" style="font-size: 32px; color: #9aa0a6; margin-bottom: 8px;">check_circle</span>
                            <div style="font-size: 13px; color: #5f6368;">Zatím nebyly zjištěny žádné nedostatky</div>
                        </div>
                    </div>

                    <div class="result-preview neutral" id="resultDokumentace">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">info</span>
                            Kontrola nebyla dokončena
                        </div>
                        <div class="result-preview-text">Zkontrolujte všechny části dokumentace kliknutím na zaškrtávátko.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveDokumentace">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlDokumentace')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('dokumentace')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmDokumentace" onclick="completeDokumentace()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Kontrola: Identifikace DO a správců TDI -->
    <div class="control-overlay" id="controlIdentifikace">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlIdentifikace')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">hub</span>
                    Identifikace DO a správců TDI
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchViewerTab(this, 'identifikace', 'dtm')">
                            <span class="material-icons-outlined">layers</span>
                            DTM
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'identifikace', 'doklady')">
                            <span class="material-icons-outlined">folder</span>
                            Dokladová část
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'identifikace', 'zadost')">
                            <span class="material-icons-outlined">description</span>
                            Žádost
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('identifikace')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-identifikace">
                        <span class="material-icons-outlined">layers</span>
                        <div class="viewer-placeholder-title">Digitální technická mapa</div>
                        <div class="viewer-placeholder-text">Sítě technické infrastruktury v okolí stavby</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <!-- AI Analýza -->
                    <div class="identifikace-ai-section">
                        <div class="identifikace-ai-header">
                            <div class="identifikace-ai-title">
                                <span class="material-icons-outlined">auto_awesome</span>
                                AI Analýza dokladové části
                            </div>
                            <button class="btn-ai-analyze" id="btnAiAnalyzeDoklady" onclick="aiAnalyzeDoklady()">
                                <span class="material-icons-outlined">search</span>
                                Analyzovat přílohy
                            </button>
                        </div>
                        <div class="identifikace-ai-status" id="aiAnalyzeStatus">
                            <span class="material-icons-outlined">info</span>
                            Spusťte analýzu pro automatické rozpoznání přiložených dokumentů
                        </div>
                    </div>

                    <!-- Porovnávací matice -->
                    <div class="control-section">
                        <div class="control-section-title">Přehled stanovisek a vyjádření</div>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                            Zkontrolujte přiložené doklady, vyhodnoťte jejich obsah a zadejte podmínky pro rozhodnutí.
                        </p>
                    </div>

                    <div class="subjekty-matrix" id="subjektyMatrix">
                        <!-- Header -->
                        <div class="matrix-header extended">
                            <div class="matrix-header-cell">Subjekt</div>
                            <div class="matrix-header-cell">Žádost</div>
                            <div class="matrix-header-cell">Přiloženo</div>
                            <div class="matrix-header-cell">Výsledek</div>
                            <div class="matrix-header-cell">Podmínky</div>
                        </div>

                        <!-- DO skupina -->
                        <div class="matrix-group" data-group="do" id="matrixGroupDO">
                            <div class="matrix-group-header">
                                <span class="material-icons-outlined">account_balance</span>
                                Dotčené orgány (DO) — závazná stanoviska
                                <span class="group-count" id="countDO">3</span>
                            </div>
                            
                            <!-- Info box pro integrované DO (od 1.1.2028) -->
                            <div class="platnost-info-box integrated-do-info" id="infoIntegrovaneDO" style="display: none;">
                                <div class="platnost-info-icon">
                                    <span class="material-icons-outlined">verified</span>
                                </div>
                                <div class="platnost-info-content">
                                    <div class="platnost-info-title">Integrované dotčené orgány</div>
                                    <div class="platnost-info-text">Od 1. 1. 2028 jsou dotčené orgány integrovány do jednotné státní stavební správy. Závazná stanoviska jsou vydávána automaticky v rámci interního workflow JSSÚ.</div>
                                    <div class="integrated-do-list">
                                        <span class="integrated-do-badge"><span class="material-icons-outlined">check</span> Požární ochrana (HZS)</span>
                                        <span class="integrated-do-badge"><span class="material-icons-outlined">check</span> Hygiena (KHS)</span>
                                        <span class="integrated-do-badge"><span class="material-icons-outlined">check</span> Životní prostředí</span>
                                        <span class="integrated-do-badge"><span class="material-icons-outlined">check</span> Památková péče</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="matrix-group-content" id="matrixDO">
                                <!-- Dynamicky renderováno -->
                            </div>
                        </div>

                        <!-- VTI skupina -->
                        <div class="matrix-group" data-group="vti">
                            <div class="matrix-group-header">
                                <span class="material-icons-outlined">electric_bolt</span>
                                Vlastníci technické infrastruktury (VTI) — vyjádření
                                <span class="group-count" id="countVTI">4</span>
                            </div>
                            <div class="matrix-group-content" id="matrixVTI">
                                <!-- Dynamicky renderováno -->
                            </div>
                        </div>

                        <!-- VDI skupina -->
                        <div class="matrix-group" data-group="vdi">
                            <div class="matrix-group-header">
                                <span class="material-icons-outlined">directions_car</span>
                                Vlastníci dopravní infrastruktury (VDI) — vyjádření
                                <span class="group-count" id="countVDI">1</span>
                            </div>
                            <div class="matrix-group-content" id="matrixVDI">
                                <!-- Dynamicky renderováno -->
                            </div>
                        </div>

                        <!-- Přidat subjekt -->
                        <div class="matrix-add-row">
                            <select class="matrix-add-select" id="addSubjektTyp">
                                <option value="do">DO - Dotčený orgán</option>
                                <option value="vti">VTI - Vlastník tech. infrastruktury</option>
                                <option value="vdi">VDI - Vlastník dopr. infrastruktury</option>
                            </select>
                            <input type="text" class="matrix-add-input" id="addSubjektNazev" placeholder="Název subjektu...">
                            <button class="btn-add-subjekt" onclick="addSubjekt()">
                                <span class="material-icons-outlined">add</span>
                                Přidat
                            </button>
                        </div>
                    </div>

                    <!-- Souhrn pro rozhodnutí -->
                    <div class="souhrn-rozhodnuti" id="souhrnRozhodnuti">
                        <div class="souhrn-rozhodnuti-header">
                            <div class="souhrn-rozhodnuti-title">
                                <span class="material-icons-outlined">description</span>
                                Data pro rozhodnutí
                            </div>
                            <div class="souhrn-rozhodnuti-actions" id="reportActions" style="display: none;">
                                <button class="btn-report" onclick="showReportModal()" title="Zobrazit náhled reportu">
                                    <span class="material-icons-outlined">visibility</span>
                                    Náhled
                                </button>
                                <button class="btn-report" onclick="downloadReport('json')" title="Stáhnout data jako JSON">
                                    <span class="material-icons-outlined">data_object</span>
                                    JSON
                                </button>
                                <button class="btn-report" onclick="downloadReport('txt')" title="Stáhnout textový report">
                                    <span class="material-icons-outlined">download</span>
                                    TXT
                                </button>
                            </div>
                        </div>
                        <div class="souhrn-stats" id="souhrnStats">
                            <!-- Dynamicky renderováno -->
                        </div>
                    </div>

                    <!-- Výsledek kontroly -->
                    <div class="identifikace-result" id="identifikaceResult">
                        <div class="identifikace-result-title">Výsledek kontroly</div>
                        <div class="identifikace-result-items" id="identifikaceResultItems">
                            <!-- Dynamicky renderováno -->
                        </div>
                    </div>

                    <!-- Result preview -->
                    <div class="result-preview positive" id="resultIdentifikace">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Čeká na dokončení kontroly
                        </div>
                        <div class="result-preview-text">Zkontrolujte seznam subjektů a označte vyžadované.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveIdentifikace">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlIdentifikace')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('identifikace')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" id="btnConfirmIdentifikace" onclick="completeIdentifikace()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Soulad s ÚPD -->
    <div class="control-overlay" id="controlUP">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlUP')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">map</span>
                    Soulad s ÚPD
                </div>
            </div>
            <div class="control-header-center">
                <div class="upd-layout-switch">
                    <button class="upd-layout-btn active" onclick="setUPDLayout('vertical', this)" title="Panely nad sebou">
                        <span class="material-icons-outlined">view_agenda</span>
                    </button>
                    <button class="upd-layout-btn" onclick="setUPDLayout('horizontal', this)" title="Panely vedle sebe">
                        <span class="material-icons-outlined">view_column</span>
                    </button>
                </div>
            </div>
            <div class="control-header-right" style="margin-left: auto; margin-right: 16px;">
                <button class="btn btn-primary" id="btnConfirmUPD" onclick="completeUPD()" disabled>
                    <span class="material-icons-outlined">check</span> Potvrdit kontrolu
                </button>
            </div>
        </div>
        
        <!-- Modální dialog pro nesoulad -->
        <div class="upd-nesoulad-modal" id="nesouladModal">
            <div class="upd-nesoulad-modal-content">
                <div class="upd-nesoulad-modal-header">
                    <div class="upd-nesoulad-modal-title">
                        <span class="material-icons-outlined">warning</span>
                        <span id="nesouladModalTitle">Popis nesouladu</span>
                    </div>
                    <button class="upd-nesoulad-modal-close" onclick="closeNesouladModal()">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
                <div class="upd-nesoulad-modal-body">
                    <label id="nesouladModalLabel">Popište nesoulad s územně plánovací dokumentací:</label>
                    <textarea class="upd-nesoulad-modal-textarea" id="nesouladModalTextarea" 
                        placeholder="Uveďte konkrétní ustanovení, se kterými je záměr v rozporu..."></textarea>
                </div>
                <div class="upd-nesoulad-modal-footer">
                    <button class="btn btn-secondary" onclick="closeNesouladModal()">Zrušit</button>
                    <button class="btn btn-primary" onclick="saveNesouladModal()">
                        <span class="material-icons-outlined">save</span> Uložit
                    </button>
                </div>
            </div>
        </div>
        
        <div class="control-body">
            <!-- Viewery - maximální prostor -->
            <div class="upd-viewers-stack">
                <div class="upd-viewer-panel">
                    <div class="upd-viewer-toolbar">
                        <div class="upd-viewer-tabs">
                            <button class="upd-vtab active" onclick="switchSituaceTab(this, 'c1')">C.1</button>
                            <button class="upd-vtab" onclick="switchSituaceTab(this, 'c2')">C.2</button>
                            <button class="upd-vtab" onclick="switchSituaceTab(this, 'c3')">C.3</button>
                        </div>
                        <div class="upd-zoom-controls">
                            <button class="upd-zoom-btn" onclick="zoomViewer('situace', -0.2)" title="Oddálit">−</button>
                            <button class="upd-zoom-btn" onclick="resetViewer('situace')" title="Reset">⟲</button>
                            <button class="upd-zoom-btn" onclick="zoomViewer('situace', 0.2)" title="Přiblížit">+</button>
                        </div>
                        <button class="upd-viewer-btn" onclick="openImageFullscreen('situace')" title="Nové okno">
                            <span class="material-icons-outlined">open_in_new</span>
                        </button>
                    </div>
                    <div class="upd-viewer-content" id="updSituaceViewer">
                        <div class="upd-image-container" id="situaceContainer">
                            <img src="../images/C-01.png" alt="Situační výkres" id="situaceImage" 
                                 draggable="false" onload="initViewer('situace')">
                        </div>
                    </div>
                </div>
                
                <div class="upd-viewer-panel">
                    <div class="upd-viewer-toolbar">
                        <div class="upd-viewer-tabs">
                            <button class="upd-vtab active" onclick="switchUPDMap('urp', this)">ÚRP</button>
                            <button class="upd-vtab" onclick="switchUPDMap('zur', this)">ZÚR</button>
                            <button class="upd-vtab" onclick="switchUPDMap('up', this)">ÚP</button>
                        </div>
                        <div class="upd-zoom-controls">
                            <button class="upd-zoom-btn" onclick="zoomViewer('upd', -0.2)" title="Oddálit">−</button>
                            <button class="upd-zoom-btn" onclick="resetViewer('upd')" title="Reset">⟲</button>
                            <button class="upd-zoom-btn" onclick="zoomViewer('upd', 0.2)" title="Přiblížit">+</button>
                        </div>
                        <button class="upd-viewer-btn" onclick="openImageFullscreen('upd')" title="Nové okno">
                            <span class="material-icons-outlined">open_in_new</span>
                        </button>
                    </div>
                    <div class="upd-viewer-content" id="updMapViewer">
                        <div class="upd-image-container" id="updContainer">
                            <img src="../images/URP.png" alt="ÚRP" id="updImage" 
                                 draggable="false" onload="initViewer('upd')">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Kontrolní panel - minimální šířka -->
            <div class="upd-control-panel">
                <div class="upd-check-item" id="checkUrp">
                    <div class="upd-check-row">
                        <span class="upd-check-label">ÚRP</span>
                        <span class="upd-check-status" id="statusUrp"></span>
                    </div>
                    <div class="upd-check-buttons">
                        <button class="upd-btn-yes" onclick="setUPDSoulad('urp', true, this)" title="V souladu">✓</button>
                        <button class="upd-btn-no" onclick="setUPDSoulad('urp', false, this)" title="Rozpor">✗</button>
                        <span class="upd-nesoulad-indicator" id="indicatorUrp" onclick="openNesouladModal('urp')" title="Upravit popis nesouladu">✎</span>
                    </div>
                    <textarea class="upd-note-input" id="noteUrp" style="display:none;" 
                        placeholder="Popište rozpor s Územním rozvojovým plánem..." oninput="updateUPDState()"></textarea>
                </div>
                
                <div class="upd-check-item" id="checkZur">
                    <div class="upd-check-row">
                        <span class="upd-check-label">ZÚR</span>
                        <span class="upd-check-status" id="statusZur"></span>
                    </div>
                    <div class="upd-check-buttons">
                        <button class="upd-btn-yes" onclick="setUPDSoulad('zur', true, this)" title="V souladu">✓</button>
                        <button class="upd-btn-no" onclick="setUPDSoulad('zur', false, this)" title="Rozpor">✗</button>
                        <span class="upd-nesoulad-indicator" id="indicatorZur" onclick="openNesouladModal('zur')" title="Upravit popis nesouladu">✎</span>
                    </div>
                    <textarea class="upd-note-input" id="noteZur" style="display:none;" 
                        placeholder="Popište rozpor se Zásadami územního rozvoje..." oninput="updateUPDState()"></textarea>
                </div>
                
                <div class="upd-check-item" id="checkUp">
                    <div class="upd-check-row">
                        <span class="upd-check-label">ÚP</span>
                        <span class="upd-check-status" id="statusUp"></span>
                    </div>
                    <div class="upd-check-mini-label">Existuje?</div>
                    <div class="upd-check-buttons" id="upExistButtons">
                        <button class="upd-btn-yes" onclick="setUPExistence(true, this)">✓</button>
                        <button class="upd-btn-no" onclick="setUPExistence(false, this)">✗</button>
                    </div>
                    <div id="upSouladSection" style="display:none;">
                        <div class="upd-check-mini-label">Soulad?</div>
                        <div class="upd-check-buttons">
                            <button class="upd-btn-yes" onclick="setUPDSoulad('up', true, this)">✓</button>
                            <button class="upd-btn-no" onclick="setUPDSoulad('up', false, this)">✗</button>
                            <span class="upd-nesoulad-indicator" id="indicatorUp" onclick="openNesouladModal('up')" title="Upravit popis nesouladu">✎</span>
                        </div>
                        <textarea class="upd-note-input" id="noteUp" style="display:none;" 
                            placeholder="Popište rozpor s Územním plánem..." oninput="updateUPDState()"></textarea>
                    </div>
                    <div class="upd-no-up-info" id="noUpInfo" style="display:none;">Posouzení dle § 193</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kontrola: Osoby -->
    <div class="control-overlay" id="controlUcastnici">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlUcastnici')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">groups</span>
                    Osoby
                </div>
            </div>
        </div>
        <div class="control-body" style="display: block;">
            <div class="control-form" style="width: 100%; border-left: none;">
                <div class="control-form-body osoby-layout">
                    
                    <!-- ========== LEVÝ SLOUPEC: POZEMKY ========== -->
                    <div class="osoby-col-pozemky">
                        <div class="osoby-col-header">
                            <span class="material-icons-outlined">terrain</span>
                            Pozemky
                            <button class="btn-overit-vse-sm" onclick="overitVsechnyPozemkyKN()">
                                <span class="material-icons-outlined">verified</span>
                                Načíst osoby z KN
                            </button>
                        </div>
                        
                        <div class="osoby-pozemky-content">
                            <!-- Pozemky záměru -->
                            <div class="pozemky-blok">
                                <div class="pozemky-blok-header zamer">
                                    <span class="pozemky-blok-title">Pozemky záměru</span>
                                    <span class="pozemky-blok-count" id="countZamer">2</span>
                                </div>
                                <div class="pozemky-blok-list" id="listPozemkyZameru">
                                    <div class="pozemek-item" data-parcela="st. 123">
                                        <span class="pozemek-parcela">st. 123</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-st123">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('st. 123', 'Jaroměř')">Ověřit</button>
                                    </div>
                                    <div class="pozemek-item" data-parcela="456/1">
                                        <span class="pozemek-parcela">456/1</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-4561">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('456/1', 'Jaroměř')">Ověřit</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sousední pozemky -->
                            <div class="pozemky-blok">
                                <div class="pozemky-blok-header soused">
                                    <span class="pozemky-blok-title">Sousední pozemky</span>
                                    <span class="pozemky-blok-count" id="countSoused">4</span>
                                </div>
                                <div class="pozemky-blok-list" id="listSousedniPozemky">
                                    <div class="pozemek-item" data-parcela="st. 122">
                                        <span class="pozemek-parcela">st. 122</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-st122">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('st. 122', 'Jaroměř')">Ověřit</button>
                                    </div>
                                    <div class="pozemek-item" data-parcela="st. 124">
                                        <span class="pozemek-parcela">st. 124</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-st124">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('st. 124', 'Jaroměř')">Ověřit</button>
                                    </div>
                                    <div class="pozemek-item" data-parcela="456/2">
                                        <span class="pozemek-parcela">456/2</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-4562">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('456/2', 'Jaroměř')">Ověřit</button>
                                    </div>
                                    <div class="pozemek-item" data-parcela="457">
                                        <span class="pozemek-parcela">457</span>
                                        <span class="pozemek-ku">Jaroměř</span>
                                        <span class="pozemek-vlastnik" id="vl-457">—</span>
                                        <span class="pozemek-status pending"><span class="material-icons-outlined">schedule</span></span>
                                        <button class="btn-overit-sm" onclick="overitPozemekKN('457', 'Jaroměř')">Ověřit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ========== PRAVÝ SLOUPEC: ÚČASTNÍCI ========== -->
                    <div class="osoby-col-ucastnici">
                        <div class="osoby-col-header">
                            <div class="osoby-tabs-inline">
                                <button class="osoby-tab-btn active" onclick="switchOsobyTab(this, 'ucastnici')">
                                    Účastníci <span class="osoby-tab-count" id="tabCountUcastnici">2</span>
                                </button>
                                <button class="osoby-tab-btn" onclick="switchOsobyTab(this, 'zastupci')">
                                    Zástupci <span class="osoby-tab-count" id="tabCountZastupci">0</span>
                                </button>
                                <button class="osoby-tab-btn" onclick="switchOsobyTab(this, 'dotceneOrgany')">
                                    Dotčené orgány <span class="osoby-tab-count" id="tabCountDotceneOrgany">0</span>
                                </button>
                                <button class="osoby-tab-btn" onclick="switchOsobyTab(this, 'dalsi')">
                                    Další osoby <span class="osoby-tab-count" id="tabCountDalsi">1</span>
                                </button>
                            </div>
                            <div class="osoby-header-actions">
                                <button class="btn-overit-osoby" onclick="overitVsechnyOsoby()">
                                    <span class="material-icons-outlined">verified_user</span>
                                    Ověřit všechny
                                </button>
                                <button class="btn-add-osoba" onclick="addUcastnik('manual')">
                                    <span class="material-icons-outlined">add</span>
                                    Přidat
                                </button>
                            </div>
                        </div>
                        
                        <!-- Panel: Účastníci -->
                        <div class="osoby-tab-panel active" id="tabPanelUcastnici">
                            <table class="osoby-table">
                                <thead>
                                    <tr>
                                        <th style="width: 28px;"></th>
                                        <th>Účastník</th>
                                        <th>Adresa / Poznámka</th>
                                        <th style="width: 50px;">Zdroj</th>
                                        <th style="width: 60px;">Doruč.</th>
                                        <th style="width: 110px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyUcastnici">
                                    <!-- Stavebník -->
                                    <tr class="osoby-kategorie-row">
                                        <td colspan="6">
                                            <span class="kategorie-label">Stavebník / Žadatel</span>
                                        </td>
                                    </tr>
                                    <tr data-osoba-id="jan-novak" data-overeno="true">
                                        <td><span class="os-status ok" title="Ověřeno z Portálu stavebníka"><span class="material-icons-outlined">check_circle</span></span></td>
                                        <td><strong>Jan Novák</strong><br><small class="text-muted">Fyzická osoba</small></td>
                                        <td>
                                            Květná 123, 110 00 Praha 1
                                            <span class="os-ds-info"><span class="material-icons-outlined">forward_to_inbox</span> abc123x</span>
                                        </td>
                                        <td><span class="os-zdroj zdroj-zadost">žádost</span></td>
                                        <td>
                                            <button class="btn-dorucovani ds" onclick="toggleDorucovani(this)" title="Doručit do datové schránky" data-stav="ds" data-ds="abc123x">
                                                <span class="material-icons-outlined">forward_to_inbox</span>
                                            </button>
                                        </td>
                                        <td class="os-actions">
                                            <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                                        </td>
                                    </tr>
                                    
                                    <!-- Obec -->
                                    <tr class="osoby-kategorie-row">
                                        <td colspan="6">
                                            <span class="kategorie-label">Obec</span>
                                        </td>
                                    </tr>
                                    <tr data-osoba-id="mesto-jaromer" data-overeno="false">
                                        <td><span class="os-status pending" title="Neověřeno"><span class="material-icons-outlined">help_outline</span></span></td>
                                        <td><strong>Město Jaroměř</strong><br><small class="text-muted">Právnická osoba</small></td>
                                        <td class="os-adresa-neovereno">—</td>
                                        <td><span class="os-zdroj zdroj-ku">k.ú.</span></td>
                                        <td>
                                            <span class="doruc-ceka" title="Čeká na ověření">—</span>
                                        </td>
                                        <td class="os-actions">
                                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku">
                                                <span class="material-icons-outlined">verified_user</span>
                                            </button>
                                            <button class="is-favorited" onclick="toggleOblibeny(this)" title="V oblíbených"><span class="material-icons-outlined">star</span></button>
                                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                                        </td>
                                    </tr>
                                    
                                    <!-- Vlastníci pozemků záměru -->
                                    <tr class="osoby-kategorie-row" id="katVlastniciZameru">
                                        <td colspan="6">
                                            <span class="kategorie-label">Vlastníci pozemků záměru</span>
                                            <span class="kategorie-stav ceka">čeká na ověření z KN</span>
                                        </td>
                                    </tr>
                                    <tr class="osoby-empty-row" id="emptyVlastniciZameru">
                                        <td colspan="6" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">hourglass_empty</span>
                                            Ověřte pozemky záměru
                                        </td>
                                    </tr>
                                    
                                    <!-- Vlastníci sousedních pozemků -->
                                    <tr class="osoby-kategorie-row" id="katVlastniciSousedi">
                                        <td colspan="6">
                                            <span class="kategorie-label">Vlastníci sousedních pozemků</span>
                                            <span class="kategorie-stav ceka">čeká na ověření z KN</span>
                                        </td>
                                    </tr>
                                    <tr class="osoby-empty-row" id="emptyVlastniciSousedi">
                                        <td colspan="6" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">hourglass_empty</span>
                                            Ověřte sousední pozemky
                                        </td>
                                    </tr>
                                    
                                    <!-- Ostatní účastníci -->
                                    <tr class="osoby-kategorie-row">
                                        <td colspan="6">
                                            <span class="kategorie-label">Ostatní účastníci</span>
                                            <button class="btn-nacist-vti" onclick="nacistVTIVDI()">
                                                <span class="material-icons-outlined">download</span>
                                                Načíst VTI/VDI
                                            </button>
                                        </td>
                                    </tr>
                                    <tr class="osoby-empty-row" id="emptyOstatniUcastnici">
                                        <td colspan="6" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">business</span>
                                            Vlastníci infrastruktury — načtěte z Dokladové části
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Panel: Zástupci -->
                        <div class="osoby-tab-panel" id="tabPanelZastupci">
                            <!-- Toolbar zástupců -->
                            <div class="zastupci-toolbar">
                                <div class="zastupci-toolbar-left">
                                    <span class="zastupci-info">
                                        <span class="material-icons-outlined">info</span>
                                        Zástupce doručuje místo zastupovaného účastníka
                                    </span>
                                </div>
                                <div class="zastupci-toolbar-right">
                                    <button class="btn btn-sm btn-secondary" onclick="openPridatZastupceModal()">
                                        <span class="material-icons-outlined">add</span>
                                        Přidat zástupce
                                    </button>
                                    <button class="btn btn-sm btn-outline" onclick="pridatZastupceZOblibenych()">
                                        <span class="material-icons-outlined">star</span>
                                        Z oblíbených
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Tabulka zástupců -->
                            <table class="osoby-table" id="tableZastupci">
                                <thead>
                                    <tr>
                                        <th style="width: 24px;"></th>
                                        <th>Zástupce</th>
                                        <th>Zastupovaný</th>
                                        <th>Role zastupovaného</th>
                                        <th style="width: 90px;">Doručovat</th>
                                        <th style="width: 100px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyZastupci">
                                    <tr class="osoby-empty-row" id="emptyZastupci">
                                        <td colspan="6" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">supervisor_account</span>
                                            Žádní zástupci — přidejte zástupce tlačítkem výše
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Panel: Dotčené orgány -->
                        <div class="osoby-tab-panel" id="tabPanelDotceneOrgany">
                            
                            <!-- Info box pro integrované DO (od 1.1.2028) -->
                            <div class="platnost-info-box integrated-do-info" id="infoIntegrovaneDOOsoby" style="display: none; margin: 0 0 16px 0;">
                                <div class="platnost-info-icon">
                                    <span class="material-icons-outlined">verified</span>
                                </div>
                                <div class="platnost-info-content">
                                    <div class="platnost-info-title">Integrované dotčené orgány</div>
                                    <div class="platnost-info-text">Od 1. 1. 2028 jsou dotčené orgány integrovány do JSSÚ. Závazná stanoviska jsou vydávána automaticky — není třeba evidovat DO jako samostatné účastníky.</div>
                                </div>
                            </div>
                            
                            <!-- Toolbar dotčených orgánů -->
                            <div class="zastupci-toolbar" id="toolbarDotceneOrgany">
                                <div class="zastupci-toolbar-left">
                                    <span class="zastupci-info">
                                        <span class="material-icons-outlined">info</span>
                                        Dotčené orgány jsou načítány z Dokladové části
                                    </span>
                                </div>
                                <div class="zastupci-toolbar-right">
                                    <button class="btn btn-sm btn-secondary" onclick="nacistDotceneOrgany()">
                                        <span class="material-icons-outlined">download</span>
                                        Načíst z Dokladové části
                                    </button>
                                    <button class="btn btn-sm btn-outline" onclick="pridatDotcenyOrgan()">
                                        <span class="material-icons-outlined">add</span>
                                        Přidat ručně
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Tabulka dotčených orgánů -->
                            <table class="osoby-table" id="tableDotceneOrgany">
                                <thead>
                                    <tr>
                                        <th style="width: 24px;"></th>
                                        <th>Dotčený orgán</th>
                                        <th>Typ závazného stanoviska</th>
                                        <th style="width: 90px;">Stav</th>
                                        <th style="width: 100px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyDotceneOrgany">
                                    <tr class="osoby-empty-row" id="emptyDotceneOrgany">
                                        <td colspan="5" class="text-center text-muted">
                                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">account_balance</span>
                                            Žádné dotčené orgány — načtěte z Dokladové části
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Panel: Další osoby -->
                        <div class="osoby-tab-panel" id="tabPanelDalsi">
                            <table class="osoby-table">
                                <thead>
                                    <tr>
                                        <th style="width: 24px;"></th>
                                        <th>Osoba</th>
                                        <th>Role</th>
                                        <th style="width: 100px;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="os-status ok"><span class="material-icons-outlined">check_circle</span></span></td>
                                        <td><strong>Ing. arch. Alois Hrejsísemnou</strong><br><small class="text-muted">Fyzická osoba</small></td>
                                        <td><span class="os-role">hlavní projektant</span></td>
                                        <td class="os-actions">
                                            <button class="is-favorited" onclick="toggleOblibeny(this)" title="V oblíbených"><span class="material-icons-outlined">star</span></button>
                                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                                            <button title="Odstranit"><span class="material-icons-outlined">delete</span></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveUcastnici">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlUcastnici')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('ucastnici')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeUcastnici()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit osoby
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Přidat zástupce -->
    <div class="modal-overlay" id="modalPridatZastupce" style="display: none;">
        <div class="modal-dialog" style="max-width: 550px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span class="material-icons-outlined">supervisor_account</span>
                    Přidat zástupce
                </h3>
                <button class="modal-close" onclick="closeModalZastupce()">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Krok 1: Údaje o zástupci -->
                <div class="form-section">
                    <div class="form-section-title">1. Údaje o zástupci</div>
                    
                    <div class="form-row">
                        <label class="form-label">Typ osoby</label>
                        <div class="form-radio-group">
                            <label class="form-radio">
                                <input type="radio" name="zastupce_typ" value="FO" checked onchange="toggleZastupceForm()">
                                <span>Fyzická osoba</span>
                            </label>
                            <label class="form-radio">
                                <input type="radio" name="zastupce_typ" value="PO" onchange="toggleZastupceForm()">
                                <span>Právnická osoba</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- FO formulář -->
                    <div id="zastupceFormFO">
                        <div class="form-row-3col">
                            <div class="form-group">
                                <label class="form-label">Jméno *</label>
                                <input type="text" class="form-input" id="zastupceJmeno" placeholder="Jan">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Příjmení *</label>
                                <input type="text" class="form-input" id="zastupcePrijmeni" placeholder="Novák">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Datum narození *</label>
                                <input type="date" class="form-input" id="zastupceDatumNarozeni">
                            </div>
                        </div>
                        <div class="form-verify-row">
                            <button type="button" class="btn btn-sm btn-outline" onclick="overitZastupceZRejstriku('FO')">
                                <span class="material-icons-outlined">verified_user</span>
                                Ověřit z rejstříku
                            </button>
                            <span class="verify-status" id="verifyStatusFO"></span>
                        </div>
                        
                        <!-- Doplněné údaje po ověření -->
                        <div id="zastupceDetailFO" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Adresa trvalého pobytu</label>
                                <input type="text" class="form-input" id="zastupceAdresaFO" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PO formulář -->
                    <div id="zastupceFormPO" style="display: none;">
                        <div class="form-row-ico">
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label">IČO *</label>
                                <input type="text" class="form-input" id="zastupceICO" placeholder="12345678" maxlength="8">
                            </div>
                            <button type="button" class="btn btn-sm btn-outline btn-verify-ico" onclick="overitZastupceZRejstriku('PO')">
                                <span class="material-icons-outlined">verified_user</span>
                                Ověřit z rejstříku
                            </button>
                        </div>
                        <span class="verify-status" id="verifyStatusPO"></span>
                        
                        <!-- Doplněné údaje po ověření -->
                        <div id="zastupceDetailPO" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Název organizace</label>
                                <input type="text" class="form-input" id="zastupceNazev" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sídlo</label>
                                <input type="text" class="form-input" id="zastupceAdresaPO" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Krok 2: Výběr zastupovaných -->
                <div class="form-section">
                    <div class="form-section-title">2. Zastupované osoby</div>
                    <p class="form-hint">Vyberte účastníky, které bude zástupce zastupovat. Lze vybrat více osob.</p>
                    
                    <div class="zastupovani-list" id="zastupovaniList">
                        <!-- Stavebník -->
                        <label class="zastupovani-item">
                            <input type="checkbox" name="zastupovani" value="jan-novak">
                            <div class="zastupovani-info">
                                <span class="zastupovani-name">Jan Novák</span>
                                <span class="zastupovani-role">Stavebník / Žadatel</span>
                            </div>
                        </label>
                        
                        <!-- Obec -->
                        <label class="zastupovani-item">
                            <input type="checkbox" name="zastupovani" value="mesto-jaromer">
                            <div class="zastupovani-info">
                                <span class="zastupovani-name">Město Jaroměř</span>
                                <span class="zastupovani-role">Obec</span>
                            </div>
                        </label>
                        
                        <!-- Další účastníci se přidají dynamicky po ověření z KN -->
                        <div id="zastupovaniDynamicList"></div>
                    </div>
                </div>
                
                <!-- Krok 3: Nastavení doručování -->
                <div class="form-section">
                    <div class="form-section-title">3. Nastavení doručování</div>
                    
                    <label class="form-checkbox">
                        <input type="checkbox" id="zastupceNedorucovat" checked>
                        <span>Nedoručovat zastupovaným osobám <small class="text-muted">(doporučeno)</small></span>
                    </label>
                    
                    <p class="form-hint" style="margin-top: 8px;">
                        <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle;">info</span>
                        Pokud je zaškrtnuto, dokumenty budou doručovány pouze zástupci, nikoliv zastupovaným osobám.
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModalZastupce()">Zrušit</button>
                <button class="btn btn-primary" onclick="pridatZastupce()">
                    <span class="material-icons-outlined">add</span>
                    Přidat zástupce
                </button>
            </div>
        </div>
    </div>

    <!-- Kontrola: Zrychlené řízení -->
    <div class="control-overlay" id="controlZrychlene">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlZrychlene')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">bolt</span>
                    Podmínky zrychleného řízení
                </div>
            </div>
        </div>
        <div class="control-body">
            <div class="control-viewer">
                <div class="viewer-tabs">
                    <div class="viewer-tabs-left">
                        <button class="viewer-tab active" onclick="switchViewerTab(this, 'zrychlene', 'zadost')">
                            <span class="material-icons-outlined">description</span>
                            Žádost
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'prilohy')">
                            <span class="material-icons-outlined">attach_file</span>
                            Přílohy
                            <span class="badge">12</span>
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'eed')">
                            <span class="material-icons-outlined">folder</span>
                            El. dokumentace
                        </button>
                        <button class="viewer-tab" onclick="switchViewerTab(this, 'zrychlene', 'doklady')">
                            <span class="material-icons-outlined">fact_check</span>
                            Dokladová část
                        </button>
                    </div>
                    <button class="viewer-open-external" onclick="openViewerExternal('zrychlene')" title="Otevřít v novém okně">
                        <span class="material-icons-outlined">open_in_new</span>
                    </button>
                </div>
                <div class="viewer-content">
                    <div class="viewer-placeholder" id="viewer-zrychlene">
                        <span class="material-icons-outlined">description</span>
                        <div class="viewer-placeholder-title">Žádost o povolení stavby</div>
                        <div class="viewer-placeholder-text">Souhrnná kontrola podmínek pro zrychlené řízení</div>
                    </div>
                </div>
            </div>
            <div class="control-form">
                <div class="control-form-body">
                    <div class="control-section">
                        <div class="control-section-title">Podmínky podle § 212 stavebního zákona</div>
                        <p style="font-size: 13px; color: #5f6368; margin-bottom: 16px; font-style: normal;">
                            Ověřte splnění všech podmínek pro zrychlené řízení:
                        </p>
                        
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_uplnost" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Žádost je úplná</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_eia" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr nevyžaduje posouzení vlivů na ŽP</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_up" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Záměr je v souladu s ÚP</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_stanoviska" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Stanoviska DO jsou kladná nebo s podmínkami</div>
                            </div>
                        </label>
                        <label class="control-option selected" style="cursor: default;">
                            <input type="checkbox" name="zr_souhlasy" checked onclick="updateZrychleneResult()">
                            <div class="control-option-content">
                                <div class="control-option-label">Souhlasy účastníků jsou přiloženy</div>
                            </div>
                        </label>
                    </div>

                    <div class="result-preview positive" id="resultZrychlene">
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">check_circle</span>
                            Podmínky splněny
                        </div>
                        <div class="result-preview-text">Všechny podmínky pro zrychlené řízení jsou splněny.</div>
                    </div>
                </div>
                <div class="control-form-footer">
                    <div class="control-form-footer-left">
                        <div class="auto-save-indicator saved" id="autoSaveZrychlene">
                            <span class="material-icons-outlined">cloud_done</span>
                            <span>Automaticky uloženo</span>
                        </div>
                    </div>
                    <div class="control-form-footer-right">
                        <button class="btn btn-secondary" onclick="closeControl('controlZrychlene')">Zrušit</button>
                        <button class="btn-save-draft" onclick="saveDraft('zrychlene')" title="Uložit rozpracovanou kontrolu">
                            <span class="material-icons-outlined">save</span>
                            Uložit
                        </button>
                        <button class="btn btn-primary" onclick="completeZrychlene()">
                            <span class="material-icons-outlined">check</span>
                            Potvrdit kontrolu
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ============================================ -->
    <!-- BLOCK EDITOR: Výzva k doplnění + Usnesení   -->
    <!-- ============================================ -->
    <div class="control-overlay" id="controlVyzva">
        <div class="control-header">
            <div class="control-header-left">
                <button class="control-close" onclick="closeControl('controlVyzva')">
                    <span class="material-icons-outlined">close</span>
                </button>
                <div class="control-title">
                    <span class="material-icons-outlined">edit_document</span>
                    Výzva k doplnění + Usnesení o přerušení řízení
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:#5f6368">
                <span class="material-icons-outlined" style="font-size:16px;color:#004289">auto_awesome</span>
                Předvyplněno z kontrol
            </div>
        </div>

        <div class="editor-layout">
            <!-- LEFT: Structure sidebar -->
            <div class="editor-sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">I. Výzva</div>
                    <div class="sidebar-item active" onclick="edScrollTo('vblk-hlavicka',this)">
                        <div class="si-icon auto"><span class="material-icons-outlined">lock</span></div>
                        <span>Hlavička</span>
                    </div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-spis',this)">
                        <div class="si-icon auto"><span class="material-icons-outlined">lock</span></div>
                        <span>Spisové údaje</span>
                    </div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-identifikace',this)">
                        <div class="si-icon auto"><span class="material-icons-outlined">lock</span></div>
                        <span>Identifikace stavebníka</span>
                    </div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-pravni',this)">
                        <div class="si-icon auto"><span class="material-icons-outlined">lock</span></div>
                        <span>Právní věta</span>
                    </div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-lhuta',this)" style="font-weight:500">
                        <div class="si-icon semi"><span class="material-icons-outlined">tune</span></div>
                        <span>Lhůta k doplnění</span>
                    </div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-nedostatky',this)" style="font-weight:500">
                        <div class="si-icon semi"><span class="material-icons-outlined">tune</span></div>
                        <span>Seznam nedostatků</span>
                    </div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-free',this)">
                        <div class="si-icon free"><span class="material-icons-outlined">edit</span></div>
                        <span>Vlastní body</span>
                    </div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-upozorneni',this)">
                        <div class="si-icon auto"><span class="material-icons-outlined">lock</span></div>
                        <span>Upozornění</span>
                    </div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">II. Usnesení</div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-vyrok',this)">
                        <div class="si-icon auto"><span class="material-icons-outlined">lock</span></div>
                        <span>Výrok o přerušení</span>
                    </div>
                    <div class="sidebar-item" onclick="edScrollTo('vblk-pouceni',this)">
                        <div class="si-icon auto"><span class="material-icons-outlined">lock</span></div>
                        <span>Poučení + podpis</span>
                    </div>
                </div>
                <div class="sidebar-legend">
                    <div class="legend-item"><div class="legend-dot" style="background:#dadce0"></div> Automatický (zamčeno)</div>
                    <div class="legend-item"><div class="legend-dot" style="background:#a8c7fa"></div> Semi-auto (upravitelný)</div>
                    <div class="legend-item"><div class="legend-dot" style="background:#f9ab00"></div> Volný text (úředník)</div>
                </div>
            </div>

            <!-- CENTER: Editor paper -->
            <div class="editor-main">
                <div class="editor-paper">

                    <!-- Hlavička -->
                    <div class="doc-block auto" id="vblk-hlavicka">
                        <span class="block-label auto-label"><span class="material-icons-outlined">lock</span> auto</span>
                        <div class="block-urad">Dopravní a energetický stavební úřad</div>
                        <div class="block-sub">Odbor staveb drah · Oddělení Plzeň</div>
                        <div class="block-sub">Purkyňova 22, 301 36 Plzeň</div>
                    </div>

                    <!-- Spisové údaje -->
                    <div class="doc-block auto" id="vblk-spis" style="margin-top:12px">
                        <span class="block-label auto-label"><span class="material-icons-outlined">lock</span> auto · spisová služba</span>
                        <div class="block-body" style="display:flex;justify-content:space-between;font-size:10px">
                            <div>
                                <div>Spis. zn.: <strong>SZ DESU/004539/26</strong></div>
                                <div>Č.j.: <strong>DESU/121/004594/26</strong></div>
                            </div>
                            <div style="text-align:right">
                                <div>Vyřizuje: <strong>Ing. Kálal</strong></div>
                                <div>Datum: <strong id="vyzvaDate"></strong></div>
                            </div>
                        </div>
                    </div>

                    <!-- Název -->
                    <div class="doc-block auto" style="margin:16px 0">
                        <div class="block-header-text" style="font-size:14px">I. VÝZVA</div>
                        <div class="block-header-text" style="font-size:12px;margin-top:-2px">K ODSTRANĚNÍ NEDOSTATKŮ ŽÁDOSTI</div>
                    </div>

                    <!-- Identifikace -->
                    <div class="doc-block auto" id="vblk-identifikace">
                        <span class="block-label auto-label"><span class="material-icons-outlined">lock</span> auto · modul účastníků</span>
                        <div class="block-body">
                            <p><strong>Industrial Center CR 2 s.r.o.</strong>, IČO: 12345678, zastoupena na základě plné moci společností <strong>RotaGroup a.s.</strong>, podal žádost o povolení záměru:</p>
                            <p style="text-align:center;font-weight:600;font-style:italic">„Novostavba RD včetně přípojek"</p>
                            <p>na pozemcích parc. č. 123/4, 123/5, 124/1 v k.ú. Plzeň-město</p>
                        </div>
                    </div>

                    <!-- Právní věta -->
                    <div class="doc-block auto" id="vblk-pravni" style="margin-top:10px">
                        <span class="block-label auto-label"><span class="material-icons-outlined">lock</span> auto · šablona</span>
                        <div class="block-body">
                            <p>Dopravní a energetický stavební úřad jako stavební úřad příslušný podle § 33 odst. 2 zákona č. 283/2021 Sb., stavební zákon, přezkoumal podanou žádost a zjistil, že neobsahuje všechny požadované náležitosti a přílohy, a proto</p>
                            <p style="text-align:center;font-weight:700;font-size:13px;letter-spacing:4px;margin:10px 0">v&nbsp;y&nbsp;z&nbsp;ý&nbsp;v&nbsp;á</p>
                            <p>stavebníka, aby nejpozději do</p>
                        </div>
                    </div>

                    <!-- SEMI: Lhůta -->
                    <div class="doc-block semi" id="vblk-lhuta" style="padding:10px">
                        <span class="block-label semi-label"><span class="material-icons-outlined">tune</span> semi</span>
                        <div class="lhuta-sel">
                            <div class="lhuta-opt" onclick="edSelectLhuta(this,'abs')">
                                <div class="lhuta-radio-ed"></div>
                                <span>Datum: <input type="date" class="lhuta-inp" style="width:130px" value="2026-04-30"></span>
                            </div>
                            <div class="lhuta-opt selected" onclick="edSelectLhuta(this,'rel')">
                                <div class="lhuta-radio-ed"></div>
                                <span><input type="number" class="lhuta-inp" value="60" min="15" max="180"> dnů od doručení</span>
                            </div>
                        </div>
                    </div>

                    <!-- Auto: continuation -->
                    <div class="doc-block auto">
                        <div class="block-body"><p>odstranil následující nedostatky žádosti:</p></div>
                    </div>

                    <!-- SEMI: Seznam nedostatků z kontrol -->
                    <div class="doc-block semi" id="vblk-nedostatky" style="padding:10px">
                        <span class="block-label semi-label"><span class="material-icons-outlined">tune</span> semi · z kontrol</span>
                        <div style="font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.4px;color:#004289;margin-bottom:6px;display:flex;align-items:center;gap:4px">
                            <span class="material-icons-outlined" style="font-size:14px">checklist</span>
                            Nedostatky zjištěné při kontrolách
                        </div>
                        <div class="deficiency-list-editor" id="edDefList">
                            <!-- Filled dynamically from control results -->
                        </div>
                    </div>

                    <!-- FREE: Vlastní body -->
                    <div class="doc-block free" id="vblk-free" style="padding:10px">
                        <span class="block-label free-label"><span class="material-icons-outlined">edit</span> volný text</span>
                        <div style="font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.4px;color:#e37400;margin-bottom:6px;display:flex;align-items:center;gap:4px">
                            <span class="material-icons-outlined" style="font-size:14px">edit_note</span>
                            Vlastní body úředníka
                        </div>
                        <div id="edUserDefs"></div>
                        <button class="add-def-btn" onclick="edAddUserDef()">
                            <span class="material-icons-outlined" style="font-size:16px">add_circle_outline</span>
                            Přidat vlastní bod
                            <span style="font-size:9px;color:#9aa0a6;margin-left:auto">otevře se editor s formátováním</span>
                        </button>
                        </button>
                    </div>

                    <!-- Auto: Upozornění -->
                    <div class="doc-block auto" id="vblk-upozorneni" style="margin-top:12px">
                        <span class="block-label auto-label"><span class="material-icons-outlined">lock</span> auto · šablona</span>
                        <div class="block-body">
                            <p>Pokud nebudou nedostatky ve stanovené lhůtě odstraněny, stavební úřad řízení usnesením zastaví podle § 66 odst. 1 písm. c) správního řádu.</p>
                        </div>
                    </div>

                    <!-- ═══ II. USNESENÍ ═══ -->
                    <div class="doc-block auto" id="vblk-vyrok" style="margin-top:24px;border-top:2px solid #004289;padding-top:14px">
                        <span class="block-label auto-label"><span class="material-icons-outlined">lock</span> auto · workflow</span>
                        <div class="block-header-text" style="font-size:13px">II. USNESENÍ O PŘERUŠENÍ ŘÍZENÍ</div>
                        <div class="block-body" style="margin-top:10px">
                            <p>Dopravní a energetický stavební úřad podle § 185 odst. 2 stavebního zákona</p>
                            <p style="text-align:center;font-weight:700;font-size:13px;letter-spacing:4px;margin:10px 0">p&nbsp;ř&nbsp;e&nbsp;r&nbsp;u&nbsp;š&nbsp;u&nbsp;j&nbsp;e</p>
                            <p>řízení o povolení záměru „Novostavba RD včetně přípojek" na pozemcích parc. č. 123/4, 123/5, 124/1 v k.ú. Plzeň-město, a to nejdéle na dobu <strong id="edUsneseniLhuta">60 dnů od doručení</strong> této výzvy.</p>
                        </div>
                    </div>

                    <!-- Auto: Poučení + podpis -->
                    <div class="doc-block auto" id="vblk-pouceni" style="margin-top:10px">
                        <span class="block-label auto-label"><span class="material-icons-outlined">lock</span> auto</span>
                        <div class="block-body">
                            <p><strong>Poučení:</strong> Proti tomuto usnesení se podle § 185 odst. 2 stavebního zákona nelze odvolat.</p>
                        </div>
                        <div class="block-body" style="text-align:right;margin-top:16px">
                            <strong>Ing. Jitka Kotásková</strong><br>
                            ředitelka odboru staveb drah
                        </div>
                        <div class="block-body" style="margin-top:16px;padding-top:10px;border-top:1px solid #ddd;font-size:10px;color:#666">
                            <strong>Obdrží:</strong><br>
                            RotaGroup a.s., IDDS: 78hx792 (v zastoupení Industrial Center CR 2 s.r.o.)
                        </div>
                    </div>

                </div>
            </div>

            <!-- RIGHT: Properties -->
            <div class="editor-props-panel">
                <div class="props-section">
                    <div class="props-title">Stav dokumentu</div>
                    <div class="props-stat"><span style="color:#5f6368">Stav</span><span style="color:#f9ab00;font-weight:500">● Rozpracováno</span></div>
                    <div class="props-stat"><span style="color:#5f6368">Autor</span><span style="font-weight:500">Ing. Kálal</span></div>
                </div>
                <div class="props-section">
                    <div class="props-title">Složení dokumentu</div>
                    <div style="display:flex;gap:2px;margin-bottom:6px">
                        <div style="flex:10;height:6px;background:#137333;border-radius:2px 0 0 2px" title="Auto"></div>
                        <div style="flex:3;height:6px;background:#004289" title="Semi"></div>
                        <div style="flex:1;height:6px;background:#f9ab00;border-radius:0 2px 2px 0" title="Free"></div>
                    </div>
                    <div style="font-size:10px;color:#5f6368;display:flex;justify-content:space-between">
                        <span>10 auto</span><span>3 semi</span><span>1 volný</span>
                    </div>
                </div>
                <div class="props-section">
                    <div class="props-title">Nedostatky</div>
                    <div class="props-stat"><span style="color:#5f6368">Z kontrol</span><span style="font-weight:500" id="edPropsControl">—</span></div>
                    <div class="props-stat"><span style="color:#5f6368">Vlastní body</span><span style="font-weight:500" id="edPropsUser">0</span></div>
                    <div class="props-stat"><span style="font-weight:600">Celkem</span><span style="font-weight:700;color:#004289" id="edPropsTotal">—</span></div>
                </div>
                <div class="props-section">
                    <div class="props-title">Datové zdroje</div>
                    <div>
                        <span class="ds-tag">Modul účastníků</span>
                        <span class="ds-tag">Spisová služba</span>
                        <span class="ds-tag">Kontrola PD</span>
                        <span class="ds-tag">Checklist DO</span>
                        <span class="ds-tag">DTM modul</span>
                        <span class="ds-tag">Org. struktura</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="control-form-footer">
            <div class="control-form-footer-left" style="font-size:11px;color:#5f6368">
                <span class="material-icons-outlined" style="font-size:14px;vertical-align:middle">info</span>
                Šedé bloky jsou automatické. Modré a žluté bloky vyžadují váš vstup.
            </div>
            <div class="control-form-footer-right">
                <button class="btn btn-secondary" onclick="closeControl('controlVyzva')">Zrušit</button>
                <button class="btn btn-secondary" onclick="showToast('Koncept uložen')">
                    <span class="material-icons-outlined">save</span>
                    Uložit koncept
                </button>
                <button class="btn btn-primary" onclick="edFinalize()">
                    <span class="material-icons-outlined">picture_as_pdf</span>
                    Generovat PDF a odeslat
                </button>
            </div>
        </div>
    </div>


    <!-- ============================================ -->
    <!-- POMOCNÉ MODÁLY PRO NÁHLED DOKUMENTŮ -->
    <!-- ============================================ -->
    <div class="modal-overlay" id="zadostModal" onclick="closeModal('zadostModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">description</span>
                    Žádost o povolení stavby
                </div>
                <button class="modal-close" onclick="closeModal('zadostModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">preview</span>
                    <p style="margin-top: 16px; color: #5f6368;">Náhled žádosti o povolení stavby</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('zadostModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Modal: REZA - Informace o elektronické plné moci -->
    <div class="modal-overlay" id="rezaModal" onclick="closeModal('rezaModal', event)">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header" style="padding: 0; border: none;">
                <div class="reza-header" style="width: 100%; border-radius: 8px 8px 0 0;">
                    <div class="reza-logo">
                        <span class="material-icons-outlined">verified_user</span>
                    </div>
                    <div class="reza-header-text">
                        <div class="reza-title">Registr elektronických zastoupení</div>
                        <div class="reza-subtitle">Ověřená elektronická plná moc</div>
                    </div>
                    <div class="reza-verified-badge">
                        <span class="material-icons-outlined">check_circle</span>
                        Platná
                    </div>
                </div>
                <button class="modal-close" onclick="closeModal('rezaModal')" style="position: absolute; top: 12px; right: 12px; background: rgba(255,255,255,0.9);">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="reza-body" id="rezaModalBody">
                <!-- Obsah bude doplněn dynamicky -->
            </div>
            <div class="reza-footer">
                <div class="reza-footer-info">
                    Údaje z <a href="#">REZA - Registr elektronických zastoupení</a>
                </div>
                <button class="btn btn-secondary" onclick="closeModal('rezaModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Modal: Přílohy pro vyhledání plné moci -->
    <div class="modal-overlay" id="prilohyPMModal" onclick="closeModal('prilohyPMModal', event)">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">attach_file</span>
                    Přílohy žádosti
                </div>
                <button class="modal-close" onclick="closeModal('prilohyPMModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div style="padding: 12px 20px; background: #fff3e0; border-bottom: 1px solid #ffe082;">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: #e65100;">
                        <span class="material-icons-outlined" style="font-size: 20px;">info</span>
                        <span>Vyhledejte a zkontrolujte potřebné dokumenty v přílohách žádosti (PDF).</span>
                    </div>
                </div>
                <div style="padding: 16px 20px;">
                    <div class="zadost-prilohy-list" id="prilohyPMList">
                        <div class="zadost-priloha-item attached" style="background: #fff3e0; border: 1px solid #ffe082;">
                            <div class="priloha-icon" style="color: #e65100;">
                                <span class="material-icons-outlined">description</span>
                            </div>
                            <div class="priloha-info">
                                <div class="priloha-name" style="font-weight: 600;">Plná moc — listinná</div>
                                <div class="priloha-status">Přiloženo jako PDF • plna_moc_novak.pdf • 245 KB</div>
                            </div>
                            <button class="priloha-action" style="background: #e65100; color: #fff; border-radius: 4px; padding: 6px 12px; border: none; cursor: pointer;" title="Otevřít ke kontrole">
                                <span class="material-icons-outlined">visibility</span>
                            </button>
                        </div>
                        
                        <div class="zadost-priloha-item attached">
                            <div class="priloha-icon">
                                <span class="material-icons-outlined">description</span>
                            </div>
                            <div class="priloha-info">
                                <div class="priloha-name">Souhlas vlastníka pozemku</div>
                                <div class="priloha-status">Přiloženo jako PDF • souhlas_vlastnika.pdf • 128 KB</div>
                            </div>
                            <button class="priloha-action" title="Otevřít">
                                <span class="material-icons-outlined">visibility</span>
                            </button>
                        </div>
                        
                        <div class="zadost-priloha-item attached">
                            <div class="priloha-icon">
                                <span class="material-icons-outlined">description</span>
                            </div>
                            <div class="priloha-info">
                                <div class="priloha-name">Čestné prohlášení</div>
                                <div class="priloha-status">Přiloženo jako PDF • cestne_prohlaseni.pdf • 89 KB</div>
                            </div>
                            <button class="priloha-action" title="Otevřít">
                                <span class="material-icons-outlined">visibility</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('prilohyPMModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="prilohyModal" onclick="closeModal('prilohyModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">attach_file</span>
                    Přílohy žádosti
                </div>
                <button class="modal-close" onclick="closeModal('prilohyModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">folder_open</span>
                    <p style="margin-top: 16px; color: #5f6368;">Seznam příloh žádosti (12)</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('prilohyModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="eedModal" onclick="closeModal('eedModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">folder</span>
                    Elektronická dokumentace
                </div>
                <button class="modal-close" onclick="closeModal('eedModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">architecture</span>
                    <p style="margin-top: 16px; color: #5f6368;">Projektová dokumentace v EED</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('eedModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="dokladyModal" onclick="closeModal('dokladyModal', event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">fact_check</span>
                    Dokladová část
                </div>
                <button class="modal-close" onclick="closeModal('dokladyModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 40px 24px; text-align: center;">
                    <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6;">checklist</span>
                    <p style="margin-top: 16px; color: #5f6368;">Stanoviska DO a vyjádření správců sítí</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('dokladyModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Modal pro BIM model -->
    <div class="modal-overlay" id="bimModal" onclick="closeModal('bimModal', event)">
        <div class="modal modal-large" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">view_in_ar</span>
                    BIM model
                </div>
                <button class="modal-close" onclick="closeModal('bimModal')">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <!-- BIM info panel -->
                <div style="padding: 16px 24px; background: #f8f9fa; border-bottom: 1px solid #e0e0e0;">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
                        <div>
                            <div style="font-size: 14px; font-weight: 600; color: #202124; margin-bottom: 4px;">Novostavba rodinného domu s garáží</div>
                            <div style="font-size: 12px; color: #5f6368;">IFC model · Verze 3.0 · Nahrán 10. 1. 2026</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">
                                <span class="material-icons-outlined" style="font-size: 16px; margin-right: 4px;">download</span>
                                Stáhnout IFC
                            </button>
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">
                                <span class="material-icons-outlined" style="font-size: 16px; margin-right: 4px;">open_in_new</span>
                                Otevřít v prohlížeči
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- BIM viewer placeholder -->
                <div style="height: 450px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;">
                    <!-- 3D grid simulace -->
                    <div style="position: absolute; inset: 0; opacity: 0.1; background-image: 
                        linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
                        background-size: 40px 40px;"></div>
                    
                    <!-- Model placeholder -->
                    <div style="position: relative; z-index: 1; text-align: center;">
                        <div style="width: 200px; height: 140px; margin: 0 auto 24px; position: relative;">
                            <!-- Jednoduchá 3D ikona domu -->
                            <svg viewBox="0 0 200 140" style="width: 100%; height: 100%;">
                                <!-- Základna -->
                                <path d="M30 100 L100 130 L170 100 L100 70 Z" fill="#4fc3f7" opacity="0.3"/>
                                <!-- Přední stěna -->
                                <path d="M30 100 L30 50 L100 20 L100 70 Z" fill="#29b6f6" opacity="0.7"/>
                                <!-- Boční stěna -->
                                <path d="M100 70 L100 20 L170 50 L170 100 Z" fill="#0288d1" opacity="0.7"/>
                                <!-- Střecha přední -->
                                <path d="M20 50 L100 10 L100 20 L30 50 Z" fill="#ff7043" opacity="0.8"/>
                                <!-- Střecha boční -->
                                <path d="M100 10 L180 50 L170 50 L100 20 Z" fill="#e64a19" opacity="0.8"/>
                                <!-- Okna -->
                                <rect x="45" y="60" width="20" height="25" fill="#81d4fa" opacity="0.9"/>
                                <rect x="120" y="55" width="20" height="25" fill="#4fc3f7" opacity="0.9"/>
                            </svg>
                        </div>
                        <div style="color: #fff; font-size: 16px; font-weight: 500; margin-bottom: 8px;">
                            <span class="material-icons-outlined" style="font-size: 24px; vertical-align: middle; margin-right: 8px;">view_in_ar</span>
                            3D BIM Model
                        </div>
                        <div style="color: rgba(255,255,255,0.6); font-size: 13px;">
                            V ostré verzi by se zde zobrazil interaktivní 3D model stavby
                        </div>
                    </div>
                    
                    <!-- Ovládací prvky simulace -->
                    <div style="position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px;">
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Otočit vlevo">
                            <span class="material-icons-outlined" style="font-size: 18px;">rotate_left</span>
                        </button>
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Přiblížit">
                            <span class="material-icons-outlined" style="font-size: 18px;">zoom_in</span>
                        </button>
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Oddálit">
                            <span class="material-icons-outlined" style="font-size: 18px;">zoom_out</span>
                        </button>
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Otočit vpravo">
                            <span class="material-icons-outlined" style="font-size: 18px;">rotate_right</span>
                        </button>
                        <button style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;" title="Celá obrazovka">
                            <span class="material-icons-outlined" style="font-size: 18px;">fullscreen</span>
                        </button>
                    </div>
                </div>
                
                <!-- BIM metadata -->
                <div style="padding: 20px 24px; border-top: 1px solid #e0e0e0;">
                    <div style="font-size: 13px; font-weight: 600; color: #202124; margin-bottom: 12px;">Informace o modelu</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Formát</div>
                            <div style="font-size: 13px; color: #202124;">IFC 4.0 (Industry Foundation Classes)</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Velikost souboru</div>
                            <div style="font-size: 13px; color: #202124;">24.8 MB</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Software</div>
                            <div style="font-size: 13px; color: #202124;">Autodesk Revit 2024</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Počet elementů</div>
                            <div style="font-size: 13px; color: #202124;">1,247 objektů</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">Zpracoval</div>
                            <div style="font-size: 13px; color: #202124;">Ing. arch. Pavel Projektant</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; margin-bottom: 2px;">LOD (Level of Detail)</div>
                            <div style="font-size: 13px; color: #202124;">LOD 300</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('bimModal')">Zavřít</button>
            </div>
        </div>
    </div>

    <!-- Modal pro editaci podmínek subjektu -->
    <div class="podminky-modal-overlay" id="podminkyModal">
        <div class="podminky-modal">
            <div class="podminky-modal-header">
                <div class="podminky-modal-title">
                    <span class="material-icons-outlined">edit_note</span>
                    <span id="podminkyModalTitle">Podmínky subjektu</span>
                </div>
                <button class="podminky-modal-close" onclick="closePodminkyModal()">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="podminky-modal-body">
                <!-- Info o dokumentu -->
                <div class="podminky-section">
                    <div class="podminky-section-title">Informace o dokladu</div>
                    <div class="dokument-info">
                        <div class="dokument-info-item">
                            <div class="dokument-info-label">Typ dokladu</div>
                            <div class="dokument-info-value" id="podminkyDokTyp">—</div>
                        </div>
                        <div class="dokument-info-item">
                            <div class="dokument-info-label">Číslo jednací</div>
                            <div class="dokument-info-value">
                                <input type="text" id="podminkyDokCj" placeholder="Např. MMHK/349238/2025">
                            </div>
                        </div>
                        <div class="dokument-info-item">
                            <div class="dokument-info-label">Datum vydání</div>
                            <div class="dokument-info-value">
                                <input type="date" id="podminkyDokDatum">
                            </div>
                        </div>
                        <div class="dokument-info-item">
                            <div class="dokument-info-label">Soubor</div>
                            <div class="dokument-info-value" id="podminkyDokSoubor">—</div>
                        </div>
                    </div>
                </div>

                <!-- Výsledek posouzení -->
                <div class="podminky-section">
                    <div class="podminky-section-title">Výsledek posouzení</div>
                    <div class="vysledek-options" id="vysledekOptions">
                        <label class="vysledek-option kladne">
                            <input type="radio" name="vysledekRadio" value="kladne">
                            <div class="vysledek-option-icon">
                                <span class="material-icons-outlined">check_circle</span>
                            </div>
                            <span class="vysledek-option-label">Kladné</span>
                        </label>
                        <label class="vysledek-option s-podminkami">
                            <input type="radio" name="vysledekRadio" value="kladne_s_podminkami">
                            <div class="vysledek-option-icon">
                                <span class="material-icons-outlined">task_alt</span>
                            </div>
                            <span class="vysledek-option-label">Kladné s podmínkami</span>
                        </label>
                        <label class="vysledek-option zaporne">
                            <input type="radio" name="vysledekRadio" value="zaporne">
                            <div class="vysledek-option-icon">
                                <span class="material-icons-outlined">cancel</span>
                            </div>
                            <span class="vysledek-option-label">Záporné</span>
                        </label>
                    </div>
                </div>

                <!-- Seznam podmínek -->
                <div class="podminky-section" id="podminkySectionList" style="display: none;">
                    <div class="podminky-section-title">Podmínky pro rozhodnutí</div>
                    <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                        Zadejte podmínky, které budou součástí rozhodnutí o povolení stavby.
                    </p>
                    <div class="podminky-list" id="podminkyList">
                        <!-- Dynamicky renderováno -->
                    </div>
                    <div class="add-podminka-row">
                        <input type="text" class="add-podminka-input" id="addPodminkaText" placeholder="Přidat novou podmínku..." onkeypress="if(event.key==='Enter') addPodminka()">
                        <button class="btn-add-podminka" onclick="addPodminka()">
                            <span class="material-icons-outlined">add</span>
                            Přidat
                        </button>
                    </div>
                </div>

                <!-- Poznámka úředníka -->
                <div class="podminky-section">
                    <div class="podminky-section-title">Poznámka úředníka</div>
                    <textarea class="poznamka-textarea" id="podminkyPoznamka" placeholder="Interní poznámka k tomuto subjektu..."></textarea>
                </div>
            </div>
            <div class="podminky-modal-footer">
                <button class="btn btn-secondary" onclick="closePodminkyModal()">Zrušit</button>
                <button class="btn btn-primary" onclick="savePodminkyModal()">
                    <span class="material-icons-outlined">check</span>
                    Uložit změny
                </button>
            </div>
        </div>
    </div>

    <!-- Modal pro report dat pro rozhodnutí -->
    <div class="report-modal-overlay" id="reportModal">
        <div class="report-modal">
            <div class="report-modal-header">
                <div class="report-modal-title">
                    <span class="material-icons-outlined">summarize</span>
                    Report dokladové části
                </div>
                <div class="report-modal-actions">
                    <button class="btn-download" onclick="downloadReportHTML()">
                        <span class="material-icons-outlined">download</span>
                        Stáhnout HTML
                    </button>
                    <button class="btn-download" onclick="downloadReportJSON()">
                        <span class="material-icons-outlined">data_object</span>
                        Stáhnout JSON
                    </button>
                    <button class="report-modal-close" onclick="closeReportModal()">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
            </div>
            <div class="report-modal-body">
                <div class="report-content" id="reportContent">
                    <!-- Dynamicky generováno -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pro postoupení řízení -->
    <div class="modal-overlay" id="postoupeniModal" onclick="closeModal('postoupeniModal', event)">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header" style="background: #e8f4fd; border-bottom: 1px solid #c2e0ff;">
                <div class="modal-title" style="display: flex; align-items: center; gap: 10px;">
                    <span class="material-icons-outlined" style="color: #1a73e8;">send</span>
                    Postoupení řízení z důvodu nepříslušnosti
                </div>
                <button class="modal-close" onclick="closeModal('postoupeniModal', event)" style="background: transparent; border: none; cursor: pointer; padding: 8px;">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body" style="padding: 24px;">
                <div style="background: #f8f9fa; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <div style="font-size: 12px; color: #5f6368; margin-bottom: 4px;">Řízení bude postoupeno:</div>
                    <div style="font-size: 16px; font-weight: 500; color: #202124;" id="postoupeniSuNazev">—</div>
                    <div style="font-size: 13px; color: #5f6368; margin-top: 4px;" id="postoupeniSuAdresa">—</div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 13px; font-weight: 500; color: #202124; margin-bottom: 8px;">Zdůvodnění nepříslušnosti:</div>
                    <div style="font-size: 13px; color: #5f6368; background: #fff; border: 1px solid #e8eaed; border-radius: 6px; padding: 12px; line-height: 1.5;" id="postoupeniZduvodneni">—</div>
                </div>
                
                <div style="background: #fef7e0; border: 1px solid #fdd835; border-radius: 8px; padding: 16px; display: flex; gap: 12px;">
                    <span class="material-icons-outlined" style="color: #b06000; flex-shrink: 0;">info</span>
                    <div>
                        <div style="font-size: 13px; font-weight: 500; color: #202124; margin-bottom: 4px;">Co se stane po postoupení:</div>
                        <ul style="font-size: 12px; color: #5f6368; margin: 0; padding-left: 16px; line-height: 1.6;">
                            <li>Bude vygenerován dokument <strong>Postoupení řízení z důvodu nepříslušnosti</strong></li>
                            <li>Řízení bude interně předáno příslušnému stavebnímu úřadu prostřednictvím ISSŘ</li>
                            <li>Žadatel bude vyrozuměn o postoupení řízení</li>
                            <li>Řízení bude ve Vašem systému označeno jako postoupené</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding: 16px 24px; border-top: 1px solid #e8eaed; display: flex; justify-content: flex-end; gap: 10px; background: #f8f9fa;">
                <button class="btn btn-secondary" onclick="closeModal('postoupeniModal', event)">
                    Zrušit
                </button>
                <button class="btn btn-primary" onclick="confirmPostoupeni()" style="background: #1a73e8;">
                    <span class="material-icons-outlined">send</span>
                    Potvrdit postoupení
                </button>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Globální stav nedostatků - MUSÍ být definován před ostatními funkcemi
        const globalIssues = {
            vyzva: [], // Výzva k doplnění + přerušení
            odlozeni: [], // Odložení žádosti
            postoupeni: [], // Postoupení
            staveni: [], // Stavění lhůty
            zamitnuti: [] // Zamítnutí
        };
        
        // Funkce pro práci s globalIssues
        function addGlobalIssue(type, issue) {
            const id = 'gi-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            globalIssues[type].push({
                id: id,
                text: issue.text,
                source: issue.source || 'manual',
                controlName: issue.controlName || '',
                resolved: false,
                timestamp: new Date().toISOString()
            });
            updateGlobalIssuesBadge();
            return id;
        }
        
        function removeGlobalIssue(type, id) {
            globalIssues[type] = globalIssues[type].filter(i => i.id !== id);
            updateGlobalIssuesBadge();
            renderGlobalIssues();
        }
        
        function resolveGlobalIssue(type, id) {
            const issue = globalIssues[type].find(i => i.id === id);
            if (issue) {
                issue.resolved = !issue.resolved;
                updateGlobalIssuesBadge();
                renderGlobalIssues();
            }
        }
        
        function updateGlobalIssuesBadge() {
            const total = Object.values(globalIssues).reduce((sum, arr) => 
                sum + arr.filter(i => !i.resolved).length, 0);
            
            const badge = document.getElementById('nedostatkyBadge');
            const btn = document.getElementById('btnNedostatky');
            
            if (badge && btn) {
                badge.textContent = total;
                
                if (total > 0) {
                    btn.classList.add('has-issues');
                    badge.style.display = '';
                } else {
                    btn.classList.remove('has-issues');
                    badge.style.display = 'none';
                }
            }
        }
        
        function renderGlobalIssues() {
            const types = [
                { key: 'vyzva', listId: 'listVyzva', badgeId: 'badgeVyzva', emptyText: 'Žádné nedostatky', iconClass: 'warning' },
                { key: 'odlozeni', listId: 'listOdlozeni', badgeId: 'badgeOdlozeni', emptyText: 'Žádné závažné vady', iconClass: 'error' },
                { key: 'postoupeni', listId: 'listPostoupeni', badgeId: 'badgePostoupeni', emptyText: 'SÚ je příslušný', iconClass: 'warning' },
                { key: 'staveni', listId: 'listStaveni', badgeId: 'badgeStaveni', emptyText: 'Všechna stanoviska jsou k dispozici', iconClass: 'warning' },
                { key: 'zamitnuti', listId: 'listZamitnuti', badgeId: 'badgeZamitnuti', emptyText: 'Žádné důvody pro zamítnutí', iconClass: 'error' }
            ];
            
            types.forEach(t => {
                const list = document.getElementById(t.listId);
                const badge = document.getElementById(t.badgeId);
                if (!list || !badge) return;
                
                const issues = globalIssues[t.key];
                const unresolvedCount = issues.filter(i => !i.resolved).length;
                
                badge.textContent = unresolvedCount;
                
                if (issues.length === 0) {
                    list.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                            <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                            ${t.emptyText}
                        </div>
                    `;
                } else {
                    list.innerHTML = issues.map(issue => `
                        <div class="global-issue-item ${issue.resolved ? 'resolved' : ''}">
                            <div class="global-issue-icon ${issue.resolved ? 'resolved' : t.iconClass}">
                                <span class="material-icons-outlined">${issue.resolved ? 'check' : 'warning'}</span>
                            </div>
                            <div class="global-issue-content">
                                <div class="global-issue-text">${issue.text}</div>
                                <div class="global-issue-meta">
                                    ${issue.controlName ? issue.controlName + ' • ' : ''}
                                    ${issue.source === 'auto' ? 'Automaticky zjištěno' : 'Ručně přidáno'}
                                </div>
                            </div>
                            <div class="global-issue-actions">
                                <button class="global-issue-btn resolve" onclick="resolveGlobalIssue('${t.key}', '${issue.id}')" title="${issue.resolved ? 'Označit jako nevyřešené' : 'Označit jako vyřešené'}">
                                    <span class="material-icons-outlined">${issue.resolved ? 'undo' : 'check'}</span>
                                </button>
                                <button class="global-issue-btn" onclick="removeGlobalIssue('${t.key}', '${issue.id}')" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            });
        }

        // State management
        const controls = {
            prislusnost: { done: false, depends: [], result: 'ok' },
            zadost: { done: false, depends: ['prislusnost'], result: 'ok' },
            dokumentace: { done: false, depends: ['prislusnost', 'zadost'], result: 'ok' },
            pozemky: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace'], result: 'ok' },
            up: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace', 'pozemky'], result: 'ok' },
            identifikace: { done: false, depends: ['pozemky'], result: 'ok' },
            ucastnici: { done: false, depends: ['zadost'], result: 'ok' },
            zrychlene: { done: false, depends: ['prislusnost', 'zadost', 'dokumentace', 'pozemky', 'up', 'identifikace', 'ucastnici'], result: 'ok' }
        };

        // Control overlay functions
        function openControl(controlId) {
            document.getElementById(controlId).classList.add('open');
            document.body.style.overflow = 'hidden';
            
            // Inicializace specifických kontrol
            if (controlId === 'controlIdentifikace') {
                setTimeout(initIdentifikaceMatrix, 100);
            }
            
            // Pro kontrolu žádosti - nastavit správný režim podle typu podání
            if (controlId === 'controlZadost') {
                initZadostControlMode();
            }
            
            // Pro kontrolu příslušnosti - nastavit viewer podle typu podání
            if (controlId === 'controlPrislusnost') {
                initControlViewer('controlPrislusnost');
            }
            
            // Pro kontrolu ÚPD - inicializovat image viewery a reset stavu
            if (controlId === 'controlUP') {
                // Reset stavu pokud kontrola ještě není hotová
                if (!controls.up.done) {
                    resetUPDControl();
                }
                
                setTimeout(() => {
                    initViewer('situace');
                    initViewer('upd');
                }, 100);
            }
        }
        
        // Reset stavu kontroly ÚPD
        function resetUPDControl() {
            // Reset stavu - modifikujeme vlastnosti, ne celý objekt (protože je const)
            updState.urp.checked = false;
            updState.urp.soulad = null;
            updState.urp.text = '';
            
            updState.zur.checked = false;
            updState.zur.soulad = null;
            updState.zur.text = '';
            
            updState.up.checked = false;
            updState.up.soulad = null;
            updState.up.text = '';
            updState.up.exists = null;
            
            // Reset UI
            ['Urp', 'Zur', 'Up'].forEach(step => {
                const checkItem = document.getElementById('check' + step);
                if (checkItem) {
                    checkItem.classList.remove('done-ok', 'done-error');
                }
                
                const status = document.getElementById('status' + step);
                if (status) {
                    status.textContent = '';
                    status.classList.remove('ok', 'error');
                }
                
                const noteInput = document.getElementById('note' + step);
                if (noteInput) {
                    noteInput.value = '';
                    noteInput.style.display = 'none';
                }
                
                const indicator = document.getElementById('indicator' + step);
                if (indicator) {
                    indicator.classList.remove('visible');
                }
            });
            
            // Reset tlačítek
            document.querySelectorAll('#controlUP .upd-btn-yes, #controlUP .upd-btn-no').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Skrýt sekce pro ÚP
            const souladSection = document.getElementById('upSouladSection');
            if (souladSection) souladSection.style.display = 'none';
            
            const noUpInfo = document.getElementById('noUpInfo');
            if (noUpInfo) noUpInfo.style.display = 'none';
            
            // Aktualizovat tlačítko
            updateUPDState();
        }

        function closeControl(controlId) {
            document.getElementById(controlId).classList.remove('open');
            document.body.style.overflow = '';
        }

        // Modal functions (pro náhled dokumentů z headeru)
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId, event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById(modalId).classList.remove('open');
            document.body.style.overflow = '';
        }
        
        // Otevření REZA modalu s informacemi o elektronickém zastoupení
        function openRezaModal(zastupceData) {
            const body = document.getElementById('rezaModalBody');
            
            // Typ zastoupení
            const typText = zastupceData.typZastoupeni === 'plna-moc' ? 'Plná moc' : 
                           (zastupceData.typZastoupeni === 'povereni' ? 'Pověření' : 'Statutární zástupce');
            
            body.innerHTML = `
                <div class="reza-info-section">
                    <div class="reza-info-title">Zmocnitel (zastoupený)</div>
                    <div class="reza-info-grid">
                        <div class="reza-info-item full">
                            <div class="reza-info-label">Jméno / Název</div>
                            <div class="reza-info-value">${zastupceData.zmocnitel || 'Jan Novák'}</div>
                        </div>
                        <div class="reza-info-item">
                            <div class="reza-info-label">Datum narození / IČO</div>
                            <div class="reza-info-value">${zastupceData.zmocnitelId || '15. 3. 1985'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="reza-info-section">
                    <div class="reza-info-title">Zmocněnec (zástupce)</div>
                    <div class="reza-info-grid">
                        <div class="reza-info-item full">
                            <div class="reza-info-label">Jméno / Název</div>
                            <div class="reza-info-value">${zastupceData.jmeno || ''} ${zastupceData.prijmeni || zastupceData.nazev || ''}</div>
                        </div>
                        <div class="reza-info-item">
                            <div class="reza-info-label">${zastupceData.ico ? 'IČO' : 'Datum narození'}</div>
                            <div class="reza-info-value">${zastupceData.ico || zastupceData.datumNarozeni || '—'}</div>
                        </div>
                        <div class="reza-info-item">
                            <div class="reza-info-label">Datová schránka</div>
                            <div class="reza-info-value">${zastupceData.ds || '—'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="reza-info-section">
                    <div class="reza-info-title">Údaje o zastoupení</div>
                    <div class="reza-info-grid">
                        <div class="reza-info-item">
                            <div class="reza-info-label">Typ zastoupení</div>
                            <div class="reza-info-value">${typText}</div>
                        </div>
                        <div class="reza-info-item">
                            <div class="reza-info-label">Rozsah</div>
                            <div class="reza-info-value">${zastupceData.rozsah || 'Úplná plná moc'}</div>
                        </div>
                        <div class="reza-info-item full">
                            <div class="reza-info-label">Platnost</div>
                            <div class="reza-info-value">
                                <span class="reza-validity">
                                    <span class="material-icons-outlined">check_circle</span>
                                    ${zastupceData.platnostPM || 'Platná bez omezení'}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 16px; padding: 12px; background: #e8f5e9; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                    <span class="material-icons-outlined" style="color: #2e7d32; font-size: 24px;">verified</span>
                    <div>
                        <div style="font-size: 13px; font-weight: 600; color: #1b5e20;">Zastoupení ověřeno v REZA</div>
                        <div style="font-size: 11px; color: #388e3c;">Portál stavebníka ověřil platnost zastoupení při podání žádosti</div>
                    </div>
                </div>
            `;
            
            openModal('rezaModal');
        }
        
        // Otevření modalu s přílohami pro vyhledání plné moci
        function openPrilohyPMModal() {
            openModal('prilohyPMModal');
        }
        
        // Alias pro otevření příloh z tlačítka v sekci Přílohy
        function openPrilohyModal() {
            openModal('prilohyPMModal');
        }
        
        // Scrollování na sekci Přílohy v Kontrole žádosti
        function scrollToPrilohy() {
            const prilohySection = document.getElementById('dataSectionPrilohyZadosti');
            if (prilohySection) {
                prilohySection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Zvýraznění sekce
                prilohySection.style.boxShadow = '0 0 0 3px #1a73e8';
                setTimeout(() => {
                    prilohySection.style.boxShadow = '';
                }, 2000);
            }
        }
        
        // Otevření modalu pro úpravu uspořádání kontrol
        function openCustomizeControlsModal() {
            // Vytvoření jednoduchého modalu s popisem
            const modal = document.createElement('div');
            modal.className = 'modal-overlay open';
            modal.id = 'customizeControlsModal';
            modal.onclick = function(e) { if (e.target === modal) closeCustomizeControlsModal(); };
            
            modal.innerHTML = `
                <div class="modal" onclick="event.stopPropagation()" style="max-width: 500px;">
                    <div class="modal-header">
                        <div class="modal-title">
                            <span class="material-icons-outlined">tune</span>
                            Uspořádání kontrol
                        </div>
                        <button class="modal-close" onclick="closeCustomizeControlsModal()">
                            <span class="material-icons-outlined">close</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div style="background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 8px; padding: 32px 24px; text-align: center;">
                            <span class="material-icons-outlined" style="font-size: 48px; color: #9aa0a6; margin-bottom: 16px; display: block;">drag_indicator</span>
                            <p style="font-size: 14px; color: #3c4043; margin: 0 0 12px 0; font-weight: 500;">V ostré verzi by zde bylo možné:</p>
                            <ul style="text-align: left; font-size: 13px; color: #5f6368; margin: 0; padding-left: 24px; line-height: 1.8;">
                                <li>Přetahováním změnit pořadí kontrolních karet</li>
                                <li>Skrýt méně důležité kontroly</li>
                                <li>Seskupit související kontroly do záložek</li>
                                <li>Uložit vlastní uspořádání jako výchozí</li>
                            </ul>
                            <p style="font-size: 12px; color: #80868b; margin: 16px 0 0 0;">
                                <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle;">info</span>
                                Závislosti a návaznosti mezi kontrolami zůstanou zachovány.
                            </p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeCustomizeControlsModal()">Zavřít</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }
        
        function closeCustomizeControlsModal() {
            const modal = document.getElementById('customizeControlsModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }
        
        // Aktualizace názvu stavby v hlavičce
        function updateNazevStavby() {
            const input = document.getElementById('nazevStavby');
            const header = document.getElementById('caseTitleHeader');
            if (input && header) {
                header.textContent = input.value || 'Bez názvu';
            }
        }

        // Popis stavby - funkce pro rozbalení/sbalení editoru
        let originalPopisText = '';
        
        function expandPopisStavby() {
            const collapsed = document.getElementById('popisStavbyCollapsed');
            const editor = document.getElementById('popisStavbyEditor');
            const textarea = document.getElementById('popisStavbyTextarea');
            const expandBtn = collapsed ? collapsed.querySelector('.popis-expand-btn .material-icons-outlined') : null;
            
            // Uložit původní text pro případ zrušení
            originalPopisText = textarea.value;
            
            // Skrýt sbalený stav, zobrazit editor
            if (collapsed) collapsed.style.display = 'none';
            if (editor) editor.style.display = 'block';
            
            // Fokus na textarea
            if (textarea) {
                textarea.focus();
                textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            }
        }
        
        function collapsePopisStavby() {
            const collapsed = document.getElementById('popisStavbyCollapsed');
            const editor = document.getElementById('popisStavbyEditor');
            const textarea = document.getElementById('popisStavbyTextarea');
            const statusBadge = document.getElementById('popisStatusBadge');
            
            // Aktualizovat badge podle obsahu
            if (statusBadge && textarea) {
                const text = textarea.value.trim();
                if (text && text.length > 20) {
                    statusBadge.style.display = 'inline';
                } else {
                    statusBadge.style.display = 'none';
                }
            }
            
            // Skrýt editor, zobrazit sbalený stav
            if (editor) editor.style.display = 'none';
            if (collapsed) collapsed.style.display = 'flex';
        }
        
        function savePopisStavby() {
            collapsePopisStavby();
            
            // Vizuální potvrzení uložení
            const collapsed = document.getElementById('popisStavbyCollapsed');
            if (collapsed) {
                collapsed.style.transition = 'background 0.3s';
                collapsed.style.background = '#e6f4ea';
                setTimeout(() => {
                    collapsed.style.background = '';
                }, 1000);
            }
        }
        
        function cancelPopisStavby() {
            const textarea = document.getElementById('popisStavbyTextarea');
            if (textarea) {
                textarea.value = originalPopisText;
            }
            collapsePopisStavby();
        }
        
        function loadPopisFromAI() {
            const btn = document.getElementById('popisAiBtn');
            const textarea = document.getElementById('popisStavbyTextarea');
            const textSpan = btn.querySelector('.popis-ai-text');
            const loadingSpan = btn.querySelector('.popis-ai-loading');
            
            // Zobrazit loading stav
            btn.disabled = true;
            if (textSpan) textSpan.style.display = 'none';
            if (loadingSpan) loadingSpan.style.display = 'inline-flex';
            
            // Simulace AI načítání (2.5 sekundy)
            setTimeout(() => {
                // AI vygenerovaný popis ze souhrnné technické zprávy
                const aiPopis = `Předmětem stavebního záměru je novostavba rodinného domu s garáží a napojení na technickou infrastrukturu na pozemku parc. č. 1234/5 v katastrálním území Horní Lhota, obec Dolní Lhota.

SO 01 – Rodinný dům:
Jedná se o dvoupodlažní nepodsklepený objekt (1.NP + obytné podkroví) obdélníkového půdorysu o rozměrech 12,0 × 9,5 m. Konstrukční systém zděný z keramických tvárnic, zastřešení sedlovou střechou se sklonem 35° s krytinou z betonových tašek. Zastavěná plocha 114 m², obestavěný prostor 687 m³, užitná plocha 168 m².

V 1.NP je navrženo: zádveří, chodba, technická místnost, WC, obývací pokoj s kuchyňským koutem (45 m²) a garáž pro jeden osobní automobil.
V podkroví jsou navrženy: 3 ložnice, koupelna, šatna a chodba.

Vytápění objektu bude zajištěno tepelným čerpadlem vzduch-voda s podlahovým topením. Ohřev TUV zásobníkovým ohřívačem v kombinaci s tepelným čerpadlem.

SO 02 – Zpevněné plochy:
Příjezdová komunikace a chodník ze zámkové dlažby, celková plocha 85 m².

SO 03 – Přípojka vodovodu:
PE potrubí DN 32, délka 8,5 m, napojení na vodovodní řad v ulici Pod Lipami.

SO 04 – Přípojka splaškové kanalizace:
PVC potrubí DN 150, délka 12,0 m, napojení na veřejnou kanalizaci.

SO 05 – Přípojka elektro:
Kabelová přípojka NN napojená na distribuční síť ČEZ Distribuce, a.s.

SO 06 – Oplocení:
Oplocení pozemku plotem výšky 1,8 m s podezdívkou.`;
                
                if (textarea) {
                    textarea.value = aiPopis;
                }
                
                // Vrátit button do původního stavu
                btn.disabled = false;
                if (textSpan) textSpan.style.display = 'inline';
                if (loadingSpan) loadingSpan.style.display = 'none';
                
                // Změnit text buttonu
                if (textSpan) textSpan.textContent = 'Načteno z dokumentace';
                btn.style.background = '#e6f4ea';
                btn.style.borderColor = '#34a853';
                btn.style.color = '#137333';
                
            }, 2500);
        }

        // Escape key closes overlays
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.control-overlay.open').forEach(function(overlay) {
                    overlay.classList.remove('open');
                });
                document.querySelectorAll('.modal-overlay.open').forEach(function(modal) {
                    modal.classList.remove('open');
                });
                document.body.style.overflow = '';
            }
        });

        // Otevření prohlížeče v novém okně (simulace druhého monitoru)
        function openViewerExternal(controlType) {
            const controlNames = {
                'prislusnost': 'Kontrola příslušnosti',
                'kontrolazadosti': 'Kontrola žádosti',
                'pozemky': 'Pozemky',
                'dokumentace': 'Kontrola dokumentace',
                'identifikace': 'Identifikace subjektů',
                'up': 'Soulad s ÚPD',
                'ucastnici': 'Osoby',
                'zrychlene': 'Zrychlené řízení'
            };
            
            const controlName = controlNames[controlType] || controlType;
            
            // Otevřít nové okno s náhledem
            const newWindow = window.open('', '_blank', 'width=900,height=700,menubar=no,toolbar=no,location=no,status=no');
            
            if (newWindow) {
                newWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Prohlížeč dokumentů - ${controlName}</title>
                        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
                        <style>
                            * { margin: 0; padding: 0; box-sizing: border-box; }
                            body { 
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                background: #f5f5f5;
                            }
                            .header {
                                background: #004289;
                                color: #fff;
                                padding: 16px 24px;
                                display: flex;
                                align-items: center;
                                gap: 12px;
                            }
                            .header h1 {
                                font-size: 16px;
                                font-weight: 500;
                            }
                            .header .material-icons-outlined {
                                font-size: 24px;
                            }
                            .tabs {
                                background: #fff;
                                padding: 12px 16px;
                                border-bottom: 1px solid #e0e0e0;
                                display: flex;
                                gap: 8px;
                            }
                            .tab {
                                display: inline-flex;
                                align-items: center;
                                gap: 6px;
                                padding: 8px 14px;
                                background: #f5f5f5;
                                border: 1px solid #e0e0e0;
                                border-radius: 6px;
                                font-size: 13px;
                                color: #5f6368;
                                cursor: pointer;
                            }
                            .tab:hover {
                                background: #e8f1fa;
                                border-color: #004289;
                                color: #004289;
                            }
                            .tab.active {
                                background: #004289;
                                border-color: #004289;
                                color: #fff;
                            }
                            .content {
                                flex: 1;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                text-align: center;
                                padding: 60px 40px;
                                min-height: calc(100vh - 120px);
                            }
                            .placeholder {
                                color: #5f6368;
                            }
                            .placeholder .material-icons-outlined {
                                font-size: 64px;
                                color: #9aa0a6;
                                margin-bottom: 16px;
                            }
                            .placeholder h2 {
                                font-size: 18px;
                                font-weight: 500;
                                color: #202124;
                                margin-bottom: 8px;
                            }
                            .placeholder p {
                                font-size: 13px;
                                color: #5f6368;
                            }
                            .info-badge {
                                display: inline-flex;
                                align-items: center;
                                gap: 6px;
                                margin-top: 20px;
                                padding: 8px 16px;
                                background: #e8f4fd;
                                border-radius: 20px;
                                font-size: 12px;
                                color: #1a73e8;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <span class="material-icons-outlined">monitor</span>
                            <h1>Prohlížeč dokumentů — ${controlName}</h1>
                        </div>
                        <div class="tabs">
                            <button class="tab active">
                                <span class="material-icons-outlined">description</span>
                                Žádost
                            </button>
                            <button class="tab">
                                <span class="material-icons-outlined">attach_file</span>
                                Přílohy
                            </button>
                            <button class="tab">
                                <span class="material-icons-outlined">folder</span>
                                Dokumentace
                            </button>
                        </div>
                        <div class="content">
                            <div class="placeholder">
                                <span class="material-icons-outlined">description</span>
                                <h2>Žádost o povolení stavby</h2>
                                <p>V produkční verzi by se zde zobrazil náhled dokumentu</p>
                                <div class="info-badge">
                                    <span class="material-icons-outlined" style="font-size: 16px;">desktop_windows</span>
                                    Samostatné okno pro druhý monitor
                                </div>
                            </div>
                        </div>
                    </body>
                    </html>
                `);
                newWindow.document.close();
            } else {
                alert('Prohlížeč zablokoval otevření nového okna. Povolte prosím vyskakovací okna pro tuto stránku.');
            }
        }

        // Viewer tab switching
        function switchViewerTab(button, controlType, docType) {
            // Update active tab
            const tabs = button.parentElement.querySelectorAll('.viewer-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            button.classList.add('active');

            // Update viewer content
            const viewer = document.getElementById('viewer-' + controlType);
            const docConfig = {
                zadost: { icon: 'description', title: 'Žádost o povolení stavby', desc: 'Formulář žádosti s údaji o stavebníkovi a záměru' },
                prilohy: { icon: 'attach_file', title: 'Přílohy žádosti (12)', desc: 'Plné moci, souhlasy vlastníků, další dokumenty' },
                dokumentace: { icon: 'architecture', title: 'Elektronická dokumentace', desc: 'Projektová dokumentace v evidenci EED' },
                eed: { icon: 'architecture', title: 'Elektronická dokumentace', desc: 'Projektová dokumentace v evidenci EED' },
                doklady: { icon: 'checklist', title: 'Dokladová část', desc: 'Stanoviska DO a vyjádření správců sítí' },
                dokladova: { icon: 'checklist', title: 'Dokladová část', desc: 'Stanoviska DO a vyjádření správců sítí' },
                kn: { icon: 'terrain', title: 'Katastr nemovitostí', desc: 'Informace o vlastnících pozemků a sousedech' },
                uplan: { icon: 'map', title: 'Územní plán', desc: 'Platný územní plán obce s regulativy' },
                mapa: { icon: 'map', title: 'Mapa parcel', desc: 'Vizuální zobrazení pozemků záměru a sousedů' }
            };

            const config = docConfig[docType] || docConfig.zadost;
            viewer.innerHTML = `
                <span class="material-icons-outlined">${config.icon}</span>
                <div class="viewer-placeholder-title">${config.title}</div>
                <div class="viewer-placeholder-text">${config.desc}</div>
            `;
        }

        // Option selection with visual feedback
        function selectOption(element, isNegative = false) {
            const container = element.closest('.control-section');
            const options = container.querySelectorAll('.control-option');
            
            options.forEach(opt => {
                opt.classList.remove('selected', 'negative');
            });
            
            element.classList.add('selected');
            if (isNegative) {
                element.classList.add('negative');
            }
        }

        // ==========================================
        // POZEMKY A SOUSEDÉ
        // ==========================================
        // ==========================================
        // POZEMKY A SOUSEDÉ - kompletní logika
        // ==========================================
        
        let pozemkyState = {
            method: 'auto',
            viewModeZameru: 'chips',  // 'chips', 'list' nebo 'grouped'
            viewModeSousedni: 'chips',
            sortZameru: { field: null, asc: true },  // řazení pozemků záměru
            sortSousedni: { field: null, asc: true }, // řazení sousedních
            pozemkyZameru: [
                { cislo: 'st. 142', katastr: 'Radonice', kod: '747076', plocha: '560 m²', typ: 'zastavena' },
                { cislo: '248/3', katastr: 'Radonice', kod: '747076', plocha: '1 240 m²', typ: 'pozemkova' },
                { cislo: '248/4', katastr: 'Radonice', kod: '747076', plocha: '320 m²', typ: 'pozemkova' },
                { cislo: 'st. 143', katastr: 'Radonice', kod: '747076', plocha: '180 m²', typ: 'zastavena' },
                { cislo: '251/1', katastr: 'Radonice', kod: '747076', plocha: '890 m²', typ: 'pozemkova' },
                { cislo: '1024/1', katastr: 'Kunratice', kod: '728390', plocha: '1 850 m²', typ: 'pozemkova' },
                { cislo: '1024/2', katastr: 'Kunratice', kod: '728390', plocha: '620 m²', typ: 'pozemkova' },
                { cislo: 'st. 512', katastr: 'Kunratice', kod: '728390', plocha: '145 m²', typ: 'zastavena' }
            ],
            sousedniParcely: [
                { cislo: '247/1', katastr: 'Radonice', kod: '747076', plocha: '1 120 m²' },
                { cislo: '247/2', katastr: 'Radonice', kod: '747076', plocha: '450 m²' },
                { cislo: '249', katastr: 'Radonice', kod: '747076', plocha: '2 340 m²' },
                { cislo: 'st. 140', katastr: 'Radonice', kod: '747076', plocha: '210 m²' },
                { cislo: 'st. 141', katastr: 'Radonice', kod: '747076', plocha: '185 m²' },
                { cislo: '250/1', katastr: 'Radonice', kod: '747076', plocha: '670 m²' },
                { cislo: '250/2', katastr: 'Radonice', kod: '747076', plocha: '380 m²' },
                { cislo: '252', katastr: 'Radonice', kod: '747076', plocha: '1 560 m²' },
                { cislo: '246/3', katastr: 'Radonice', kod: '747076', plocha: '920 m²' },
                { cislo: 'st. 139', katastr: 'Radonice', kod: '747076', plocha: '240 m²' },
                { cislo: '253/1', katastr: 'Radonice', kod: '747076', plocha: '780 m²' },
                { cislo: '253/2', katastr: 'Radonice', kod: '747076', plocha: '415 m²' },
                { cislo: '1023/1', katastr: 'Kunratice', kod: '728390', plocha: '2 100 m²' },
                { cislo: '1023/2', katastr: 'Kunratice', kod: '728390', plocha: '980 m²' },
                { cislo: '1025', katastr: 'Kunratice', kod: '728390', plocha: '1 450 m²' },
                { cislo: 'st. 510', katastr: 'Kunratice', kod: '728390', plocha: '220 m²' },
                { cislo: 'st. 511', katastr: 'Kunratice', kod: '728390', plocha: '195 m²' },
                { cislo: '512/1', katastr: 'Šeberov', kod: '746011', plocha: '3 200 m²' },
                { cislo: '512/2', katastr: 'Šeberov', kod: '746011', plocha: '1 100 m²' },
                { cislo: 'st. 89', katastr: 'Šeberov', kod: '746011', plocha: '280 m²' }
            ],
            knVerified: false,
            owners: []
        };
        
        // Funkce pro přepínání zobrazení pozemků
        function setPozemkyView(type, mode) {
            if (type === 'zameru') {
                pozemkyState.viewModeZameru = mode;
                // Aktualizace tlačítek
                const toggle = document.getElementById('pozemkyZameruToggle');
                toggle.querySelectorAll('.pozemky-view-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
                });
                renderPozemkyZameru();
            } else if (type === 'sousedni') {
                pozemkyState.viewModeSousedni = mode;
                // Aktualizace tlačítek
                const toggle = document.getElementById('sousedniToggle');
                toggle.querySelectorAll('.pozemky-view-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.getAttribute('onclick').includes(mode));
                });
                renderSousedniParcely();
            }
        }
        
        // Funkce pro řazení pozemků
        function sortPozemky(type, field) {
            const sortState = type === 'zameru' ? pozemkyState.sortZameru : pozemkyState.sortSousedni;
            
            // Přepnout směr řazení pokud klikáme na stejné pole
            if (sortState.field === field) {
                sortState.asc = !sortState.asc;
            } else {
                sortState.field = field;
                sortState.asc = true;
            }
            
            // Seřadit data
            const data = type === 'zameru' ? pozemkyState.pozemkyZameru : pozemkyState.sousedniParcely;
            
            data.sort((a, b) => {
                let valA = a[field];
                let valB = b[field];
                
                // Speciální řazení pro číslo parcely
                if (field === 'cislo') {
                    valA = parseParcela(valA);
                    valB = parseParcela(valB);
                } else {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }
                
                let result = 0;
                if (typeof valA === 'object') {
                    // Porovnání objektů z parseParcela
                    if (valA.isStavebni !== valB.isStavebni) {
                        result = valA.isStavebni ? -1 : 1;
                    } else if (valA.main !== valB.main) {
                        result = valA.main - valB.main;
                    } else {
                        result = valA.sub - valB.sub;
                    }
                } else {
                    result = valA.localeCompare(valB, 'cs');
                }
                
                return sortState.asc ? result : -result;
            });
            
            // Překreslit
            if (type === 'zameru') {
                renderPozemkyZameru();
            } else {
                renderSousedniParcely();
            }
        }
        
        // Pomocná funkce pro parsování čísla parcely
        function parseParcela(cislo) {
            const isStavebni = cislo.toLowerCase().startsWith('st');
            const cleanNum = cislo.replace(/^st\.?\s*/i, '').trim();
            const parts = cleanNum.split('/');
            return {
                isStavebni: isStavebni,
                main: parseInt(parts[0]) || 0,
                sub: parseInt(parts[1]) || 0
            };
        }

        // Inicializace - renderovat pozemky záměru při načtení
        document.addEventListener('DOMContentLoaded', function() {
            renderPozemkyZameru();
            renderSousedniParcely();
            
            // Inicializace badge pro popis stavby
            const textarea = document.getElementById('popisStavbyTextarea');
            const statusBadge = document.getElementById('popisStatusBadge');
            if (textarea && statusBadge && textarea.value.trim().length > 20) {
                statusBadge.style.display = 'inline';
            }
        });

        // ==========================================
        // SESKUPENÉ ZOBRAZENÍ POZEMKŮ PODLE K.Ú.
        // ==========================================
        
        // Generuje HTML pro seskupené zobrazení pozemků
        function renderGroupedPozemky(pozemky, type) {
            // Seskupit pozemky podle katastrálního území
            const grouped = {};
            pozemky.forEach((p, index) => {
                const key = `${p.katastr}|${p.kod}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        katastr: p.katastr,
                        kod: p.kod,
                        pozemky: []
                    };
                }
                grouped[key].pozemky.push({ ...p, originalIndex: index });
            });
            
            // Získat seznam katastrálních území pro filtr
            const kuList = Object.values(grouped).map(g => ({ katastr: g.katastr, kod: g.kod }));
            
            let html = `<div class="pozemky-grouped-container" data-type="${type}">`;
            
            // Vyhledávací panel
            html += `
                <div class="pozemky-grouped-search">
                    <div class="pozemky-search-field">
                        <span class="material-icons-outlined">search</span>
                        <input type="text" class="pozemky-search-input" 
                            id="pozemkySearch_${type}" 
                            placeholder="Vyhledat parcelu (např. 1234/5)..." 
                            oninput="filterGroupedPozemky('${type}')">
                    </div>
                    <select class="pozemky-filter-select" id="pozemkyFilter_${type}" onchange="filterGroupedPozemky('${type}')">
                        <option value="">Všechna k.ú. (${kuList.length})</option>
                        ${kuList.map(ku => `<option value="${ku.kod}">${ku.katastr} [${ku.kod}]</option>`).join('')}
                    </select>
                </div>
            `;
            
            // Skupiny k.ú.
            Object.entries(grouped).forEach(([key, group], groupIndex) => {
                html += `
                    <div class="pozemky-ku-group" data-ku="${group.kod}" id="kuGroup_${type}_${group.kod}">
                        <div class="pozemky-ku-header" onclick="toggleKuGroup('${type}', '${group.kod}')">
                            <div class="pozemky-ku-expand">
                                <span class="material-icons-outlined">chevron_right</span>
                            </div>
                            <div class="pozemky-ku-info">
                                <span class="pozemky-ku-name">${group.katastr}</span>
                                <span class="pozemky-ku-code">[${group.kod}]</span>
                            </div>
                            <span class="pozemky-ku-count">${group.pozemky.length}</span>
                        </div>
                        <div class="pozemky-ku-content">
                            <div class="pozemky-ku-list">
                `;
                
                // Seřadit pozemky ve skupině
                group.pozemky.sort((a, b) => {
                    const pa = parseParcela(a.cislo);
                    const pb = parseParcela(b.cislo);
                    if (pa.isStavebni !== pb.isStavebni) return pa.isStavebni ? -1 : 1;
                    if (pa.main !== pb.main) return pa.main - pb.main;
                    return pa.sub - pb.sub;
                });
                
                group.pozemky.forEach(p => {
                    const icon = p.typ === 'zastavena' || p.cislo.toLowerCase().startsWith('st') ? 'crop_square' : 'grass';
                    const rowClass = type === 'zameru' ? 'zamer' : 'soused';
                    const removeFunc = type === 'zameru' ? 'removePozemekZameru' : 'removeSousedni';
                    
                    html += `
                        <div class="pozemky-ku-row ${rowClass}" data-parcela="${p.cislo.toLowerCase()}">
                            <span class="material-icons-outlined row-icon">${icon}</span>
                            <span class="row-parcela">${p.cislo}</span>
                            <span class="row-typ">${p.typ === 'zastavena' ? 'Zastavěná pl.' : 'Pozemková'}</span>
                            <span class="row-plocha">${p.plocha}</span>
                            <button class="row-remove" onclick="${removeFunc}(${p.originalIndex})" title="Odebrat">
                                <span class="material-icons-outlined">close</span>
                            </button>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Prázdný stav pro vyhledávání
            html += `
                <div class="pozemky-no-results" id="pozemkyNoResults_${type}" style="display: none;">
                    <span class="material-icons-outlined">search_off</span>
                    Žádné pozemky neodpovídají filtru
                </div>
            `;
            
            html += '</div>';
            
            return html;
        }
        
        // Přepínání rozbalení skupiny k.ú.
        function toggleKuGroup(type, kod) {
            const group = document.getElementById(`kuGroup_${type}_${kod}`);
            const header = group.querySelector('.pozemky-ku-header');
            
            group.classList.toggle('expanded');
            header.classList.toggle('expanded');
        }
        
        // Filtrování pozemků v seskupeném zobrazení
        function filterGroupedPozemky(type) {
            const searchInput = document.getElementById(`pozemkySearch_${type}`);
            const filterSelect = document.getElementById(`pozemkyFilter_${type}`);
            const noResults = document.getElementById(`pozemkyNoResults_${type}`);
            
            const searchValue = searchInput.value.toLowerCase().trim();
            const filterKu = filterSelect.value;
            
            const container = document.querySelector(`.pozemky-grouped-container[data-type="${type}"]`);
            const groups = container.querySelectorAll('.pozemky-ku-group');
            
            let totalVisible = 0;
            
            groups.forEach(group => {
                const groupKu = group.dataset.ku;
                const rows = group.querySelectorAll('.pozemky-ku-row');
                
                // Filtr podle k.ú.
                if (filterKu && groupKu !== filterKu) {
                    group.classList.add('hidden');
                    return;
                }
                
                group.classList.remove('hidden');
                
                // Filtr podle čísla parcely
                let visibleInGroup = 0;
                rows.forEach(row => {
                    const parcela = row.dataset.parcela;
                    if (searchValue && !parcela.includes(searchValue)) {
                        row.classList.add('hidden');
                    } else {
                        row.classList.remove('hidden');
                        visibleInGroup++;
                        
                        // Zvýraznění nalezené parcely
                        if (searchValue && parcela.includes(searchValue)) {
                            row.classList.add('highlighted');
                            setTimeout(() => row.classList.remove('highlighted'), 2000);
                        }
                    }
                });
                
                // Skrýt skupinu pokud nemá viditelné pozemky
                if (visibleInGroup === 0) {
                    group.classList.add('hidden');
                } else {
                    // Automaticky rozbalit skupinu s výsledky při vyhledávání
                    if (searchValue) {
                        group.classList.add('expanded');
                        group.querySelector('.pozemky-ku-header').classList.add('expanded');
                    }
                }
                
                totalVisible += visibleInGroup;
            });
            
            // Zobrazit/skrýt prázdný stav
            if (noResults) {
                noResults.style.display = totalVisible === 0 ? 'block' : 'none';
            }
        }

        function renderPozemkyZameru() {
            const list = document.getElementById('pozemkyZameruList');
            const countBadge = document.getElementById('pozemkyZameruCount');
            const viewMode = pozemkyState.viewModeZameru;
            const sort = pozemkyState.sortZameru;
            
            if (pozemkyState.pozemkyZameru.length === 0) {
                list.innerHTML = `
                    <div class="pozemky-empty-note">
                        <span class="material-icons-outlined">warning</span>
                        Nejsou definovány žádné pozemky záměru. Přidejte alespoň jeden pozemek.
                    </div>
                `;
                countBadge.textContent = '0 parcel';
            } else {
                const pocet = pozemkyState.pozemkyZameru.length;
                countBadge.textContent = pocet + ' ' + (pocet === 1 ? 'parcela' : (pocet < 5 ? 'parcely' : 'parcel'));
                
                let html = '';
                
                if (viewMode === 'chips') {
                    // Kompaktní chip zobrazení
                    html = '<div class="pozemky-chips-container">';
                    pozemkyState.pozemkyZameru.forEach((p, index) => {
                        const icon = p.typ === 'zastavena' ? 'crop_square' : 'grass';
                        html += `
                            <div class="pozemek-chip zamer" title="k.ú. ${p.katastr} [${p.kod}]${p.plocha !== '—' ? ' • ' + p.plocha : ''}">
                                <span class="material-icons-outlined chip-icon">${icon}</span>
                                <span class="chip-parcela">${p.cislo}</span>
                                <span class="chip-ku">${p.katastr.substring(0, 8)}${p.katastr.length > 8 ? '…' : ''}</span>
                                <button class="chip-remove" onclick="removePozemekZameru(${index})" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                } else if (viewMode === 'grouped') {
                    // Seskupené zobrazení podle k.ú.
                    html = renderGroupedPozemky(pozemkyState.pozemkyZameru, 'zameru');
                } else {
                    // Řádkové zobrazení s hlavičkou
                    const parcelaSortClass = sort.field === 'cislo' ? (sort.asc ? 'active asc' : 'active') : '';
                    const katastrSortClass = sort.field === 'katastr' ? (sort.asc ? 'active asc' : 'active') : '';
                    
                    html = '<div class="pozemky-list-container">';
                    html += `
                        <div class="pozemky-list-header">
                            <span class="col-icon"></span>
                            <span class="header-col col-parcela ${parcelaSortClass}" onclick="sortPozemky('zameru', 'cislo')">
                                Parcela
                                <span class="material-icons-outlined sort-icon">arrow_downward</span>
                            </span>
                            <span class="header-col col-katastr ${katastrSortClass}" onclick="sortPozemky('zameru', 'katastr')">
                                Katastrální území
                                <span class="material-icons-outlined sort-icon">arrow_downward</span>
                            </span>
                            <span class="col-kod">Kód</span>
                            <span class="col-plocha">Plocha</span>
                            <span class="col-actions"></span>
                        </div>
                    `;
                    pozemkyState.pozemkyZameru.forEach((p, index) => {
                        const icon = p.typ === 'zastavena' ? 'crop_square' : 'grass';
                        html += `
                            <div class="pozemek-row zamer">
                                <span class="material-icons-outlined row-icon">${icon}</span>
                                <span class="row-parcela">${p.cislo}</span>
                                <span class="row-katastr">${p.katastr}</span>
                                <span class="row-kod">[${p.kod}]</span>
                                <span class="row-plocha">${p.plocha}</span>
                                <button class="row-remove" onclick="removePozemekZameru(${index})" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                list.innerHTML = html;
            }
            
            updatePozemkyState();
        }

        function addPozemekZameru() {
            const obecSelect = document.getElementById('pozemekObec');
            const kuSelect = document.getElementById('pozemekKU');
            const input = document.getElementById('pozemekZameruInput');
            const value = input.value.trim();
            
            if (!value) {
                alert('Zadejte číslo parcely.');
                return;
            }
            
            // Určení katastrálního území
            let katastr = 'Veselí nad Lužnicí';
            let kod = '779091';
            
            if (kuSelect.value) {
                katastr = kuSelect.options[kuSelect.selectedIndex].text;
                kod = kuSelect.value.split('-')[1] || '779091';
            }
            
            // Určení typu parcely podle čísla
            const isZastavena = value.toLowerCase().startsWith('st.');
            
            pozemkyState.pozemkyZameru.push({
                cislo: value,
                katastr: katastr,
                kod: kod,
                plocha: '—',
                typ: isZastavena ? 'zastavena' : 'pozemkova'
            });
            
            renderPozemkyZameru();
            input.value = '';
        }
        
        function selectPozemekMethod(method) {
            // Update tlačítek - pouze pro pozemky záměru
            const pozemkySection = document.getElementById('pozemekMethodRucne').closest('.pozemky-section');
            pozemkySection.querySelectorAll('.neighbor-method-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.method === method);
            });
            
            // Zobrazení správného obsahu
            document.getElementById('pozemekMethodRucne').style.display = method === 'rucne' ? 'block' : 'none';
            document.getElementById('pozemekMethodMapa').style.display = method === 'mapa' ? 'block' : 'none';
            
            // Při volbě Z mapy přepnout viewer na záložku Mapa
            if (method === 'mapa') {
                const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
                if (mapTab) {
                    switchPozemkyTab(mapTab, 'mapa');
                }
            }
        }
        
        function loadKatastralniUzemi() {
            const obecSelect = document.getElementById('pozemekObec');
            const kuSelect = document.getElementById('pozemekKU');
            const obec = obecSelect.value;
            
            // Reset k.ú. dropdown
            kuSelect.innerHTML = '<option value="">Vyberte k.ú....</option>';
            kuSelect.disabled = true;
            
            if (!obec) return;
            
            // Simulace načtení k.ú. podle obce
            const katastry = {
                'veseli': [
                    { value: 'veseli-779091', text: 'Veselí nad Lužnicí' },
                    { value: 'horusice-779091', text: 'Horusice' }
                ],
                'tabor': [
                    { value: 'tabor-764621', text: 'Tábor' },
                    { value: 'klokoty-764621', text: 'Klokoty' },
                    { value: 'chotoviny-764621', text: 'Chotoviny' }
                ],
                'soběslav': [
                    { value: 'sobeslav-752177', text: 'Soběslav' },
                    { value: 'chlebov-752177', text: 'Chlebov' }
                ]
            };
            
            if (katastry[obec]) {
                katastry[obec].forEach(ku => {
                    const option = document.createElement('option');
                    option.value = ku.value;
                    option.textContent = ku.text;
                    kuSelect.appendChild(option);
                });
                kuSelect.disabled = false;
            }
        }
        
        function openMapForPozemkyZameru() {
            // Přepnutí na záložku Mapa ve vieweru
            const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
            if (mapTab) {
                switchPozemkyTab(mapTab, 'mapa');
            }
            alert('V ostré verzi by se zde otevřela katastrální mapa pro výběr pozemků záměru kliknutím na parcely.');
        }

        function removePozemekZameru(index) {
            pozemkyState.pozemkyZameru.splice(index, 1);
            renderPozemkyZameru();
        }

        function switchPozemkyTab(tabEl, view) {
            const tabs = document.querySelectorAll('#controlPozemky .viewer-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tabEl.classList.add('active');
            
            const viewer = document.getElementById('viewer-pozemky');
            
            if (view === 'mapa') {
                // Zobrazit interaktivní katastrální mapu
                viewer.innerHTML = '';
                viewer.classList.remove('viewer-placeholder');
                viewer.appendChild(createKatastrMap());
            } else {
                viewer.classList.add('viewer-placeholder');
                const viewConfig = {
                    'zadost': { icon: 'description', title: 'Žádost o povolení stavby', text: 'Pozemky uvedené stavebníkem v žádosti' },
                    'situace': { icon: 'architecture', title: 'Situační výkresy', text: 'C.1 - C.4 ze složky dokumentace' },
                    'kn': { icon: 'terrain', title: 'Katastr nemovitostí', text: 'Nahlížení do katastru nemovitostí' }
                };
                
                const config = viewConfig[view];
                viewer.innerHTML = `
                    <span class="material-icons-outlined">${config.icon}</span>
                    <div class="viewer-placeholder-title">${config.title}</div>
                    <div class="viewer-placeholder-text">${config.text}</div>
                `;
            }
        }
        
        // ==========================================
        // INTERAKTIVNÍ KATASTRÁLNÍ MAPA
        // ==========================================
        
        // Data parcel pro mapu
        const mapParcelyData = [
            // Pozemky záměru (modré ohraničení)
            { id: 'st142', cislo: 'st. 142', typ: 'zastavena', points: '280,180 320,180 320,220 280,220', plocha: '560 m²', druh: 'Zastavěná plocha', ku: 'Radonice', isZamer: true },
            { id: 'p248-3', cislo: '248/3', typ: 'ornapuda', points: '180,120 280,120 280,220 240,220 240,180 180,180', plocha: '1 240 m²', druh: 'Orná půda', ku: 'Radonice', isZamer: true },
            { id: 'p248-4', cislo: '248/4', typ: 'ornapuda', points: '320,120 400,120 400,180 320,180', plocha: '320 m²', druh: 'Orná půda', ku: 'Radonice', isZamer: true },
            { id: 'st143', cislo: 'st. 143', typ: 'zastavena', points: '340,185 375,185 375,215 340,215', plocha: '180 m²', druh: 'Zastavěná plocha', ku: 'Radonice', isZamer: true },
            { id: 'p251-1', cislo: '251/1', typ: 'travni', points: '280,220 380,220 380,300 320,300 320,260 280,260', plocha: '890 m²', druh: 'Trvalý travní porost', ku: 'Radonice', isZamer: true },
            
            // Sousední pozemky (zelené ohraničení)
            { id: 'p247-1', cislo: '247/1', typ: 'ornapuda', points: '80,120 180,120 180,180 140,180 140,220 80,220', plocha: '1 120 m²', druh: 'Orná půda', ku: 'Radonice', isSoused: true },
            { id: 'p247-2', cislo: '247/2', typ: 'zahrada', points: '80,220 140,220 140,260 80,260', plocha: '450 m²', druh: 'Zahrada', ku: 'Radonice', isSoused: true },
            { id: 'p249', cislo: '249', typ: 'ornapuda', points: '400,120 520,120 520,220 400,220 400,180', plocha: '2 340 m²', druh: 'Orná půda', ku: 'Radonice', isSoused: true },
            { id: 'st140', cislo: 'st. 140', typ: 'zastavena', points: '100,145 135,145 135,175 100,175', plocha: '210 m²', druh: 'Zastavěná plocha', ku: 'Radonice', isSoused: true },
            { id: 'st141', cislo: 'st. 141', typ: 'zastavena', points: '145,185 175,185 175,215 145,215', plocha: '185 m²', druh: 'Zastavěná plocha', ku: 'Radonice', isSoused: true },
            { id: 'p250-1', cislo: '250/1', typ: 'travni', points: '380,220 460,220 460,280 380,280', plocha: '670 m²', druh: 'Trvalý travní porost', ku: 'Radonice', isSoused: true },
            { id: 'p250-2', cislo: '250/2', typ: 'travni', points: '460,220 520,220 520,300 460,300 460,280', plocha: '380 m²', druh: 'Trvalý travní porost', ku: 'Radonice', isSoused: true },
            { id: 'p252', cislo: '252', typ: 'ornapuda', points: '320,300 440,300 440,380 320,380', plocha: '1 560 m²', druh: 'Orná půda', ku: 'Radonice', isSoused: true },
            { id: 'p246-3', cislo: '246/3', typ: 'les', points: '80,260 180,260 180,340 80,340', plocha: '920 m²', druh: 'Lesní pozemek', ku: 'Radonice', isSoused: true },
            { id: 'st139', cislo: 'st. 139', typ: 'zastavena', points: '95,275 130,275 130,310 95,310', plocha: '240 m²', druh: 'Zastavěná plocha', ku: 'Radonice', isSoused: true },
            { id: 'p253-1', cislo: '253/1', typ: 'travni', points: '440,300 520,300 520,360 440,360', plocha: '780 m²', druh: 'Trvalý travní porost', ku: 'Radonice', isSoused: true },
            { id: 'p253-2', cislo: '253/2', typ: 'zahrada', points: '440,360 520,360 520,400 440,400', plocha: '415 m²', druh: 'Zahrada', ku: 'Radonice', isSoused: true },
            
            // Ostatní pozemky
            { id: 'p244', cislo: '244', typ: 'ornapuda', points: '80,60 200,60 200,120 80,120', plocha: '1 800 m²', druh: 'Orná půda', ku: 'Radonice' },
            { id: 'p245', cislo: '245', typ: 'ornapuda', points: '200,60 340,60 340,120 200,120', plocha: '2 100 m²', druh: 'Orná půda', ku: 'Radonice' },
            { id: 'p246-1', cislo: '246/1', typ: 'ornapuda', points: '340,60 480,60 480,120 340,120', plocha: '2 450 m²', druh: 'Orná půda', ku: 'Radonice' },
            { id: 'p246-2', cislo: '246/2', typ: 'ornapuda', points: '480,60 560,60 560,120 520,120 520,80 480,80', plocha: '980 m²', druh: 'Orná půda', ku: 'Radonice' },
            { id: 'p254', cislo: '254', typ: 'travni', points: '180,260 240,260 240,340 180,340', plocha: '720 m²', druh: 'Trvalý travní porost', ku: 'Radonice' },
            { id: 'p255', cislo: '255', typ: 'travni', points: '240,260 320,260 320,340 240,340', plocha: '880 m²', druh: 'Trvalý travní porost', ku: 'Radonice' },
            { id: 'p256', cislo: '256', typ: 'les', points: '80,340 180,340 180,400 80,400', plocha: '1 100 m²', druh: 'Lesní pozemek', ku: 'Radonice' },
            { id: 'p257', cislo: '257', typ: 'travni', points: '180,340 320,340 320,400 180,400', plocha: '1 650 m²', druh: 'Trvalý travní porost', ku: 'Radonice' },
            { id: 'p258', cislo: '258', typ: 'ornapuda', points: '320,380 440,380 440,430 320,430', plocha: '1 200 m²', druh: 'Orná půda', ku: 'Radonice' }
        ];
        
        let mapZoom = 100;
        let selectedParcela = null;
        let mapPolygonMode = false;
        let polygonPoints = [];
        let selectedByPolygon = [];
        
        function createKatastrMap() {
            const container = document.createElement('div');
            container.className = 'katastr-map-container';
            
            container.innerHTML = `
                <div class="katastr-map-toolbar">
                    <div class="katastr-map-title">
                        <span class="material-icons-outlined">map</span>
                        <span id="mapKuTitle">k.ú. Radonice [747076]</span>
                    </div>
                    <div class="katastr-search-container">
                        <span class="material-icons-outlined">search</span>
                        <input type="text" class="katastr-search-input" id="mapSearchInput" 
                            placeholder="Hledat obec nebo k.ú...." 
                            oninput="searchKatastr(this.value)"
                            onfocus="showKatastrDropdown()"
                            autocomplete="off">
                        <div class="katastr-search-dropdown" id="mapSearchDropdown">
                            <div class="katastr-search-group">
                                <div class="katastr-search-group-title">Nedávné</div>
                                <div class="katastr-search-item" onclick="selectKatastr('Radonice', '747076')">
                                    <span class="material-icons-outlined">history</span>
                                    Radonice [747076]
                                </div>
                            </div>
                            <div class="katastr-search-group">
                                <div class="katastr-search-group-title">Výsledky</div>
                                <div class="katastr-search-item" onclick="selectKatastr('Kunratice', '728390')">
                                    <span class="material-icons-outlined">place</span>
                                    Kunratice [728390], Praha
                                </div>
                                <div class="katastr-search-item" onclick="selectKatastr('Šeberov', '746011')">
                                    <span class="material-icons-outlined">place</span>
                                    Šeberov [746011], Praha
                                </div>
                                <div class="katastr-search-item" onclick="selectKatastr('Veselí nad Lužnicí', '779091')">
                                    <span class="material-icons-outlined">place</span>
                                    Veselí nad Lužnicí [779091]
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="katastr-tools-separator"></div>
                    <div class="katastr-tool-btn ${mapPolygonMode ? 'active' : ''}" onclick="togglePolygonSelect()" id="btnPolygonSelect" title="Výběr polygonem">
                        <span class="material-icons-outlined">polyline</span>
                    </div>
                    <div class="katastr-layers-btn" onclick="toggleMapLayers()">
                        <span class="material-icons-outlined">layers</span>
                        Vrstvy
                    </div>
                    <div class="katastr-map-zoom">
                        <button class="katastr-zoom-btn" onclick="zoomMap(-10)" title="Oddálit">
                            <span class="material-icons-outlined">remove</span>
                        </button>
                        <span class="katastr-zoom-level" id="mapZoomLevel">100%</span>
                        <button class="katastr-zoom-btn" onclick="zoomMap(10)" title="Přiblížit">
                            <span class="material-icons-outlined">add</span>
                        </button>
                    </div>
                </div>
                
                <!-- Polygon mode banner -->
                <div class="katastr-polygon-banner" id="polygonBanner" style="display: none;">
                    <span class="material-icons-outlined">polyline</span>
                    <span>Režim výběru polygonem: klikáním vytvořte body, dvojklikem dokončete výběr</span>
                    <button onclick="cancelPolygonSelect()">Zrušit</button>
                </div>
                
                <div class="katastr-map-viewport" id="mapViewport">
                    <svg class="katastr-map-svg" id="katastrSvg" viewBox="40 30 560 420">
                        <defs>
                            <pattern id="gridPattern" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e0e0e0" stroke-width="0.5"/>
                            </pattern>
                            <!-- Vzor pro pozemky záměru -->
                            <pattern id="zamerPattern" width="8" height="8" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">
                                <line x1="0" y1="0" x2="0" y2="8" stroke="#1a73e8" stroke-width="2" opacity="0.3"/>
                            </pattern>
                            <!-- Vzor pro sousední pozemky -->
                            <pattern id="sousedPattern" width="6" height="6" patternUnits="userSpaceOnUse">
                                <circle cx="3" cy="3" r="1" fill="#34a853" opacity="0.4"/>
                            </pattern>
                        </defs>
                        
                        <!-- Pozadí s mřížkou -->
                        <rect x="40" y="30" width="560" height="420" fill="url(#gridPattern)"/>
                        
                        <!-- Parcely budou vygenerovány JS -->
                        <g id="parcelyGroup"></g>
                        
                        <!-- Overlay pro pozemky záměru -->
                        <g id="zamerOverlayGroup"></g>
                        
                        <!-- Overlay pro sousední pozemky -->
                        <g id="sousedOverlayGroup"></g>
                        
                        <!-- Hranice k.ú. -->
                        <rect class="ku-boundary" x="60" y="45" width="520" height="390"/>
                        
                        <!-- Polygon selection -->
                        <g id="polygonSelectGroup">
                            <polygon id="selectionPolygon" class="selection-polygon" points=""/>
                            <g id="selectionPoints"></g>
                        </g>
                        
                        <!-- Labels budou vygenerovány JS -->
                        <g id="labelsGroup"></g>
                    </svg>
                    
                    <!-- Legenda -->
                    <div class="katastr-legend">
                        <div class="katastr-legend-title">Legenda</div>
                        <div class="katastr-legend-item">
                            <div class="katastr-legend-color" style="background: #f5e6c8;"></div>
                            <span>Orná půda</span>
                        </div>
                        <div class="katastr-legend-item">
                            <div class="katastr-legend-color" style="background: #c8e6c9;"></div>
                            <span>Travní porost</span>
                        </div>
                        <div class="katastr-legend-item">
                            <div class="katastr-legend-color" style="background: #ffcdd2;"></div>
                            <span>Zastavěná plocha</span>
                        </div>
                        <div class="katastr-legend-item">
                            <div class="katastr-legend-color" style="background: #a5d6a7;"></div>
                            <span>Les</span>
                        </div>
                        <div class="katastr-legend-item">
                            <div class="katastr-legend-color" style="background: #dcedc8;"></div>
                            <span>Zahrada</span>
                        </div>
                        <div class="katastr-legend-item" style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #e0e0e0;">
                            <div class="katastr-legend-color" style="background: transparent; border: 2px solid #1a73e8;"></div>
                            <span>Pozemky záměru</span>
                        </div>
                        <div class="katastr-legend-item">
                            <div class="katastr-legend-color" style="background: transparent; border: 2px solid #34a853;"></div>
                            <span>Sousední pozemky</span>
                        </div>
                    </div>
                    
                    <!-- Měřítko -->
                    <div class="katastr-scale">
                        <div class="katastr-scale-bar"></div>
                        <span>50 m</span>
                    </div>
                    
                    <!-- Tooltip -->
                    <div class="katastr-tooltip" id="mapTooltip"></div>
                    
                    <!-- Info panel -->
                    <div class="katastr-info-panel" id="mapInfoPanel">
                        <div class="katastr-info-header">
                            <span class="katastr-info-parcela" id="infoParcela">—</span>
                            <button class="katastr-info-close" onclick="closeMapInfo()">
                                <span class="material-icons-outlined">close</span>
                            </button>
                        </div>
                        <div class="katastr-info-details">
                            <span class="katastr-info-label">Katastrální území:</span>
                            <span class="katastr-info-value" id="infoKu">—</span>
                            <span class="katastr-info-label">Druh pozemku:</span>
                            <span class="katastr-info-value" id="infoDruh">—</span>
                            <span class="katastr-info-label">Výměra:</span>
                            <span class="katastr-info-value" id="infoPlocha">—</span>
                        </div>
                        <div class="katastr-info-actions">
                            <button class="katastr-info-btn" onclick="addParcelaAsSoused()" id="btnAddSoused">
                                <span class="material-icons-outlined">add</span>
                                Přidat jako sousední
                            </button>
                            <button class="katastr-info-btn primary" onclick="addParcelaAsZamer()" id="btnAddZamer">
                                <span class="material-icons-outlined">add_location</span>
                                Přidat do záměru
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Inicializovat parcely po přidání do DOM
            setTimeout(() => {
                renderMapParcely();
                initMapInteractions();
            }, 50);
            
            return container;
        }
        
        function renderMapParcely() {
            const parcelyGroup = document.getElementById('parcelyGroup');
            const labelsGroup = document.getElementById('labelsGroup');
            const zamerOverlay = document.getElementById('zamerOverlayGroup');
            const sousedOverlay = document.getElementById('sousedOverlayGroup');
            
            if (!parcelyGroup || !labelsGroup) return;
            
            let parcelyHtml = '';
            let labelsHtml = '';
            let zamerOverlayHtml = '';
            let sousedOverlayHtml = '';
            
            mapParcelyData.forEach(p => {
                // Určit CSS třídy
                let classes = `parcela-polygon typ-${p.typ}`;
                if (p.isZamer) classes += ' zamer';
                if (p.isSoused) classes += ' soused';
                
                // Polygon parcely
                parcelyHtml += `<polygon 
                    class="${classes}" 
                    points="${p.points}" 
                    data-id="${p.id}"
                    data-cislo="${p.cislo}"
                    data-ku="${p.ku}"
                    data-druh="${p.druh}"
                    data-plocha="${p.plocha}"
                    data-is-zamer="${p.isZamer || false}"
                    data-is-soused="${p.isSoused || false}"
                />`;
                
                // Přidat overlay pro pozemky záměru (šrafování)
                if (p.isZamer) {
                    zamerOverlayHtml += `<polygon class="parcela-overlay-zamer" points="${p.points}"/>`;
                }
                
                // Přidat overlay pro sousední pozemky (tečky)
                if (p.isSoused) {
                    sousedOverlayHtml += `<polygon class="parcela-overlay-soused" points="${p.points}"/>`;
                }
                
                // Vypočítat střed pro label
                const center = getPolygonCenter(p.points);
                const isStavebni = p.cislo.startsWith('st');
                const labelClass = isStavebni ? 'parcela-label stavebni' : 'parcela-label';
                
                labelsHtml += `<text class="${labelClass}" x="${center.x}" y="${center.y}">${p.cislo}</text>`;
            });
            
            parcelyGroup.innerHTML = parcelyHtml;
            labelsGroup.innerHTML = labelsHtml;
            if (zamerOverlay) zamerOverlay.innerHTML = zamerOverlayHtml;
            if (sousedOverlay) sousedOverlay.innerHTML = sousedOverlayHtml;
        }
        
        function getPolygonCenter(pointsStr) {
            const points = pointsStr.split(' ').map(p => {
                const [x, y] = p.split(',').map(Number);
                return { x, y };
            });
            
            let sumX = 0, sumY = 0;
            points.forEach(p => {
                sumX += p.x;
                sumY += p.y;
            });
            
            return {
                x: Math.round(sumX / points.length),
                y: Math.round(sumY / points.length)
            };
        }
        
        function initMapInteractions() {
            const svg = document.getElementById('katastrSvg');
            const tooltip = document.getElementById('mapTooltip');
            const viewport = document.getElementById('mapViewport');
            
            if (!svg) return;
            
            // Hover efekt a tooltip
            svg.addEventListener('mousemove', (e) => {
                const target = e.target.closest('.parcela-polygon');
                
                if (target) {
                    const cislo = target.dataset.cislo;
                    const plocha = target.dataset.plocha;
                    
                    tooltip.innerHTML = `<strong>${cislo}</strong> • ${plocha}`;
                    tooltip.classList.add('visible');
                    
                    const rect = viewport.getBoundingClientRect();
                    tooltip.style.left = (e.clientX - rect.left + 15) + 'px';
                    tooltip.style.top = (e.clientY - rect.top - 10) + 'px';
                } else {
                    tooltip.classList.remove('visible');
                }
            });
            
            svg.addEventListener('mouseleave', () => {
                tooltip.classList.remove('visible');
            });
            
            // Klik pro výběr parcely
            svg.addEventListener('click', (e) => {
                const target = e.target.closest('.parcela-polygon');
                
                if (target) {
                    // Odznačit předchozí
                    const prev = svg.querySelector('.parcela-polygon.selected');
                    if (prev) prev.classList.remove('selected');
                    
                    // Označit novou
                    target.classList.add('selected');
                    selectedParcela = target.dataset;
                    
                    // Zobrazit info panel
                    showMapInfo(target.dataset);
                }
            });
        }
        
        function showMapInfo(data) {
            const panel = document.getElementById('mapInfoPanel');
            
            document.getElementById('infoParcela').textContent = data.cislo;
            document.getElementById('infoKu').textContent = `${data.ku} [747076]`;
            document.getElementById('infoDruh').textContent = data.druh;
            document.getElementById('infoPlocha').textContent = data.plocha;
            
            // Upravit tlačítka podle stavu
            const btnZamer = document.getElementById('btnAddZamer');
            const btnSoused = document.getElementById('btnAddSoused');
            
            const isZamer = data.isZamer === 'true' || data.isZamer === true;
            const isSoused = data.isSoused === 'true' || data.isSoused === true;
            
            if (isZamer) {
                btnZamer.innerHTML = '<span class="material-icons-outlined">remove_circle_outline</span> Odebrat ze záměru';
                btnZamer.disabled = false;
                btnZamer.classList.remove('primary');
                btnZamer.classList.add('danger');
                btnZamer.onclick = function() { removeParcelaFromZamer(); };
            } else {
                btnZamer.innerHTML = '<span class="material-icons-outlined">add_location</span> Přidat do záměru';
                btnZamer.disabled = false;
                btnZamer.classList.add('primary');
                btnZamer.classList.remove('danger');
                btnZamer.onclick = function() { addParcelaAsZamer(); };
            }
            
            if (isSoused) {
                btnSoused.innerHTML = '<span class="material-icons-outlined">remove_circle_outline</span> Odebrat ze sousedních';
                btnSoused.disabled = false;
                btnSoused.classList.add('danger');
                btnSoused.onclick = function() { removeParcelaFromSoused(); };
            } else {
                btnSoused.innerHTML = '<span class="material-icons-outlined">add</span> Přidat jako sousední';
                btnSoused.disabled = false;
                btnSoused.classList.remove('danger');
                btnSoused.onclick = function() { addParcelaAsSoused(); };
            }
            
            panel.classList.add('visible');
        }
        
        function removeParcelaFromZamer() {
            if (!selectedParcela) return;
            
            // Najít a odstranit z pozemků záměru
            const index = pozemkyState.pozemkyZameru.findIndex(p => p.cislo === selectedParcela.cislo);
            if (index !== -1) {
                pozemkyState.pozemkyZameru.splice(index, 1);
            }
            
            // Aktualizovat mapu data
            const parcelaInData = mapParcelyData.find(p => p.id === selectedParcela.id);
            if (parcelaInData) {
                parcelaInData.isZamer = false;
            }
            
            // Aktualizovat SVG
            const polygon = document.querySelector(`.parcela-polygon[data-id="${selectedParcela.id}"]`);
            if (polygon) {
                polygon.classList.remove('zamer');
                polygon.dataset.isZamer = 'false';
            }
            
            // Aktualizovat selectedParcela
            selectedParcela.isZamer = 'false';
            
            renderPozemkyZameru();
            renderMapParcely();
            showMapInfo(selectedParcela);
            updatePozemkyState();
        }
        
        function removeParcelaFromSoused() {
            if (!selectedParcela) return;
            
            // Najít a odstranit ze sousedních pozemků
            const index = pozemkyState.sousedniParcely.findIndex(p => p.cislo === selectedParcela.cislo);
            if (index !== -1) {
                pozemkyState.sousedniParcely.splice(index, 1);
            }
            
            // Aktualizovat mapu data
            const parcelaInData = mapParcelyData.find(p => p.id === selectedParcela.id);
            if (parcelaInData) {
                parcelaInData.isSoused = false;
            }
            
            // Aktualizovat SVG
            const polygon = document.querySelector(`.parcela-polygon[data-id="${selectedParcela.id}"]`);
            if (polygon) {
                polygon.classList.remove('soused');
                polygon.dataset.isSoused = 'false';
            }
            
            // Aktualizovat selectedParcela
            selectedParcela.isSoused = 'false';
            
            renderSousedniParcely();
            renderMapParcely();
            showMapInfo(selectedParcela);
            updatePozemkyState();
        }
        
        function closeMapInfo() {
            document.getElementById('mapInfoPanel').classList.remove('visible');
            
            const selected = document.querySelector('.parcela-polygon.selected');
            if (selected) selected.classList.remove('selected');
            
            selectedParcela = null;
        }
        
        function zoomMap(delta) {
            mapZoom = Math.max(50, Math.min(200, mapZoom + delta));
            document.getElementById('mapZoomLevel').textContent = mapZoom + '%';
            
            const svg = document.getElementById('katastrSvg');
            if (svg) {
                const scale = mapZoom / 100;
                const viewBoxWidth = 560 / scale;
                const viewBoxHeight = 420 / scale;
                const offsetX = (560 - viewBoxWidth) / 2 + 40;
                const offsetY = (420 - viewBoxHeight) / 2 + 30;
                svg.setAttribute('viewBox', `${offsetX} ${offsetY} ${viewBoxWidth} ${viewBoxHeight}`);
            }
        }
        
        function addParcelaAsZamer() {
            if (!selectedParcela) return;
            
            // Přidat do pozemků záměru
            const isStavebni = selectedParcela.cislo.toLowerCase().startsWith('st');
            pozemkyState.pozemkyZameru.push({
                cislo: selectedParcela.cislo,
                katastr: selectedParcela.ku,
                kod: '747076',
                plocha: selectedParcela.plocha,
                typ: isStavebni ? 'zastavena' : 'pozemkova'
            });
            
            // Aktualizovat mapu
            const parcelaInData = mapParcelyData.find(p => p.id === selectedParcela.id);
            if (parcelaInData) {
                parcelaInData.isZamer = true;
            }
            
            // Aktualizovat SVG
            const polygon = document.querySelector(`.parcela-polygon[data-id="${selectedParcela.id}"]`);
            if (polygon) {
                polygon.classList.add('zamer');
                polygon.dataset.isZamer = 'true';
            }
            
            renderPozemkyZameru();
            renderMapParcely();
            showMapInfo(selectedParcela);
            updatePozemkyState();
        }
        
        function addParcelaAsSoused() {
            if (!selectedParcela) return;
            
            // Přidat do sousedních pozemků
            pozemkyState.sousedniParcely.push({
                cislo: selectedParcela.cislo,
                katastr: selectedParcela.ku,
                kod: '747076',
                plocha: selectedParcela.plocha
            });
            
            // Aktualizovat mapu
            const parcelaInData = mapParcelyData.find(p => p.id === selectedParcela.id);
            if (parcelaInData) {
                parcelaInData.isSoused = true;
            }
            
            // Aktualizovat SVG
            const polygon = document.querySelector(`.parcela-polygon[data-id="${selectedParcela.id}"]`);
            if (polygon) {
                polygon.classList.add('soused');
                polygon.dataset.isSoused = 'true';
            }
            
            renderSousedniParcely();
            renderMapParcely();
            showMapInfo(selectedParcela);
            updatePozemkyState();
        }
        
        // ==========================================
        // VYHLEDÁVÁNÍ KATASTRÁLNÍHO ÚZEMÍ
        // ==========================================
        
        function showKatastrDropdown() {
            const dropdown = document.getElementById('mapSearchDropdown');
            if (dropdown) dropdown.classList.add('visible');
            
            // Zavřít při kliknutí mimo
            setTimeout(() => {
                document.addEventListener('click', hideKatastrDropdown);
            }, 100);
        }
        
        function hideKatastrDropdown(e) {
            const container = document.querySelector('.katastr-search-container');
            if (container && !container.contains(e.target)) {
                const dropdown = document.getElementById('mapSearchDropdown');
                if (dropdown) dropdown.classList.remove('visible');
                document.removeEventListener('click', hideKatastrDropdown);
            }
        }
        
        function searchKatastr(query) {
            // V reálné aplikaci by se zde volalo API
            // Pro simulaci jen ukážeme dropdown
            const dropdown = document.getElementById('mapSearchDropdown');
            if (dropdown && query.length > 0) {
                dropdown.classList.add('visible');
            }
        }
        
        function selectKatastr(name, kod) {
            // Aktualizovat titulek
            const title = document.getElementById('mapKuTitle');
            if (title) title.textContent = `k.ú. ${name} [${kod}]`;
            
            // Zavřít dropdown
            const dropdown = document.getElementById('mapSearchDropdown');
            if (dropdown) dropdown.classList.remove('visible');
            
            // Vyčistit input
            const input = document.getElementById('mapSearchInput');
            if (input) input.value = '';
            
            // V reálné aplikaci by se zde načetla data pro nové k.ú.
            console.log(`Přepnuto na k.ú. ${name} [${kod}]`);
        }
        
        // ==========================================
        // VÝBĚR POLYGONEM
        // ==========================================
        
        function togglePolygonSelect() {
            mapPolygonMode = !mapPolygonMode;
            
            const btn = document.getElementById('btnPolygonSelect');
            const banner = document.getElementById('polygonBanner');
            const viewport = document.getElementById('mapViewport');
            
            if (mapPolygonMode) {
                btn.classList.add('active');
                banner.style.display = 'flex';
                viewport.style.cursor = 'crosshair';
                polygonPoints = [];
                updatePolygonDisplay();
                
                // Přidat event listenery
                const svg = document.getElementById('katastrSvg');
                svg.addEventListener('click', handlePolygonClick);
                svg.addEventListener('dblclick', finishPolygonSelect);
                svg.addEventListener('mousemove', handlePolygonMouseMove);
            } else {
                cancelPolygonSelect();
            }
        }
        
        function cancelPolygonSelect() {
            mapPolygonMode = false;
            polygonPoints = [];
            selectedByPolygon = [];
            
            const btn = document.getElementById('btnPolygonSelect');
            const banner = document.getElementById('polygonBanner');
            const viewport = document.getElementById('mapViewport');
            const selectionPanel = document.getElementById('polygonSelectionPanel');
            
            if (btn) btn.classList.remove('active');
            if (banner) banner.style.display = 'none';
            if (viewport) viewport.style.cursor = 'grab';
            if (selectionPanel) selectionPanel.classList.remove('visible');
            
            updatePolygonDisplay();
            
            // Odstranit event listenery
            const svg = document.getElementById('katastrSvg');
            if (svg) {
                svg.removeEventListener('click', handlePolygonClick);
                svg.removeEventListener('dblclick', finishPolygonSelect);
                svg.removeEventListener('mousemove', handlePolygonMouseMove);
            }
        }
        
        function handlePolygonClick(e) {
            if (!mapPolygonMode) return;
            e.stopPropagation();
            
            const svg = document.getElementById('katastrSvg');
            const pt = svg.createSVGPoint();
            pt.x = e.clientX;
            pt.y = e.clientY;
            const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
            
            polygonPoints.push({ x: svgP.x, y: svgP.y });
            updatePolygonDisplay();
        }
        
        function handlePolygonMouseMove(e) {
            if (!mapPolygonMode || polygonPoints.length === 0) return;
            
            // Zobrazit dočasnou čáru k aktuální pozici myši
            // (pro jednoduchost vynecháno)
        }
        
        function finishPolygonSelect(e) {
            if (!mapPolygonMode || polygonPoints.length < 3) return;
            e.preventDefault();
            e.stopPropagation();
            
            // Najít parcely uvnitř polygonu
            selectedByPolygon = [];
            
            mapParcelyData.forEach(p => {
                const center = getPolygonCenter(p.points);
                if (isPointInPolygon(center, polygonPoints)) {
                    selectedByPolygon.push(p);
                }
            });
            
            if (selectedByPolygon.length > 0) {
                showPolygonSelectionPanel();
            } else {
                alert('V označené oblasti nebyly nalezeny žádné parcely.');
                cancelPolygonSelect();
            }
        }
        
        function isPointInPolygon(point, polygon) {
            let inside = false;
            for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
                const xi = polygon[i].x, yi = polygon[i].y;
                const xj = polygon[j].x, yj = polygon[j].y;
                
                if (((yi > point.y) !== (yj > point.y)) &&
                    (point.x < (xj - xi) * (point.y - yi) / (yj - yi) + xi)) {
                    inside = !inside;
                }
            }
            return inside;
        }
        
        function updatePolygonDisplay() {
            const polygon = document.getElementById('selectionPolygon');
            const pointsGroup = document.getElementById('selectionPoints');
            
            if (!polygon || !pointsGroup) return;
            
            if (polygonPoints.length === 0) {
                polygon.setAttribute('points', '');
                pointsGroup.innerHTML = '';
                return;
            }
            
            // Aktualizovat polygon
            const pointsStr = polygonPoints.map(p => `${p.x},${p.y}`).join(' ');
            polygon.setAttribute('points', pointsStr);
            
            // Aktualizovat body
            let pointsHtml = '';
            polygonPoints.forEach((p, i) => {
                pointsHtml += `<circle class="selection-point" cx="${p.x}" cy="${p.y}" r="5" data-index="${i}"/>`;
            });
            pointsGroup.innerHTML = pointsHtml;
        }
        
        function showPolygonSelectionPanel() {
            // Zavřít banner
            const banner = document.getElementById('polygonBanner');
            if (banner) banner.style.display = 'none';
            
            // Zobrazit panel s výběrem
            let panel = document.getElementById('polygonSelectionPanel');
            
            if (!panel) {
                panel = document.createElement('div');
                panel.id = 'polygonSelectionPanel';
                panel.className = 'katastr-selection-panel';
                document.getElementById('mapViewport').appendChild(panel);
            }
            
            let listHtml = '';
            selectedByPolygon.forEach(p => {
                const icon = p.typ === 'zastavena' || p.cislo.startsWith('st') ? 'crop_square' : 'grass';
                const status = p.isZamer ? '🔵' : (p.isSoused ? '🟢' : '');
                listHtml += `
                    <div class="katastr-selection-item">
                        <span class="material-icons-outlined" style="font-size: 14px;">${icon}</span>
                        <span style="font-weight: 500;">${p.cislo}</span>
                        <span style="color: #5f6368; margin-left: auto;">${p.plocha}</span>
                        <span>${status}</span>
                    </div>
                `;
            });
            
            panel.innerHTML = `
                <div class="katastr-selection-header">
                    <span class="katastr-selection-title">Vybrané parcely</span>
                    <span class="katastr-selection-count">${selectedByPolygon.length} parcel</span>
                    <button class="katastr-info-close" onclick="cancelPolygonSelect()">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
                <div class="katastr-selection-list">
                    ${listHtml}
                </div>
                <div class="katastr-selection-actions">
                    <button class="katastr-info-btn" onclick="addPolygonSelectionAsSoused()">
                        <span class="material-icons-outlined">add</span>
                        Jako sousední
                    </button>
                    <button class="katastr-info-btn primary" onclick="addPolygonSelectionAsZamer()">
                        <span class="material-icons-outlined">add_location</span>
                        Do záměru
                    </button>
                </div>
            `;
            
            panel.classList.add('visible');
        }
        
        function addPolygonSelectionAsZamer() {
            selectedByPolygon.forEach(p => {
                if (!p.isZamer) {
                    const isStavebni = p.cislo.toLowerCase().startsWith('st');
                    pozemkyState.pozemkyZameru.push({
                        cislo: p.cislo,
                        katastr: p.ku,
                        kod: '747076',
                        plocha: p.plocha,
                        typ: isStavebni ? 'zastavena' : 'pozemkova'
                    });
                    p.isZamer = true;
                }
            });
            
            renderPozemkyZameru();
            renderMapParcely();
            updatePozemkyState();
            cancelPolygonSelect();
        }
        
        function addPolygonSelectionAsSoused() {
            selectedByPolygon.forEach(p => {
                if (!p.isSoused) {
                    pozemkyState.sousedniParcely.push({
                        cislo: p.cislo,
                        katastr: p.ku,
                        kod: '747076',
                        plocha: p.plocha
                    });
                    p.isSoused = true;
                }
            });
            
            renderSousedniParcely();
            renderMapParcely();
            updatePozemkyState();
            cancelPolygonSelect();
        }

        function toggleMapLayers() {
            // Placeholder pro budoucí funkcionalitu vrstev
            alert('Výběr vrstev: Parcely, Budovy, Ortofoto, BPEJ...\n\n(Funkce v přípravě)');
        }

        function selectNeighborMethod(method) {
            pozemkyState.method = method;
            
            // Update tlačítek - pouze pro sousední pozemky
            const sousedniSelector = document.getElementById('sousedniMethodSelector');
            sousedniSelector.querySelectorAll('.neighbor-method-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.method === method);
            });
            
            // Zobrazení správného obsahu
            document.getElementById('methodAuto').style.display = method === 'auto' ? 'block' : 'none';
            document.getElementById('methodRucne').style.display = method === 'rucne' ? 'block' : 'none';
            document.getElementById('methodMapa').style.display = method === 'mapa' ? 'block' : 'none';
            
            // Při volbě Z mapy přepnout viewer na záložku Mapa
            if (method === 'mapa') {
                const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
                if (mapTab) {
                    switchPozemkyTab(mapTab, 'mapa');
                }
            }
        }
        
        function autoDetectSousedni() {
            const btn = document.getElementById('btnAutoDetect');
            btn.disabled = true;
            btn.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span>Identifikuji sousedy...';
            
            setTimeout(function() {
                pozemkyState.sousedniParcely = [
                    { cislo: '248/1', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '890 m²' },
                    { cislo: '248/2', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '1 120 m²' },
                    { cislo: '249', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '2 340 m²' },
                    { cislo: 'st. 141', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '420 m²' },
                    { cislo: 'st. 143', katastr: 'Veselí nad Lužnicí', kod: '779091', plocha: '380 m²' }
                ];
                
                renderSousedniParcely();
                btn.disabled = false;
                btn.innerHTML = '<span class="material-icons-outlined">auto_awesome</span>Automaticky identifikovat sousedy';
                updatePozemkyState();
            }, 2000);
        }
        
        function loadSousedKatastralniUzemi() {
            const obecSelect = document.getElementById('sousedObec');
            const kuSelect = document.getElementById('sousedKU');
            const obec = obecSelect.value;
            
            // Reset k.ú. dropdown
            kuSelect.innerHTML = '<option value="">Vyberte k.ú....</option>';
            kuSelect.disabled = true;
            
            if (!obec) return;
            
            // Simulace načtení k.ú. podle obce
            const katastry = {
                'veseli': [
                    { value: 'veseli-779091', text: 'Veselí nad Lužnicí' },
                    { value: 'horusice-779091', text: 'Horusice' }
                ],
                'tabor': [
                    { value: 'tabor-764621', text: 'Tábor' },
                    { value: 'klokoty-764621', text: 'Klokoty' },
                    { value: 'chotoviny-764621', text: 'Chotoviny' }
                ],
                'soběslav': [
                    { value: 'sobeslav-752177', text: 'Soběslav' },
                    { value: 'chlebov-752177', text: 'Chlebov' }
                ]
            };
            
            if (katastry[obec]) {
                katastry[obec].forEach(ku => {
                    const option = document.createElement('option');
                    option.value = ku.value;
                    option.textContent = ku.text;
                    kuSelect.appendChild(option);
                });
                kuSelect.disabled = false;
            }
        }
        
        function addSousedniRucne() {
            const obecSelect = document.getElementById('sousedObec');
            const kuSelect = document.getElementById('sousedKU');
            const input = document.getElementById('sousedniSearchInput');
            const value = input.value.trim();
            
            if (!value) {
                alert('Zadejte číslo parcely.');
                return;
            }
            
            // Určení katastrálního území
            let katastr = 'Veselí nad Lužnicí';
            let kod = '779091';
            
            if (kuSelect.value) {
                katastr = kuSelect.options[kuSelect.selectedIndex].text;
                kod = kuSelect.value.split('-')[1] || '779091';
            }
            
            pozemkyState.sousedniParcely.push({
                cislo: value,
                katastr: katastr,
                kod: kod,
                plocha: '—'
            });
            
            renderSousedniParcely();
            updatePozemkyState();
            input.value = '';
        }
        
        function openMapForSousedni() {
            // Přepnutí na záložku Mapa ve vieweru
            const mapTab = document.querySelector('#controlPozemky .viewer-tab:nth-child(4)');
            if (mapTab) {
                switchPozemkyTab(mapTab, 'mapa');
            }
            alert('V ostré verzi by se zde otevřela katastrální mapa pro výběr sousedních pozemků kliknutím na parcely.');
        }

        function renderSousedniParcely() {
            const list = document.getElementById('sousedniList');
            const empty = document.getElementById('sousedniEmpty');
            const count = document.getElementById('sousedniCount');
            const viewMode = pozemkyState.viewModeSousedni;
            const sort = pozemkyState.sortSousedni;
            
            if (pozemkyState.sousedniParcely.length === 0) {
                if (empty) empty.style.display = 'block';
                count.textContent = '0 parcel';
                list.innerHTML = '<div class="sousedni-empty" id="sousedniEmpty"><span class="material-icons-outlined">grid_view</span><div class="sousedni-empty-text">Zatím nejsou identifikovány žádné sousední pozemky</div><div class="sousedni-empty-hint">Použijte některou z metod výše</div></div>';
            } else {
                const pocet = pozemkyState.sousedniParcely.length;
                count.textContent = pocet + ' ' + (pocet === 1 ? 'parcela' : pocet < 5 ? 'parcely' : 'parcel');
                
                let html = '';
                
                if (viewMode === 'chips') {
                    // Kompaktní chip zobrazení
                    html = '<div class="pozemky-chips-container">';
                    pozemkyState.sousedniParcely.forEach((p, index) => {
                        const icon = p.cislo.startsWith('st') ? 'crop_square' : 'grass';
                        html += `
                            <div class="pozemek-chip soused" title="k.ú. ${p.katastr} [${p.kod}]${p.plocha !== '—' ? ' • ' + p.plocha : ''}">
                                <span class="material-icons-outlined chip-icon">${icon}</span>
                                <span class="chip-parcela">${p.cislo}</span>
                                <span class="chip-ku">${p.katastr.substring(0, 8)}${p.katastr.length > 8 ? '…' : ''}</span>
                                <button class="chip-remove" onclick="removeSousedni(${index})" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                } else if (viewMode === 'grouped') {
                    // Seskupené zobrazení podle k.ú.
                    html = renderGroupedPozemky(pozemkyState.sousedniParcely, 'sousedni');
                } else {
                    // Řádkové zobrazení s hlavičkou
                    const parcelaSortClass = sort.field === 'cislo' ? (sort.asc ? 'active asc' : 'active') : '';
                    const katastrSortClass = sort.field === 'katastr' ? (sort.asc ? 'active asc' : 'active') : '';
                    
                    html = '<div class="pozemky-list-container">';
                    html += `
                        <div class="pozemky-list-header">
                            <span class="col-icon"></span>
                            <span class="header-col col-parcela ${parcelaSortClass}" onclick="sortPozemky('sousedni', 'cislo')">
                                Parcela
                                <span class="material-icons-outlined sort-icon">arrow_downward</span>
                            </span>
                            <span class="header-col col-katastr ${katastrSortClass}" onclick="sortPozemky('sousedni', 'katastr')">
                                Katastrální území
                                <span class="material-icons-outlined sort-icon">arrow_downward</span>
                            </span>
                            <span class="col-kod">Kód</span>
                            <span class="col-plocha">Plocha</span>
                            <span class="col-actions"></span>
                        </div>
                    `;
                    pozemkyState.sousedniParcely.forEach((p, index) => {
                        const icon = p.cislo.startsWith('st') ? 'crop_square' : 'grass';
                        html += `
                            <div class="pozemek-row soused">
                                <span class="material-icons-outlined row-icon">${icon}</span>
                                <span class="row-parcela">${p.cislo}</span>
                                <span class="row-katastr">${p.katastr}</span>
                                <span class="row-kod">[${p.kod}]</span>
                                <span class="row-plocha">${p.plocha}</span>
                                <button class="row-remove" onclick="removeSousedni(${index})" title="Odebrat">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                list.innerHTML = html;
            }
        }

        function removeSousedni(index) {
            pozemkyState.sousedniParcely.splice(index, 1);
            renderSousedniParcely();
            updatePozemkyState();
        }

        function searchSousedni() {
            const input = document.getElementById('sousedniSearchInput');
            const value = input.value.trim();
            if (!value) return;
            
            pozemkyState.sousedniParcely.push({
                cislo: value,
                katastr: 'Radonice',
                kod: '747076',
                plocha: '—'
            });
            
            renderSousedniParcely();
            input.value = '';
            updatePozemkyState();
        }

        function updatePozemkyState() {
            const btnConfirm = document.getElementById('btnConfirmPozemky');
            const resultBox = document.getElementById('resultPozemky');
            
            const hasPozemkyZameru = pozemkyState.pozemkyZameru.length > 0;
            const hasSousedni = pozemkyState.sousedniParcely.length > 0;
            
            // Tlačítko Potvrdit je aktivní, když jsou definovány pozemky záměru a sousední pozemky
            if (hasPozemkyZameru && hasSousedni) {
                btnConfirm.disabled = false;
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Pozemky identifikovány
                    </div>
                    <div class="result-preview-text">Pozemky záměru (${pozemkyState.pozemkyZameru.length}) a sousední pozemky (${pozemkyState.sousedniParcely.length}) byly identifikovány. Vlastníci budou určeni v části Osoby.</div>
                `;
            } else {
                btnConfirm.disabled = true;
                let missingText = [];
                if (!hasPozemkyZameru) missingText.push('pozemky záměru');
                if (!hasSousedni) missingText.push('sousední pozemky');
                
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Čeká na dokončení
                    </div>
                    <div class="result-preview-text">Chybí: ${missingText.join(', ')}.</div>
                `;
            }
        }

        function completePozemky() {
            controls.pozemky.done = true;
            controls.pozemky.result = 'ok';
            controls.pozemky.pozemkyZameru = pozemkyState.pozemkyZameru;
            controls.pozemky.sousedniParcely = pozemkyState.sousedniParcely;
            closeControl('controlPozemky');
            updateUI();
        }

        // ==========================================
        // KONTROLA ŽÁDOSTI (§ 184 SZ)
        // ==========================================
        function toggleDataStatus(button) {
            const row = button.closest('.data-row');
            const isOk = button.classList.contains('ok');
            
            if (isOk) {
                // Přepni na error
                button.classList.remove('ok');
                button.classList.add('error');
                button.innerHTML = '<span class="material-icons-outlined">cancel</span>';
                button.title = 'Označit jako v pořádku';
                row.classList.add('error');
            } else {
                // Přepni zpět na ok
                button.classList.remove('error');
                button.classList.add('ok');
                button.innerHTML = '<span class="material-icons-outlined">check_circle</span>';
                button.title = 'Označit jako vadné';
                row.classList.remove('error');
            }
            
            updateZadostResult();
        }

        function updateZadostResult() {
            const resultBox = document.getElementById('resultZadost');
            const btnConfirm = document.getElementById('btnConfirmZadost');
            const deficiencySection = document.getElementById('zadostDeficiencySection');
            
            // Počet položek označených jako vadné
            const errorButtons = document.querySelectorAll('#controlZadost .data-status.error');
            const errorCount = errorButtons.length;
            
            if (errorCount > 0) {
                // Zobraz sekci pro poznámku
                deficiencySection.style.display = 'block';
                
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Zjištěny vady v údajích
                    </div>
                    <div class="result-preview-text">${errorCount} ${errorCount === 1 ? 'položka označena' : (errorCount < 5 ? 'položky označeny' : 'položek označeno')} jako vadné. Bude vydána výzva k odstranění vad (§ 185 odst. 2).</div>
                `;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">mail</span>Potvrdit a vydat výzvu';
            } else {
                // Skryj sekci pro poznámku
                deficiencySection.style.display = 'none';
                
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Údaje v žádosti jsou v pořádku
                    </div>
                    <div class="result-preview-text">Všechny údaje byly zkontrolovány a jsou smysluplné.</div>
                `;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
            }
        }

        // ==========================================
        // ZNOVUPOUŽITELNÉ KOMPONENTY - NÁHLED ŽÁDOSTI
        // ==========================================
        
        // Generuje HTML pro strukturovaná data žádosti (read-only verze)
        function generateZadostDataReadOnly() {
            return `
                <div class="zadost-readonly-content">
                    <!-- 1. Údaje o podání -->
                    <div class="zadost-readonly-section">
                        <div class="zadost-readonly-header">
                            <span class="material-icons-outlined">assignment_ind</span>
                            Údaje o podání
                        </div>
                        <div class="zadost-readonly-grid">
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Podatel (kdo činí podání)</div>
                                <div class="zadost-readonly-value">Jan Novák</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Vztah k žadateli</div>
                                <div class="zadost-readonly-value">
                                    <span class="material-icons-outlined" style="font-size: 16px; color: #34a853; vertical-align: middle;">check_circle</span>
                                    Podatel je sám žadatel
                                </div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Věc podání</div>
                                <div class="zadost-readonly-value">Žádost o povolení stavby</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Správní orgán</div>
                                <div class="zadost-readonly-value">Dopravní a energetický stavební úřad</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2. Žadatel -->
                    <div class="zadost-readonly-section">
                        <div class="zadost-readonly-header">
                            <span class="material-icons-outlined">person</span>
                            Žadatel — Fyzická osoba
                        </div>
                        <div class="zadost-readonly-grid">
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Jméno a příjmení</div>
                                <div class="zadost-readonly-value">Jan Novák</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Datum narození</div>
                                <div class="zadost-readonly-value">15. 3. 1985</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Místo trvalého pobytu</div>
                                <div class="zadost-readonly-value">Květná 123, 110 00 Praha 1</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Datová schránka</div>
                                <div class="zadost-readonly-value">abc1234</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3. Identifikace záměru -->
                    <div class="zadost-readonly-section">
                        <div class="zadost-readonly-header">
                            <span class="material-icons-outlined">domain</span>
                            Identifikace záměru
                        </div>
                        <div class="zadost-readonly-grid">
                            <div class="zadost-readonly-item full-width">
                                <div class="zadost-readonly-label">Název záměru</div>
                                <div class="zadost-readonly-value">Novostavba rodinného domu</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Druh stavby</div>
                                <div class="zadost-readonly-value">Budova pro bydlení</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Účel stavby</div>
                                <div class="zadost-readonly-value">Rodinný dům</div>
                            </div>
                            <div class="zadost-readonly-item full-width">
                                <div class="zadost-readonly-label">Místo stavby</div>
                                <div class="zadost-readonly-value">ul. Sadová, Praha 4 - Kunratice</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 4. Pozemky -->
                    <div class="zadost-readonly-section">
                        <div class="zadost-readonly-header">
                            <span class="material-icons-outlined">grid_on</span>
                            Pozemky záměru
                        </div>
                        <div class="zadost-readonly-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Parcela</th>
                                        <th>Katastrální území</th>
                                        <th>Výměra</th>
                                        <th>Druh pozemku</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>1234/5</strong></td>
                                        <td>Kunratice [728390]</td>
                                        <td>850 m²</td>
                                        <td>Zahrada</td>
                                    </tr>
                                    <tr>
                                        <td><strong>1234/6</strong></td>
                                        <td>Kunratice [728390]</td>
                                        <td>120 m²</td>
                                        <td>Ostatní plocha</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 5. Charakteristika záměru -->
                    <div class="zadost-readonly-section">
                        <div class="zadost-readonly-header">
                            <span class="material-icons-outlined">architecture</span>
                            Charakteristika záměru
                        </div>
                        <div class="zadost-readonly-grid">
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Zastavěná plocha</div>
                                <div class="zadost-readonly-value">145 m²</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Obestavěný prostor</div>
                                <div class="zadost-readonly-value">890 m³</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Počet podlaží</div>
                                <div class="zadost-readonly-value">2 nadzemní</div>
                            </div>
                            <div class="zadost-readonly-item">
                                <div class="zadost-readonly-label">Počet bytů</div>
                                <div class="zadost-readonly-value">1</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Generuje HTML pro formulář žádosti (PDF simulace)
        function generateFormularPreview() {
            return `
                <div class="formular-preview">
                    <div class="formular-header">
                        <div class="formular-logo">
                            <span class="material-icons-outlined">account_balance</span>
                        </div>
                        <div class="formular-title-block">
                            <div class="formular-title">ŽÁDOST O POVOLENÍ STAVBY</div>
                            <div class="formular-subtitle">podle § 184 zákona č. 283/2021 Sb., stavební zákon</div>
                        </div>
                        <div class="formular-cislo">
                            <div class="formular-cislo-label">Číslo jednací</div>
                            <div class="formular-cislo-value">DESU-12345/2025</div>
                        </div>
                    </div>
                    
                    <div class="formular-section">
                        <div class="formular-section-title">ČÁST A – IDENTIFIKAČNÍ ÚDAJE</div>
                        
                        <div class="formular-subsection">
                            <div class="formular-subsection-title">A.1 Údaje o žadateli</div>
                            <div class="formular-fields">
                                <div class="formular-field">
                                    <div class="formular-field-label">Jméno a příjmení / Název</div>
                                    <div class="formular-field-value">Jan Novák</div>
                                </div>
                                <div class="formular-field">
                                    <div class="formular-field-label">Datum narození / IČO</div>
                                    <div class="formular-field-value">15. 3. 1985</div>
                                </div>
                                <div class="formular-field">
                                    <div class="formular-field-label">Adresa místa trvalého pobytu / Sídlo</div>
                                    <div class="formular-field-value">Květná 123, 110 00 Praha 1</div>
                                </div>
                                <div class="formular-field">
                                    <div class="formular-field-label">ID datové schránky</div>
                                    <div class="formular-field-value">abc1234</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="formular-subsection">
                            <div class="formular-subsection-title">A.2 Údaje o záměru</div>
                            <div class="formular-fields">
                                <div class="formular-field full-width">
                                    <div class="formular-field-label">Název záměru</div>
                                    <div class="formular-field-value">Novostavba rodinného domu</div>
                                </div>
                                <div class="formular-field">
                                    <div class="formular-field-label">Místo stavby</div>
                                    <div class="formular-field-value">ul. Sadová, Praha 4 - Kunratice</div>
                                </div>
                                <div class="formular-field">
                                    <div class="formular-field-label">Parcelní čísla</div>
                                    <div class="formular-field-value">1234/5, 1234/6</div>
                                </div>
                                <div class="formular-field">
                                    <div class="formular-field-label">Katastrální území</div>
                                    <div class="formular-field-value">Kunratice [728390]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="formular-section">
                        <div class="formular-section-title">ČÁST B – CHARAKTERISTIKA ZÁMĚRU</div>
                        <div class="formular-fields">
                            <div class="formular-field">
                                <div class="formular-field-label">Druh stavby</div>
                                <div class="formular-field-value">Budova pro bydlení</div>
                            </div>
                            <div class="formular-field">
                                <div class="formular-field-label">Účel stavby</div>
                                <div class="formular-field-value">Rodinný dům</div>
                            </div>
                            <div class="formular-field">
                                <div class="formular-field-label">Zastavěná plocha</div>
                                <div class="formular-field-value">145 m²</div>
                            </div>
                            <div class="formular-field">
                                <div class="formular-field-label">Obestavěný prostor</div>
                                <div class="formular-field-value">890 m³</div>
                            </div>
                            <div class="formular-field">
                                <div class="formular-field-label">Počet podlaží</div>
                                <div class="formular-field-value">2 nadzemní</div>
                            </div>
                            <div class="formular-field">
                                <div class="formular-field-label">Počet bytů</div>
                                <div class="formular-field-value">1</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="formular-footer">
                        <div class="formular-page-info">Strana 1 z 3</div>
                        <div class="formular-note">Náhled formuláře dle vyhlášky č. 149/2024 Sb.</div>
                    </div>
                </div>
            `;
        }
        
        // Inicializuje viewer v kontrole podle typu podání
        function initControlViewer(controlId) {
            const isVlozena = typPodaniZadosti === 'vlozena';
            
            if (controlId === 'controlPrislusnost') {
                // Záložky
                const tabsPortal = document.querySelectorAll('.prislusnost-tab-portal');
                const tabsVlozena = document.querySelectorAll('.prislusnost-tab-vlozena');
                
                tabsPortal.forEach(tab => tab.style.display = isVlozena ? 'none' : '');
                tabsVlozena.forEach(tab => tab.style.display = isVlozena ? '' : 'none');
                
                // Obsah
                const tabZadost = document.getElementById('prislusnostTabZadost');
                const tabFormular = document.getElementById('prislusnostTabFormular');
                
                if (isVlozena) {
                    // Vložená žádost - zobrazit formulář
                    if (tabZadost) tabZadost.style.display = 'none';
                    if (tabFormular) {
                        tabFormular.style.display = '';
                        tabFormular.innerHTML = generateFormularPreview();
                    }
                    // Aktivovat správnou záložku
                    document.querySelectorAll('#prislusnostViewerTabs .viewer-tab').forEach(t => t.classList.remove('active'));
                    document.querySelector('.prislusnost-tab-vlozena')?.classList.add('active');
                } else {
                    // Portál stavebníka - zobrazit strukturovaná data
                    if (tabFormular) tabFormular.style.display = 'none';
                    if (tabZadost) {
                        tabZadost.style.display = '';
                        tabZadost.innerHTML = generateZadostDataReadOnly();
                    }
                    // Aktivovat správnou záložku
                    document.querySelectorAll('#prislusnostViewerTabs .viewer-tab').forEach(t => t.classList.remove('active'));
                    document.querySelector('.prislusnost-tab-portal')?.classList.add('active');
                }
            }
        }
        
        // Přepínání záložek v kontrole Příslušnost
        function switchPrislusnostViewerTab(btn, tabName) {
            // Deaktivovat všechny záložky
            document.querySelectorAll('#prislusnostViewerTabs .viewer-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            // Skrýt všechny obsahy
            const tabs = ['prislusnostTabZadost', 'prislusnostTabFormular', 'prislusnostTabPrilohy', 'prislusnostTabDokumentace', 'prislusnostTabDoklady'];
            tabs.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
            
            // Zobrazit vybraný obsah
            let targetId;
            switch(tabName) {
                case 'zadost': targetId = 'prislusnostTabZadost'; break;
                case 'formular': targetId = 'prislusnostTabFormular'; break;
                case 'prilohy': targetId = 'prislusnostTabPrilohy'; break;
                case 'dokumentace': targetId = 'prislusnostTabDokumentace'; break;
                case 'doklady': targetId = 'prislusnostTabDoklady'; break;
            }
            
            const target = document.getElementById(targetId);
            if (target) {
                target.style.display = '';
                // Inicializovat obsah pokud je prázdný
                if (tabName === 'zadost' && !target.innerHTML.trim()) {
                    target.innerHTML = generateZadostDataReadOnly();
                }
                if (tabName === 'formular' && !target.innerHTML.trim()) {
                    target.innerHTML = generateFormularPreview();
                }
            }
        }

        // ==========================================
        // PLATNOST PRÁVNÍ ÚPRAVY
        // ==========================================
        
        // Platnost: 'do2027' = Do 31.12.2027, 'od2028' = Od 1.1.2028
        let platnostPravniUpravy = 'do2027';
        
        // Aplikovat platnost
        function applyPlatnost(platnost) {
            platnostPravniUpravy = platnost;
            
            // Aktualizovat URL
            const url = new URL(window.location);
            url.searchParams.set('platnost', platnost);
            history.replaceState({}, '', url);
            
            // Aktualizovat zobrazení v simInfo
            updateSimInfoPlatnost();
            
            // Aplikovat změny v UI podle platnosti
            applyPlatnostChanges();
            
            console.log('Platnost právní úpravy změněna na:', platnost);
        }
        
        // Aplikovat změny v UI podle platnosti právní úpravy
        function applyPlatnostChanges() {
            const isOd2028 = platnostPravniUpravy === 'od2028';
            
            // === 1. KONTROLA PŘÍSLUŠNOSTI ===
            
            // Karta příslušnosti - upravit popis
            const cardPrislusnostDesc = document.querySelector('#card-prislusnost .control-card-desc');
            if (cardPrislusnostDesc) {
                if (isOd2028) {
                    cardPrislusnostDesc.textContent = 'Potvrzení přijetí k vyřízení (jednotná stavební správa)';
                } else {
                    cardPrislusnostDesc.textContent = 'Ověření věcné a místní příslušnosti stavebního úřadu';
                }
            }
            
            // Možnost "Nepříslušný" - skrýt/zobrazit
            const optionNeprislusny = document.getElementById('optionNeprislusny');
            if (optionNeprislusny) {
                optionNeprislusny.style.display = isOd2028 ? 'none' : '';
            }
            
            // Popis možnosti "Příslušný" - upravit
            const optionPrislusnyDesc = document.getElementById('optionPrislusnyDesc');
            if (optionPrislusnyDesc) {
                if (isOd2028) {
                    optionPrislusnyDesc.textContent = 'Žádost je přijata k vyřízení v rámci jednotné státní stavební správy';
                } else {
                    optionPrislusnyDesc.textContent = 'Stavební úřad je věcně i místně příslušný k projednání žádosti';
                }
            }
            
            // Info box o jednotné stavební správě
            const infoJednotnaSprava = document.getElementById('infoJednotnaSprava');
            if (infoJednotnaSprava) {
                infoJednotnaSprava.style.display = isOd2028 ? 'flex' : 'none';
            }
            
            // Sekce výběru SÚ pro postoupení - skrýt při od2028
            const vyberSuSection = document.getElementById('vyberSuSection');
            if (vyberSuSection && isOd2028) {
                vyberSuSection.style.display = 'none';
            }
            
            // Sekce zdůvodnění nepříslušnosti - skrýt při od2028
            const zduvodneniSection = document.getElementById('zduvodneniNeprislusnostiSection');
            if (zduvodneniSection && isOd2028) {
                zduvodneniSection.style.display = 'none';
            }
            
            // === 2. IDENTIFIKACE DO - DOKLADOVÁ ČÁST ===
            
            // Info box o integrovaných DO
            const infoIntegrovaneDO = document.getElementById('infoIntegrovaneDO');
            if (infoIntegrovaneDO) {
                infoIntegrovaneDO.style.display = isOd2028 ? 'flex' : 'none';
            }
            
            // === 3. KARTA DOKLADOVÁ ČÁST ===
            
            // Popis karty dokladové části (ID je card-identifikace)
            const cardDokladyDesc = document.querySelector('#card-identifikace .control-card-desc');
            if (cardDokladyDesc) {
                if (isOd2028) {
                    cardDokladyDesc.textContent = 'Integrovaná stanoviska JSSÚ a vyjádření správců sítí';
                } else {
                    cardDokladyDesc.textContent = 'Stanoviska DO a vyjádření vlastníků sítí';
                }
            }
            
            // === 4. ZÁLOŽKA DOTČENÉ ORGÁNY V KONTROLE OSOBY ===
            
            // Info box v záložce Dotčené orgány
            const infoIntegrovaneDOOsoby = document.getElementById('infoIntegrovaneDOOsoby');
            if (infoIntegrovaneDOOsoby) {
                infoIntegrovaneDOOsoby.style.display = isOd2028 ? 'flex' : 'none';
            }
            
            // Toolbar a tabulka dotčených orgánů - skrýt při od2028
            const toolbarDotceneOrgany = document.getElementById('toolbarDotceneOrgany');
            const tableDotceneOrgany = document.getElementById('tableDotceneOrgany');
            if (toolbarDotceneOrgany) {
                toolbarDotceneOrgany.style.display = isOd2028 ? 'none' : '';
            }
            if (tableDotceneOrgany) {
                tableDotceneOrgany.style.display = isOd2028 ? 'none' : '';
            }
            
            // Pokud je volba "nepříslušný" aktivní a přepneme na od2028, resetovat na příslušný
            if (isOd2028) {
                const prislusnyRadio = document.querySelector('input[name="prislusnost"][value="prislusny"]');
                if (prislusnyRadio && !prislusnyRadio.checked) {
                    prislusnyRadio.checked = true;
                    const optionPrislusny = document.getElementById('optionPrislusny');
                    if (optionPrislusny) {
                        document.querySelectorAll('.control-option').forEach(o => o.classList.remove('selected'));
                        optionPrislusny.classList.add('selected');
                    }
                }
            }
        }
        
        // Aktualizovat zobrazení simInfo pro platnost
        function updateSimInfoPlatnost() {
            const simInfoPlatnost = document.getElementById('simInfoPlatnost');
            if (simInfoPlatnost) {
                simInfoPlatnost.textContent = platnostPravniUpravy === 'do2027' ? 'Do 31. 12. 2027' : 'Od 1. 1. 2028';
            }
        }
        
        // ==========================================
        // TYP PODÁNÍ ŽÁDOSTI
        // ==========================================
        
        // Typ podání: 'portal' = Portál stavebníka, 'vlozena' = Vložená žádost
        let typPodaniZadosti = 'portal';
        
        // Aplikovat typ podání
        function applyTypPodani(typ) {
            typPodaniZadosti = typ;
            
            // Aktualizovat URL
            const url = new URL(window.location);
            url.searchParams.set('typPodani', typ);
            history.replaceState({}, '', url);
            
            // Aktualizovat zobrazení v simInfo
            updateSimInfo();
            
            console.log('Typ podání změněn na:', typ);
        }
        
        // Rychlost řízení
        let rychlostRizeni = 'zrychlene';
        
        function applyRychlostRizeni(typ, showToast = true) {
            rychlostRizeni = typ;
            
            // Aktualizovat URL
            const url = new URL(window.location);
            url.searchParams.set('rychlost', typ);
            history.replaceState({}, '', url);
            
            // Zobrazit/skrýt kartu Zrychlené řízení
            const cardZrychlene = document.getElementById('card-zrychlene');
            if (cardZrychlene) {
                if (typ === 'standardni') {
                    cardZrychlene.style.display = 'none';
                } else {
                    cardZrychlene.style.display = '';
                    updateZrychleneRizeniState();
                }
            }
            
            // Zobrazit/skrýt badge Zrychlené řízení v hlavičce
            const badgeZrychlene = document.getElementById('badgeZrychlene');
            if (badgeZrychlene) {
                badgeZrychlene.style.display = typ === 'standardni' ? 'none' : 'inline-flex';
            }
            
            // Aktualizovat zobrazení v simInfo
            updateSimInfo();
            
            if (showToast) {
                showSimToast(typ === 'zrychlene' ? 'Zrychlené řízení' : 'Standardní řízení');
            }
        }
        
        // Aktualizace stavu kontroly Zrychlené řízení
        function updateZrychleneRizeniState() {
            if (rychlostRizeni !== 'zrychlene') return;
            
            const cardZrychlene = document.getElementById('card-zrychlene');
            if (!cardZrychlene) return;
            
            // Kontrola, zda některá kontrola má nedostatky vedoucí k postoupení, přerušení nebo ukončení
            const hasBlockingIssue = checkForBlockingIssues();
            
            if (hasBlockingIssue) {
                // Deaktivovat kontrolu - nelze provést zrychlené řízení
                cardZrychlene.classList.remove('status-waiting', 'status-ready', 'status-done', 'status-warning');
                cardZrychlene.classList.add('disabled', 'status-blocked');
                
                // Aktualizovat popisek a badge
                const descEl = cardZrychlene.querySelector('.control-card-desc');
                if (descEl) {
                    descEl.textContent = 'Nelze provést — zjištěny blokující nedostatky';
                }
                
                const statusBadge = cardZrychlene.querySelector('.control-card-status');
                if (statusBadge) {
                    statusBadge.textContent = 'Blokováno';
                }
                
                const actionBtn = cardZrychlene.querySelector('.control-card-action');
                if (actionBtn) {
                    actionBtn.innerHTML = '<span class="material-icons-outlined">block</span>Nelze provést';
                    actionBtn.onclick = null;
                }
            } else {
                // Odebrat status blocked
                cardZrychlene.classList.remove('status-blocked');
                
                // Obnovit původní popisek
                const descEl = cardZrychlene.querySelector('.control-card-desc');
                if (descEl && !controls.zrychlene.done) {
                    descEl.textContent = 'Splnění podmínek pro zrychlené řízení';
                }
            }
        }
        
        // Kontrola blokujících problémů (postoupení, přerušení, ukončení)
        function checkForBlockingIssues() {
            // Kontrola výsledků kontrol - postoupení, odložení, zastavení
            const blockingResults = ['postoupeno', 'preruseno', 'zastaveno', 'ukonceno', 'error', 'odlozeno'];
            
            for (const controlId in controls) {
                const control = controls[controlId];
                if (control.done && blockingResults.includes(control.result)) {
                    return true;
                }
            }
            
            // Kontrola SÚ nepříslušný
            if (controls.prislusnost && controls.prislusnost.done && controls.prislusnost.result !== 'ok') {
                return true;
            }
            
            return false;
        }
        
        // Aktualizovat zobrazení simInfo
        function updateSimInfo() {
            const simInfoPodani = document.getElementById('simInfoPodani');
            if (simInfoPodani) {
                simInfoPodani.textContent = typPodaniZadosti === 'portal' ? 'Portál stavebníka' : 'Vložená žádost';
            }
            
            const simInfoRychlost = document.getElementById('simInfoRychlost');
            if (simInfoRychlost) {
                simInfoRychlost.textContent = rychlostRizeni === 'zrychlene' ? 'Zrychlené řízení' : 'Standardní řízení';
            }
        }
        
        // Inicializace režimu kontroly žádosti podle typu podání
        function initZadostControlMode() {
            const tabZadost = document.getElementById('tabZadost');
            const tabFormular = document.getElementById('tabFormular');
            const tabPrilohy = document.getElementById('tabPrilohy');
            const btnVseOk = document.getElementById('btnVseOkZadost');
            
            // Resetovat aktivní stav všech záložek a panelů
            document.querySelectorAll('.zadost-data-viewer .viewer-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.zadost-data-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.zadost-panel-mode').forEach(m => m.classList.remove('active'));
            
            if (typPodaniZadosti === 'portal') {
                // Portál stavebníka - zobrazit pouze záložku Žádost
                if (tabZadost) {
                    tabZadost.style.display = '';
                    tabZadost.classList.add('active');
                }
                if (tabFormular) tabFormular.style.display = 'none';
                if (tabPrilohy) tabPrilohy.style.display = 'none';
                if (btnVseOk) btnVseOk.style.display = '';
                
                // Aktivovat panel Žádost
                document.getElementById('zadostDataZadost').classList.add('active');
                document.getElementById('panelModeZadost').classList.add('active');
            } else {
                // Vložená žádost - zobrazit záložky Formulář žádosti a Přílohy
                if (tabZadost) tabZadost.style.display = 'none';
                if (tabFormular) {
                    tabFormular.style.display = '';
                    tabFormular.classList.add('active');
                }
                if (tabPrilohy) tabPrilohy.style.display = '';
                if (btnVseOk) btnVseOk.style.display = 'none';
                
                // Aktivovat panel Formulář
                document.getElementById('zadostDataFormular').classList.add('active');
                document.getElementById('panelModeFormular').classList.add('active');
            }
        }

        // ==========================================
        // KONTROLA ŽÁDOSTI - NOVÝ DESIGN
        // ==========================================
        
        // Sledování aktuálního režimu (zadost/formular)
        let currentZadostMode = 'zadost';
        
        // Přepínání záložek v levém okně (strukturovaná data)
        function switchZadostDataTab(btn, tabName) {
            // Deaktivovat všechny záložky
            document.querySelectorAll('.zadost-data-viewer .viewer-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.zadost-data-tab').forEach(t => t.classList.remove('active'));
            
            // Aktivovat vybranou
            btn.classList.add('active');
            let tabId;
            if (tabName === 'zadost') tabId = 'zadostDataZadost';
            else if (tabName === 'formular') tabId = 'zadostDataFormular';
            else if (tabName === 'prilohy') tabId = 'zadostDataPrilohy';
            else if (tabName === 'doklady') tabId = 'zadostDataDoklady';
            else tabId = 'zadostDataZadost'; // fallback
            document.getElementById(tabId).classList.add('active');
            
            // Přepnout pravý panel podle režimu
            document.querySelectorAll('.zadost-panel-mode').forEach(m => m.classList.remove('active'));
            
            const tabPrilohy = document.getElementById('tabPrilohy');
            const btnVseOk = document.getElementById('btnVseOkZadost');
            
            if (tabName === 'formular' || tabName === 'prilohy') {
                document.getElementById('panelModeFormular').classList.add('active');
                // Skrýt tlačítko "Vše v pořádku" v režimu formuláře
                if (btnVseOk) btnVseOk.style.display = 'none';
                // Zobrazit záložku Přílohy
                if (tabPrilohy) {
                    tabPrilohy.style.display = '';
                    tabPrilohy.classList.remove('tab-disabled');
                }
                currentZadostMode = 'formular';
            } else if (tabName === 'doklady') {
                // Záložka Doklady - ponechat aktuální režim panelu
                const currentPanel = currentZadostMode === 'formular' ? 'panelModeFormular' : 'panelModeZadost';
                document.getElementById(currentPanel).classList.add('active');
            } else {
                document.getElementById('panelModeZadost').classList.add('active');
                // Zobrazit tlačítko "Vše v pořádku" v režimu žádosti
                if (btnVseOk) btnVseOk.style.display = '';
                // Skrýt záložku Přílohy
                if (tabPrilohy) {
                    tabPrilohy.style.display = 'none';
                }
                currentZadostMode = 'zadost';
            }
        }
        
        // Stav kontroly sekcí žádosti
        const zadostSectionState = {
            podani: null,
            zadatel: null,
            zastupce: null,
            zamer: null,
            charakteristika: null,
            podrobnosti: null,
            pozemky: null,
            prilohy: null,
            vyjimky: null
        };
        
        const sectionNames = {
            podani: 'Údaje o podání',
            zadatel: 'Žadatel',
            zastupce: 'Zástupce',
            zamer: 'Identifikace záměru',
            charakteristika: 'Charakteristika záměru',
            podrobnosti: 'Podrobnější informace',
            pozemky: 'Pozemky záměru',
            prilohy: 'Přílohy žádosti',
            vyjimky: 'Výjimky z požadavků'
        };
        
        // Sledování, zda je sekce Zástupce relevantní pro aktuální scénář
        let zastupceRelevant = false;
        
        // Nastavení stavu sekce
        function setSectionStatus(sectionId, status) {
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            if (!section) return;
            
            const statusDiv = document.getElementById('sectionStatus' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const badge = document.getElementById('statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const btnOk = section.querySelector('.btn-ok');
            const btnVada = section.querySelector('.btn-vada');
            
            if (!statusDiv || !badge) return;
            
            // Reset
            section.classList.remove('status-ok', 'status-vada');
            if (btnOk) btnOk.classList.remove('active');
            if (btnVada) btnVada.classList.remove('active');
            badge.className = 'section-status-badge';
            badge.textContent = '';
            
            // Nastavit nový stav
            if (status === 'ok') {
                zadostSectionState[sectionId] = 'ok';
                section.classList.add('status-ok');
                if (btnOk) btnOk.classList.add('active');
                statusDiv.innerHTML = '<span class="material-icons-outlined">check_circle</span> V pořádku';
                statusDiv.className = 'zadost-section-status status-ok';
                badge.classList.add('ok');
                badge.textContent = '✓';
                
                // Propojení: Pokud potvrdím Podání u REZA/statutár, automaticky potvrdit i Zástupce
                if (sectionId === 'podani' && !zastupceRelevant) {
                    // Sekce Zástupce není relevantní, automaticky nastavit na OK
                    const zastSection = document.querySelector('[data-section-id="zastupce"]');
                    if (zastSection && zadostSectionState.zastupce !== 'ok') {
                        setSectionStatus('zastupce', 'ok');
                    }
                }
            } else if (status === 'vada') {
                zadostSectionState[sectionId] = 'vada';
                section.classList.add('status-vada');
                if (btnVada) btnVada.classList.add('active');
                statusDiv.innerHTML = '<span class="material-icons-outlined">error</span> Označeno jako vada';
                statusDiv.className = 'zadost-section-status status-vada';
                badge.classList.add('vada');
                badge.textContent = '!';
                
                // Otevřít panel pro editaci vady
                showDeficiencyEditor(sectionId);
            } else if (status === 'auto-ok') {
                // Automaticky nastaveno na OK (bez možnosti změny)
                zadostSectionState[sectionId] = 'ok';
                section.classList.add('status-ok');
                statusDiv.innerHTML = '<span class="material-icons-outlined">check_circle</span> Automaticky ověřeno';
                statusDiv.className = 'zadost-section-status status-ok';
                badge.classList.add('ok');
                badge.textContent = '✓';
            } else {
                zadostSectionState[sectionId] = null;
                statusDiv.innerHTML = '<span class="material-icons-outlined">radio_button_unchecked</span> Nezkontrolováno';
                statusDiv.className = 'zadost-section-status';
            }
            
            updateDeficiencyPanel();
        }
        
        // Nastavit sekci jako automaticky ověřenou (skrýt tlačítka)
        function setSectionAutoOk(sectionId, reason) {
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            if (!section) return;
            
            zadostSectionState[sectionId] = 'ok';
            section.classList.add('status-ok');
            
            const statusDiv = document.getElementById('sectionStatus' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const badge = document.getElementById('statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const actionsDiv = section.querySelector('.zadost-section-actions');
            
            if (statusDiv) {
                statusDiv.innerHTML = `<span class="material-icons-outlined">check_circle</span> ${reason}`;
                statusDiv.className = 'zadost-section-status status-ok';
            }
            if (badge) {
                badge.className = 'section-status-badge ok';
                badge.textContent = '✓';
            }
            if (actionsDiv) {
                actionsDiv.style.display = 'none';
            }
        }
        
        // Resetovat sekci na standardní stav s tlačítky
        function resetSectionControls(sectionId) {
            const section = document.querySelector(`[data-section-id="${sectionId}"]`);
            if (!section) return;
            
            const actionsDiv = section.querySelector('.zadost-section-actions');
            if (actionsDiv) {
                actionsDiv.style.display = 'flex';
            }
            
            zadostSectionState[sectionId] = null;
            section.classList.remove('status-ok', 'status-vada');
            
            const statusDiv = document.getElementById('sectionStatus' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            const badge = document.getElementById('statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1));
            
            if (statusDiv) {
                statusDiv.innerHTML = '<span class="material-icons-outlined">radio_button_unchecked</span> Nezkontrolováno';
                statusDiv.className = 'zadost-section-status';
            }
            if (badge) {
                badge.className = 'section-status-badge';
                badge.textContent = '';
            }
        }
        
        // Nastavit všechny sekce na OK najednou
        function setAllSectionsOk() {
            const allSections = ['podani', 'zadatel', 'zastupce', 'zamer', 'charakteristika', 'podrobnosti', 'pozemky', 'prilohy', 'vyjimky'];
            
            allSections.forEach(sectionId => {
                const section = document.querySelector(`[data-section-id="${sectionId}"]`);
                // Přeskočit skryté sekce
                if (!section || section.style.display === 'none') return;
                // Přeskočit již nastavené sekce
                if (zadostSectionState[sectionId] === 'ok') return;
                
                // Nastavit na OK
                setSectionStatus(sectionId, 'ok');
            });
            
            // Vizuální potvrzení
            const btn = document.querySelector('.btn-vse-ok');
            if (btn) {
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="material-icons-outlined">check</span> Hotovo!';
                btn.style.background = '#137333';
                btn.style.color = '#fff';
                btn.style.borderColor = '#137333';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                    btn.style.color = '';
                    btn.style.borderColor = '';
                }, 1500);
            }
        }
        
        // Zobrazit editor nedostatku
        function showDeficiencyEditor(sectionId) {
            // Přepnout na deficiency list
            document.getElementById('deficiencyEmpty').style.display = 'none';
            document.getElementById('deficiencyList').style.display = 'block';
        }
        
        // Aktualizovat panel nedostatků
        function updateDeficiencyPanel() {
            let okCount = 0;
            let vadaCount = 0;
            let pendingCount = 0;
            
            const deficiencies = [];
            
            for (const [key, value] of Object.entries(zadostSectionState)) {
                // Přeskočit sekce které nejsou viditelné
                const section = document.querySelector(`[data-section-id="${key}"]`);
                if (!section || section.style.display === 'none') continue;
                
                if (value === 'ok') okCount++;
                else if (value === 'vada') {
                    vadaCount++;
                    deficiencies.push(key);
                }
                else pendingCount++;
            }
            
            // Aktualizovat statistiky
            document.getElementById('statOkCount').textContent = okCount;
            document.getElementById('statVadaCount').textContent = vadaCount;
            document.getElementById('statPendingCount').textContent = pendingCount;
            
            // Aktualizovat seznam nedostatků
            const listEl = document.getElementById('deficiencyList');
            const emptyEl = document.getElementById('deficiencyEmpty');
            
            if (deficiencies.length === 0) {
                listEl.style.display = 'none';
                emptyEl.style.display = 'block';
            } else {
                listEl.style.display = 'block';
                emptyEl.style.display = 'none';
                
                let html = '';
                deficiencies.forEach(sectionId => {
                    html += `
                        <div class="deficiency-item" data-section="${sectionId}">
                            <div class="deficiency-item-header">
                                <div class="deficiency-item-section">${sectionNames[sectionId]}</div>
                                <button class="deficiency-item-remove" onclick="setSectionStatus('${sectionId}', null)" title="Odebrat vadu">
                                    <span class="material-icons-outlined">close</span>
                                </button>
                            </div>
                            <textarea class="deficiency-item-textarea" placeholder="Popište zjištěný nedostatek pro výzvu k doplnění..." 
                                oninput="updateDeficiencyNote('${sectionId}', this.value)">${zadostDeficiencyNotes[sectionId] || ''}</textarea>
                        </div>
                    `;
                });
                listEl.innerHTML = html;
            }
            
            // Aktualizovat výsledek
            const resultEl = document.getElementById('deficiencyResult');
            const btnConfirm = document.getElementById('btnConfirmZadost');
            
            if (pendingCount > 0) {
                resultEl.className = 'deficiency-result pending';
                resultEl.innerHTML = `
                    <span class="material-icons-outlined">hourglass_empty</span>
                    <div>
                        <strong>Kontrola probíhá</strong>
                        <div style="font-size: 11px; margin-top: 2px;">Zbývá zkontrolovat ${pendingCount} ${pendingCount === 1 ? 'sekci' : (pendingCount < 5 ? 'sekce' : 'sekcí')}</div>
                    </div>
                `;
                btnConfirm.disabled = true;
            } else if (vadaCount > 0) {
                resultEl.className = 'deficiency-result negative';
                resultEl.innerHTML = `
                    <span class="material-icons-outlined">error</span>
                    <div>
                        <strong>Žádost má nedostatky</strong>
                        <div style="font-size: 11px; margin-top: 2px;">Nalezeno ${vadaCount} ${vadaCount === 1 ? 'vada' : (vadaCount < 5 ? 'vady' : 'vad')} — bude vydána výzva k doplnění</div>
                    </div>
                `;
                btnConfirm.disabled = false;
            } else {
                resultEl.className = 'deficiency-result positive';
                resultEl.innerHTML = `
                    <span class="material-icons-outlined">check_circle</span>
                    <div>
                        <strong>Žádost je úplná</strong>
                        <div style="font-size: 11px; margin-top: 2px;">Všechny sekce zkontrolovány bez závad</div>
                    </div>
                `;
                btnConfirm.disabled = false;
            }
        }
        
        // Poznámky k nedostatkům
        const zadostDeficiencyNotes = {};
        
        function updateDeficiencyNote(sectionId, value) {
            zadostDeficiencyNotes[sectionId] = value;
        }
        
        // Dokončit kontrolu žádosti
        function completeZadostKontrola() {
            controls.zadost.done = true;
            
            // Spočítat vady z nového stavu sekcí
            let vadaCount = 0;
            const deficiencyNotes = [];
            
            for (const [key, value] of Object.entries(zadostSectionState)) {
                if (value === 'vada') {
                    vadaCount++;
                    if (zadostDeficiencyNotes[key]) {
                        deficiencyNotes.push(`${sectionNames[key]}: ${zadostDeficiencyNotes[key]}`);
                    }
                }
            }
            
            if (vadaCount > 0) {
                controls.zadost.result = 'vady';
                controls.zadost.deficiencyNote = deficiencyNotes.join('\n');
            } else {
                controls.zadost.result = 'ok';
            }
            
            closeControl('controlZadost');
            updateUI();
        }

        function completeZadost() {
            completeZadostKontrola();
        }

        // ==========================================
        // KONTROLA FORMULÁŘE - checklist režim
        // ==========================================
        
        // Stav kontroly kroků formuláře
        const formularStepState = {
            podani: null,
            zadatel: null,
            zastupce: null,
            zamer: null,
            pozemky: null,
            prilohy: null
        };
        
        const formularStepNames = {
            podani: 'Údaje o podání',
            zadatel: 'Žadatel',
            zastupce: 'Zástupce',
            zamer: 'Identifikace záměru',
            pozemky: 'Pozemky záměru',
            prilohy: 'Přílohy žádosti'
        };
        
        // Poznámky k vadám formuláře
        const formularVadaNotes = {};
        
        // Nastavení stavu kroku formuláře
        function setFormularStepStatus(stepId, status) {
            const capitalizedId = stepId.charAt(0).toUpperCase() + stepId.slice(1);
            const item = document.getElementById('formularCheck' + capitalizedId);
            if (!item) return;
            
            // Odstranit předchozí stav
            item.classList.remove('status-ok', 'status-vada', 'status-skip');
            
            // Nastavit nový stav
            formularStepState[stepId] = status;
            
            // Aktualizovat vzhled položky
            const statusEl = document.getElementById('formularStatus' + capitalizedId);
            const vadaInput = document.getElementById('formularVadaInput' + capitalizedId);
            const changeBtn = document.getElementById('formularChange' + capitalizedId);
            
            if (status === 'ok') {
                item.classList.add('status-ok');
                statusEl.innerHTML = '<span class="material-icons-outlined">check_circle</span>';
                if (vadaInput) vadaInput.style.display = 'none';
                if (changeBtn) changeBtn.style.display = 'block';
            } else if (status === 'vada') {
                item.classList.add('status-vada');
                statusEl.innerHTML = '<span class="material-icons-outlined">error</span>';
                if (vadaInput) vadaInput.style.display = 'block';
                if (changeBtn) changeBtn.style.display = 'block';
            } else if (status === 'skip') {
                item.classList.add('status-skip');
                statusEl.innerHTML = '<span class="material-icons-outlined">remove_circle_outline</span>';
                if (vadaInput) vadaInput.style.display = 'none';
                if (changeBtn) changeBtn.style.display = 'block';
            }
            
            updateFormularSummary();
        }
        
        // Reset stavu kroku formuláře (tlačítko Změnit)
        function resetFormularStepStatus(stepId) {
            const capitalizedId = stepId.charAt(0).toUpperCase() + stepId.slice(1);
            const item = document.getElementById('formularCheck' + capitalizedId);
            if (!item) return;
            
            // Odstranit stav
            item.classList.remove('status-ok', 'status-vada', 'status-skip');
            formularStepState[stepId] = null;
            
            // Reset vzhledu
            const statusEl = document.getElementById('formularStatus' + capitalizedId);
            const vadaInput = document.getElementById('formularVadaInput' + capitalizedId);
            const changeBtn = document.getElementById('formularChange' + capitalizedId);
            const textarea = document.getElementById('formularVadaText' + capitalizedId);
            
            statusEl.innerHTML = '<span class="material-icons-outlined">radio_button_unchecked</span>';
            if (vadaInput) vadaInput.style.display = 'none';
            if (changeBtn) changeBtn.style.display = 'none';
            if (textarea) textarea.value = '';
            
            updateFormularSummary();
        }
        
        // Označit všechny kroky formuláře jako v pořádku
        function setAllFormularStepsOk() {
            for (const stepId of Object.keys(formularStepState)) {
                setFormularStepStatus(stepId, 'ok');
            }
        }
        
        // Aktualizace souhrnu kontroly formuláře
        function updateFormularSummary() {
            let okCount = 0;
            let vadaCount = 0;
            let pendingCount = 0;
            
            for (const [key, value] of Object.entries(formularStepState)) {
                if (value === 'ok' || value === 'skip') {
                    okCount++;
                } else if (value === 'vada') {
                    vadaCount++;
                } else {
                    pendingCount++;
                }
            }
            
            document.getElementById('formularOkCount').textContent = okCount;
            document.getElementById('formularVadaCount').textContent = vadaCount;
            
            const resultEl = document.getElementById('formularResult');
            const btnConfirm = document.getElementById('btnConfirmFormular');
            
            // Kontrola je dokončena, když všechny kroky mají stav
            const allChecked = pendingCount === 0;
            
            if (allChecked) {
                if (vadaCount > 0) {
                    resultEl.className = 'deficiency-result negative';
                    resultEl.innerHTML = `
                        <span class="material-icons-outlined">warning</span>
                        <div>
                            <strong>Zjištěny nedostatky</strong>
                            <div style="font-size: 11px; margin-top: 2px;">Formulář obsahuje ${vadaCount} vad</div>
                        </div>
                    `;
                } else {
                    resultEl.className = 'deficiency-result positive';
                    resultEl.innerHTML = `
                        <span class="material-icons-outlined">check_circle</span>
                        <div>
                            <strong>Kontrola úspěšná</strong>
                            <div style="font-size: 11px; margin-top: 2px;">Formulář je v pořádku</div>
                        </div>
                    `;
                }
                btnConfirm.disabled = false;
            } else {
                resultEl.className = 'deficiency-result pending';
                resultEl.innerHTML = `
                    <span class="material-icons-outlined">hourglass_empty</span>
                    <div>
                        <strong>Kontrola probíhá</strong>
                        <div style="font-size: 11px; margin-top: 2px;">Zbývá zkontrolovat ${pendingCount} částí</div>
                    </div>
                `;
                btnConfirm.disabled = true;
            }
        }
        
        // Dokončit kontrolu formuláře
        function completeFormularKontrola() {
            controls.zadost.done = true;
            
            // Spočítat vady
            let vadaCount = 0;
            const deficiencyNotes = [];
            
            for (const [key, value] of Object.entries(formularStepState)) {
                if (value === 'vada') {
                    vadaCount++;
                    const textarea = document.getElementById('formularVadaText' + key.charAt(0).toUpperCase() + key.slice(1));
                    if (textarea && textarea.value.trim()) {
                        formularVadaNotes[key] = textarea.value.trim();
                        deficiencyNotes.push(`${formularStepNames[key]}: ${textarea.value.trim()}`);
                    }
                }
            }
            
            if (vadaCount > 0) {
                controls.zadost.result = 'vady';
                controls.zadost.deficiencyNote = deficiencyNotes.join('\n');
            } else {
                controls.zadost.result = 'ok';
            }
            
            closeControl('controlZadost');
            updateUI();
        }

        // ==========================================
        // PŘÍSLUŠNOST - update result
        // ==========================================
        function updatePrislusnostResult() {
            const prislusnost = document.querySelector('input[name="prislusnost"]:checked').value;
            const resultBox = document.getElementById('resultPrislusnost');
            const vyberSuSection = document.getElementById('vyberSuSection');
            const zduvodneniSection = document.getElementById('zduvodneniNeprislusnostiSection');

            // Při změně na příslušný - reset výběru
            if (prislusnost === 'prislusny') {
                vyberSuSection.classList.remove('visible');
                document.getElementById('postoupitSuSelect').value = '';
                document.getElementById('postoupitSuSearchInput').value = '';
                document.getElementById('postoupitSuInfo').classList.remove('visible');
                
                // Skrýt zdůvodnění
                if (zduvodneniSection) {
                    zduvodneniSection.style.display = 'none';
                }
                
                // Zobrazit pozitivní výsledek
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Příslušnost potvrzena
                    </div>
                    <div class="result-preview-text">Stavební úřad je věcně i místně příslušný k projednání této žádosti.</div>
                `;
            } else {
                // Nepříslušný - zobrazit výběr SÚ a zdůvodnění
                vyberSuSection.classList.add('visible');
                
                // Zobrazit zdůvodnění
                if (zduvodneniSection) {
                    zduvodneniSection.style.display = 'block';
                }
                
                const selectedSuValue = document.getElementById('postoupitSuSelect').value;
                
                if (selectedSuValue) {
                    // Je vybrán SÚ - zobrazit info o postoupení
                    const selectedOption = document.querySelector(`#postoupitSuDropdown .su-dropdown-option[data-value="${selectedSuValue}"]`);
                    if (selectedOption) {
                        const suName = selectedOption.querySelector('.su-option-name').textContent;
                        const suType = selectedOption.getAttribute('data-type');
                        const info = selectedOption.getAttribute('data-info').split('|');
                        
                        resultBox.className = 'result-preview negative';
                        resultBox.innerHTML = `
                            <div class="result-preview-title">
                                <span class="material-icons-outlined">send</span>
                                Řízení bude postoupeno
                            </div>
                            <div class="result-preview-text">
                                <strong>${suType}</strong><br>
                                ${info[0]}<br>
                                <span style="color: #5f6368; font-size: 12px;">${info[1]}</span>
                            </div>
                        `;
                    }
                } else {
                    // Není vybrán SÚ - vyzvat k výběru
                    resultBox.className = 'result-preview negative';
                    resultBox.innerHTML = `
                        <div class="result-preview-title">
                            <span class="material-icons-outlined">warning</span>
                            Vyberte příslušný stavební úřad
                        </div>
                        <div class="result-preview-text">Pro postoupení řízení je nutné vybrat stavební úřad, kterému bude řízení postoupeno.</div>
                    `;
                }
            }
            
            // Aktualizace stavu tlačítka potvrdit
            updatePrislusnostButton();
        }
        
        function updatePrislusnostButton() {
            const prislusnost = document.querySelector('input[name="prislusnost"]:checked').value;
            const btnConfirm = document.querySelector('#controlPrislusnost .btn-primary');
            const zduvodneniSection = document.getElementById('zduvodneniNeprislusnostiSection');
            const zduvodneni = zduvodneniSection ? document.getElementById('zduvodneniNeprislusnosti').value.trim() : '';
            
            if (prislusnost === 'neprislusny') {
                const selectedSu = document.getElementById('postoupitSuSelect').value;
                // Tlačítko aktivní pouze pokud je vybrán SÚ a zadáno zdůvodnění
                btnConfirm.disabled = !selectedSu || !zduvodneni;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">send</span>Postoupit řízení';
                btnConfirm.onclick = function() { showPostoupeniModal(); };
            } else {
                btnConfirm.disabled = false;
                btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
                btnConfirm.onclick = function() { completePrislusnost(); };
            }
        }
        
        // ==========================================
        // SEARCHABLE DROPDOWN PRO VÝBĚR SÚ
        // ==========================================
        
        // Otevřít dropdown
        function openSuDropdown(type) {
            const dropdownId = type === 'postoupit' ? 'postoupitSuDropdown' : 
                               (type === 'specialni' ? 'specialniSuDropdown' : 'obecnySuDropdown');
            const dropdown = document.getElementById(dropdownId);
            
            // Zavřít ostatní dropdowny
            document.querySelectorAll('.su-dropdown.open').forEach(d => {
                if (d !== dropdown) d.classList.remove('open');
            });
            
            dropdown.classList.add('open');
        }
        
        // Zavřít dropdown při kliknutí mimo
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.su-search-select')) {
                document.querySelectorAll('.su-dropdown.open').forEach(d => d.classList.remove('open'));
            }
        });
        
        // Filtrovat možnosti
        function filterSuOptions(type) {
            const inputId = type === 'postoupit' ? 'postoupitSuSearchInput' : 
                            (type === 'specialni' ? 'specialniSuSearchInput' : 'obecnySuSearchInput');
            const dropdownId = type === 'postoupit' ? 'postoupitSuDropdown' : 
                               (type === 'specialni' ? 'specialniSuDropdown' : 'obecnySuDropdown');
            
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(dropdownId);
            const searchTerm = input.value.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            
            let visibleCount = 0;
            
            dropdown.querySelectorAll('.su-dropdown-group').forEach(group => {
                let groupVisible = false;
                
                group.querySelectorAll('.su-dropdown-option').forEach(option => {
                    const name = option.querySelector('.su-option-name').textContent.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                    const searchData = (option.dataset.search || '').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                    
                    if (name.includes(searchTerm) || searchData.includes(searchTerm)) {
                        option.classList.remove('hidden');
                        groupVisible = true;
                        visibleCount++;
                    } else {
                        option.classList.add('hidden');
                    }
                });
                
                if (groupVisible) {
                    group.classList.remove('hidden');
                } else {
                    group.classList.add('hidden');
                }
            });
            
            // Zobrazit/skrýt prázdný stav
            const emptyState = dropdown.querySelector('.su-dropdown-empty');
            if (visibleCount === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
            
            // Otevřít dropdown při psaní
            dropdown.classList.add('open');
        }
        
        // Vybrat možnost
        function selectSuOption(type, option) {
            const inputId = type === 'postoupit' ? 'postoupitSuSearchInput' : 
                            (type === 'specialni' ? 'specialniSuSearchInput' : 'obecnySuSearchInput');
            const hiddenInputId = type === 'postoupit' ? 'postoupitSuSelect' : 
                                  (type === 'specialni' ? 'specialniSuSelect' : 'obecnySuSelect');
            const dropdownId = type === 'postoupit' ? 'postoupitSuDropdown' : 
                               (type === 'specialni' ? 'specialniSuDropdown' : 'obecnySuDropdown');
            
            const input = document.getElementById(inputId);
            const hiddenInput = document.getElementById(hiddenInputId);
            const dropdown = document.getElementById(dropdownId);
            
            const value = option.dataset.value;
            const name = option.querySelector('.su-option-name').textContent;
            
            // Nastavit hodnotu
            hiddenInput.value = value;
            input.value = name;
            input.classList.add('selected');
            
            // Označit vybranou možnost
            dropdown.querySelectorAll('.su-dropdown-option').forEach(o => o.classList.remove('selected'));
            option.classList.add('selected');
            
            // Zavřít dropdown
            dropdown.classList.remove('open');
            
            // Aktualizovat info box
            if (type === 'postoupit') {
                updatePostoupitSuInfo(option);
            } else if (type === 'specialni') {
                updateSpecialniSuInfo(option);
            } else {
                updateObecnySuInfo(option);
            }
        }
        
        // Vymazat výběr
        function clearSuSelection(type) {
            const inputId = type === 'postoupit' ? 'postoupitSuSearchInput' : 
                            (type === 'specialni' ? 'specialniSuSearchInput' : 'obecnySuSearchInput');
            const hiddenInputId = type === 'postoupit' ? 'postoupitSuSelect' : 
                                  (type === 'specialni' ? 'specialniSuSelect' : 'obecnySuSelect');
            const dropdownId = type === 'postoupit' ? 'postoupitSuDropdown' : 
                               (type === 'specialni' ? 'specialniSuDropdown' : 'obecnySuDropdown');
            const infoBoxId = type === 'postoupit' ? 'postoupitSuInfo' : 
                              (type === 'specialni' ? 'specialniSuInfo' : 'obecnySuInfo');
            
            const input = document.getElementById(inputId);
            const hiddenInput = document.getElementById(hiddenInputId);
            const dropdown = document.getElementById(dropdownId);
            const infoBox = document.getElementById(infoBoxId);
            
            hiddenInput.value = '';
            input.value = '';
            input.classList.remove('selected');
            
            // Reset filtrování
            dropdown.querySelectorAll('.su-dropdown-group, .su-dropdown-option').forEach(el => el.classList.remove('hidden'));
            dropdown.querySelectorAll('.su-dropdown-option').forEach(o => o.classList.remove('selected'));
            dropdown.querySelector('.su-dropdown-empty').style.display = 'none';
            
            // Skrýt info box
            infoBox.classList.remove('visible');
            
            updatePrislusnostResult();
        }
        
        // Inicializace click handlerů pro dropdown options
        document.addEventListener('DOMContentLoaded', function() {
            // Postoupit dropdown (nový sloučený)
            document.querySelectorAll('#postoupitSuDropdown .su-dropdown-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectSuOption('postoupit', this);
                });
            });
            
            // Staré dropdowny pro zpětnou kompatibilitu
            document.querySelectorAll('#specialniSuDropdown .su-dropdown-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectSuOption('specialni', this);
                });
            });
            
            document.querySelectorAll('#obecnySuDropdown .su-dropdown-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectSuOption('obecny', this);
                });
            });
        });
        
        function updatePostoupitSuInfo(option) {
            const infoBox = document.getElementById('postoupitSuInfo');
            const nameEl = document.getElementById('postoupitSuName');
            const detailsEl = document.getElementById('postoupitSuDetails');
            
            if (option) {
                const info = option.dataset.info.split('|');
                const type = option.dataset.type;
                
                nameEl.textContent = info[0];
                detailsEl.innerHTML = `
                    <span><strong>Typ:</strong> ${type}</span>
                    <span><strong>Adresa:</strong> ${info[1]}</span>
                    <span><strong>E-mail:</strong> ${info[2]}</span>
                    <span><strong>Působnost:</strong> ${info[3] || '—'}</span>
                `;
                infoBox.classList.add('visible');
            } else {
                infoBox.classList.remove('visible');
            }
            
            updatePrislusnostResult();
        }
        
        function updateSpecialniSuInfo(option) {
            const infoBox = document.getElementById('specialniSuInfo');
            const nameEl = document.getElementById('specialniSuName');
            const detailsEl = document.getElementById('specialniSuDetails');
            
            if (option) {
                const info = option.dataset.info.split('|');
                const type = option.dataset.type;
                
                nameEl.textContent = info[0];
                detailsEl.innerHTML = `
                    <span><strong>Typ:</strong> ${type}</span>
                    <span><strong>Adresa:</strong> ${info[1]}</span>
                    <span><strong>E-mail:</strong> ${info[2]}</span>
                    <span><strong>Působnost:</strong> ${info[3] || '—'}</span>
                `;
                infoBox.classList.add('visible');
            } else {
                infoBox.classList.remove('visible');
            }
            
            updatePrislusnostResult();
        }
        
        function updateObecnySuInfo(option) {
            const infoBox = document.getElementById('obecnySuInfo');
            const nameEl = document.getElementById('obecnySuName');
            const detailsEl = document.getElementById('obecnySuDetails');
            
            if (option) {
                const info = option.dataset.info.split('|');
                
                nameEl.textContent = info[0];
                detailsEl.innerHTML = `
                    <span><strong>Adresa:</strong> ${info[1]}</span>
                    <span><strong>E-mail:</strong> ${info[2]}</span>
                    <span><strong>Územní obvod:</strong> ${info[3]}</span>
                `;
                infoBox.classList.add('visible');
            } else {
                infoBox.classList.remove('visible');
            }
            
            updatePrislusnostResult();
        }

        // ==========================================
        // DOKUMENTACE - kompletní logika
        // ==========================================
        
        // Funkce pro uložení rozpracované kontroly
        function saveDraft(controlName) {
            const indicator = document.getElementById('autoSave' + controlName.charAt(0).toUpperCase() + controlName.slice(1));
            if (!indicator) return;
            
            // Simulace ukládání
            indicator.className = 'auto-save-indicator saving';
            indicator.innerHTML = '<span class="material-icons-outlined">sync</span><span>Ukládám...</span>';
            
            setTimeout(function() {
                indicator.className = 'auto-save-indicator saved';
                indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Uloženo</span>';
                
                // Zobrazit potvrzení
                setTimeout(function() {
                    indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Automaticky uloženo</span>';
                }, 2000);
            }, 800);
        }
        
        // Trigger automatického ukládání při změně (simulace)
        function triggerAutoSave(controlName) {
            const indicator = document.getElementById('autoSave' + controlName.charAt(0).toUpperCase() + controlName.slice(1));
            if (!indicator) return;
            
            indicator.className = 'auto-save-indicator saving';
            indicator.innerHTML = '<span class="material-icons-outlined">sync</span><span>Ukládám...</span>';
            
            setTimeout(function() {
                indicator.className = 'auto-save-indicator saved';
                indicator.innerHTML = '<span class="material-icons-outlined">cloud_done</span><span>Automaticky uloženo</span>';
            }, 500);
        }
        
        // Stav kontrol dokumentace
        let docCheckState = {
            autoCheckDone: false,
            partStatus: { A: 'unchecked', B: 'unchecked', C: 'unchecked', D: 'unchecked' },
            issues: [],
            currentVersion: 'v3'
        };
        
        function toggleEdFolder(headerEl) {
            const folder = headerEl.closest('.ed-folder');
            if (folder.classList.contains('empty')) return;
            folder.classList.toggle('open');
        }
        
        // Funkce pro návrat do struktury ED z náhledu
        function backToEdStructure() {
            document.getElementById('edTreeContainer').style.display = 'block';
            document.getElementById('edPreviewContainer').style.display = 'none';
            document.getElementById('edBackBtn').style.display = 'none';
            document.getElementById('edBreadcrumb').style.display = 'flex';
        }
        
        function switchDocViewerTab(tabEl, view) {
            // Tato funkce již není potřeba se starými záložkami
            // Zachována pro zpětnou kompatibilitu
            const treeContainer = document.getElementById('edTreeContainer');
            const previewContainer = document.getElementById('edPreviewContainer');
            
            if (view === 'struktura') {
                treeContainer.style.display = 'block';
                previewContainer.style.display = 'none';
                document.getElementById('edBackBtn').style.display = 'none';
                document.getElementById('edBreadcrumb').style.display = 'flex';
            } else {
                treeContainer.style.display = 'none';
                previewContainer.style.display = 'block';
                document.getElementById('edBackBtn').style.display = 'flex';
                document.getElementById('edBreadcrumb').style.display = 'none';
            }
        }
        
        function previewEdFile(fileName, section) {
            // Přepnout kontejnery
            document.getElementById('edTreeContainer').style.display = 'none';
            document.getElementById('edPreviewContainer').style.display = 'block';
            
            // Zobrazit tlačítko Zpět, skrýt breadcrumb
            document.getElementById('edBackBtn').style.display = 'flex';
            document.getElementById('edBreadcrumb').style.display = 'none';
            
            // Zobrazit náhled
            const previewContent = document.getElementById('edPreviewContent');
            const versionLabel = docCheckState.currentVersion === 'v3' ? '' : ` (${docCheckState.currentVersion})`;
            previewContent.innerHTML = `
                <span class="material-icons-outlined" style="font-size: 64px; color: #c62828; margin-bottom: 16px;">picture_as_pdf</span>
                <div style="font-size: 16px; font-weight: 500; color: #202124; margin-bottom: 8px;">${fileName}${versionLabel}</div>
                <div style="font-size: 13px; color: #5f6368;">V ostré verzi by se zde zobrazil náhled dokumentu</div>
            `;
        }
        
        function changeEdVersion() {
            const select = document.getElementById('edVersionSelect');
            const newVersion = select.value;
            docCheckState.currentVersion = newVersion;
            
            // Simulace načtení jiné verze - zavřeme všechny otevřené složky
            document.querySelectorAll('.ed-folder.open').forEach(folder => {
                folder.classList.remove('open');
            });
            
            // Pokud jsme v náhledu, přepneme zpět na strukturu
            backToEdStructure();
        }
        
        // ==========================================
        // KATEGORIE STAVBY A SOUBOR STAVEB
        // ==========================================
        
        function toggleSouborStaveb() {
            const isSoubor = document.querySelector('input[name="souborStaveb"]:checked').value === 'ano';
            const jednoduchyField = document.getElementById('kategorieJednoduchaField');
            const souborField = document.getElementById('kategorieSouborField');
            
            if (isSoubor) {
                jednoduchyField.style.display = 'none';
                souborField.style.display = 'block';
            } else {
                jednoduchyField.style.display = 'block';
                souborField.style.display = 'none';
            }
        }
        
        function addVedlejsiStavba() {
            const list = document.getElementById('vedlejsiStavbyList');
            const newRow = document.createElement('div');
            newRow.className = 'vedlejsi-stavba-row';
            newRow.innerHTML = `
                <input type="text" class="stavba-input" placeholder="Název stavby">
                <select class="stavba-select">
                    <option value="ostatni">Ostatní</option>
                    <option value="jednoducha">Jednoduchá</option>
                    <option value="drobna">Drobná</option>
                </select>
                <button class="vedlejsi-remove" onclick="removeVedlejsiStavba(this)" title="Odebrat">
                    <span class="material-icons-outlined">close</span>
                </button>
            `;
            list.appendChild(newRow);
        }
        
        function removeVedlejsiStavba(btn) {
            const row = btn.closest('.vedlejsi-stavba-row');
            if (row) {
                row.remove();
            }
        }
        
        function updateSouborSummary() {
            const kategorieHlavni = document.querySelector('input[name="kategorieHlavni"]:checked');
            if (kategorieHlavni) {
                const kategorie = kategorieHlavni.value;
                const kategorieText = {
                    'vyhrazena': 'Vyhrazená',
                    'ostatni': 'Ostatní',
                    'jednoducha': 'Jednoduchá',
                    'drobna': 'Drobná'
                }[kategorie] || 'Ostatní';
                
                const summary = document.getElementById('souborSummary');
                summary.innerHTML = `
                    <span class="material-icons-outlined">info</span>
                    <span>Kategorie souboru staveb: <strong>${kategorieText}</strong> (podle hlavní stavby)</span>
                `;
            }
        }
        
        // Přidání event listeneru pro změnu kategorie hlavní stavby
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input[name="kategorieHlavni"]').forEach(input => {
                input.addEventListener('change', updateSouborSummary);
            });
        });
        
        function setDocPartStatus(part, status) {
            docCheckState.partStatus[part] = status;
            
            // Update UI pro tlačítka
            const item = document.querySelector(`.doc-part-item[data-part="${part}"]`);
            if (!item) return;
            
            item.classList.remove('status-ok', 'status-warning', 'status-error', 'status-unchecked');
            item.classList.add('status-' + status);
            
            // Update buttons - odstranit active a unchecked ze všech
            const buttons = item.querySelectorAll('.doc-part-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active', 'unchecked');
            });
            
            // Nastavit správný stav tlačítku
            const targetBtn = item.querySelector('.doc-part-btn.' + status) || item.querySelector('.doc-part-btn.ok');
            if (status === 'ok') {
                targetBtn.classList.add('active');
            } else if (status === 'unchecked') {
                item.querySelector('.doc-part-btn.ok').classList.add('unchecked');
            } else {
                targetBtn.classList.add('active');
            }
            
            // Zobrazení/skrytí sekce pro nedostatky dané části
            const partSection = document.getElementById('partIssues' + part);
            
            if (status === 'error') {
                if (partSection) {
                    partSection.style.display = 'block';
                    // Focus na textarea
                    setTimeout(() => {
                        const textarea = document.getElementById('partIssueText' + part);
                        if (textarea) textarea.focus();
                    }, 100);
                }
            } else {
                if (partSection) {
                    partSection.style.display = 'none';
                }
                // Odeber všechny nedostatky pro tuto část
                docCheckState.issues = docCheckState.issues.filter(i => i.part !== part);
                const listEl = document.getElementById('partIssuesList' + part);
                if (listEl) listEl.innerHTML = '';
                const textEl = document.getElementById('partIssueText' + part);
                if (textEl) textEl.value = '';
            }
            
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        // Přidání nedostatku k části dokumentace
        function addPartIssue(part) {
            const textarea = document.getElementById('partIssueText' + part);
            const text = textarea.value.trim();
            
            if (!text) {
                textarea.focus();
                return;
            }
            
            const partNames = {
                A: 'Průvodní zpráva',
                B: 'Souhrnná technická zpráva', 
                C: 'Situační výkresy',
                D: 'Dokumentace objektů'
            };
            
            const issueId = 'issue-' + Date.now();
            const fullText = `Část ${part}. ${partNames[part]}: ${text}`;
            
            // Přidat do lokálního stavu
            docCheckState.issues.push({
                id: issueId,
                text: fullText,
                shortText: text,
                part: part,
                source: 'manual'
            });
            
            // Přidat do globálního seznamu
            addGlobalIssue('vyzva', {
                text: fullText,
                source: 'manual',
                controlName: 'Kontrola dokumentace'
            });
            
            // Vyrenderovat nedostatek v UI
            renderPartIssues(part);
            
            // Vyčistit textarea
            textarea.value = '';
            textarea.focus();
            
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        // Odebrání nedostatku z části
        function removePartIssue(issueId, part) {
            const issue = docCheckState.issues.find(i => i.id === issueId);
            docCheckState.issues = docCheckState.issues.filter(i => i.id !== issueId);
            
            // Odebrat z globálního seznamu
            if (issue) {
                const globalIssue = globalIssues.vyzva.find(gi => gi.text === issue.text);
                if (globalIssue) {
                    removeGlobalIssue('vyzva', globalIssue.id);
                }
            }
            
            renderPartIssues(part);
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        // Vyrenderování nedostatků pro konkrétní část
        function renderPartIssues(part) {
            const list = document.getElementById('partIssuesList' + part);
            const partIssues = docCheckState.issues.filter(i => i.part === part);
            
            if (partIssues.length === 0) {
                list.innerHTML = '';
                return;
            }
            
            list.innerHTML = partIssues.map(issue => `
                <div class="part-issue-item" data-issue-id="${issue.id}">
                    <div class="part-issue-icon">
                        <span class="material-icons-outlined">warning</span>
                    </div>
                    <div class="part-issue-content">${issue.shortText || issue.text}</div>
                    <button class="part-issue-remove" onclick="removePartIssue('${issue.id}', '${part}')" title="Odebrat">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
            `).join('');
        }
        
        // Aktualizace viditelnosti celé sekce nedostatků
        function updateIssuesVisibility() {
            const section = document.getElementById('issuesSection');
            const emptyState = document.getElementById('issuesEmpty');
            const countEl = document.getElementById('issuesCount');
            const autoSection = document.getElementById('autoIssuesSection');
            
            const totalIssues = docCheckState.issues.length;
            const autoIssues = docCheckState.issues.filter(i => i.source === 'auto');
            const hasPartSections = ['A', 'B', 'C', 'D'].some(p => docCheckState.partStatus[p] === 'error');
            
            countEl.textContent = totalIssues;
            
            // Zobrazení automatických nedostatků
            if (autoIssues.length > 0) {
                autoSection.style.display = 'block';
                renderAutoIssues();
            } else {
                autoSection.style.display = 'none';
            }
            
            // Zobrazení prázdného stavu
            if (totalIssues === 0 && !hasPartSections) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
        }
        
        // Renderování automatických nedostatků
        function renderAutoIssues() {
            const list = document.getElementById('autoIssuesList');
            const autoIssues = docCheckState.issues.filter(i => i.source === 'auto');
            
            list.innerHTML = autoIssues.map(issue => `
                <div class="part-issue-item" data-issue-id="${issue.id}">
                    <div class="part-issue-icon">
                        <span class="material-icons-outlined">auto_awesome</span>
                    </div>
                    <div class="part-issue-content">${issue.text}</div>
                    <button class="part-issue-remove" onclick="removeAutoIssue('${issue.id}')" title="Odebrat">
                        <span class="material-icons-outlined">close</span>
                    </button>
                </div>
            `).join('');
        }
        
        function removeAutoIssue(issueId) {
            const issue = docCheckState.issues.find(i => i.id === issueId);
            docCheckState.issues = docCheckState.issues.filter(i => i.id !== issueId);
            
            if (issue) {
                const globalIssue = globalIssues.vyzva.find(gi => gi.text === issue.text);
                if (globalIssue) {
                    removeGlobalIssue('vyzva', globalIssue.id);
                }
            }
            
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        function runDocAutoCheck() {
            const btn = document.getElementById('btnRunAutoCheck');
            const desc = document.getElementById('autoCheckDesc');
            const results = document.getElementById('autoCheckResults');
            
            btn.disabled = true;
            btn.classList.add('loading');
            btn.innerHTML = '<span class="material-icons-outlined">sync</span>Probíhá kontrola...';
            
            // Simulace automatické kontroly
            setTimeout(function() {
                btn.classList.remove('loading');
                btn.innerHTML = '<span class="material-icons-outlined">check</span>Kontrola dokončena';
                btn.style.background = '#137333';
                
                desc.style.display = 'none';
                results.classList.add('visible');
                
                // Automaticky přidat zjištěné nedostatky do seznamu
                const timestampIssue = 'Chybí časové razítko u dokumentu D.1.1.02 Půdorys 1.NP.pdf';
                const exists = docCheckState.issues.some(i => i.text === timestampIssue);
                if (!exists) {
                    const issueId = 'issue-auto-' + Date.now();
                    docCheckState.issues.push({ 
                        id: issueId,
                        text: timestampIssue, 
                        source: 'auto' 
                    });
                    
                    // Přidat do globálního seznamu
                    addGlobalIssue('vyzva', {
                        text: timestampIssue,
                        source: 'auto',
                        controlName: 'Automatická kontrola dokumentace'
                    });
                    
                    updateIssuesVisibility();
                    // Zobrazit potvrzení u položky
                    document.getElementById('checkTimestampAdded').style.display = 'inline';
                }
                
                docCheckState.autoCheckDone = true;
                updateDokumentaceResult();
            }, 2000);
        }
        
        function addIssueFromAutoCheck(issueText) {
            // Funkce ponechána pro zpětnou kompatibilitu
            const issueId = 'issue-auto-' + Date.now();
            docCheckState.issues.push({ 
                id: issueId,
                text: issueText, 
                source: 'auto' 
            });
            addGlobalIssue('vyzva', {
                text: issueText,
                source: 'auto',
                controlName: 'Automatická kontrola dokumentace'
            });
            updateIssuesVisibility();
            updateDokumentaceResult();
        }
        
        // Staré funkce - ponechány pro zpětnou kompatibilitu
        function addIssue() {
            // Tato funkce už není používána v novém UI
        }
        
        function addIssueToList(issueText, source = 'manual') {
            // Tato funkce už není používána v novém UI
        }
        
        function removeIssue(issueId) {
            // Tato funkce už není používána v novém UI
        }
        
        function renderIssues() {
            // Nahrazeno funkcí updateIssuesVisibility
            updateIssuesVisibility();
        }
        
        function updateDokumentaceResult() {
            const resultBox = document.getElementById('resultDokumentace');
            const btnConfirm = document.getElementById('btnConfirmDokumentace');
            const issueCount = docCheckState.issues.length;
            const hasProblems = Object.values(docCheckState.partStatus).some(s => s === 'warning' || s === 'error');
            const allChecked = Object.values(docCheckState.partStatus).every(s => s !== 'unchecked');
            
            if (issueCount > 0 || hasProblems) {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Dokumentace vykazuje nedostatky
                    </div>
                    <div class="result-preview-text">
                        Zjištěno ${issueCount} nedostatků. Bude vydána výzva k doplnění a řízení přerušeno.
                    </div>
                `;
            } else if (!allChecked) {
                resultBox.className = 'result-preview neutral';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Kontrola nebyla dokončena
                    </div>
                    <div class="result-preview-text">Zkontrolujte všechny části dokumentace kliknutím na zaškrtávátko.</div>
                `;
            } else {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Dokumentace v pořádku
                    </div>
                    <div class="result-preview-text">Všechny části dokumentace jsou přítomny a úplné.</div>
                `;
            }
            
            // Tlačítko je vždy "Potvrdit kontrolu"
            btnConfirm.innerHTML = '<span class="material-icons-outlined">check</span>Potvrdit kontrolu';
        }

        // ==========================================
        // DOKLADOVÁ ČÁST - update result
        // ==========================================
        function updateDokladyResult() {
            const vyjadreni = document.querySelector('input[name="vyjadreni_ss"]:checked').value;
            const stanoviska = document.querySelector('input[name="stanoviska_do"]:checked').value;
            const resultBox = document.getElementById('resultDoklady');

            if (vyjadreni === 'kompletni' && stanoviska === 'kompletni') {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Dokladová část v pořádku
                    </div>
                    <div class="result-preview-text">Všechna vyjádření a stanoviska jsou k dispozici.</div>
                `;
            } else if (stanoviska === 'zaporne') {
                resultBox.className = 'result-preview negative';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">cancel</span>
                        Záporné stanovisko DO
                    </div>
                    <div class="result-preview-text">Řízení bude zastaveno z důvodu záporného stanoviska dotčeného orgánu.</div>
                `;
            } else if (vyjadreni === 'chybi') {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Chybí vyjádření
                    </div>
                    <div class="result-preview-text">Bude vydána výzva k doplnění a řízení přerušeno.</div>
                `;
            } else if (stanoviska === 'chybi') {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">schedule</span>
                        Chybí stanovisko DO
                    </div>
                    <div class="result-preview-text">SÚ si stanovisko vyžádá. Běží lhůta 30 dnů.</div>
                `;
            }
        }

        // ==========================================
        // KONTROLA SOULADU S ÚPD - ULTRA KOMPAKTNÍ
        // ==========================================
        
        const updState = {
            urp: { checked: false, soulad: null, text: '' },
            zur: { checked: false, soulad: null, text: '' },
            up: { checked: false, soulad: null, text: '', exists: null }
        };
        
        // Layout přepínání
        function setUPDLayout(layout, btn) {
            const overlay = document.getElementById('controlUP');
            
            // Aktualizovat tlačítka
            btn.parentElement.querySelectorAll('.upd-layout-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Přepnout layout
            if (layout === 'horizontal') {
                overlay.classList.add('layout-horizontal');
            } else {
                overlay.classList.remove('layout-horizontal');
            }
            
            // Reinicializovat viewery po změně layoutu
            setTimeout(() => {
                const situaceImg = document.getElementById('situaceImage');
                const updImg = document.getElementById('updImage');
                if (situaceImg && situaceImg.complete) initViewer('situace');
                if (updImg && updImg.complete) initViewer('upd');
            }, 100);
        }
        
        // Modální dialog pro nesoulad
        let currentNesouladStep = null;
        
        const nesouladLabels = {
            urp: { title: 'Nesoulad s ÚRP', label: 'Popište rozpor s Územním rozvojovým plánem ČR:' },
            zur: { title: 'Nesoulad se ZÚR', label: 'Popište rozpor se Zásadami územního rozvoje:' },
            up: { title: 'Nesoulad s ÚP', label: 'Popište rozpor s Územním plánem obce:' }
        };
        
        function openNesouladModal(step) {
            currentNesouladStep = step;
            const labels = nesouladLabels[step];
            
            document.getElementById('nesouladModalTitle').textContent = labels.title;
            document.getElementById('nesouladModalLabel').textContent = labels.label;
            
            // Načíst existující text
            const existingText = document.getElementById('note' + step.charAt(0).toUpperCase() + step.slice(1))?.value || '';
            document.getElementById('nesouladModalTextarea').value = existingText;
            
            document.getElementById('nesouladModal').classList.add('open');
            document.getElementById('nesouladModalTextarea').focus();
        }
        
        function closeNesouladModal() {
            document.getElementById('nesouladModal').classList.remove('open');
            currentNesouladStep = null;
        }
        
        function saveNesouladModal() {
            if (!currentNesouladStep) return;
            
            const text = document.getElementById('nesouladModalTextarea').value;
            const noteInput = document.getElementById('note' + currentNesouladStep.charAt(0).toUpperCase() + currentNesouladStep.slice(1));
            if (noteInput) {
                noteInput.value = text;
            }
            
            // Aktualizovat indikátor
            const indicator = document.getElementById('indicator' + currentNesouladStep.charAt(0).toUpperCase() + currentNesouladStep.slice(1));
            if (indicator) {
                indicator.classList.toggle('visible', text.trim().length > 0);
                indicator.title = text.trim().length > 0 ? 'Upravit popis nesouladu' : '';
            }
            
            updateUPDState();
            closeNesouladModal();
        }
        
        // Viewer stav pro zoom/pan
        const viewerState = {
            situace: { scale: 1, x: 0, y: 0, isDragging: false, startX: 0, startY: 0 },
            upd: { scale: 1, x: 0, y: 0, isDragging: false, startX: 0, startY: 0 }
        };
        
        // UPD obrázky a iframe
        const updImages = {
            urp: '../images/URP.png',
            zur: '../images/URP.png' // Zatím stejný, můžete přidat ZUR.png
        };
        
        // ÚP jako iframe
        const upIframeUrl = 'https://mapy.kr-vysocina.cz/pupo_pfa/apps/webappviewer/index.html?id=61cce275226a49a69c5b95254afda53d';
        
        const situaceImages = {
            c1: '../images/C-01.png',
            c2: '../images/C-02.png',
            c3: '../images/C-03.png'
        };
        
        function initViewer(viewerId) {
            const container = document.getElementById(viewerId + 'Container');
            const img = document.getElementById(viewerId + 'Image');
            if (!container || !img) return;
            
            // Počkat až je obrázek načtený
            if (!img.complete || !img.naturalWidth) {
                img.onload = () => initViewer(viewerId);
                return;
            }
            
            const state = viewerState[viewerId];
            
            // Počkat na správné rozměry containeru
            const containerRect = container.getBoundingClientRect();
            if (containerRect.width === 0 || containerRect.height === 0) {
                setTimeout(() => initViewer(viewerId), 50);
                return;
            }
            
            const imgRatio = img.naturalWidth / img.naturalHeight;
            const containerRatio = containerRect.width / containerRect.height;
            
            // Fit to container - obrázek celý viditelný
            if (imgRatio > containerRatio) {
                state.scale = containerRect.width / img.naturalWidth;
            } else {
                state.scale = containerRect.height / img.naturalHeight;
            }
            
            // Omezit maximální scale na 1 (nezoomovat nad 100%)
            state.scale = Math.min(state.scale, 1);
            
            // Center image
            state.x = (containerRect.width - img.naturalWidth * state.scale) / 2;
            state.y = (containerRect.height - img.naturalHeight * state.scale) / 2;
            
            updateViewerTransform(viewerId);
            
            // Zobrazit obrázek po inicializaci
            img.classList.add('loaded');
            
            // Mouse events - přidat pouze jednou
            if (!container.dataset.eventsAttached) {
                container.onmousedown = (e) => startDrag(e, viewerId);
                container.onmousemove = (e) => drag(e, viewerId);
                container.onmouseup = () => endDrag(viewerId);
                container.onmouseleave = () => endDrag(viewerId);
                container.onwheel = (e) => handleWheel(e, viewerId);
                container.dataset.eventsAttached = 'true';
            }
        }
        
        function updateViewerTransform(viewerId) {
            const img = document.getElementById(viewerId + 'Image');
            const state = viewerState[viewerId];
            if (img) {
                img.style.transform = `translate(${state.x}px, ${state.y}px) scale(${state.scale})`;
            }
        }
        
        function startDrag(e, viewerId) {
            const state = viewerState[viewerId];
            state.isDragging = true;
            state.startX = e.clientX - state.x;
            state.startY = e.clientY - state.y;
            e.preventDefault();
        }
        
        function drag(e, viewerId) {
            const state = viewerState[viewerId];
            if (!state.isDragging) return;
            state.x = e.clientX - state.startX;
            state.y = e.clientY - state.startY;
            updateViewerTransform(viewerId);
        }
        
        function endDrag(viewerId) {
            viewerState[viewerId].isDragging = false;
        }
        
        function handleWheel(e, viewerId) {
            e.preventDefault();
            const state = viewerState[viewerId];
            const container = document.getElementById(viewerId + 'Container');
            const rect = container.getBoundingClientRect();
            
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const delta = e.deltaY > 0 ? -0.1 : 0.1;
            const newScale = Math.max(0.1, Math.min(5, state.scale + delta));
            
            // Zoom towards mouse position
            const scaleRatio = newScale / state.scale;
            state.x = mouseX - (mouseX - state.x) * scaleRatio;
            state.y = mouseY - (mouseY - state.y) * scaleRatio;
            state.scale = newScale;
            
            updateViewerTransform(viewerId);
        }
        
        function zoomViewer(viewerId, delta) {
            const state = viewerState[viewerId];
            const container = document.getElementById(viewerId + 'Container');
            const rect = container.getBoundingClientRect();
            
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            
            const newScale = Math.max(0.1, Math.min(5, state.scale + delta));
            const scaleRatio = newScale / state.scale;
            
            state.x = centerX - (centerX - state.x) * scaleRatio;
            state.y = centerY - (centerY - state.y) * scaleRatio;
            state.scale = newScale;
            
            updateViewerTransform(viewerId);
        }
        
        function resetViewer(viewerId) {
            const img = document.getElementById(viewerId + 'Image');
            if (img && img.complete) {
                initViewer(viewerId);
            }
        }
        
        function openImageFullscreen(viewerId) {
            if (viewerId === 'upd') {
                // Zkontrolovat, zda je aktivní ÚP tab
                const activeTab = document.querySelector('#updMapViewer').closest('.upd-viewer-panel').querySelector('.upd-vtab.active');
                if (activeTab && activeTab.textContent === 'ÚP') {
                    window.open(upIframeUrl, '_blank');
                    return;
                }
            }
            const img = document.getElementById(viewerId + 'Image');
            if (img) {
                window.open(img.src, '_blank');
            }
        }
        
        function switchSituaceTab(btn, tab) {
            btn.parentElement.querySelectorAll('.upd-vtab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            const img = document.getElementById('situaceImage');
            if (img && situaceImages[tab]) {
                img.classList.remove('loaded');
                img.onload = () => initViewer('situace');
                img.src = situaceImages[tab];
            }
        }
        
        function switchUPDMap(type, btn) {
            btn.parentElement.querySelectorAll('.upd-vtab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            const viewer = document.getElementById('updMapViewer');
            
            if (type === 'up') {
                // ÚP jako iframe
                viewer.innerHTML = `
                    <iframe src="${upIframeUrl}" 
                            style="width: 100%; height: 100%; border: none;"
                            allow="geolocation"
                            id="upIframe"></iframe>
                    <div class="upd-iframe-fallback" id="iframeFallback" style="display: none;">
                        <span class="material-icons-outlined">block</span>
                        <span>Web neumožňuje vložení</span>
                        <a href="${upIframeUrl}" target="_blank" class="upd-link">Otevřít v novém okně</a>
                    </div>
                `;
                // Skrýt zoom controls pro iframe
                document.querySelector('#updMapViewer').closest('.upd-viewer-panel').querySelector('.upd-zoom-controls').style.display = 'none';
            } else {
                // ÚRP/ZÚR jako obrázek
                const existingImg = document.getElementById('updImage');
                if (!existingImg) {
                    viewer.innerHTML = `
                        <div class="upd-image-container" id="updContainer">
                            <img src="${updImages[type]}" alt="${type.toUpperCase()}" id="updImage" 
                                 draggable="false" onload="initViewer('upd')">
                        </div>
                    `;
                } else {
                    existingImg.classList.remove('loaded');
                    existingImg.onload = () => initViewer('upd');
                    existingImg.src = updImages[type];
                }
                // Zobrazit zoom controls
                document.querySelector('#updMapViewer').closest('.upd-viewer-panel').querySelector('.upd-zoom-controls').style.display = 'flex';
            }
        }
        
        function setUPDSoulad(step, soulad, btn) {
            updState[step].checked = true;
            updState[step].soulad = soulad;
            
            // Aktualizovat tlačítka
            const parent = btn.closest('.upd-check-buttons');
            parent.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            // Zobrazit/skrýt textarea pro nesoulad (vertikální layout)
            const noteInput = document.getElementById('note' + step.charAt(0).toUpperCase() + step.slice(1));
            if (noteInput) {
                noteInput.style.display = soulad ? 'none' : 'block';
            }
            
            // Aktualizovat/skrýt indikátor nesouladu
            const indicator = document.getElementById('indicator' + step.charAt(0).toUpperCase() + step.slice(1));
            if (indicator && soulad) {
                indicator.classList.remove('visible');
            }
            
            // Aktualizovat stav položky
            const checkItem = document.getElementById('check' + step.charAt(0).toUpperCase() + step.slice(1));
            checkItem.classList.remove('done-ok', 'done-error');
            checkItem.classList.add(soulad ? 'done-ok' : 'done-error');
            
            // Aktualizovat status
            const statusEl = document.getElementById('status' + step.charAt(0).toUpperCase() + step.slice(1));
            statusEl.textContent = soulad ? '✓' : '✗';
            statusEl.classList.remove('ok', 'error');
            statusEl.classList.add(soulad ? 'ok' : 'error');
            
            // Při nesouladu v horizontálním layoutu otevřít modal
            if (!soulad) {
                const isHorizontal = document.getElementById('controlUP').classList.contains('layout-horizontal');
                if (isHorizontal) {
                    openNesouladModal(step);
                } else if (noteInput) {
                    noteInput.focus();
                }
            }
            
            updateUPDState();
        }
        
        function setUPExistence(exists, btn) {
            updState.up.exists = exists;
            
            // Aktualizovat tlačítka
            const parent = btn.closest('.upd-check-buttons');
            parent.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            // Zobrazit/skrýt relevantní sekce
            const souladSection = document.getElementById('upSouladSection');
            const noUpInfo = document.getElementById('noUpInfo');
            
            if (exists) {
                souladSection.style.display = 'block';
                noUpInfo.style.display = 'none';
            } else {
                souladSection.style.display = 'none';
                noUpInfo.style.display = 'block';
                // Při neexistenci ÚP je kontrola hotová
                updState.up.checked = true;
                updState.up.soulad = true;
                
                // Aktualizovat vizuální stav
                const checkItem = document.getElementById('checkUp');
                checkItem.classList.add('done-ok');
                const statusEl = document.getElementById('statusUp');
                statusEl.textContent = 'N/A';
                statusEl.classList.add('ok');
            }
            
            updateUPDState();
        }
        
        function updateUPDState() {
            // Aktualizovat tlačítko potvrzení
            const btn = document.getElementById('btnConfirmUPD');
            if (!btn) return;
            
            const allChecked = updState.urp.checked && updState.zur.checked && updState.up.checked;
            const hasNesoulad = (updState.urp.checked && !updState.urp.soulad) || 
                               (updState.zur.checked && !updState.zur.soulad) || 
                               (updState.up.checked && !updState.up.soulad);
            
            // Kontrola vyplnění zdůvodnění nesouladů + aktualizace indikátorů
            let nesouladTextsOk = true;
            ['urp', 'zur', 'up'].forEach(step => {
                const noteValue = document.getElementById('note' + step.charAt(0).toUpperCase() + step.slice(1))?.value?.trim() || '';
                const indicator = document.getElementById('indicator' + step.charAt(0).toUpperCase() + step.slice(1));
                
                const needsText = !updState[step].soulad && updState[step].checked && (step !== 'up' || updState.up.exists !== false);
                
                if (needsText) {
                    if (!noteValue) nesouladTextsOk = false;
                    // Zobrazit indikátor pokud je text vyplněn
                    if (indicator) {
                        indicator.classList.toggle('visible', noteValue.length > 0);
                    }
                } else {
                    if (indicator) indicator.classList.remove('visible');
                }
            });
            
            const canConfirm = allChecked && (!hasNesoulad || nesouladTextsOk);
            btn.disabled = !canConfirm;
            
            if (hasNesoulad && allChecked) {
                btn.innerHTML = '<span class="material-icons-outlined">gavel</span> Zamítnout';
            } else {
                btn.innerHTML = '<span class="material-icons-outlined">check</span> Potvrdit kontrolu';
            }
        }
        
        function completeUPD() {
            const hasNesoulad = (updState.urp.checked && !updState.urp.soulad) || 
                               (updState.zur.checked && !updState.zur.soulad) || 
                               (updState.up.checked && !updState.up.soulad);
            
            // Sesbírat texty nesouladů
            let nesouladTexts = [];
            if (!updState.urp.soulad && updState.urp.checked) {
                const text = document.getElementById('noteUrp')?.value || '';
                if (text) nesouladTexts.push('ÚRP: ' + text);
            }
            if (!updState.zur.soulad && updState.zur.checked) {
                const text = document.getElementById('noteZur')?.value || '';
                if (text) nesouladTexts.push('ZÚR: ' + text);
            }
            if (!updState.up.soulad && updState.up.checked && updState.up.exists !== false) {
                const text = document.getElementById('noteUp')?.value || '';
                if (text) nesouladTexts.push('ÚP: ' + text);
            }
            
            controls.up.done = true;
            controls.up.result = hasNesoulad ? 'warning' : 'ok';
            
            // Přidat nesoulady do globálních issues
            if (hasNesoulad && nesouladTexts.length > 0) {
                addGlobalIssue('vyzva', {
                    text: 'Nesoulad s ÚPD:\n' + nesouladTexts.join('\n'),
                    source: 'upd-control',
                    controlName: 'Soulad s ÚPD'
                });
            }
            
            updateUI();
            closeControl('controlUP');
            
            // Zobrazit toast
            if (hasNesoulad) {
                showToast('Kontrola dokončena — zjištěn nesoulad s ÚPD', 'warning');
            } else {
                showToast('Kontrola dokončena — záměr je v souladu s ÚPD', 'success');
            }
        }

        // ==========================================
        // ZRYCHLENÉ ŘÍZENÍ - update result
        // ==========================================
        function updateZrychleneResult() {
            const checkboxes = document.querySelectorAll('#controlZrychlene input[type="checkbox"]');
            let allChecked = true;
            
            checkboxes.forEach(cb => {
                const option = cb.closest('.control-option');
                if (cb.checked) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                    allChecked = false;
                }
            });

            const resultBox = document.getElementById('resultZrychlene');
            if (allChecked) {
                resultBox.className = 'result-preview positive';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Podmínky splněny
                    </div>
                    <div class="result-preview-text">Všechny podmínky pro zrychlené řízení jsou splněny.</div>
                `;
            } else {
                resultBox.className = 'result-preview warning';
                resultBox.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Podmínky nesplněny
                    </div>
                    <div class="result-preview-text">Řízení bude vedeno standardním způsobem.</div>
                `;
            }
        }

        // ==========================================
        // INFO PANEL UPDATE
        // ==========================================
        function updateInfoPanel() {
            const infoPanel = document.getElementById('infoPanel');
            
            // Zkontroluj stav příslušnosti
            if (controls.prislusnost.done && controls.prislusnost.result === 'neprislusny') {
                const postoupit = controls.prislusnost.postoupit;
                let suNazev = 'příslušnému stavebnímu úřadu';
                
                if (postoupit) {
                    const info = postoupit.info.split('|');
                    suNazev = info[0];
                }
                
                infoPanel.className = 'info-panel error';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">send</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Řízení bude postoupeno</div>
                        <div class="info-panel-text">
                            Stavební úřad není příslušný. Řízení bude postoupeno: <strong>${suNazev}</strong>.<br>
                            Další kontroly nejsou vyžadovány.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj stav dokumentace
            if (controls.dokumentace.done && controls.dokumentace.result === 'vady') {
                infoPanel.className = 'info-panel warning';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">warning</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Dokumentace vykazuje vady</div>
                        <div class="info-panel-text">
                            Bude vydána výzva k doplnění a řízení přerušeno. Po odstranění vad pokračujte v kontrolách.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj vady žádosti
            if (controls.zadost.done && controls.zadost.result === 'vady') {
                infoPanel.className = 'info-panel warning';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">mail</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Žádost vykazuje vady</div>
                        <div class="info-panel-text">
                            Bude vydána výzva k odstranění vad (§ 185 odst. 2) a řízení přerušeno do 10 dnů od zahájení.
                            Můžete pokračovat v kontrolách nebo rovnou vydat výzvu.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj chybějící vyjádření VTI/VDI (vada žádosti)
            if (controls.identifikace.done && controls.identifikace.result === 'vady') {
                const pocet = controls.identifikace.chybiVTI_VDI ? controls.identifikace.chybiVTI_VDI.length : 0;
                infoPanel.className = 'info-panel warning';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">warning</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Chybí vyjádření vlastníků sítí</div>
                        <div class="info-panel-text">
                            Chybí ${pocet} ${pocet === 1 ? 'vyjádření' : 'vyjádření'} VTI/VDI. Jedná se o vadu žádosti.<br>
                            Bude vydána výzva k doplnění stavebníkovi.
                        </div>
                    </div>
                `;
                return;
            }

            // Zkontroluj chybějící stanoviska DO (SÚ si vyžádá sám)
            if (controls.identifikace.done && controls.identifikace.result === 'vyzidat_do') {
                const pocet = controls.identifikace.chybiDO ? controls.identifikace.chybiDO.length : 0;
                const doNames = controls.identifikace.chybiDO ? controls.identifikace.chybiDO.join(', ') : '';
                infoPanel.className = 'info-panel schedule';
                infoPanel.innerHTML = `
                    <span class="material-icons-outlined">schedule_send</span>
                    <div class="info-panel-content">
                        <div class="info-panel-title">Vyžádat závazná stanoviska DO</div>
                        <div class="info-panel-text">
                            Chybí ${pocet} závazné ${pocet === 1 ? 'stanovisko' : 'stanoviska'} DO: <strong>${doNames}</strong>.<br>
                            SÚ si stanoviska vyžádá. Staví se lhůta pro rozhodnutí. DO mají 30 dnů na vydání stanoviska.
                        </div>
                    </div>
                `;
                return;
            }

            // Standardní stav
            infoPanel.className = 'info-panel';
            infoPanel.innerHTML = `
                <span class="material-icons-outlined">info</span>
                <div class="info-panel-content">
                    <div class="info-panel-title">Kontrola a příprava řízení</div>
                    <div class="info-panel-text">
                        V tomto kroku proveďte kontroly žádosti a definujte parametry řízení (účastníci, pozemky, dotčené orgány). 
                        Řízení je zahájeno dnem doručení bezvadné žádosti (7. 1. 2026), od tohoto data běží lhůta pro vydání rozhodnutí.
                    </div>
                </div>
            `;
        }

        // ==========================================
        // UPDATE UI
        // ==========================================
        function updateUI() {
            let completedCount = 0;
            const totalCount = Object.keys(controls).length;
            const isPrislusny = !controls.prislusnost.done || controls.prislusnost.result === 'ok';
            
            // Kontrola, zda jsou zjištěny vady (pro tlačítko Výzva k doplnění)
            const hasVady = Object.values(controls).some(c => c.done && (c.result === 'vady' || c.result === 'warning'));

            for (const [key, control] of Object.entries(controls)) {
                const card = document.getElementById('card-' + key);
                if (!card) continue;
                
                // Kontroly s vadami neblokují ostatní kontroly - stačí že jsou done
                let dependenciesMet = control.depends.every(dep => controls[dep].done);
                
                // Pokud SÚ není příslušný, nic dalšího nelze dělat
                if (!isPrislusny && key !== 'prislusnost') {
                    dependenciesMet = false;
                }

                // Remove all status classes
                card.classList.remove('status-waiting', 'status-ready', 'status-done', 'status-warning', 'status-error', 'disabled');

                if (control.done) {
                    if (control.result === 'ok') {
                        card.classList.add('status-done');
                    } else if (control.result === 'vady' || control.result === 'warning') {
                        card.classList.add('status-warning');
                    } else {
                        card.classList.add('status-error');
                    }
                    completedCount++;
                    updateCardContent(key, 'done');
                } else if (dependenciesMet) {
                    card.classList.add('status-ready');
                    updateCardContent(key, 'ready');
                } else {
                    card.classList.add('status-waiting', 'disabled');
                    updateCardContent(key, 'waiting');
                }
            }

            // Update progress
            document.getElementById('progressText').textContent = completedCount + ' z ' + totalCount + ' kontrol';
            document.getElementById('progressFill').style.width = (completedCount / totalCount * 100) + '%';

            // Update info panel
            updateInfoPanel();

            // Update summary
            const allDone = Object.values(controls).every(c => c.done);
            const allOk = Object.values(controls).every(c => c.result === 'ok');
            const hasBlocking = Object.values(controls).some(c => c.done && c.result === 'error');
            
            if (!isPrislusny) {
                document.getElementById('summaryTitle').textContent = 'Stavební úřad není příslušný';
                document.getElementById('summaryDesc').textContent = 'Řízení bude postoupeno příslušnému stavebnímu úřadu.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">send</span>Postoupit řízení';
            } else if (allDone && allOk) {
                document.getElementById('summaryTitle').textContent = 'Všechny kontroly dokončeny';
                document.getElementById('summaryDesc').textContent = 'Řízení je připraveno k zahájení. Lhůta začne běžet od 7. 1. 2026.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">play_circle</span>Zahájit řízení';
            } else if (allDone && hasVady && !hasBlocking) {
                // Všechny kontroly hotové, ale jsou vady - nabídnout Výzvu k doplnění
                document.getElementById('summaryTitle').textContent = 'Zjištěny nedostatky v žádosti';
                document.getElementById('summaryDesc').textContent = 'Kontroly dokončeny. Žádost vykazuje nedostatky, bude vydána výzva k doplnění.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">mail</span>Vydat výzvu k doplnění';
            } else if (hasVady) {
                // Jsou vady, ale ne všechny kontroly hotové
                const remaining = Object.values(controls).filter(c => !c.done).length;
                document.getElementById('summaryTitle').textContent = 'Zjištěny nedostatky';
                document.getElementById('summaryDesc').textContent = 'Zjištěny nedostatky. Zbývá ' + remaining + ' kontrol. Dokončete kontroly nebo vydejte výzvu.';
                document.getElementById('btnZahajit').disabled = false;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">mail</span>Vydat výzvu k doplnění';
            } else if (hasBlocking) {
                document.getElementById('summaryTitle').textContent = 'Řízení nelze pokračovat';
                document.getElementById('summaryDesc').textContent = 'Některé kontroly blokují pokračování řízení.';
                document.getElementById('btnZahajit').disabled = true;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">block</span>Řízení blokováno';
            } else {
                document.getElementById('summaryTitle').textContent = 'Dokončete všechny kontroly';
                const remaining = Object.values(controls).filter(c => !c.done).length;
                document.getElementById('summaryDesc').textContent = 'Zbývá ' + remaining + ' kontrol k dokončení.';
                document.getElementById('btnZahajit').disabled = true;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">play_circle</span>Zahájit řízení';
            }
            
            // Aktualizovat stav kontroly Zrychlené řízení
            updateZrychleneRizeniState();
        }

        function updateCardContent(key, status) {
            const card = document.getElementById('card-' + key);
            const statusBadge = card.querySelector('.control-card-status');
            const actionBtn = card.querySelector('.control-card-action');

            const config = {
                prislusnost: { controlId: 'controlPrislusnost', readyText: 'Provést kontrolu', doneText: 'Příslušný', doneTextNeg: 'Nepříslušný' },
                zadost: { controlId: 'controlZadost', readyText: 'Zkontrolovat žádost', doneText: 'Úplná', doneTextNeg: 'Odložení' },
                dokumentace: { controlId: 'controlDokumentace', readyText: 'Provést kontrolu', doneText: 'V pořádku', doneTextNeg: 'Vykazuje vady' },
                pozemky: { controlId: 'controlPozemky', readyText: 'Identifikovat pozemky', doneText: 'Identifikováno', doneTextNeg: 'Identifikováno' },
                up: { controlId: 'controlUP', readyText: 'Provést kontrolu', doneText: 'V souladu', doneTextNeg: 'Nesoulad' },
                identifikace: { controlId: 'controlIdentifikace', readyText: 'Provést kontrolu', doneText: 'V pořádku', doneTextNeg: 'Chybí doklady' },
                ucastnici: { controlId: 'controlUcastnici', readyText: 'Definovat osoby', doneText: 'Kompletní', doneTextNeg: 'Kompletní' },
                zrychlene: { controlId: 'controlZrychlene', readyText: 'Ověřit podmínky', doneText: 'Splněno', doneTextNeg: 'Nesplněno' }
            };

            const ctrl = controls[key];
            const cfg = config[key];

            if (status === 'done') {
                if (ctrl.result === 'ok') {
                    statusBadge.textContent = 'Hotovo';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">check_circle</span>' + cfg.doneText;
                } else if (ctrl.result === 'vady' || ctrl.result === 'warning') {
                    statusBadge.textContent = 'Vady';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">warning</span>' + cfg.doneTextNeg;
                } else {
                    statusBadge.textContent = 'Blokuje';
                    actionBtn.innerHTML = '<span class="material-icons-outlined">cancel</span>' + cfg.doneTextNeg;
                }
                actionBtn.onclick = function() { openControl(cfg.controlId); };
            } else if (status === 'ready') {
                statusBadge.textContent = 'K provedení';
                actionBtn.innerHTML = '<span class="material-icons-outlined">play_arrow</span>' + cfg.readyText;
                actionBtn.onclick = function() { openControl(cfg.controlId); };
            } else {
                statusBadge.textContent = 'Čeká';
                const waitingOn = ctrl.depends.find(dep => !controls[dep].done);
                const waitingText = {
                    prislusnost: 'Nejprve příslušnost',
                    dokumentace: 'Nejprve dokumentace',
                    pozemky: 'Nejprve pozemky',
                    identifikace: 'Nejprve identifikace',
                    doklady: 'Nejprve doklady',
                    up: 'Nejprve územní plán',
                    ucastnici: 'Nejprve osoby'
                };
                actionBtn.innerHTML = '<span class="material-icons-outlined">lock</span>' + (waitingText[waitingOn] || 'Nejprve ostatní kontroly');
                actionBtn.onclick = null;
            }
        }

        // ==========================================
        // COMPLETE CONTROL FUNCTIONS
        // ==========================================
        function completePrislusnost() {
            const prislusnost = document.querySelector('input[name="prislusnost"]:checked').value;
            
            controls.prislusnost.done = true;
            
            if (prislusnost === 'neprislusny') {
                controls.prislusnost.result = 'neprislusny';
                const selectedValue = document.getElementById('postoupitSuSelect').value;
                const selectedOption = document.querySelector(`#postoupitSuDropdown .su-dropdown-option[data-value="${selectedValue}"]`);
                
                if (selectedOption) {
                    controls.prislusnost.postoupit = {
                        nazev: selectedOption.querySelector('.su-option-name').textContent,
                        typSu: selectedOption.getAttribute('data-type'),
                        info: selectedOption.getAttribute('data-info')
                    };
                }
            } else {
                controls.prislusnost.result = 'ok';
                controls.prislusnost.postoupit = null;
            }
            
            closeControl('controlPrislusnost');
            updateUI();
        }
        
        // Zobrazení modálu pro postoupení řízení
        function showPostoupeniModal() {
            const zduvodneni = document.getElementById('zduvodneniNeprislusnosti').value.trim();
            const selectedValue = document.getElementById('postoupitSuSelect').value;
            const selectedOption = document.querySelector(`#postoupitSuDropdown .su-dropdown-option[data-value="${selectedValue}"]`);
            
            let suNazev = '';
            let suAdresa = '';
            
            if (selectedOption) {
                const info = selectedOption.getAttribute('data-info').split('|');
                suNazev = info[0];
                suAdresa = info[1];
            }
            
            // Naplnit modál
            document.getElementById('postoupeniSuNazev').textContent = suNazev;
            document.getElementById('postoupeniSuAdresa').textContent = suAdresa;
            document.getElementById('postoupeniZduvodneni').textContent = zduvodneni;
            
            // Zavřít kontrolu a otevřít modál
            closeControl('controlPrislusnost');
            openModal('postoupeniModal');
        }
        
        // Potvrzení postoupení řízení
        function confirmPostoupeni() {
            const zduvodneni = document.getElementById('zduvodneniNeprislusnosti').value.trim();
            const selectedValue = document.getElementById('postoupitSuSelect').value;
            const selectedOption = document.querySelector(`#postoupitSuDropdown .su-dropdown-option[data-value="${selectedValue}"]`);
            
            controls.prislusnost.done = true;
            controls.prislusnost.result = 'neprislusny';
            
            if (selectedOption) {
                const typSu = selectedOption.getAttribute('data-type');
                controls.prislusnost.postoupit = {
                    nazev: selectedOption.querySelector('.su-option-name').textContent,
                    typSu: typSu,
                    info: selectedOption.getAttribute('data-info'),
                    zduvodneni: zduvodneni
                };
            }
            
            // Přidat do globálního seznamu nedostatků (typ: postoupení)
            addGlobalIssue('postoupeni', {
                text: 'SÚ není příslušný - řízení postoupeno',
                source: 'auto',
                controlName: 'Kontrola příslušnosti'
            });
            
            closeModal('postoupeniModal', null);
            
            // Zobrazit potvrzení
            showPostoupeniConfirmation();
        }
        
        // Zobrazení potvrzení o postoupení
        function showPostoupeniConfirmation() {
            const info = controls.prislusnost.postoupit.info.split('|');
            const nazev = info[0];
            
            // Vytvořit jednoduchý confirmation toast/banner
            const banner = document.createElement('div');
            banner.className = 'confirmation-banner';
            banner.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: #137333;
                color: #fff;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 3000;
                display: flex;
                align-items: center;
                gap: 12px;
                font-size: 14px;
                animation: slideDown 0.3s ease;
            `;
            banner.innerHTML = `
                <span class="material-icons-outlined" style="font-size: 24px;">check_circle</span>
                <div>
                    <div style="font-weight: 500;">Řízení bylo postoupeno</div>
                    <div style="font-size: 12px; opacity: 0.9; margin-top: 2px;">${nazev}</div>
                </div>
            `;
            
            document.body.appendChild(banner);
            
            // Odstranit po 5 sekundách
            setTimeout(() => {
                banner.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => banner.remove(), 300);
            }, 5000);
            
            updateUI();
        }

        function completeDokumentace() {
            controls.dokumentace.done = true;
            
            const hasProblems = Object.values(docCheckState.partStatus).some(s => s !== 'ok');
            
            if (docCheckState.issues.length > 0 || hasProblems) {
                controls.dokumentace.result = 'vady';
                controls.dokumentace.issues = [...docCheckState.issues];
            } else {
                controls.dokumentace.result = 'ok';
                controls.dokumentace.issues = [];
            }
            
            closeControl('controlDokumentace');
            updateUI();
        }

        // ==========================================
        // DOKLADOVÁ ČÁST - DO, VTI, VDI
        // ==========================================
        let identifikaceState = {
            aiAnalyzaDone: false,
            editingSubjektIndex: null,
            subjekty: [
                // DO - Dotčené orgány
                { 
                    id: 'hzs', typ: 'do', nazev: 'HZS Středočeského kraje', detail: 'Požární ochrana',
                    zeZadosti: true, prilozeno: false, 
                    dokument: { typ: 'zavazne_stanovisko', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null, // null | 'kladne' | 'kladne_s_podminkami' | 'zaporne'
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'khs', typ: 'do', nazev: 'KHS Středočeského kraje', detail: 'Hygiena',
                    zeZadosti: true, prilozeno: false,
                    dokument: { typ: 'zavazne_stanovisko', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'ozp', typ: 'do', nazev: 'OŽP - odbor živ. prostředí', detail: 'Obecní úřad',
                    zeZadosti: false, prilozeno: false,
                    dokument: { typ: 'jes', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                
                // VTI - Vlastníci technické infrastruktury
                { 
                    id: 'cez', typ: 'vti', nazev: 'ČEZ Distribuce, a.s.', detail: 'Elektřina',
                    zeZadosti: true, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'gasnet', typ: 'vti', nazev: 'GasNet, s.r.o.', detail: 'Plyn',
                    zeZadosti: true, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'vak', typ: 'vti', nazev: 'Vodárny Kladno-Mělník', detail: 'Vodovod a kanalizace',
                    zeZadosti: true, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                { 
                    id: 'cetin', typ: 'vti', nazev: 'CETIN, a.s.', detail: 'Telekomunikace',
                    zeZadosti: false, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                },
                
                // VDI - Vlastníci dopravní infrastruktury
                { 
                    id: 'ksus', typ: 'vdi', nazev: 'KSÚS Středočeského kraje', detail: 'Silnice II. a III. třídy',
                    zeZadosti: false, prilozeno: false,
                    dokument: { typ: 'vyjadreni', cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                    vysledek: null,
                    podminky: [],
                    poznamka: ''
                }
            ]
        };

        // Inicializace renderování při otevření
        function initIdentifikaceMatrix() {
            renderIdentifikaceMatrix();
            updateIdentifikaceResult();
            updateSouhrnRozhodnuti();
        }

        function renderIdentifikaceMatrix() {
            const groups = {
                do: { container: document.getElementById('matrixDO'), countEl: document.getElementById('countDO'), items: [] },
                vti: { container: document.getElementById('matrixVTI'), countEl: document.getElementById('countVTI'), items: [] },
                vdi: { container: document.getElementById('matrixVDI'), countEl: document.getElementById('countVDI'), items: [] }
            };

            // Rozdělit subjekty do skupin
            identifikaceState.subjekty.forEach((s, index) => {
                if (groups[s.typ]) {
                    groups[s.typ].items.push({ ...s, index });
                }
            });

            // Renderovat každou skupinu
            for (const [typ, group] of Object.entries(groups)) {
                group.countEl.textContent = group.items.length;
                
                let html = '';
                group.items.forEach(s => {
                    const rowClass = getRowStatusClass(s);
                    
                    // Sloupec Žádost
                    const zeZadostiCheck = s.zeZadosti 
                        ? '<div class="matrix-check yes"><span class="material-icons-outlined">check</span></div>'
                        : '<div class="matrix-check no"><span class="material-icons-outlined">remove</span></div>';
                    
                    // Sloupec Přiloženo
                    let prilozenoCheck;
                    if (s.prilozeno) {
                        prilozenoCheck = '<div class="matrix-check yes"><span class="material-icons-outlined">check</span></div>';
                    } else if (identifikaceState.aiAnalyzaDone) {
                        prilozenoCheck = '<div class="matrix-check missing"><span class="material-icons-outlined">close</span></div>';
                    } else {
                        prilozenoCheck = '<div class="matrix-check no"><span class="material-icons-outlined">remove</span></div>';
                    }

                    // Sloupec Výsledek
                    let vysledekHtml = '';
                    if (s.prilozeno) {
                        const vysledekClass = s.vysledek === 'kladne' ? 'kladne' : (s.vysledek === 'kladne_s_podminkami' ? 's-podminkami' : (s.vysledek === 'zaporne' ? 'zaporne' : ''));
                        vysledekHtml = `
                            <select class="matrix-vysledek-select ${vysledekClass}" onchange="setVysledek(${s.index}, this.value)">
                                <option value="" ${!s.vysledek ? 'selected' : ''}>—</option>
                                <option value="kladne" ${s.vysledek === 'kladne' ? 'selected' : ''}>Kladné</option>
                                <option value="kladne_s_podminkami" ${s.vysledek === 'kladne_s_podminkami' ? 'selected' : ''}>S podmínkami</option>
                                <option value="zaporne" ${s.vysledek === 'zaporne' ? 'selected' : ''}>Záporné</option>
                            </select>
                        `;
                    } else {
                        vysledekHtml = '<span style="color: #9aa0a6; font-size: 11px;">—</span>';
                    }

                    // Sloupec Podmínky
                    let podminkyHtml = '';
                    if (s.prilozeno) {
                        const pocetPodminek = s.podminky.filter(p => p.aktivni).length;
                        const hasClass = pocetPodminek > 0 ? 'has-podminky' : '';
                        podminkyHtml = `
                            <button class="btn-podminky ${hasClass}" onclick="openPodminkyModal(${s.index})">
                                <span class="material-icons-outlined">edit_note</span>
                                <span class="podminky-count">${pocetPodminek}</span>
                            </button>
                        `;
                    } else {
                        podminkyHtml = '<span style="color: #9aa0a6; font-size: 11px;">—</span>';
                    }

                    html += `
                        <div class="matrix-row extended ${rowClass}" data-index="${s.index}">
                            <div class="matrix-subjekt">
                                <div class="matrix-subjekt-name">${s.nazev}</div>
                                <div class="matrix-subjekt-detail">${s.detail}</div>
                            </div>
                            <div class="matrix-cell">${zeZadostiCheck}</div>
                            <div class="matrix-cell">${prilozenoCheck}</div>
                            <div class="matrix-cell">${vysledekHtml}</div>
                            <div class="matrix-cell">${podminkyHtml}</div>
                        </div>
                    `;
                });
                group.container.innerHTML = html;
            }
        }

        function getRowStatusClass(s) {
            if (!s.prilozeno && identifikaceState.aiAnalyzaDone) return 'status-missing';
            if (s.prilozeno && s.vysledek === 'zaporne') return 'status-missing';
            if (s.prilozeno && s.vysledek === 'kladne_s_podminkami') return 'status-ok';
            if (s.prilozeno && s.vysledek === 'kladne') return 'status-ok';
            if (s.prilozeno && !s.vysledek) return 'status-extra';
            return '';
        }

        function setVysledek(index, value) {
            identifikaceState.subjekty[index].vysledek = value || null;
            renderIdentifikaceMatrix();
            updateIdentifikaceResult();
            updateSouhrnRozhodnuti();
        }

        // Modal pro podmínky
        function openPodminkyModal(index) {
            identifikaceState.editingSubjektIndex = index;
            const s = identifikaceState.subjekty[index];
            
            // Nastavit titulek
            document.getElementById('podminkyModalTitle').textContent = s.nazev;
            
            // Typ dokladu
            const typLabels = { jes: 'Jednotné environmentální stanovisko', zavazne_stanovisko: 'Závazné stanovisko', vyjadreni: 'Vyjádření' };
            document.getElementById('podminkyDokTyp').textContent = typLabels[s.dokument.typ] || s.dokument.typ;
            
            // Metadata dokumentu
            document.getElementById('podminkyDokCj').value = s.dokument.cisloJednaci || '';
            document.getElementById('podminkyDokDatum').value = s.dokument.datumVydani || '';
            document.getElementById('podminkyDokSoubor').textContent = s.dokument.nazevSouboru || '—';
            
            // Výsledek
            document.querySelectorAll('#vysledekOptions .vysledek-option').forEach(opt => {
                const input = opt.querySelector('input');
                input.checked = input.value === s.vysledek;
                opt.classList.toggle('selected', input.checked);
            });
            
            // Podmínky section viditelnost
            const showPodminky = s.vysledek === 'kladne_s_podminkami';
            document.getElementById('podminkySectionList').style.display = showPodminky ? 'block' : 'none';
            
            // Renderovat podmínky
            renderPodminkyList();
            
            // Poznámka
            document.getElementById('podminkyPoznamka').value = s.poznamka || '';
            
            // Otevřít modal
            document.getElementById('podminkyModal').classList.add('open');
        }

        function closePodminkyModal() {
            document.getElementById('podminkyModal').classList.remove('open');
            identifikaceState.editingSubjektIndex = null;
        }

        function renderPodminkyList() {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            const s = identifikaceState.subjekty[index];
            const list = document.getElementById('podminkyList');
            
            if (s.podminky.length === 0) {
                list.innerHTML = '<p style="color: #5f6368; font-size: 12px; font-style: italic;">Zatím nebyly přidány žádné podmínky.</p>';
                return;
            }
            
            let html = '';
            s.podminky.forEach((p, i) => {
                html += `
                    <div class="podminka-item ${p.aktivni ? '' : 'inactive'}">
                        <input type="checkbox" class="podminka-checkbox" ${p.aktivni ? 'checked' : ''} 
                            onchange="togglePodminka(${i}, this.checked)">
                        <div class="podminka-text">${p.text}</div>
                        <button class="podminka-remove" onclick="removePodminka(${i})">
                            <span class="material-icons-outlined">close</span>
                        </button>
                    </div>
                `;
            });
            list.innerHTML = html;
        }

        function addPodminka() {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            const input = document.getElementById('addPodminkaText');
            const text = input.value.trim();
            if (!text) return;
            
            identifikaceState.subjekty[index].podminky.push({ text: text, aktivni: true });
            input.value = '';
            renderPodminkyList();
        }

        function removePodminka(podminkaIndex) {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            identifikaceState.subjekty[index].podminky.splice(podminkaIndex, 1);
            renderPodminkyList();
        }

        function togglePodminka(podminkaIndex, checked) {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            identifikaceState.subjekty[index].podminky[podminkaIndex].aktivni = checked;
            renderPodminkyList();
        }

        function savePodminkyModal() {
            const index = identifikaceState.editingSubjektIndex;
            if (index === null) return;
            
            const s = identifikaceState.subjekty[index];
            
            // Uložit metadata dokumentu
            s.dokument.cisloJednaci = document.getElementById('podminkyDokCj').value;
            s.dokument.datumVydani = document.getElementById('podminkyDokDatum').value;
            
            // Uložit výsledek
            const selectedRadio = document.querySelector('#vysledekOptions input:checked');
            s.vysledek = selectedRadio ? selectedRadio.value : null;
            
            // Uložit poznámku
            s.poznamka = document.getElementById('podminkyPoznamka').value;
            
            closePodminkyModal();
            renderIdentifikaceMatrix();
            updateIdentifikaceResult();
            updateSouhrnRozhodnuti();
        }

        // Event listener pro výsledek radio v modalu
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('#vysledekOptions .vysledek-option').forEach(opt => {
                opt.addEventListener('click', function() {
                    document.querySelectorAll('#vysledekOptions .vysledek-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input').checked = true;
                    
                    // Zobrazit/skrýt podmínky section
                    const showPodminky = this.querySelector('input').value === 'kladne_s_podminkami';
                    document.getElementById('podminkySectionList').style.display = showPodminky ? 'block' : 'none';
                });
            });
        });

        function aiAnalyzeDoklady() {
            const btn = document.getElementById('btnAiAnalyzeDoklady');
            const status = document.getElementById('aiAnalyzeStatus');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span>Analyzuji...';
            status.innerHTML = '<span class="material-icons-outlined">sync</span>Probíhá AI analýza dokladové části...';
            status.className = 'identifikace-ai-status';

            setTimeout(function() {
                // Simulace AI výsledků - dokumenty nalezeny s metadaty a podmínkami
                identifikaceState.subjekty.forEach(s => {
                    if (s.id === 'hzs') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'zavazne_stanovisko', cisloJednaci: 'HSCR-2025-0147', datumVydani: '2025-01-08', nazevSouboru: 'Stanovisko_HZS_2025-01-08.pdf' };
                        s.vysledek = 'kladne';
                    } else if (s.id === 'khs') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'zavazne_stanovisko', cisloJednaci: 'KHS/2025/00891', datumVydani: '2025-01-05', nazevSouboru: 'Vyjadreni_KHS_2025-01-05.pdf' };
                        s.vysledek = 'kladne_s_podminkami';
                        s.podminky = [
                            { text: 'K žádosti o kolaudační rozhodnutí předložit doklad o výsledku laboratorní kontroly vzorku pitné vody.', aktivni: true },
                            { text: 'K žádosti o kolaudační rozhodnutí předložit doklad o měření intenzity el. osvětlení v prostoru kanceláře.', aktivni: true }
                        ];
                    } else if (s.id === 'cez') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'CEZ/2024/987654', datumVydani: '2024-12-15', nazevSouboru: 'Vyjadreni_CEZ_2024-12-15.pdf' };
                        s.vysledek = 'kladne_s_podminkami';
                        s.podminky = [
                            { text: 'Při realizaci stavby dodržet ochranné pásmo elektrického vedení NN.', aktivni: true }
                        ];
                    } else if (s.id === 'gasnet') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'GN/5678/2024', datumVydani: '2024-12-12', nazevSouboru: 'Vyjadreni_GasNet_2024-12-12.pdf' };
                        s.vysledek = 'kladne';
                    } else if (s.id === 'vak') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'VKM/2024/12345', datumVydani: '2024-12-20', nazevSouboru: 'Vyjadreni_VaK_2024-12-20.pdf' };
                        s.vysledek = 'kladne_s_podminkami';
                        s.podminky = [
                            { text: 'Přípojka vodovodu bude provedena podle přiložené situace.', aktivni: true },
                            { text: 'Před záhozem bude provedena tlaková zkouška za účasti zástupce VaK.', aktivni: true }
                        ];
                    } else if (s.id === 'cetin') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'CETIN/2024/98765', datumVydani: '2024-12-18', nazevSouboru: 'Vyjadreni_CETIN_2024-12-18.pdf' };
                        s.vysledek = 'kladne';
                    } else if (s.id === 'ksus') {
                        s.prilozeno = true;
                        s.dokument = { typ: 'vyjadreni', cisloJednaci: 'KSUS/2025/001234', datumVydani: '2025-01-02', nazevSouboru: 'Stanovisko_KSUS_2025-01-02.pdf' };
                        s.vysledek = 'kladne_s_podminkami';
                        s.podminky = [
                            { text: 'Sjezd bude proveden v souladu s ČSN 73 6110.', aktivni: true }
                        ];
                    }
                    // ozp (DO) zůstává nepřiložen jako příklad chybějícího závazného stanoviska DO
                });

                identifikaceState.aiAnalyzaDone = true;
                
                btn.innerHTML = '<span class="material-icons-outlined">check</span>Analýza dokončena';
                btn.disabled = true;
                
                const nalezeno = identifikaceState.subjekty.filter(s => s.prilozeno).length;
                status.innerHTML = `<span class="material-icons-outlined">check_circle</span>Nalezeno ${nalezeno} dokumentů v dokladové části`;
                status.className = 'identifikace-ai-status done';

                renderIdentifikaceMatrix();
                updateIdentifikaceResult();
                updateSouhrnRozhodnuti();
            }, 2000);
        }

        function showDocsTooltip(index, btnEl) {
            const s = identifikaceState.subjekty[index];
            alert('Dokument: ' + s.dokument.nazevSouboru + '\nČ.j.: ' + s.dokument.cisloJednaci + '\nDatum: ' + s.dokument.datumVydani);
        }

        function addSubjekt() {
            const typSelect = document.getElementById('addSubjektTyp');
            const nazevInput = document.getElementById('addSubjektNazev');
            
            const typ = typSelect.value;
            const nazev = nazevInput.value.trim();
            
            if (!nazev) {
                alert('Zadejte název subjektu');
                return;
            }

            const typLabels = { do: 'Dotčený orgán', vti: 'Technická infrastruktura', vdi: 'Dopravní infrastruktura' };
            const dokTyp = typ === 'do' ? 'zavazne_stanovisko' : 'vyjadreni';

            identifikaceState.subjekty.push({
                id: 'custom_' + Date.now(),
                typ: typ,
                nazev: nazev,
                detail: typLabels[typ],
                zeZadosti: false,
                prilozeno: false,
                dokument: { typ: dokTyp, cisloJednaci: '', datumVydani: '', nazevSouboru: '' },
                vysledek: null,
                podminky: [],
                poznamka: ''
            });

            nazevInput.value = '';
            renderIdentifikaceMatrix();
            updateIdentifikaceResult();
            updateSouhrnRozhodnuti();
        }

        function updateSouhrnRozhodnuti() {
            const stats = document.getElementById('souhrnStats');
            const reportActions = document.getElementById('reportActions');
            
            const prilozene = identifikaceState.subjekty.filter(s => s.prilozeno);
            const kladne = prilozene.filter(s => s.vysledek === 'kladne').length;
            const sPodminkami = prilozene.filter(s => s.vysledek === 'kladne_s_podminkami').length;
            const zaporne = prilozene.filter(s => s.vysledek === 'zaporne').length;
            const celkemPodminek = identifikaceState.subjekty.reduce((sum, s) => sum + s.podminky.filter(p => p.aktivni).length, 0);
            const chybiDO = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && s.typ === 'do').length;
            const chybiVTI = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && (s.typ === 'vti' || s.typ === 'vdi')).length;
            
            // Zobrazit tlačítka reportu pokud jsou nějaká data
            if (reportActions) {
                reportActions.style.display = (identifikaceState.aiAnalyzaDone && prilozene.length > 0) ? 'flex' : 'none';
            }
            
            let html = `
                <div class="souhrn-stat ok">
                    <span class="material-icons-outlined">check_circle</span>
                    Kladné: ${kladne}
                </div>
                <div class="souhrn-stat podminky">
                    <span class="material-icons-outlined">task_alt</span>
                    S podmínkami: ${sPodminkami} (celkem ${celkemPodminek} podmínek)
                </div>
            `;
            
            if (zaporne > 0) {
                html += `
                    <div class="souhrn-stat error">
                        <span class="material-icons-outlined">cancel</span>
                        Záporné: ${zaporne}
                    </div>
                `;
            }
            
            if (chybiDO > 0) {
                html += `
                    <div class="souhrn-stat warning">
                        <span class="material-icons-outlined">schedule_send</span>
                        Vyžádat DO: ${chybiDO}
                    </div>
                `;
            }
            
            if (chybiVTI > 0) {
                html += `
                    <div class="souhrn-stat warning">
                        <span class="material-icons-outlined">warning</span>
                        Chybí VTI/VDI: ${chybiVTI}
                    </div>
                `;
            }
            
            stats.innerHTML = html;
        }

        // ==========================================
        // REPORT FUNCTIONS
        // ==========================================
        
        function generateReportData() {
            const typLabels = { do: 'Dotčený orgán', vti: 'Vlastník tech. infrastruktury', vdi: 'Vlastník dopr. infrastruktury' };
            const vysledekLabels = { kladne: 'Kladné', kladne_s_podminkami: 'Kladné s podmínkami', zaporne: 'Záporné' };
            const dokTypLabels = { jes: 'Jednotné environmentální stanovisko', zavazne_stanovisko: 'Závazné stanovisko', vyjadreni: 'Vyjádření' };
            
            return {
                metadata: {
                    datumVytvoreni: new Date().toISOString(),
                    spisZn: 'SR00X01I35GT',
                    nazevZameru: 'Novostavba RD včetně přípojek'
                },
                souhrn: {
                    celkemSubjektu: identifikaceState.subjekty.length,
                    prilozenoDokumentu: identifikaceState.subjekty.filter(s => s.prilozeno).length,
                    kladnych: identifikaceState.subjekty.filter(s => s.vysledek === 'kladne').length,
                    sPodminkami: identifikaceState.subjekty.filter(s => s.vysledek === 'kladne_s_podminkami').length,
                    zapornych: identifikaceState.subjekty.filter(s => s.vysledek === 'zaporne').length,
                    celkemPodminek: identifikaceState.subjekty.reduce((sum, s) => sum + s.podminky.filter(p => p.aktivni).length, 0),
                    chybiDO: identifikaceState.subjekty.filter(s => !s.prilozeno && s.typ === 'do').map(s => s.nazev),
                    chybiVTI_VDI: identifikaceState.subjekty.filter(s => !s.prilozeno && (s.typ === 'vti' || s.typ === 'vdi')).map(s => s.nazev)
                },
                subjekty: identifikaceState.subjekty.map(s => ({
                    id: s.id,
                    nazev: s.nazev,
                    typ: s.typ,
                    typLabel: typLabels[s.typ],
                    detail: s.detail,
                    prilozeno: s.prilozeno,
                    dokument: s.dokument ? {
                        typ: s.dokument.typ,
                        typLabel: dokTypLabels[s.dokument.typ],
                        cisloJednaci: s.dokument.cisloJednaci,
                        datumVydani: s.dokument.datumVydani,
                        nazevSouboru: s.dokument.nazevSouboru
                    } : null,
                    vysledek: s.vysledek,
                    vysledekLabel: vysledekLabels[s.vysledek] || null,
                    podminky: s.podminky.filter(p => p.aktivni).map(p => p.text),
                    poznamka: s.poznamka
                })),
                podminkyProRozhodnuti: identifikaceState.subjekty
                    .filter(s => s.podminky.some(p => p.aktivni))
                    .map(s => ({
                        subjekt: s.nazev,
                        cisloJednaci: s.dokument?.cisloJednaci || '',
                        datumVydani: s.dokument?.datumVydani || '',
                        podminky: s.podminky.filter(p => p.aktivni).map(p => p.text)
                    }))
            };
        }

        function showReportModal() {
            const data = generateReportData();
            const content = document.getElementById('reportContent');
            
            let html = `
                <div class="report-header">
                    <h2>REPORT DOKLADOVÉ ČÁSTI</h2>
                    <p>Spis. zn.: ${data.metadata.spisZn}</p>
                    <p>${data.metadata.nazevZameru}</p>
                    <p style="font-size: 11px; color: #5f6368;">Vygenerováno: ${new Date().toLocaleString('cs-CZ')}</p>
                </div>

                <div class="report-section">
                    <h3>SOUHRN</h3>
                    <table class="report-table">
                        <tr><td>Celkem subjektů:</td><td><strong>${data.souhrn.celkemSubjektu}</strong></td></tr>
                        <tr><td>Přiloženo dokumentů:</td><td><strong>${data.souhrn.prilozenoDokumentu}</strong></td></tr>
                        <tr><td>Kladných:</td><td><strong style="color: #137333;">${data.souhrn.kladnych}</strong></td></tr>
                        <tr><td>S podmínkami:</td><td><strong style="color: #004289;">${data.souhrn.sPodminkami}</strong></td></tr>
                        <tr><td>Záporných:</td><td><strong style="color: #c5221f;">${data.souhrn.zapornych}</strong></td></tr>
                        <tr><td>Celkem podmínek:</td><td><strong>${data.souhrn.celkemPodminek}</strong></td></tr>
                    </table>
            `;
            
            if (data.souhrn.chybiDO.length > 0) {
                html += `<p style="color: #b06000; margin-top: 12px;"><strong>⚠ Chybí závazná stanoviska DO:</strong> ${data.souhrn.chybiDO.join(', ')}</p>`;
            }
            if (data.souhrn.chybiVTI_VDI.length > 0) {
                html += `<p style="color: #b06000;"><strong>⚠ Chybí vyjádření VTI/VDI:</strong> ${data.souhrn.chybiVTI_VDI.join(', ')}</p>`;
            }
            
            html += `</div>`;

            // Přehled stanovisek a vyjádření
            html += `
                <div class="report-section">
                    <h3>PŘEHLED STANOVISEK A VYJÁDŘENÍ</h3>
                    <table class="report-table full-width">
                        <thead>
                            <tr>
                                <th>Subjekt</th>
                                <th>Typ</th>
                                <th>Č.j.</th>
                                <th>Datum</th>
                                <th>Výsledek</th>
                                <th>Podmínek</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.subjekty.filter(s => s.prilozeno).forEach(s => {
                const vysledekClass = s.vysledek === 'kladne' ? 'color: #137333;' : (s.vysledek === 'zaporne' ? 'color: #c5221f;' : 'color: #004289;');
                html += `
                    <tr>
                        <td><strong>${s.nazev}</strong><br><small>${s.detail}</small></td>
                        <td>${s.typLabel}</td>
                        <td>${s.dokument?.cisloJednaci || '—'}</td>
                        <td>${s.dokument?.datumVydani || '—'}</td>
                        <td style="${vysledekClass}">${s.vysledekLabel || '—'}</td>
                        <td>${s.podminky.length}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div>`;

            // Podmínky pro rozhodnutí
            if (data.podminkyProRozhodnuti.length > 0) {
                html += `
                    <div class="report-section">
                        <h3>PODMÍNKY PRO ROZHODNUTÍ</h3>
                        <p style="font-size: 12px; color: #5f6368; margin-bottom: 16px;">
                            Následující podmínky budou součástí rozhodnutí o povolení stavby.
                        </p>
                `;
                
                let podminkaIndex = 1;
                data.podminkyProRozhodnuti.forEach((skupina, i) => {
                    html += `
                        <div class="report-podminka-skupina">
                            <div class="report-podminka-subjekt">
                                <strong>${skupina.subjekt}</strong>
                                ${skupina.cisloJednaci ? `<span>č.j.: ${skupina.cisloJednaci}</span>` : ''}
                                ${skupina.datumVydani ? `<span>ze dne ${skupina.datumVydani}</span>` : ''}
                            </div>
                            <ol class="report-podminka-list" start="${podminkaIndex}">
                    `;
                    skupina.podminky.forEach(p => {
                        html += `<li>${p}</li>`;
                        podminkaIndex++;
                    });
                    html += `</ol></div>`;
                });
                
                html += `</div>`;
            }

            content.innerHTML = html;
            document.getElementById('reportModal').classList.add('open');
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('open');
        }

        function downloadReport(format) {
            const data = generateReportData();
            
            if (format === 'json') {
                downloadReportJSON(data);
            } else if (format === 'txt') {
                downloadReportTXT(data);
            }
        }

        function downloadReportJSON(data) {
            if (!data) data = generateReportData();
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report_dokladova_cast_${data.metadata.spisZn}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadReportTXT(data) {
            if (!data) data = generateReportData();
            
            let txt = `REPORT DOKLADOVÉ ČÁSTI
${'='.repeat(60)}
Spis. zn.: ${data.metadata.spisZn}
Záměr: ${data.metadata.nazevZameru}
Vygenerováno: ${new Date().toLocaleString('cs-CZ')}

SOUHRN
${'-'.repeat(60)}
Celkem subjektů: ${data.souhrn.celkemSubjektu}
Přiloženo dokumentů: ${data.souhrn.prilozenoDokumentu}
Kladných: ${data.souhrn.kladnych}
S podmínkami: ${data.souhrn.sPodminkami}
Záporných: ${data.souhrn.zapornych}
Celkem podmínek: ${data.souhrn.celkemPodminek}
`;
            
            if (data.souhrn.chybiDO.length > 0) {
                txt += `\n⚠ Chybí závazná stanoviska DO: ${data.souhrn.chybiDO.join(', ')}`;
            }
            if (data.souhrn.chybiVTI_VDI.length > 0) {
                txt += `\n⚠ Chybí vyjádření VTI/VDI: ${data.souhrn.chybiVTI_VDI.join(', ')}`;
            }

            txt += `\n\nPŘEHLED STANOVISEK A VYJÁDŘENÍ
${'-'.repeat(60)}\n`;
            
            data.subjekty.filter(s => s.prilozeno).forEach((s, i) => {
                txt += `
${i + 1}. ${s.nazev} (${s.typLabel})
   Č.j.: ${s.dokument?.cisloJednaci || '—'}
   Datum: ${s.dokument?.datumVydani || '—'}
   Výsledek: ${s.vysledekLabel || '—'}
   Podmínek: ${s.podminky.length}
`;
            });

            if (data.podminkyProRozhodnuti.length > 0) {
                txt += `\n\nPODMÍNKY PRO ROZHODNUTÍ
${'-'.repeat(60)}
Následující podmínky budou součástí rozhodnutí o povolení stavby:\n`;
                
                let podminkaIndex = 1;
                data.podminkyProRozhodnuti.forEach(skupina => {
                    txt += `\n${skupina.subjekt}`;
                    if (skupina.cisloJednaci) txt += ` (č.j.: ${skupina.cisloJednaci}`;
                    if (skupina.datumVydani) txt += ` ze dne ${skupina.datumVydani}`;
                    if (skupina.cisloJednaci) txt += `)`;
                    txt += `:\n`;
                    
                    skupina.podminky.forEach(p => {
                        txt += `   ${podminkaIndex}. ${p}\n`;
                        podminkaIndex++;
                    });
                });
            }

            txt += `\n${'='.repeat(60)}
Konec reportu
`;
            
            const blob = new Blob([txt], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report_dokladova_cast_${data.metadata.spisZn}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadReportHTML() {
            const data = generateReportData();
            const reportContent = document.getElementById('reportContent').innerHTML;
            
            const html = `<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Report dokladové části - ${data.metadata.spisZn}</title>
    <style>
        body { font-family: 'Segoe UI', Roboto, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; }
        h2 { color: #004289; margin: 0; }
        h3 { color: #202124; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px; margin-top: 24px; }
        table { border-collapse: collapse; margin: 12px 0; }
        table.full-width { width: 100%; }
        th, td { padding: 8px 12px; text-align: left; border: 1px solid #e0e0e0; }
        th { background: #f8f9fa; font-weight: 600; }
        .report-header { text-align: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #004289; }
        .report-section { margin-bottom: 24px; }
        .report-podminka-skupina { margin-bottom: 16px; padding: 12px; background: #f8f9fa; border-radius: 8px; }
        .report-podminka-subjekt { font-size: 14px; margin-bottom: 8px; }
        .report-podminka-subjekt span { margin-left: 12px; color: #5f6368; font-size: 12px; }
        .report-podminka-list { margin: 0; padding-left: 24px; }
        .report-podminka-list li { margin-bottom: 6px; }
        small { color: #5f6368; }
    </style>
</head>
<body>
${reportContent}
</body>
</html>`;
            
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report_dokladova_cast_${data.metadata.spisZn}_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function updateIdentifikaceResult() {
            const resultItems = document.getElementById('identifikaceResultItems');
            const resultPreview = document.getElementById('resultIdentifikace');
            
            const prilozene = identifikaceState.subjekty.filter(s => s.prilozeno);
            const chybiDO = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && s.typ === 'do');
            const chybiVTI_VDI = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && (s.typ === 'vti' || s.typ === 'vdi'));
            const zaporne = prilozene.filter(s => s.vysledek === 'zaporne');
            const bezVysledku = prilozene.filter(s => !s.vysledek);

            let html = '';
            
            // Přiložené dokumenty
            html += `
                <div class="identifikace-result-item ok">
                    <span class="material-icons-outlined">description</span>
                    <span>Přiloženo: <span class="count">${prilozene.length}</span> dokumentů</span>
                </div>
            `;

            // Záporné stanovisko
            if (zaporne.length > 0) {
                const zaporneNames = zaporne.map(s => s.nazev).join(', ');
                html += `
                    <div class="identifikace-result-item error">
                        <span class="material-icons-outlined">cancel</span>
                        <span>Záporné stanovisko: <span class="count">${zaporne.length}</span></span>
                        <span class="detail">(${zaporneNames})</span>
                    </div>
                `;
            }

            // Chybějící závazná stanoviska DO - SÚ si vyžádá sám
            if (chybiDO.length > 0) {
                const chybiDONames = chybiDO.map(s => s.nazev).join(', ');
                html += `
                    <div class="identifikace-result-item warning">
                        <span class="material-icons-outlined">schedule_send</span>
                        <span>Vyžádat stanovisko: <span class="count">${chybiDO.length}</span> DO</span>
                        <span class="detail">(${chybiDONames})</span>
                    </div>
                    <div class="identifikace-result-item info" style="margin-left: 26px; font-size: 12px;">
                        <span class="material-icons-outlined">info</span>
                        <span>Staví se lhůta pro rozhodnutí • DO má 30 dnů na vydání stanoviska</span>
                    </div>
                `;
            }

            // Chybějící vyjádření VTI/VDI - vada žádosti
            if (chybiVTI_VDI.length > 0) {
                const chybiVTINames = chybiVTI_VDI.map(s => s.nazev).join(', ');
                html += `
                    <div class="identifikace-result-item warning">
                        <span class="material-icons-outlined">warning</span>
                        <span>Chybí vyjádření: <span class="count">${chybiVTI_VDI.length}</span> VTI/VDI</span>
                        <span class="detail">(${chybiVTINames})</span>
                    </div>
                    <div class="identifikace-result-item info" style="margin-left: 26px; font-size: 12px;">
                        <span class="material-icons-outlined">mail</span>
                        <span>Bude vydána výzva k doplnění stavebníkovi</span>
                    </div>
                `;
            }

            // Dokumenty bez hodnocení
            if (bezVysledku.length > 0 && identifikaceState.aiAnalyzaDone) {
                html += `
                    <div class="identifikace-result-item info">
                        <span class="material-icons-outlined">pending</span>
                        <span>Čeká na vyhodnocení: <span class="count">${bezVysledku.length}</span></span>
                    </div>
                `;
            }

            // Vše v pořádku
            if (chybiDO.length === 0 && chybiVTI_VDI.length === 0 && zaporne.length === 0 && bezVysledku.length === 0 && identifikaceState.aiAnalyzaDone) {
                html += `
                    <div class="identifikace-result-item ok">
                        <span class="material-icons-outlined">check_circle</span>
                        <span>Kontrola dokladové části dokončena</span>
                    </div>
                `;
            }

            resultItems.innerHTML = html;

            // Update result preview
            if (!identifikaceState.aiAnalyzaDone) {
                resultPreview.className = 'result-preview';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">info</span>
                        Čeká na AI analýzu
                    </div>
                    <div class="result-preview-text">Spusťte AI analýzu dokladové části pro automatické rozpoznání přiložených dokumentů.</div>
                `;
            } else if (zaporne.length > 0) {
                resultPreview.className = 'result-preview negative';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">cancel</span>
                        Záporné stanovisko
                    </div>
                    <div class="result-preview-text">
                        ${zaporne.map(s => s.nazev).join(', ')} vydal(y) záporné stanovisko.<br>
                        Záměru nelze vyhovět nebo je třeba řešit rozpor.
                    </div>
                `;
            } else if (chybiVTI_VDI.length > 0) {
                resultPreview.className = 'result-preview warning';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">warning</span>
                        Chybí vyjádření VTI/VDI
                    </div>
                    <div class="result-preview-text">
                        Chybí ${chybiVTI_VDI.length} vyjádření vlastníků sítí. Vada žádosti → výzva k doplnění.
                    </div>
                `;
            } else if (chybiDO.length > 0) {
                resultPreview.className = 'result-preview warning';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">schedule_send</span>
                        Vyžádat stanoviska DO
                    </div>
                    <div class="result-preview-text">
                        Chybí ${chybiDO.length} závazné stanovisko DO. SÚ si vyžádá. Staví se lhůta.
                    </div>
                `;
            } else if (bezVysledku.length > 0) {
                resultPreview.className = 'result-preview';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">pending</span>
                        Dokončete vyhodnocení
                    </div>
                    <div class="result-preview-text">
                        ${bezVysledku.length} dokumentů čeká na vyhodnocení výsledku (kladné/záporné/s podmínkami).
                    </div>
                `;
            } else {
                const celkemPodminek = identifikaceState.subjekty.reduce((sum, s) => sum + s.podminky.filter(p => p.aktivni).length, 0);
                resultPreview.className = 'result-preview positive';
                resultPreview.innerHTML = `
                    <div class="result-preview-title">
                        <span class="material-icons-outlined">check_circle</span>
                        Dokladová část v pořádku
                    </div>
                    <div class="result-preview-text">
                        Všechny dokumenty zkontrolovány. Celkem ${celkemPodminek} podmínek pro rozhodnutí.
                    </div>
                `;
            }
        }

        function completeIdentifikace() {
            const chybiDO = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && s.typ === 'do');
            const chybiVTI_VDI = identifikaceState.subjekty.filter(s => !s.prilozeno && identifikaceState.aiAnalyzaDone && (s.typ === 'vti' || s.typ === 'vdi'));
            const zaporne = identifikaceState.subjekty.filter(s => s.vysledek === 'zaporne');
            
            controls.identifikace.done = true;
            
            // Uložit kompletní data pro generování rozhodnutí
            controls.identifikace.subjekty = JSON.parse(JSON.stringify(identifikaceState.subjekty));
            controls.identifikace.chybiDO = chybiDO.map(s => s.nazev);
            controls.identifikace.chybiVTI_VDI = chybiVTI_VDI.map(s => s.nazev);
            
            // Data pro rozhodnutí - podmínky seskupené podle subjektu
            controls.identifikace.dataProRozhodnuti = {
                stanoviskaAVyjadreni: identifikaceState.subjekty.filter(s => s.prilozeno).map(s => ({
                    nazev: s.nazev,
                    typ: s.typ,
                    dokument: s.dokument,
                    vysledek: s.vysledek,
                    podminky: s.podminky.filter(p => p.aktivni).map(p => p.text)
                })),
                podminkyProRozhodnuti: identifikaceState.subjekty
                    .filter(s => s.podminky.some(p => p.aktivni))
                    .map(s => ({
                        subjekt: s.nazev,
                        cisloJednaci: s.dokument.cisloJednaci,
                        datumVydani: s.dokument.datumVydani,
                        podminky: s.podminky.filter(p => p.aktivni).map(p => p.text)
                    }))
            };
            
            // Určit výsledek kontroly
            if (zaporne.length > 0) {
                controls.identifikace.result = 'error';
            } else if (chybiVTI_VDI.length > 0) {
                controls.identifikace.result = 'vady';
            } else if (chybiDO.length > 0) {
                controls.identifikace.result = 'vyzidat_do';
            } else {
                controls.identifikace.result = 'ok';
            }
            
            closeControl('controlIdentifikace');
            updateUI();
        }

        // Funkce completeDoklady již není potřeba - sloučena do completeIdentifikace

        // Funkce completeUP nahrazena funkcí completeUPD v nové implementaci kontroly souladu s ÚPD

        // ==========================================
        // ÚČASTNÍCI ŘÍZENÍ - FUNKCE
        // ==========================================
        
        // Přepínání záložek účastníků
        function switchUcastniciTab(tabEl, panelId) {
            // Deaktivovat všechny záložky
            const tabs = document.querySelectorAll('.ucastnici-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tabEl.classList.add('active');
            
            // Skrýt všechny panely
            const panels = document.querySelectorAll('.ucastnici-panel');
            panels.forEach(p => p.classList.remove('active'));
            
            // Zobrazit vybraný panel
            const panelMap = {
                'ucastnici': 'panelUcastnici',
                'zastupci': 'panelZastupci',
                'dalsi': 'panelDalsiOsoby'
            };
            document.getElementById(panelMap[panelId]).classList.add('active');
        }
        
        // Ověřit všechny účastníky
        function overitVsechnyUcastniky() {
            const pendingStatuses = document.querySelectorAll('#panelUcastnici .ucastnici-status.pending');
            pendingStatuses.forEach(status => {
                status.classList.remove('pending');
                status.classList.add('verified');
                status.title = 'Ověřeno';
                status.querySelector('.material-icons-outlined').textContent = 'check_circle';
            });
            
            // Zobrazit potvrzení
            showToast('Všichni účastníci byli ověřeni');
        }
        
        // Toggle oblíbených
        function toggleOblibeny(btn) {
            const icon = btn.querySelector('.material-icons-outlined');
            if (btn.classList.contains('favorited')) {
                btn.classList.remove('favorited');
                icon.textContent = 'star_border';
                btn.title = 'Přidat do oblíbených';
            } else {
                btn.classList.add('favorited');
                icon.textContent = 'star';
                btn.title = 'Odebrat z oblíbených';
            }
        }
        
        // Přidání účastníka
        function addUcastnik(skupina, metoda) {
            const metodaText = {
                'manual': 'ručně',
                'lv': 'z listu vlastnictví',
                'oblibene': 'z oblíbených'
            };
            const skupinaText = {
                'stavebnik': 'Stavebník',
                'obec': 'Obec',
                'vlastnik': 'Vlastník pozemku/stavby',
                'soused': 'Vlastník sousedního pozemku',
                'ostatni': 'Ostatní účastníci'
            };
            alert(`Přidání účastníka ${metodaText[metoda]} do skupiny "${skupinaText[skupina]}" - bude implementováno`);
        }
        
        // Přidání zástupce
        function addZastupce(metoda) {
            if (metoda === 'oblibene') {
                alert('Přidání zástupce z oblíbených - bude implementováno');
            } else {
                alert('Přidání nového zástupce - bude implementováno');
            }
        }
        
        // Přidání další osoby
        function addDalsiOsoba(metoda) {
            if (metoda === 'oblibene') {
                alert('Přidání další osoby z oblíbených - bude implementováno');
            } else {
                alert('Přidání nové další osoby - bude implementováno');
            }
        }
        
        // ==========================================
        // OVĚŘENÍ POZEMKŮ Z KATASTRU NEMOVITOSTÍ
        // ==========================================
        
        // Simulovaná data vlastníků pro demo
        const simulatedKNData = {
            'st. 123': { vlastnik: 'Jan Novák', typ: 'FO', adresa: 'Květná 123, 110 00 Praha 1', vecnaPrava: null },
            '456/1': { vlastnik: 'Jan Novák', typ: 'FO', adresa: 'Květná 123, 110 00 Praha 1', vecnaPrava: 'VB: ČEZ' },
            'st. 122': { vlastnik: 'Marie Veselá', typ: 'FO', adresa: 'Růžová 45, 551 01 Jaroměř', vecnaPrava: null },
            'st. 124': { vlastnik: 'Petr Svoboda', typ: 'FO', adresa: 'Lipová 78, 551 01 Jaroměř', vecnaPrava: null },
            '456/2': { vlastnik: 'ČEZ Distribuce, a. s.', typ: 'PO', adresa: 'Teplická 874/8, 405 02 Děčín', vecnaPrava: null },
            '457': { vlastnik: 'Město Jaroměř', typ: 'PO', adresa: 'nám. ČSA 16, 551 01 Jaroměř', vecnaPrava: null }
        };
        
        // Přepínání tabů v sekci účastníků
        function switchOsobyTab(btn, tabId) {
            // Odebrat active ze všech tabů
            document.querySelectorAll('.osoby-tab-btn').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            // Skrýt všechny panely a zobrazit aktivní
            document.querySelectorAll('.osoby-tab-panel').forEach(p => p.classList.remove('active'));
            const panel = document.getElementById('tabPanel' + tabId.charAt(0).toUpperCase() + tabId.slice(1));
            if (panel) panel.classList.add('active');
        }
        
        // Načíst VTI/VDI z Dokladové části
        function nacistVTIVDI() {
            const emptyRow = document.getElementById('emptyOstatniUcastnici');
            if (emptyRow) {
                // Simulace načtení VTI/VDI
                const vtiVdiData = [
                    { nazev: 'ČEZ Distribuce, a.s.', typ: 'VTI', ico: '24729035', ds: 'v95uqfy' },
                    { nazev: 'GasNet, s.r.o.', typ: 'VTI', ico: '27295567', ds: 'rdxzhzt' },
                    { nazev: 'Vodovody a kanalizace Náchod, a.s.', typ: 'VTI', ico: '48172928', ds: 'u9xbgxi' },
                    { nazev: 'Ředitelství silnic a dálnic ČR', typ: 'VDI', ico: '65993390', ds: 'zjq4rhz' }
                ];
                
                let html = '';
                vtiVdiData.forEach(item => {
                    html += `
                        <tr class="osoba-row" data-osoba-id="${item.ico}" data-overeno="false">
                            <td><span class="os-status pending"><span class="material-icons-outlined">help_outline</span></span></td>
                            <td>
                                <strong>${item.nazev}</strong><br>
                                <small class="text-muted">IČO: ${item.ico}</small>
                            </td>
                            <td>
                                <span class="os-ds-info"><span class="material-icons-outlined">forward_to_inbox</span> ${item.ds}</span>
                            </td>
                            <td><span class="os-zdroj ${item.typ.toLowerCase()}">${item.typ}</span></td>
                            <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                            <td class="os-actions">
                                <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                                <button onclick="toggleOblibeny(this)" title="Přidat do oblíbených"><span class="material-icons-outlined">star_border</span></button>
                                <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                <button title="Odstranit"><span class="material-icons-outlined">delete</span></button>
                            </td>
                        </tr>
                    `;
                });
                
                emptyRow.outerHTML = html;
                
                // Aktualizovat počet účastníků
                const countEl = document.getElementById('tabCountUcastnici');
                if (countEl) {
                    const currentCount = parseInt(countEl.textContent) || 0;
                    countEl.textContent = currentCount + vtiVdiData.length;
                }
                
                showToast(`Načteno ${vtiVdiData.length} vlastníků infrastruktury z Dokladové části`);
            }
        }
        
        // Načíst dotčené orgány z Dokladové části
        function nacistDotceneOrgany() {
            const emptyRow = document.getElementById('emptyDotceneOrgany');
            if (emptyRow) {
                // Simulace načtení dotčených orgánů
                const dotceneOrganyData = [
                    { nazev: 'Hasičský záchranný sbor Královéhradeckého kraje', typ: 'Požární ochrana', stav: 'vydáno' },
                    { nazev: 'Krajská hygienická stanice Královéhradeckého kraje', typ: 'Ochrana veřejného zdraví', stav: 'vydáno' },
                    { nazev: 'Městský úřad Jaroměř - odbor životního prostředí', typ: 'Ochrana přírody a krajiny', stav: 'čeká' },
                    { nazev: 'Městský úřad Jaroměř - odbor dopravy', typ: 'Napojení na komunikaci', stav: 'vydáno' }
                ];
                
                let html = '';
                dotceneOrganyData.forEach(item => {
                    const stavClass = item.stav === 'vydáno' ? 'ok' : 'pending';
                    const stavText = item.stav === 'vydáno' ? 'Vydáno' : 'Čeká na vydání';
                    const stavIcon = item.stav === 'vydáno' ? 'check_circle' : 'schedule';
                    
                    html += `
                        <tr class="osoba-row">
                            <td><span class="os-status ${stavClass}"><span class="material-icons-outlined">${stavIcon}</span></span></td>
                            <td>
                                <strong>${item.nazev}</strong><br>
                                <small class="text-muted">Dotčený orgán</small>
                            </td>
                            <td><span class="os-role">${item.typ}</span></td>
                            <td><span class="kategorie-stav ${stavClass === 'ok' ? 'ok' : 'ceka'}">${stavText}</span></td>
                            <td class="os-actions">
                                <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                                <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                                <button title="Odstranit"><span class="material-icons-outlined">delete</span></button>
                            </td>
                        </tr>
                    `;
                });
                
                emptyRow.outerHTML = html;
                
                // Aktualizovat počet
                const countEl = document.getElementById('tabCountDotceneOrgany');
                if (countEl) {
                    countEl.textContent = dotceneOrganyData.length;
                }
                
                showToast(`Načteno ${dotceneOrganyData.length} dotčených orgánů z Dokladové části`);
            }
        }
        
        // Přidat dotčený orgán ručně
        function pridatDotcenyOrgan() {
            showToast('Otevírám formulář pro přidání dotčeného orgánu...');
            // TODO: Implementovat modal pro ruční přidání
        }
        
        // Ověřit všechny pozemky najednou
        function overitVsechnyPozemkyKN() {
            const rows = document.querySelectorAll('.pozemek-item');
            let delay = 0;
            
            rows.forEach(row => {
                const parcela = row.getAttribute('data-parcela');
                if (parcela) {
                    setTimeout(() => {
                        overitPozemekKNItem(row, parcela);
                    }, delay);
                    delay += 100;
                }
            });
            
            // Po dokončení přidat vlastníky do tabulky
            setTimeout(() => {
                pridatVlastnikyDoTabulky();
                showToast('Všechny pozemky byly ověřeny z KN');
            }, delay + 100);
        }
        
        // Ověřit jeden pozemek
        function overitPozemekKN(parcela, ku) {
            const row = document.querySelector(`.pozemek-item[data-parcela="${parcela}"]`);
            if (row) {
                overitPozemekKNItem(row, parcela);
                setTimeout(() => pridatVlastnikyDoTabulky(), 200);
            }
        }
        
        // Interní funkce pro ověření pozemku
        function overitPozemekKNItem(row, parcela) {
            const vlastnikEl = row.querySelector('.pozemek-vlastnik');
            const statusEl = row.querySelector('.pozemek-status');
            const btnEl = row.querySelector('.btn-overit-sm');
            
            const data = simulatedKNData[parcela];
            
            if (data) {
                // Přidat třídu verified na řádek
                row.classList.add('verified');
                
                vlastnikEl.textContent = data.vlastnik;
                vlastnikEl.classList.add('verified');
                
                statusEl.className = 'pozemek-status ok';
                statusEl.innerHTML = '<span class="material-icons-outlined">check_circle</span>';
                
                // Nahradit tlačítko Ověřit tlačítkem LV
                const lvId = 'lv-' + parcela.replace(/[^a-zA-Z0-9]/g, '');
                btnEl.outerHTML = `
                    <div class="btn-lv-wrapper">
                        <button class="btn-lv" onclick="toggleLVDropdown('${lvId}')">
                            <span class="material-icons-outlined">description</span>
                            LV
                            <span class="material-icons-outlined">expand_more</span>
                        </button>
                        <div class="lv-dropdown" id="${lvId}">
                            <button class="lv-dropdown-item" onclick="openLV('${parcela}', 'castecny')">
                                <div class="lv-item-title">Částečný výpis</div>
                                <div class="lv-item-desc">Pouze tento pozemek</div>
                            </button>
                            <button class="lv-dropdown-item" onclick="openLV('${parcela}', 'uplny')">
                                <div class="lv-item-title">Úplný výpis</div>
                                <div class="lv-item-desc">Celý list vlastnictví</div>
                            </button>
                        </div>
                    </div>
                `;
                
                // Přidat info řádek s datem ověření
                const today = new Date();
                const dateStr = today.toLocaleDateString('cs-CZ');
                const infoRow = document.createElement('div');
                infoRow.className = 'pozemek-info-row';
                infoRow.innerHTML = `<span class="pozemek-overeno-datum">Ověřeno: ${dateStr}</span>`;
                row.appendChild(infoRow);
            }
        }
        
        // Toggle LV dropdown
        function toggleLVDropdown(id) {
            // Zavřít ostatní dropdowny
            document.querySelectorAll('.lv-dropdown.show').forEach(d => {
                if (d.id !== id) d.classList.remove('show');
            });
            
            const dropdown = document.getElementById(id);
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }
        
        // Otevřít LV (simulace)
        function openLV(parcela, typ) {
            // Zavřít dropdown
            document.querySelectorAll('.lv-dropdown.show').forEach(d => d.classList.remove('show'));
            
            const typText = typ === 'castecny' ? 'Částečný výpis' : 'Úplný výpis';
            showToast(`Otevírám ${typText} LV pro parcelu ${parcela}...`);
            
            // Simulace otevření v novém okně
            setTimeout(() => {
                // V reálu by se otevřel odkaz na ČÚZK nebo interní systém
                console.log(`Otevření LV: parcela=${parcela}, typ=${typ}`);
            }, 500);
        }
        
        // Zavřít dropdowny při kliknutí mimo
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.btn-lv-wrapper')) {
                document.querySelectorAll('.lv-dropdown.show').forEach(d => d.classList.remove('show'));
            }
        });
        
        // Přidat vlastníky do tabulky účastníků
        function pridatVlastnikyDoTabulky() {
            const tbody = document.getElementById('tbodyUcastnici');
            if (!tbody) return;
            
            // Aktualizovat kategorii vlastníků záměru
            const katZameru = document.getElementById('katVlastniciZameru');
            if (katZameru) {
                const stav = katZameru.querySelector('.kategorie-stav');
                if (stav) {
                    stav.className = 'kategorie-stav ok';
                    stav.textContent = 'z KN';
                }
            }
            
            // Odstranit prázdný řádek vlastníků záměru - přidat jako NEOVĚŘENÉ
            const emptyZameru = document.getElementById('emptyVlastniciZameru');
            if (emptyZameru) {
                emptyZameru.outerHTML = `
                    <tr data-osoba-id="jan-novak-kn" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>Jan Novák</strong><br>
                            <small class="text-muted">Fyzická osoba</small>
                            <span class="os-zastoupen-info" id="zastoupenJanNovak" style="display: none;"></span>
                        </td>
                        <td class="os-adresa-neovereno">
                            <span class="os-pozemky">st. 123, 456/1, 456/2</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                    <tr data-osoba-id="cez-distribuce-vb" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>ČEZ Distribuce, a. s.</strong><br>
                            <small class="text-muted">Právnická osoba</small>
                        </td>
                        <td>
                            <span class="os-role">věcné břemeno</span>
                            <span class="os-pozemky">p. 456/1</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button class="is-favorited" onclick="toggleOblibeny(this)" title="V oblíbených"><span class="material-icons-outlined">star</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                `;
            }
            
            // Aktualizovat kategorii vlastníků sousedů
            const katSousedi = document.getElementById('katVlastniciSousedi');
            if (katSousedi) {
                const stav = katSousedi.querySelector('.kategorie-stav');
                if (stav) {
                    stav.className = 'kategorie-stav ok';
                    stav.textContent = 'z KN';
                }
            }
            
            // Odstranit prázdný řádek sousedů - přidat jako NEOVĚŘENÉ
            const emptySousedi = document.getElementById('emptyVlastniciSousedi');
            if (emptySousedi) {
                emptySousedi.outerHTML = `
                    <tr data-osoba-id="marie-vesela" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>Marie Veselá</strong><br>
                            <small class="text-muted">Fyzická osoba</small>
                            <span class="os-zastoupen-info" id="zastoupenMarieVesela" style="display: none;"></span>
                        </td>
                        <td class="os-adresa-neovereno">
                            <span class="os-pozemky">p. 457/1</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                    <tr data-osoba-id="petr-svoboda" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>Petr Svoboda</strong><br>
                            <small class="text-muted">Fyzická osoba</small>
                            <span class="os-zastoupen-info" id="zastoupenPetrSvoboda" style="display: none;"></span>
                        </td>
                        <td class="os-adresa-neovereno">
                            <span class="os-pozemky">p. 457/2, 458</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                    <tr data-osoba-id="cez-distribuce" data-overeno="false">
                        <td><span class="os-status pending" title="Neověřeno proti ROS/ROB"><span class="material-icons-outlined">help_outline</span></span></td>
                        <td>
                            <strong>ČEZ Distribuce, a. s.</strong><br>
                            <small class="text-muted">Právnická osoba</small>
                        </td>
                        <td class="os-adresa-neovereno">
                            <span class="os-pozemky">p. 459/1</span>
                        </td>
                        <td><span class="os-zdroj zdroj-kn">KN</span></td>
                        <td><span class="doruc-ceka" title="Čeká na ověření">—</span></td>
                        <td class="os-actions">
                            <button class="btn-overit-osobu" onclick="overitOsobu(this)" title="Ověřit z rejstříku"><span class="material-icons-outlined">verified_user</span></button>
                            <button class="is-favorited" onclick="toggleOblibeny(this)" title="V oblíbených"><span class="material-icons-outlined">star</span></button>
                            <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                            <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                        </td>
                    </tr>
                `;
            }
            
            // Aktualizovat počty
            const countEl = document.getElementById('tabCountUcastnici');
            if (countEl) countEl.textContent = '7';
        }
        
        // ==========================================
        // OVĚŘOVÁNÍ OSOB - FUNKCE
        // ==========================================
        
        // Simulovaná data z rejstříků ROB/ROS
        const rejstrikData = {
            'jan-novak': { adresa: 'Květná 123, 110 00 Praha 1', ds: 'abc123x', typ: 'FO' },
            'jan-novak-kn': { adresa: 'Květná 123, 110 00 Praha 1', ds: 'abc123x', typ: 'FO' },
            'mesto-jaromer': { adresa: 'nám. ČSA 16, 551 01 Jaroměř', ds: 'xyz789m', typ: 'PO' },
            'cez-distribuce-vb': { adresa: 'Teplická 874/8, 405 02 Děčín', ds: 'cezdis01', typ: 'PO' },
            'cez-distribuce': { adresa: 'Teplická 874/8, 405 02 Děčín', ds: 'cezdis01', typ: 'PO' },
            'marie-vesela': { adresa: 'Růžová 45, 551 01 Jaroměř', ds: null, typ: 'FO' },
            'petr-svoboda': { adresa: 'Lipová 78, 551 01 Jaroměř', ds: null, typ: 'FO' }
        };
        
        // Ověřit všechny neověřené osoby
        function overitVsechnyOsoby() {
            // Ověřit všechny neověřené osoby včetně VTI/VDI
            const neovereneOsoby = document.querySelectorAll('#tabPanelUcastnici tr[data-overeno="false"]');
            
            if (neovereneOsoby.length === 0) {
                showToast('Všechny osoby jsou již ověřeny');
                return;
            }
            
            showToast(`Ověřuji ${neovereneOsoby.length} osob z ROS/ROB...`);
            
            let delay = 0;
            neovereneOsoby.forEach((row, index) => {
                setTimeout(() => {
                    overitOsobuRow(row);
                }, delay);
                delay += 300;
            });
            
            setTimeout(() => {
                showToast('Všechny osoby byly ověřeny');
            }, delay + 200);
        }
        
        // Ověřit jednu osobu (kliknutím na tlačítko)
        function overitOsobu(btn) {
            const row = btn.closest('tr');
            if (!row) return;
            
            overitOsobuRow(row);
            showToast('Osoba byla ověřena');
        }
        
        // Interní funkce pro ověření řádku
        function overitOsobuRow(row) {
            const osobaId = row.getAttribute('data-osoba-id');
            const data = rejstrikData[osobaId];
            
            // Aktualizovat status na ověřeno
            const statusCell = row.querySelector('.os-status');
            if (statusCell) {
                statusCell.className = 'os-status ok';
                statusCell.title = 'Ověřeno z ROB/ROS';
                statusCell.innerHTML = '<span class="material-icons-outlined">check_circle</span>';
            }
            
            // Aktualizovat adresu
            const adresaCell = row.querySelector('td:nth-child(3)');
            if (adresaCell && data) {
                // Zachovat případnou poznámku (věcné břemeno)
                const role = adresaCell.querySelector('.os-role');
                let content = data.adresa;
                
                if (role) {
                    content = role.outerHTML + ' ' + content;
                }
                
                // Přidat DS info pokud existuje
                if (data.ds) {
                    content += ` <span class="os-ds-info"><span class="material-icons-outlined">forward_to_inbox</span> ${data.ds}</span>`;
                }
                
                adresaCell.innerHTML = content;
                adresaCell.classList.remove('os-adresa-neovereno');
            }
            
            // Aktualizovat doručování
            const dorucCell = row.querySelector('td:nth-child(5)');
            if (dorucCell && data) {
                if (data.ds) {
                    // Má datovou schránku - defaultně doručovat do DS
                    dorucCell.innerHTML = `
                        <button class="btn-dorucovani ds" onclick="toggleDorucovani(this)" title="Doručit do datové schránky" data-stav="ds" data-ds="${data.ds}">
                            <span class="material-icons-outlined">forward_to_inbox</span>
                        </button>
                    `;
                } else {
                    // Nemá DS - doručovat poštou
                    dorucCell.innerHTML = `
                        <button class="btn-dorucovani posta" onclick="toggleDorucovani(this)" title="Doručit poštou" data-stav="posta">
                            <span class="material-icons-outlined">mail</span>
                        </button>
                    `;
                }
            }
            
            // Odstranit tlačítko ověřit
            const overitBtn = row.querySelector('.btn-overit-osobu');
            if (overitBtn) {
                overitBtn.remove();
            }
            
            // Označit jako ověřeno
            row.setAttribute('data-overeno', 'true');
        }
        
        // Přepínání způsobu doručování: DS -> Pošta -> Nedoručovat -> DS/Pošta
        function toggleDorucovani(btn) {
            const stav = btn.getAttribute('data-stav');
            const ds = btn.getAttribute('data-ds');
            
            if (stav === 'ds') {
                // DS -> Pošta
                btn.className = 'btn-dorucovani posta';
                btn.setAttribute('data-stav', 'posta');
                btn.title = 'Doručit poštou';
                btn.innerHTML = '<span class="material-icons-outlined">mail</span>';
            } else if (stav === 'posta') {
                // Pošta -> Nedoručovat
                btn.className = 'btn-dorucovani nedorucovat';
                btn.setAttribute('data-stav', 'nedorucovat');
                btn.title = 'Nedoručovat';
                btn.innerHTML = '<span class="material-icons-outlined">do_not_disturb_on</span>';
            } else {
                // Nedoručovat -> DS (pokud má) nebo Pošta
                if (ds) {
                    btn.className = 'btn-dorucovani ds';
                    btn.setAttribute('data-stav', 'ds');
                    btn.title = 'Doručit do datové schránky';
                    btn.innerHTML = '<span class="material-icons-outlined">forward_to_inbox</span>';
                } else {
                    btn.className = 'btn-dorucovani posta';
                    btn.setAttribute('data-stav', 'posta');
                    btn.title = 'Doručit poštou';
                    btn.innerHTML = '<span class="material-icons-outlined">mail</span>';
                }
            }
        }
        
        // ==========================================
        // ZÁSTUPCI - FUNKCE
        // ==========================================
        
        // Stav ověření zástupce
        let zastupceOveren = { FO: false, PO: false };
        
        // Otevřít modal pro přidání zástupce
        function openPridatZastupceModal() {
            // Reset formuláře
            document.getElementById('zastupceJmeno').value = '';
            document.getElementById('zastupcePrijmeni').value = '';
            document.getElementById('zastupceDatumNarozeni').value = '';
            document.getElementById('zastupceICO').value = '';
            document.getElementById('zastupceNazev').value = '';
            
            // Reset ověření
            zastupceOveren = { FO: false, PO: false };
            document.getElementById('verifyStatusFO').innerHTML = '';
            document.getElementById('verifyStatusPO').innerHTML = '';
            document.getElementById('zastupceDetailFO').style.display = 'none';
            document.getElementById('zastupceDetailPO').style.display = 'none';
            document.getElementById('zastupceAdresaFO').value = '';
            document.getElementById('zastupceAdresaPO').value = '';
            
            document.querySelector('input[name="zastupce_typ"][value="FO"]').checked = true;
            toggleZastupceForm();
            
            // Reset checkboxů
            document.querySelectorAll('input[name="zastupovani"]').forEach(cb => cb.checked = false);
            document.getElementById('zastupceNedorucovat').checked = true;
            
            // Aktualizovat seznam zastupovaných (přidat dynamicky načtené vlastníky)
            aktualizovatZastupovaniList();
            
            // Zobrazit modal
            document.getElementById('modalPridatZastupce').style.display = 'flex';
        }
        
        // Zavřít modal zástupce
        function closeModalZastupce() {
            document.getElementById('modalPridatZastupce').style.display = 'none';
        }
        
        // Přepínání mezi FO a PO formulářem
        function toggleZastupceForm() {
            const typ = document.querySelector('input[name="zastupce_typ"]:checked').value;
            document.getElementById('zastupceFormFO').style.display = typ === 'FO' ? 'block' : 'none';
            document.getElementById('zastupceFormPO').style.display = typ === 'PO' ? 'block' : 'none';
        }
        
        // Ověřit zástupce z rejstříku
        function overitZastupceZRejstriku(typ) {
            const statusEl = document.getElementById('verifyStatus' + typ);
            
            if (typ === 'FO') {
                const jmeno = document.getElementById('zastupceJmeno').value.trim();
                const prijmeni = document.getElementById('zastupcePrijmeni').value.trim();
                const datumNar = document.getElementById('zastupceDatumNarozeni').value;
                
                if (!jmeno || !prijmeni || !datumNar) {
                    statusEl.className = 'verify-status error';
                    statusEl.innerHTML = '<span class="material-icons-outlined">error</span> Vyplňte všechna pole';
                    return;
                }
                
                // Simulace ověření
                statusEl.className = 'verify-status loading';
                statusEl.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span> Ověřuji...';
                
                setTimeout(() => {
                    // Simulace úspěšného ověření
                    statusEl.className = 'verify-status success';
                    statusEl.innerHTML = '<span class="material-icons-outlined">check_circle</span> Osoba nalezena v registru obyvatel';
                    
                    // Zobrazit doplněné údaje
                    document.getElementById('zastupceDetailFO').style.display = 'block';
                    document.getElementById('zastupceAdresaFO').value = 'Hlavní 456, 110 00 Praha 1';
                    
                    zastupceOveren.FO = true;
                }, 800);
                
            } else if (typ === 'PO') {
                const ico = document.getElementById('zastupceICO').value.trim();
                
                if (!ico || ico.length !== 8) {
                    statusEl.className = 'verify-status error';
                    statusEl.innerHTML = '<span class="material-icons-outlined">error</span> Zadejte platné IČO (8 číslic)';
                    return;
                }
                
                // Simulace ověření
                statusEl.className = 'verify-status loading';
                statusEl.innerHTML = '<span class="material-icons-outlined">hourglass_empty</span> Ověřuji v ARES...';
                
                setTimeout(() => {
                    // Simulace dat z ARES
                    const aresData = {
                        '12345678': { nazev: 'Advokátní kancelář Novák & Partners s.r.o.', sidlo: 'Václavské náměstí 1, 110 00 Praha 1' },
                        '87654321': { nazev: 'Právní služby Praha a.s.', sidlo: 'Národní 10, 110 00 Praha 1' },
                    };
                    
                    const data = aresData[ico];
                    
                    if (data) {
                        statusEl.className = 'verify-status success';
                        statusEl.innerHTML = '<span class="material-icons-outlined">check_circle</span> Subjekt nalezen v ARES';
                        
                        // Zobrazit doplněné údaje
                        document.getElementById('zastupceDetailPO').style.display = 'block';
                        document.getElementById('zastupceNazev').value = data.nazev;
                        document.getElementById('zastupceAdresaPO').value = data.sidlo;
                        
                        zastupceOveren.PO = true;
                    } else {
                        statusEl.className = 'verify-status error';
                        statusEl.innerHTML = '<span class="material-icons-outlined">error</span> Subjekt nenalezen v ARES';
                        zastupceOveren.PO = false;
                    }
                }, 1000);
            }
        }
        
        // Aktualizovat seznam zastupovaných osob
        function aktualizovatZastupovaniList() {
            const dynamicList = document.getElementById('zastupovaniDynamicList');
            if (!dynamicList) return;
            
            // Přidat vlastníky z KN pokud byli načteni
            const vlastniciRows = document.querySelectorAll('#tbodyUcastnici tr:not(.osoby-kategorie-row):not(.osoby-empty-row)');
            let html = '';
            
            vlastniciRows.forEach((row, index) => {
                const nameEl = row.querySelector('td:nth-child(2) strong');
                if (nameEl) {
                    const name = nameEl.textContent;
                    // Přeskočit již existující v základním seznamu
                    if (name === 'Jan Novák' || name === 'Město Jaroměř') return;
                    
                    const typeEl = row.querySelector('td:nth-child(2) small');
                    const type = typeEl ? typeEl.textContent : '';
                    
                    // Určit roli podle kontextu (zjednodušeně)
                    let role = 'Účastník řízení';
                    const prevRow = row.previousElementSibling;
                    if (prevRow && prevRow.classList.contains('osoby-kategorie-row')) {
                        const katLabel = prevRow.querySelector('.kategorie-label');
                        if (katLabel) role = katLabel.textContent;
                    }
                    
                    html += `
                        <label class="zastupovani-item">
                            <input type="checkbox" name="zastupovani" value="dynamic-${index}">
                            <div class="zastupovani-info">
                                <span class="zastupovani-name">${name}</span>
                                <span class="zastupovani-role">${role}</span>
                            </div>
                        </label>
                    `;
                }
            });
            
            dynamicList.innerHTML = html;
        }
        
        // Přidat zástupce
        function pridatZastupce() {
            const typ = document.querySelector('input[name="zastupce_typ"]:checked').value;
            let jmeno = '';
            let typOsoby = '';
            let adresa = '';
            
            if (typ === 'FO') {
                // Kontrola ověření
                if (!zastupceOveren.FO) {
                    alert('Nejprve ověřte osobu z rejstříku.');
                    return;
                }
                
                const j = document.getElementById('zastupceJmeno').value.trim();
                const p = document.getElementById('zastupcePrijmeni').value.trim();
                jmeno = `${j} ${p}`;
                typOsoby = 'Fyzická osoba';
                adresa = document.getElementById('zastupceAdresaFO').value;
            } else {
                // Kontrola ověření
                if (!zastupceOveren.PO) {
                    alert('Nejprve ověřte subjekt z rejstříku ARES.');
                    return;
                }
                
                jmeno = document.getElementById('zastupceNazev').value.trim();
                typOsoby = 'Právnická osoba';
                adresa = document.getElementById('zastupceAdresaPO').value;
            }
            
            // Získat vybrané zastupované osoby
            const zastupovani = [];
            document.querySelectorAll('input[name="zastupovani"]:checked').forEach(cb => {
                const item = cb.closest('.zastupovani-item');
                const nameEl = item.querySelector('.zastupovani-name');
                const roleEl = item.querySelector('.zastupovani-role');
                if (nameEl) {
                    zastupovani.push({
                        name: nameEl.textContent,
                        role: roleEl ? roleEl.textContent : ''
                    });
                }
            });
            
            if (zastupovani.length === 0) {
                alert('Vyberte alespoň jednu zastupovanou osobu.');
                return;
            }
            
            const nedorucovat = document.getElementById('zastupceNedorucovat').checked;
            
            // Přidat do tabulky
            pridatZastupceDoTabulky(jmeno, typOsoby, zastupovani, nedorucovat);
            
            // Zavřít modal
            closeModalZastupce();
            
            // Aktualizovat počet
            aktualizovatPocetZastupcu();
            
            showToast(`Zástupce ${jmeno} byl přidán`);
        }
        
        // Přidat zástupce do tabulky
        function pridatZastupceDoTabulky(jmeno, typOsoby, zastupovani, nedorucovat) {
            const tbody = document.getElementById('tbodyZastupci');
            if (!tbody) return;
            
            // Odstranit prázdný řádek
            const emptyRow = document.getElementById('emptyZastupci');
            if (emptyRow) emptyRow.remove();
            
            // Vytvořit badges pro zastupované osoby
            const zastupujeBadges = zastupovani.map(z => `
                <span class="zastupuje-badge">
                    <span class="material-icons-outlined">person</span>
                    ${z.name}
                </span>
            `).join('');
            
            // Určit role (první zastupovaný)
            const role = zastupovani[0]?.role || 'Účastník';
            
            // Checkbox pro doručování
            const dorucChecked = !nedorucovat ? 'checked' : '';
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><span class="os-status ok"><span class="material-icons-outlined">check_circle</span></span></td>
                <td>
                    <strong>${jmeno}</strong><br>
                    <small class="text-muted">${typOsoby}</small>
                </td>
                <td class="zastupuje-cell">${zastupujeBadges}</td>
                <td><span class="os-role">${role}</span></td>
                <td>
                    <div class="dorucovat-toggle">
                        <input type="checkbox" ${dorucChecked} onchange="toggleDorucovat(this)" title="Doručovat zástupci">
                        <span class="dorucovat-label ${!nedorucovat ? 'yes' : 'no'}">${!nedorucovat ? 'Ano' : 'Ne'}</span>
                    </div>
                </td>
                <td class="os-actions">
                    <button onclick="toggleOblibeny(this)" title="Oblíbený"><span class="material-icons-outlined">star_border</span></button>
                    <button title="Detail"><span class="material-icons-outlined">visibility</span></button>
                    <button title="Upravit"><span class="material-icons-outlined">edit</span></button>
                    <button title="Odstranit" onclick="odstranZastupce(this)"><span class="material-icons-outlined">delete</span></button>
                </td>
            `;
            
            tbody.appendChild(newRow);
            
            // Označit zastupované účastníky v tabulce Účastníci
            zastupovani.forEach(z => {
                oznacitUcastnikaJakoZastoupeneho(z.name, jmeno);
            });
        }
        
        // Označit účastníka jako zastoupeného
        function oznacitUcastnikaJakoZastoupeneho(ucastnikJmeno, zastupceJmeno) {
            // Najít účastníka podle jména
            const rows = document.querySelectorAll('#tabPanelUcastnici tr[data-osoba-id]');
            rows.forEach(row => {
                const jmenoEl = row.querySelector('td:nth-child(2) strong');
                if (jmenoEl && jmenoEl.textContent.trim() === ucastnikJmeno) {
                    // Najít nebo vytvořit element pro info o zastoupení
                    let zastoupenInfo = row.querySelector('.os-zastoupen-info');
                    if (!zastoupenInfo) {
                        const tdJmeno = row.querySelector('td:nth-child(2)');
                        zastoupenInfo = document.createElement('span');
                        zastoupenInfo.className = 'os-zastoupen-info';
                        tdJmeno.appendChild(zastoupenInfo);
                    }
                    
                    zastoupenInfo.innerHTML = `<span class="material-icons-outlined">supervisor_account</span> Zastoupen: ${zastupceJmeno}`;
                    zastoupenInfo.style.display = 'block';
                }
            });
        }
        
        // Toggle doručování
        function toggleDorucovat(checkbox) {
            const label = checkbox.nextElementSibling;
            if (checkbox.checked) {
                label.textContent = 'Ano';
                label.className = 'dorucovat-label yes';
            } else {
                label.textContent = 'Ne';
                label.className = 'dorucovat-label no';
            }
        }
        
        // Odstranit zástupce
        function odstranZastupce(btn) {
            if (!confirm('Opravdu chcete odstranit tohoto zástupce?')) return;
            
            const row = btn.closest('tr');
            row.remove();
            
            aktualizovatPocetZastupcu();
            
            // Pokud není žádný zástupce, zobrazit prázdný řádek
            const tbody = document.getElementById('tbodyZastupci');
            if (tbody && tbody.children.length === 0) {
                tbody.innerHTML = `
                    <tr class="osoby-empty-row" id="emptyZastupci">
                        <td colspan="6" class="text-center text-muted">
                            <span class="material-icons-outlined" style="font-size: 16px; vertical-align: middle;">supervisor_account</span>
                            Žádní zástupci — přidejte zástupce tlačítkem výše
                        </td>
                    </tr>
                `;
            }
            
            showToast('Zástupce byl odstraněn');
        }
        
        // Aktualizovat počet zástupců
        function aktualizovatPocetZastupcu() {
            const tbody = document.getElementById('tbodyZastupci');
            const countEl = document.getElementById('tabCountZastupci');
            if (!tbody || !countEl) return;
            
            const rows = tbody.querySelectorAll('tr:not(.osoby-empty-row)');
            countEl.textContent = rows.length;
        }
        
        // Přidat zástupce z oblíbených (simulace)
        function pridatZastupceZOblibenych() {
            // Simulace - v reálu by se otevřel modal s oblíbenými
            const oblibeneni = [
                { jmeno: 'JUDr. Pavel Právník', typ: 'Fyzická osoba', adresa: 'Právnická 123, 110 00 Praha 1', datumNar: '1975-05-15' },
                { jmeno: 'Advokátní kancelář Novák & Partners s.r.o.', typ: 'Právnická osoba', ico: '12345678', sidlo: 'Václavské náměstí 1, 110 00 Praha 1' }
            ];
            
            // Zobrazit jednoduchý výběr
            const vyber = prompt(
                'Vyberte oblíbeného zástupce (zadejte číslo):\n\n' +
                oblibeneni.map((o, i) => `${i + 1}. ${o.jmeno}`).join('\n')
            );
            
            if (vyber) {
                const index = parseInt(vyber) - 1;
                if (index >= 0 && index < oblibeneni.length) {
                    const oblibeny = oblibeneni[index];
                    
                    // Reset stavů
                    zastupceOveren = { FO: false, PO: false };
                    document.getElementById('verifyStatusFO').innerHTML = '';
                    document.getElementById('verifyStatusPO').innerHTML = '';
                    document.getElementById('zastupceDetailFO').style.display = 'none';
                    document.getElementById('zastupceDetailPO').style.display = 'none';
                    
                    if (oblibeny.typ === 'Fyzická osoba') {
                        document.querySelector('input[name="zastupce_typ"][value="FO"]').checked = true;
                        const parts = oblibeny.jmeno.split(' ');
                        document.getElementById('zastupceJmeno').value = parts[0] || '';
                        document.getElementById('zastupcePrijmeni').value = parts.slice(1).join(' ') || '';
                        document.getElementById('zastupceDatumNarozeni').value = oblibeny.datumNar || '';
                        
                        // Automaticky nastavit jako ověřeného (z oblíbených)
                        document.getElementById('zastupceDetailFO').style.display = 'block';
                        document.getElementById('zastupceAdresaFO').value = oblibeny.adresa;
                        document.getElementById('verifyStatusFO').className = 'verify-status success';
                        document.getElementById('verifyStatusFO').innerHTML = '<span class="material-icons-outlined">check_circle</span> Z oblíbených';
                        zastupceOveren.FO = true;
                    } else {
                        document.querySelector('input[name="zastupce_typ"][value="PO"]').checked = true;
                        document.getElementById('zastupceICO').value = oblibeny.ico || '';
                        document.getElementById('zastupceNazev').value = oblibeny.jmeno;
                        
                        // Automaticky nastavit jako ověřeného (z oblíbených)
                        document.getElementById('zastupceDetailPO').style.display = 'block';
                        document.getElementById('zastupceAdresaPO').value = oblibeny.sidlo;
                        document.getElementById('verifyStatusPO').className = 'verify-status success';
                        document.getElementById('verifyStatusPO').innerHTML = '<span class="material-icons-outlined">check_circle</span> Z oblíbených';
                        zastupceOveren.PO = true;
                    }
                    
                    toggleZastupceForm();
                    aktualizovatZastupovaniList();
                    document.querySelectorAll('input[name="zastupovani"]').forEach(cb => cb.checked = false);
                    document.getElementById('zastupceNedorucovat').checked = true;
                    document.getElementById('modalPridatZastupce').style.display = 'flex';
                }
            }
        }
        
        // Toast notifikace
        function showToast(message, type = 'success') {
            const existing = document.querySelector('.toast-notification');
            if (existing) existing.remove();
            
            const icons = {
                success: 'check_circle',
                warning: 'warning',
                error: 'error',
                info: 'info'
            };
            const colors = {
                success: '#137333',
                warning: '#b06000',
                error: '#c5221f',
                info: '#1a73e8'
            };
            
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.innerHTML = `
                <span class="material-icons-outlined" style="color: ${colors[type] || colors.success}">${icons[type] || icons.success}</span>
                ${message}
            `;
            toast.style.cssText = `
                position: fixed;
                bottom: 24px;
                left: 50%;
                transform: translateX(-50%);
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 12px 24px;
                background: #323232;
                color: #fff;
                border-radius: 8px;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: toastIn 0.3s ease;
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'toastOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function completeUcastnici() {
            controls.ucastnici.done = true;
            controls.ucastnici.result = 'ok';
            closeControl('controlUcastnici');
            updateUI();
        }

        function completeZrychlene() {
            const checkboxes = document.querySelectorAll('#controlZrychlene input[type="checkbox"]');
            let allChecked = true;
            checkboxes.forEach(cb => { if (!cb.checked) allChecked = false; });
            
            controls.zrychlene.done = true;
            controls.zrychlene.result = allChecked ? 'ok' : 'warning';
            
            closeControl('controlZrychlene');
            updateUI();
        }

        function zahajitRizeni() {
            if (controls.prislusnost.result === 'neprislusny') {
                const postoupit = controls.prislusnost.postoupit;
                let msg = 'Řízení bude postoupeno příslušnému stavebnímu úřadu.\n\n';
                
                if (postoupit) {
                    const info = postoupit.info.split('|');
                    if (postoupit.typ === 'vecna') {
                        msg += `Typ nepříslušnosti: Věcná\n`;
                        msg += `Příslušný úřad: ${postoupit.typSu}\n`;
                        msg += `Název: ${info[0]}\n`;
                        msg += `Adresa: ${info[1]}\n`;
                        msg += `E-mail: ${info[2]}\n`;
                    } else {
                        msg += `Typ nepříslušnosti: Místní\n`;
                        msg += `Příslušný úřad: ${info[0]}\n`;
                        msg += `Adresa: ${info[1]}\n`;
                        msg += `E-mail: ${info[2]}\n`;
                        msg += `Územní obvod: ${info[3]}\n`;
                    }
                }
                
                msg += '\nV ostré verzi by následovalo flow pro postoupení řízení.';
                alert(msg);
            } else {
                // Jsou zjištěny vady?
                const hasVadyLocal = Object.values(controls).some(c => c.done && (c.result === 'vady' || c.result === 'warning'));
                if (hasVadyLocal) {
                    // Otevřít block editor pro výzvu k doplnění
                    edBuildDeficiencies();
                    openControl('controlVyzva');
                } else {
                    // Přechod na krok 3: Projednání (kontroly OK)
                    window.location.href = 'povoleni-3.html';
                }
            }
        }

        // Initialize
        updateUI();

        // Force styles after page load (for Nicepage compatibility)
        function forceWorkflowStyles() {
            const workflowBar = document.querySelector('.workflow-bar');
            if (workflowBar) {
                workflowBar.style.cssText = 'display: flex !important; align-items: center !important; justify-content: space-between !important; padding: 10px 32px !important; background: #f8f9fa !important; border-bottom: 1px solid #e0e0e0 !important; flex-wrap: nowrap !important;';
            }
            
            const stepper = document.querySelector('.workflow-stepper');
            if (stepper) {
                stepper.style.cssText = 'display: flex !important; align-items: center !important; gap: 6px !important; flex-wrap: nowrap !important;';
            }
            
            document.querySelectorAll('.workflow-step').forEach(step => {
                const isCompleted = step.classList.contains('completed');
                const isActive = step.classList.contains('active');
                
                let bg = '#fff', border = '#dadce0', color = '#5f6368';
                if (isCompleted) { bg = '#e6f4ea'; border = '#ceead6'; color = '#137333'; }
                if (isActive) { bg = '#004289'; border = '#004289'; color = '#fff'; }
                
                step.style.cssText = `display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 6px 12px !important; border-radius: 16px !important; font-size: 12px !important; font-weight: 400 !important; background: ${bg} !important; border: 1px solid ${border} !important; color: ${color} !important; white-space: nowrap !important;`;
            });
            
            document.querySelectorAll('.step-number').forEach(num => {
                const step = num.closest('.workflow-step');
                const isCompleted = step && step.classList.contains('completed');
                const isActive = step && step.classList.contains('active');
                
                let bg = '#f1f3f4', color = '#5f6368';
                if (isCompleted) { bg = '#137333'; color = '#fff'; }
                if (isActive) { bg = 'rgba(255,255,255,0.25)'; color = '#fff'; }
                
                num.style.cssText = `width: 18px !important; height: 18px !important; min-width: 18px !important; border-radius: 50% !important; background: ${bg} !important; color: ${color} !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; font-size: 10px !important; font-weight: 500 !important;`;
            });
            
            document.querySelectorAll('.workflow-step-connector').forEach(conn => {
                const isCompleted = conn.classList.contains('completed');
                const bg = isCompleted ? '#137333' : '#dadce0';
                conn.style.cssText = `width: 20px !important; height: 2px !important; min-width: 20px !important; background: ${bg} !important; flex-shrink: 0 !important;`;
            });
            
            const docButtons = document.querySelector('.workflow-bar .document-access-buttons');
            if (docButtons) {
                docButtons.style.cssText = 'display: flex !important; gap: 8px !important; flex-wrap: nowrap !important; margin-left: 24px !important;';
            }
            
            document.querySelectorAll('.workflow-bar .doc-access-btn').forEach(btn => {
                btn.style.cssText = 'display: inline-flex !important; align-items: center !important; gap: 6px !important; padding: 8px 14px !important; background: #fff !important; border: 1px solid #dadce0 !important; border-radius: 6px !important; font-size: 13px !important; font-weight: 400 !important; color: #202124 !important; text-decoration: none !important; white-space: nowrap !important;';
                
                // Style icons inside buttons
                const icon = btn.querySelector('.material-icons-outlined');
                if (icon) {
                    icon.style.cssText = 'font-size: 18px !important; color: #5f6368 !important;';
                }
            });
        }
        
        // Apply on load
        window.addEventListener('load', forceWorkflowStyles);
        document.addEventListener('DOMContentLoaded', forceWorkflowStyles);
        
    </script>
    
    <!-- Slideout overlay -->
    <div class="slideout-overlay" id="slideoutOverlay" onclick="closeAllSlideouts()"></div>
    
    <!-- Slideout: Přehled nedostatků -->
    <div class="slideout-panel" id="prehledNedostatku">
        <div class="slideout-header">
            <div class="slideout-title">
                <span class="material-icons-outlined">warning_amber</span>
                Přehled nedostatků řízení
            </div>
            <button class="slideout-close" onclick="closeSlideout('prehledNedostatku')">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>
        <div class="slideout-body" id="nedostatkyBody">
            <!-- Typ C: Výzva k doplnění -->
            <div class="issues-group" id="groupVyzva">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #f9ab00;">edit_document</span>
                        Výzva k doplnění + Přerušení řízení
                    </div>
                    <span class="issues-group-badge warning" id="badgeVyzva">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Nedostatky, které povedou k vydání výzvy k doplnění a usnesení o přerušení řízení dle § 185 odst. 1-2.
                </p>
                <div class="issues-group-list" id="listVyzva">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        Žádné nedostatky
                    </div>
                </div>
            </div>
            
            <!-- Typ B: Odložení žádosti -->
            <div class="issues-group" id="groupOdlozeni">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #c5221f;">block</span>
                        Odložení žádosti
                    </div>
                    <span class="issues-group-badge error" id="badgeOdlozeni">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Závažné vady dle § 185 odst. 3 - chybí dokumentace, není zpracována projektantem, nebo není vložena do EED.
                </p>
                <div class="issues-group-list" id="listOdlozeni">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        Žádné závažné vady
                    </div>
                </div>
            </div>
            
            <!-- Typ A: Postoupení -->
            <div class="issues-group" id="groupPostoupeni">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #1a73e8;">send</span>
                        Postoupení řízení
                    </div>
                    <span class="issues-group-badge info" id="badgePostoupeni">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Stavební úřad není příslušný - řízení bude postoupeno příslušnému SÚ.
                </p>
                <div class="issues-group-list" id="listPostoupeni">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        SÚ je příslušný
                    </div>
                </div>
            </div>
            
            <!-- Typ D: Stavění lhůty -->
            <div class="issues-group" id="groupStaveni">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #5f6368;">schedule</span>
                        Stavění lhůty (vyžádání stanovisek)
                    </div>
                    <span class="issues-group-badge info" id="badgeStaveni">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Chybějící stanoviska DO, která si SÚ vyžádá dle § 184 odst. 3. Lhůta pro rozhodnutí se staví.
                </p>
                <div class="issues-group-list" id="listStaveni">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        Všechna stanoviska jsou k dispozici
                    </div>
                </div>
            </div>
            
            <!-- Typ E: Zamítnutí -->
            <div class="issues-group" id="groupZamitnuti">
                <div class="issues-group-header">
                    <div class="issues-group-title">
                        <span class="material-icons-outlined" style="color: #c5221f;">gavel</span>
                        Zamítnutí žádosti
                    </div>
                    <span class="issues-group-badge error" id="badgeZamitnuti">0</span>
                </div>
                <p style="font-size: 12px; color: #5f6368; margin-bottom: 12px;">
                    Důvody pro zamítnutí žádosti - např. nesoulad s územně plánovací dokumentací.
                </p>
                <div class="issues-group-list" id="listZamitnuti">
                    <div style="text-align: center; padding: 20px; color: #9aa0a6; font-size: 13px;">
                        <span class="material-icons-outlined" style="font-size: 32px; margin-bottom: 8px; display: block;">check_circle</span>
                        Žádné důvody pro zamítnutí
                    </div>
                </div>
            </div>
        </div>
        <div class="slideout-footer">
            <button class="btn btn-secondary" onclick="exportNedostatky()">
                <span class="material-icons-outlined">download</span>
                Exportovat
            </button>
            <button class="btn btn-primary" onclick="closeSlideout('prehledNedostatku')">
                Zavřít
            </button>
        </div>
    </div>
    
    <!-- Slideout: Údaje řízení -->
    <div class="slideout-panel" id="udajeRizeni">
        <div class="slideout-header">
            <div class="slideout-title">
                <span class="material-icons-outlined">assignment</span>
                Údaje řízení
            </div>
            <button class="slideout-close" onclick="closeSlideout('udajeRizeni')">
                <span class="material-icons-outlined">close</span>
            </button>
        </div>
        <div class="slideout-body">
            <!-- Základní údaje -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">info</span>
                    Základní údaje
                </div>
                <div class="data-row">
                    <div class="data-label">Číslo řízení</div>
                    <div class="data-value">R/2026/000147</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Název stavby</div>
                    <div class="data-value editable">
                        <span id="udajeNazevStavby">Novostavba RD včetně přípojek</span>
                        <button class="data-edit-btn" onclick="editUdaj('nazevStavby')" title="Upravit">
                            <span class="material-icons-outlined">edit</span>
                        </button>
                    </div>
                </div>
                <div class="data-row">
                    <div class="data-label">Typ řízení</div>
                    <div class="data-value">Povolení stavby</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Druh stavby</div>
                    <div class="data-value">Jednoduchá stavba</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Datum doručení</div>
                    <div class="data-value">7. 1. 2026</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Stav řízení</div>
                    <div class="data-value"><span class="case-badge draft" style="display: inline-block;">Kontrola</span></div>
                </div>
            </div>
            
            <!-- Lhůty -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">schedule</span>
                    Lhůty
                </div>
                <div class="data-row">
                    <div class="data-label">Lhůta pro rozhodnutí</div>
                    <div class="data-value">30 dnů (do 6. 2. 2026)</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Stavění lhůty</div>
                    <div class="data-value" style="color: #137333;">Ne</div>
                </div>
            </div>
            
            <!-- Pozemky -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">landscape</span>
                    Pozemky záměru
                </div>
                <div class="data-list" id="udajePozemky">
                    <div class="data-list-item">
                        <span class="material-icons-outlined">place</span>
                        st. 123/1, k.ú. Veselí nad Lužnicí
                    </div>
                    <div class="data-list-item">
                        <span class="material-icons-outlined">place</span>
                        456/2, k.ú. Veselí nad Lužnicí
                    </div>
                </div>
                <button class="btn btn-secondary" style="margin-top: 12px; width: 100%;" onclick="openControl('controlPozemky')">
                    <span class="material-icons-outlined">edit</span>
                    Upravit pozemky
                </button>
            </div>
            
            <!-- Účastníci -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">groups</span>
                    Osoby
                </div>
                <div class="data-list" id="udajeUcastnici">
                    <div class="data-list-item">
                        <span class="material-icons-outlined">person</span>
                        Marek Vondruška (stavebník)
                    </div>
                    <div class="data-list-item">
                        <span class="material-icons-outlined">person</span>
                        Jana Nová (vlastník sousedního pozemku)
                    </div>
                </div>
                <button class="btn btn-secondary" style="margin-top: 12px; width: 100%;" onclick="openControl('controlUcastnici')">
                    <span class="material-icons-outlined">edit</span>
                    Upravit osoby
                </button>
            </div>
            
            <!-- Referent -->
            <div class="data-section">
                <div class="data-section-title">
                    <span class="material-icons-outlined">badge</span>
                    Zpracování
                </div>
                <div class="data-row">
                    <div class="data-label">Referent</div>
                    <div class="data-value">Aleš Krupa</div>
                </div>
                <div class="data-row">
                    <div class="data-label">Přiřazeno od</div>
                    <div class="data-value">7. 1. 2026</div>
                </div>
            </div>
        </div>
        <div class="slideout-footer">
            <button class="btn btn-primary" onclick="closeSlideout('udajeRizeni')">
                Zavřít
            </button>
        </div>
    </div>
    
    <!-- ═══ Rich Text Editor Modal ═══ -->
    <div id="rteModal" style="display:none;position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.45);align-items:center;justify-content:center">
        <div style="background:white;width:620px;max-width:90vw;max-height:80vh;border-radius:12px;box-shadow:0 24px 48px rgba(0,0,0,.2);display:flex;flex-direction:column;overflow:hidden">
            <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid #e0e0e0">
                <div style="display:flex;align-items:center;gap:8px">
                    <span class="material-icons-outlined" style="color:#e37400;font-size:20px">edit_note</span>
                    <span style="font-size:14px;font-weight:600;color:#202124">Vlastní bod — nedostatek</span>
                </div>
                <button onclick="rteClose()" style="border:none;background:none;cursor:pointer;padding:4px;border-radius:6px;color:#5f6368" title="Zavřít">
                    <span class="material-icons-outlined" style="font-size:20px">close</span>
                </button>
            </div>
            <div style="display:flex;align-items:center;gap:2px;padding:8px 16px;border-bottom:1px solid #f1f3f4;background:#fafafa;flex-wrap:wrap">
                <button onclick="rteExec('bold')" title="Tučně (Ctrl+B)" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">format_bold</span></button>
                <button onclick="rteExec('italic')" title="Kurzíva (Ctrl+I)" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">format_italic</span></button>
                <button onclick="rteExec('underline')" title="Podtržení (Ctrl+U)" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">format_underlined</span></button>
                <div style="width:1px;height:20px;background:#e0e0e0;margin:0 4px"></div>
                <button onclick="rteExec('insertUnorderedList')" title="Odrážkový seznam" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">format_list_bulleted</span></button>
                <button onclick="rteExec('insertOrderedList')" title="Číslovaný seznam" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">format_list_numbered</span></button>
                <div style="width:1px;height:20px;background:#e0e0e0;margin:0 4px"></div>
                <button onclick="rteExec('outdent')" title="Odsadit vlevo" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">format_indent_decrease</span></button>
                <button onclick="rteExec('indent')" title="Odsadit vpravo" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">format_indent_increase</span></button>
                <div style="width:1px;height:20px;background:#e0e0e0;margin:0 4px"></div>
                <button onclick="rteExec('undo')" title="Zpět" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">undo</span></button>
                <button onclick="rteExec('redo')" title="Znovu" class="rte-tb"><span class="material-icons-outlined" style="font-size:18px">redo</span></button>
                <div style="flex:1"></div>
                <span style="font-size:10px;color:#9aa0a6">Ctrl+B / I / U</span>
            </div>
            <div id="rteContent" contenteditable="true" style="flex:1;min-height:220px;max-height:50vh;overflow-y:auto;padding:16px 20px;font-family:'Roboto',sans-serif;font-size:13px;line-height:1.6;color:#202124;outline:none"></div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 20px;border-top:1px solid #e0e0e0;background:#fafafa">
                <span style="font-size:10px;color:#9aa0a6">Text bude zařazen jako bod výzvy k doplnění</span>
                <div style="display:flex;gap:10px">
                    <button onclick="rteClose()" class="btn btn-secondary">Zrušit</button>
                    <button onclick="rteSave()" class="btn btn-primary" style="background:#e37400;border-color:#e37400">
                        <span class="material-icons-outlined">check</span>
                        Vložit do dokumentu
                    </button>
                </div>
            </div>
        </div>
    </div>
    <style>
        #rteModal.open { display: flex !important; }
        .rte-tb { width: 32px; height: 32px; border: none; background: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #5f6368; transition: background .1s; }
        .rte-tb:hover { background: #e8eaed; color: #202124; }
        .rte-tb:active { background: #d2e3fc; color: #004289; }
        #rteContent:empty:before { content: 'Popište nedostatek žádosti nebo projektové dokumentace…'; color: #9aa0a6; pointer-events: none; }
        #rteContent ul, #rteContent ol { margin: 4px 0 4px 20px; padding: 0; }
        #rteContent li { margin-bottom: 2px; }
    </style>


    <script>/* jsPDF 2.5.2 inlined */
/** @license
 *
 * jsPDF - PDF Document creation from JavaScript
 * Version 4.1.0 Built on 2026-02-02T10:38:25.208Z
 *                      CommitID 00000000
 *
 * Copyright (c) 2010-2025 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
 *               2015-2025 yWorks GmbH, http://www.yworks.com
 *               2015-2025 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
 *               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
 *               2010 Aaron Spike, https://github.com/acspike
 *               2012 Willow Systems Corporation, https://github.com/willowsystems
 *               2012 Pablo Hess, https://github.com/pablohess
 *               2012 Florian Jenett, https://github.com/fjenett
 *               2013 Warren Weckesser, https://github.com/warrenweckesser
 *               2013 Youssef Beddad, https://github.com/lifof
 *               2013 Lee Driscoll, https://github.com/lsdriscoll
 *               2013 Stefan Slonevskiy, https://github.com/stefslon
 *               2013 Jeremy Morel, https://github.com/jmorel
 *               2013 Christoph Hartmann, https://github.com/chris-rock
 *               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
 *               2014 James Makes, https://github.com/dollaruw
 *               2014 Diego Casorran, https://github.com/diegocr
 *               2014 Steven Spungin, https://github.com/Flamenco
 *               2014 Kenneth Glassey, https://github.com/Gavvers
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Contributor(s):
 *    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
 *    kim3er, mfo, alnorth, Flamenco
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).jspdf={})}(this,function(t){function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function n(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,s,o=[],h=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;h=!1}else for(;!(h=(r=a.call(n)).done)&&(o.push(r.value),o.length!==e);h=!0);}catch(t){l=!0,i=t}finally{try{if(!h&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw i}}return o}}(t,n)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}var i=function(){return"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this}();function a(){i.console&&"function"==typeof i.console.log&&i.console.log.apply(i.console,arguments)}var s={log:a,warn:function(t){i.console&&("function"==typeof i.console.warn?i.console.warn.apply(i.console,arguments):a.call(null,arguments))},error:function(t){i.console&&("function"==typeof i.console.error?i.console.error.apply(i.console,arguments):a(t))}};function o(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){c(r.response,e,n)},r.onerror=function(){s.error("could not download file")},r.send()}function h(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(n){}return e.status>=200&&e.status<=299}function l(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var c=i.saveAs||("object"!==("undefined"==typeof window?"undefined":r(window))||window!==i?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(t,e,n){var r=i.URL||i.webkitURL,a=document.createElement("a");e=e||t.name||"download",a.download=e,a.rel="noopener","string"==typeof t?(a.href=t,a.origin!==location.origin?h(a.href)?o(t,e,n):l(a,a.target="_blank"):l(a)):(a.href=r.createObjectURL(t),setTimeout(function(){r.revokeObjectURL(a.href)},4e4),setTimeout(function(){l(a)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,n){if(e=e||t.name||"download","string"==typeof t)if(h(t))o(t,e,n);else{var i=document.createElement("a");i.href=t,i.target="_blank",setTimeout(function(){l(i)})}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!==r(e)&&(s.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,n),e)}:function(t,e,n,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof t)return o(t,e,n);var s="application/octet-stream"===t.type,h=/constructor/i.test(i.HTMLElement)||i.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||s&&h)&&"object"===("undefined"==typeof FileReader?"undefined":r(FileReader))){var c=new FileReader;c.onloadend=function(){var t=c.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=t:location=t,a=null},c.readAsDataURL(t)}else{var u=i.URL||i.webkitURL,f=u.createObjectURL(t);a?a.location=f:location.href=f,a=null,setTimeout(function(){u.revokeObjectURL(f)},4e4)}});
/**
   * A class to parse color values
   * @author Stoyan Stefanov <sstoo@gmail.com>
   * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
   * @license Use it if you like it
   */function u(t){var e;t=t||"",this.ok=!1,"#"==t.charAt(0)&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],r=0;r<n.length;r++){var i=n[r].re,a=n[r].process,s=i.exec(t);s&&(e=a(s),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),n=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==n.length&&(n="0"+n),"#"+t+e+n}}var f=i.atob.bind(i),d=i.btoa.bind(i);
/**
   * @license
   * Joseph Myers does not specify a particular license for his work.
   *
   * Author: Joseph Myers
   * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
   *
   * Modified by: Owen Leong
   */
function p(t,e){var n=t[0],r=t[1],i=t[2],a=t[3];n=m(n,r,i,a,e[0],7,-680876936),a=m(a,n,r,i,e[1],12,-389564586),i=m(i,a,n,r,e[2],17,606105819),r=m(r,i,a,n,e[3],22,-1044525330),n=m(n,r,i,a,e[4],7,-176418897),a=m(a,n,r,i,e[5],12,1200080426),i=m(i,a,n,r,e[6],17,-1473231341),r=m(r,i,a,n,e[7],22,-45705983),n=m(n,r,i,a,e[8],7,1770035416),a=m(a,n,r,i,e[9],12,-1958414417),i=m(i,a,n,r,e[10],17,-42063),r=m(r,i,a,n,e[11],22,-1990404162),n=m(n,r,i,a,e[12],7,1804603682),a=m(a,n,r,i,e[13],12,-40341101),i=m(i,a,n,r,e[14],17,-1502002290),n=b(n,r=m(r,i,a,n,e[15],22,1236535329),i,a,e[1],5,-165796510),a=b(a,n,r,i,e[6],9,-1069501632),i=b(i,a,n,r,e[11],14,643717713),r=b(r,i,a,n,e[0],20,-373897302),n=b(n,r,i,a,e[5],5,-701558691),a=b(a,n,r,i,e[10],9,38016083),i=b(i,a,n,r,e[15],14,-660478335),r=b(r,i,a,n,e[4],20,-405537848),n=b(n,r,i,a,e[9],5,568446438),a=b(a,n,r,i,e[14],9,-1019803690),i=b(i,a,n,r,e[3],14,-187363961),r=b(r,i,a,n,e[8],20,1163531501),n=b(n,r,i,a,e[13],5,-1444681467),a=b(a,n,r,i,e[2],9,-51403784),i=b(i,a,n,r,e[7],14,1735328473),n=v(n,r=b(r,i,a,n,e[12],20,-1926607734),i,a,e[5],4,-378558),a=v(a,n,r,i,e[8],11,-2022574463),i=v(i,a,n,r,e[11],16,1839030562),r=v(r,i,a,n,e[14],23,-35309556),n=v(n,r,i,a,e[1],4,-1530992060),a=v(a,n,r,i,e[4],11,1272893353),i=v(i,a,n,r,e[7],16,-155497632),r=v(r,i,a,n,e[10],23,-1094730640),n=v(n,r,i,a,e[13],4,681279174),a=v(a,n,r,i,e[0],11,-358537222),i=v(i,a,n,r,e[3],16,-722521979),r=v(r,i,a,n,e[6],23,76029189),n=v(n,r,i,a,e[9],4,-640364487),a=v(a,n,r,i,e[12],11,-421815835),i=v(i,a,n,r,e[15],16,530742520),n=w(n,r=v(r,i,a,n,e[2],23,-995338651),i,a,e[0],6,-198630844),a=w(a,n,r,i,e[7],10,1126891415),i=w(i,a,n,r,e[14],15,-1416354905),r=w(r,i,a,n,e[5],21,-57434055),n=w(n,r,i,a,e[12],6,1700485571),a=w(a,n,r,i,e[3],10,-1894986606),i=w(i,a,n,r,e[10],15,-1051523),r=w(r,i,a,n,e[1],21,-2054922799),n=w(n,r,i,a,e[8],6,1873313359),a=w(a,n,r,i,e[15],10,-30611744),i=w(i,a,n,r,e[6],15,-1560198380),r=w(r,i,a,n,e[13],21,1309151649),n=w(n,r,i,a,e[4],6,-145523070),a=w(a,n,r,i,e[11],10,-1120210379),i=w(i,a,n,r,e[2],15,718787259),r=w(r,i,a,n,e[9],21,-343485551),t[0]=k(n,t[0]),t[1]=k(r,t[1]),t[2]=k(i,t[2]),t[3]=k(a,t[3])}function g(t,e,n,r,i,a){return e=k(k(e,t),k(r,a)),k(e<<i|e>>>32-i,n)}function m(t,e,n,r,i,a,s){return g(e&n|~e&r,t,e,i,a,s)}function b(t,e,n,r,i,a,s){return g(e&r|n&~r,t,e,i,a,s)}function v(t,e,n,r,i,a,s){return g(e^n^r,t,e,i,a,s)}function w(t,e,n,r,i,a,s){return g(n^(e|~r),t,e,i,a,s)}function y(t){var e,n=t.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)p(r,_(t.substring(e-64,e)));t=t.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)i[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(p(r,i),e=0;e<16;e++)i[e]=0;return i[14]=8*n,p(r,i),r}function _(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}var x="0123456789abcdef".split("");function A(t){for(var e="",n=0;n<4;n++)e+=x[t>>8*n+4&15]+x[t>>8*n&15];return e}function L(t){return String.fromCharCode(255&t,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function N(t){return function(t){return t.map(L).join("")}(y(t))}var S="5d41402abc4b2a76b9719d911017c592"!=function(t){for(var e=0;e<t.length;e++)t[e]=A(t[e]);return t.join("")}(y("hello"));function k(t,e){if(S){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}return t+e&4294967295}
/**
   * @license
   * FPDF is released under a permissive license: there is no usage restriction.
   * You may embed it freely in your application (commercial or not), with or
   * without modifications.
   *
   * Reference: http://www.fpdf.org/en/script/script37.php
   */function P(t,e){var n,r,i,a;if(t!==n){for(var s=(i=t,a=1+(256/t.length|0),new Array(a+1).join(i)),o=[],h=0;h<256;h++)o[h]=h;var l=0;for(h=0;h<256;h++){var c=o[h];l=(l+c+s.charCodeAt(h))%256,o[h]=o[l],o[l]=c}n=t,r=o}else o=r;var u=e.length,f=0,d=0,p="";for(h=0;h<u;h++)d=(d+(c=o[f=(f+1)%256]))%256,o[f]=o[d],o[d]=c,s=o[(o[f]+o[d])%256],p+=String.fromCharCode(e.charCodeAt(h)^s);return p}
/**
   * @license
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   * Author: Owen Leong (@owenl131)
   * Date: 15 Oct 2020
   * References:
   * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
   * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
   * http://www.fpdf.org/en/script/script37.php
   */var F={print:4,modify:8,copy:16,"annot-forms":32};function I(t,e,n,r){this.v=1,this.r=2;var i=192;t.forEach(function(t){if(void 0!==F.perm)throw new Error("Invalid permission: "+t);i+=F[t]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var a=(e+this.padding).substr(0,32),s=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,s),this.P=-(1+(255^i)),this.encryptionKey=N(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=P(this.encryptionKey,this.padding)}function C(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var e="",n=t.length,r=0;r<n;r++){var i=t.charCodeAt(r);e+=i<33||35===i||37===i||40===i||41===i||47===i||60===i||62===i||91===i||93===i||123===i||125===i||i>126?"#"+("0"+i.toString(16)).slice(-2):t[r]}return e}function j(t){if("object"!==r(t))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,n,r){if(r=r||!1,"string"!=typeof t||"function"!=typeof n||"boolean"!=typeof r)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var i=Math.random().toString(35);return e[t][i]=[n,!!r],i},this.unsubscribe=function(t){for(var n in e)if(e[n][t])return delete e[n][t],0===Object.keys(e[n]).length&&delete e[n],!0;return!1},this.publish=function(n){if(e.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),a=[];for(var o in e[n]){var h=e[n][o];try{h[0].apply(t,r)}catch(l){i.console&&s.error("jsPDF PubSub Error",l.message,l)}h[1]&&a.push(o)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function E(t){if(!(this instanceof E))return new E(t);var e="opacity,stroke-opacity".split(",");for(var n in t)t.hasOwnProperty(n)&&e.indexOf(n)>=0&&(this[n]=t[n]);this.id="",this.objectNumber=-1}function O(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function B(t,e,n,r,i){if(!(this instanceof B))return new B(t,e,n,r,i);this.type="axial"===t?2:3,this.coords=e,this.colors=n,O.call(this,r,i)}function M(t,e,n,r,i){if(!(this instanceof M))return new M(t,e,n,r,i);this.boundingBox=t,this.xStep=e,this.yStep=n,this.stream="",this.cloneIndex=0,O.call(this,r,i)}function R(t){var e,n="string"==typeof arguments[0]?arguments[0]:"p",a=arguments[1],o=arguments[2],h=arguments[3],l=[],f=1,p=16,g="S",m=null;"object"===r(t=t||{})&&(n=t.orientation,a=t.unit||a,o=t.format||o,h=t.compress||t.compressPdf||h,null!==(m=t.encryption||null)&&(m.userPassword=m.userPassword||"",m.ownerPassword=m.ownerPassword||"",m.userPermissions=m.userPermissions||[]),f="number"==typeof t.userUnit?Math.abs(t.userUnit):1,void 0!==t.precision&&(e=t.precision),void 0!==t.floatPrecision&&(p=t.floatPrecision),g=t.defaultPathOperation||"S"),l=t.filters||(!0===h?["FlateEncode"]:l),a=a||"mm",n=(""+(n||"P")).toLowerCase();var b=t.putOnlyUsedFonts||!1,v={},w={internal:{},__private__:{}};w.__private__.PubSub=j;var y="1.3",_=w.__private__.getPdfVersion=function(){return y};w.__private__.setPdfVersion=function(t){y=t};var x={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};w.__private__.getPageFormats=function(){return x};var A=w.__private__.getPageFormat=function(t){return x[t]};o=o||"a4";var L="compat",N="advanced",S=L;function k(){this.saveGraphicsState(),ct(new Wt(Nt,0,0,-Nt,0,Sn()*Nt).toString()+" cm"),this.setFontSize(this.getFontSize()/Nt),g="n",S=N}function P(){this.restoreGraphicsState(),g="S",S=L}var F=w.__private__.combineFontStyleAndFontWeight=function(t,e){if("bold"==t&&"normal"==e||"bold"==t&&400==e||"normal"==t&&"italic"==e||"bold"==t&&"italic"==e)throw new Error("Invalid Combination of fontweight and fontstyle");return e&&(t=400==e||"normal"===e?"italic"===t?"italic":"normal":700!=e&&"bold"!==e||"normal"!==t?(700==e?"bold":e)+""+t:"bold"),t};w.advancedAPI=function(t){var e=S===L;return e&&k.call(this),"function"!=typeof t||(t(this),e&&P.call(this)),this},w.compatAPI=function(t){var e=S===N;return e&&P.call(this),"function"!=typeof t||(t(this),e&&k.call(this)),this},w.isAdvancedAPI=function(){return S===N};var O,T=function(t){if(S!==N)throw new Error(t+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},q=w.roundToPrecision=w.__private__.roundToPrecision=function(t,n){var r=e||n;if(isNaN(t)||isNaN(r))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return t.toFixed(r).replace(/0+$/,"")};O=w.hpf=w.__private__.hpf="number"==typeof p?function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return q(t,p)}:"smart"===p?function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return q(t,t>-1&&t<1?16:5)}:function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return q(t,16)};var D=w.f2=w.__private__.f2=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.f2");return q(t,2)},z=w.__private__.f3=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.f3");return q(t,3)},U=w.scale=w.__private__.scale=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.scale");return S===L?t*Nt:S===N?t:void 0},H=function(t){return U(function(t){return S===L?Sn()-t:S===N?t:void 0}(t))};w.__private__.setPrecision=w.setPrecision=function(t){"number"==typeof parseInt(t,10)&&(e=parseInt(t,10))};var W,V="00000000000000000000000000000000",G=w.__private__.getFileId=function(){return V},Y=w.__private__.setFileId=function(t){return V=void 0!==t&&/^[a-fA-F0-9]{32}$/.test(t)?t.toUpperCase():V.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),null!==m&&(Ce=new I(m.userPermissions,m.userPassword,m.ownerPassword,V)),V};w.setFileId=function(t){return Y(t),this},w.getFileId=function(){return G()};var Z=w.__private__.convertDateToPDFDate=function(t){var e=t.getTimezoneOffset(),n=e<0?"+":"-",r=Math.floor(Math.abs(e/60)),i=Math.abs(e%60),a=[n,Q(r),"'",Q(i),"'"].join("");return["D:",t.getFullYear(),Q(t.getMonth()+1),Q(t.getDate()),Q(t.getHours()),Q(t.getMinutes()),Q(t.getSeconds()),a].join("")},J=w.__private__.convertPDFDateToDate=function(t){var e=parseInt(t.substr(2,4),10),n=parseInt(t.substr(6,2),10)-1,r=parseInt(t.substr(8,2),10),i=parseInt(t.substr(10,2),10),a=parseInt(t.substr(12,2),10),s=parseInt(t.substr(14,2),10);return new Date(e,n,r,i,a,s,0)},X=w.__private__.setCreationDate=function(t){var e;if(void 0===t&&(t=new Date),t instanceof Date)e=Z(t);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(t))throw new Error("Invalid argument passed to jsPDF.setCreationDate");e=t}return W=e},K=w.__private__.getCreationDate=function(t){var e=W;return"jsDate"===t&&(e=J(W)),e};w.setCreationDate=function(t){return X(t),this},w.getCreationDate=function(t){return K(t)};var $,Q=w.__private__.padd2=function(t){return("0"+parseInt(t)).slice(-2)},tt=w.__private__.padd2Hex=function(t){return("00"+(t=t.toString())).substr(t.length)},et=0,nt=[],rt=[],it=0,at=[],st=[],ot=!1,ht=rt;w.__private__.setCustomOutputDestination=function(t){ot=!0,ht=t};var lt=function(t){ot||(ht=t)};w.__private__.resetCustomOutputDestination=function(){ot=!1,ht=rt};var ct=w.__private__.out=function(t){return t=t.toString(),it+=t.length+1,ht.push(t),ht},ut=w.__private__.write=function(t){return ct(1===arguments.length?t.toString():Array.prototype.join.call(arguments," "))},ft=w.__private__.getArrayBuffer=function(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n);e--;)r[e]=t.charCodeAt(e);return n},dt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];w.__private__.getStandardFonts=function(){return dt};var pt=t.fontSize||16;w.__private__.setFontSize=w.setFontSize=function(t){return pt=S===N?t/Nt:t,this};var gt,mt=w.__private__.getFontSize=w.getFontSize=function(){return S===L?pt:pt*Nt},bt=t.R2L||!1;w.__private__.setR2L=w.setR2L=function(t){return bt=t,this},w.__private__.getR2L=w.getR2L=function(){return bt};var vt,wt=w.__private__.setZoomMode=function(t){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(t))gt=t;else if(isNaN(t)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(t))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+t+'" is not recognized.');gt=t}else gt=parseInt(t,10)};w.__private__.getZoomMode=function(){return gt};var yt,_t=w.__private__.setPageMode=function(t){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(t))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+t+'" is not recognized.');vt=t};w.__private__.getPageMode=function(){return vt};var xt=w.__private__.setLayoutMode=function(t){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(t))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+t+'" is not recognized.');yt=t};w.__private__.getLayoutMode=function(){return yt},w.__private__.setDisplayMode=w.setDisplayMode=function(t,e,n){return wt(t),xt(e),_t(n),this};var At={title:"",subject:"",author:"",keywords:"",creator:""};w.__private__.getDocumentProperty=function(t){if(-1===Object.keys(At).indexOf(t))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return At[t]},w.__private__.getDocumentProperties=function(){return At},w.__private__.setDocumentProperties=w.setProperties=w.setDocumentProperties=function(t){for(var e in At)At.hasOwnProperty(e)&&t[e]&&(At[e]=t[e]);return this},w.__private__.setDocumentProperty=function(t,e){if(-1===Object.keys(At).indexOf(t))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return At[t]=e};var Lt,Nt,St,kt,Pt,Ft={},It={},Ct=[],jt={},Et={},Ot={},Bt={},Mt=null,Rt=0,Tt=[],qt=new j(w),Dt=t.hotfixes||[],zt={},Ut={},Ht=[],Wt=function t(e,n,r,i,a,s){if(!(this instanceof t))return new t(e,n,r,i,a,s);isNaN(e)&&(e=1),isNaN(n)&&(n=0),isNaN(r)&&(r=0),isNaN(i)&&(i=1),isNaN(a)&&(a=0),isNaN(s)&&(s=0),this._matrix=[e,n,r,i,a,s]};Object.defineProperty(Wt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(t){this._matrix[0]=t}}),Object.defineProperty(Wt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(t){this._matrix[1]=t}}),Object.defineProperty(Wt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(t){this._matrix[2]=t}}),Object.defineProperty(Wt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(t){this._matrix[3]=t}}),Object.defineProperty(Wt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(t){this._matrix[4]=t}}),Object.defineProperty(Wt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(t){this._matrix[5]=t}}),Object.defineProperty(Wt.prototype,"a",{get:function(){return this._matrix[0]},set:function(t){this._matrix[0]=t}}),Object.defineProperty(Wt.prototype,"b",{get:function(){return this._matrix[1]},set:function(t){this._matrix[1]=t}}),Object.defineProperty(Wt.prototype,"c",{get:function(){return this._matrix[2]},set:function(t){this._matrix[2]=t}}),Object.defineProperty(Wt.prototype,"d",{get:function(){return this._matrix[3]},set:function(t){this._matrix[3]=t}}),Object.defineProperty(Wt.prototype,"e",{get:function(){return this._matrix[4]},set:function(t){this._matrix[4]=t}}),Object.defineProperty(Wt.prototype,"f",{get:function(){return this._matrix[5]},set:function(t){this._matrix[5]=t}}),Object.defineProperty(Wt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Wt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Wt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Wt.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Wt.prototype.join=function(t){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(O).join(t)},Wt.prototype.multiply=function(t){var e=t.sx*this.sx+t.shy*this.shx,n=t.sx*this.shy+t.shy*this.sy,r=t.shx*this.sx+t.sy*this.shx,i=t.shx*this.shy+t.sy*this.sy,a=t.tx*this.sx+t.ty*this.shx+this.tx,s=t.tx*this.shy+t.ty*this.sy+this.ty;return new Wt(e,n,r,i,a,s)},Wt.prototype.decompose=function(){var t=this.sx,e=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty,s=Math.sqrt(t*t+e*e),o=(t/=s)*n+(e/=s)*r;n-=t*o,r-=e*o;var h=Math.sqrt(n*n+r*r);return o/=h,t*(r/=h)<e*(n/=h)&&(t=-t,e=-e,o=-o,s=-s),{scale:new Wt(s,0,0,h,0,0),translate:new Wt(1,0,0,1,i,a),rotate:new Wt(t,e,-e,t,0,0),skew:new Wt(1,0,o,1,0,0)}},Wt.prototype.toString=function(t){return this.join(" ")},Wt.prototype.inversed=function(){var t=this.sx,e=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty,s=1/(t*r-e*n),o=r*s,h=-e*s,l=-n*s,c=t*s;return new Wt(o,h,l,c,-o*i-l*a,-h*i-c*a)},Wt.prototype.applyToPoint=function(t){var e=t.x*this.sx+t.y*this.shx+this.tx,n=t.x*this.shy+t.y*this.sy+this.ty;return new gn(e,n)},Wt.prototype.applyToRectangle=function(t){var e=this.applyToPoint(t),n=this.applyToPoint(new gn(t.x+t.w,t.y+t.h));return new mn(e.x,e.y,n.x-e.x,n.y-e.y)},Wt.prototype.clone=function(){var t=this.sx,e=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty;return new Wt(t,e,n,r,i,a)},w.Matrix=Wt;var Vt=w.matrixMult=function(t,e){return e.multiply(t)},Gt=new Wt(1,0,0,1,0,0);w.unitMatrix=w.identityMatrix=Gt;var Yt=function(t,e){if(!Et[t]){var n=(e instanceof B?"Sh":"P")+(Object.keys(jt).length+1).toString(10);e.id=n,Et[t]=n,jt[n]=e,qt.publish("addPattern",e)}};w.ShadingPattern=B,w.TilingPattern=M,w.addShadingPattern=function(t,e){return T("addShadingPattern()"),Yt(t,e),this},w.beginTilingPattern=function(t){T("beginTilingPattern()"),vn(t.boundingBox[0],t.boundingBox[1],t.boundingBox[2]-t.boundingBox[0],t.boundingBox[3]-t.boundingBox[1],t.matrix)},w.endTilingPattern=function(t,e){T("endTilingPattern()"),e.stream=st[$].join("\n"),Yt(t,e),qt.publish("endTilingPattern",e),Ht.pop().restore()};var Zt,Jt=w.__private__.newObject=function(){var t=Xt();return Kt(t,!0),t},Xt=w.__private__.newObjectDeferred=function(){return et++,nt[et]=function(){return it},et},Kt=function(t,e){return e="boolean"==typeof e&&e,nt[t]=it,e&&ct(t+" 0 obj"),t},$t=w.__private__.newAdditionalObject=function(){var t={objId:Xt(),content:""};return at.push(t),t},Qt=Xt(),te=Xt(),ee=w.__private__.decodeColorString=function(t){var e=t.split(" ");if(2!==e.length||"g"!==e[1]&&"G"!==e[1])5!==e.length||"k"!==e[4]&&"K"!==e[4]||(e=[(1-e[0])*(1-e[3]),(1-e[1])*(1-e[3]),(1-e[2])*(1-e[3]),"r"]);else{var n=parseFloat(e[0]);e=[n,n,n,"r"]}for(var r="#",i=0;i<3;i++)r+=("0"+Math.floor(255*parseFloat(e[i])).toString(16)).slice(-2);return r},ne=w.__private__.encodeColorString=function(t){var e;"string"==typeof t&&(t={ch1:t});var n=t.ch1,i=t.ch2,a=t.ch3,s=t.ch4,o="draw"===t.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof n&&"#"!==n.charAt(0)){var h=new u(n);if(h.ok)n=h.toHex();else if(!/^\d*\.?\d*$/.test(n))throw new Error('Invalid color "'+n+'" passed to jsPDF.encodeColorString.')}if("string"==typeof n&&/^#[0-9A-Fa-f]{3}$/.test(n)&&(n="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]),"string"==typeof n&&/^#[0-9A-Fa-f]{6}$/.test(n)){var l=parseInt(n.substr(1),16);n=l>>16&255,i=l>>8&255,a=255&l}if(void 0===i||void 0===s&&n===i&&i===a)e="string"==typeof n?n+" "+o[0]:2===t.precision?D(n/255)+" "+o[0]:z(n/255)+" "+o[0];else if(void 0===s||"object"===r(s)){if(s&&!isNaN(s.a)&&0===s.a)return["1.","1.","1.",o[1]].join(" ");e="string"==typeof n?[n,i,a,o[1]].join(" "):2===t.precision?[D(n/255),D(i/255),D(a/255),o[1]].join(" "):[z(n/255),z(i/255),z(a/255),o[1]].join(" ")}else e="string"==typeof n?[n,i,a,s,o[2]].join(" "):2===t.precision?[D(n),D(i),D(a),D(s),o[2]].join(" "):[z(n),z(i),z(a),z(s),o[2]].join(" ");return e},re=w.__private__.getFilters=function(){return l},ie=w.__private__.putStream=function(t){var e=(t=t||{}).data||"",n=t.filters||re(),r=t.alreadyAppliedFilters||[],i=t.addLength1||!1,a=e.length,s=t.objectId,o=function(t){return t};if(null!==m&&void 0===s)throw new Error("ObjectId must be passed to putStream for file encryption");null!==m&&(o=Ce.encryptor(s,0));var h={};!0===n&&(n=["FlateEncode"]);var l=t.additionalKeyValues||[],c=(h=void 0!==R.API.processDataByFilters?R.API.processDataByFilters(e,n):{data:e,reverseChain:[]}).reverseChain+(Array.isArray(r)?r.join(" "):r.toString());if(0!==h.data.length&&(l.push({key:"Length",value:h.data.length}),!0===i&&l.push({key:"Length1",value:a})),0!=c.length)if(c.split("/").length-1==1)l.push({key:"Filter",value:c});else{l.push({key:"Filter",value:"["+c+"]"});for(var u=0;u<l.length;u+=1)if("DecodeParms"===l[u].key){for(var f=[],d=0;d<h.reverseChain.split("/").length-1;d+=1)f.push("null");f.push(l[u].value),l[u].value="["+f.join(" ")+"]"}}ct("<<");for(var p=0;p<l.length;p++)ct("/"+l[p].key+" "+l[p].value);ct(">>"),0!==h.data.length&&(ct("stream"),ct(o(h.data)),ct("endstream"))},ae=w.__private__.putPage=function(t){var e=t.number,n=t.data,r=t.objId,i=t.contentsObjId;Kt(r,!0),ct("<</Type /Page"),ct("/Parent "+t.rootDictionaryObjId+" 0 R"),ct("/Resources "+t.resourceDictionaryObjId+" 0 R"),ct("/MediaBox ["+parseFloat(O(t.mediaBox.bottomLeftX))+" "+parseFloat(O(t.mediaBox.bottomLeftY))+" "+O(t.mediaBox.topRightX)+" "+O(t.mediaBox.topRightY)+"]"),null!==t.cropBox&&ct("/CropBox ["+O(t.cropBox.bottomLeftX)+" "+O(t.cropBox.bottomLeftY)+" "+O(t.cropBox.topRightX)+" "+O(t.cropBox.topRightY)+"]"),null!==t.bleedBox&&ct("/BleedBox ["+O(t.bleedBox.bottomLeftX)+" "+O(t.bleedBox.bottomLeftY)+" "+O(t.bleedBox.topRightX)+" "+O(t.bleedBox.topRightY)+"]"),null!==t.trimBox&&ct("/TrimBox ["+O(t.trimBox.bottomLeftX)+" "+O(t.trimBox.bottomLeftY)+" "+O(t.trimBox.topRightX)+" "+O(t.trimBox.topRightY)+"]"),null!==t.artBox&&ct("/ArtBox ["+O(t.artBox.bottomLeftX)+" "+O(t.artBox.bottomLeftY)+" "+O(t.artBox.topRightX)+" "+O(t.artBox.topRightY)+"]"),"number"==typeof t.userUnit&&1!==t.userUnit&&ct("/UserUnit "+t.userUnit),qt.publish("putPage",{objId:r,pageContext:Tt[e],pageNumber:e,page:n}),ct("/Contents "+i+" 0 R"),ct(">>"),ct("endobj");var a=n.join("\n");return S===N&&(a+="\nQ"),Kt(i,!0),ie({data:a,filters:re(),objectId:i}),ct("endobj"),r},se=w.__private__.putPages=function(){var t,e,n=[];for(t=1;t<=Rt;t++)Tt[t].objId=Xt(),Tt[t].contentsObjId=Xt();for(t=1;t<=Rt;t++)n.push(ae({number:t,data:st[t],objId:Tt[t].objId,contentsObjId:Tt[t].contentsObjId,mediaBox:Tt[t].mediaBox,cropBox:Tt[t].cropBox,bleedBox:Tt[t].bleedBox,trimBox:Tt[t].trimBox,artBox:Tt[t].artBox,userUnit:Tt[t].userUnit,rootDictionaryObjId:Qt,resourceDictionaryObjId:te}));Kt(Qt,!0),ct("<</Type /Pages");var r="/Kids [";for(e=0;e<Rt;e++)r+=n[e]+" 0 R ";ct(r+"]"),ct("/Count "+Rt),ct(">>"),ct("endobj"),qt.publish("postPutPages")},oe=function(t){qt.publish("putFont",{font:t,out:ct,newObject:Jt,putStream:ie}),!0!==t.isAlreadyPutted&&(t.objectNumber=Jt(),ct("<<"),ct("/Type /Font"),ct("/BaseFont /"+C(t.postScriptName)),ct("/Subtype /Type1"),"string"==typeof t.encoding&&ct("/Encoding /"+t.encoding),ct("/FirstChar 32"),ct("/LastChar 255"),ct(">>"),ct("endobj"))},he=function(t){t.objectNumber=Jt();var e=[];e.push({key:"Type",value:"/XObject"}),e.push({key:"Subtype",value:"/Form"}),e.push({key:"BBox",value:"["+[O(t.x),O(t.y),O(t.x+t.width),O(t.y+t.height)].join(" ")+"]"}),e.push({key:"Matrix",value:"["+t.matrix.toString()+"]"});var n=t.pages[1].join("\n");ie({data:n,additionalKeyValues:e,objectId:t.objectNumber}),ct("endobj")},le=function(t,e){e||(e=21);var n=Jt(),r=function(t,e){var n,r=[],i=1/(e-1);for(n=0;n<1;n+=i)r.push(n);if(r.push(1),0!=t[0].offset){var a={offset:0,color:t[0].color};t.unshift(a)}if(1!=t[t.length-1].offset){var s={offset:1,color:t[t.length-1].color};t.push(s)}for(var o="",h=0,l=0;l<r.length;l++){for(n=r[l];n>t[h+1].offset;)h++;var c=t[h].offset,u=(n-c)/(t[h+1].offset-c),f=t[h].color,d=t[h+1].color;o+=tt(Math.round((1-u)*f[0]+u*d[0]).toString(16))+tt(Math.round((1-u)*f[1]+u*d[1]).toString(16))+tt(Math.round((1-u)*f[2]+u*d[2]).toString(16))}return o.trim()}(t.colors,e),i=[];i.push({key:"FunctionType",value:"0"}),i.push({key:"Domain",value:"[0.0 1.0]"}),i.push({key:"Size",value:"["+e+"]"}),i.push({key:"BitsPerSample",value:"8"}),i.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),i.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ie({data:r,additionalKeyValues:i,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:n}),ct("endobj"),t.objectNumber=Jt(),ct("<< /ShadingType "+t.type),ct("/ColorSpace /DeviceRGB");var a="/Coords ["+O(parseFloat(t.coords[0]))+" "+O(parseFloat(t.coords[1]))+" ";2===t.type?a+=O(parseFloat(t.coords[2]))+" "+O(parseFloat(t.coords[3])):a+=O(parseFloat(t.coords[2]))+" "+O(parseFloat(t.coords[3]))+" "+O(parseFloat(t.coords[4]))+" "+O(parseFloat(t.coords[5])),ct(a+="]"),t.matrix&&ct("/Matrix ["+t.matrix.toString()+"]"),ct("/Function "+n+" 0 R"),ct("/Extend [true true]"),ct(">>"),ct("endobj")},ce=function(t,e){var n=Xt(),r=Jt();e.push({resourcesOid:n,objectOid:r}),t.objectNumber=r;var i=[];i.push({key:"Type",value:"/Pattern"}),i.push({key:"PatternType",value:"1"}),i.push({key:"PaintType",value:"1"}),i.push({key:"TilingType",value:"1"}),i.push({key:"BBox",value:"["+t.boundingBox.map(O).join(" ")+"]"}),i.push({key:"XStep",value:O(t.xStep)}),i.push({key:"YStep",value:O(t.yStep)}),i.push({key:"Resources",value:n+" 0 R"}),t.matrix&&i.push({key:"Matrix",value:"["+t.matrix.toString()+"]"}),ie({data:t.stream,additionalKeyValues:i,objectId:t.objectNumber}),ct("endobj")},ue=function(t){for(var e in t.objectNumber=Jt(),ct("<<"),t)switch(e){case"opacity":ct("/ca "+D(t[e]));break;case"stroke-opacity":ct("/CA "+D(t[e]))}ct(">>"),ct("endobj")},fe=function(t){Kt(t.resourcesOid,!0),ct("<<"),ct("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var t in ct("/Font <<"),Ft)Ft.hasOwnProperty(t)&&(!1===b||!0===b&&v.hasOwnProperty(t))&&ct("/"+t+" "+Ft[t].objectNumber+" 0 R");ct(">>")}(),function(){if(Object.keys(jt).length>0){for(var t in ct("/Shading <<"),jt)jt.hasOwnProperty(t)&&jt[t]instanceof B&&jt[t].objectNumber>=0&&ct("/"+t+" "+jt[t].objectNumber+" 0 R");qt.publish("putShadingPatternDict"),ct(">>")}}(),function(t){if(Object.keys(jt).length>0){for(var e in ct("/Pattern <<"),jt)jt.hasOwnProperty(e)&&jt[e]instanceof w.TilingPattern&&jt[e].objectNumber>=0&&jt[e].objectNumber<t&&ct("/"+e+" "+jt[e].objectNumber+" 0 R");qt.publish("putTilingPatternDict"),ct(">>")}}(t.objectOid),function(){if(Object.keys(Ot).length>0){var t;for(t in ct("/ExtGState <<"),Ot)Ot.hasOwnProperty(t)&&Ot[t].objectNumber>=0&&ct("/"+t+" "+Ot[t].objectNumber+" 0 R");qt.publish("putGStateDict"),ct(">>")}}(),function(){for(var t in ct("/XObject <<"),zt)zt.hasOwnProperty(t)&&zt[t].objectNumber>=0&&ct("/"+t+" "+zt[t].objectNumber+" 0 R");qt.publish("putXobjectDict"),ct(">>")}(),ct(">>"),ct("endobj")},de=function(t){It[t.fontName]=It[t.fontName]||{},It[t.fontName][t.fontStyle]=t.id},pe=function(t,e,n,r,i){var a={id:"F"+(Object.keys(Ft).length+1).toString(10),postScriptName:t,fontName:e,fontStyle:n,encoding:r,isStandardFont:i||!1,metadata:{}};return qt.publish("addFont",{font:a,instance:this}),Ft[a.id]=a,de(a),a.id},ge=w.__private__.pdfEscape=w.pdfEscape=function(t,e){return function(t,e){var n,r,i,a,s,o,h,l,c;if(i=(e=e||{}).sourceEncoding||"Unicode",s=e.outputEncoding,(e.autoencode||s)&&Ft[Lt].metadata&&Ft[Lt].metadata[i]&&Ft[Lt].metadata[i].encoding&&(a=Ft[Lt].metadata[i].encoding,!s&&Ft[Lt].encoding&&(s=Ft[Lt].encoding),!s&&a.codePages&&(s=a.codePages[0]),"string"==typeof s&&(s=a[s]),s)){for(h=!1,o=[],n=0,r=t.length;n<r;n++)(l=s[t.charCodeAt(n)])?o.push(String.fromCharCode(l)):o.push(t[n]),o[n].charCodeAt(0)>>8&&(h=!0);t=o.join("")}for(n=t.length;void 0===h&&0!==n;)t.charCodeAt(n-1)>>8&&(h=!0),n--;if(!h)return t;for(o=e.noBOM?[]:[254,255],n=0,r=t.length;n<r;n++){if((c=(l=t.charCodeAt(n))>>8)>>8)throw new Error("Character at position "+n+" of string '"+t+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");o.push(c),o.push(l-(c<<8))}return String.fromCharCode.apply(void 0,o)}(t,e).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},me=w.__private__.beginPage=function(t){st[++Rt]=[],Tt[Rt]={objId:0,contentsObjId:0,userUnit:Number(f),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(t[0]),topRightY:Number(t[1])}},we(Rt),lt(st[$])},be=function(t,e){var r,i,a;switch(n=e||n,"string"==typeof t&&(r=A(t.toLowerCase()),Array.isArray(r)&&(i=r[0],a=r[1])),Array.isArray(t)&&(i=t[0]*Nt,a=t[1]*Nt),isNaN(i)&&(i=o[0],a=o[1]),(i>14400||a>14400)&&(s.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),i=Math.min(14400,i),a=Math.min(14400,a)),o=[i,a],n.substr(0,1)){case"l":a>i&&(o=[a,i]);break;case"p":i>a&&(o=[a,i])}me(o),Ke(Je),ct(sn),0!==fn&&ct(fn+" J"),0!==dn&&ct(dn+" j"),qt.publish("addPage",{pageNumber:Rt})},ve=function(t){t>0&&t<=Rt&&(st.splice(t,1),Tt.splice(t,1),Rt--,$>Rt&&($=Rt),this.setPage($))},we=function(t){t>0&&t<=Rt&&($=t)},ye=w.__private__.getNumberOfPages=w.getNumberOfPages=function(){return st.length-1},_e=function(t,e,n){var r,i=void 0;return n=n||{},t=void 0!==t?t:Ft[Lt].fontName,e=void 0!==e?e:Ft[Lt].fontStyle,r=t.toLowerCase(),void 0!==It[r]&&void 0!==It[r][e]?i=It[r][e]:void 0!==It[t]&&void 0!==It[t][e]?i=It[t][e]:!1===n.disableWarning&&s.warn("Unable to look up font label for font '"+t+"', '"+e+"'. Refer to getFontList() for available fonts."),i||n.noFallback||null==(i=It.times[e])&&(i=It.times.normal),i},xe=w.__private__.putInfo=function(){var t=Jt(),e=function(t){return t};for(var n in null!==m&&(e=Ce.encryptor(t,0)),ct("<<"),ct("/Producer ("+ge(e("jsPDF "+R.version))+")"),At)At.hasOwnProperty(n)&&At[n]&&ct("/"+n.substr(0,1).toUpperCase()+n.substr(1)+" ("+ge(e(At[n]))+")");ct("/CreationDate ("+ge(e(W))+")"),ct(">>"),ct("endobj")},Ae=w.__private__.putCatalog=function(t){var e=(t=t||{}).rootDictionaryObjId||Qt;switch(Jt(),ct("<<"),ct("/Type /Catalog"),ct("/Pages "+e+" 0 R"),gt||(gt="fullwidth"),gt){case"fullwidth":ct("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ct("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ct("/OpenAction [3 0 R /Fit]");break;case"original":ct("/OpenAction [3 0 R /XYZ null null 1]");break;default:var n=""+gt;"%"===n.substr(n.length-1)&&(gt=parseInt(gt)/100),"number"==typeof gt&&ct("/OpenAction [3 0 R /XYZ null null "+D(gt)+"]")}switch(yt||(yt="continuous"),yt){case"continuous":ct("/PageLayout /OneColumn");break;case"single":ct("/PageLayout /SinglePage");break;case"two":case"twoleft":ct("/PageLayout /TwoColumnLeft");break;case"tworight":ct("/PageLayout /TwoColumnRight")}vt&&ct("/PageMode /"+vt),qt.publish("putCatalog"),ct(">>"),ct("endobj")},Le=w.__private__.putTrailer=function(){ct("trailer"),ct("<<"),ct("/Size "+(et+1)),ct("/Root "+et+" 0 R"),ct("/Info "+(et-1)+" 0 R"),null!==m&&ct("/Encrypt "+Ce.oid+" 0 R"),ct("/ID [ <"+V+"> <"+V+"> ]"),ct(">>")},Ne=w.__private__.putHeader=function(){ct("%PDF-"+y),ct("%ºß¬à")},Se=w.__private__.putXRef=function(){var t="0000000000";ct("xref"),ct("0 "+(et+1)),ct("0000000000 65535 f ");for(var e=1;e<=et;e++)"function"==typeof nt[e]?ct((t+nt[e]()).slice(-10)+" 00000 n "):void 0!==nt[e]?ct((t+nt[e]).slice(-10)+" 00000 n "):ct("0000000000 00000 n ")},ke=w.__private__.buildDocument=function(){var t;et=0,it=0,rt=[],nt=[],at=[],Qt=Xt(),te=Xt(),lt(rt),qt.publish("buildDocument"),Ne(),se(),function(){qt.publish("putAdditionalObjects");for(var t=0;t<at.length;t++){var e=at[t];Kt(e.objId,!0),ct(e.content),ct("endobj")}qt.publish("postPutAdditionalObjects")}(),t=[],function(){for(var t in Ft)Ft.hasOwnProperty(t)&&(!1===b||!0===b&&v.hasOwnProperty(t))&&oe(Ft[t])}(),function(){var t;for(t in Ot)Ot.hasOwnProperty(t)&&ue(Ot[t])}(),function(){for(var t in zt)zt.hasOwnProperty(t)&&he(zt[t])}(),function(t){var e;for(e in jt)jt.hasOwnProperty(e)&&(jt[e]instanceof B?le(jt[e]):jt[e]instanceof M&&ce(jt[e],t))}(t),qt.publish("putResources"),t.forEach(fe),fe({resourcesOid:te,objectOid:Number.MAX_SAFE_INTEGER}),qt.publish("postPutResources"),null!==m&&(Ce.oid=Jt(),ct("<<"),ct("/Filter /Standard"),ct("/V "+Ce.v),ct("/R "+Ce.r),ct("/U <"+Ce.toHexString(Ce.U)+">"),ct("/O <"+Ce.toHexString(Ce.O)+">"),ct("/P "+Ce.P),ct(">>"),ct("endobj")),xe(),Ae();var e=it;return Se(),Le(),ct("startxref"),ct(""+e),ct("%%EOF"),lt(st[$]),rt.join("\n")},Pe=w.__private__.getBlob=function(t){return new Blob([ft(t)],{type:"application/pdf"})},Fe=w.output=w.__private__.output=(Zt=function(t,e){switch("string"==typeof(e=e||{})?e={filename:e}:e.filename=e.filename||"generated.pdf",t){case void 0:return ke();case"save":w.save(e.filename);break;case"arraybuffer":return ft(ke());case"blob":return Pe(ke());case"bloburi":case"bloburl":if(void 0!==i.URL&&"function"==typeof i.URL.createObjectURL)return i.URL&&i.URL.createObjectURL(Pe(ke()))||void 0;s.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var n="",r=ke();try{n=d(r)}catch(m){n=d(unescape(encodeURIComponent(r)))}return"data:application/pdf;filename="+e.filename+";base64,"+n;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(i)){var a="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",o=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';e.pdfObjectUrl&&(a=e.pdfObjectUrl,o="");var h='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+a+'"'+o+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(e)+");<\/script></body></html>",l=i.open();return null!==l&&l.document.write(h),l}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(i)){var c='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(e.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+e.filename+'" width="500px" height="400px" /></body></html>',u=i.open();if(null!==u){u.document.write(c);var f=this;u.document.documentElement.querySelector("#pdfViewer").onload=function(){u.document.title=e.filename,u.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(f.output("bloburl"))}}return u}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(i))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var p='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",e)+'"></iframe></body></html>',g=i.open();if(null!==g&&(g.document.write(p),g.document.title=e.filename),g||"undefined"==typeof safari)return g;break;case"datauri":case"dataurl":return i.document.location.href=this.output("datauristring",e);default:return null}},Zt.foo=function(){try{return Zt.apply(this,arguments)}catch(n){var t=n.stack||"";~t.indexOf(" at ")&&(t=t.split(" at ")[1]);var e="Error in function "+t.split("\n")[0].split("<")[0]+": "+n.message;if(!i.console)throw new Error(e);i.console.error(e,n),i.alert&&alert(e)}},Zt.foo.bar=Zt,Zt.foo),Ie=function(t){return!0===Array.isArray(Dt)&&Dt.indexOf(t)>-1};switch(a){case"pt":Nt=1;break;case"mm":Nt=72/25.4;break;case"cm":Nt=72/2.54;break;case"in":Nt=72;break;case"px":Nt=1==Ie("px_scaling")?.75:96/72;break;case"pc":case"em":Nt=12;break;case"ex":Nt=6;break;default:if("number"!=typeof a)throw new Error("Invalid unit: "+a);Nt=a}var Ce=null;X(),Y();var je=w.__private__.getPageInfo=w.getPageInfo=function(t){if(isNaN(t)||t%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Tt[t].objId,pageNumber:t,pageContext:Tt[t]}},Ee=w.__private__.getPageInfoByObjId=function(t){if(isNaN(t)||t%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var e in Tt)if(Tt[e].objId===t)break;return je(e)},Oe=w.__private__.getCurrentPageInfo=w.getCurrentPageInfo=function(){return{objId:Tt[$].objId,pageNumber:$,pageContext:Tt[$]}};w.addPage=function(){return be.apply(this,arguments),this},w.setPage=function(){return we.apply(this,arguments),lt.call(this,st[$]),this},w.insertPage=function(t){return this.addPage(),this.movePage($,t),this},w.movePage=function(t,e){var n,r;if(t>e){n=st[t],r=Tt[t];for(var i=t;i>e;i--)st[i]=st[i-1],Tt[i]=Tt[i-1];st[e]=n,Tt[e]=r,this.setPage(e)}else if(t<e){n=st[t],r=Tt[t];for(var a=t;a<e;a++)st[a]=st[a+1],Tt[a]=Tt[a+1];st[e]=n,Tt[e]=r,this.setPage(e)}return this},w.deletePage=function(){return ve.apply(this,arguments),this},w.__private__.text=w.text=function(t,e,n,i,a){var s,o,h,l,c,u,f,d,p,g=(i=i||{}).scope||this;if("number"==typeof t&&"number"==typeof e&&("string"==typeof n||Array.isArray(n))){var m=n;n=e,e=t,t=m}if(arguments[3]instanceof Wt==0?(h=arguments[4],l=arguments[5],"object"===r(f=arguments[3])&&null!==f||("string"==typeof h&&(l=h,h=null),"string"==typeof f&&(l=f,f=null),"number"==typeof f&&(h=f,f=null),i={flags:f,angle:h,align:l})):(T("The transform parameter of text() with a Matrix value"),p=a),isNaN(e)||isNaN(n)||null==t)throw new Error("Invalid arguments passed to jsPDF.text");if(0===t.length)return g;var b,w="",y="number"==typeof i.lineHeightFactor?i.lineHeightFactor:Ze,_=g.internal.scaleFactor;function x(t){return t=t.split("\t").join(Array(i.TabLen||9).join(" ")),ge(t,f)}function A(t){for(var e,n=t.concat(),r=[],i=n.length;i--;)"string"==typeof(e=n.shift())?r.push(e):Array.isArray(t)&&(1===e.length||void 0===e[1]&&void 0===e[2])?r.push(e[0]):r.push([e[0],e[1],e[2]]);return r}function L(t,e){var n;if("string"==typeof t)n=e(t)[0];else if(Array.isArray(t)){for(var r,i,a=t.concat(),s=[],o=a.length;o--;)"string"==typeof(r=a.shift())?s.push(e(r)[0]):Array.isArray(r)&&"string"==typeof r[0]&&(i=e(r[0],r[1],r[2]),s.push([i[0],i[1],i[2]]));n=s}return n}var k=!1,P=!0;if("string"==typeof t)k=!0;else if(Array.isArray(t)){var F=t.concat();o=[];for(var I,C=F.length;C--;)("string"!=typeof(I=F.shift())||Array.isArray(I)&&"string"!=typeof I[0])&&(P=!1);k=P}if(!1===k)throw new Error('Type of text must be string or Array. "'+t+'" is not recognized.');"string"==typeof t&&(t=t.match(/[\r?\n]/)?t.split(/\r\n|\r|\n/g):[t]);var j=pt/g.internal.scaleFactor,E=j*(y-1);switch(i.baseline){case"bottom":n-=E;break;case"top":n+=j-E;break;case"hanging":n+=j-2*E;break;case"middle":n+=j/2-E}if((u=i.maxWidth||0)>0&&("string"==typeof t?t=g.splitTextToSize(t,u):"[object Array]"===Object.prototype.toString.call(t)&&(t=t.reduce(function(t,e){return t.concat(g.splitTextToSize(e,u))},[]))),s={text:t,x:e,y:n,options:i,mutex:{pdfEscape:ge,activeFontKey:Lt,fonts:Ft,activeFontSize:pt}},qt.publish("preProcessText",s),t=s.text,h=(i=s.options).angle,p instanceof Wt==0&&h&&"number"==typeof h){h*=Math.PI/180,0===i.rotationDirection&&(h=-h),S===N&&(h=-h);var B=Math.cos(h),M=Math.sin(h);p=new Wt(B,M,-M,B,0,0)}else h&&h instanceof Wt&&(p=h);S!==N||p||(p=Gt),void 0!==(c=i.charSpace||cn)&&(w+=O(U(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(d=i.horizontalScale)&&(w+=O(100*d)+" Tz\n"),i.lang;var R=-1,q=void 0!==i.renderingMode?i.renderingMode:i.stroke,D=g.internal.getCurrentPageInfo().pageContext;switch(q){case 0:case!1:case"fill":R=0;break;case 1:case!0:case"stroke":R=1;break;case 2:case"fillThenStroke":R=2;break;case 3:case"invisible":R=3;break;case 4:case"fillAndAddForClipping":R=4;break;case 5:case"strokeAndAddPathForClipping":R=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":R=6;break;case 7:case"addToPathForClipping":R=7}var z=void 0!==D.usedRenderingMode?D.usedRenderingMode:-1;-1!==R?w+=R+" Tr\n":-1!==z&&(w+="0 Tr\n"),-1!==R&&(D.usedRenderingMode=R),l=i.align||"left";var H,W=pt*y,V=g.internal.pageSize.getWidth(),G=Ft[Lt];c=i.charSpace||cn,u=i.maxWidth||0,f=Object.assign({autoencode:!0,noBOM:!0},i.flags);var Y=[],Z=function(t){return g.getStringUnitWidth(t,{font:G,charSpace:c,fontSize:pt,doKerning:!1})*pt/_};if("[object Array]"===Object.prototype.toString.call(t)){var J;o=A(t),"left"!==l&&(H=o.map(Z));var X,K=0;if("right"===l){e-=H[0],t=[],C=o.length;for(var $=0;$<C;$++)0===$?(X=en(e),J=nn(n)):(X=U(K-H[$]),J=-W),t.push([o[$],X,J]),K=H[$]}else if("center"===l){e-=H[0]/2,t=[],C=o.length;for(var Q=0;Q<C;Q++)0===Q?(X=en(e),J=nn(n)):(X=U((K-H[Q])/2),J=-W),t.push([o[Q],X,J]),K=H[Q]}else if("left"===l){t=[],C=o.length;for(var tt=0;tt<C;tt++)t.push(o[tt])}else if("justify"===l&&"Identity-H"===G.encoding){t=[],C=o.length,u=0!==u?u:V;for(var et=0,nt=0;nt<C;nt++)if(J=0===nt?nn(n):-W,X=0===nt?en(e):et,nt<C-1){var rt=U((u-H[nt])/(o[nt].split(" ").length-1)),it=o[nt].split(" ");t.push([it[0]+" ",X,J]),et=0;for(var at=1;at<it.length;at++){var st=(Z(it[at-1]+" "+it[at])-Z(it[at]))*_+rt;at==it.length-1?t.push([it[at],st,0]):t.push([it[at]+" ",st,0]),et-=st}}else t.push([o[nt],X,J]);t.push(["",et,0])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(t=[],C=o.length,u=0!==u?u:V,nt=0;nt<C;nt++){J=0===nt?nn(n):-W,X=0===nt?en(e):0;var ot=o[nt].split(" ").length-1,ht=ot>0?(u-H[nt])/ot:0;nt<C-1?Y.push(O(U(ht))):Y.push(0),t.push([o[nt],X,J])}}}!0===("boolean"==typeof i.R2L?i.R2L:bt)&&(t=L(t,function(t,e,n){return[t.split("").reverse().join(""),e,n]})),s={text:t,x:e,y:n,options:i,mutex:{pdfEscape:ge,activeFontKey:Lt,fonts:Ft,activeFontSize:pt}},qt.publish("postProcessText",s),t=s.text,b=s.mutex.isHex||!1;var lt=Ft[Lt].encoding;"WinAnsiEncoding"!==lt&&"StandardEncoding"!==lt||(t=L(t,function(t,e,n){return[x(t),e,n]})),o=A(t),t=[];for(var ut,ft,dt,gt=Array.isArray(o[0])?1:0,mt="",vt=function(t,e,n){var r="";return n instanceof Wt?(n="number"==typeof i.angle?Vt(n,new Wt(1,0,0,1,t,e)):Vt(new Wt(1,0,0,1,t,e),n),S===N&&(n=Vt(new Wt(1,0,0,-1,0,0),n)),r=n.join(" ")+" Tm\n"):r=O(t)+" "+O(e)+" Td\n",r},wt=0;wt<o.length;wt++){switch(mt="",gt){case 1:dt=(b?"<":"(")+o[wt][0]+(b?">":")"),ut=parseFloat(o[wt][1]),ft=parseFloat(o[wt][2]);break;case 0:dt=(b?"<":"(")+o[wt]+(b?">":")"),ut=en(e),ft=nn(n)}void 0!==Y&&void 0!==Y[wt]&&(mt=Y[wt]+" Tw\n"),0===wt?t.push(mt+vt(ut,ft,p)+dt):0===gt?t.push(mt+dt):1===gt&&t.push(mt+vt(ut,ft,p)+dt)}t=0===gt?t.join(" Tj\nT* "):t.join(" Tj\n"),t+=" Tj\n";var yt="BT\n/";return yt+=Lt+" "+pt+" Tf\n",yt+=O(pt*y)+" TL\n",yt+=hn+"\n",yt+=w,yt+=t,ct(yt+="ET"),v[Lt]=!0,g};var Be=w.__private__.clip=w.clip=function(t){return ct("evenodd"===t?"W*":"W"),this};w.clipEvenOdd=function(){return Be("evenodd")},w.__private__.discardPath=w.discardPath=function(){return ct("n"),this};var Me=w.__private__.isValidStyle=function(t){var e=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(t)&&(e=!0),e};w.__private__.setDefaultPathOperation=w.setDefaultPathOperation=function(t){return Me(t)&&(g=t),this};var Re=w.__private__.getStyle=w.getStyle=function(t){var e=g;switch(t){case"D":case"S":e="S";break;case"F":e="f";break;case"FD":case"DF":e="B";break;case"f":case"f*":case"B":case"B*":e=t}return e},Te=w.close=function(){return ct("h"),this};w.stroke=function(){return ct("S"),this},w.fill=function(t){return qe("f",t),this},w.fillEvenOdd=function(t){return qe("f*",t),this},w.fillStroke=function(t){return qe("B",t),this},w.fillStrokeEvenOdd=function(t){return qe("B*",t),this};var qe=function(t,e){"object"===r(e)?Ue(e,t):ct(t)},De=function(t){null===t||S===N&&void 0===t||(t=Re(t),ct(t))};function ze(t,e,n,r,i){var a=new M(e||this.boundingBox,n||this.xStep,r||this.yStep,this.gState,i||this.matrix);a.stream=this.stream;var s=t+"$$"+this.cloneIndex+++"$$";return Yt(s,a),a}var Ue=function(t,e){var n=Et[t.key],r=jt[n];if(r instanceof B)ct("q"),ct(He(e)),r.gState&&w.setGState(r.gState),ct(t.matrix.toString()+" cm"),ct("/"+n+" sh"),ct("Q");else if(r instanceof M){var i=new Wt(1,0,0,-1,0,Sn());t.matrix&&(i=i.multiply(t.matrix||Gt),n=ze.call(r,t.key,t.boundingBox,t.xStep,t.yStep,i).id),ct("q"),ct("/Pattern cs"),ct("/"+n+" scn"),r.gState&&w.setGState(r.gState),ct(e),ct("Q")}},He=function(t){switch(t){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},We=w.moveTo=function(t,e){return ct(O(U(t))+" "+O(H(e))+" m"),this},Ve=w.lineTo=function(t,e){return ct(O(U(t))+" "+O(H(e))+" l"),this},Ge=w.curveTo=function(t,e,n,r,i,a){return ct([O(U(t)),O(H(e)),O(U(n)),O(H(r)),O(U(i)),O(H(a)),"c"].join(" ")),this};w.__private__.line=w.line=function(t,e,n,r,i){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||!Me(i))throw new Error("Invalid arguments passed to jsPDF.line");return S===L?this.lines([[n-t,r-e]],t,e,[1,1],i||"S"):this.lines([[n-t,r-e]],t,e,[1,1]).stroke()},w.__private__.lines=w.lines=function(t,e,n,r,i,a){var s,o,h,l,c,u,f,d,p,g,m,b;if("number"==typeof t&&(b=n,n=e,e=t,t=b),r=r||[1,1],a=a||!1,isNaN(e)||isNaN(n)||!Array.isArray(t)||!Array.isArray(r)||!Me(i)||"boolean"!=typeof a)throw new Error("Invalid arguments passed to jsPDF.lines");for(We(e,n),s=r[0],o=r[1],l=t.length,g=e,m=n,h=0;h<l;h++)2===(c=t[h]).length?(g=c[0]*s+g,m=c[1]*o+m,Ve(g,m)):(u=c[0]*s+g,f=c[1]*o+m,d=c[2]*s+g,p=c[3]*o+m,g=c[4]*s+g,m=c[5]*o+m,Ge(u,f,d,p,g,m));return a&&Te(),De(i),this},w.path=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=n.c;switch(n.op){case"m":We(r[0],r[1]);break;case"l":Ve(r[0],r[1]);break;case"c":Ge.apply(this,r);break;case"h":Te()}}return this},w.__private__.rect=w.rect=function(t,e,n,r,i){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||!Me(i))throw new Error("Invalid arguments passed to jsPDF.rect");return S===L&&(r=-r),ct([O(U(t)),O(H(e)),O(U(n)),O(U(r)),"re"].join(" ")),De(i),this},w.__private__.triangle=w.triangle=function(t,e,n,r,i,a,s){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a)||!Me(s))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[n-t,r-e],[i-n,a-r],[t-i,e-a]],t,e,[1,1],s,!0),this},w.__private__.roundedRect=w.roundedRect=function(t,e,n,r,i,a,s){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a)||!Me(s))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var o=4/3*(Math.SQRT2-1);return i=Math.min(i,.5*n),a=Math.min(a,.5*r),this.lines([[n-2*i,0],[i*o,0,i,a-a*o,i,a],[0,r-2*a],[0,a*o,-i*o,a,-i,a],[2*i-n,0],[-i*o,0,-i,-a*o,-i,-a],[0,2*a-r],[0,-a*o,i*o,-a,i,-a]],t+i,e,[1,1],s,!0),this},w.__private__.ellipse=w.ellipse=function(t,e,n,r,i){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||!Me(i))throw new Error("Invalid arguments passed to jsPDF.ellipse");var a=4/3*(Math.SQRT2-1)*n,s=4/3*(Math.SQRT2-1)*r;return We(t+n,e),Ge(t+n,e-s,t+a,e-r,t,e-r),Ge(t-a,e-r,t-n,e-s,t-n,e),Ge(t-n,e+s,t-a,e+r,t,e+r),Ge(t+a,e+r,t+n,e+s,t+n,e),De(i),this},w.__private__.circle=w.circle=function(t,e,n,r){if(isNaN(t)||isNaN(e)||isNaN(n)||!Me(r))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(t,e,n,n,r)},w.setFont=function(t,e,n){return n&&(e=F(e,n)),Lt=_e(t,e,{disableWarning:!1}),this};var Ye=w.__private__.getFont=w.getFont=function(){return Ft[_e.apply(w,arguments)]};w.__private__.getFontList=w.getFontList=function(){var t,e,n={};for(t in It)if(It.hasOwnProperty(t))for(e in n[t]=[],It[t])It[t].hasOwnProperty(e)&&n[t].push(e);return n},w.addFont=function(t,e,n,r,i){var a=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==a.indexOf(arguments[3])?i=arguments[3]:arguments[3]&&-1==a.indexOf(arguments[3])&&(n=F(n,r)),pe.call(this,t,e,n,i=i||"Identity-H")};var Ze,Je=t.lineWidth||.200025,Xe=w.__private__.getLineWidth=w.getLineWidth=function(){return Je},Ke=w.__private__.setLineWidth=w.setLineWidth=function(t){return Je=t,ct(O(U(t))+" w"),this};w.__private__.setLineDash=R.API.setLineDash=R.API.setLineDashPattern=function(t,e){if(t=t||[],e=e||0,isNaN(e)||!Array.isArray(t))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return t=t.map(function(t){return O(U(t))}).join(" "),e=O(U(e)),ct("["+t+"] "+e+" d"),this};var $e=w.__private__.getLineHeight=w.getLineHeight=function(){return pt*Ze};w.__private__.getLineHeight=w.getLineHeight=function(){return pt*Ze};var Qe=w.__private__.setLineHeightFactor=w.setLineHeightFactor=function(t){return"number"==typeof(t=t||1.15)&&(Ze=t),this},tn=w.__private__.getLineHeightFactor=w.getLineHeightFactor=function(){return Ze};Qe(t.lineHeight);var en=w.__private__.getHorizontalCoordinate=function(t){return U(t)},nn=w.__private__.getVerticalCoordinate=function(t){return S===N?t:Tt[$].mediaBox.topRightY-Tt[$].mediaBox.bottomLeftY-U(t)},rn=w.__private__.getHorizontalCoordinateString=w.getHorizontalCoordinateString=function(t){return O(en(t))},an=w.__private__.getVerticalCoordinateString=w.getVerticalCoordinateString=function(t){return O(nn(t))},sn=t.strokeColor||"0 G";w.__private__.getStrokeColor=w.getDrawColor=function(){return ee(sn)},w.__private__.setStrokeColor=w.setDrawColor=function(t,e,n,r){return sn=ne({ch1:t,ch2:e,ch3:n,ch4:r,pdfColorType:"draw",precision:2}),ct(sn),this};var on=t.fillColor||"0 g";w.__private__.getFillColor=w.getFillColor=function(){return ee(on)},w.__private__.setFillColor=w.setFillColor=function(t,e,n,r){return on=ne({ch1:t,ch2:e,ch3:n,ch4:r,pdfColorType:"fill",precision:2}),ct(on),this};var hn=t.textColor||"0 g",ln=w.__private__.getTextColor=w.getTextColor=function(){return ee(hn)};w.__private__.setTextColor=w.setTextColor=function(t,e,n,r){return hn=ne({ch1:t,ch2:e,ch3:n,ch4:r,pdfColorType:"text",precision:3}),this};var cn=t.charSpace,un=w.__private__.getCharSpace=w.getCharSpace=function(){return parseFloat(cn||0)};w.__private__.setCharSpace=w.setCharSpace=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return cn=t,this};var fn=0;w.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},w.__private__.setLineCap=w.setLineCap=function(t){var e=w.CapJoinStyles[t];if(void 0===e)throw new Error("Line cap style of '"+t+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return fn=e,ct(e+" J"),this};var dn=0;w.__private__.setLineJoin=w.setLineJoin=function(t){var e=w.CapJoinStyles[t];if(void 0===e)throw new Error("Line join style of '"+t+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return dn=e,ct(e+" j"),this},w.__private__.setLineMiterLimit=w.__private__.setMiterLimit=w.setLineMiterLimit=w.setMiterLimit=function(t){if(t=t||0,isNaN(t))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ct(O(U(t))+" M"),this},w.GState=E,w.setGState=function(t){(t="string"==typeof t?Ot[Bt[t]]:pn(null,t)).equals(Mt)||(ct("/"+t.id+" gs"),Mt=t)};var pn=function(t,e){if(!t||!Bt[t]){var n=!1;for(var r in Ot)if(Ot.hasOwnProperty(r)&&Ot[r].equals(e)){n=!0;break}if(n)e=Ot[r];else{var i="GS"+(Object.keys(Ot).length+1).toString(10);Ot[i]=e,e.id=i}return t&&(Bt[t]=e.id),qt.publish("addGState",e),e}};w.addGState=function(t,e){return pn(t,e),this},w.saveGraphicsState=function(){return ct("q"),Ct.push({key:Lt,size:pt,color:hn}),this},w.restoreGraphicsState=function(){ct("Q");var t=Ct.pop();return Lt=t.key,pt=t.size,hn=t.color,Mt=null,this},w.setCurrentTransformationMatrix=function(t){return ct(t.toString()+" cm"),this},w.comment=function(t){return ct("#"+t),this};var gn=function(t,e){var n=t||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return n},set:function(t){isNaN(t)||(n=parseFloat(t))}});var r=e||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return r},set:function(t){isNaN(t)||(r=parseFloat(t))}});var i="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return i},set:function(t){i=t.toString()}}),this},mn=function(t,e,n,r){gn.call(this,t,e),this.type="rect";var i=n||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return i},set:function(t){isNaN(t)||(i=parseFloat(t))}});var a=r||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return a},set:function(t){isNaN(t)||(a=parseFloat(t))}}),this},bn=function(){this.page=Rt,this.currentPage=$,this.pages=st.slice(0),this.pagesContext=Tt.slice(0),this.x=St,this.y=kt,this.matrix=Pt,this.width=yn($),this.height=xn($),this.outputDestination=ht,this.id="",this.objectNumber=-1};bn.prototype.restore=function(){Rt=this.page,$=this.currentPage,Tt=this.pagesContext,st=this.pages,St=this.x,kt=this.y,Pt=this.matrix,_n($,this.width),An($,this.height),ht=this.outputDestination};var vn=function(t,e,n,r,i){Ht.push(new bn),Rt=$=0,st=[],St=t,kt=e,Pt=i,me([n,r])};for(var wn in w.beginFormObject=function(t,e,n,r,i){return vn(t,e,n,r,i),this},w.endFormObject=function(t){return function(t){if(Ut[t])Ht.pop().restore();else{var e=new bn,n="Xo"+(Object.keys(zt).length+1).toString(10);e.id=n,Ut[t]=n,zt[n]=e,qt.publish("addFormObject",e),Ht.pop().restore()}}(t),this},w.doFormObject=function(t,e){var n=zt[Ut[t]];return ct("q"),ct(e.toString()+" cm"),ct("/"+n.id+" Do"),ct("Q"),this},w.getFormObject=function(t){var e=zt[Ut[t]];return{x:e.x,y:e.y,width:e.width,height:e.height,matrix:e.matrix}},w.save=function(t,e){return t=t||"generated.pdf",(e=e||{}).returnPromise=e.returnPromise||!1,!1===e.returnPromise?(c(Pe(ke()),t),"function"==typeof c.unload&&i.setTimeout&&setTimeout(c.unload,911),this):new Promise(function(e,n){try{var r=c(Pe(ke()),t);"function"==typeof c.unload&&i.setTimeout&&setTimeout(c.unload,911),e(r)}catch(a){n(a.message)}})},R.API)R.API.hasOwnProperty(wn)&&("events"===wn&&R.API.events.length?function(t,e){var n,r,i;for(i=e.length-1;-1!==i;i--)n=e[i][0],r=e[i][1],t.subscribe.apply(t,[n].concat("function"==typeof r?[r]:r))}(qt,R.API.events):w[wn]=R.API[wn]);function yn(t){return Tt[t].mediaBox.topRightX-Tt[t].mediaBox.bottomLeftX}function _n(t,e){Tt[t].mediaBox.topRightX=e+Tt[t].mediaBox.bottomLeftX}function xn(t){return Tt[t].mediaBox.topRightY-Tt[t].mediaBox.bottomLeftY}function An(t,e){Tt[t].mediaBox.topRightY=e+Tt[t].mediaBox.bottomLeftY}var Ln=w.getPageWidth=function(t){return yn(t=t||$)/Nt},Nn=w.setPageWidth=function(t,e){_n(t,e*Nt)},Sn=w.getPageHeight=function(t){return xn(t=t||$)/Nt},kn=w.setPageHeight=function(t,e){An(t,e*Nt)};return w.internal={pdfEscape:ge,getStyle:Re,getFont:Ye,getFontSize:mt,getCharSpace:un,getTextColor:ln,getLineHeight:$e,getLineHeightFactor:tn,getLineWidth:Xe,write:ut,getHorizontalCoordinate:en,getVerticalCoordinate:nn,getCoordinateString:rn,getVerticalCoordinateString:an,collections:{},newObject:Jt,newAdditionalObject:$t,newObjectDeferred:Xt,newObjectDeferredBegin:Kt,getFilters:re,putStream:ie,events:qt,scaleFactor:Nt,pageSize:{getWidth:function(){return Ln($)},setWidth:function(t){Nn($,t)},getHeight:function(){return Sn($)},setHeight:function(t){kn($,t)}},encryptionOptions:m,encryption:Ce,getEncryptor:function(t){return null!==m?Ce.encryptor(t,0):function(t){return t}},output:Fe,getNumberOfPages:ye,get pages(){return st},out:ct,f2:D,f3:z,getPageInfo:je,getPageInfoByObjId:Ee,getCurrentPageInfo:Oe,getPDFVersion:_,Point:gn,Rectangle:mn,Matrix:Wt,hasHotfix:Ie},Object.defineProperty(w.internal.pageSize,"width",{get:function(){return Ln($)},set:function(t){Nn($,t)},enumerable:!0,configurable:!0}),Object.defineProperty(w.internal.pageSize,"height",{get:function(){return Sn($)},set:function(t){kn($,t)},enumerable:!0,configurable:!0}),function(t){for(var e=0,n=dt.length;e<n;e++){var r=pe.call(this,t[e][0],t[e][1],t[e][2],dt[e][3],!0);!1===b&&(v[r]=!0);var i=t[e][0].split("-");de({id:r,fontName:i[0],fontStyle:i[1]||""})}qt.publish("addFonts",{fonts:Ft,dictionary:It})}.call(w,dt),Lt="F1",be(o,n),qt.publish("initialized"),w}I.prototype.lsbFirstWord=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},I.prototype.toHexString=function(t){return t.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},I.prototype.hexToBytes=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(String.fromCharCode(parseInt(t.substr(n,2),16)));return e.join("")},I.prototype.processOwnerPassword=function(t,e){return P(N(e).substr(0,5),t)},I.prototype.encryptor=function(t,e){var n=N(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(t){return P(n,t)}},E.prototype.equals=function(t){var e,n="id,objectNumber,equals";if(!t||r(t)!==r(this))return!1;var i=0;for(e in this)if(!(n.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e))return!1;if(this[e]!==t[e])return!1;i++}for(e in t)t.hasOwnProperty(e)&&n.indexOf(e)<0&&i--;return 0===i},R.API={events:[]},R.version="4.1.0";var T=R.API,q=1,D=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},z=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},U=function(t){return t.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(t){var e=t.charCodeAt(0).toString(16).toUpperCase();return"#"+(1===e.length?"0"+e:e)})},H=function(t){return t.toFixed(2)},W=function(t){return t.toFixed(5)};T.__acroform__={};var V=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},G=function(t){return t*q},Y=function(t){var e=new ct,n=Lt.internal.getHeight(t)||0,r=Lt.internal.getWidth(t)||0;return e.BBox=[0,0,Number(H(r)),Number(H(n))],e},Z=T.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|1<<e},J=T.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&~(1<<e)},X=T.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return t&1<<e?1:0},K=T.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return X(t,e-1)},$=T.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Z(t,e-1)},Q=T.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return J(t,e-1)},tt=T.__acroform__.calculateCoordinates=function(t,e){var n=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,i=t[0],a=t[1],s=t[2],o=t[3],h={};return h.lowerLeft_X=n(i)||0,h.lowerLeft_Y=r(a+o)||0,h.upperRight_X=n(i+s)||0,h.upperRight_Y=r(a)||0,[Number(H(h.lowerLeft_X)),Number(H(h.lowerLeft_Y)),Number(H(h.upperRight_X)),Number(H(h.upperRight_Y))]},et=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],n=t._V||t.DV,r=nt(t,n),i=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+i+" "+H(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var a=Y(t);return a.scope=t.scope,a.stream=e.join("\n"),a}},nt=function(t,e){var n=0===t.fontSize?t.maxFontSize:t.fontSize,r={text:"",fontSize:""},i=(e=")"==(e="("==e.substr(0,1)?e.substr(1):e).substr(e.length-1)?e.substr(0,e.length-1):e).split(" ");i=t.multiline?i.map(function(t){return t.split("\n")}):i.map(function(t){return[t]});var a=n,s=Lt.internal.getHeight(t)||0;s=s<0?-s:s;var o=Lt.internal.getWidth(t)||0;o=o<0?-o:o;var h=function(e,n,r){if(e+1<i.length){var a=n+" "+i[e+1][0];return rt(a,t,r).width<=o-4}return!1};a++;t:for(;a>0;){e="",a--;var l,c,u=rt("3",t,a).height,f=t.multiline?s-a:(s-u)/2,d=f+=2,p=0,g=0,m=0;if(a<=0){e="(...) Tj\n",e+="% Width of Text: "+rt(e,t,a=12).width+", FieldWidth:"+o+"\n";break}for(var b="",v=0,w=0;w<i.length;w++)if(i.hasOwnProperty(w)){var y=!1;if(1!==i[w].length&&m!==i[w].length-1){if((u+2)*(v+2)+2>s)continue t;b+=i[w][m],y=!0,g=w,w--}else{b=" "==(b+=i[w][m]+" ").substr(b.length-1)?b.substr(0,b.length-1):b;var _=parseInt(w),x=h(_,b,a),A=w>=i.length-1;if(x&&!A){b+=" ",m=0;continue}if(x||A){if(A)g=_;else if(t.multiline&&(u+2)*(v+2)+2>s)continue t}else{if(!t.multiline)continue t;if((u+2)*(v+2)+2>s)continue t;g=_}}for(var L="",N=p;N<=g;N++){var S=i[N];if(t.multiline){if(N===g){L+=S[m]+" ",m=(m+1)%S.length;continue}if(N===p){L+=S[S.length-1]+" ";continue}}L+=S[0]+" "}switch(L=" "==L.substr(L.length-1)?L.substr(0,L.length-1):L,c=rt(L,t,a).width,t.textAlign){case"right":l=o-c-2;break;case"center":l=(o-c)/2;break;default:l=2}e+=H(l)+" "+H(d)+" Td\n",e+="("+D(L)+") Tj\n",e+=-H(l)+" 0 Td\n",d=-(a+2),c=0,p=y?g:g+1,v++,b=""}break}return r.text=e,r.fontSize=a,r},rt=function(t,e,n){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),i=e.scope.getStringUnitWidth(t,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:i}},it={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},at=function(t,e){var n={type:"reference",object:t};void 0===e.internal.getPageInfo(t.page).pageContext.annotations.find(function(t){return t.type===n.type&&t.object===n.object})&&e.internal.getPageInfo(t.page).pageContext.annotations.push(n)},st=function(t,e){if(e.scope=t,void 0!==t.internal&&(void 0===t.internal.acroformPlugin||!1===t.internal.acroformPlugin.isInitialized)){if(ft.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(it)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");q=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new ut,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){!function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0}(t)}),t.internal.events.subscribe("buildDocument",function(){!function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var e=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r.objId=void 0,r.hasAnnotation&&at(r,t)}}(t)}),t.internal.events.subscribe("putCatalog",function(){!function(t){if(void 0===t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(t)}),t.internal.events.subscribe("postPutPages",function(e){!function(t,e){var n=!t;for(var i in t||(e.internal.newObjectDeferredBegin(e.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),e.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),t=t||e.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(t.hasOwnProperty(i)){var a=t[i],s=[],o=a.Rect;if(a.Rect&&(a.Rect=tt(a.Rect,e)),e.internal.newObjectDeferredBegin(a.objId,!0),a.DA=Lt.createDefaultAppearanceStream(a),"object"===r(a)&&"function"==typeof a.getKeyValueListForStream&&(s=a.getKeyValueListForStream()),a.Rect=o,a.hasAppearanceStream&&!a.appearanceStreamContent){var h=et(a);s.push({key:"AP",value:"<</N "+h+">>"}),e.internal.acroformPlugin.xForms.push(h)}if(a.appearanceStreamContent){var l="";for(var c in a.appearanceStreamContent)if(a.appearanceStreamContent.hasOwnProperty(c)){var u=a.appearanceStreamContent[c];if(l+="/"+c+" ",l+="<<",Object.keys(u).length>=1||Array.isArray(u)){for(var i in u)if(u.hasOwnProperty(i)){var f=u[i];"function"==typeof f&&(f=f.call(e,a)),l+="/"+i+" "+f+" ",e.internal.acroformPlugin.xForms.indexOf(f)>=0||e.internal.acroformPlugin.xForms.push(f)}}else"function"==typeof(f=u)&&(f=f.call(e,a)),l+="/"+i+" "+f,e.internal.acroformPlugin.xForms.indexOf(f)>=0||e.internal.acroformPlugin.xForms.push(f);l+=">>"}s.push({key:"AP",value:"<<\n"+l+">>"})}e.internal.putStream({additionalKeyValues:s,objectId:a.objId}),e.internal.out("endobj")}n&&function(t,e){for(var n in t)if(t.hasOwnProperty(n)){var i=n,a=t[n];e.internal.newObjectDeferredBegin(a.objId,!0),"object"===r(a)&&"function"==typeof a.putStream&&a.putStream(),delete t[i]}}(e.internal.acroformPlugin.xForms,e)}(e,t)}),t.internal.acroformPlugin.isInitialized=!0}},ot=T.__acroform__.arrayToPdfArray=function(t,e,n){var i=function(t){return t};if(Array.isArray(t)){for(var a="[",s=0;s<t.length;s++)switch(0!==s&&(a+=" "),r(t[s])){case"boolean":case"number":case"object":a+=t[s].toString();break;case"string":"/"===t[s].substr(0,1)?a+="/"+U(t[s].substr(1)):(void 0!==e&&n&&(i=n.internal.getEncryptor(e)),a+="("+D(i(t[s].toString()))+")")}return a+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},ht=function(t,e,n){var r=function(t){return t};return void 0!==e&&n&&(r=n.internal.getEncryptor(e)),(t=t||"").toString(),"("+D(r(t))+")"},lt=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};lt.prototype.toString=function(){return this.objId+" 0 R"},lt.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},lt.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter(function(t){return"content"!=t&&"appearanceStreamContent"!=t&&"scope"!=t&&"objId"!=t&&"_"!=t.substring(0,1)});for(var n in e)if(!1===Object.getOwnPropertyDescriptor(this,e[n]).configurable){var r=e[n],i=this[r];i&&(Array.isArray(i)?t.push({key:r,value:ot(i,this.objId,this.scope)}):i instanceof lt?(i.scope=this.scope,t.push({key:r,value:i.objId+" 0 R"})):"function"!=typeof i&&t.push({key:r,value:i}))}return t};var ct=function(){lt.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){t=e.trim()},get:function(){return t||null}})};V(ct,lt);var ut=function(){lt.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var e=function(t){return t};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+D(e(t))+")"}},set:function(e){t=e}})};V(ut,lt);var ft=function t(){lt.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){if(isNaN(t))throw new Error('Invalid value "'+t+'" for attribute F supplied.');e=t}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(e,3))},set:function(t){!0===Boolean(t)?this.F=$(e,3):this.F=Q(e,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){if(isNaN(t))throw new Error('Invalid value "'+t+'" for attribute Ff supplied.');n=t}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==r.length)return r},set:function(t){r=void 0!==t?t:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(t){r[0]=t}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(t){r[1]=t}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(t){r[2]=t}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(t){r[3]=t}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){switch(t){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=t;break;default:throw new Error('Invalid value "'+t+'" for attribute FT supplied.')}}});var a=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!a||a.length<1){if(this instanceof yt)return;a="FieldObject"+t.FieldNum++}var e=function(t){return t};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+D(e(a))+")"},set:function(t){a=t.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return a},set:function(t){a=t}});var s="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return s},set:function(t){s=t}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(t){o=t}});var h=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return h},set:function(t){h=t}});var l=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===l?50/q:l},set:function(t){l=t}});var c="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return c},set:function(t){c=t}});var u="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!u||this instanceof yt||this instanceof xt))return ht(u,this.objId,this.scope)},set:function(t){t=t.toString(),u=t}});var f=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(f)return this instanceof bt==0?ht(f,this.objId,this.scope):f},set:function(t){t=t.toString(),f=this instanceof bt==0?"("===t.substr(0,1)?z(t.substr(1,t.length-2)):z(t):t}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof bt==1?z(f.substr(1,f.length-1)):f},set:function(t){t=t.toString(),f=this instanceof bt==1?"/"+U(t):t}});var d=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(d)return d},set:function(t){this.V=t}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof bt==0?ht(d,this.objId,this.scope):d},set:function(t){t=t.toString(),d=this instanceof bt==0?"("===t.substr(0,1)?z(t.substr(1,t.length-2)):z(t):t}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof bt==1?z(d.substr(1,d.length-1)):d},set:function(t){t=t.toString(),d=this instanceof bt==1?"/"+U(t):t}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var p,g=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return g},set:function(t){t=Boolean(t),g=t}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(p)return p},set:function(t){p=t}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,1))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,1):this.Ff=Q(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,2))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,2):this.Ff=Q(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,3))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,3):this.Ff=Q(this.Ff,3)}});var m=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==m)return m},set:function(t){if(-1===[0,1,2].indexOf(t))throw new Error('Invalid value "'+t+'" for attribute Q supplied.');m=t}}),Object.defineProperty(this,"textAlign",{get:function(){var t;switch(m){case 0:default:t="left";break;case 1:t="center";break;case 2:t="right"}return t},configurable:!0,enumerable:!0,set:function(t){switch(t){case"right":case 2:m=2;break;case"center":case 1:m=1;break;default:m=0}}})};V(ft,lt);var dt=function(){ft.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){t=e}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return ot(e,this.objId,this.scope)},set:function(t){var n,r;r=[],"string"==typeof(n=t)&&(r=function(t,e,n){n||(n=1);for(var r,i=[];r=e.exec(t);)i.push(r[n]);return i}(n,/\((.*?)\)/g)),e=r}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,n){for(n=n||!1,t=(t=t||"").toString();-1!==e.indexOf(t)&&(e.splice(e.indexOf(t),1),!1!==n););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,18))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,18):this.Ff=Q(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,19))},set:function(t){!0===this.combo&&(!0===Boolean(t)?this.Ff=$(this.Ff,19):this.Ff=Q(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,20))},set:function(t){!0===Boolean(t)?(this.Ff=$(this.Ff,20),e.sort()):this.Ff=Q(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,22))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,22):this.Ff=Q(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,23))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,23):this.Ff=Q(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,27))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,27):this.Ff=Q(this.Ff,27)}}),this.hasAppearanceStream=!1};V(dt,ft);var pt=function(){dt.call(this),this.fontName="helvetica",this.combo=!1};V(pt,dt);var gt=function(){pt.call(this),this.combo=!0};V(gt,pt);var mt=function(){gt.call(this),this.edit=!0};V(mt,gt);var bt=function(){ft.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,15))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,15):this.Ff=Q(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,16))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,16):this.Ff=Q(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,17))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,17):this.Ff=Q(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,26))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,26):this.Ff=Q(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(t){return t};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(e).length){var n,r=[];for(n in r.push("<<"),e)r.push("/"+n+" ("+D(t(e[n]))+")");return r.push(">>"),r.join("\n")}},set:function(t){"object"===r(t)&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){"string"==typeof t&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(e){t="/"+U(e)}})};V(bt,ft);var vt=function(){bt.call(this),this.pushButton=!0};V(vt,bt);var wt=function(){bt.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=void 0!==e?e:[]}})};V(wt,bt);var yt=function(){var t,e;ft.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(t){e=t}});var n,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(t){return t};this.scope&&(t=this.scope.internal.getEncryptor(this.objId));var e,n=[];for(e in n.push("<<"),i)n.push("/"+e+" ("+D(t(i[e]))+")");return n.push(">>"),n.join("\n")},set:function(t){"object"===r(t)&&(i=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(t){"string"==typeof t&&(i.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(t){n="/"+t}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Lt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};V(yt,ft),wt.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var n=this.Kids[e];n.appearanceStreamContent=t.createAppearanceStream(n.optionName),n.caption=t.getCA()}},wt.prototype.createOption=function(t){var e=new yt;return e.Parent=this,e.optionName=t,this.Kids.push(e),Nt.call(this.scope,e),e};var _t=function(){bt.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Lt.CheckBox.createAppearanceStream()};V(_t,bt);var xt=function(){ft.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,13))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,13):this.Ff=Q(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,21))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,21):this.Ff=Q(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,23))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,23):this.Ff=Q(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,24))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,24):this.Ff=Q(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,25))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,25):this.Ff=Q(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,26))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,26):this.Ff=Q(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};V(xt,ft);var At=function(){xt.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(K(this.Ff,14))},set:function(t){!0===Boolean(t)?this.Ff=$(this.Ff,14):this.Ff=Q(this.Ff,14)}}),this.password=!0};V(At,xt);var Lt={CheckBox:{createAppearanceStream:function(){return{N:{On:Lt.CheckBox.YesNormal},D:{On:Lt.CheckBox.YesPushDown,Off:Lt.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=Y(t);e.scope=t.scope;var n=[],r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,i=t.scope.__private__.encodeColorString(t.color),a=nt(t,t.caption);return n.push("0.749023 g"),n.push("0 0 "+H(Lt.internal.getWidth(t))+" "+H(Lt.internal.getHeight(t))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+H(a.fontSize)+" Tf "+i),n.push("BT"),n.push(a.text),n.push("ET"),n.push("Q"),n.push("EMC"),e.stream=n.join("\n"),e},YesNormal:function(t){var e=Y(t);e.scope=t.scope;var n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color),i=[],a=Lt.internal.getHeight(t),s=Lt.internal.getWidth(t),o=nt(t,t.caption);return i.push("1 g"),i.push("0 0 "+H(s)+" "+H(a)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+H(s-1)+" "+H(a-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+n+" "+H(o.fontSize)+" Tf "+r),i.push(o.text),i.push("ET"),i.push("Q"),e.stream=i.join("\n"),e},OffPushDown:function(t){var e=Y(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+H(Lt.internal.getWidth(t))+" "+H(Lt.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join("\n"),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:Lt.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=Lt.RadioButton.Circle.YesNormal,e.D[t]=Lt.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=Y(t);e.scope=t.scope;var n=[],r=Lt.internal.getWidth(t)<=Lt.internal.getHeight(t)?Lt.internal.getWidth(t)/4:Lt.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var i=Lt.internal.Bezier_C,a=Number((r*i).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+W(Lt.internal.getWidth(t)/2)+" "+W(Lt.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),n.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),n.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),n.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join("\n"),e},YesPushDown:function(t){var e=Y(t);e.scope=t.scope;var n=[],r=Lt.internal.getWidth(t)<=Lt.internal.getHeight(t)?Lt.internal.getWidth(t)/4:Lt.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),a=Number((i*Lt.internal.Bezier_C).toFixed(5)),s=Number((r*Lt.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+W(Lt.internal.getWidth(t)/2)+" "+W(Lt.internal.getHeight(t)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+W(Lt.internal.getWidth(t)/2)+" "+W(Lt.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),n.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),n.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),n.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join("\n"),e},OffPushDown:function(t){var e=Y(t);e.scope=t.scope;var n=[],r=Lt.internal.getWidth(t)<=Lt.internal.getHeight(t)?Lt.internal.getWidth(t)/4:Lt.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),a=Number((i*Lt.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+W(Lt.internal.getWidth(t)/2)+" "+W(Lt.internal.getHeight(t)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join("\n"),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:Lt.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=Lt.RadioButton.Cross.YesNormal,e.D[t]=Lt.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=Y(t);e.scope=t.scope;var n=[],r=Lt.internal.calculateCross(t);return n.push("q"),n.push("1 1 "+H(Lt.internal.getWidth(t)-2)+" "+H(Lt.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(H(r.x1.x)+" "+H(r.x1.y)+" m"),n.push(H(r.x2.x)+" "+H(r.x2.y)+" l"),n.push(H(r.x4.x)+" "+H(r.x4.y)+" m"),n.push(H(r.x3.x)+" "+H(r.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join("\n"),e},YesPushDown:function(t){var e=Y(t);e.scope=t.scope;var n=Lt.internal.calculateCross(t),r=[];return r.push("0.749023 g"),r.push("0 0 "+H(Lt.internal.getWidth(t))+" "+H(Lt.internal.getHeight(t))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+H(Lt.internal.getWidth(t)-2)+" "+H(Lt.internal.getHeight(t)-2)+" re"),r.push("W"),r.push("n"),r.push(H(n.x1.x)+" "+H(n.x1.y)+" m"),r.push(H(n.x2.x)+" "+H(n.x2.y)+" l"),r.push(H(n.x4.x)+" "+H(n.x4.y)+" m"),r.push(H(n.x3.x)+" "+H(n.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join("\n"),e},OffPushDown:function(t){var e=Y(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+H(Lt.internal.getWidth(t))+" "+H(Lt.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join("\n"),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+n}};Lt.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=Lt.internal.getWidth(t),n=Lt.internal.getHeight(t),r=Math.min(e,n);return{x1:{x:(e-r)/2,y:(n-r)/2+r},x2:{x:(e-r)/2+r,y:(n-r)/2},x3:{x:(e-r)/2,y:(n-r)/2},x4:{x:(e-r)/2+r,y:(n-r)/2+r}}}},Lt.internal.getWidth=function(t){var e=0;return"object"===r(t)&&(e=G(t.Rect[2])),e},Lt.internal.getHeight=function(t){var e=0;return"object"===r(t)&&(e=G(t.Rect[3])),e};var Nt=T.addField=function(t){if(st(this,t),!(t instanceof ft))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};T.AcroFormChoiceField=dt,T.AcroFormListBox=pt,T.AcroFormComboBox=gt,T.AcroFormEditBox=mt,T.AcroFormButton=bt,T.AcroFormPushButton=vt,T.AcroFormRadioButton=wt,T.AcroFormCheckBox=_t,T.AcroFormTextField=xt,T.AcroFormPasswordField=At,T.AcroFormAppearance=Lt,T.AcroForm={ChoiceField:dt,ListBox:pt,ComboBox:gt,EditBox:mt,Button:bt,PushButton:vt,RadioButton:wt,CheckBox:_t,TextField:xt,PasswordField:At,Appearance:Lt},R.AcroForm={ChoiceField:dt,ListBox:pt,ComboBox:gt,EditBox:mt,Button:bt,PushButton:vt,RadioButton:wt,CheckBox:_t,TextField:xt,PasswordField:At,Appearance:Lt};var St=R.AcroForm;function kt(t){return t.reduce(function(t,e,n){return t[e]=n,t},{})}!function(t){var e="addImage_";t.__addimage__={};var n="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=t.__addimage__.getImageFileTypeByImageData=function(t,e){var r,a,s,o,h,l=n;if("RGBA"===(e=e||n)||void 0!==t.data&&t.data instanceof Uint8ClampedArray&&"height"in t&&"width"in t)return"RGBA";if(L(t))for(h in i)for(s=i[h],r=0;r<s.length;r+=1){for(o=!0,a=0;a<s[r].length;a+=1)if(void 0!==s[r][a]&&s[r][a]!==t[a]){o=!1;break}if(!0===o){l=h;break}}else for(h in i)for(s=i[h],r=0;r<s.length;r+=1){for(o=!0,a=0;a<s[r].length;a+=1)if(void 0!==s[r][a]&&s[r][a]!==t.charCodeAt(a)){o=!1;break}if(!0===o){l=h;break}}return l===n&&e!==n&&(l=e),l},s=function t(e){for(var n=this.internal.write,r=this.internal.putStream,i=(0,this.internal.getFilters)();-1!==i.indexOf("FlateEncode");)i.splice(i.indexOf("FlateEncode"),1);e.objectId=this.internal.newObject();var a=[];if(a.push({key:"Type",value:"/XObject"}),a.push({key:"Subtype",value:"/Image"}),a.push({key:"Width",value:e.width}),a.push({key:"Height",value:e.height}),e.colorSpace===w.INDEXED?a.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(e.palette.length/3-1)+" "+("sMask"in e&&void 0!==e.sMask?e.objectId+2:e.objectId+1)+" 0 R]"}):(a.push({key:"ColorSpace",value:"/"+e.colorSpace}),e.colorSpace===w.DEVICE_CMYK&&a.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),a.push({key:"BitsPerComponent",value:e.bitsPerComponent}),"decodeParameters"in e&&void 0!==e.decodeParameters&&a.push({key:"DecodeParms",value:"<<"+e.decodeParameters+">>"}),"transparency"in e&&Array.isArray(e.transparency)&&e.transparency.length>0){for(var s="",o=0,h=e.transparency.length;o<h;o++)s+=e.transparency[o]+" "+e.transparency[o]+" ";a.push({key:"Mask",value:"["+s+"]"})}void 0!==e.sMask&&a.push({key:"SMask",value:e.objectId+1+" 0 R"});var l=void 0!==e.filter?["/"+e.filter]:void 0;if(r({data:e.data,additionalKeyValues:a,alreadyAppliedFilters:l,objectId:e.objectId}),n("endobj"),"sMask"in e&&void 0!==e.sMask){var c,u=null!==(c=e.sMaskBitsPerComponent)&&void 0!==c?c:e.bitsPerComponent,f={width:e.width,height:e.height,colorSpace:"DeviceGray",bitsPerComponent:u,data:e.sMask};"filter"in e&&(f.decodeParameters="/Predictor ".concat(e.predictor," /Colors 1 /BitsPerComponent ").concat(u," /Columns ").concat(e.width),f.filter=e.filter),t.call(this,f)}if(e.colorSpace===w.INDEXED){var d=this.internal.newObject();r({data:S(new Uint8Array(e.palette)),objectId:d}),n("endobj")}},o=function(){var t=this.internal.collections[e+"images"];for(var n in t)s.call(this,t[n])},h=function(){var t,n=this.internal.collections[e+"images"],r=this.internal.write;for(var i in n)r("/I"+(t=n[i]).index,t.objectId,"0","R")},l=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",h))},c=function(){var t=this.internal.collections[e+"images"];return l.call(this),t},u=function(){return Object.keys(this.internal.collections[e+"images"]).length},d=function(e){return"function"==typeof t["process"+e.toUpperCase()]},p=function(t){return"object"===r(t)&&1===t.nodeType},g=function(e,n){if("IMG"===e.nodeName&&e.hasAttribute("src")){var r=""+e.getAttribute("src");if(0===r.indexOf("data:image/"))return f(unescape(r).split("base64,").pop());var i=t.loadFile(r,!0);if(void 0!==i)return i}if("CANVAS"===e.nodeName){if(0===e.width||0===e.height)throw new Error("Given canvas must have data. Canvas width: "+e.width+", height: "+e.height);var a;switch(n){case"PNG":a="image/png";break;case"WEBP":a="image/webp";break;default:a="image/jpeg"}return f(e.toDataURL(a,1).split("base64,").pop())}},m=function(t){var n=this.internal.collections[e+"images"];if(n)for(var r in n)if(t===n[r].alias)return n[r]},b=function(t,e,n){return t||e||(t=-96,e=-96),t<0&&(t=-1*n.width*72/t/this.internal.scaleFactor),e<0&&(e=-1*n.height*72/e/this.internal.scaleFactor),0===t&&(t=e*n.width/n.height),0===e&&(e=t*n.height/n.width),[t,e]},v=function(t,e,n,r,i,a){var s=b.call(this,n,r,i),o=this.internal.getCoordinateString,h=this.internal.getVerticalCoordinateString,l=c.call(this);if(n=s[0],r=s[1],l[i.index]=i,a){a*=Math.PI/180;var u=Math.cos(a),f=Math.sin(a),d=function(t){return t.toFixed(4)},p=[d(u),d(f),d(-1*f),d(u),0,0,"cm"]}this.internal.write("q"),a?(this.internal.write([1,"0","0",1,o(t),h(e+r),"cm"].join(" ")),this.internal.write(p.join(" ")),this.internal.write([o(n),"0","0",o(r),"0","0","cm"].join(" "))):this.internal.write([o(n),"0","0",o(r),o(t),h(e+r),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+i.index+" Do"),this.internal.write("Q")},w=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var y=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},_=t.__addimage__.sHashCode=function(t){var e,n,r=0;if("string"==typeof t)for(n=t.length,e=0;e<n;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;else if(L(t))for(n=t.byteLength/2,e=0;e<n;e++)r=(r<<5)-r+t[e],r|=0;return r},x=t.__addimage__.validateStringAsBase64=function(t){(t=t||"").toString().trim();var e=!0;return 0===t.length&&(e=!1),t.length%4!=0&&(e=!1),!1===/^[A-Za-z0-9+/]+$/.test(t.substr(0,t.length-2))&&(e=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(t.substr(-2))&&(e=!1),e},A=t.__addimage__.extractImageFromDataUrl=function(t){if(null==t)return null;if(!(t=t.trim()).startsWith("data:"))return null;var e=t.indexOf(",");return e<0?null:t.substring(0,e).trim().endsWith("base64")?t.substring(e+1):null};t.__addimage__.isArrayBuffer=function(t){return t instanceof ArrayBuffer};var L=t.__addimage__.isArrayBufferView=function(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array},N=t.__addimage__.binaryStringToUint8Array=function(t){for(var e=t.length,n=new Uint8Array(e),r=0;r<e;r++)n[r]=t.charCodeAt(r);return n},S=t.__addimage__.arrayBufferToBinaryString=function(t){for(var e="",n=L(t)?t:new Uint8Array(t),r=0;r<n.length;r+=8192)e+=String.fromCharCode.apply(null,n.subarray(r,r+8192));return e};t.addImage=function(){var t,e,i,a,s,o,h,c,u;if("number"==typeof arguments[1]?(e=n,i=arguments[1],a=arguments[2],s=arguments[3],o=arguments[4],h=arguments[5],c=arguments[6],u=arguments[7]):(e=arguments[1],i=arguments[2],a=arguments[3],s=arguments[4],o=arguments[5],h=arguments[6],c=arguments[7],u=arguments[8]),"object"===r(t=arguments[0])&&!p(t)&&"imageData"in t){var f=t;t=f.imageData,e=f.format||e||n,i=f.x||i||0,a=f.y||a||0,s=f.w||f.width||s,o=f.h||f.height||o,h=f.alias||h,c=f.compression||c,u=f.rotation||f.angle||u}var d=this.internal.getFilters();if(void 0===c&&-1!==d.indexOf("FlateEncode")&&(c="SLOW"),isNaN(i)||isNaN(a))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var g=k.call(this,t,e,h,c);return v.call(this,i,a,s,o,g,u),this};var k=function(e,r,i,s){var o,h,l;if("string"==typeof e&&a(e)===n){e=unescape(e);var c=P(e,!1);(""!==c||void 0!==(c=t.loadFile(e,!0)))&&(e=c)}if(p(e)&&(e=g(e,r)),r=a(e,r),!d(r))throw new Error("addImage does not support files of type '"+r+"', please ensure that a plugin for '"+r+"' support is added.");if((null==(l=i)||0===l.length)&&(i=function(t){return"string"==typeof t||L(t)?_(t):L(t.data)?_(t.data):null}(e)),(o=m.call(this,i))||(e instanceof Uint8Array||"RGBA"===r||(h=e,e=N(e)),o=this["process"+r.toUpperCase()](e,u.call(this),i,function(e){return e&&"string"==typeof e&&(e=e.toUpperCase()),e in t.image_compression?e:y.NONE}(s),h)),!o)throw new Error("An unknown error occurred whilst processing the image.");return o},P=t.__addimage__.convertBase64ToBinaryString=function(t,e){e="boolean"!=typeof e||e;var n,r="";if("string"==typeof t){var i;n=null!==(i=A(t))&&void 0!==i?i:t;try{r=f(n)}catch(a){if(e)throw x(n)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+a.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return r};t.getImageProperties=function(e){var r,i,s="";if(p(e)&&(e=g(e)),"string"==typeof e&&a(e)===n&&(""===(s=P(e,!1))&&(s=t.loadFile(e)||""),e=s),i=a(e),!d(i))throw new Error("addImage does not support files of type '"+i+"', please ensure that a plugin for '"+i+"' support is added.");if(e instanceof Uint8Array||(e=N(e)),!(r=this["process"+i.toUpperCase()](e)))throw new Error("An unknown error occurred whilst processing the image");return r.fileType=i,r}}(R.API),
/**
   * @license
   * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){var e=function(t){if(void 0!==t&&""!=t)return!0};R.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(t){for(var n,r,i,a=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,o=this.internal.getPageInfoByObjId(t.objId),h=t.pageContext.annotations,l=!1,c=0;c<h.length&&!l;c++)switch((n=h[c]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(l=!0);break;case"reference":case"text":case"freetext":l=!0}if(0!=l){this.internal.write("/Annots [");for(var u=0;u<h.length;u++){n=h[u];var f=this.internal.pdfEscape,d=this.internal.getEncryptor(t.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var p=this.internal.newAdditionalObject(),g=this.internal.newAdditionalObject(),m=this.internal.getEncryptor(p.objId),b=n.title||"Note";i="<</Type /Annot /Subtype /Text "+(r="/Rect ["+a(n.bounds.x)+" "+s(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+s(n.bounds.y)+"] ")+"/Contents ("+f(m(n.contents))+")",i+=" /Popup "+g.objId+" 0 R",i+=" /P "+o.objId+" 0 R",i+=" /T ("+f(m(b))+") >>",p.content=i;var v=p.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+a(n.bounds.x+30)+" "+s(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+s(n.bounds.y)+"] ")+" /Parent "+v,n.open&&(i+=" /Open true"),i+=" >>",g.content=i,this.internal.write(p.objId,"0 R",g.objId,"0 R");break;case"freetext":r="/Rect ["+a(n.bounds.x)+" "+s(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+s(n.bounds.y+n.bounds.h)+"] ";var w=n.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+f(d(n.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+w+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(n.options.name){var y=this.annotations._nameMap[n.options.name];n.options.pageNumber=y.page,n.options.top=y.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",i="",n.options.url)i="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+f(d(n.options.url))+") >>";else if(n.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,i+=" /FitV "+n.options.left+"]";break;default:var _=s(n.options.top);n.options.left=n.options.left||0,void 0===n.options.zoom&&(n.options.zoom=0),i+=" /XYZ "+n.options.left+" "+_+" "+n.options.zoom+"]"}""!=i&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),t.createAnnotation=function(t){var e=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":e.pageContext.annotations.push(t)}},t.link=function(t,e,n,r,i){var a=this.internal.getCurrentPageInfo(),s=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString;a.pageContext.annotations.push({finalBounds:{x:s(t),y:o(e),w:s(t+n),h:o(e+r)},options:i,type:"link"})},t.textWithLink=function(t,e,n,r){var i,a,s=this.getTextWidth(t),o=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==r.maxWidth){a=r.maxWidth;var h=this.splitTextToSize(t,a).length;i=Math.ceil(o*h)}else a=s,i=o;return this.text(t,e,n,r),n+=.2*o,"center"===r.align&&(e-=s/2),"right"===r.align&&(e-=s),this.link(e,n-o,a,i,r),s},t.getTextWidth=function(t){var e=this.internal.getFontSize();return this.getStringUnitWidth(t)*e/this.internal.scaleFactor}}(R.API),
/**
   * @license
   * Copyright (c) 2017 Aras Abbasi
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];t.__arabicParser__={};var a=t.__arabicParser__.isInArabicSubstitutionA=function(t){return void 0!==e[t.charCodeAt(0)]},s=t.__arabicParser__.isArabicLetter=function(t){return"string"==typeof t&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(t)},o=t.__arabicParser__.isArabicEndLetter=function(t){return s(t)&&a(t)&&e[t.charCodeAt(0)].length<=2},h=t.__arabicParser__.isArabicAlfLetter=function(t){return s(t)&&i.indexOf(t.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(t){return s(t)&&a(t)&&e[t.charCodeAt(0)].length>=1};var l=t.__arabicParser__.arabicLetterHasFinalForm=function(t){return s(t)&&a(t)&&e[t.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(t){return s(t)&&a(t)&&e[t.charCodeAt(0)].length>=3};var c=t.__arabicParser__.arabicLetterHasMedialForm=function(t){return s(t)&&a(t)&&4==e[t.charCodeAt(0)].length},u=t.__arabicParser__.resolveLigatures=function(t){var e=0,r=n,i="",a=0;for(e=0;e<t.length;e+=1)void 0!==r[t.charCodeAt(e)]?(a++,"number"==typeof(r=r[t.charCodeAt(e)])&&(i+=String.fromCharCode(r),r=n,a=0),e===t.length-1&&(r=n,i+=t.charAt(e-(a-1)),e-=a-1,a=0)):(r=n,i+=t.charAt(e-a),e-=a,a=0);return i};t.__arabicParser__.isArabicDiacritic=function(t){return void 0!==t&&void 0!==r[t.charCodeAt(0)]};var f=t.__arabicParser__.getCorrectForm=function(t,e,n){return s(t)?!1===a(t)?-1:!l(t)||!s(e)&&!s(n)||!s(n)&&o(e)||o(t)&&!s(e)||o(t)&&h(e)||o(t)&&o(e)?0:c(t)&&s(e)&&!o(e)&&s(n)&&l(n)?3:o(t)||!s(n)?1:2:-1},d=function(t){var n=0,r=0,i=0,a="",o="",h="",l=(t=t||"").split("\\s+"),c=[];for(n=0;n<l.length;n+=1){for(c.push(""),r=0;r<l[n].length;r+=1)a=l[n][r],o=l[n][r-1],h=l[n][r+1],s(a)?(i=f(a,o,h),c[n]+=-1!==i?String.fromCharCode(e[a.charCodeAt(0)][i]):a):c[n]+=a;c[n]=u(c[n])}return c.join(" ")},p=t.__arabicParser__.processArabic=t.processArabic=function(){var t,e="string"==typeof arguments[0]?arguments[0]:arguments[0].text,n=[];if(Array.isArray(e)){var r=0;for(n=[],r=0;r<e.length;r+=1)Array.isArray(e[r])?n.push([d(e[r][0]),e[r][1],e[r][2]]):n.push([d(e[r])]);t=n}else t=d(e);return"string"==typeof arguments[0]?t:(arguments[0].text=t,arguments[0])};t.events.push(["preProcessText",p])}(R.API),
/** @license
   * jsPDF Autoprint Plugin
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){t.autoPrint=function(t){var e;return(t=t||{}).variant=t.variant||"non-conform","javascript"===t.variant?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this}}(R.API),
/**
   * @license
   * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(e){t=e}});var e=150;Object.defineProperty(this,"width",{get:function(){return e},set:function(t){e=isNaN(t)||!1===Number.isInteger(t)||t<0?150:t,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=e+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(t){n=isNaN(t)||!1===Number.isInteger(t)||t<0?300:t,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var r=[];Object.defineProperty(this,"childNodes",{get:function(){return r},set:function(t){r=t}});var i={};Object.defineProperty(this,"style",{get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,e){var n;if("2d"!==(t=t||"2d"))return null;for(n in e)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=e[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(R.API),function(t){var e={left:0,top:0,bottom:0,right:0},n=!1,i=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var t=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var e=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var n=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return n},set:function(t){n=t}});var r=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return r},set:function(t){r=t}});var i=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return i},set:function(t){i=t}});var a=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return a},set:function(t){a=t}});var s=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return s},set:function(t){s=t}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(t){return i.call(this),this.internal.__cell__.headerFunction="function"==typeof t?t:void 0,this},t.getTextDimensions=function(t,e){i.call(this);var n=(e=e||{}).fontSize||this.getFontSize(),r=e.font||this.getFont(),a=e.scaleFactor||this.internal.scaleFactor,s=0,o=0,h=0,l=this;if(!Array.isArray(t)&&"string"!=typeof t){if("number"!=typeof t)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");t=String(t)}var c=e.maxWidth;c>0?"string"==typeof t?t=this.splitTextToSize(t,c):"[object Array]"===Object.prototype.toString.call(t)&&(t=t.reduce(function(t,e){return t.concat(l.splitTextToSize(e,c))},[])):t=Array.isArray(t)?t:[t];for(var u=0;u<t.length;u++)s<(h=this.getStringUnitWidth(t[u],{font:r})*n)&&(s=h);return 0!==s&&(o=t.length),{w:s/=a,h:Math.max((o*n*this.getLineHeightFactor()-n*(this.getLineHeightFactor()-1))/a,0)}},t.cellAddPage=function(){i.call(this),this.addPage();var t=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new s(t.left,t.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=t.cell=function(){var t;t=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),i.call(this);var r=this.internal.__cell__.lastCell,a=this.internal.__cell__.padding,o=this.internal.__cell__.margins||e,h=this.internal.__cell__.tableHeaderRow,l=this.internal.__cell__.printHeaders;return void 0!==r.lineNumber&&(r.lineNumber===t.lineNumber?(t.x=(r.x||0)+(r.width||0),t.y=r.y||0):r.y+r.height+t.height+o.bottom>this.getPageHeight()?(this.cellAddPage(),t.y=o.top,l&&h&&(this.printHeaderRow(t.lineNumber,!0),t.y+=h[0].height)):t.y=r.y+r.height||t.y),void 0!==t.text[0]&&(this.rect(t.x,t.y,t.width,t.height,!0===n?"FD":void 0),"right"===t.align?this.text(t.text,t.x+t.width-a,t.y+a,{align:"right",baseline:"top"}):"center"===t.align?this.text(t.text,t.x+t.width/2,t.y+a,{align:"center",baseline:"top",maxWidth:t.width-a-a}):this.text(t.text,t.x+a,t.y+a,{align:"left",baseline:"top",maxWidth:t.width-a-a})),this.internal.__cell__.lastCell=t,this};t.table=function(t,n,l,c,u){if(i.call(this),!l)throw new Error("No data for PDF table.");var f,d,p,g,m=[],b=[],v=[],w={},y={},_=[],x=[],A=(u=u||{}).autoSize||!1,L=!1!==u.printHeaders,N=u.css&&void 0!==u.css["font-size"]?16*u.css["font-size"]:u.fontSize||12,S=u.margins||Object.assign({width:this.getPageWidth()},e),k="number"==typeof u.padding?u.padding:3,P=u.headerBackgroundColor||"#c8c8c8",F=u.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=L,this.internal.__cell__.margins=S,this.internal.__cell__.table_font_size=N,this.internal.__cell__.padding=k,this.internal.__cell__.headerBackgroundColor=P,this.internal.__cell__.headerTextColor=F,this.setFontSize(N),null==c)b=m=Object.keys(l[0]),v=m.map(function(){return"left"});else if(Array.isArray(c)&&"object"===r(c[0]))for(m=c.map(function(t){return t.name}),b=c.map(function(t){return t.prompt||t.name||""}),v=c.map(function(t){return t.align||"left"}),f=0;f<c.length;f+=1)y[c[f].name]=.7499990551181103*c[f].width;else Array.isArray(c)&&"string"==typeof c[0]&&(b=m=c,v=m.map(function(){return"left"}));if(A||Array.isArray(c)&&"string"==typeof c[0])for(f=0;f<m.length;f+=1){for(w[g=m[f]]=l.map(function(t){return t[g]}),this.setFont(void 0,"bold"),_.push(this.getTextDimensions(b[f],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),d=w[g],this.setFont(void 0,"normal"),p=0;p<d.length;p+=1)_.push(this.getTextDimensions(d[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);y[g]=Math.max.apply(null,_)+k+k,_=[]}if(L){var I={};for(f=0;f<m.length;f+=1)I[m[f]]={},I[m[f]].text=b[f],I[m[f]].align=v[f];var C=h.call(this,I,y);x=m.map(function(e){return new s(t,n,y[e],C,I[e].text,void 0,I[e].align)}),this.setTableHeaderRow(x),this.printHeaderRow(1,!1)}var j=c.reduce(function(t,e){return t[e.name]=e.align,t},{});for(f=0;f<l.length;f+=1){"rowStart"in u&&u.rowStart instanceof Function&&u.rowStart({row:f,data:l[f]},this);var E=h.call(this,l[f],y);for(p=0;p<m.length;p+=1){var O=l[f][m[p]];"cellStart"in u&&u.cellStart instanceof Function&&u.cellStart({row:f,col:p,data:O},this),o.call(this,new s(t,n,y[m[p]],E,O,f+2,j[m[p]]))}}return this.internal.__cell__.table_x=t,this.internal.__cell__.table_y=n,this};var h=function(t,e){var n=this.internal.__cell__.padding,r=this.internal.__cell__.table_font_size,i=this.internal.scaleFactor;return Object.keys(t).map(function(r){var i=t[r];return this.splitTextToSize(i.hasOwnProperty("text")?i.text:i,e[r]-n-n)},this).map(function(t){return this.getLineHeightFactor()*t.length*r/i+n+n},this).reduce(function(t,e){return Math.max(t,e)},0)};t.setTableHeaderRow=function(t){i.call(this),this.internal.__cell__.tableHeaderRow=t},t.printHeaderRow=function(t,e){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var r;if(n=!0,"function"==typeof this.internal.__cell__.headerFunction){var a=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(a[0],a[1],a[2],a[3],void 0,-1)}this.setFont(void 0,"bold");for(var h=[],l=0;l<this.internal.__cell__.tableHeaderRow.length;l+=1){r=this.internal.__cell__.tableHeaderRow[l].clone(),e&&(r.y=this.internal.__cell__.margins.top||0,h.push(r)),r.lineNumber=t;var c=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,r),this.setTextColor(c)}h.length>0&&this.setTableHeaderRow(h),this.setFont(void 0,"normal"),n=!1}}(R.API);var Pt={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Ft=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],It=kt(Ft),Ct=[100,200,300,400,500,600,700,800,900],jt=kt(Ct);function Et(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),n=function(t){return Pt[t=t||"normal"]?t:"normal"}(t.style),r=function(t){return t?"number"==typeof t?t>=100&&t<=900&&t%100==0?t:400:/^\d00$/.test(t)?parseInt(t):"bold"===t?700:400:400}(t.weight),i=function(t){return"number"==typeof It[t=t||"normal"]?t:"normal"}(t.stretch);return{family:e,style:n,weight:r,stretch:i,src:t.src||[],ref:t.ref||{name:e,style:[i,n,r].join(" ")}}}function Ot(t,e,n,r){var i;for(i=n;i>=0&&i<e.length;i+=r)if(t[e[i]])return t[e[i]];for(i=n;i>=0&&i<e.length;i-=r)if(t[e[i]])return t[e[i]]}var Bt={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Mt={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Rt(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function Tt(t){return t.trimLeft()}function qt(t,e){for(var n=0;n<t.length;){if(t.charAt(n)===e)return[t.substring(0,n),t.substring(n+1)];n+=1}return null}function Dt(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===e?null:[e[0],t.substring(e[0].length)]}var zt=["times"];!function(t){var e,n,i,a,o,h,l,c,f,d=function(t){return t=t||{},this.isStrokeTransparent=t.isStrokeTransparent||!1,this.strokeOpacity=t.strokeOpacity||1,this.strokeStyle=t.strokeStyle||"#000000",this.fillStyle=t.fillStyle||"#000000",this.isFillTransparent=t.isFillTransparent||!1,this.fillOpacity=t.fillOpacity||1,this.font=t.font||"10px sans-serif",this.textBaseline=t.textBaseline||"alphabetic",this.textAlign=t.textAlign||"left",this.lineWidth=t.lineWidth||1,this.lineJoin=t.lineJoin||"miter",this.lineCap=t.lineCap||"butt",this.path=t.path||[],this.transform=void 0!==t.transform?t.transform.clone():new c,this.globalCompositeOperation=t.globalCompositeOperation||"normal",this.globalAlpha=t.globalAlpha||1,this.clip_path=t.clip_path||[],this.currentPoint=t.currentPoint||new h,this.miterLimit=t.miterLimit||10,this.lastPoint=t.lastPoint||new h,this.lineDashOffset=t.lineDashOffset||0,this.lineDash=t.lineDash||[],this.margin=t.margin||[0,0,0,0],this.prevPageLastElemOffset=t.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof t.ignoreClearRect||t.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new p(this),e=this.internal.f2,n=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,h=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,f=new d}]);var p=function(t){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var e=t;Object.defineProperty(this,"pdf",{get:function(){return e}});var n=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return n},set:function(t){n=Boolean(t)}});var r=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return r},set:function(t){r=Boolean(t)}});var i=0;Object.defineProperty(this,"posX",{get:function(){return i},set:function(t){isNaN(t)||(i=t)}});var a=0;Object.defineProperty(this,"posY",{get:function(){return a},set:function(t){isNaN(t)||(a=t)}}),Object.defineProperty(this,"margin",{get:function(){return f.margin},set:function(t){var e;"number"==typeof t?e=[t,t,t,t]:((e=new Array(4))[0]=t[0],e[1]=t.length>=2?t[1]:e[0],e[2]=t.length>=3?t[2]:e[0],e[3]=t.length>=4?t[3]:e[1]),f.margin=e}});var s=!1;Object.defineProperty(this,"autoPaging",{get:function(){return s},set:function(t){s=t}});var o=0;Object.defineProperty(this,"lastBreak",{get:function(){return o},set:function(t){o=t}});var h=[];Object.defineProperty(this,"pageBreaks",{get:function(){return h},set:function(t){h=t}}),Object.defineProperty(this,"ctx",{get:function(){return f},set:function(t){t instanceof d&&(f=t)}}),Object.defineProperty(this,"path",{get:function(){return f.path},set:function(t){f.path=t}});var l=[];Object.defineProperty(this,"ctxStack",{get:function(){return l},set:function(t){l=t}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(t){var e;e=g(t),this.ctx.fillStyle=e.style,this.ctx.isFillTransparent=0===e.a,this.ctx.fillOpacity=e.a,this.pdf.setFillColor(e.r,e.g,e.b,{a:e.a}),this.pdf.setTextColor(e.r,e.g,e.b,{a:e.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(t){var e=g(t);this.ctx.strokeStyle=e.style,this.ctx.isStrokeTransparent=0===e.a,this.ctx.strokeOpacity=e.a,0===e.a?this.pdf.setDrawColor(255,255,255):(e.a,this.pdf.setDrawColor(e.r,e.g,e.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(t){-1!==["butt","round","square"].indexOf(t)&&(this.ctx.lineCap=t,this.pdf.setLineCap(t))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(t){isNaN(t)||(this.ctx.lineWidth=t,this.pdf.setLineWidth(t))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(t){-1!==["bevel","round","miter"].indexOf(t)&&(this.ctx.lineJoin=t,this.pdf.setLineJoin(t))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(t){isNaN(t)||(this.ctx.miterLimit=t,this.pdf.setMiterLimit(t))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(t){this.ctx.textBaseline=t}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(t){-1!==["right","end","center","left","start"].indexOf(t)&&(this.ctx.textAlign=t)}});var c=null,u=null;var p=null;Object.defineProperty(this,"fontFaces",{get:function(){return p},set:function(t){c=null,u=null,p=t}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(t){var e;if(this.ctx.font=t,null!==(e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(t))){var n=e[1];e[2];var r=e[3],i=e[4];e[5];var a=e[6],s=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(i)[2];i="px"===s?Math.floor(parseFloat(i)*this.pdf.internal.scaleFactor):"em"===s?Math.floor(parseFloat(i)*this.pdf.getFontSize()):Math.floor(parseFloat(i)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(i);var o=function(t){var e,n,r=[],i=t.trim();if(""===i)return zt;if(i in Mt)return[Mt[i]];for(;""!==i;){switch(n=null,e=(i=Tt(i)).charAt(0)){case'"':case"'":n=qt(i.substring(1),e);break;default:n=Dt(i)}if(null===n)return zt;if(r.push(n[0]),""!==(i=Tt(n[1]))&&","!==i.charAt(0))return zt;i=i.replace(/^,/,"")}return r}(a);if(this.fontFaces){var h=function(t,e){var n=t.getFontList(),r=JSON.stringify(n);if(null===c||u!==r){var i=function(t){var e=[];return Object.keys(t).forEach(function(n){t[n].forEach(function(t){var r=null;switch(t){case"bold":r={family:n,weight:"bold"};break;case"italic":r={family:n,style:"italic"};break;case"bolditalic":r={family:n,weight:"bold",style:"italic"};break;case"":case"normal":r={family:n}}null!==r&&(r.ref={name:n,style:t},e.push(r))})}),e}(n);c=function(t){for(var e={},n=0;n<t.length;++n){var r=Et(t[n]),i=r.family,a=r.stretch,s=r.style,o=r.weight;e[i]=e[i]||{},e[i][a]=e[i][a]||{},e[i][a][s]=e[i][a][s]||{},e[i][a][s][o]=r}return e}(i.concat(e)),u=r}return c}(this.pdf,this.fontFaces),l=o.map(function(t){return{family:t,stretch:"normal",weight:r,style:n}}),f=function(t,e,n){for(var r=(n=n||{}).defaultFontFamily||"times",i=Object.assign({},Bt,n.genericFontFamilies||{}),a=null,s=null,o=0;o<e.length;++o)if(i[(a=Et(e[o])).family]&&(a.family=i[a.family]),t.hasOwnProperty(a.family)){s=t[a.family];break}if(!(s=s||t[r]))throw new Error("Could not find a font-family for the rule '"+Rt(a)+"' and default family '"+r+"'.");if(s=function(t,e){if(e[t])return e[t];var n=It[t],r=n<=It.normal?-1:1,i=Ot(e,Ft,n,r);if(!i)throw new Error("Could not find a matching font-stretch value for "+t);return i}(a.stretch,s),s=function(t,e){if(e[t])return e[t];for(var n=Pt[t],r=0;r<n.length;++r)if(e[n[r]])return e[n[r]];throw new Error("Could not find a matching font-style for "+t)}(a.style,s),!(s=function(t,e){if(e[t])return e[t];if(400===t&&e[500])return e[500];if(500===t&&e[400])return e[400];var n=jt[t],r=Ot(e,Ct,n,t<400?-1:1);if(!r)throw new Error("Could not find a matching font-weight for value "+t);return r}(a.weight,s)))throw new Error("Failed to resolve a font for the rule '"+Rt(a)+"'.");return s}(h,l);this.pdf.setFont(f.ref.name,f.ref.style)}else{var d="";("bold"===r||parseInt(r,10)>=700||"bold"===n)&&(d="bold"),"italic"===n&&(d+="italic"),0===d.length&&(d="normal");for(var p="",g={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},m=0;m<o.length;m++){if(void 0!==this.pdf.internal.getFont(o[m],d,{noFallback:!0,disableWarning:!0})){p=o[m];break}if("bolditalic"===d&&void 0!==this.pdf.internal.getFont(o[m],"bold",{noFallback:!0,disableWarning:!0}))p=o[m],d="bold";else if(void 0!==this.pdf.internal.getFont(o[m],"normal",{noFallback:!0,disableWarning:!0})){p=o[m],d="normal";break}}if(""===p)for(var b=0;b<o.length;b++)if(g[o[b]]){p=g[o[b]];break}p=""===p?"Times":p,this.pdf.setFont(p,d)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(t){this.ctx.globalCompositeOperation=t}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(t){this.ctx.globalAlpha=t}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(t){this.ctx.lineDashOffset=t,D.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(t){this.ctx.lineDash=t,D.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(t){this.ctx.ignoreClearRect=Boolean(t)}})};p.prototype.setLineDash=function(t){this.lineDash=t},p.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},p.prototype.fill=function(){A.call(this,"fill",!1)},p.prototype.stroke=function(){A.call(this,"stroke",!1)},p.prototype.beginPath=function(){this.path=[{type:"begin"}]},p.prototype.moveTo=function(t,e){if(isNaN(t)||isNaN(e))throw s.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var n=this.ctx.transform.applyToPoint(new h(t,e));this.path.push({type:"mt",x:n.x,y:n.y}),this.ctx.lastPoint=new h(t,e)},p.prototype.closePath=function(){var t=new h(0,0),e=0;for(e=this.path.length-1;-1!==e;e--)if("begin"===this.path[e].type&&"object"===r(this.path[e+1])&&"number"==typeof this.path[e+1].x){t=new h(this.path[e+1].x,this.path[e+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new h(t.x,t.y)},p.prototype.lineTo=function(t,e){if(isNaN(t)||isNaN(e))throw s.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var n=this.ctx.transform.applyToPoint(new h(t,e));this.path.push({type:"lt",x:n.x,y:n.y}),this.ctx.lastPoint=new h(n.x,n.y)},p.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),A.call(this,null,!0)},p.prototype.quadraticCurveTo=function(t,e,n,r){if(isNaN(n)||isNaN(r)||isNaN(t)||isNaN(e))throw s.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var i=this.ctx.transform.applyToPoint(new h(n,r)),a=this.ctx.transform.applyToPoint(new h(t,e));this.path.push({type:"qct",x1:a.x,y1:a.y,x:i.x,y:i.y}),this.ctx.lastPoint=new h(i.x,i.y)},p.prototype.bezierCurveTo=function(t,e,n,r,i,a){if(isNaN(i)||isNaN(a)||isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r))throw s.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var o=this.ctx.transform.applyToPoint(new h(i,a)),l=this.ctx.transform.applyToPoint(new h(t,e)),c=this.ctx.transform.applyToPoint(new h(n,r));this.path.push({type:"bct",x1:l.x,y1:l.y,x2:c.x,y2:c.y,x:o.x,y:o.y}),this.ctx.lastPoint=new h(o.x,o.y)},p.prototype.arc=function(t,e,n,r,i,a){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||isNaN(i))throw s.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(a=Boolean(a),!this.ctx.transform.isIdentity){var o=this.ctx.transform.applyToPoint(new h(t,e));t=o.x,e=o.y;var l=this.ctx.transform.applyToPoint(new h(0,n)),c=this.ctx.transform.applyToPoint(new h(0,0));n=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2))}Math.abs(i-r)>=2*Math.PI&&(r=0,i=2*Math.PI),this.path.push({type:"arc",x:t,y:e,radius:n,startAngle:r,endAngle:i,counterclockwise:a})},p.prototype.arcTo=function(t,e,n,r,i){throw new Error("arcTo not implemented.")},p.prototype.rect=function(t,e,n,r){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r))throw s.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+r),this.lineTo(t,e+r),this.lineTo(t,e),this.lineTo(t+n,e),this.lineTo(t,e)},p.prototype.fillRect=function(t,e,n,r){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r))throw s.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!m.call(this)){var i={};"butt"!==this.lineCap&&(i.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(i.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(t,e,n,r),this.fill(),i.hasOwnProperty("lineCap")&&(this.lineCap=i.lineCap),i.hasOwnProperty("lineJoin")&&(this.lineJoin=i.lineJoin)}},p.prototype.strokeRect=function(t,e,n,r){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r))throw s.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");b.call(this)||(this.beginPath(),this.rect(t,e,n,r),this.stroke())},p.prototype.clearRect=function(t,e,n,r){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r))throw s.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(t,e,n,r))},p.prototype.save=function(t){t="boolean"!=typeof t||t;for(var e=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("q");if(this.pdf.setPage(e),t){this.ctx.fontSize=this.pdf.internal.getFontSize();var r=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=r}},p.prototype.restore=function(t){t="boolean"!=typeof t||t;for(var e=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("Q");this.pdf.setPage(e),t&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},p.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var g=function(t){var e,n,r,i;if(!0===t.isCanvasGradient&&(t=t.getColor()),!t)return{r:0,g:0,b:0,a:0,style:t};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(t))e=0,n=0,r=0,i=0;else{var a=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(t);if(null!==a)e=parseInt(a[1]),n=parseInt(a[2]),r=parseInt(a[3]),i=1;else if(null!==(a=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(t)))e=parseInt(a[1]),n=parseInt(a[2]),r=parseInt(a[3]),i=parseFloat(a[4]);else{if(i=1,"string"==typeof t&&"#"!==t.charAt(0)){var s=new u(t);t=s.ok?s.toHex():"#000000"}4===t.length?(e=t.substring(1,2),e+=e,n=t.substring(2,3),n+=n,r=t.substring(3,4),r+=r):(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7)),e=parseInt(e,16),n=parseInt(n,16),r=parseInt(r,16)}}return{r:e,g:n,b:r,a:i,style:t}},m=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},b=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};p.prototype.fillText=function(t,e,n,r){if(isNaN(e)||isNaN(n)||"string"!=typeof t)throw s.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(r=isNaN(r)?void 0:r,!m.call(this)){var i=R(this.ctx.transform.rotation),a=this.ctx.transform.scaleX;C.call(this,{text:t,x:e,y:n,scale:a,angle:i,align:this.textAlign,maxWidth:r})}},p.prototype.strokeText=function(t,e,n,r){if(isNaN(e)||isNaN(n)||"string"!=typeof t)throw s.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!b.call(this)){r=isNaN(r)?void 0:r;var i=R(this.ctx.transform.rotation),a=this.ctx.transform.scaleX;C.call(this,{text:t,x:e,y:n,scale:a,renderingMode:"stroke",angle:i,align:this.textAlign,maxWidth:r})}},p.prototype.measureText=function(t){if("string"!=typeof t)throw s.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var e=this.pdf,n=this.pdf.internal.scaleFactor,r=e.internal.getFontSize(),i=e.getStringUnitWidth(t)*r/e.internal.scaleFactor;return new function(t){var e=(t=t||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return e}}),this}({width:i*=Math.round(96*n/72*1e4)/1e4})},p.prototype.scale=function(t,e){if(isNaN(t)||isNaN(e))throw s.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var n=new c(t,0,0,e,0,0);this.ctx.transform=this.ctx.transform.multiply(n)},p.prototype.rotate=function(t){if(isNaN(t))throw s.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var e=new c(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0);this.ctx.transform=this.ctx.transform.multiply(e)},p.prototype.translate=function(t,e){if(isNaN(t)||isNaN(e))throw s.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var n=new c(1,0,0,1,t,e);this.ctx.transform=this.ctx.transform.multiply(n)},p.prototype.transform=function(t,e,n,r,i,a){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a))throw s.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var o=new c(t,e,n,r,i,a);this.ctx.transform=this.ctx.transform.multiply(o)},p.prototype.setTransform=function(t,e,n,r,i,a){t=isNaN(t)?1:t,e=isNaN(e)?0:e,n=isNaN(n)?0:n,r=isNaN(r)?1:r,i=isNaN(i)?0:i,a=isNaN(a)?0:a,this.ctx.transform=new c(t,e,n,r,i,a)};var v=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};p.prototype.drawImage=function(t,e,n,r,i,a,s,o,h){var u=this.pdf.getImageProperties(t),f=1,d=1,p=1,g=1;void 0!==r&&void 0!==o&&(p=o/r,g=h/i,f=u.width/r*o/r,d=u.height/i*h/i),void 0===a&&(a=e,s=n,e=0,n=0),void 0!==r&&void 0===o&&(o=r,h=i),void 0===r&&void 0===o&&(o=u.width,h=u.height);var m=this.ctx.transform.decompose(),b=R(m.rotate.shx),y=new c,A=(y=(y=(y=y.multiply(m.translate)).multiply(m.skew)).multiply(m.scale)).applyToRectangle(new l(a-e*p,s-n*g,r*f,i*d));if(this.autoPaging){for(var N,S=w.call(this,A),k=[],P=0;P<S.length;P+=1)-1===k.indexOf(S[P])&&k.push(S[P]);x(k);for(var F=k[0],I=k[k.length-1],C=F;C<I+1;C++){this.pdf.setPage(C);var j=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],E=1===C?this.posY+this.margin[0]:this.margin[0],O=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],B=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],M=1===C?0:O+(C-2)*B;if(0!==this.ctx.clip_path.length){var T=this.path;N=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(N,this.posX+this.margin[3],-M+E+this.ctx.prevPageLastElemOffset),L.call(this,"fill",!0),this.path=T}var q=JSON.parse(JSON.stringify(A));q=_([q],this.posX+this.margin[3],-M+E+this.ctx.prevPageLastElemOffset)[0];var D=(C>F||C<I)&&v.call(this);D&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],j,B,null).clip().discardPath()),this.pdf.addImage(t,"JPEG",q.x,q.y,q.w,q.h,null,null,b),D&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(t,"JPEG",A.x,A.y,A.w,A.h,null,null,b)};var w=function(t,e,n){var r=[];e=e||this.pdf.internal.pageSize.width,n=n||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var i=this.posY+this.ctx.prevPageLastElemOffset;switch(t.type){default:case"mt":case"lt":r.push(Math.floor((t.y+i)/n)+1);break;case"arc":r.push(Math.floor((t.y+i-t.radius)/n)+1),r.push(Math.floor((t.y+i+t.radius)/n)+1);break;case"qct":var a=T(this.ctx.lastPoint.x,this.ctx.lastPoint.y,t.x1,t.y1,t.x,t.y);r.push(Math.floor((a.y+i)/n)+1),r.push(Math.floor((a.y+a.h+i)/n)+1);break;case"bct":var s=q(this.ctx.lastPoint.x,this.ctx.lastPoint.y,t.x1,t.y1,t.x2,t.y2,t.x,t.y);r.push(Math.floor((s.y+i)/n)+1),r.push(Math.floor((s.y+s.h+i)/n)+1);break;case"rect":r.push(Math.floor((t.y+i)/n)+1),r.push(Math.floor((t.y+t.h+i)/n)+1)}for(var o=0;o<r.length;o+=1)for(;this.pdf.internal.getNumberOfPages()<r[o];)y.call(this);return r},y=function(){var t=this.fillStyle,e=this.strokeStyle,n=this.font,r=this.lineCap,i=this.lineWidth,a=this.lineJoin;this.pdf.addPage(),this.fillStyle=t,this.strokeStyle=e,this.font=n,this.lineCap=r,this.lineWidth=i,this.lineJoin=a},_=function(t,e,n){for(var r=0;r<t.length;r++)switch(t[r].type){case"bct":t[r].x2+=e,t[r].y2+=n;case"qct":t[r].x1+=e,t[r].y1+=n;default:t[r].x+=e,t[r].y+=n}return t},x=function(t){return t.sort(function(t,e){return t-e})},A=function(t,e){var n=this.fillStyle,r=this.strokeStyle,i=this.lineCap,a=this.lineWidth,s=Math.abs(a*this.ctx.transform.scaleX),o=this.lineJoin;if(this.autoPaging){for(var h,l,c=JSON.parse(JSON.stringify(this.path)),u=JSON.parse(JSON.stringify(this.path)),f=[],d=0;d<u.length;d++)if(void 0!==u[d].x)for(var p=w.call(this,u[d]),g=0;g<p.length;g+=1)-1===f.indexOf(p[g])&&f.push(p[g]);for(var m=0;m<f.length;m++)for(;this.pdf.internal.getNumberOfPages()<f[m];)y.call(this);x(f);for(var b=f[0],A=f[f.length-1],N=b;N<A+1;N++){this.pdf.setPage(N),this.fillStyle=n,this.strokeStyle=r,this.lineCap=i,this.lineWidth=s,this.lineJoin=o;var S=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],k=1===N?this.posY+this.margin[0]:this.margin[0],P=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],F=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],I=1===N?0:P+(N-2)*F;if(0!==this.ctx.clip_path.length){var C=this.path;h=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(h,this.posX+this.margin[3],-I+k+this.ctx.prevPageLastElemOffset),L.call(this,t,!0),this.path=C}if(l=JSON.parse(JSON.stringify(c)),this.path=_(l,this.posX+this.margin[3],-I+k+this.ctx.prevPageLastElemOffset),!1===e||0===N){var j=(N>b||N<A)&&v.call(this);j&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],S,F,null).clip().discardPath()),L.call(this,t,e),j&&this.pdf.restoreGraphicsState()}this.lineWidth=a}this.path=c}else this.lineWidth=s,L.call(this,t,e),this.lineWidth=a},L=function(t,e){if(("stroke"!==t||e||!b.call(this))&&("stroke"===t||e||!m.call(this))){for(var n,r,i=[],a=this.path,s=0;s<a.length;s++){var o=a[s];switch(o.type){case"begin":i.push({begin:!0});break;case"close":i.push({close:!0});break;case"mt":i.push({start:o,deltas:[],abs:[]});break;case"lt":var h=i.length;if(a[s-1]&&!isNaN(a[s-1].x)&&(n=[o.x-a[s-1].x,o.y-a[s-1].y],h>0))for(;h>=0;h--)if(!0!==i[h-1].close&&!0!==i[h-1].begin){i[h-1].deltas.push(n),i[h-1].abs.push(o);break}break;case"bct":n=[o.x1-a[s-1].x,o.y1-a[s-1].y,o.x2-a[s-1].x,o.y2-a[s-1].y,o.x-a[s-1].x,o.y-a[s-1].y],i[i.length-1].deltas.push(n);break;case"qct":var l=a[s-1].x+2/3*(o.x1-a[s-1].x),c=a[s-1].y+2/3*(o.y1-a[s-1].y),u=o.x+2/3*(o.x1-o.x),f=o.y+2/3*(o.y1-o.y),d=o.x,p=o.y;n=[l-a[s-1].x,c-a[s-1].y,u-a[s-1].x,f-a[s-1].y,d-a[s-1].x,p-a[s-1].y],i[i.length-1].deltas.push(n);break;case"arc":i.push({deltas:[],abs:[],arc:!0}),Array.isArray(i[i.length-1].abs)&&i[i.length-1].abs.push(o)}}r=e?null:"stroke"===t?"stroke":"fill";for(var g=!1,v=0;v<i.length;v++)if(i[v].arc)for(var w=i[v].abs,y=0;y<w.length;y++){var _=w[y];"arc"===_.type?k.call(this,_.x,_.y,_.radius,_.startAngle,_.endAngle,_.counterclockwise,void 0,e,!g):j.call(this,_.x,_.y),g=!0}else if(!0===i[v].close)this.pdf.internal.out("h"),g=!1;else if(!0!==i[v].begin){var x=i[v].start.x,A=i[v].start.y;E.call(this,i[v].deltas,x,A),g=!0}r&&P.call(this,r),e&&F.call(this)}},N=function(t){var e=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,n=e*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return t-n;case"top":return t+e-n;case"hanging":return t+e-2*n;case"middle":return t+e/2-n;default:return t}},S=function(t){return t+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};p.prototype.createLinearGradient=function(){var t=function(){};return t.colorStops=[],t.addColorStop=function(t,e){this.colorStops.push([t,e])},t.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},t.isCanvasGradient=!0,t},p.prototype.createPattern=function(){return this.createLinearGradient()},p.prototype.createRadialGradient=function(){return this.createLinearGradient()};var k=function(t,e,n,r,i,a,s,o,h){for(var l=B.call(this,n,r,i,a),c=0;c<l.length;c++){var u=l[c];0===c&&(h?I.call(this,u.x1+t,u.y1+e):j.call(this,u.x1+t,u.y1+e)),O.call(this,t,e,u.x2,u.y2,u.x3,u.y3,u.x4,u.y4)}o?F.call(this):P.call(this,s)},P=function(t){switch(t){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},F=function(){this.pdf.clip(),this.pdf.discardPath()},I=function(t,e){this.pdf.internal.out(n(t)+" "+i(e)+" m")},C=function(t){var e;switch(t.align){case"right":case"end":e="right";break;case"center":e="center";break;default:e="left"}var n,r,i,a=this.pdf.getTextDimensions(t.text),s=N.call(this,t.y),o=S.call(this,s)-a.h,u=this.ctx.transform.applyToPoint(new h(t.x,s));if(this.autoPaging){var f=this.ctx.transform.decompose(),d=new c;d=(d=(d=d.multiply(f.translate)).multiply(f.skew)).multiply(f.scale);for(var p=this.ctx.transform.applyToRectangle(new l(t.x,s,a.w,a.h)),g=d.applyToRectangle(new l(t.x,o,a.w,a.h)),m=w.call(this,g),b=[],y=0;y<m.length;y+=1)-1===b.indexOf(m[y])&&b.push(m[y]);x(b);for(var A=b[0],k=b[b.length-1],P=A;P<k+1;P++){this.pdf.setPage(P);var F=1===P?this.posY+this.margin[0]:this.margin[0],I=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],C=this.pdf.internal.pageSize.height-this.margin[2],j=C-this.margin[0],E=this.pdf.internal.pageSize.width-this.margin[1],O=E-this.margin[3],B=1===P?0:I+(P-2)*j;if(0!==this.ctx.clip_path.length){var M=this.path;n=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=_(n,this.posX+this.margin[3],-1*B+F),L.call(this,"fill",!0),this.path=M}var R=_([JSON.parse(JSON.stringify(g))],this.posX+this.margin[3],-B+F+this.ctx.prevPageLastElemOffset)[0];t.scale>=.01&&(r=this.pdf.internal.getFontSize(),this.pdf.setFontSize(r*t.scale),i=this.lineWidth,this.lineWidth=i*t.scale);var T="text"!==this.autoPaging;if(T||R.y+R.h<=C){if(T||R.y>=F&&R.x<=E){var q=T?t.text:this.pdf.splitTextToSize(t.text,t.maxWidth||E-R.x)[0],D=_([JSON.parse(JSON.stringify(p))],this.posX+this.margin[3],-B+F+this.ctx.prevPageLastElemOffset)[0],z=T&&(P>A||P<k)&&v.call(this);z&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],O,j,null).clip().discardPath()),this.pdf.text(q,D.x,D.y,{angle:t.angle,align:e,renderingMode:t.renderingMode}),z&&this.pdf.restoreGraphicsState()}}else R.y<C&&(this.ctx.prevPageLastElemOffset+=C-R.y);t.scale>=.01&&(this.pdf.setFontSize(r),this.lineWidth=i)}}else t.scale>=.01&&(r=this.pdf.internal.getFontSize(),this.pdf.setFontSize(r*t.scale),i=this.lineWidth,this.lineWidth=i*t.scale),this.pdf.text(t.text,u.x+this.posX,u.y+this.posY,{angle:t.angle,align:e,renderingMode:t.renderingMode,maxWidth:t.maxWidth}),t.scale>=.01&&(this.pdf.setFontSize(r),this.lineWidth=i)},j=function(t,e,r,a){r=r||0,a=a||0,this.pdf.internal.out(n(t+r)+" "+i(e+a)+" l")},E=function(t,e,n){return this.pdf.lines(t,e,n,null,null)},O=function(t,n,r,i,s,h,l,c){this.pdf.internal.out([e(a(r+t)),e(o(i+n)),e(a(s+t)),e(o(h+n)),e(a(l+t)),e(o(c+n)),"c"].join(" "))},B=function(t,e,n,r){for(var i=2*Math.PI,a=Math.PI/2;e>n;)e-=i;var s=Math.abs(n-e);s<i&&r&&(s=i-s);for(var o=[],h=r?-1:1,l=e;s>1e-5;){var c=l+h*Math.min(s,a);o.push(M.call(this,t,l,c)),s-=Math.abs(c-l),l=c}return o},M=function(t,e,n){var r=(n-e)/2,i=t*Math.cos(r),a=t*Math.sin(r),s=i,o=-a,h=s*s+o*o,l=h+s*i+o*a,c=4/3*(Math.sqrt(2*h*l)-l)/(s*a-o*i),u=s-c*o,f=o+c*s,d=u,p=-f,g=r+e,m=Math.cos(g),b=Math.sin(g);return{x1:t*Math.cos(e),y1:t*Math.sin(e),x2:u*m-f*b,y2:u*b+f*m,x3:d*m-p*b,y3:d*b+p*m,x4:t*Math.cos(n),y4:t*Math.sin(n)}},R=function(t){return 180*t/Math.PI},T=function(t,e,n,r,i,a){var s=t+.5*(n-t),o=e+.5*(r-e),h=i+.5*(n-i),c=a+.5*(r-a),u=Math.min(t,i,s,h),f=Math.max(t,i,s,h),d=Math.min(e,a,o,c),p=Math.max(e,a,o,c);return new l(u,d,f-u,p-d)},q=function(t,e,n,r,i,a,s,o){var h,c,u,f,d,p,g,m,b,v,w,y,_,x,A=n-t,L=r-e,N=i-n,S=a-r,k=s-i,P=o-a;for(c=0;c<41;c++)b=(g=(u=t+(h=c/40)*A)+h*((d=n+h*N)-u))+h*(d+h*(i+h*k-d)-g),v=(m=(f=e+h*L)+h*((p=r+h*S)-f))+h*(p+h*(a+h*P-p)-m),0==c?(w=b,y=v,_=b,x=v):(w=Math.min(w,b),y=Math.min(y,v),_=Math.max(_,b),x=Math.max(x,v));return new l(Math.round(w),Math.round(y),Math.round(_-w),Math.round(x-y))},D=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var t,e,n=(t=this.ctx.lineDash,e=this.ctx.lineDashOffset,JSON.stringify({lineDash:t,lineDashOffset:e}));this.prevLineDash!==n&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=n)}}}(R.API);var Ut=Uint8Array,Ht=Uint16Array,Wt=Int32Array,Vt=new Ut([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Gt=new Ut([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Yt=new Ut([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zt=function(t,e){for(var n=new Ht(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new Wt(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return{b:n,r:i}},Jt=Zt(Vt,2),Xt=Jt.b,Kt=Jt.r;Xt[28]=258,Kt[258]=28;for(var $t=Zt(Gt,0).r,Qt=new Ht(32768),te=0;te<32768;++te){var ee=(43690&te)>>1|(21845&te)<<1;ee=(61680&(ee=(52428&ee)>>2|(13107&ee)<<2))>>4|(3855&ee)<<4,Qt[te]=((65280&ee)>>8|(255&ee)<<8)>>1}var ne=function(t,e,n){for(var r=t.length,i=0,a=new Ht(e);i<r;++i)t[i]&&++a[t[i]-1];var s,o=new Ht(e);for(i=1;i<e;++i)o[i]=o[i-1]+a[i-1]<<1;if(n){s=new Ht(1<<e);var h=15-e;for(i=0;i<r;++i)if(t[i])for(var l=i<<4|t[i],c=e-t[i],u=o[t[i]-1]++<<c,f=u|(1<<c)-1;u<=f;++u)s[Qt[u]>>h]=l}else for(s=new Ht(r),i=0;i<r;++i)t[i]&&(s[i]=Qt[o[t[i]-1]++]>>15-t[i]);return s},re=new Ut(288);for(te=0;te<144;++te)re[te]=8;for(te=144;te<256;++te)re[te]=9;for(te=256;te<280;++te)re[te]=7;for(te=280;te<288;++te)re[te]=8;var ie=new Ut(32);for(te=0;te<32;++te)ie[te]=5;var ae=ne(re,9,0),se=ne(ie,5,0),oe=function(t){return(t+7)/8|0},he=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},le=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},ce=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,a=n.slice();if(!i)return{t:be,l:0};if(1==i){var s=new Ut(n[0].s+1);return s[n[0].s]=1,{t:s,l:1}}n.sort(function(t,e){return t.f-e.f}),n.push({s:-1,f:25001});var o=n[0],h=n[1],l=0,c=1,u=2;for(n[0]={s:-1,f:o.f+h.f,l:o,r:h};c!=i-1;)o=n[n[l].f<n[u].f?l++:u++],h=n[l!=c&&n[l].f<n[u].f?l++:u++],n[c++]={s:-1,f:o.f+h.f,l:o,r:h};var f=a[0].s;for(r=1;r<i;++r)a[r].s>f&&(f=a[r].s);var d=new Ht(f+1),p=ue(n[c-1],d,0);if(p>e){r=0;var g=0,m=p-e,b=1<<m;for(a.sort(function(t,e){return d[e.s]-d[t.s]||t.f-e.f});r<i;++r){var v=a[r].s;if(!(d[v]>e))break;g+=b-(1<<p-d[v]),d[v]=e}for(g>>=m;g>0;){var w=a[r].s;d[w]<e?g-=1<<e-d[w]++-1:++r}for(;r>=0&&g;--r){var y=a[r].s;d[y]==e&&(--d[y],++g)}p=e}return{t:new Ut(d),l:p}},ue=function(t,e,n){return-1==t.s?Math.max(ue(t.l,e,n+1),ue(t.r,e,n+1)):e[t.s]=n},fe=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Ht(++e),r=0,i=t[0],a=1,s=function(t){n[r++]=t},o=1;o<=e;++o)if(t[o]==i&&o!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(i),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(i);a=1,i=t[o]}return{c:n.subarray(0,r),n:e}},de=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},pe=function(t,e,n){var r=n.length,i=oe(e+2);t[i]=255&r,t[i+1]=r>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var a=0;a<r;++a)t[i+a+4]=n[a];return 8*(i+4+r)},ge=function(t,e,n,r,i,a,s,o,h,l,c){he(e,c++,n),++i[256];for(var u=ce(i,15),f=u.t,d=u.l,p=ce(a,15),g=p.t,m=p.l,b=fe(f),v=b.c,w=b.n,y=fe(g),_=y.c,x=y.n,A=new Ht(19),L=0;L<v.length;++L)++A[31&v[L]];for(L=0;L<_.length;++L)++A[31&_[L]];for(var N=ce(A,7),S=N.t,k=N.l,P=19;P>4&&!S[Yt[P-1]];--P);var F,I,C,j,E=l+5<<3,O=de(i,re)+de(a,ie)+s,B=de(i,f)+de(a,g)+s+14+3*P+de(A,S)+2*A[16]+3*A[17]+7*A[18];if(h>=0&&E<=O&&E<=B)return pe(e,c,t.subarray(h,h+l));if(he(e,c,1+(B<O)),c+=2,B<O){F=ne(f,d,0),I=f,C=ne(g,m,0),j=g;var M=ne(S,k,0);for(he(e,c,w-257),he(e,c+5,x-1),he(e,c+10,P-4),c+=14,L=0;L<P;++L)he(e,c+3*L,S[Yt[L]]);c+=3*P;for(var R=[v,_],T=0;T<2;++T){var q=R[T];for(L=0;L<q.length;++L){var D=31&q[L];he(e,c,M[D]),c+=S[D],D>15&&(he(e,c,q[L]>>5&127),c+=q[L]>>12)}}}else F=ae,I=re,C=se,j=ie;for(L=0;L<o;++L){var z=r[L];if(z>255){le(e,c,F[257+(D=z>>18&31)]),c+=I[D+257],D>7&&(he(e,c,z>>23&31),c+=Vt[D]);var U=31&z;le(e,c,C[U]),c+=j[U],U>3&&(le(e,c,z>>5&8191),c+=Gt[U])}else le(e,c,F[z]),c+=I[z]}return le(e,c,F[256]),c+I[256]},me=new Wt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),be=new Ut(0),ve=function(){var t=1,e=0;return{p:function(n){for(var r=t,i=e,a=0|n.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)i+=r+=n[s];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}t=r,e=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(e%=65521))<<8|e>>8}}},we=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function ye(t,e){e||(e={});var n=ve();n.p(t);var r=function(t,e,n,r,i){if(!i&&(i={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),s=new Ut(a.length+t.length);s.set(a),s.set(t,a.length),t=s,i.w=a.length}return function(t,e,n,r,i,a){var s=a.z||t.length,o=new Ut(r+s+5*(1+Math.ceil(s/7e3))+i),h=o.subarray(r,o.length-i),l=a.l,c=7&(a.r||0);if(e){c&&(h[0]=a.r>>3);for(var u=me[e-1],f=u>>13,d=8191&u,p=(1<<n)-1,g=a.p||new Ht(32768),m=a.h||new Ht(p+1),b=Math.ceil(n/3),v=2*b,w=function(e){return(t[e]^t[e+1]<<b^t[e+2]<<v)&p},y=new Wt(25e3),_=new Ht(288),x=new Ht(32),A=0,L=0,N=a.i||0,S=0,k=a.w||0,P=0;N+2<s;++N){var F=w(N),I=32767&N,C=m[F];if(g[I]=C,m[F]=I,k<=N){var j=s-N;if((A>7e3||S>24576)&&(j>423||!l)){c=ge(t,h,0,y,_,x,L,S,P,N-P,c),S=A=L=0,P=N;for(var E=0;E<286;++E)_[E]=0;for(E=0;E<30;++E)x[E]=0}var O=2,B=0,M=d,R=I-C&32767;if(j>2&&F==w(N-R))for(var T=Math.min(f,j)-1,q=Math.min(32767,N),D=Math.min(258,j);R<=q&&--M&&I!=C;){if(t[N+O]==t[N+O-R]){for(var z=0;z<D&&t[N+z]==t[N+z-R];++z);if(z>O){if(O=z,B=R,z>T)break;var U=Math.min(R,z-2),H=0;for(E=0;E<U;++E){var W=N-R+E&32767,V=W-g[W]&32767;V>H&&(H=V,C=W)}}}R+=(I=C)-(C=g[I])&32767}if(B){y[S++]=268435456|Kt[O]<<18|$t[B];var G=31&Kt[O],Y=31&$t[B];L+=Vt[G]+Gt[Y],++_[257+G],++x[Y],k=N+O,++A}else y[S++]=t[N],++_[t[N]]}}for(N=Math.max(N,k);N<s;++N)y[S++]=t[N],++_[t[N]];c=ge(t,h,l,y,_,x,L,S,P,N-P,c),l||(a.r=7&c|h[c/8|0]<<3,c-=7,a.h=m,a.p=g,a.i=N,a.w=k)}else{for(N=a.w||0;N<s+l;N+=65535){var Z=N+65535;Z>=s&&(h[c/8|0]=l,Z=s),c=pe(h,c+1,t.subarray(N,Z))}a.i=s}return function(t,e,n){return(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length),new Ut(t.subarray(e,n))}(o,0,r+oe(c)+i)}(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,4,i)}(t,e,e.dictionary?6:2);return function(t,e){var n=e.level,r=0==n?0:n<6?1:9==n?3:2;if(t[0]=120,t[1]=r<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var i=ve();i.p(e.dictionary),we(t,2,i.d())}}(r,e),we(r,r.length-4,n.d()),r}var _e="undefined"!=typeof TextDecoder&&new TextDecoder;try{_e.decode(be,{stream:!0})}catch(is){}
/**
   * @license
   * jsPDF filters PlugIn
   * Copyright (c) 2014 Aras Abbasi
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */function xe(t,e="utf8"){return new TextDecoder(e).decode(t)}!function(t){var e=function(t){var e,n,r,i,a,s,o,h,l,c;for(/[^\x00-\xFF]/.test(t),n=[],r=0,i=(t+=e="\0\0\0\0".slice(t.length%4||4)).length;i>r;r+=4)0!==(a=(t.charCodeAt(r)<<24)+(t.charCodeAt(r+1)<<16)+(t.charCodeAt(r+2)<<8)+t.charCodeAt(r+3))?(s=(a=((a=((a=((a=(a-(c=a%85))/85)-(l=a%85))/85)-(h=a%85))/85)-(o=a%85))/85)%85,n.push(s+33,o+33,h+33,l+33,c+33)):n.push(122);return function(t,e){for(var n=e;n>0;n--)t.pop()}(n,e.length),String.fromCharCode.apply(String,n)+"~>"},n=function(t){var e,n,r,i,a,s=String,o="length",h=255,l="charCodeAt",c="slice",u="replace";for(t[c](-2),t=t[c](0,-2)[u](/\s/g,"")[u]("z","!!!!!"),r=[],i=0,a=(t+=e="uuuuu"[c](t[o]%5||5))[o];a>i;i+=5)n=52200625*(t[l](i)-33)+614125*(t[l](i+1)-33)+7225*(t[l](i+2)-33)+85*(t[l](i+3)-33)+(t[l](i+4)-33),r.push(h&n>>24,h&n>>16,h&n>>8,h&n);return function(t,e){for(var n=e;n>0;n--)t.pop()}(r,e[o]),s.fromCharCode.apply(s,r)},r=function(t){return t.split("").map(function(t){return("0"+t.charCodeAt().toString(16)).slice(-2)}).join("")+">"},i=function(t){var e=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(t=t.replace(/\s/g,"")).indexOf(">")&&(t=t.substr(0,t.indexOf(">"))),t.length%2&&(t+="0"),!1===e.test(t))return"";for(var n="",r=0;r<t.length;r+=2)n+=String.fromCharCode("0x"+(t[r]+t[r+1]));return n},a=function(t){for(var e=new Uint8Array(t.length),n=t.length;n--;)e[n]=t.charCodeAt(n);return(e=ye(e)).reduce(function(t,e){return t+String.fromCharCode(e)},"")};t.processDataByFilters=function(t,s){var o=0,h=t||"",l=[];for("string"==typeof(s=s||[])&&(s=[s]),o=0;o<s.length;o+=1)switch(s[o]){case"ASCII85Decode":case"/ASCII85Decode":h=n(h),l.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":h=e(h),l.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":h=i(h),l.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":h=r(h),l.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":h=a(h),l.push("/FlateDecode");break;default:throw new Error('The filter: "'+s[o]+'" is not implemented')}return{data:h,reverseChain:l.reverse().join(" ")}}}(R.API),
/**
   * @license
   * jsPDF fileloading PlugIn
   * Copyright (c) 2018 Aras Abbasi (aras.abbasi@gmail.com)
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){t.loadFile=function(t,e,n){return function(t,e,n){e=!1!==e,n="function"==typeof n?n:function(){};var r=void 0;try{r=function(t,e,n){var r=new XMLHttpRequest,i=0,a=function(t){var e=t.length,n=[],r=String.fromCharCode;for(i=0;i<e;i+=1)n.push(r(255&t.charCodeAt(i)));return n.join("")};if(r.open("GET",t,!e),r.overrideMimeType("text/plain; charset=x-user-defined"),!1===e&&(r.onload=function(){200===r.status?n(a(this.responseText)):n(void 0)}),r.send(null),e&&200===r.status)return a(r.responseText)}(t,e,n)}catch(is){}return r}(t,e,n)},t.allowFsRead=void 0,t.loadImageFile=t.loadFile}(R.API),function(e){function n(){return(i.html2canvas?Promise.resolve(i.html2canvas):"object"===(void 0===t?"undefined":r(t))&&"undefined"!=typeof module?new Promise(function(t,e){try{t(require("html2canvas"))}catch(is){e(is)}}):"function"==typeof define&&define.amd?new Promise(function(t,e){try{require(["html2canvas"],t)}catch(is){e(is)}}):Promise.reject(new Error("Could not load html2canvas"))).catch(function(t){return Promise.reject(new Error("Could not load html2canvas: "+t))}).then(function(t){return t.default?t.default:t})}function a(){return(i.DOMPurify?Promise.resolve(i.DOMPurify):"object"===(void 0===t?"undefined":r(t))&&"undefined"!=typeof module?new Promise(function(t,e){try{t(require("dompurify"))}catch(is){e(is)}}):"function"==typeof define&&define.amd?new Promise(function(t,e){try{require(["dompurify"],t)}catch(is){e(is)}}):Promise.reject(new Error("Could not load dompurify"))).catch(function(t){return Promise.reject(new Error("Could not load dompurify: "+t))}).then(function(t){return t.default?t.default:t})}var s=function(t){var e=r(t);return"undefined"===e?"undefined":"string"===e||t instanceof String?"string":"number"===e||t instanceof Number?"number":"function"===e||t instanceof Function?"function":t&&t.constructor===Array?"array":t&&1===t.nodeType?"element":"object"===e?"object":"unknown"},o=function(t,e){var n=document.createElement(t);for(var r in e.className&&(n.className=e.className),e.innerHTML&&e.dompurify&&(n.innerHTML=e.dompurify.sanitize(e.innerHTML)),e.style)n.style[r]=e.style[r];return n},h=function t(e,n){for(var r=3===e.nodeType?document.createTextNode(e.nodeValue):e.cloneNode(!1),i=e.firstChild;i;i=i.nextSibling)!0!==n&&1===i.nodeType&&"SCRIPT"===i.nodeName||r.appendChild(t(i,n));return 1===e.nodeType&&("CANVAS"===e.nodeName?(r.width=e.width,r.height=e.height,r.getContext("2d").drawImage(e,0,0)):"TEXTAREA"!==e.nodeName&&"SELECT"!==e.nodeName||(r.value=e.value),r.addEventListener("load",function(){r.scrollTop=e.scrollTop,r.scrollLeft=e.scrollLeft},!0)),r},l=function t(e){var n=Object.assign(t.convert(Promise.resolve()),JSON.parse(JSON.stringify(t.template))),r=t.convert(Promise.resolve(),n);return(r=r.setProgress(1,t,1,[t])).set(e)};(l.prototype=Object.create(Promise.prototype)).constructor=l,l.convert=function(t,e){return t.__proto__=e||l.prototype,t},l.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},l.prototype.from=function(t,e){return this.then(function(){switch(e=e||function(t){switch(s(t)){case"string":return"string";case"element":return"canvas"===t.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(t),e){case"string":return this.then(a).then(function(e){return this.set({src:o("div",{innerHTML:t,dompurify:e})})});case"element":return this.set({src:t});case"canvas":return this.set({canvas:t});case"img":return this.set({img:t});default:return this.error("Unknown source type.")}})},l.prototype.to=function(t){switch(t){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},l.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var t={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},e=h(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===e.tagName&&(t.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=o("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=o("div",{className:"html2pdf__container",style:t}),this.prop.container.appendChild(e),this.prop.container.firstChild.appendChild(o("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},l.prototype.toCanvas=function(){var t=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(t).then(n).then(function(t){var e=Object.assign({},this.opt.html2canvas);return delete e.onrendered,t(this.prop.container,e)}).then(function(t){(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)})},l.prototype.toContext2d=function(){var t=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(t).then(n).then(function(t){var e=this.opt.jsPDF,n=this.opt.fontFaces,r="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,i=Object.assign({async:!0,allowTaint:!0,scale:r,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete i.onrendered,e.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,e.context2d.posX=this.opt.x,e.context2d.posY=this.opt.y,e.context2d.margin=this.opt.margin,e.context2d.fontFaces=n,n)for(var a=0;a<n.length;++a){var s=n[a],o=s.src.find(function(t){return"truetype"===t.format});o&&e.addFont(o.url,s.ref.name,s.ref.style)}return i.windowHeight=i.windowHeight||0,i.windowHeight=0==i.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):i.windowHeight,e.context2d.save(!0),t(this.prop.container,i)}).then(function(t){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)})},l.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var t=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=t})},l.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},l.prototype.output=function(t,e,n){return"img"===(n=n||"pdf").toLowerCase()||"image"===n.toLowerCase()?this.outputImg(t,e):this.outputPdf(t,e)},l.prototype.outputPdf=function(t,e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(t,e)})},l.prototype.outputImg=function(t){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(t){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+t+'" is not supported.'}})},l.prototype.save=function(t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(t?{filename:t}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},l.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},l.prototype.set=function(t){if("object"!==s(t))return this;var e=Object.keys(t||{}).map(function(e){if(e in l.template.prop)return function(){this.prop[e]=t[e]};switch(e){case"margin":return this.setMargin.bind(this,t.margin);case"jsPDF":return function(){return this.opt.jsPDF=t.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,t.pageSize);default:return function(){this.opt[e]=t[e]}}},this);return this.then(function(){return this.thenList(e)})},l.prototype.get=function(t,e){return this.then(function(){var n=t in l.template.prop?this.prop[t]:this.opt[t];return e?e(n):n})},l.prototype.setMargin=function(t){return this.then(function(){switch(s(t)){case"number":t=[t,t,t,t];case"array":if(2===t.length&&(t=[t[0],t[1],t[0],t[1]]),4===t.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=t}).then(this.setPageSize)},l.prototype.setPageSize=function(t){function e(t,e){return Math.floor(t*e/72*96)}return this.then(function(){(t=t||R.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(t.inner={width:t.width-this.opt.margin[1]-this.opt.margin[3],height:t.height-this.opt.margin[0]-this.opt.margin[2]},t.inner.px={width:e(t.inner.width,t.k),height:e(t.inner.height,t.k)},t.inner.ratio=t.inner.height/t.inner.width),this.prop.pageSize=t})},l.prototype.setProgress=function(t,e,n,r){return null!=t&&(this.progress.val=t),null!=e&&(this.progress.state=e),null!=n&&(this.progress.n=n),null!=r&&(this.progress.stack=r),this.progress.ratio=this.progress.val/this.progress.state,this},l.prototype.updateProgress=function(t,e,n,r){return this.setProgress(t?this.progress.val+t:null,e||null,n?this.progress.n+n:null,r?this.progress.stack.concat(r):null)},l.prototype.then=function(t,e){var n=this;return this.thenCore(t,e,function(t,e){return n.updateProgress(null,null,1,[t]),Promise.prototype.then.call(this,function(e){return n.updateProgress(null,t),e}).then(t,e).then(function(t){return n.updateProgress(1),t})})},l.prototype.thenCore=function(t,e,n){n=n||Promise.prototype.then;var r=this;t&&(t=t.bind(r)),e&&(e=e.bind(r));var i=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?r:l.convert(Object.assign({},r),Promise.prototype),a=n.call(i,t,e);return l.convert(a,r.__proto__)},l.prototype.thenExternal=function(t,e){return Promise.prototype.then.call(this,t,e)},l.prototype.thenList=function(t){var e=this;return t.forEach(function(t){e=e.thenCore(t)}),e},l.prototype.catch=function(t){t&&(t=t.bind(this));var e=Promise.prototype.catch.call(this,t);return l.convert(e,this)},l.prototype.catchExternal=function(t){return Promise.prototype.catch.call(this,t)},l.prototype.error=function(t){return this.then(function(){throw new Error(t)})},l.prototype.using=l.prototype.set,l.prototype.saveAs=l.prototype.save,l.prototype.export=l.prototype.output,l.prototype.run=l.prototype.then,R.getPageSize=function(t,e,n){if("object"===r(t)){var i=t;t=i.orientation,e=i.unit||e,n=i.format||n}e=e||"mm",n=n||"a4",t=(""+(t||"P")).toLowerCase();var a,s=(""+n).toLowerCase(),o={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(e){case"pt":a=1;break;case"mm":a=72/25.4;break;case"cm":a=72/2.54;break;case"in":a=72;break;case"px":a=.75;break;case"pc":case"em":a=12;break;case"ex":a=6;break;default:throw"Invalid unit: "+e}var h,l=0,c=0;if(o.hasOwnProperty(s))l=o[s][1]/a,c=o[s][0]/a;else try{l=n[1],c=n[0]}catch(Dn){throw new Error("Invalid format: "+n)}if("p"===t||"portrait"===t)t="p",c>l&&(h=c,c=l,l=h);else{if("l"!==t&&"landscape"!==t)throw"Invalid orientation: "+t;t="l",l>c&&(h=c,c=l,l=h)}return{width:c,height:l,unit:e,k:a,orientation:t}},e.html=function(t,e){(e=e||{}).callback=e.callback||function(){},e.html2canvas=e.html2canvas||{},e.html2canvas.canvas=e.html2canvas.canvas||this.canvas,e.jsPDF=e.jsPDF||this,e.fontFaces=e.fontFaces?e.fontFaces.map(Et):null;var n=new l(e);return e.worker?n:n.from(t).doCallback()}}(R.API),
/**
   * @license
   * ====================================================================
   * Copyright (c) 2013 Youssef Beddad, youssef.beddad@gmail.com
   *
   * Permission is hereby granted, free of charge, to any person obtaining
   * a copy of this software and associated documentation files (the
   * "Software"), to deal in the Software without restriction, including
   * without limitation the rights to use, copy, modify, merge, publish,
   * distribute, sublicense, and/or sell copies of the Software, and to
   * permit persons to whom the Software is furnished to do so, subject to
   * the following conditions:
   *
   * The above copyright notice and this permission notice shall be
   * included in all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
   * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
   * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
   * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
   * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
   * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
   * ====================================================================
   */
function(t){t.addJS=function(t){var e,n,r=t;return this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(e+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),n=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+r+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==e&&void 0!==n&&this.internal.out("/Names <</JavaScript "+e+" 0 R>>")}),this}}(R.API),
/**
   * @license
   * Copyright (c) 2014 Steven Spungin (TwelveTone LLC)  steven@twelvetone.tv
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){var e;t.events.push(["postPutResources",function(){var t=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=t.outline.render().split(/\r\n/),i=0;i<r.length;i++){var a=r[i],s=n.exec(a);if(null!=s){var o=s[1];t.internal.newObjectDeferredBegin(o,!1)}t.internal.write(a)}if(this.outline.createNamedDestinations){var h=this.internal.pages.length,l=[];for(i=0;i<h;i++){var c=t.internal.newObject();l.push(c);var u=t.internal.getPageInfo(i+1);t.internal.write("<< /D["+u.objId+" 0 R /XYZ null null null]>> endobj")}var f=t.internal.newObject();for(t.internal.write("<< /Names [ "),i=0;i<l.length;i++)t.internal.write("(page_"+(i+1)+")"+l[i]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+f+" 0 R"),t.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(t,e,n){var r={title:e,options:n,children:[]};return null==t&&(t=this.root),t.children.push(r),r},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(e){e.id=t.internal.newObjectDeferred();for(var n=0;n<e.children.length;n++)this.genIds_r(e.children[n])},t.outline.renderRoot=function(t){this.objStart(t),this.line("/Type /Outlines"),t.children.length>0&&(this.line("/First "+this.makeRef(t.children[0])),this.line("/Last "+this.makeRef(t.children[t.children.length-1]))),this.line("/Count "+this.count_r({count:0},t)),this.objEnd()},t.outline.renderItems=function(e){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,r=0;r<e.children.length;r++){var i=e.children[r];this.objStart(i),this.line("/Title "+this.makeString(i.title)),this.line("/Parent "+this.makeRef(e)),r>0&&this.line("/Prev "+this.makeRef(e.children[r-1])),r<e.children.length-1&&this.line("/Next "+this.makeRef(e.children[r+1])),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1])));var a=this.count=this.count_r({count:0},i);if(a>0&&this.line("/Count "+a),i.options&&i.options.pageNumber){var s=t.internal.getPageInfo(i.options.pageNumber);this.line("/Dest ["+s.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var o=0;o<e.children.length;o++)this.renderItems(e.children[o])},t.outline.line=function(t){this.ctx.val+=t+"\r\n"},t.outline.makeRef=function(t){return t.id+" 0 R"},t.outline.makeString=function(e){return"("+t.internal.pdfEscape(e)+")"},t.outline.objStart=function(t){this.ctx.val+="\r\n"+t.id+" 0 obj\r\n<<\r\n"},t.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},t.outline.count_r=function(t,e){for(var n=0;n<e.children.length;n++)t.count++,this.count_r(t,e.children[n]);return t.count}}])}(R.API),
/**
   * @license
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(t,n,r,i,a,s){var o,h=this.decode.DCT_DECODE,l=null;if("string"==typeof t||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=a||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,o=function(t){for(var n,r=256*t.charCodeAt(4)+t.charCodeAt(5),i=t.length,a={width:0,height:0,numcomponents:1},s=4;s<i;s+=2){if(s+=r,-1!==e.indexOf(t.charCodeAt(s+1))){n=256*t.charCodeAt(s+5)+t.charCodeAt(s+6),a={width:256*t.charCodeAt(s+7)+t.charCodeAt(s+8),height:n,numcomponents:t.charCodeAt(s+9)};break}r=256*t.charCodeAt(s+2)+t.charCodeAt(s+3)}return a}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),o.numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}l={data:t,width:o.width,height:o.height,colorSpace:s,bitsPerComponent:8,filter:h,index:n,alias:r}}return l}}(R.API);const Ae=new TextEncoder,Le=(()=>{const t=new Uint8Array(4);return!((new Uint32Array(t.buffer)[0]=1)&t[0])})(),Ne={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Se{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(t=8192,e={}){let n=!1;"number"==typeof t?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);const r=e.offset?e.offset>>>0:0,i=t.byteLength-r;let a=r;(ArrayBuffer.isView(t)||t instanceof Se)&&(t.byteLength!==t.buffer.byteLength&&(a=t.byteOffset+r),t=t.buffer),this.lastWrittenByte=n?i:0,this.buffer=t,this.length=i,this.byteLength=i,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,i),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),n=new Uint8Array(e);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=e,this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const n=Ne[e].BYTES_PER_ELEMENT*t,r=this.byteOffset+this.offset,i=this.buffer.slice(r,r+n);if(this.littleEndian===Le&&"uint8"!==e&&"int8"!==e){const t=new Uint8Array(this.buffer.slice(r,r+n));t.reverse();const i=new Ne[e](t.buffer);return this.offset+=n,i.reverse(),i}const a=new Ne[e](i);return this.offset+=n,a}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let n=0;n<t;n++)e+=this.readChar();return e}readUtf8(t=1){return xe(this.readBytes(t))}decodeText(t=1,e="utf8"){return xe(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(function(t){return Ae.encode(t)}(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function ke(t){let e=t.length;for(;--e>=0;)t[e]=0}const Pe=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Fe=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ie=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ce=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),je=new Array(576);ke(je);const Ee=new Array(60);ke(Ee);const Oe=new Array(512);ke(Oe);const Be=new Array(256);ke(Be);const Me=new Array(29);ke(Me);const Re=new Array(30);function Te(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let qe,De,ze;function Ue(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}ke(Re);const He=t=>t<256?Oe[t]:Oe[256+(t>>>7)],We=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Ve=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,We(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Ge=(t,e,n)=>{Ve(t,n[2*e],n[2*e+1])},Ye=(t,e)=>{let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},Ze=(t,e,n)=>{const r=new Array(16);let i,a,s=0;for(i=1;i<=15;i++)s=s+n[i-1]<<1,r[i]=s;for(a=0;a<=e;a++){let e=t[2*a+1];0!==e&&(t[2*a]=Ye(r[e]++,e))}},Je=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Xe=t=>{t.bi_valid>8?We(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Ke=(t,e,n,r)=>{const i=2*e,a=2*n;return t[i]<t[a]||t[i]===t[a]&&r[e]<=r[n]},$e=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Ke(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Ke(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},Qe=(t,e,n)=>{let r,i,a,s,o=0;if(0!==t.sym_next)do{r=255&t.pending_buf[t.sym_buf+o++],r+=(255&t.pending_buf[t.sym_buf+o++])<<8,i=t.pending_buf[t.sym_buf+o++],0===r?Ge(t,i,e):(a=Be[i],Ge(t,a+256+1,e),s=Pe[a],0!==s&&(i-=Me[a],Ve(t,i,s)),r--,a=He(r),Ge(t,a,n),s=Fe[a],0!==s&&(r-=Re[a],Ve(t,r,s)))}while(o<t.sym_next);Ge(t,256,e)},tn=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,a=e.stat_desc.elems;let s,o,h,l=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<a;s++)0!==n[2*s]?(t.heap[++t.heap_len]=l=s,t.depth[s]=0):n[2*s+1]=0;for(;t.heap_len<2;)h=t.heap[++t.heap_len]=l<2?++l:0,n[2*h]=1,t.depth[h]=0,t.opt_len--,i&&(t.static_len-=r[2*h+1]);for(e.max_code=l,s=t.heap_len>>1;s>=1;s--)$e(t,n,s);h=a;do{s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],$e(t,n,1),o=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=o,n[2*h]=n[2*s]+n[2*o],t.depth[h]=(t.depth[s]>=t.depth[o]?t.depth[s]:t.depth[o])+1,n[2*s+1]=n[2*o+1]=h,t.heap[1]=h++,$e(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,a=e.stat_desc.has_stree,s=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,h=e.stat_desc.max_length;let l,c,u,f,d,p,g=0;for(f=0;f<=15;f++)t.bl_count[f]=0;for(n[2*t.heap[t.heap_max]+1]=0,l=t.heap_max+1;l<573;l++)c=t.heap[l],f=n[2*n[2*c+1]+1]+1,f>h&&(f=h,g++),n[2*c+1]=f,c>r||(t.bl_count[f]++,d=0,c>=o&&(d=s[c-o]),p=n[2*c],t.opt_len+=p*(f+d),a&&(t.static_len+=p*(i[2*c+1]+d)));if(0!==g){do{for(f=h-1;0===t.bl_count[f];)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[h]--,g-=2}while(g>0);for(f=h;0!==f;f--)for(c=t.bl_count[f];0!==c;)u=t.heap[--l],u>r||(n[2*u+1]!==f&&(t.opt_len+=(f-n[2*u+1])*n[2*u],n[2*u+1]=f),c--)}})(t,e),Ze(n,l,t.bl_count)},en=(t,e,n)=>{let r,i,a=-1,s=e[1],o=0,h=7,l=4;for(0===s&&(h=138,l=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=e[2*(r+1)+1],++o<h&&i===s||(o<l?t.bl_tree[2*i]+=o:0!==i?(i!==a&&t.bl_tree[2*i]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,a=i,0===s?(h=138,l=3):i===s?(h=6,l=3):(h=7,l=4))},nn=(t,e,n)=>{let r,i,a=-1,s=e[1],o=0,h=7,l=4;for(0===s&&(h=138,l=3),r=0;r<=n;r++)if(i=s,s=e[2*(r+1)+1],!(++o<h&&i===s)){if(o<l)do{Ge(t,i,t.bl_tree)}while(0!==--o);else 0!==i?(i!==a&&(Ge(t,i,t.bl_tree),o--),Ge(t,16,t.bl_tree),Ve(t,o-3,2)):o<=10?(Ge(t,17,t.bl_tree),Ve(t,o-3,3)):(Ge(t,18,t.bl_tree),Ve(t,o-11,7));o=0,a=i,0===s?(h=138,l=3):i===s?(h=6,l=3):(h=7,l=4)}};let rn=!1;const an=(t,e,n,r)=>{Ve(t,0+(r?1:0),3),Xe(t),We(t,n),We(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var sn={_tr_init:t=>{rn||((()=>{let t,e,n,r,i;const a=new Array(16);for(n=0,r=0;r<28;r++)for(Me[r]=n,t=0;t<1<<Pe[r];t++)Be[n++]=r;for(Be[n-1]=r,i=0,r=0;r<16;r++)for(Re[r]=i,t=0;t<1<<Fe[r];t++)Oe[i++]=r;for(i>>=7;r<30;r++)for(Re[r]=i<<7,t=0;t<1<<Fe[r]-7;t++)Oe[256+i++]=r;for(e=0;e<=15;e++)a[e]=0;for(t=0;t<=143;)je[2*t+1]=8,t++,a[8]++;for(;t<=255;)je[2*t+1]=9,t++,a[9]++;for(;t<=279;)je[2*t+1]=7,t++,a[7]++;for(;t<=287;)je[2*t+1]=8,t++,a[8]++;for(Ze(je,287,a),t=0;t<30;t++)Ee[2*t+1]=5,Ee[2*t]=Ye(t,5);qe=new Te(je,Pe,257,286,15),De=new Te(Ee,Fe,0,30,15),ze=new Te(new Array(0),Ie,0,19,7)})(),rn=!0),t.l_desc=new Ue(t.dyn_ltree,qe),t.d_desc=new Ue(t.dyn_dtree,De),t.bl_desc=new Ue(t.bl_tree,ze),t.bi_buf=0,t.bi_valid=0,Je(t)},_tr_stored_block:an,_tr_flush_block:(t,e,n,r)=>{let i,a,s=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),tn(t,t.l_desc),tn(t,t.d_desc),s=(t=>{let e;for(en(t,t.dyn_ltree,t.l_desc.max_code),en(t,t.dyn_dtree,t.d_desc.max_code),tn(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*Ce[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),i=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==e?an(t,e,n,r):4===t.strategy||a===i?(Ve(t,2+(r?1:0),3),Qe(t,je,Ee)):(Ve(t,4+(r?1:0),3),((t,e,n,r)=>{let i;for(Ve(t,e-257,5),Ve(t,n-1,5),Ve(t,r-4,4),i=0;i<r;i++)Ve(t,t.bl_tree[2*Ce[i]+1],3);nn(t,t.dyn_ltree,e-1),nn(t,t.dyn_dtree,n-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),Qe(t,t.dyn_ltree,t.dyn_dtree)),Je(t),r&&Xe(t)},_tr_tally:(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(Be[n]+256+1)]++,t.dyn_dtree[2*He(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{Ve(t,2,3),Ge(t,256,je),(t=>{16===t.bi_valid?(We(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},on=(t,e,n,r)=>{let i=65535&t,a=t>>>16&65535,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{i=i+e[r++]|0,a=a+i|0}while(--s);i%=65521,a%=65521}return i|a<<16};const hn=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var ln=(t,e,n,r)=>{const i=hn,a=r+n;t^=-1;for(let s=r;s<a;s++)t=t>>>8^i[255&(t^e[s])];return-1^t},cn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},un={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:fn,_tr_stored_block:dn,_tr_flush_block:pn,_tr_tally:gn,_tr_align:mn}=sn,{Z_NO_FLUSH:bn,Z_PARTIAL_FLUSH:vn,Z_FULL_FLUSH:wn,Z_FINISH:yn,Z_BLOCK:_n,Z_OK:xn,Z_STREAM_END:An,Z_STREAM_ERROR:Ln,Z_DATA_ERROR:Nn,Z_BUF_ERROR:Sn,Z_DEFAULT_COMPRESSION:kn,Z_FILTERED:Pn,Z_HUFFMAN_ONLY:Fn,Z_RLE:In,Z_FIXED:Cn,Z_DEFAULT_STRATEGY:jn,Z_UNKNOWN:En,Z_DEFLATED:On}=un,Bn=258,Mn=262,Rn=42,Tn=113,qn=666,Dn=(t,e)=>(t.msg=cn[e],e),zn=t=>2*t-(t>4?9:0),Un=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Hn=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do{n=t.head[--r],t.head[r]=n>=i?n-i:0}while(--e);e=i,r=e;do{n=t.prev[--r],t.prev[r]=n>=i?n-i:0}while(--e)};let Wn=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Vn=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},Gn=(t,e)=>{pn(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Vn(t.strm)},Yn=(t,e)=>{t.pending_buf[t.pending++]=e},Zn=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Jn=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),1===t.state.wrap?t.adler=on(t.adler,e,i,n):2===t.state.wrap&&(t.adler=ln(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},Xn=(t,e)=>{let n,r,i=t.max_chain_length,a=t.strstart,s=t.prev_length,o=t.nice_match;const h=t.strstart>t.w_size-Mn?t.strstart-(t.w_size-Mn):0,l=t.window,c=t.w_mask,u=t.prev,f=t.strstart+Bn;let d=l[a+s-1],p=l[a+s];t.prev_length>=t.good_match&&(i>>=2),o>t.lookahead&&(o=t.lookahead);do{if(n=e,l[n+s]===p&&l[n+s-1]===d&&l[n]===l[a]&&l[++n]===l[a+1]){a+=2,n++;do{}while(l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&a<f);if(r=Bn-(f-a),a=f-Bn,r>s){if(t.match_start=e,s=r,r>=o)break;d=l[a+s-1],p=l[a+s]}}}while((e=u[e&c])>h&&0!==--i);return s<=t.lookahead?s:t.lookahead},Kn=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Mn)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Hn(t),r+=e),0===t.strm.avail_in)break;if(n=Jn(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Wn(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Wn(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Mn&&0!==t.strm.avail_in)},$n=(t,e)=>{let n,r,i,a=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,s=0,o=t.strm.avail_in;do{if(n=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i)break;if(i=t.strm.avail_out-i,r=t.strstart-t.block_start,n>r+t.strm.avail_in&&(n=r+t.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&e!==yn||e===bn||n!==r+t.strm.avail_in))break;s=e===yn&&n===r+t.strm.avail_in?1:0,dn(t,0,0,s),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Vn(t.strm),r&&(r>n&&(r=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,n-=r),n&&(Jn(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(0===s);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),s?4:e!==bn&&e!==yn&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(Jn(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,a=i>t.w_size?t.w_size:i,r=t.strstart-t.block_start,(r>=a||(r||e===yn)&&e!==bn&&0===t.strm.avail_in&&r<=i)&&(n=r>i?i:r,s=e===yn&&0===t.strm.avail_in&&n===r?1:0,dn(t,t.block_start,n,s),t.block_start+=n,Vn(t.strm)),s?3:1)},Qn=(t,e)=>{let n,r;for(;;){if(t.lookahead<Mn){if(Kn(t),t.lookahead<Mn&&e===bn)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=Wn(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-Mn&&(t.match_length=Xn(t,n)),t.match_length>=3)if(r=gn(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=Wn(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Wn(t,t.ins_h,t.window[t.strstart+1]);else r=gn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Gn(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===yn?(Gn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Gn(t,!1),0===t.strm.avail_out)?1:2},tr=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Mn){if(Kn(t),t.lookahead<Mn&&e===bn)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=Wn(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Mn&&(t.match_length=Xn(t,n),t.match_length<=5&&(t.strategy===Pn||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=gn(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=Wn(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(Gn(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(r=gn(t,0,t.window[t.strstart-1]),r&&Gn(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=gn(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===yn?(Gn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Gn(t,!1),0===t.strm.avail_out)?1:2};function er(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const nr=[new er(0,0,0,0,$n),new er(4,4,8,4,Qn),new er(4,5,16,8,Qn),new er(4,6,32,32,Qn),new er(4,4,16,16,tr),new er(8,16,32,32,tr),new er(8,16,128,128,tr),new er(8,32,128,256,tr),new er(32,128,258,1024,tr),new er(32,258,258,4096,tr)];function rr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=On,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Un(this.dyn_ltree),Un(this.dyn_dtree),Un(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Un(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Un(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ir=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Rn&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==Tn&&e.status!==qn?1:0},ar=t=>{if(ir(t))return Dn(t,Ln);t.total_in=t.total_out=0,t.data_type=En;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?Rn:Tn,t.adler=2===e.wrap?0:1,e.last_flush=-2,fn(e),xn},sr=t=>{const e=ar(t);return e===xn&&((n=t.state).window_size=2*n.w_size,Un(n.head),n.max_lazy_match=nr[n.level].max_lazy,n.good_match=nr[n.level].good_length,n.nice_match=nr[n.level].nice_length,n.max_chain_length=nr[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),e;var n},or=(t,e,n,r,i,a)=>{if(!t)return Ln;let s=1;if(e===kn&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==On||r<8||r>15||e<0||e>9||a<0||a>Cn||8===r&&1!==s)return Dn(t,Ln);8===r&&(r=9);const o=new rr;return t.state=o,o.strm=t,o.status=Rn,o.wrap=s,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=e,o.strategy=a,o.method=n,sr(t)};var hr=or,lr=(t,e)=>ir(t)||2!==t.state.wrap?Ln:(t.state.gzhead=e,xn),cr=(t,e)=>{if(ir(t)||e>_n||e<0)return t?Dn(t,Ln):Ln;const n=t.state;if(!t.output||0!==t.avail_in&&!t.input||n.status===qn&&e!==yn)return Dn(t,0===t.avail_out?Sn:Ln);const r=n.last_flush;if(n.last_flush=e,0!==n.pending){if(Vn(t),0===t.avail_out)return n.last_flush=-1,xn}else if(0===t.avail_in&&zn(e)<=zn(r)&&e!==yn)return Dn(t,Sn);if(n.status===qn&&0!==t.avail_in)return Dn(t,Sn);if(n.status===Rn&&0===n.wrap&&(n.status=Tn),n.status===Rn){let e=On+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=Fn||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=r<<6,0!==n.strstart&&(e|=32),e+=31-e%31,Zn(n,e),0!==n.strstart&&(Zn(n,t.adler>>>16),Zn(n,65535&t.adler)),t.adler=1,n.status=Tn,Vn(t),0!==n.pending)return n.last_flush=-1,xn}if(57===n.status)if(t.adler=0,Yn(n,31),Yn(n,139),Yn(n,8),n.gzhead)Yn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Yn(n,255&n.gzhead.time),Yn(n,n.gzhead.time>>8&255),Yn(n,n.gzhead.time>>16&255),Yn(n,n.gzhead.time>>24&255),Yn(n,9===n.level?2:n.strategy>=Fn||n.level<2?4:0),Yn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Yn(n,255&n.gzhead.extra.length),Yn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=ln(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Yn(n,0),Yn(n,0),Yn(n,0),Yn(n,0),Yn(n,0),Yn(n,9===n.level?2:n.strategy>=Fn||n.level<2?4:0),Yn(n,3),n.status=Tn,Vn(t),0!==n.pending)return n.last_flush=-1,xn;if(69===n.status){if(n.gzhead.extra){let e=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>e&&(t.adler=ln(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex+=i,Vn(t),0!==n.pending)return n.last_flush=-1,xn;e=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>e&&(t.adler=ln(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let e,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(t.adler=ln(t.adler,n.pending_buf,n.pending-r,r)),Vn(t),0!==n.pending)return n.last_flush=-1,xn;r=0}e=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Yn(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>r&&(t.adler=ln(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let e,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(t.adler=ln(t.adler,n.pending_buf,n.pending-r,r)),Vn(t),0!==n.pending)return n.last_flush=-1,xn;r=0}e=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Yn(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>r&&(t.adler=ln(t.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Vn(t),0!==n.pending))return n.last_flush=-1,xn;Yn(n,255&t.adler),Yn(n,t.adler>>8&255),t.adler=0}if(n.status=Tn,Vn(t),0!==n.pending)return n.last_flush=-1,xn}if(0!==t.avail_in||0!==n.lookahead||e!==bn&&n.status!==qn){let r=0===n.level?$n(n,e):n.strategy===Fn?((t,e)=>{let n;for(;;){if(0===t.lookahead&&(Kn(t),0===t.lookahead)){if(e===bn)return 1;break}if(t.match_length=0,n=gn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Gn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===yn?(Gn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Gn(t,!1),0===t.strm.avail_out)?1:2})(n,e):n.strategy===In?((t,e)=>{let n,r,i,a;const s=t.window;for(;;){if(t.lookahead<=Bn){if(Kn(t),t.lookahead<=Bn&&e===bn)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=t.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){a=t.strstart+Bn;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);t.match_length=Bn-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=gn(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=gn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Gn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===yn?(Gn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Gn(t,!1),0===t.strm.avail_out)?1:2})(n,e):nr[n.level].func(n,e);if(3!==r&&4!==r||(n.status=qn),1===r||3===r)return 0===t.avail_out&&(n.last_flush=-1),xn;if(2===r&&(e===vn?mn(n):e!==_n&&(dn(n,0,0,!1),e===wn&&(Un(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Vn(t),0===t.avail_out))return n.last_flush=-1,xn}return e!==yn?xn:n.wrap<=0?An:(2===n.wrap?(Yn(n,255&t.adler),Yn(n,t.adler>>8&255),Yn(n,t.adler>>16&255),Yn(n,t.adler>>24&255),Yn(n,255&t.total_in),Yn(n,t.total_in>>8&255),Yn(n,t.total_in>>16&255),Yn(n,t.total_in>>24&255)):(Zn(n,t.adler>>>16),Zn(n,65535&t.adler)),Vn(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?xn:An)},ur=t=>{if(ir(t))return Ln;const e=t.state.status;return t.state=null,e===Tn?Dn(t,Nn):xn},fr=(t,e)=>{let n=e.length;if(ir(t))return Ln;const r=t.state,i=r.wrap;if(2===i||1===i&&r.status!==Rn||r.lookahead)return Ln;if(1===i&&(t.adler=on(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){0===i&&(Un(r.head),r.strstart=0,r.block_start=0,r.insert=0);let t=new Uint8Array(r.w_size);t.set(e.subarray(n-r.w_size,n),0),e=t,n=r.w_size}const a=t.avail_in,s=t.next_in,o=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Kn(r);r.lookahead>=3;){let t=r.strstart,e=r.lookahead-2;do{r.ins_h=Wn(r,r.ins_h,r.window[t+3-1]),r.prev[t&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=t,t++}while(--e);r.strstart=t,r.lookahead=2,Kn(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=s,t.input=o,t.avail_in=a,r.wrap=i,xn};const dr=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var pr=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const e in n)dr(n,e)&&(t[e]=n[e])}}return t},gr=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,a=t.length;r<a;r++){let e=t[r];n.set(e,i),i+=e.length}return n};let mr=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(as){mr=!1}const br=new Uint8Array(256);for(let ss=0;ss<256;ss++)br[ss]=ss>=252?6:ss>=248?5:ss>=240?4:ss>=224?3:ss>=192?2:1;br[254]=br[254]=1;var vr=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,n,r,i,a,s=t.length,o=0;for(i=0;i<s;i++)n=t.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=t.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(o),a=0,i=0;a<o;i++)n=t.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=t.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},wr=(t,e)=>{const n=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let r,i;const a=new Array(2*n);for(i=0,r=0;r<n;){let e=t[r++];if(e<128){a[i++]=e;continue}let s=br[e];if(s>4)a[i++]=65533,r+=s-1;else{for(e&=2===s?31:3===s?15:7;s>1&&r<n;)e=e<<6|63&t[r++],s--;s>1?a[i++]=65533:e<65536?a[i++]=e:(e-=65536,a[i++]=55296|e>>10&1023,a[i++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&mr)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n})(a,i)},yr=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+br[t[n]]>e?n:e},_r=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const xr=Object.prototype.toString,{Z_NO_FLUSH:Ar,Z_SYNC_FLUSH:Lr,Z_FULL_FLUSH:Nr,Z_FINISH:Sr,Z_OK:kr,Z_STREAM_END:Pr,Z_DEFAULT_COMPRESSION:Fr,Z_DEFAULT_STRATEGY:Ir,Z_DEFLATED:Cr}=un;function jr(t){this.options=pr({level:Fr,method:Cr,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ir},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _r,this.strm.avail_out=0;let n=hr(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==kr)throw new Error(cn[n]);if(e.header&&lr(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?vr(e.dictionary):"[object ArrayBuffer]"===xr.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=fr(this.strm,t),n!==kr)throw new Error(cn[n]);this._dict_set=!0}}jr.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=e===~~e?e:!0===e?Sr:Ar,"string"==typeof t?n.input=vr(t):"[object ArrayBuffer]"===xr.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===Lr||a===Nr)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=cr(n,a),i===Pr)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=ur(this.strm),this.onEnd(i),this.ended=!0,i===kr;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},jr.prototype.onData=function(t){this.chunks.push(t)},jr.prototype.onEnd=function(t){t===kr&&(this.result=gr(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};const Er=16209;var Or=function(t,e){let n,r,i,a,s,o,h,l,c,u,f,d,p,g,m,b,v,w,y,_,x,A,L,N;const S=t.state;n=t.next_in,L=t.input,r=n+(t.avail_in-5),i=t.next_out,N=t.output,a=i-(e-t.avail_out),s=i+(t.avail_out-257),o=S.dmax,h=S.wsize,l=S.whave,c=S.wnext,u=S.window,f=S.hold,d=S.bits,p=S.lencode,g=S.distcode,m=(1<<S.lenbits)-1,b=(1<<S.distbits)-1;t:do{d<15&&(f+=L[n++]<<d,d+=8,f+=L[n++]<<d,d+=8),v=p[f&m];e:for(;;){if(w=v>>>24,f>>>=w,d-=w,w=v>>>16&255,0===w)N[i++]=65535&v;else{if(!(16&w)){if(64&w){if(32&w){S.mode=16191;break t}t.msg="invalid literal/length code",S.mode=Er;break t}v=p[(65535&v)+(f&(1<<w)-1)];continue e}for(y=65535&v,w&=15,w&&(d<w&&(f+=L[n++]<<d,d+=8),y+=f&(1<<w)-1,f>>>=w,d-=w),d<15&&(f+=L[n++]<<d,d+=8,f+=L[n++]<<d,d+=8),v=g[f&b];;){if(w=v>>>24,f>>>=w,d-=w,w=v>>>16&255,16&w){if(_=65535&v,w&=15,d<w&&(f+=L[n++]<<d,d+=8,d<w&&(f+=L[n++]<<d,d+=8)),_+=f&(1<<w)-1,_>o){t.msg="invalid distance too far back",S.mode=Er;break t}if(f>>>=w,d-=w,w=i-a,_>w){if(w=_-w,w>l&&S.sane){t.msg="invalid distance too far back",S.mode=Er;break t}if(x=0,A=u,0===c){if(x+=h-w,w<y){y-=w;do{N[i++]=u[x++]}while(--w);x=i-_,A=N}}else if(c<w){if(x+=h+c-w,w-=c,w<y){y-=w;do{N[i++]=u[x++]}while(--w);if(x=0,c<y){w=c,y-=w;do{N[i++]=u[x++]}while(--w);x=i-_,A=N}}}else if(x+=c-w,w<y){y-=w;do{N[i++]=u[x++]}while(--w);x=i-_,A=N}for(;y>2;)N[i++]=A[x++],N[i++]=A[x++],N[i++]=A[x++],y-=3;y&&(N[i++]=A[x++],y>1&&(N[i++]=A[x++]))}else{x=i-_;do{N[i++]=N[x++],N[i++]=N[x++],N[i++]=N[x++],y-=3}while(y>2);y&&(N[i++]=N[x++],y>1&&(N[i++]=N[x++]))}break}if(64&w){t.msg="invalid distance code",S.mode=Er;break t}v=g[(65535&v)+(f&(1<<w)-1)]}}break}}while(n<r&&i<s);y=d>>3,n-=y,d-=y<<3,f&=(1<<d)-1,t.next_in=n,t.next_out=i,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=i<s?s-i+257:257-(i-s),S.hold=f,S.bits=d};const Br=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Mr=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Rr=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Tr=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var qr=(t,e,n,r,i,a,s,o)=>{const h=o.bits;let l,c,u,f,d,p,g=0,m=0,b=0,v=0,w=0,y=0,_=0,x=0,A=0,L=0,N=null;const S=new Uint16Array(16),k=new Uint16Array(16);let P,F,I,C=null;for(g=0;g<=15;g++)S[g]=0;for(m=0;m<r;m++)S[e[n+m]]++;for(w=h,v=15;v>=1&&0===S[v];v--);if(w>v&&(w=v),0===v)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(b=1;b<v&&0===S[b];b++);for(w<b&&(w=b),x=1,g=1;g<=15;g++)if(x<<=1,x-=S[g],x<0)return-1;if(x>0&&(0===t||1!==v))return-1;for(k[1]=0,g=1;g<15;g++)k[g+1]=k[g]+S[g];for(m=0;m<r;m++)0!==e[n+m]&&(s[k[e[n+m]]++]=m);if(0===t?(N=C=s,p=20):1===t?(N=Br,C=Mr,p=257):(N=Rr,C=Tr,p=0),L=0,m=0,g=b,d=a,y=w,_=0,u=-1,A=1<<w,f=A-1,1===t&&A>852||2===t&&A>592)return 1;for(;;){P=g-_,s[m]+1<p?(F=0,I=s[m]):s[m]>=p?(F=C[s[m]-p],I=N[s[m]-p]):(F=96,I=0),l=1<<g-_,c=1<<y,b=c;do{c-=l,i[d+(L>>_)+c]=P<<24|F<<16|I}while(0!==c);for(l=1<<g-1;L&l;)l>>=1;if(0!==l?(L&=l-1,L+=l):L=0,m++,0===--S[g]){if(g===v)break;g=e[n+s[m]]}if(g>w&&(L&f)!==u){for(0===_&&(_=w),d+=b,y=g-_,x=1<<y;y+_<v&&(x-=S[y+_],!(x<=0));)y++,x<<=1;if(A+=1<<y,1===t&&A>852||2===t&&A>592)return 1;u=L&f,i[u]=w<<24|y<<16|d-a}}return 0!==L&&(i[d+L]=g-_<<24|64<<16),o.bits=w,0};const{Z_FINISH:Dr,Z_BLOCK:zr,Z_TREES:Ur,Z_OK:Hr,Z_STREAM_END:Wr,Z_NEED_DICT:Vr,Z_STREAM_ERROR:Gr,Z_DATA_ERROR:Yr,Z_MEM_ERROR:Zr,Z_BUF_ERROR:Jr,Z_DEFLATED:Xr}=un,Kr=16180,$r=16190,Qr=16191,ti=16192,ei=16194,ni=16199,ri=16200,ii=16206,ai=16209,si=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function oi(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const hi=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Kr||e.mode>16211?1:0},li=t=>{if(hi(t))return Gr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Kr,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Hr},ci=t=>{if(hi(t))return Gr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,li(t)},ui=(t,e)=>{let n;if(hi(t))return Gr;const r=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Gr:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,ci(t))},fi=(t,e)=>{if(!t)return Gr;const n=new oi;t.state=n,n.strm=t,n.window=null,n.mode=Kr;const r=ui(t,e);return r!==Hr&&(t.state=null),r};let di,pi,gi=!0;const mi=t=>{if(gi){di=new Int32Array(512),pi=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(qr(1,t.lens,0,288,di,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;qr(2,t.lens,0,32,pi,0,t.work,{bits:5}),gi=!1}t.lencode=di,t.lenbits=9,t.distcode=pi,t.distbits=5},bi=(t,e,n,r)=>{let i;const a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(e.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(e.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(e.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var vi=ci,wi=fi,yi=(t,e)=>{let n,r,i,a,s,o,h,l,c,u,f,d,p,g,m,b,v,w,y,_,x,A,L=0;const N=new Uint8Array(4);let S,k;const P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(hi(t)||!t.output||!t.input&&0!==t.avail_in)return Gr;n=t.state,n.mode===Qr&&(n.mode=ti),s=t.next_out,i=t.output,h=t.avail_out,a=t.next_in,r=t.input,o=t.avail_in,l=n.hold,c=n.bits,u=o,f=h,A=Hr;t:for(;;)switch(n.mode){case Kr:if(0===n.wrap){n.mode=ti;break}for(;c<16;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,N[0]=255&l,N[1]=l>>>8&255,n.check=ln(n.check,N,2,0),l=0,c=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=ai;break}if((15&l)!==Xr){t.msg="unknown compression method",n.mode=ai;break}if(l>>>=4,c-=4,x=8+(15&l),0===n.wbits&&(n.wbits=x),x>15||x>n.wbits){t.msg="invalid window size",n.mode=ai;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&l?16189:Qr,l=0,c=0;break;case 16181:for(;c<16;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(n.flags=l,(255&n.flags)!==Xr){t.msg="unknown compression method",n.mode=ai;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=ai;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&4&n.wrap&&(N[0]=255&l,N[1]=l>>>8&255,n.check=ln(n.check,N,2,0)),l=0,c=0,n.mode=16182;case 16182:for(;c<32;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}n.head&&(n.head.time=l),512&n.flags&&4&n.wrap&&(N[0]=255&l,N[1]=l>>>8&255,N[2]=l>>>16&255,N[3]=l>>>24&255,n.check=ln(n.check,N,4,0)),l=0,c=0,n.mode=16183;case 16183:for(;c<16;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&4&n.wrap&&(N[0]=255&l,N[1]=l>>>8&255,n.check=ln(n.check,N,2,0)),l=0,c=0,n.mode=16184;case 16184:if(1024&n.flags){for(;c<16;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&4&n.wrap&&(N[0]=255&l,N[1]=l>>>8&255,n.check=ln(n.check,N,2,0)),l=0,c=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(d=n.length,d>o&&(d=o),d&&(n.head&&(x=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+d),x)),512&n.flags&&4&n.wrap&&(n.check=ln(n.check,r,d,a)),o-=d,a+=d,n.length-=d),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break t;d=0;do{x=r[a+d++],n.head&&x&&n.length<65536&&(n.head.name+=String.fromCharCode(x))}while(x&&d<o);if(512&n.flags&&4&n.wrap&&(n.check=ln(n.check,r,d,a)),o-=d,a+=d,x)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break t;d=0;do{x=r[a+d++],n.head&&x&&n.length<65536&&(n.head.comment+=String.fromCharCode(x))}while(x&&d<o);if(512&n.flags&&4&n.wrap&&(n.check=ln(n.check,r,d,a)),o-=d,a+=d,x)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;c<16;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(4&n.wrap&&l!==(65535&n.check)){t.msg="header crc mismatch",n.mode=ai;break}l=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Qr;break;case 16189:for(;c<32;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}t.adler=n.check=si(l),l=0,c=0,n.mode=$r;case $r:if(0===n.havedict)return t.next_out=s,t.avail_out=h,t.next_in=a,t.avail_in=o,n.hold=l,n.bits=c,Vr;t.adler=n.check=1,n.mode=Qr;case Qr:if(e===zr||e===Ur)break t;case ti:if(n.last){l>>>=7&c,c-=7&c,n.mode=ii;break}for(;c<3;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}switch(n.last=1&l,l>>>=1,c-=1,3&l){case 0:n.mode=16193;break;case 1:if(mi(n),n.mode=ni,e===Ur){l>>>=2,c-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=ai}l>>>=2,c-=2;break;case 16193:for(l>>>=7&c,c-=7&c;c<32;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if((65535&l)!=(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=ai;break}if(n.length=65535&l,l=0,c=0,n.mode=ei,e===Ur)break t;case ei:n.mode=16195;case 16195:if(d=n.length,d){if(d>o&&(d=o),d>h&&(d=h),0===d)break t;i.set(r.subarray(a,a+d),s),o-=d,a+=d,h-=d,s+=d,n.length-=d;break}n.mode=Qr;break;case 16196:for(;c<14;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(n.nlen=257+(31&l),l>>>=5,c-=5,n.ndist=1+(31&l),l>>>=5,c-=5,n.ncode=4+(15&l),l>>>=4,c-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=ai;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;c<3;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}n.lens[P[n.have++]]=7&l,l>>>=3,c-=3}for(;n.have<19;)n.lens[P[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S={bits:n.lenbits},A=qr(0,n.lens,0,19,n.lencode,0,n.work,S),n.lenbits=S.bits,A){t.msg="invalid code lengths set",n.mode=ai;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;L=n.lencode[l&(1<<n.lenbits)-1],m=L>>>24,b=L>>>16&255,v=65535&L,!(m<=c);){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(v<16)l>>>=m,c-=m,n.lens[n.have++]=v;else{if(16===v){for(k=m+2;c<k;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(l>>>=m,c-=m,0===n.have){t.msg="invalid bit length repeat",n.mode=ai;break}x=n.lens[n.have-1],d=3+(3&l),l>>>=2,c-=2}else if(17===v){for(k=m+3;c<k;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}l>>>=m,c-=m,x=0,d=3+(7&l),l>>>=3,c-=3}else{for(k=m+7;c<k;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}l>>>=m,c-=m,x=0,d=11+(127&l),l>>>=7,c-=7}if(n.have+d>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=ai;break}for(;d--;)n.lens[n.have++]=x}}if(n.mode===ai)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=ai;break}if(n.lenbits=9,S={bits:n.lenbits},A=qr(1,n.lens,0,n.nlen,n.lencode,0,n.work,S),n.lenbits=S.bits,A){t.msg="invalid literal/lengths set",n.mode=ai;break}if(n.distbits=6,n.distcode=n.distdyn,S={bits:n.distbits},A=qr(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,S),n.distbits=S.bits,A){t.msg="invalid distances set",n.mode=ai;break}if(n.mode=ni,e===Ur)break t;case ni:n.mode=ri;case ri:if(o>=6&&h>=258){t.next_out=s,t.avail_out=h,t.next_in=a,t.avail_in=o,n.hold=l,n.bits=c,Or(t,f),s=t.next_out,i=t.output,h=t.avail_out,a=t.next_in,r=t.input,o=t.avail_in,l=n.hold,c=n.bits,n.mode===Qr&&(n.back=-1);break}for(n.back=0;L=n.lencode[l&(1<<n.lenbits)-1],m=L>>>24,b=L>>>16&255,v=65535&L,!(m<=c);){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(b&&!(240&b)){for(w=m,y=b,_=v;L=n.lencode[_+((l&(1<<w+y)-1)>>w)],m=L>>>24,b=L>>>16&255,v=65535&L,!(w+m<=c);){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}l>>>=w,c-=w,n.back+=w}if(l>>>=m,c-=m,n.back+=m,n.length=v,0===b){n.mode=16205;break}if(32&b){n.back=-1,n.mode=Qr;break}if(64&b){t.msg="invalid literal/length code",n.mode=ai;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for(k=n.extra;c<k;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;L=n.distcode[l&(1<<n.distbits)-1],m=L>>>24,b=L>>>16&255,v=65535&L,!(m<=c);){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(!(240&b)){for(w=m,y=b,_=v;L=n.distcode[_+((l&(1<<w+y)-1)>>w)],m=L>>>24,b=L>>>16&255,v=65535&L,!(w+m<=c);){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}l>>>=w,c-=w,n.back+=w}if(l>>>=m,c-=m,n.back+=m,64&b){t.msg="invalid distance code",n.mode=ai;break}n.offset=v,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for(k=n.extra;c<k;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=ai;break}n.mode=16204;case 16204:if(0===h)break t;if(d=f-h,n.offset>d){if(d=n.offset-d,d>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=ai;break}d>n.wnext?(d-=n.wnext,p=n.wsize-d):p=n.wnext-d,d>n.length&&(d=n.length),g=n.window}else g=i,p=s-n.offset,d=n.length;d>h&&(d=h),h-=d,n.length-=d;do{i[s++]=g[p++]}while(--d);0===n.length&&(n.mode=ri);break;case 16205:if(0===h)break t;i[s++]=n.length,h--,n.mode=ri;break;case ii:if(n.wrap){for(;c<32;){if(0===o)break t;o--,l|=r[a++]<<c,c+=8}if(f-=h,t.total_out+=f,n.total+=f,4&n.wrap&&f&&(t.adler=n.check=n.flags?ln(n.check,i,f,s-f):on(n.check,i,f,s-f)),f=h,4&n.wrap&&(n.flags?l:si(l))!==n.check){t.msg="incorrect data check",n.mode=ai;break}l=0,c=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;c<32;){if(0===o)break t;o--,l+=r[a++]<<c,c+=8}if(4&n.wrap&&l!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=ai;break}l=0,c=0}n.mode=16208;case 16208:A=Wr;break t;case ai:A=Yr;break t;case 16210:return Zr;default:return Gr}return t.next_out=s,t.avail_out=h,t.next_in=a,t.avail_in=o,n.hold=l,n.bits=c,(n.wsize||f!==t.avail_out&&n.mode<ai&&(n.mode<ii||e!==Dr))&&bi(t,t.output,t.next_out,f-t.avail_out),u-=t.avail_in,f-=t.avail_out,t.total_in+=u,t.total_out+=f,n.total+=f,4&n.wrap&&f&&(t.adler=n.check=n.flags?ln(n.check,i,f,t.next_out-f):on(n.check,i,f,t.next_out-f)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Qr?128:0)+(n.mode===ni||n.mode===ei?256:0),(0===u&&0===f||e===Dr)&&A===Hr&&(A=Jr),A},_i=t=>{if(hi(t))return Gr;let e=t.state;return e.window&&(e.window=null),t.state=null,Hr},xi=(t,e)=>{if(hi(t))return Gr;const n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,Hr):Gr},Ai=(t,e)=>{const n=e.length;let r,i,a;return hi(t)?Gr:(r=t.state,0!==r.wrap&&r.mode!==$r?Gr:r.mode===$r&&(i=1,i=on(i,e,n,0),i!==r.check)?Yr:(a=bi(t,e,n,n),a?(r.mode=16210,Zr):(r.havedict=1,Hr)))},Li=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ni=Object.prototype.toString,{Z_NO_FLUSH:Si,Z_FINISH:ki,Z_OK:Pi,Z_STREAM_END:Fi,Z_NEED_DICT:Ii,Z_STREAM_ERROR:Ci,Z_DATA_ERROR:ji,Z_MEM_ERROR:Ei}=un;function Oi(t){this.options=pr({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _r,this.strm.avail_out=0;let n=wi(this.strm,e.windowBits);if(n!==Pi)throw new Error(cn[n]);if(this.header=new Li,xi(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=vr(e.dictionary):"[object ArrayBuffer]"===Ni.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Ai(this.strm,e.dictionary),n!==Pi)))throw new Error(cn[n])}function Bi(t,e){const n=new Oi(e);if(n.push(t),n.err)throw n.msg||cn[n.err];return n.result}Oi.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let a,s,o;if(this.ended)return!1;for(s=e===~~e?e:!0===e?ki:Si,"[object ArrayBuffer]"===Ni.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=yi(n,s),a===Ii&&i&&(a=Ai(n,i),a===Pi?a=yi(n,s):a===ji&&(a=Ii));n.avail_in>0&&a===Fi&&n.state.wrap>0&&0!==t[n.next_in];)vi(n),a=yi(n,s);switch(a){case Ci:case ji:case Ii:case Ei:return this.onEnd(a),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||a===Fi))if("string"===this.options.to){let t=yr(n.output,n.next_out),e=n.next_out-t,i=wr(n.output,t);n.next_out=e,n.avail_out=r-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==Pi||0!==o){if(a===Fi)return a=_i(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Oi.prototype.onData=function(t){this.chunks.push(t)},Oi.prototype.onEnd=function(t){t===Pi&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=gr(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Mi={Inflate:Oi,inflate:Bi,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Bi(t,e)},ungzip:Bi,constants:un};const{Inflate:Ri,inflate:Ti,inflateRaw:qi,ungzip:Di}=Mi;var zi=Ri,Ui=Ti;const Hi=[];for(let ss=0;ss<256;ss++){let t=ss;for(let e=0;e<8;e++)1&t?t=3988292384^t>>>1:t>>>=1;Hi[ss]=t}const Wi=4294967295;function Vi(t,e,n){const r=t.readUint32(),i=(a=new Uint8Array(t.buffer,t.byteOffset+t.offset-e-4,e),(function(t,e,n){let r=t;for(let i=0;i<n;i++)r=Hi[255&(r^e[i])]^r>>>8;return r}(Wi,a,e)^Wi)>>>0);var a;if(i!==r)throw new Error(`CRC mismatch for chunk ${n}. Expected ${r}, found ${i}`)}function Gi(t,e,n){for(let r=0;r<n;r++)e[r]=t[r]}function Yi(t,e,n,r){let i=0;for(;i<r;i++)e[i]=t[i];for(;i<n;i++)e[i]=t[i]+e[i-r]&255}function Zi(t,e,n,r){let i=0;if(0===n.length)for(;i<r;i++)e[i]=t[i];else for(;i<r;i++)e[i]=t[i]+n[i]&255}function Ji(t,e,n,r,i){let a=0;if(0===n.length){for(;a<i;a++)e[a]=t[a];for(;a<r;a++)e[a]=t[a]+(e[a-i]>>1)&255}else{for(;a<i;a++)e[a]=t[a]+(n[a]>>1)&255;for(;a<r;a++)e[a]=t[a]+(e[a-i]+n[a]>>1)&255}}function Xi(t,e,n,r,i){let a=0;if(0===n.length){for(;a<i;a++)e[a]=t[a];for(;a<r;a++)e[a]=t[a]+e[a-i]&255}else{for(;a<i;a++)e[a]=t[a]+n[a]&255;for(;a<r;a++)e[a]=t[a]+Ki(e[a-i],n[a],n[a-i])&255}}function Ki(t,e,n){const r=t+e-n,i=Math.abs(r-t),a=Math.abs(r-e),s=Math.abs(r-n);return i<=a&&i<=s?t:a<=s?e:n}function $i(t,e,n,r,i,a){switch(t){case 0:Gi(e,n,i);break;case 1:Yi(e,n,i,a);break;case 2:Zi(e,n,r,i);break;case 3:Ji(e,n,r,i,a);break;case 4:Xi(e,n,r,i,a);break;default:throw new Error(`Unsupported filter: ${t}`)}}const Qi=new Uint16Array([255]),ta=255===new Uint8Array(Qi.buffer)[0];function ea(t){return(255&t)<<8|t>>8&255}const na=new Uint16Array([255]),ra=255===new Uint8Array(na.buffer)[0],ia=new Uint8Array(0);function aa(t){const{data:e,width:n,height:r,channels:i,depth:a}=t,s=Math.ceil(a/8)*i,o=Math.ceil(a/8*i*n),h=new Uint8Array(r*o);let l,c,u=ia,f=0;for(let d=0;d<r;d++){switch(l=e.subarray(f+1,f+1+o),c=h.subarray(d*o,(d+1)*o),e[f]){case 0:Gi(l,c,o);break;case 1:Yi(l,c,o,s);break;case 2:Zi(l,c,u,o);break;case 3:Ji(l,c,u,o,s);break;case 4:Xi(l,c,u,o,s);break;default:throw new Error(`Unsupported filter: ${e[f]}`)}u=c,f+=o+1}if(16===a){const t=new Uint16Array(h.buffer);if(ra)for(let e=0;e<t.length;e++)t[e]=sa(t[e]);return t}return h}function sa(t){return(255&t)<<8|t>>8&255}const oa=Uint8Array.of(137,80,78,71,13,10,26,10);function ha(t){if(!function(t){if(t.length<oa.length)return!1;for(let e=0;e<oa.length;e++)if(t[e]!==oa[e])return!1;return!0}(t.readBytes(oa.length)))throw new Error("wrong PNG signature")}const la=new TextDecoder("latin1");const ca=/^[\u0000-\u00FF]*$/;function ua(t){for(t.mark();0!==t.readByte(););const e=t.offset;t.reset();const n=la.decode(t.readBytes(e-t.offset-1));return t.skip(1),function(t){if(function(t){if(!ca.test(t))throw new Error("invalid latin1 text")}(t),0===t.length||t.length>79)throw new Error("keyword length must be between 1 and 79")}(n),n}class fa extends Se{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(t,e={}){super(t);const{checkCrc:n=!1}=e;this._checkCrc=n,this._inflator=new zi,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=-1,this._filterMethod=-1,this._interlaceMethod=-1,this._colorType=-1,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(ha(this);!this._end;){const t=this.readUint32(),e=this.readChars(4);this.decodeChunk(t,e)}return this.decodeImage(),this._png}decodeApng(){for(ha(this);!this._end;){const t=this.readUint32(),e=this.readChars(4);this.decodeApngChunk(t,e)}return this.decodeApngImage(),this._apng}decodeChunk(t,e){const n=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":!function(t,e,n){const r=ua(e);t[r]=function(t,e){return la.decode(t.readBytes(e))}(e,n-r.length-1)}(this._png.text,this,t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-n!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);this._checkCrc?Vi(this,t+4,e):this.skip(4)}decodeApngChunk(t,e){const n=this.offset;switch("fdAT"!==e&&"IDAT"!==e&&this._writingDataChunks&&this.pushDataToFrame(),e){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(t);break;default:this.decodeChunk(t,e),this.offset=n+t}if(this.offset-n!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);this._checkCrc?Vi(this,t+4,e):this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=function(t){if(1!==t&&2!==t&&4!==t&&8!==t&&16!==t)throw new Error(`invalid bit depth: ${t}`);return t}(this.readUint8());const e=this.readUint8();let n;switch(this._colorType=e,e){case 0:case 3:n=1;break;case 2:n=3;break;case 4:n=2;break;case 6:n=4;break;default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),0!==this._compressionMethod)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const t={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(t)}decodePLTE(t){if(t%3!=0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const e=t/3;this._hasPalette=!0;const n=[];this._palette=n;for(let r=0;r<e;r++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._writingDataChunks=!0;const e=t,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,e)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(t)}decodeFDAT(t){this._writingDataChunks=!0;let e=t,n=this.offset+this.byteOffset;if(n+=4,e-=4,this._inflator.push(new Uint8Array(this.buffer,n,e)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(t)}decodetRNS(t){switch(this._colorType){case 0:case 2:if(t%2!=0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${t}`);if(t/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${t/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let e=0;e<t/2;e++)this._transparency[e]=this.readUint16();break;case 3:{if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const t=this.readByte();this._palette[e].push(t)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(t){const e=ua(this),n=this.readUint8();if(0!==n)throw new Error(`Unsupported iCCP compression method: ${n}`);const r=this.readBytes(t-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:Ui(r)}}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:e,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let t=0;t<this._numberOfFrames;t++){const e={sequenceNumber:this._frames[t].sequenceNumber,delayNumber:this._frames[t].delayNumber,delayDenominator:this._frames[t].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(t);if(n){if(n.data=aa({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===t||0===n.xOffset&&0===n.yOffset&&n.width===this._png.width&&n.height===this._png.height)e.data=n.data;else{const r=this._apng.frames.at(t-1);this.disposeFrame(n,r,e),this.addFrameDataToCanvas(e,n)}this._apng.frames.push(e)}}return this._apng}disposeFrame(t,e,n){switch(t.disposeOp){case 0:break;case 1:for(let e=0;e<this._png.height;e++)for(let r=0;r<this._png.width;r++){const i=(e*t.width+r)*this._png.channels;for(let t=0;t<this._png.channels;t++)n.data[i+t]=0}break;case 2:n.data.set(e.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(t,e){const n=1<<this._png.depth,r=(t,n)=>({index:((t+e.yOffset)*this._png.width+e.xOffset+n)*this._png.channels,frameIndex:(t*e.width+n)*this._png.channels});switch(e.blendOp){case 0:for(let n=0;n<e.height;n++)for(let i=0;i<e.width;i++){const{index:a,frameIndex:s}=r(n,i);for(let n=0;n<this._png.channels;n++)t.data[a+n]=e.data[s+n]}break;case 1:for(let i=0;i<e.height;i++)for(let a=0;a<e.width;a++){const{index:s,frameIndex:o}=r(i,a);for(let r=0;r<this._png.channels;r++){const i=e.data[o+this._png.channels-1]/n,a=r%(this._png.channels-1)==0?1:e.data[o+r],h=Math.floor(i*a+(1-i)*t.data[s+r]);t.data[s+r]+=h}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(0!==this._filterMethod)throw new Error(`Filter method ${this._filterMethod} not supported`);if(0===this._interlaceMethod)this._png.data=aa({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else{if(1!==this._interlaceMethod)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._png.data=function(t){const{data:e,width:n,height:r,channels:i,depth:a}=t,s=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(a/8)*i,h=new Uint8Array(r*n*o);let l=0;for(let c=0;c<7;c++){const t=s[c],i=Math.ceil((n-t.x)/t.xStep),a=Math.ceil((r-t.y)/t.yStep);if(i<=0||a<=0)continue;const u=i*o,f=new Uint8Array(u);for(let s=0;s<a;s++){const a=e[l++],c=e.subarray(l,l+u);l+=u;const d=new Uint8Array(u);$i(a,c,d,f,u,o),f.set(d);for(let e=0;e<i;e++){const i=t.x+e*t.xStep,a=t.y+s*t.yStep;if(!(i>=n||a>=r))for(let t=0;t<o;t++)h[(a*n+i)*o+t]=d[e*o+t]}}}if(16===a){const t=new Uint16Array(h.buffer);if(ta)for(let e=0;e<t.length;e++)t[e]=ea(t[e]);return t}return h}({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth})}this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const t=this._inflator.result,e=this._frames.at(-1);e?e.data=t:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:0,blendOp:0,data:t}),this._inflator=new zi,this._writingDataChunks=!1}}var da,pa,ga,ma,ba,va;function wa(t,e,n,r,i){var a=4,s=xa;switch(i){case R.API.image_compression.FAST:a=1,s=_a;break;case R.API.image_compression.MEDIUM:a=6,s=Aa;break;case R.API.image_compression.SLOW:a=9,s=La}t=function(t,e,n,r){for(var i,a=t.length/e,s=new Uint8Array(t.length+a),o=[ya,_a,xa,Aa,La],h=0;h<a;h+=1){var l=h*e,c=t.subarray(l,l+e);if(r)s.set(r(c,n,i),l+h);else{for(var u=o.length,f=[],d=0;d<u;d+=1)f[d]=o[d](c,n,i);var p=Sa(f.concat());s.set(f[p],l+h)}i=c}return s}(t,e,Math.ceil(n*r/8),s);var o=ye(t,{level:a});return R.API.__addimage__.arrayBufferToBinaryString(o)}function ya(t){var e=Array.apply([],t);return e.unshift(0),e}function _a(t,e){var n=t.length,r=[];r[0]=1;for(var i=0;i<n;i+=1){var a=t[i-e]||0;r[i+1]=t[i]-a+256&255}return r}function xa(t,e,n){var r=t.length,i=[];i[0]=2;for(var a=0;a<r;a+=1){var s=n&&n[a]||0;i[a+1]=t[a]-s+256&255}return i}function Aa(t,e,n){var r=t.length,i=[];i[0]=3;for(var a=0;a<r;a+=1){var s=t[a-e]||0,o=n&&n[a]||0;i[a+1]=t[a]+256-(s+o>>>1)&255}return i}function La(t,e,n){var r=t.length,i=[];i[0]=4;for(var a=0;a<r;a+=1){var s=Na(t[a-e]||0,n&&n[a]||0,n&&n[a-e]||0);i[a+1]=t[a]-s+256&255}return i}function Na(t,e,n){if(t===e&&e===n)return t;var r=Math.abs(e-n),i=Math.abs(t-n),a=Math.abs(t+e-n-n);return r<=i&&r<=a?t:i<=a?e:n}function Sa(t){var e=t.map(function(t){return t.reduce(function(t,e){return t+Math.abs(e)},0)});return e.indexOf(Math.min.apply(null,e))}function ka(t,e,n){var r=e*n,i=Math.floor(r/8),a=16-(r-8*i+n),s=(1<<n)-1;return Fa(t,i)>>a&s}function Pa(t,e,n,r){var i=n*r,a=Math.floor(i/8),s=16-(i-8*a+r),o=(1<<r)-1,h=(e&o)<<s;!function(t,e,n){if(e+1<t.byteLength)t.setUint16(e,n,!1);else{var r=n>>8&255;t.setUint8(e,r)}}
/**
   * @license
   * (c) Dean McNamee <dean@gmail.com>, 2013.
   *
   * https://github.com/deanm/omggif
   *
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to
   * deal in the Software without restriction, including without limitation the
   * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
   * sell copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   *
   * The above copyright notice and this permission notice shall be included in
   * all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
   * IN THE SOFTWARE.
   *
   * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
   * including animation and compression.  It does not rely on any specific
   * underlying system, so should run in the browser, Node, or Plask.
   */(t,a,Fa(t,a)&~(o<<s)&65535|h)}function Fa(t,e){return e+1<t.byteLength?t.getUint16(e,!1):t.getUint8(e)<<8}function Ia(t){var e=0;if(71!==t[e++]||73!==t[e++]||70!==t[e++]||56!==t[e++]||56!=(t[e++]+1&253)||97!==t[e++])throw new Error("Invalid GIF 87a/89a header.");var n=t[e++]|t[e++]<<8,r=t[e++]|t[e++]<<8,i=t[e++],a=i>>7,s=1<<1+(7&i);t[e++],t[e++];var o=null,h=null;a&&(o=e,h=s,e+=3*s);var l=!0,c=[],u=0,f=null,d=0,p=null;for(this.width=n,this.height=r;l&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(11!==t[e]||78==t[e+1]&&69==t[e+2]&&84==t[e+3]&&83==t[e+4]&&67==t[e+5]&&65==t[e+6]&&80==t[e+7]&&69==t[e+8]&&50==t[e+9]&&46==t[e+10]&&48==t[e+11]&&3==t[e+12]&&1==t[e+13]&&0==t[e+16])e+=14,p=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((k=t[e++])>=0))throw Error("Invalid block size");if(0===k)break;e+=k}break;case 249:if(4!==t[e++]||0!==t[e+4])throw new Error("Invalid graphics extension block.");var g=t[e++];u=t[e++]|t[e++]<<8,f=t[e++],1&g||(f=null),d=g>>2&7,e++;break;case 254:for(;;){if(!((k=t[e++])>=0))throw Error("Invalid block size");if(0===k)break;e+=k}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var m=t[e++]|t[e++]<<8,b=t[e++]|t[e++]<<8,v=t[e++]|t[e++]<<8,w=t[e++]|t[e++]<<8,y=t[e++],_=y>>6&1,x=1<<1+(7&y),A=o,L=h,N=!1;y>>7&&(N=!0,A=e,L=x,e+=3*x);var S=e;for(e++;;){var k;if(!((k=t[e++])>=0))throw Error("Invalid block size");if(0===k)break;e+=k}c.push({x:m,y:b,width:v,height:w,has_local_palette:N,palette_offset:A,palette_size:L,data_offset:S,data_length:e-S,transparent_index:f,interlaced:!!_,delay:u,disposal:d});break;case 59:l=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return c.length},this.loopCount=function(){return p},this.frameInfo=function(t){if(t<0||t>=c.length)throw new Error("Frame index out of range.");return c[t]},this.decodeAndBlitFrameBGRA=function(e,r){var i=this.frameInfo(e),a=i.width*i.height,s=new Uint8Array(a);Ca(t,i.data_offset,s,a);var o=i.palette_offset,h=i.transparent_index;null===h&&(h=256);var l=i.width,c=n-l,u=l,f=4*(i.y*n+i.x),d=4*((i.y+i.height)*n+i.x),p=f,g=4*c;!0===i.interlaced&&(g+=4*n*7);for(var m=8,b=0,v=s.length;b<v;++b){var w=s[b];if(0===u&&(u=l,(p+=g)>=d&&(g=4*c+4*n*(m-1),p=f+(l+c)*(m<<1),m>>=1)),w===h)p+=4;else{var y=t[o+3*w],_=t[o+3*w+1],x=t[o+3*w+2];r[p++]=x,r[p++]=_,r[p++]=y,r[p++]=255}--u}},this.decodeAndBlitFrameRGBA=function(e,r){var i=this.frameInfo(e),a=i.width*i.height,s=new Uint8Array(a);Ca(t,i.data_offset,s,a);var o=i.palette_offset,h=i.transparent_index;null===h&&(h=256);var l=i.width,c=n-l,u=l,f=4*(i.y*n+i.x),d=4*((i.y+i.height)*n+i.x),p=f,g=4*c;!0===i.interlaced&&(g+=4*n*7);for(var m=8,b=0,v=s.length;b<v;++b){var w=s[b];if(0===u&&(u=l,(p+=g)>=d&&(g=4*c+4*n*(m-1),p=f+(l+c)*(m<<1),m>>=1)),w===h)p+=4;else{var y=t[o+3*w],_=t[o+3*w+1],x=t[o+3*w+2];r[p++]=y,r[p++]=_,r[p++]=x,r[p++]=255}--u}}}function Ca(t,e,n,r){for(var i=t[e++],a=1<<i,o=a+1,h=o+1,l=i+1,c=(1<<l)-1,u=0,f=0,d=0,p=t[e++],g=new Int32Array(4096),m=null;;){for(;u<16&&0!==p;)f|=t[e++]<<u,u+=8,1===p?p=t[e++]:--p;if(u<l)break;var b=f&c;if(f>>=l,u-=l,b!==a){if(b===o)break;for(var v=b<h?b:m,w=0,y=v;y>a;)y=g[y]>>8,++w;var _=y;if(d+w+(v!==b?1:0)>r)return void s.log("Warning, gif stream longer than expected.");n[d++]=_;var x=d+=w;for(v!==b&&(n[d++]=_),y=v;w--;)y=g[y],n[--x]=255&y,y>>=8;null!==m&&h<4096&&(g[h++]=m<<8|_,h>=c+1&&l<12&&(++l,c=c<<1|1)),m=b}else h=o+1,c=(1<<(l=i+1))-1,m=null}return d!==r&&s.log("Warning, gif stream shorter than expected."),n}
/**
   * @license
    Copyright (c) 2008, Adobe Systems Incorporated
    All rights reserved.

    Redistribution and use in source and binary forms, with or without 
    modification, are permitted provided that the following conditions are
    met:

    * Redistributions of source code must retain the above copyright notice, 
      this list of conditions and the following disclaimer.
    
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the 
      documentation and/or other materials provided with the distribution.
    
    * Neither the name of Adobe Systems Incorporated nor the names of its 
      contributors may be used to endorse or promote products derived from 
      this software without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
    IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
    THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
    PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  */function ja(t){var e,n,r,i,a,s=Math.floor,o=new Array(64),h=new Array(64),l=new Array(64),c=new Array(64),u=new Array(65535),f=new Array(65535),d=new Array(64),p=new Array(64),g=[],m=0,b=7,v=new Array(64),w=new Array(64),y=new Array(64),_=new Array(256),x=new Array(2048),A=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],L=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],N=[0,1,2,3,4,5,6,7,8,9,10,11],S=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],k=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],P=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],I=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],C=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function j(t,e){for(var n=0,r=0,i=new Array,a=1;a<=16;a++){for(var s=1;s<=t[a];s++)i[e[r]]=[],i[e[r]][0]=n,i[e[r]][1]=a,r++,n++;n*=2}return i}function E(t){for(var e=t[0],n=t[1]-1;n>=0;)e&1<<n&&(m|=1<<b),n--,--b<0&&(255==m?(O(255),O(0)):O(m),b=7,m=0)}function O(t){g.push(t)}function B(t){O(t>>8&255),O(255&t)}function M(t,e,n,r,i){for(var a,s=i[0],o=i[240],h=function(t,e){var n,r,i,a,s,o,h,l,c,u,f=0;for(c=0;c<8;++c){n=t[f],r=t[f+1],i=t[f+2],a=t[f+3],s=t[f+4],o=t[f+5],h=t[f+6];var p=n+(l=t[f+7]),g=n-l,m=r+h,b=r-h,v=i+o,w=i-o,y=a+s,_=a-s,x=p+y,A=p-y,L=m+v,N=m-v;t[f]=x+L,t[f+4]=x-L;var S=.707106781*(N+A);t[f+2]=A+S,t[f+6]=A-S;var k=.382683433*((x=_+w)-(N=b+g)),P=.5411961*x+k,F=1.306562965*N+k,I=.707106781*(L=w+b),C=g+I,j=g-I;t[f+5]=j+P,t[f+3]=j-P,t[f+1]=C+F,t[f+7]=C-F,f+=8}for(f=0,c=0;c<8;++c){n=t[f],r=t[f+8],i=t[f+16],a=t[f+24],s=t[f+32],o=t[f+40],h=t[f+48];var E=n+(l=t[f+56]),O=n-l,B=r+h,M=r-h,R=i+o,T=i-o,q=a+s,D=a-s,z=E+q,U=E-q,H=B+R,W=B-R;t[f]=z+H,t[f+32]=z-H;var V=.707106781*(W+U);t[f+16]=U+V,t[f+48]=U-V;var G=.382683433*((z=D+T)-(W=M+O)),Y=.5411961*z+G,Z=1.306562965*W+G,J=.707106781*(H=T+M),X=O+J,K=O-J;t[f+40]=K+Y,t[f+24]=K-Y,t[f+8]=X+Z,t[f+56]=X-Z,f++}for(c=0;c<64;++c)u=t[c]*e[c],d[c]=u>0?u+.5|0:u-.5|0;return d}(t,e),l=0;l<64;++l)p[A[l]]=h[l];var c=p[0]-n;n=p[0],0==c?E(r[0]):(E(r[f[a=32767+c]]),E(u[a]));for(var g=63;g>0&&0==p[g];)g--;if(0==g)return E(s),n;for(var m,b=1;b<=g;){for(var v=b;0==p[b]&&b<=g;)++b;var w=b-v;if(w>=16){m=w>>4;for(var y=1;y<=m;++y)E(o);w&=15}a=32767+p[b],E(i[(w<<4)+f[a]]),E(u[a]),b++}return 63!=g&&E(s),n}function R(t){t=Math.min(Math.max(t,1),100),a!=t&&(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var r=s((e[n]*t+50)/100);r=Math.min(Math.max(r,1),255),o[A[n]]=r}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var u=s((i[a]*t+50)/100);u=Math.min(Math.max(u,1),255),h[A[a]]=u}for(var f=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],d=0,p=0;p<8;p++)for(var g=0;g<8;g++)l[d]=1/(o[A[d]]*f[p]*f[g]*8),c[d]=1/(h[A[d]]*f[p]*f[g]*8),d++}(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),a=t)}this.encode=function(t,a){a&&R(a),g=new Array,m=0,b=7,B(65496),B(65504),B(16),O(74),O(70),O(73),O(70),O(0),O(1),O(1),O(0),B(1),B(1),O(0),O(0),function(){B(65499),B(132),O(0);for(var t=0;t<64;t++)O(o[t]);O(1);for(var e=0;e<64;e++)O(h[e])}(),function(t,e){B(65472),B(17),O(8),B(e),B(t),O(3),O(1),O(17),O(0),O(2),O(17),O(1),O(3),O(17),O(1)}(t.width,t.height),function(){B(65476),B(418),O(0);for(var t=0;t<16;t++)O(L[t+1]);for(var e=0;e<=11;e++)O(N[e]);O(16);for(var n=0;n<16;n++)O(S[n+1]);for(var r=0;r<=161;r++)O(k[r]);O(1);for(var i=0;i<16;i++)O(P[i+1]);for(var a=0;a<=11;a++)O(F[a]);O(17);for(var s=0;s<16;s++)O(I[s+1]);for(var o=0;o<=161;o++)O(C[o])}(),B(65498),B(12),O(3),O(1),O(0),O(2),O(17),O(3),O(17),O(0),O(63),O(0);var s=0,u=0,f=0;m=0,b=7,this.encode.displayName="_encode_";for(var d,p,_,A,j,T,q,D,z,U=t.data,H=t.width,W=t.height,V=4*H,G=0;G<W;){for(d=0;d<V;){for(j=V*G+d,q=-1,D=0,z=0;z<64;z++)T=j+(D=z>>3)*V+(q=4*(7&z)),G+D>=W&&(T-=V*(G+1+D-W)),d+q>=V&&(T-=d+q-V+4),p=U[T++],_=U[T++],A=U[T++],v[z]=(x[p]+x[_+256|0]+x[A+512|0]>>16)-128,w[z]=(x[p+768|0]+x[_+1024|0]+x[A+1280|0]>>16)-128,y[z]=(x[p+1280|0]+x[_+1536|0]+x[A+1792|0]>>16)-128;s=M(v,l,s,e,r),u=M(w,c,u,n,i),f=M(y,c,f,n,i),d+=32}G+=8}if(b>=0){var Y=[];Y[1]=b+1,Y[0]=(1<<b+1)-1,E(Y)}return B(65497),new Uint8Array(g)},t=t||50,function(){for(var t=String.fromCharCode,e=0;e<256;e++)_[e]=t(e)}(),e=j(L,N),n=j(P,F),r=j(S,k),i=j(I,C),function(){for(var t=1,e=2,n=1;n<=15;n++){for(var r=t;r<e;r++)f[32767+r]=n,u[32767+r]=[],u[32767+r][1]=n,u[32767+r][0]=r;for(var i=-(e-1);i<=-t;i++)f[32767+i]=n,u[32767+i]=[],u[32767+i][1]=n,u[32767+i][0]=e-1+i;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)x[t]=19595*t,x[t+256|0]=38470*t,x[t+512|0]=7471*t+32768,x[t+768|0]=-11059*t,x[t+1024|0]=-21709*t,x[t+1280|0]=32768*t+8421375,x[t+1536|0]=-27439*t,x[t+1792|0]=-5329*t}(),R(t)}
/**
   * @license
   * Copyright (c) 2017 Aras Abbasi
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */function Ea(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Oa(t){function e(t){if(!t)throw Error("assert :P")}function n(t,e,n){for(var r=0;4>r;r++)if(t[e+r]!=n.charCodeAt(r))return!0;return!1}function r(t,e,n,r,i){for(var a=0;a<i;a++)t[e+a]=n[r+a]}function i(t,e,n,r){for(var i=0;i<r;i++)t[e+i]=n}function a(t){return new Int32Array(t)}function s(t,e){for(var n=[],r=0;r<t;r++)n.push(new e);return n}function o(t,e){var n=[];return function t(n,r,i){for(var a=i[r],s=0;s<a&&(n.push(i.length>r+1?[]:new e),!(i.length<r+1));s++)t(n[s],r+1,i)}(n,0,t),n}var h=function(){var t=this;function h(t,e){for(var n=1<<e-1>>>0;t&n;)n>>>=1;return n?(t&n-1)+n:t}function l(t,n,r,i,a){e(!(i%r));do{t[n+(i-=r)]=a}while(0<i)}function c(t,n,r,i,s){if(e(2328>=s),512>=s)var o=a(512);else if(null==(o=a(s)))return 0;return function(t,n,r,i,s,o){var c,f,d=n,p=1<<r,g=a(16),m=a(16);for(e(0!=s),e(null!=i),e(null!=t),e(0<r),f=0;f<s;++f){if(15<i[f])return 0;++g[i[f]]}if(g[0]==s)return 0;for(m[1]=0,c=1;15>c;++c){if(g[c]>1<<c)return 0;m[c+1]=m[c]+g[c]}for(f=0;f<s;++f)c=i[f],0<i[f]&&(o[m[c]++]=f);if(1==m[15])return(i=new u).g=0,i.value=o[0],l(t,d,1,p,i),p;var b,v=-1,w=p-1,y=0,_=1,x=1,A=1<<r;for(f=0,c=1,s=2;c<=r;++c,s<<=1){if(_+=x<<=1,0>(x-=g[c]))return 0;for(;0<g[c];--g[c])(i=new u).g=c,i.value=o[f++],l(t,d+y,s,A,i),y=h(y,c)}for(c=r+1,s=2;15>=c;++c,s<<=1){if(_+=x<<=1,0>(x-=g[c]))return 0;for(;0<g[c];--g[c]){if(i=new u,(y&w)!=v){for(d+=A,b=1<<(v=c)-r;15>v&&!(0>=(b-=g[v]));)++v,b<<=1;p+=A=1<<(b=v-r),t[n+(v=y&w)].g=b+r,t[n+v].value=d-n-v}i.g=c-r,i.value=o[f++],l(t,d+(y>>r),s,A,i),y=h(y,c)}}return _!=2*m[15]-1?0:p}(t,n,r,i,s,o)}function u(){this.value=this.g=0}function f(){this.value=this.g=0}function d(){this.G=s(5,u),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=s(Tn,f)}function p(t,n,r,i){e(null!=t),e(null!=n),e(2147483648>i),t.Ca=254,t.I=0,t.b=-8,t.Ka=0,t.oa=n,t.pa=r,t.Jd=n,t.Yc=r+i,t.Zc=4<=i?r+i-4+1:r,S(t)}function g(t,e){for(var n=0;0<e--;)n|=P(t,128)<<e;return n}function m(t,e){var n=g(t,e);return k(t)?-n:n}function b(t,n,r,i){var a,s=0;for(e(null!=t),e(null!=n),e(4294967288>i),t.Sb=i,t.Ra=0,t.u=0,t.h=0,4<i&&(i=4),a=0;a<i;++a)s+=n[r+a]<<8*a;t.Ra=s,t.bb=i,t.oa=n,t.pa=r}function v(t){for(;8<=t.u&&t.bb<t.Sb;)t.Ra>>>=8,t.Ra+=t.oa[t.pa+t.bb]<<zn-8>>>0,++t.bb,t.u-=8;A(t)&&(t.h=1,t.u=0)}function w(t,n){if(e(0<=n),!t.h&&n<=Dn){var r=x(t)&qn[n];return t.u+=n,v(t),r}return t.h=1,t.u=0}function y(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function _(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function x(t){return t.Ra>>>(t.u&zn-1)>>>0}function A(t){return e(t.bb<=t.Sb),t.h||t.bb==t.Sb&&t.u>zn}function L(t,e){t.u=e,t.h=A(t)}function N(t){t.u>=Un&&(e(t.u>=Un),v(t))}function S(t){e(null!=t&&null!=t.oa),t.pa<t.Zc?(t.I=(t.oa[t.pa++]|t.I<<8)>>>0,t.b+=8):(e(null!=t&&null!=t.oa),t.pa<t.Yc?(t.b+=8,t.I=t.oa[t.pa++]|t.I<<8):t.Ka?t.b=0:(t.I<<=8,t.b+=8,t.Ka=1))}function k(t){return g(t,1)}function P(t,e){var n=t.Ca;0>t.b&&S(t);var r=t.b,i=n*e>>>8,a=(t.I>>>r>i)+0;for(a?(n-=i,t.I-=i+1<<r>>>0):n=i+1,r=n,i=0;256<=r;)i+=8,r>>=8;return r=7^i+Hn[r],t.b-=r,t.Ca=(n<<r)-1,a}function F(t,e,n){t[e+0]=n>>24&255,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n}function I(t,e){return t[e+0]|t[e+1]<<8}function C(t,e){return I(t,e)|t[e+2]<<16}function j(t,e){return I(t,e)|I(t,e+2)<<16}function E(t,n){var r=1<<n;return e(null!=t),e(0<n),t.X=a(r),null==t.X?0:(t.Mb=32-n,t.Xa=n,1)}function O(t,n){e(null!=t),e(null!=n),e(t.Xa==n.Xa),r(n.X,0,t.X,0,1<<n.Xa)}function B(){this.X=[],this.Xa=this.Mb=0}function M(t,n,r,i){e(null!=r),e(null!=i);var a=r[0],s=i[0];return 0==a&&(a=(t*s+n/2)/n),0==s&&(s=(n*a+t/2)/t),0>=a||0>=s?0:(r[0]=a,i[0]=s,1)}function R(t,e){return t+(1<<e)-1>>>e}function T(t,e){return((4278255360&t)+(4278255360&e)>>>0&4278255360)+((16711935&t)+(16711935&e)>>>0&16711935)>>>0}function q(e,n){t[n]=function(n,r,i,a,s,o,h){var l;for(l=0;l<s;++l){var c=t[e](o[h+l-1],i,a+l);o[h+l]=T(n[r+l],c)}}}function D(){this.ud=this.hd=this.jd=0}function z(t,e){return((4278124286&(t^e))>>>1)+(t&e)>>>0}function U(t){return 0<=t&&256>t?t:0>t?0:255<t?255:void 0}function H(t,e){return U(t+(t-e+.5>>1))}function W(t,e,n){return Math.abs(e-n)-Math.abs(t-n)}function V(t,e,n,r,i,a,s){for(r=a[s-1],n=0;n<i;++n)a[s+n]=r=T(t[e+n],r)}function G(t,e,n,r,i){var a;for(a=0;a<n;++a){var s=t[e+a],o=s>>8&255,h=16711935&(h=(h=16711935&s)+((o<<16)+o));r[i+a]=(4278255360&s)+h>>>0}}function Y(t,e){e.jd=255&t,e.hd=t>>8&255,e.ud=t>>16&255}function Z(t,e,n,r,i,a){var s;for(s=0;s<r;++s){var o=e[n+s],h=o>>>8,l=o,c=255&(c=(c=o>>>16)+((t.jd<<24>>24)*(h<<24>>24)>>>5));l=255&(l=(l+=(t.hd<<24>>24)*(h<<24>>24)>>>5)+((t.ud<<24>>24)*(c<<24>>24)>>>5)),i[a+s]=(4278255360&o)+(c<<16)+l}}function J(e,n,r,i,a){t[n]=function(t,e,n,r,s,o,h,l,c){for(r=h;r<l;++r)for(h=0;h<c;++h)s[o++]=a(n[i(t[e++])])},t[e]=function(e,n,s,o,h,l,c){var u=8>>e.b,f=e.Ea,d=e.K[0],p=e.w;if(8>u)for(e=(1<<e.b)-1,p=(1<<u)-1;n<s;++n){var g,m=0;for(g=0;g<f;++g)g&e||(m=i(o[h++])),l[c++]=a(d[m&p]),m>>=u}else t["VP8LMapColor"+r](o,h,d,p,l,c,n,s,f)}}function X(t,e,n,r,i){for(n=e+n;e<n;){var a=t[e++];r[i++]=a>>16&255,r[i++]=a>>8&255,r[i++]=255&a}}function K(t,e,n,r,i){for(n=e+n;e<n;){var a=t[e++];r[i++]=a>>16&255,r[i++]=a>>8&255,r[i++]=255&a,r[i++]=a>>24&255}}function $(t,e,n,r,i){for(n=e+n;e<n;){var a=(s=t[e++])>>16&240|s>>12&15,s=240&s|s>>28&15;r[i++]=a,r[i++]=s}}function Q(t,e,n,r,i){for(n=e+n;e<n;){var a=(s=t[e++])>>16&248|s>>13&7,s=s>>5&224|s>>3&31;r[i++]=a,r[i++]=s}}function tt(t,e,n,r,i){for(n=e+n;e<n;){var a=t[e++];r[i++]=255&a,r[i++]=a>>8&255,r[i++]=a>>16&255}}function et(t,e,n,i,a,s){if(0==s)for(n=e+n;e<n;)F(i,((s=t[e++])[0]>>24|s[1]>>8&65280|s[2]<<8&16711680|s[3]<<24)>>>0),a+=32;else r(i,a,t,e,n)}function nt(e,n){t[n][0]=t[e+"0"],t[n][1]=t[e+"1"],t[n][2]=t[e+"2"],t[n][3]=t[e+"3"],t[n][4]=t[e+"4"],t[n][5]=t[e+"5"],t[n][6]=t[e+"6"],t[n][7]=t[e+"7"],t[n][8]=t[e+"8"],t[n][9]=t[e+"9"],t[n][10]=t[e+"10"],t[n][11]=t[e+"11"],t[n][12]=t[e+"12"],t[n][13]=t[e+"13"],t[n][14]=t[e+"0"],t[n][15]=t[e+"0"]}function rt(t){return t==Ur||t==Hr||t==Wr||t==Vr}function it(){this.eb=[],this.size=this.A=this.fb=0}function at(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function st(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new it,this.f.kb=new at,this.sd=null}function ot(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ht(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function lt(t){return alert("todo:WebPSamplerProcessPlane"),t.T}function ct(t,e){var n=t.T,i=e.ba.f.RGBA,a=i.eb,s=i.fb+t.ka*i.A,o=mi[e.ba.S],h=t.y,l=t.O,c=t.f,u=t.N,f=t.ea,d=t.W,p=e.cc,g=e.dc,m=e.Mc,b=e.Nc,v=t.ka,w=t.ka+t.T,y=t.U,_=y+1>>1;for(0==v?o(h,l,null,null,c,u,f,d,c,u,f,d,a,s,null,null,y):(o(e.ec,e.fc,h,l,p,g,m,b,c,u,f,d,a,s-i.A,a,s,y),++n);v+2<w;v+=2)p=c,g=u,m=f,b=d,u+=t.Rc,d+=t.Rc,s+=2*i.A,o(h,(l+=2*t.fa)-t.fa,h,l,p,g,m,b,c,u,f,d,a,s-i.A,a,s,y);return l+=t.fa,t.j+w<t.o?(r(e.ec,e.fc,h,l,y),r(e.cc,e.dc,c,u,_),r(e.Mc,e.Nc,f,d,_),n--):1&w||o(h,l,null,null,c,u,f,d,c,u,f,d,a,s+i.A,null,null,y),n}function ut(t,n,r){var i=t.F,a=[t.J];if(null!=i){var s=t.U,o=n.ba.S,h=o==qr||o==Wr;n=n.ba.f.RGBA;var l=[0],c=t.ka;l[0]=t.T,t.Kb&&(0==c?--l[0]:(--c,a[0]-=t.width),t.j+t.ka+t.T==t.o&&(l[0]=t.o-t.j-c));var u=n.eb;c=n.fb+c*n.A,t=Lr(i,a[0],t.width,s,l,u,c+(h?0:3),n.A),e(r==l),t&&rt(o)&&xr(u,c,h,s,l,n.A)}return 0}function ft(t){var e=t.ma,n=e.ba.S,r=11>n,i=n==Mr||n==Tr||n==qr||n==Dr||12==n||rt(n);if(e.memory=null,e.Ib=null,e.Jb=null,e.Nd=null,!Bn(e.Oa,t,i?11:12))return 0;if(i&&rt(n)&&vn(),t.da)alert("todo:use_scaling");else{if(r){if(e.Ib=lt,t.Kb){if(n=t.U+1>>1,e.memory=a(t.U+2*n),null==e.memory)return 0;e.ec=e.memory,e.fc=0,e.cc=e.ec,e.dc=e.fc+t.U,e.Mc=e.cc,e.Nc=e.dc+n,e.Ib=ct,vn()}}else alert("todo:EmitYUV");i&&(e.Jb=ut,r&&mn())}if(r&&!Ii){for(t=0;256>t;++t)Ci[t]=89858*(t-128)+Ni>>Li,Oi[t]=-22014*(t-128)+Ni,Ei[t]=-45773*(t-128),ji[t]=113618*(t-128)+Ni>>Li;for(t=Si;t<ki;++t)e=76283*(t-16)+Ni>>Li,Bi[t-Si]=Vt(e,255),Mi[t-Si]=Vt(e+8>>4,15);Ii=1}return 1}function dt(t){var n=t.ma,r=t.U,i=t.T;return e(!(1&t.ka)),0>=r||0>=i?0:(r=n.Ib(t,n),null!=n.Jb&&n.Jb(t,n,r),n.Dc+=r,1)}function pt(t){t.ma.memory=null}function gt(t,e,n,r){return 47!=w(t,8)?0:(e[0]=w(t,14)+1,n[0]=w(t,14)+1,r[0]=w(t,1),0!=w(t,3)?0:!t.h)}function mt(t,e){if(4>t)return t+1;var n=t-2>>1;return(2+(1&t)<<n)+w(e,n)+1}function bt(t,e){return 120<e?e-120:1<=(n=((n=Kr[e-1])>>4)*t+(8-(15&n)))?n:1;var n}function vt(t,e,n){var r=x(n),i=t[e+=255&r].g-8;return 0<i&&(L(n,n.u+8),r=x(n),e+=t[e].value,e+=r&(1<<i)-1),L(n,n.u+t[e].g),t[e].value}function wt(t,n,r){return r.g+=t.g,r.value+=t.value<<n>>>0,e(8>=r.g),t.g}function yt(t,n,r){var i=t.xc;return e((n=0==i?0:t.vc[t.md*(r>>i)+(n>>i)])<t.Wb),t.Ya[n]}function _t(t,n,i,a){var s=t.ab,o=t.c*n,h=t.C;n=h+n;var l=i,c=a;for(a=t.Ta,i=t.Ua;0<s--;){var u=t.gc[s],f=h,d=n,p=l,g=c,m=(c=a,l=i,u.Ea);switch(e(f<d),e(d<=u.nc),u.hc){case 2:Gn(p,g,(d-f)*m,c,l);break;case 0:var b=f,v=d,w=c,y=l,_=(S=u).Ea;0==b&&(Wn(p,g,null,null,1,w,y),V(p,g+1,0,0,_-1,w,y+1),g+=_,y+=_,++b);for(var x=1<<S.b,A=x-1,L=R(_,S.b),N=S.K,S=S.w+(b>>S.b)*L;b<v;){var k=N,P=S,F=1;for(Vn(p,g,w,y-_,1,w,y);F<_;){var I=(F&~A)+x;I>_&&(I=_),(0,Kn[k[P++]>>8&15])(p,g+ +F,w,y+F-_,I-F,w,y+F),F=I}g+=_,y+=_,++b&A||(S+=L)}d!=u.nc&&r(c,l-m,c,l+(d-f-1)*m,m);break;case 1:for(m=p,v=g,_=(p=u.Ea)-(y=p&~(w=(g=1<<u.b)-1)),b=R(p,u.b),x=u.K,u=u.w+(f>>u.b)*b;f<d;){for(A=x,L=u,N=new D,S=v+y,k=v+p;v<S;)Y(A[L++],N),$n(N,m,v,g,c,l),v+=g,l+=g;v<k&&(Y(A[L++],N),$n(N,m,v,_,c,l),v+=_,l+=_),++f&w||(u+=b)}break;case 3:if(p==c&&g==l&&0<u.b){for(v=c,p=m=l+(d-f)*m-(y=(d-f)*R(u.Ea,u.b)),g=c,w=l,b=[],y=(_=y)-1;0<=y;--y)b[y]=g[w+y];for(y=_-1;0<=y;--y)v[p+y]=b[y];Yn(u,f,d,c,m,c,l)}else Yn(u,f,d,p,g,c,l)}l=a,c=i}c!=i&&r(a,i,l,c,o)}function xt(t,n){var r=t.V,i=t.Ba+t.c*t.C,a=n-t.C;if(e(n<=t.l.o),e(16>=a),0<a){var s=t.l,o=t.Ta,h=t.Ua,l=s.width;if(_t(t,a,r,i),a=h=[h],e((r=t.C)<(i=n)),e(s.v<s.va),i>s.o&&(i=s.o),r<s.j){var c=s.j-r;r=s.j,a[0]+=c*l}if(r>=i?r=0:(a[0]+=4*s.v,s.ka=r-s.j,s.U=s.va-s.v,s.T=i-r,r=1),r){if(h=h[0],11>(r=t.ca).S){var u=r.f.RGBA,f=(i=r.S,a=s.U,s=s.T,c=u.eb,u.A),d=s;for(u=u.fb+t.Ma*u.A;0<d--;){var p=o,g=h,m=a,b=c,v=u;switch(i){case Br:Qn(p,g,m,b,v);break;case Mr:tr(p,g,m,b,v);break;case Ur:tr(p,g,m,b,v),xr(b,v,0,m,1,0);break;case Rr:rr(p,g,m,b,v);break;case Tr:et(p,g,m,b,v,1);break;case Hr:et(p,g,m,b,v,1),xr(b,v,0,m,1,0);break;case qr:et(p,g,m,b,v,0);break;case Wr:et(p,g,m,b,v,0),xr(b,v,1,m,1,0);break;case Dr:er(p,g,m,b,v);break;case Vr:er(p,g,m,b,v),Ar(b,v,m,1,0);break;case zr:nr(p,g,m,b,v);break;default:e(0)}h+=l,u+=f}t.Ma+=s}else alert("todo:EmitRescaledRowsYUVA");e(t.Ma<=r.height)}}t.C=n,e(t.C<=t.i)}function At(t){var e;if(0<t.ua)return 0;for(e=0;e<t.Wb;++e){var n=t.Ya[e].G,r=t.Ya[e].H;if(0<n[1][r[1]+0].g||0<n[2][r[2]+0].g||0<n[3][r[3]+0].g)return 0}return 1}function Lt(t,n,r,i,a,s){if(0!=t.Z){var o=t.qd,h=t.rd;for(e(null!=gi[t.Z]);n<r;++n)gi[t.Z](o,h,i,a,i,a,s),o=i,h=a,a+=s;t.qd=o,t.rd=h}}function Nt(t,n){var r=t.l.ma,i=0==r.Z||1==r.Z?t.l.j:t.C;if(i=t.C<i?i:t.C,e(n<=t.l.o),n>i){var a=t.l.width,s=r.ca,o=r.tb+a*i,h=t.V,l=t.Ba+t.c*i,c=t.gc;e(1==t.ab),e(3==c[0].hc),Jn(c[0],i,n,h,l,s,o),Lt(r,i,n,s,o,a)}t.C=t.Ma=n}function St(t,n,r,i,a,s,o){var h=t.$/i,l=t.$%i,c=t.m,u=t.s,f=r+t.$,d=f;a=r+i*a;var p=r+i*s,g=280+u.ua,m=t.Pb?h:16777216,b=0<u.ua?u.Wa:null,v=u.wc,w=f<p?yt(u,l,h):null;e(t.C<s),e(p<=a);var y=!1;t:for(;;){for(;y||f<p;){var _=0;if(h>=m){var S=f-r;e((m=t).Pb),m.wd=m.m,m.xd=S,0<m.s.ua&&O(m.s.Wa,m.s.vb),m=h+Qr}if(l&v||(w=yt(u,l,h)),e(null!=w),w.Qb&&(n[f]=w.qb,y=!0),!y)if(N(c),w.jc){_=c,S=n;var k=f,P=w.pd[x(_)&Tn-1];e(w.jc),256>P.g?(L(_,_.u+P.g),S[k]=P.value,_=0):(L(_,_.u+P.g-256),e(256<=P.value),_=P.value),0==_&&(y=!0)}else _=vt(w.G[0],w.H[0],c);if(c.h)break;if(y||256>_){if(!y)if(w.nd)n[f]=(w.qb|_<<8)>>>0;else{if(N(c),y=vt(w.G[1],w.H[1],c),N(c),S=vt(w.G[2],w.H[2],c),k=vt(w.G[3],w.H[3],c),c.h)break;n[f]=(k<<24|y<<16|_<<8|S)>>>0}if(y=!1,++f,++l>=i&&(l=0,++h,null!=o&&h<=s&&!(h%16)&&o(t,h),null!=b))for(;d<f;)_=n[d++],b.X[(506832829*_&4294967295)>>>b.Mb]=_}else if(280>_){if(_=mt(_-256,c),S=vt(w.G[4],w.H[4],c),N(c),S=bt(i,S=mt(S,c)),c.h)break;if(f-r<S||a-f<_)break t;for(k=0;k<_;++k)n[f+k]=n[f+k-S];for(f+=_,l+=_;l>=i;)l-=i,++h,null!=o&&h<=s&&!(h%16)&&o(t,h);if(e(f<=a),l&v&&(w=yt(u,l,h)),null!=b)for(;d<f;)_=n[d++],b.X[(506832829*_&4294967295)>>>b.Mb]=_}else{if(!(_<g))break t;for(y=_-280,e(null!=b);d<f;)_=n[d++],b.X[(506832829*_&4294967295)>>>b.Mb]=_;_=f,e(!(y>>>(S=b).Xa)),n[_]=S.X[y],y=!0}y||e(c.h==A(c))}if(t.Pb&&c.h&&f<a)e(t.m.h),t.a=5,t.m=t.wd,t.$=t.xd,0<t.s.ua&&O(t.s.vb,t.s.Wa);else{if(c.h)break t;null!=o&&o(t,h>s?s:h),t.a=0,t.$=f-r}return 1}return t.a=3,0}function kt(t){e(null!=t),t.vc=null,t.yc=null,t.Ya=null;var n=t.Wa;null!=n&&(n.X=null),t.vb=null,e(null!=t)}function Pt(){var e=new sn;return null==e?null:(e.a=0,e.xb=pi,nt("Predictor","VP8LPredictors"),nt("Predictor","VP8LPredictors_C"),nt("PredictorAdd","VP8LPredictorsAdd"),nt("PredictorAdd","VP8LPredictorsAdd_C"),Gn=G,$n=Z,Qn=X,tr=K,er=$,nr=Q,rr=tt,t.VP8LMapColor32b=Zn,t.VP8LMapColor8b=Xn,e)}function Ft(t,n,r,o,h){var l=1,f=[t],p=[n],g=o.m,m=o.s,b=null,v=0;t:for(;;){if(r)for(;l&&w(g,1);){var y=f,_=p,A=o,S=1,k=A.m,P=A.gc[A.ab],F=w(k,2);if(A.Oc&1<<F)l=0;else{switch(A.Oc|=1<<F,P.hc=F,P.Ea=y[0],P.nc=_[0],P.K=[null],++A.ab,e(4>=A.ab),F){case 0:case 1:P.b=w(k,3)+2,S=Ft(R(P.Ea,P.b),R(P.nc,P.b),0,A,P.K),P.K=P.K[0];break;case 3:var I,C=w(k,8)+1,j=16<C?0:4<C?1:2<C?2:3;if(y[0]=R(P.Ea,j),P.b=j,I=S=Ft(C,1,0,A,P.K)){var O,B=C,M=P,q=1<<(8>>M.b),D=a(q);if(null==D)I=0;else{var z=M.K[0],U=M.w;for(D[0]=M.K[0][0],O=1;O<1*B;++O)D[O]=T(z[U+O],D[O-1]);for(;O<4*q;++O)D[O]=0;M.K[0]=null,M.K[0]=D,I=1}}S=I;break;case 2:break;default:e(0)}l=S}}if(f=f[0],p=p[0],l&&w(g,1)&&!(l=1<=(v=w(g,4))&&11>=v)){o.a=3;break t}var H;if(H=l)e:{var W,V,G,Y=o,Z=f,J=p,X=v,K=r,$=Y.m,Q=Y.s,tt=[null],et=1,nt=0,rt=$r[X];n:for(;;){if(K&&w($,1)){var it=w($,3)+2,at=R(Z,it),st=R(J,it),ot=at*st;if(!Ft(at,st,0,Y,tt))break n;for(tt=tt[0],Q.xc=it,W=0;W<ot;++W){var ht=tt[W]>>8&65535;tt[W]=ht,ht>=et&&(et=ht+1)}}if($.h)break n;for(V=0;5>V;++V){var lt=Zr[V];!V&&0<X&&(lt+=1<<X),nt<lt&&(nt=lt)}var ct=s(et*rt,u),ut=et,ft=s(ut,d);if(null==ft)var dt=null;else e(65536>=ut),dt=ft;var pt=a(nt);if(null==dt||null==pt||null==ct){Y.a=1;break n}var gt=ct;for(W=G=0;W<et;++W){var mt=dt[W],bt=mt.G,vt=mt.H,yt=0,_t=1,xt=0;for(V=0;5>V;++V){lt=Zr[V],bt[V]=gt,vt[V]=G,!V&&0<X&&(lt+=1<<X);r:{var At,Lt=lt,Nt=Y,Pt=pt,It=gt,Ct=G,jt=0,Et=Nt.m,Ot=w(Et,1);if(i(Pt,0,0,Lt),Ot){var Bt=w(Et,1)+1,Mt=w(Et,1),Rt=w(Et,0==Mt?1:8);Pt[Rt]=1,2==Bt&&(Pt[Rt=w(Et,8)]=1);var Tt=1}else{var qt=a(19),Dt=w(Et,4)+4;if(19<Dt){Nt.a=3;var zt=0;break r}for(At=0;At<Dt;++At)qt[Xr[At]]=w(Et,3);var Ut=void 0,Ht=void 0,Wt=Nt,Vt=qt,Gt=Lt,Yt=Pt,Zt=0,Jt=Wt.m,Xt=8,Kt=s(128,u);i:for(;c(Kt,0,7,Vt,19);){if(w(Jt,1)){var $t=2+2*w(Jt,3);if((Ut=2+w(Jt,$t))>Gt)break i}else Ut=Gt;for(Ht=0;Ht<Gt&&Ut--;){N(Jt);var Qt=Kt[0+(127&x(Jt))];L(Jt,Jt.u+Qt.g);var te=Qt.value;if(16>te)Yt[Ht++]=te,0!=te&&(Xt=te);else{var ee=16==te,ne=te-16,re=Yr[ne],ie=w(Jt,Gr[ne])+re;if(Ht+ie>Gt)break i;for(var ae=ee?Xt:0;0<ie--;)Yt[Ht++]=ae}}Zt=1;break i}Zt||(Wt.a=3),Tt=Zt}(Tt=Tt&&!Et.h)&&(jt=c(It,Ct,8,Pt,Lt)),Tt&&0!=jt?zt=jt:(Nt.a=3,zt=0)}if(0==zt)break n;if(_t&&1==Jr[V]&&(_t=0==gt[G].g),yt+=gt[G].g,G+=zt,3>=V){var se,oe=pt[0];for(se=1;se<lt;++se)pt[se]>oe&&(oe=pt[se]);xt+=oe}}if(mt.nd=_t,mt.Qb=0,_t&&(mt.qb=(bt[3][vt[3]+0].value<<24|bt[1][vt[1]+0].value<<16|bt[2][vt[2]+0].value)>>>0,0==yt&&256>bt[0][vt[0]+0].value&&(mt.Qb=1,mt.qb+=bt[0][vt[0]+0].value<<8)),mt.jc=!mt.Qb&&6>xt,mt.jc){var he,le=mt;for(he=0;he<Tn;++he){var ce=he,ue=le.pd[ce],fe=le.G[0][le.H[0]+ce];256<=fe.value?(ue.g=fe.g+256,ue.value=fe.value):(ue.g=0,ue.value=0,ce>>=wt(fe,8,ue),ce>>=wt(le.G[1][le.H[1]+ce],16,ue),ce>>=wt(le.G[2][le.H[2]+ce],0,ue),wt(le.G[3][le.H[3]+ce],24,ue))}}}Q.vc=tt,Q.Wb=et,Q.Ya=dt,Q.yc=ct,H=1;break e}H=0}if(!(l=H)){o.a=3;break t}if(0<v){if(m.ua=1<<v,!E(m.Wa,v)){o.a=1,l=0;break t}}else m.ua=0;var de=o,pe=f,ge=p,me=de.s,be=me.xc;if(de.c=pe,de.i=ge,me.md=R(pe,be),me.wc=0==be?-1:(1<<be)-1,r){o.xb=di;break t}if(null==(b=a(f*p))){o.a=1,l=0;break t}l=(l=St(o,b,0,f,p,p,null))&&!g.h;break t}return l?(null!=h?h[0]=b:(e(null==b),e(r)),o.$=0,r||kt(m)):kt(m),l}function It(t,n){var r=t.c*t.i,i=r+n+16*n;return e(t.c<=n),t.V=a(i),null==t.V?(t.Ta=null,t.Ua=0,t.a=1,0):(t.Ta=t.V,t.Ua=t.Ba+r+n,1)}function Ct(t,n){var r=t.C,i=n-r,a=t.V,s=t.Ba+t.c*r;for(e(n<=t.l.o);0<i;){var o=16<i?16:i,h=t.l.ma,l=t.l.width,c=l*o,u=h.ca,f=h.tb+l*r,d=t.Ta,p=t.Ua;_t(t,o,a,s),Nr(d,p,u,f,c),Lt(h,r,r+o,u,f,l),i-=o,a+=o*t.c,r+=o}e(r==n),t.C=t.Ma=n}function jt(){this.ub=this.yd=this.td=this.Rb=0}function Et(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Ot(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function Bt(){this.Yb=function(){var t=[];return function t(e,n,r){for(var i=r[n],a=0;a<i&&(e.push(r.length>n+1?[]:0),!(r.length<n+1));a++)t(e[a],n+1,r)}(t,0,[3,11]),t}()}function Mt(){this.jb=a(3),this.Wc=o([4,8],Bt),this.Xc=o([4,17],Bt)}function Rt(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function Tt(){this.ld=this.La=this.dd=this.tc=0}function qt(){this.Na=this.la=0}function Dt(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function zt(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Ut(){this.uc=this.M=this.Nb=0,this.wa=Array(new Tt),this.Y=0,this.ya=Array(new zt),this.aa=0,this.l=new Gt}function Ht(){this.y=a(16),this.f=a(8),this.ea=a(8)}function Wt(){this.cb=this.a=0,this.sc="",this.m=new y,this.Od=new jt,this.Kc=new Et,this.ed=new Rt,this.Qa=new Ot,this.Ic=this.$c=this.Aa=0,this.D=new Ut,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=s(8,y),this.ia=0,this.pb=s(4,Dt),this.Pa=new Mt,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ht),this.Hd=0,this.rb=Array(new qt),this.sb=0,this.wa=Array(new Tt),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new zt),this.L=this.aa=0,this.gd=o([4,2],Tt),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Vt(t,e){return 0>t?0:t>e?e:t}function Gt(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Yt(){var t=new Wt;return null!=t&&(t.a=0,t.sc="OK",t.cb=0,t.Xb=0,ni||(ni=Kt)),t}function Zt(t,e,n){return 0==t.a&&(t.a=e,t.sc=n,t.cb=0),0}function Jt(t,e,n){return 3<=n&&157==t[e+0]&&1==t[e+1]&&42==t[e+2]}function Xt(t,n){if(null==t)return 0;if(t.a=0,t.sc="OK",null==n)return Zt(t,2,"null VP8Io passed to VP8GetHeaders()");var r=n.data,a=n.w,s=n.ha;if(4>s)return Zt(t,7,"Truncated header.");var o=r[a+0]|r[a+1]<<8|r[a+2]<<16,h=t.Od;if(h.Rb=!(1&o),h.td=o>>1&7,h.yd=o>>4&1,h.ub=o>>5,3<h.td)return Zt(t,3,"Incorrect keyframe parameters.");if(!h.yd)return Zt(t,4,"Frame not displayable.");a+=3,s-=3;var l=t.Kc;if(h.Rb){if(7>s)return Zt(t,7,"cannot parse picture header");if(!Jt(r,a,s))return Zt(t,3,"Bad code word");l.c=16383&(r[a+4]<<8|r[a+3]),l.Td=r[a+4]>>6,l.i=16383&(r[a+6]<<8|r[a+5]),l.Ud=r[a+6]>>6,a+=7,s-=7,t.za=l.c+15>>4,t.Ub=l.i+15>>4,n.width=l.c,n.height=l.i,n.Da=0,n.j=0,n.v=0,n.va=n.width,n.o=n.height,n.da=0,n.ib=n.width,n.hb=n.height,n.U=n.width,n.T=n.height,i((o=t.Pa).jb,0,255,o.jb.length),e(null!=(o=t.Qa)),o.Cb=0,o.Bb=0,o.Fb=1,i(o.Zb,0,0,o.Zb.length),i(o.Lb,0,0,o.Lb)}if(h.ub>s)return Zt(t,7,"bad partition length");p(o=t.m,r,a,h.ub),a+=h.ub,s-=h.ub,h.Rb&&(l.Ld=k(o),l.Kd=k(o)),l=t.Qa;var c,u=t.Pa;if(e(null!=o),e(null!=l),l.Cb=k(o),l.Cb){if(l.Bb=k(o),k(o)){for(l.Fb=k(o),c=0;4>c;++c)l.Zb[c]=k(o)?m(o,7):0;for(c=0;4>c;++c)l.Lb[c]=k(o)?m(o,6):0}if(l.Bb)for(c=0;3>c;++c)u.jb[c]=k(o)?g(o,8):255}else l.Bb=0;if(o.Ka)return Zt(t,3,"cannot parse segment header");if((l=t.ed).zd=k(o),l.Tb=g(o,6),l.wb=g(o,3),l.Pc=k(o),l.Pc&&k(o)){for(u=0;4>u;++u)k(o)&&(l.vd[u]=m(o,6));for(u=0;4>u;++u)k(o)&&(l.od[u]=m(o,6))}if(t.L=0==l.Tb?0:l.zd?1:2,o.Ka)return Zt(t,3,"cannot parse filter header");var f=s;if(s=c=a,a=c+f,l=f,t.Xb=(1<<g(t.m,2))-1,f<3*(u=t.Xb))r=7;else{for(c+=3*u,l-=3*u,f=0;f<u;++f){var d=r[s+0]|r[s+1]<<8|r[s+2]<<16;d>l&&(d=l),p(t.Jc[+f],r,c,d),c+=d,l-=d,s+=3}p(t.Jc[+u],r,c,l),r=c<a?0:5}if(0!=r)return Zt(t,r,"cannot parse partitions");for(r=g(c=t.m,7),s=k(c)?m(c,4):0,a=k(c)?m(c,4):0,l=k(c)?m(c,4):0,u=k(c)?m(c,4):0,c=k(c)?m(c,4):0,f=t.Qa,d=0;4>d;++d){if(f.Cb){var b=f.Zb[d];f.Fb||(b+=r)}else{if(0<d){t.pb[d]=t.pb[0];continue}b=r}var v=t.pb[d];v.Sc[0]=ti[Vt(b+s,127)],v.Sc[1]=ei[Vt(b+0,127)],v.Eb[0]=2*ti[Vt(b+a,127)],v.Eb[1]=101581*ei[Vt(b+l,127)]>>16,8>v.Eb[1]&&(v.Eb[1]=8),v.Qc[0]=ti[Vt(b+u,117)],v.Qc[1]=ei[Vt(b+c,127)],v.lc=b+c}if(!h.Rb)return Zt(t,4,"Not a key frame.");for(k(o),h=t.Pa,r=0;4>r;++r){for(s=0;8>s;++s)for(a=0;3>a;++a)for(l=0;11>l;++l)u=P(o,hi[r][s][a][l])?g(o,8):si[r][s][a][l],h.Wc[r][s].Yb[a][l]=u;for(s=0;17>s;++s)h.Xc[r][s]=h.Wc[r][li[s]]}return t.kc=k(o),t.kc&&(t.Bd=g(o,8)),t.cb=1}function Kt(t,e,n,r,i,a,s){var o=e[i].Yb[n];for(n=0;16>i;++i){if(!P(t,o[n+0]))return i;for(;!P(t,o[n+1]);)if(o=e[++i].Yb[0],n=0,16==i)return 16;var h=e[i+1].Yb;if(P(t,o[n+2])){var l=t,c=0;if(P(l,(f=o)[(u=n)+3]))if(P(l,f[u+6])){for(o=0,u=2*(c=P(l,f[u+8]))+(f=P(l,f[u+9+c])),c=0,f=ri[u];f[o];++o)c+=c+P(l,f[o]);c+=3+(8<<u)}else P(l,f[u+7])?(c=7+2*P(l,165),c+=P(l,145)):c=5+P(l,159);else c=P(l,f[u+4])?3+P(l,f[u+5]):2;o=h[2]}else c=1,o=h[1];h=s+ii[i],0>(l=t).b&&S(l);var u,f=l.b,d=(u=l.Ca>>1)-(l.I>>f)>>31;--l.b,l.Ca+=d,l.Ca|=1,l.I-=(u+1&d)<<f,a[h]=((c^d)-d)*r[(0<i)+0]}return 16}function $t(t){var e=t.rb[t.sb-1];e.la=0,e.Na=0,i(t.zc,0,0,t.zc.length),t.ja=0}function Qt(t,e,n,r,i){i=t[e+n+32*r]+(i>>3),t[e+n+32*r]=-256&i?0>i?0:255:i}function te(t,e,n,r,i,a){Qt(t,e,0,n,r+i),Qt(t,e,1,n,r+a),Qt(t,e,2,n,r-a),Qt(t,e,3,n,r-i)}function ee(t){return(20091*t>>16)+t}function ne(t,e,n,r){var i,s=0,o=a(16);for(i=0;4>i;++i){var h=t[e+0]+t[e+8],l=t[e+0]-t[e+8],c=(35468*t[e+4]>>16)-ee(t[e+12]),u=ee(t[e+4])+(35468*t[e+12]>>16);o[s+0]=h+u,o[s+1]=l+c,o[s+2]=l-c,o[s+3]=h-u,s+=4,e++}for(i=s=0;4>i;++i)h=(t=o[s+0]+4)+o[s+8],l=t-o[s+8],c=(35468*o[s+4]>>16)-ee(o[s+12]),Qt(n,r,0,0,h+(u=ee(o[s+4])+(35468*o[s+12]>>16))),Qt(n,r,1,0,l+c),Qt(n,r,2,0,l-c),Qt(n,r,3,0,h-u),s++,r+=32}function re(t,e,n,r){var i=t[e+0]+4,a=35468*t[e+4]>>16,s=ee(t[e+4]),o=35468*t[e+1]>>16;te(n,r,0,i+s,t=ee(t[e+1]),o),te(n,r,1,i+a,t,o),te(n,r,2,i-a,t,o),te(n,r,3,i-s,t,o)}function ie(t,e,n,r,i){ne(t,e,n,r),i&&ne(t,e+16,n,r+4)}function ae(t,e,n,r){ar(t,e+0,n,r,1),ar(t,e+32,n,r+128,1)}function se(t,e,n,r){var i;for(t=t[e+0]+4,i=0;4>i;++i)for(e=0;4>e;++e)Qt(n,r,e,i,t)}function oe(t,e,n,r){t[e+0]&&hr(t,e+0,n,r),t[e+16]&&hr(t,e+16,n,r+4),t[e+32]&&hr(t,e+32,n,r+128),t[e+48]&&hr(t,e+48,n,r+128+4)}function he(t,e,n,r){var i,s=a(16);for(i=0;4>i;++i){var o=t[e+0+i]+t[e+12+i],h=t[e+4+i]+t[e+8+i],l=t[e+4+i]-t[e+8+i],c=t[e+0+i]-t[e+12+i];s[0+i]=o+h,s[8+i]=o-h,s[4+i]=c+l,s[12+i]=c-l}for(i=0;4>i;++i)o=(t=s[0+4*i]+3)+s[3+4*i],h=s[1+4*i]+s[2+4*i],l=s[1+4*i]-s[2+4*i],c=t-s[3+4*i],n[r+0]=o+h>>3,n[r+16]=c+l>>3,n[r+32]=o-h>>3,n[r+48]=c-l>>3,r+=64}function le(t,e,n){var r,i=e-32,a=Er,s=255-t[i-1];for(r=0;r<n;++r){var o,h=a,l=s+t[e-1];for(o=0;o<n;++o)t[e+o]=h[l+t[i+o]];e+=32}}function ce(t,e){le(t,e,4)}function ue(t,e){le(t,e,8)}function fe(t,e){le(t,e,16)}function de(t,e){var n;for(n=0;16>n;++n)r(t,e+32*n,t,e-32,16)}function pe(t,e){var n;for(n=16;0<n;--n)i(t,e,t[e-1],16),e+=32}function ge(t,e,n){var r;for(r=0;16>r;++r)i(e,n+32*r,t,16)}function me(t,e){var n,r=16;for(n=0;16>n;++n)r+=t[e-1+32*n]+t[e+n-32];ge(r>>5,t,e)}function be(t,e){var n,r=8;for(n=0;16>n;++n)r+=t[e-1+32*n];ge(r>>4,t,e)}function ve(t,e){var n,r=8;for(n=0;16>n;++n)r+=t[e+n-32];ge(r>>4,t,e)}function we(t,e){ge(128,t,e)}function ye(t,e,n){return t+2*e+n+2>>2}function _e(t,e){var n,i=e-32;for(i=new Uint8Array([ye(t[i-1],t[i+0],t[i+1]),ye(t[i+0],t[i+1],t[i+2]),ye(t[i+1],t[i+2],t[i+3]),ye(t[i+2],t[i+3],t[i+4])]),n=0;4>n;++n)r(t,e+32*n,i,0,i.length)}function xe(t,e){var n=t[e-1],r=t[e-1+32],i=t[e-1+64],a=t[e-1+96];F(t,e+0,16843009*ye(t[e-1-32],n,r)),F(t,e+32,16843009*ye(n,r,i)),F(t,e+64,16843009*ye(r,i,a)),F(t,e+96,16843009*ye(i,a,a))}function Ae(t,e){var n,r=4;for(n=0;4>n;++n)r+=t[e+n-32]+t[e-1+32*n];for(r>>=3,n=0;4>n;++n)i(t,e+32*n,r,4)}function Le(t,e){var n=t[e-1+0],r=t[e-1+32],i=t[e-1+64],a=t[e-1-32],s=t[e+0-32],o=t[e+1-32],h=t[e+2-32],l=t[e+3-32];t[e+0+96]=ye(r,i,t[e-1+96]),t[e+1+96]=t[e+0+64]=ye(n,r,i),t[e+2+96]=t[e+1+64]=t[e+0+32]=ye(a,n,r),t[e+3+96]=t[e+2+64]=t[e+1+32]=t[e+0+0]=ye(s,a,n),t[e+3+64]=t[e+2+32]=t[e+1+0]=ye(o,s,a),t[e+3+32]=t[e+2+0]=ye(h,o,s),t[e+3+0]=ye(l,h,o)}function Ne(t,e){var n=t[e+1-32],r=t[e+2-32],i=t[e+3-32],a=t[e+4-32],s=t[e+5-32],o=t[e+6-32],h=t[e+7-32];t[e+0+0]=ye(t[e+0-32],n,r),t[e+1+0]=t[e+0+32]=ye(n,r,i),t[e+2+0]=t[e+1+32]=t[e+0+64]=ye(r,i,a),t[e+3+0]=t[e+2+32]=t[e+1+64]=t[e+0+96]=ye(i,a,s),t[e+3+32]=t[e+2+64]=t[e+1+96]=ye(a,s,o),t[e+3+64]=t[e+2+96]=ye(s,o,h),t[e+3+96]=ye(o,h,h)}function Se(t,e){var n=t[e-1+0],r=t[e-1+32],i=t[e-1+64],a=t[e-1-32],s=t[e+0-32],o=t[e+1-32],h=t[e+2-32],l=t[e+3-32];t[e+0+0]=t[e+1+64]=a+s+1>>1,t[e+1+0]=t[e+2+64]=s+o+1>>1,t[e+2+0]=t[e+3+64]=o+h+1>>1,t[e+3+0]=h+l+1>>1,t[e+0+96]=ye(i,r,n),t[e+0+64]=ye(r,n,a),t[e+0+32]=t[e+1+96]=ye(n,a,s),t[e+1+32]=t[e+2+96]=ye(a,s,o),t[e+2+32]=t[e+3+96]=ye(s,o,h),t[e+3+32]=ye(o,h,l)}function ke(t,e){var n=t[e+0-32],r=t[e+1-32],i=t[e+2-32],a=t[e+3-32],s=t[e+4-32],o=t[e+5-32],h=t[e+6-32],l=t[e+7-32];t[e+0+0]=n+r+1>>1,t[e+1+0]=t[e+0+64]=r+i+1>>1,t[e+2+0]=t[e+1+64]=i+a+1>>1,t[e+3+0]=t[e+2+64]=a+s+1>>1,t[e+0+32]=ye(n,r,i),t[e+1+32]=t[e+0+96]=ye(r,i,a),t[e+2+32]=t[e+1+96]=ye(i,a,s),t[e+3+32]=t[e+2+96]=ye(a,s,o),t[e+3+64]=ye(s,o,h),t[e+3+96]=ye(o,h,l)}function Pe(t,e){var n=t[e-1+0],r=t[e-1+32],i=t[e-1+64],a=t[e-1+96];t[e+0+0]=n+r+1>>1,t[e+2+0]=t[e+0+32]=r+i+1>>1,t[e+2+32]=t[e+0+64]=i+a+1>>1,t[e+1+0]=ye(n,r,i),t[e+3+0]=t[e+1+32]=ye(r,i,a),t[e+3+32]=t[e+1+64]=ye(i,a,a),t[e+3+64]=t[e+2+64]=t[e+0+96]=t[e+1+96]=t[e+2+96]=t[e+3+96]=a}function Fe(t,e){var n=t[e-1+0],r=t[e-1+32],i=t[e-1+64],a=t[e-1+96],s=t[e-1-32],o=t[e+0-32],h=t[e+1-32],l=t[e+2-32];t[e+0+0]=t[e+2+32]=n+s+1>>1,t[e+0+32]=t[e+2+64]=r+n+1>>1,t[e+0+64]=t[e+2+96]=i+r+1>>1,t[e+0+96]=a+i+1>>1,t[e+3+0]=ye(o,h,l),t[e+2+0]=ye(s,o,h),t[e+1+0]=t[e+3+32]=ye(n,s,o),t[e+1+32]=t[e+3+64]=ye(r,n,s),t[e+1+64]=t[e+3+96]=ye(i,r,n),t[e+1+96]=ye(a,i,r)}function Ie(t,e){var n;for(n=0;8>n;++n)r(t,e+32*n,t,e-32,8)}function Ce(t,e){var n;for(n=0;8>n;++n)i(t,e,t[e-1],8),e+=32}function je(t,e,n){var r;for(r=0;8>r;++r)i(e,n+32*r,t,8)}function Ee(t,e){var n,r=8;for(n=0;8>n;++n)r+=t[e+n-32]+t[e-1+32*n];je(r>>4,t,e)}function Oe(t,e){var n,r=4;for(n=0;8>n;++n)r+=t[e+n-32];je(r>>3,t,e)}function Be(t,e){var n,r=4;for(n=0;8>n;++n)r+=t[e-1+32*n];je(r>>3,t,e)}function Me(t,e){je(128,t,e)}function Re(t,e,n){var r=t[e-n],i=t[e+0],a=3*(i-r)+Cr[1020+t[e-2*n]-t[e+n]],s=jr[112+(a+4>>3)];t[e-n]=Er[255+r+jr[112+(a+3>>3)]],t[e+0]=Er[255+i-s]}function Te(t,e,n,r){var i=t[e+0],a=t[e+n];return Or[255+t[e-2*n]-t[e-n]]>r||Or[255+a-i]>r}function qe(t,e,n,r){return 4*Or[255+t[e-n]-t[e+0]]+Or[255+t[e-2*n]-t[e+n]]<=r}function De(t,e,n,r,i){var a=t[e-3*n],s=t[e-2*n],o=t[e-n],h=t[e+0],l=t[e+n],c=t[e+2*n],u=t[e+3*n];return 4*Or[255+o-h]+Or[255+s-l]>r?0:Or[255+t[e-4*n]-a]<=i&&Or[255+a-s]<=i&&Or[255+s-o]<=i&&Or[255+u-c]<=i&&Or[255+c-l]<=i&&Or[255+l-h]<=i}function ze(t,e,n,r){var i=2*r+1;for(r=0;16>r;++r)qe(t,e+r,n,i)&&Re(t,e+r,n)}function Ue(t,e,n,r){var i=2*r+1;for(r=0;16>r;++r)qe(t,e+r*n,1,i)&&Re(t,e+r*n,1)}function He(t,e,n,r){var i;for(i=3;0<i;--i)ze(t,e+=4*n,n,r)}function We(t,e,n,r){var i;for(i=3;0<i;--i)Ue(t,e+=4,n,r)}function Ve(t,e,n,r,i,a,s,o){for(a=2*a+1;0<i--;){if(De(t,e,n,a,s))if(Te(t,e,n,o))Re(t,e,n);else{var h=t,l=e,c=n,u=h[l-2*c],f=h[l-c],d=h[l+0],p=h[l+c],g=h[l+2*c],m=27*(v=Cr[1020+3*(d-f)+Cr[1020+u-p]])+63>>7,b=18*v+63>>7,v=9*v+63>>7;h[l-3*c]=Er[255+h[l-3*c]+v],h[l-2*c]=Er[255+u+b],h[l-c]=Er[255+f+m],h[l+0]=Er[255+d-m],h[l+c]=Er[255+p-b],h[l+2*c]=Er[255+g-v]}e+=r}}function Ge(t,e,n,r,i,a,s,o){for(a=2*a+1;0<i--;){if(De(t,e,n,a,s))if(Te(t,e,n,o))Re(t,e,n);else{var h=t,l=e,c=n,u=h[l-c],f=h[l+0],d=h[l+c],p=jr[112+(4+(g=3*(f-u))>>3)],g=jr[112+(g+3>>3)],m=p+1>>1;h[l-2*c]=Er[255+h[l-2*c]+m],h[l-c]=Er[255+u+g],h[l+0]=Er[255+f-p],h[l+c]=Er[255+d-m]}e+=r}}function Ye(t,e,n,r,i,a){Ve(t,e,n,1,16,r,i,a)}function Ze(t,e,n,r,i,a){Ve(t,e,1,n,16,r,i,a)}function Je(t,e,n,r,i,a){var s;for(s=3;0<s;--s)Ge(t,e+=4*n,n,1,16,r,i,a)}function Xe(t,e,n,r,i,a){var s;for(s=3;0<s;--s)Ge(t,e+=4,1,n,16,r,i,a)}function Ke(t,e,n,r,i,a,s,o){Ve(t,e,i,1,8,a,s,o),Ve(n,r,i,1,8,a,s,o)}function $e(t,e,n,r,i,a,s,o){Ve(t,e,1,i,8,a,s,o),Ve(n,r,1,i,8,a,s,o)}function Qe(t,e,n,r,i,a,s,o){Ge(t,e+4*i,i,1,8,a,s,o),Ge(n,r+4*i,i,1,8,a,s,o)}function tn(t,e,n,r,i,a,s,o){Ge(t,e+4,1,i,8,a,s,o),Ge(n,r+4,1,i,8,a,s,o)}function en(){this.ba=new st,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ht,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function nn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function rn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function an(){this.ua=0,this.Wa=new B,this.vb=new B,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new d,this.yc=new u}function sn(){this.xb=this.a=0,this.l=new Gt,this.ca=new st,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new _,this.Pb=0,this.wd=new _,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new an,this.ab=0,this.gc=s(4,rn),this.Oc=0}function on(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Gt,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function hn(t,e,n,r,i,a,s){for(t=null==t?0:t[e+0],e=0;e<s;++e)i[a+e]=t+n[r+e]&255,t=i[a+e]}function ln(t,e,n,r,i,a,s){var o;if(null==t)hn(null,null,n,r,i,a,s);else for(o=0;o<s;++o)i[a+o]=t[e+o]+n[r+o]&255}function cn(t,e,n,r,i,a,s){if(null==t)hn(null,null,n,r,i,a,s);else{var o,h=t[e+0],l=h,c=h;for(o=0;o<s;++o)l=c+(h=t[e+o])-l,c=n[r+o]+(-256&l?0>l?0:255:l)&255,l=h,i[a+o]=c}}function un(t,n,i,s){var o=n.width,h=n.o;if(e(null!=t&&null!=n),0>i||0>=s||i+s>h)return null;if(!t.Cc){if(null==t.ga){var l;if(t.ga=new on,(l=null==t.ga)||(l=n.width*n.o,e(0==t.Gb.length),t.Gb=a(l),t.Uc=0,null==t.Gb?l=0:(t.mb=t.Gb,t.nb=t.Uc,t.rc=null,l=1),l=!l),!l){l=t.ga;var c=t.Fa,u=t.P,f=t.qc,d=t.mb,p=t.nb,g=u+1,m=f-1,v=l.l;if(e(null!=c&&null!=d&&null!=n),gi[0]=null,gi[1]=hn,gi[2]=ln,gi[3]=cn,l.ca=d,l.tb=p,l.c=n.width,l.i=n.height,e(0<l.c&&0<l.i),1>=f)n=0;else if(l.$a=3&c[u+0],l.Z=c[u+0]>>2&3,l.Lc=c[u+0]>>4&3,u=c[u+0]>>6&3,0>l.$a||1<l.$a||4<=l.Z||1<l.Lc||u)n=0;else if(v.put=dt,v.ac=ft,v.bc=pt,v.ma=l,v.width=n.width,v.height=n.height,v.Da=n.Da,v.v=n.v,v.va=n.va,v.j=n.j,v.o=n.o,l.$a)t:{e(1==l.$a),n=Pt();e:for(;;){if(null==n){n=0;break t}if(e(null!=l),l.mc=n,n.c=l.c,n.i=l.i,n.l=l.l,n.l.ma=l,n.l.width=l.c,n.l.height=l.i,n.a=0,b(n.m,c,g,m),!Ft(l.c,l.i,1,n,null))break e;if(1==n.ab&&3==n.gc[0].hc&&At(n.s)?(l.ic=1,c=n.c*n.i,n.Ta=null,n.Ua=0,n.V=a(c),n.Ba=0,null==n.V?(n.a=1,n=0):n=1):(l.ic=0,n=It(n,l.c)),!n)break e;n=1;break t}l.mc=null,n=0}else n=m>=l.c*l.i;l=!n}if(l)return null;1!=t.ga.Lc?t.Ga=0:s=h-i}e(null!=t.ga),e(i+s<=h);t:{if(n=(c=t.ga).c,h=c.l.o,0==c.$a){if(g=t.rc,m=t.Vc,v=t.Fa,u=t.P+1+i*n,f=t.mb,d=t.nb+i*n,e(u<=t.P+t.qc),0!=c.Z)for(e(null!=gi[c.Z]),l=0;l<s;++l)gi[c.Z](g,m,v,u,f,d,n),g=f,m=d,d+=n,u+=n;else for(l=0;l<s;++l)r(f,d,v,u,n),g=f,m=d,d+=n,u+=n;t.rc=g,t.Vc=m}else{if(e(null!=c.mc),n=i+s,e(null!=(l=c.mc)),e(n<=l.i),l.C>=n)n=1;else if(c.ic||mn(),c.ic){c=l.V,g=l.Ba,m=l.c;var w=l.i,y=(v=1,u=l.$/m,f=l.$%m,d=l.m,p=l.s,l.$),_=m*w,x=m*n,L=p.wc,S=y<x?yt(p,f,u):null;e(y<=_),e(n<=w),e(At(p));e:for(;;){for(;!d.h&&y<x;){if(f&L||(S=yt(p,f,u)),e(null!=S),N(d),256>(w=vt(S.G[0],S.H[0],d)))c[g+y]=w,++y,++f>=m&&(f=0,++u<=n&&!(u%16)&&Nt(l,u));else{if(!(280>w)){v=0;break e}w=mt(w-256,d);var k,P=vt(S.G[4],S.H[4],d);if(N(d),!(y>=(P=bt(m,P=mt(P,d)))&&_-y>=w)){v=0;break e}for(k=0;k<w;++k)c[g+y+k]=c[g+y+k-P];for(y+=w,f+=w;f>=m;)f-=m,++u<=n&&!(u%16)&&Nt(l,u);y<x&&f&L&&(S=yt(p,f,u))}e(d.h==A(d))}Nt(l,u>n?n:u);break e}!v||d.h&&y<_?(v=0,l.a=d.h?5:3):l.$=y,n=v}else n=St(l,l.V,l.Ba,l.c,l.i,n,Ct);if(!n){s=0;break t}}i+s>=h&&(t.Cc=1),s=1}if(!s)return null;if(t.Cc&&(null!=(s=t.ga)&&(s.mc=null),t.ga=null,0<t.Ga))return alert("todo:WebPDequantizeLevels"),null}return t.nb+i*o}function fn(t,e,n,r,i,a){for(;0<i--;){var s,o=t,h=e+(n?1:0),l=t,c=e+(n?0:3);for(s=0;s<r;++s){var u=l[c+4*s];255!=u&&(u*=32897,o[h+4*s+0]=o[h+4*s+0]*u>>23,o[h+4*s+1]=o[h+4*s+1]*u>>23,o[h+4*s+2]=o[h+4*s+2]*u>>23)}e+=a}}function dn(t,e,n,r,i){for(;0<r--;){var a;for(a=0;a<n;++a){var s=t[e+2*a+0],o=15&(l=t[e+2*a+1]),h=4369*o,l=(240&l|l>>4)*h>>16;t[e+2*a+0]=(240&s|s>>4)*h>>16&240|(15&s|s<<4)*h>>16>>4&15,t[e+2*a+1]=240&l|o}e+=i}}function pn(t,e,n,r,i,a,s,o){var h,l,c=255;for(l=0;l<i;++l){for(h=0;h<r;++h){var u=t[e+h];a[s+4*h]=u,c&=u}e+=n,s+=o}return 255!=c}function gn(t,e,n,r,i){var a;for(a=0;a<i;++a)n[r+a]=t[e+a]>>8}function mn(){xr=fn,Ar=dn,Lr=pn,Nr=gn}function bn(n,r,i){t[n]=function(t,n,a,s,o,h,l,c,u,f,d,p,g,m,b,v,w){var y,_=w-1>>1,x=o[h+0]|l[c+0]<<16,A=u[f+0]|d[p+0]<<16;e(null!=t);var L=3*x+A+131074>>2;for(r(t[n+0],255&L,L>>16,g,m),null!=a&&(L=3*A+x+131074>>2,r(a[s+0],255&L,L>>16,b,v)),y=1;y<=_;++y){var N=o[h+y]|l[c+y]<<16,S=u[f+y]|d[p+y]<<16,k=x+N+A+S+524296,P=k+2*(N+A)>>3;L=P+x>>1,x=(k=k+2*(x+S)>>3)+N>>1,r(t[n+2*y-1],255&L,L>>16,g,m+(2*y-1)*i),r(t[n+2*y-0],255&x,x>>16,g,m+(2*y-0)*i),null!=a&&(L=k+A>>1,x=P+S>>1,r(a[s+2*y-1],255&L,L>>16,b,v+(2*y-1)*i),r(a[s+2*y+0],255&x,x>>16,b,v+(2*y+0)*i)),x=N,A=S}1&w||(L=3*x+A+131074>>2,r(t[n+w-1],255&L,L>>16,g,m+(w-1)*i),null!=a&&(L=3*A+x+131074>>2,r(a[s+w-1],255&L,L>>16,b,v+(w-1)*i)))}}function vn(){mi[Br]=bi,mi[Mr]=wi,mi[Rr]=vi,mi[Tr]=yi,mi[qr]=_i,mi[Dr]=xi,mi[zr]=Ai,mi[Ur]=wi,mi[Hr]=yi,mi[Wr]=_i,mi[Vr]=xi}function wn(t){return t&~Fi?0>t?0:255:t>>Pi}function yn(t,e){return wn((19077*t>>8)+(26149*e>>8)-14234)}function _n(t,e,n){return wn((19077*t>>8)-(6419*e>>8)-(13320*n>>8)+8708)}function xn(t,e){return wn((19077*t>>8)+(33050*e>>8)-17685)}function An(t,e,n,r,i){r[i+0]=yn(t,n),r[i+1]=_n(t,e,n),r[i+2]=xn(t,e)}function Ln(t,e,n,r,i){r[i+0]=xn(t,e),r[i+1]=_n(t,e,n),r[i+2]=yn(t,n)}function Nn(t,e,n,r,i){var a=_n(t,e,n);e=a<<3&224|xn(t,e)>>3,r[i+0]=248&yn(t,n)|a>>5,r[i+1]=e}function Sn(t,e,n,r,i){var a=240&xn(t,e)|15;r[i+0]=240&yn(t,n)|_n(t,e,n)>>4,r[i+1]=a}function kn(t,e,n,r,i){r[i+0]=255,An(t,e,n,r,i+1)}function Pn(t,e,n,r,i){Ln(t,e,n,r,i),r[i+3]=255}function Fn(t,e,n,r,i){An(t,e,n,r,i),r[i+3]=255}function In(e,n,r){t[e]=function(t,e,i,a,s,o,h,l,c){for(var u=l+(-2&c)*r;l!=u;)n(t[e+0],i[a+0],s[o+0],h,l),n(t[e+1],i[a+0],s[o+0],h,l+r),e+=2,++a,++o,l+=2*r;1&c&&n(t[e+0],i[a+0],s[o+0],h,l)}}function Cn(t,e,n){return 0==n?0==t?0==e?6:5:0==e?4:0:n}function jn(t,e,n,r,i){switch(t>>>30){case 3:ar(e,n,r,i,0);break;case 2:sr(e,n,r,i);break;case 1:hr(e,n,r,i)}}function En(t,e){var n,a,s=e.M,o=e.Nb,h=t.oc,l=t.pc+40,c=t.oc,u=t.pc+584,f=t.oc,d=t.pc+600;for(n=0;16>n;++n)h[l+32*n-1]=129;for(n=0;8>n;++n)c[u+32*n-1]=129,f[d+32*n-1]=129;for(0<s?h[l-1-32]=c[u-1-32]=f[d-1-32]=129:(i(h,l-32-1,127,21),i(c,u-32-1,127,9),i(f,d-32-1,127,9)),a=0;a<t.za;++a){var p=e.ya[e.aa+a];if(0<a){for(n=-1;16>n;++n)r(h,l+32*n-4,h,l+32*n+12,4);for(n=-1;8>n;++n)r(c,u+32*n-4,c,u+32*n+4,4),r(f,d+32*n-4,f,d+32*n+4,4)}var g=t.Gd,m=t.Hd+a,b=p.ad,v=p.Hc;if(0<s&&(r(h,l-32,g[m].y,0,16),r(c,u-32,g[m].f,0,8),r(f,d-32,g[m].ea,0,8)),p.Za){var w=h,y=l-32+16;for(0<s&&(a>=t.za-1?i(w,y,g[m].y[15],4):r(w,y,g[m+1].y,0,4)),n=0;4>n;n++)w[y+128+n]=w[y+256+n]=w[y+384+n]=w[y+0+n];for(n=0;16>n;++n,v<<=2)w=h,y=l+Ri[n],ui[p.Ob[n]](w,y),jn(v,b,16*+n,w,y)}else if(w=Cn(a,s,p.Ob[0]),ci[w](h,l),0!=v)for(n=0;16>n;++n,v<<=2)jn(v,b,16*+n,h,l+Ri[n]);for(n=p.Gc,w=Cn(a,s,p.Dd),fi[w](c,u),fi[w](f,d),v=b,w=c,y=u,255&(p=0|n)&&(170&p?or(v,256,w,y):lr(v,256,w,y)),p=f,v=d,255&(n>>=8)&&(170&n?or(b,320,p,v):lr(b,320,p,v)),s<t.Ub-1&&(r(g[m].y,0,h,l+480,16),r(g[m].f,0,c,u+224,8),r(g[m].ea,0,f,d+224,8)),n=8*o*t.B,g=t.sa,m=t.ta+16*a+16*o*t.R,b=t.qa,p=t.ra+8*a+n,v=t.Ha,w=t.Ia+8*a+n,n=0;16>n;++n)r(g,m+n*t.R,h,l+32*n,16);for(n=0;8>n;++n)r(b,p+n*t.B,c,u+32*n,8),r(v,w+n*t.B,f,d+32*n,8)}}function On(t,r,i,a,s,o,h,l,c){var u=[0],f=[0],d=0,p=null!=c?c.kd:0,g=null!=c?c:new nn;if(null==t||12>i)return 7;g.data=t,g.w=r,g.ha=i,r=[r],i=[i],g.gb=[g.gb];t:{var m=r,v=i,w=g.gb;if(e(null!=t),e(null!=v),e(null!=w),w[0]=0,12<=v[0]&&!n(t,m[0],"RIFF")){if(n(t,m[0]+8,"WEBP")){w=3;break t}var y=j(t,m[0]+4);if(12>y||4294967286<y){w=3;break t}if(p&&y>v[0]-8){w=7;break t}w[0]=y,m[0]+=12,v[0]-=12}w=0}if(0!=w)return w;for(y=0<g.gb[0],i=i[0];;){t:{var x=t;v=r,w=i;var A=u,L=f,N=m=[0];if((P=d=[d])[0]=0,8>w[0])w=7;else{if(!n(x,v[0],"VP8X")){if(10!=j(x,v[0]+4)){w=3;break t}if(18>w[0]){w=7;break t}var S=j(x,v[0]+8),k=1+C(x,v[0]+12);if(2147483648<=k*(x=1+C(x,v[0]+15))){w=3;break t}null!=N&&(N[0]=S),null!=A&&(A[0]=k),null!=L&&(L[0]=x),v[0]+=18,w[0]-=18,P[0]=1}w=0}}if(d=d[0],m=m[0],0!=w)return w;if(v=!!(2&m),!y&&d)return 3;if(null!=o&&(o[0]=!!(16&m)),null!=h&&(h[0]=v),null!=l&&(l[0]=0),h=u[0],m=f[0],d&&v&&null==c){w=0;break}if(4>i){w=7;break}if(y&&d||!y&&!d&&!n(t,r[0],"ALPH")){i=[i],g.na=[g.na],g.P=[g.P],g.Sa=[g.Sa];t:{S=t,w=r,y=i;var P=g.gb;A=g.na,L=g.P,N=g.Sa,k=22,e(null!=S),e(null!=y),x=w[0];var F=y[0];for(e(null!=A),e(null!=N),A[0]=null,L[0]=null,N[0]=0;;){if(w[0]=x,y[0]=F,8>F){w=7;break t}var I=j(S,x+4);if(4294967286<I){w=3;break t}var E=8+I+1&-2;if(k+=E,0<P&&k>P){w=3;break t}if(!n(S,x,"VP8 ")||!n(S,x,"VP8L")){w=0;break t}if(F[0]<E){w=7;break t}n(S,x,"ALPH")||(A[0]=S,L[0]=x+8,N[0]=I),x+=E,F-=E}}if(i=i[0],g.na=g.na[0],g.P=g.P[0],g.Sa=g.Sa[0],0!=w)break}i=[i],g.Ja=[g.Ja],g.xa=[g.xa];t:if(P=t,w=r,y=i,A=g.gb[0],L=g.Ja,N=g.xa,S=w[0],x=!n(P,S,"VP8 "),k=!n(P,S,"VP8L"),e(null!=P),e(null!=y),e(null!=L),e(null!=N),8>y[0])w=7;else{if(x||k){if(P=j(P,S+4),12<=A&&P>A-12){w=3;break t}if(p&&P>y[0]-8){w=7;break t}L[0]=P,w[0]+=8,y[0]-=8,N[0]=k}else N[0]=5<=y[0]&&47==P[S+0]&&!(P[S+4]>>5),L[0]=y[0];w=0}if(i=i[0],g.Ja=g.Ja[0],g.xa=g.xa[0],r=r[0],0!=w)break;if(4294967286<g.Ja)return 3;if(null==l||v||(l[0]=g.xa?2:1),h=[h],m=[m],g.xa){if(5>i){w=7;break}l=h,p=m,v=o,null==t||5>i?t=0:5<=i&&47==t[r+0]&&!(t[r+4]>>5)?(y=[0],P=[0],A=[0],b(L=new _,t,r,i),gt(L,y,P,A)?(null!=l&&(l[0]=y[0]),null!=p&&(p[0]=P[0]),null!=v&&(v[0]=A[0]),t=1):t=0):t=0}else{if(10>i){w=7;break}l=m,null==t||10>i||!Jt(t,r+3,i-3)?t=0:(p=t[r+0]|t[r+1]<<8|t[r+2]<<16,v=16383&(t[r+7]<<8|t[r+6]),t=16383&(t[r+9]<<8|t[r+8]),1&p||3<(p>>1&7)||!(p>>4&1)||p>>5>=g.Ja||!v||!t?t=0:(h&&(h[0]=v),l&&(l[0]=t),t=1))}if(!t)return 3;if(h=h[0],m=m[0],d&&(u[0]!=h||f[0]!=m))return 3;null!=c&&(c[0]=g,c.offset=r-c.w,e(4294967286>r-c.w),e(c.offset==c.ha-i));break}return 0==w||7==w&&d&&null==c?(null!=o&&(o[0]|=null!=g.na&&0<g.na.length),null!=a&&(a[0]=h),null!=s&&(s[0]=m),0):w}function Bn(t,e,n){var r=e.width,i=e.height,a=0,s=0,o=r,h=i;if(e.Da=null!=t&&0<t.Da,e.Da&&(o=t.cd,h=t.bd,a=t.v,s=t.j,11>n||(a&=-2,s&=-2),0>a||0>s||0>=o||0>=h||a+o>r||s+h>i))return 0;if(e.v=a,e.j=s,e.va=a+o,e.o=s+h,e.U=o,e.T=h,e.da=null!=t&&0<t.da,e.da){if(!M(o,h,n=[t.ib],a=[t.hb]))return 0;e.ib=n[0],e.hb=a[0]}return e.ob=null!=t&&t.ob,e.Kb=null==t||!t.Sd,e.da&&(e.ob=e.ib<3*r/4&&e.hb<3*i/4,e.Kb=0),1}function Mn(t){if(null==t)return 2;if(11>t.S){var e=t.f.RGBA;e.fb+=(t.height-1)*e.A,e.A=-e.A}else e=t.f.kb,t=t.height,e.O+=(t-1)*e.fa,e.fa=-e.fa,e.N+=(t-1>>1)*e.Ab,e.Ab=-e.Ab,e.W+=(t-1>>1)*e.Db,e.Db=-e.Db,null!=e.F&&(e.J+=(t-1)*e.lb,e.lb=-e.lb);return 0}function Rn(t,e,n,r){if(null==r||0>=t||0>=e)return 2;if(null!=n){if(n.Da){var i=n.cd,s=n.bd,o=-2&n.v,h=-2&n.j;if(0>o||0>h||0>=i||0>=s||o+i>t||h+s>e)return 2;t=i,e=s}if(n.da){if(!M(t,e,i=[n.ib],s=[n.hb]))return 2;t=i[0],e=s[0]}}r.width=t,r.height=e;t:{var l=r.width,c=r.height;if(t=r.S,0>=l||0>=c||!(t>=Br&&13>t))t=2;else{if(0>=r.Rd&&null==r.sd){o=s=i=e=0;var u=(h=l*zi[t])*c;if(11>t||(s=(c+1)/2*(e=(l+1)/2),12==t&&(o=(i=l)*c)),null==(c=a(u+2*s+o))){t=1;break t}r.sd=c,11>t?((l=r.f.RGBA).eb=c,l.fb=0,l.A=h,l.size=u):((l=r.f.kb).y=c,l.O=0,l.fa=h,l.Fd=u,l.f=c,l.N=0+u,l.Ab=e,l.Cd=s,l.ea=c,l.W=0+u+s,l.Db=e,l.Ed=s,12==t&&(l.F=c,l.J=0+u+2*s),l.Tc=o,l.lb=i)}if(e=1,i=r.S,s=r.width,o=r.height,i>=Br&&13>i)if(11>i)t=r.f.RGBA,e&=(h=Math.abs(t.A))*(o-1)+s<=t.size,e&=h>=s*zi[i],e&=null!=t.eb;else{t=r.f.kb,h=(s+1)/2,u=(o+1)/2,l=Math.abs(t.fa),c=Math.abs(t.Ab);var f=Math.abs(t.Db),d=Math.abs(t.lb),p=d*(o-1)+s;e&=l*(o-1)+s<=t.Fd,e&=c*(u-1)+h<=t.Cd,e=(e&=f*(u-1)+h<=t.Ed)&l>=s&c>=h&f>=h,e&=null!=t.y,e&=null!=t.f,e&=null!=t.ea,12==i&&(e&=d>=s,e&=p<=t.Tc,e&=null!=t.F)}else e=0;t=e?0:2}}return 0!=t||null!=n&&n.fd&&(t=Mn(r)),t}var Tn=64,qn=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Dn=24,zn=32,Un=8,Hn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];q("Predictor0","PredictorAdd0"),t.Predictor0=function(){return 4278190080},t.Predictor1=function(t){return t},t.Predictor2=function(t,e,n){return e[n+0]},t.Predictor3=function(t,e,n){return e[n+1]},t.Predictor4=function(t,e,n){return e[n-1]},t.Predictor5=function(t,e,n){return z(z(t,e[n+1]),e[n+0])},t.Predictor6=function(t,e,n){return z(t,e[n-1])},t.Predictor7=function(t,e,n){return z(t,e[n+0])},t.Predictor8=function(t,e,n){return z(e[n-1],e[n+0])},t.Predictor9=function(t,e,n){return z(e[n+0],e[n+1])},t.Predictor10=function(t,e,n){return z(z(t,e[n-1]),z(e[n+0],e[n+1]))},t.Predictor11=function(t,e,n){var r=e[n+0];return 0>=W(r>>24&255,t>>24&255,(e=e[n-1])>>24&255)+W(r>>16&255,t>>16&255,e>>16&255)+W(r>>8&255,t>>8&255,e>>8&255)+W(255&r,255&t,255&e)?r:t},t.Predictor12=function(t,e,n){var r=e[n+0];return(U((t>>24&255)+(r>>24&255)-((e=e[n-1])>>24&255))<<24|U((t>>16&255)+(r>>16&255)-(e>>16&255))<<16|U((t>>8&255)+(r>>8&255)-(e>>8&255))<<8|U((255&t)+(255&r)-(255&e)))>>>0},t.Predictor13=function(t,e,n){var r=e[n-1];return(H((t=z(t,e[n+0]))>>24&255,r>>24&255)<<24|H(t>>16&255,r>>16&255)<<16|H(t>>8&255,r>>8&255)<<8|H(255&t,255&r))>>>0};var Wn=t.PredictorAdd0;t.PredictorAdd1=V,q("Predictor2","PredictorAdd2"),q("Predictor3","PredictorAdd3"),q("Predictor4","PredictorAdd4"),q("Predictor5","PredictorAdd5"),q("Predictor6","PredictorAdd6"),q("Predictor7","PredictorAdd7"),q("Predictor8","PredictorAdd8"),q("Predictor9","PredictorAdd9"),q("Predictor10","PredictorAdd10"),q("Predictor11","PredictorAdd11"),q("Predictor12","PredictorAdd12"),q("Predictor13","PredictorAdd13");var Vn=t.PredictorAdd2;J("ColorIndexInverseTransform","MapARGB","32b",function(t){return t>>8&255},function(t){return t}),J("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(t){return t},function(t){return t>>8&255});var Gn,Yn=t.ColorIndexInverseTransform,Zn=t.MapARGB,Jn=t.VP8LColorIndexInverseTransformAlpha,Xn=t.MapAlpha,Kn=t.VP8LPredictorsAdd=[];Kn.length=16,(t.VP8LPredictors=[]).length=16,(t.VP8LPredictorsAdd_C=[]).length=16,(t.VP8LPredictors_C=[]).length=16;var $n,Qn,tr,er,nr,rr,ir,ar,sr,or,hr,lr,cr,ur,fr,dr,pr,gr,mr,br,vr,wr,yr,_r,xr,Ar,Lr,Nr,Sr=a(511),kr=a(2041),Pr=a(225),Fr=a(767),Ir=0,Cr=kr,jr=Pr,Er=Fr,Or=Sr,Br=0,Mr=1,Rr=2,Tr=3,qr=4,Dr=5,zr=6,Ur=7,Hr=8,Wr=9,Vr=10,Gr=[2,3,7],Yr=[3,3,11],Zr=[280,256,256,256,40],Jr=[0,1,1,1,0],Xr=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Kr=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],$r=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Qr=8,ti=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ei=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ni=null,ri=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ii=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ai=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],si=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],oi=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],hi=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],li=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ci=[],ui=[],fi=[],di=1,pi=2,gi=[],mi=[];bn("UpsampleRgbLinePair",An,3),bn("UpsampleBgrLinePair",Ln,3),bn("UpsampleRgbaLinePair",Fn,4),bn("UpsampleBgraLinePair",Pn,4),bn("UpsampleArgbLinePair",kn,4),bn("UpsampleRgba4444LinePair",Sn,2),bn("UpsampleRgb565LinePair",Nn,2);var bi=t.UpsampleRgbLinePair,vi=t.UpsampleBgrLinePair,wi=t.UpsampleRgbaLinePair,yi=t.UpsampleBgraLinePair,_i=t.UpsampleArgbLinePair,xi=t.UpsampleRgba4444LinePair,Ai=t.UpsampleRgb565LinePair,Li=16,Ni=1<<Li-1,Si=-227,ki=482,Pi=6,Fi=(256<<Pi)-1,Ii=0,Ci=a(256),ji=a(256),Ei=a(256),Oi=a(256),Bi=a(ki-Si),Mi=a(ki-Si);In("YuvToRgbRow",An,3),In("YuvToBgrRow",Ln,3),In("YuvToRgbaRow",Fn,4),In("YuvToBgraRow",Pn,4),In("YuvToArgbRow",kn,4),In("YuvToRgba4444Row",Sn,2),In("YuvToRgb565Row",Nn,2);var Ri=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ti=[0,2,8],qi=[8,7,6,4,4,2,2,2,1,1,1,1],Di=1;this.WebPDecodeRGBA=function(t,n,o,h,l){var c=Mr,u=new en,f=new st;u.ba=f,f.S=c,f.width=[f.width],f.height=[f.height];var d=f.width,p=f.height,g=new ot;if(null==g||null==t)var m=2;else e(null!=g),m=On(t,n,o,g.width,g.height,g.Pd,g.Qd,g.format,null);if(0!=m?d=0:(null!=d&&(d[0]=g.width[0]),null!=p&&(p[0]=g.height[0]),d=1),d){f.width=f.width[0],f.height=f.height[0],null!=h&&(h[0]=f.width),null!=l&&(l[0]=f.height);t:{if(h=new Gt,(l=new nn).data=t,l.w=n,l.ha=o,l.kd=1,n=[0],e(null!=l),(0==(t=On(l.data,l.w,l.ha,null,null,null,n,null,l))||7==t)&&n[0]&&(t=4),0==(n=t)){if(e(null!=u),h.data=l.data,h.w=l.w+l.offset,h.ha=l.ha-l.offset,h.put=dt,h.ac=ft,h.bc=pt,h.ma=u,l.xa){if(null==(t=Pt())){u=1;break t}if(function(t,n){var r=[0],i=[0],a=[0];e:for(;;){if(null==t)return 0;if(null==n)return t.a=2,0;if(t.l=n,t.a=0,b(t.m,n.data,n.w,n.ha),!gt(t.m,r,i,a)){t.a=3;break e}if(t.xb=pi,n.width=r[0],n.height=i[0],!Ft(r[0],i[0],1,t,null))break e;return 1}return e(0!=t.a),0}(t,h)){if(h=0==(n=Rn(h.width,h.height,u.Oa,u.ba))){e:{h=t;n:for(;;){if(null==h){h=0;break e}if(e(null!=h.s.yc),e(null!=h.s.Ya),e(0<h.s.Wb),e(null!=(o=h.l)),e(null!=(l=o.ma)),0!=h.xb){if(h.ca=l.ba,h.tb=l.tb,e(null!=h.ca),!Bn(l.Oa,o,Tr)){h.a=2;break n}if(!It(h,o.width))break n;if(o.da)break n;if((o.da||rt(h.ca.S))&&mn(),11>h.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=h.ca.f.kb.F&&mn()),h.Pb&&0<h.s.ua&&null==h.s.vb.X&&!E(h.s.vb,h.s.Wa.Xa)){h.a=1;break n}h.xb=0}if(!St(h,h.V,h.Ba,h.c,h.i,o.o,xt))break n;l.Dc=h.Ma,h=1;break e}e(0!=h.a),h=0}h=!h}h&&(n=t.a)}else n=t.a}else{if(null==(t=new Yt)){u=1;break t}if(t.Fa=l.na,t.P=l.P,t.qc=l.Sa,Xt(t,h)){if(0==(n=Rn(h.width,h.height,u.Oa,u.ba))){if(t.Aa=0,o=u.Oa,e(null!=(l=t)),null!=o){if(0<(d=0>(d=o.Md)?0:100<d?255:255*d/100)){for(p=g=0;4>p;++p)12>(m=l.pb[p]).lc&&(m.ia=d*qi[0>m.lc?0:m.lc]>>3),g|=m.ia;g&&(alert("todo:VP8InitRandom"),l.ia=1)}l.Ga=o.Id,100<l.Ga?l.Ga=100:0>l.Ga&&(l.Ga=0)}(function(t,n){if(null==t)return 0;if(null==n)return Zt(t,2,"NULL VP8Io parameter in VP8Decode().");if(!t.cb&&!Xt(t,n))return 0;if(e(t.cb),null==n.ac||n.ac(n)){n.ob&&(t.L=0);var o=Ti[t.L];if(2==t.L?(t.yb=0,t.zb=0):(t.yb=n.v-o>>4,t.zb=n.j-o>>4,0>t.yb&&(t.yb=0),0>t.zb&&(t.zb=0)),t.Va=n.o+15+o>>4,t.Hb=n.va+15+o>>4,t.Hb>t.za&&(t.Hb=t.za),t.Va>t.Ub&&(t.Va=t.Ub),0<t.L){var h=t.ed;for(o=0;4>o;++o){var l;if(t.Qa.Cb){var c=t.Qa.Lb[o];t.Qa.Fb||(c+=h.Tb)}else c=h.Tb;for(l=0;1>=l;++l){var u=t.gd[o][l],f=c;if(h.Pc&&(f+=h.vd[0],l&&(f+=h.od[0])),0<(f=0>f?0:63<f?63:f)){var d=f;0<h.wb&&(d=4<h.wb?d>>2:d>>1)>9-h.wb&&(d=9-h.wb),1>d&&(d=1),u.dd=d,u.tc=2*f+d,u.ld=40<=f?2:15<=f?1:0}else u.tc=0;u.La=l}}}o=0}else Zt(t,6,"Frame setup failed"),o=t.a;if(o=0==o){if(o){t.$c=0,0<t.Aa||(t.Ic=Di);e:{o=t.Ic,h=4*(d=t.za);var p=32*d,g=d+1,m=0<t.L?d*(0<t.Aa?2:1):0,b=(2==t.Aa?2:1)*d;if((u=h+832+(l=3*(16*o+Ti[t.L])/2*p)+(c=null!=t.Fa&&0<t.Fa.length?t.Kc.c*t.Kc.i:0))!=u)o=0;else{if(u>t.Vb){if(t.Vb=0,t.Ec=a(u),t.Fc=0,null==t.Ec){o=Zt(t,1,"no memory during frame initialization.");break e}t.Vb=u}u=t.Ec,f=t.Fc,t.Ac=u,t.Bc=f,f+=h,t.Gd=s(p,Ht),t.Hd=0,t.rb=s(g+1,qt),t.sb=1,t.wa=m?s(m,Tt):null,t.Y=0,t.D.Nb=0,t.D.wa=t.wa,t.D.Y=t.Y,0<t.Aa&&(t.D.Y+=d),e(!0),t.oc=u,t.pc=f,f+=832,t.ya=s(b,zt),t.aa=0,t.D.ya=t.ya,t.D.aa=t.aa,2==t.Aa&&(t.D.aa+=d),t.R=16*d,t.B=8*d,d=(p=Ti[t.L])*t.R,p=p/2*t.B,t.sa=u,t.ta=f+d,t.qa=t.sa,t.ra=t.ta+16*o*t.R+p,t.Ha=t.qa,t.Ia=t.ra+8*o*t.B+p,t.$c=0,f+=l,t.mb=c?u:null,t.nb=c?f:null,e(f+c<=t.Fc+t.Vb),$t(t),i(t.Ac,t.Bc,0,h),o=1}}if(o){if(n.ka=0,n.y=t.sa,n.O=t.ta,n.f=t.qa,n.N=t.ra,n.ea=t.Ha,n.Vd=t.Ia,n.fa=t.R,n.Rc=t.B,n.F=null,n.J=0,!Ir){for(o=-255;255>=o;++o)Sr[255+o]=0>o?-o:o;for(o=-1020;1020>=o;++o)kr[1020+o]=-128>o?-128:127<o?127:o;for(o=-112;112>=o;++o)Pr[112+o]=-16>o?-16:15<o?15:o;for(o=-255;510>=o;++o)Fr[255+o]=0>o?0:255<o?255:o;Ir=1}ir=he,ar=ie,or=ae,hr=se,lr=oe,sr=re,cr=Ye,ur=Ze,fr=Ke,dr=$e,pr=Je,gr=Xe,mr=Qe,br=tn,vr=ze,wr=Ue,yr=He,_r=We,ui[0]=Ae,ui[1]=ce,ui[2]=_e,ui[3]=xe,ui[4]=Le,ui[5]=Se,ui[6]=Ne,ui[7]=ke,ui[8]=Fe,ui[9]=Pe,ci[0]=me,ci[1]=fe,ci[2]=de,ci[3]=pe,ci[4]=be,ci[5]=ve,ci[6]=we,fi[0]=Ee,fi[1]=ue,fi[2]=Ie,fi[3]=Ce,fi[4]=Be,fi[5]=Oe,fi[6]=Me,o=1}else o=0}o&&(o=function(t,n){for(t.M=0;t.M<t.Va;++t.M){var s,o=t.Jc[t.M&t.Xb],h=t.m,l=t;for(s=0;s<l.za;++s){var c=h,u=l,f=u.Ac,d=u.Bc+4*s,p=u.zc,g=u.ya[u.aa+s];if(u.Qa.Bb?g.$b=P(c,u.Pa.jb[0])?2+P(c,u.Pa.jb[2]):P(c,u.Pa.jb[1]):g.$b=0,u.kc&&(g.Ad=P(c,u.Bd)),g.Za=!P(c,145)+0,g.Za){var m=g.Ob,b=0;for(u=0;4>u;++u){var v,w=p[0+u];for(v=0;4>v;++v){w=oi[f[d+v]][w];for(var y=ai[P(c,w[0])];0<y;)y=ai[2*y+P(c,w[y])];w=-y,f[d+v]=w}r(m,b,f,d,4),b+=4,p[0+u]=w}}else w=P(c,156)?P(c,128)?1:3:P(c,163)?2:0,g.Ob[0]=w,i(f,d,w,4),i(p,0,w,4);g.Dd=P(c,142)?P(c,114)?P(c,183)?1:3:2:0}if(l.m.Ka)return Zt(t,7,"Premature end-of-partition0 encountered.");for(;t.ja<t.za;++t.ja){if(l=o,c=(h=t).rb[h.sb-1],f=h.rb[h.sb+h.ja],s=h.ya[h.aa+h.ja],d=h.kc?s.Ad:0)c.la=f.la=0,s.Za||(c.Na=f.Na=0),s.Hc=0,s.Gc=0,s.ia=0;else{var _,x;if(c=f,f=l,d=h.Pa.Xc,p=h.ya[h.aa+h.ja],g=h.pb[p.$b],u=p.ad,m=0,b=h.rb[h.sb-1],w=v=0,i(u,m,0,384),p.Za)var A=0,L=d[3];else{y=a(16);var N=c.Na+b.Na;if(N=ni(f,d[1],N,g.Eb,0,y,0),c.Na=b.Na=(0<N)+0,1<N)ir(y,0,u,m);else{var S=y[0]+3>>3;for(y=0;256>y;y+=16)u[m+y]=S}A=1,L=d[0]}var k=15&c.la,F=15&b.la;for(y=0;4>y;++y){var I=1&F;for(S=x=0;4>S;++S)k=k>>1|(I=(N=ni(f,L,N=I+(1&k),g.Sc,A,u,m))>A)<<7,x=x<<2|(3<N?3:1<N?2:0!=u[m+0]),m+=16;k>>=4,F=F>>1|I<<7,v=(v<<8|x)>>>0}for(L=k,A=F>>4,_=0;4>_;_+=2){for(x=0,k=c.la>>4+_,F=b.la>>4+_,y=0;2>y;++y){for(I=1&F,S=0;2>S;++S)N=I+(1&k),k=k>>1|(I=0<(N=ni(f,d[2],N,g.Qc,0,u,m)))<<3,x=x<<2|(3<N?3:1<N?2:0!=u[m+0]),m+=16;k>>=2,F=F>>1|I<<5}w|=x<<4*_,L|=k<<4<<_,A|=(240&F)<<_}c.la=L,b.la=A,p.Hc=v,p.Gc=w,p.ia=43690&w?0:g.ia,d=!(v|w)}if(0<h.L&&(h.wa[h.Y+h.ja]=h.gd[s.$b][s.Za],h.wa[h.Y+h.ja].La|=!d),l.Ka)return Zt(t,7,"Premature end-of-file encountered.")}if($t(t),h=n,l=1,s=(o=t).D,c=0<o.L&&o.M>=o.zb&&o.M<=o.Va,0==o.Aa)e:{if(s.M=o.M,s.uc=c,En(o,s),l=1,s=(x=o.D).Nb,c=(w=Ti[o.L])*o.R,f=w/2*o.B,y=16*s*o.R,S=8*s*o.B,d=o.sa,p=o.ta-c+y,g=o.qa,u=o.ra-f+S,m=o.Ha,b=o.Ia-f+S,F=0==(k=x.M),v=k>=o.Va-1,2==o.Aa&&En(o,x),x.uc)for(I=(N=o).D.M,e(N.D.uc),x=N.yb;x<N.Hb;++x){A=x,L=I;var C=(j=(z=N).D).Nb;_=z.R;var j=j.wa[j.Y+A],E=z.sa,O=z.ta+16*C*_+16*A,B=j.dd,M=j.tc;if(0!=M)if(e(3<=M),1==z.L)0<A&&wr(E,O,_,M+4),j.La&&_r(E,O,_,M),0<L&&vr(E,O,_,M+4),j.La&&yr(E,O,_,M);else{var R=z.B,T=z.qa,q=z.ra+8*C*R+8*A,D=z.Ha,z=z.Ia+8*C*R+8*A;C=j.ld,0<A&&(ur(E,O,_,M+4,B,C),dr(T,q,D,z,R,M+4,B,C)),j.La&&(gr(E,O,_,M,B,C),br(T,q,D,z,R,M,B,C)),0<L&&(cr(E,O,_,M+4,B,C),fr(T,q,D,z,R,M+4,B,C)),j.La&&(pr(E,O,_,M,B,C),mr(T,q,D,z,R,M,B,C))}}if(o.ia&&alert("todo:DitherRow"),null!=h.put){if(x=16*k,k=16*(k+1),F?(h.y=o.sa,h.O=o.ta+y,h.f=o.qa,h.N=o.ra+S,h.ea=o.Ha,h.W=o.Ia+S):(x-=w,h.y=d,h.O=p,h.f=g,h.N=u,h.ea=m,h.W=b),v||(k-=w),k>h.o&&(k=h.o),h.F=null,h.J=null,null!=o.Fa&&0<o.Fa.length&&x<k&&(h.J=un(o,h,x,k-x),h.F=o.mb,null==h.F&&0==h.F.length)){l=Zt(o,3,"Could not decode alpha data.");break e}x<h.j&&(w=h.j-x,x=h.j,e(!(1&w)),h.O+=o.R*w,h.N+=o.B*(w>>1),h.W+=o.B*(w>>1),null!=h.F&&(h.J+=h.width*w)),x<k&&(h.O+=h.v,h.N+=h.v>>1,h.W+=h.v>>1,null!=h.F&&(h.J+=h.v),h.ka=x-h.j,h.U=h.va-h.v,h.T=k-x,l=h.put(h))}s+1!=o.Ic||v||(r(o.sa,o.ta-c,d,p+16*o.R,c),r(o.qa,o.ra-f,g,u+8*o.B,f),r(o.Ha,o.Ia-f,m,b+8*o.B,f))}if(!l)return Zt(t,6,"Output aborted.")}return 1}(t,n)),null!=n.bc&&n.bc(n),o&=1}return o?(t.cb=0,o):0})(t,h)||(n=t.a)}}else n=t.a}0==n&&null!=u.Oa&&u.Oa.fd&&(n=Mn(u.ba))}u=n}c=0!=u?null:11>c?f.f.RGBA.eb:f.f.kb.y}else c=null;return c};var zi=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function l(t,e){for(var n="",r=0;r<4;r++)n+=String.fromCharCode(t[e++]);return n}function c(t,e){return t[e+0]|t[e+1]<<8}function u(t,e){return(t[e+0]|t[e+1]<<8|t[e+2]<<16)>>>0}function f(t,e){return(t[e+0]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}new h;var d=[0],p=[0],g=[],m=new h,b=t,v=function(t,e){var n={},r=0,i=!1,a=0,s=0;if(n.frames=[],!
/** @license
     * Copyright (c) 2017 Dominik Homberger
    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
    https://webpjs.appspot.com
    WebPRiffParser dominikhlbg@gmail.com
    */
function(t,e){for(var n=0;n<4;n++)if(t[e+n]!="RIFF".charCodeAt(n))return!0;return!1}(t,e)){for(f(t,e+=4),e+=8;e<t.length;){var o=l(t,e),h=f(t,e+=4);e+=4;var d=h+(1&h);switch(o){case"VP8 ":case"VP8L":void 0===n.frames[r]&&(n.frames[r]={}),(m=n.frames[r]).src_off=i?s:e-8,m.src_size=a+h+8,r++,i&&(i=!1,a=0,s=0);break;case"VP8X":(m=n.header={}).feature_flags=t[e];var p=e+4;m.canvas_width=1+u(t,p),p+=3,m.canvas_height=1+u(t,p),p+=3;break;case"ALPH":i=!0,a=d+8,s=e-8;break;case"ANIM":(m=n.header).bgcolor=f(t,e),p=e+4,m.loop_count=c(t,p),p+=2;break;case"ANMF":var g,m;(m=n.frames[r]={}).offset_x=2*u(t,e),e+=3,m.offset_y=2*u(t,e),e+=3,m.width=1+u(t,e),e+=3,m.height=1+u(t,e),e+=3,m.duration=u(t,e),e+=3,g=t[e++],m.dispose=1&g,m.blend=g>>1&1}"ANMF"!=o&&(e+=d)}return n}}(b,0);v.response=b,v.rgbaoutput=!0,v.dataurl=!1;var w=v.header?v.header:null,y=v.frames?v.frames:null;if(w){w.loop_counter=w.loop_count,d=[w.canvas_height],p=[w.canvas_width];for(var _=0;_<y.length&&0!=y[_].blend;_++);}var x=y[0],A=m.WebPDecodeRGBA(b,x.src_off,x.src_size,p,d);x.rgba=A,x.imgwidth=p[0],x.imgheight=d[0];for(var L=0;L<p[0]*d[0]*4;L++)g[L]=A[L];return this.width=p,this.height=d,this.data=g,this}
/** ====================================================================
   * @license
   * jsPDF XMP metadata plugin
   * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
   *
   * Permission is hereby granted, free of charge, to any person obtaining
   * a copy of this software and associated documentation files (the
   * "Software"), to deal in the Software without restriction, including
   * without limitation the rights to use, copy, modify, merge, publish,
   * distribute, sublicense, and/or sell copies of the Software, and to
   * permit persons to whom the Software is furnished to do so, subject to
   * the following conditions:
   *
   * The above copyright notice and this permission notice shall be
   * included in all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
   * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
   * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
   * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
   * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
   * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
   * ====================================================================
   */
function Ba(){var t,e=this.internal.__metadata__.metadata,n=unescape(encodeURIComponent(e));t=this.internal.__metadata__.rawXml?n:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+t.length+" >>"),this.internal.write("stream"),this.internal.write(t),this.internal.write("endstream"),this.internal.write("endobj")}function Ma(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"}(da||(da={})),R.API.processPNG=function(t,e,r,i){if(this.__addimage__.isArrayBuffer(t)&&(t=new Uint8Array(t)),this.__addimage__.isArrayBufferView(t)){var a,s=new fa(t,{checkCrc:!0}).decode(),o=s.width,h=s.height,l=s.channels,c=s.palette,u=s.depth;a=c&&1===l?function(t){for(var e=t.width,r=t.height,i=t.data,a=t.palette,s=t.depth,o=!1,h=[],l=[],c=void 0,u=!1,f=0,d=0;d<a.length;d++){var p=n(a[d],4),g=p[0],m=p[1],b=p[2],v=p[3];h.push(g,m,b),null!=v&&(0===v?(f++,l.length<1&&l.push(d)):v<255&&(u=!0))}if(u||f>1){o=!0,l=void 0;var w=e*r;c=new Uint8Array(w);for(var y=new DataView(i.buffer),_=0;_<w;_++){var x=n(a[ka(y,_,s)],4)[3];c[_]=x}}else 0===f&&(l=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:o?8:void 0,colorBytes:i,alphaBytes:c,needSMask:o,palette:h,mask:l}}(s):2===l||4===l?function(t){for(var e=t.data,n=t.width,r=t.height,i=t.channels,a=t.depth,s=2===i?"DeviceGray":"DeviceRGB",o=i-1,h=n*r,l=o,c=h*l,u=1*h,f=Math.ceil(c*a/8),d=Math.ceil(u*a/8),p=new Uint8Array(f),g=new Uint8Array(d),m=new DataView(e.buffer),b=new DataView(p.buffer),v=new DataView(g.buffer),w=!1,y=0;y<h;y++){for(var _=y*i,x=0;x<l;x++)Pa(b,ka(m,_+x,a),y*l+x,a);var A=ka(m,_+l,a);A<(1<<a)-1&&(w=!0),Pa(v,A,1*y,a)}return{colorSpace:s,colorsPerPixel:o,sMaskBitsPerComponent:w?a:void 0,colorBytes:p,alphaBytes:g,needSMask:w}}(s):function(t){var e,n=t.data,r=1===t.channels?"DeviceGray":"DeviceRGB",i="DeviceGray"===r?1:3;return e=n instanceof Uint16Array?function(t){for(var e=t.length,n=new Uint8Array(2*e),r=new DataView(n.buffer,n.byteOffset,n.byteLength),i=0;i<e;i++)r.setUint16(2*i,t[i],!1);return n}(n):n,{colorSpace:r,colorsPerPixel:i,colorBytes:e,needSMask:!1}}(s);var f,d,p,g=a,m=g.colorSpace,b=g.colorsPerPixel,v=g.sMaskBitsPerComponent,w=g.colorBytes,y=g.alphaBytes,_=g.needSMask,x=g.palette,A=g.mask,L=null;return i!==R.API.image_compression.NONE?(L=function(t){var e;switch(t){case R.API.image_compression.FAST:e=11;break;case R.API.image_compression.MEDIUM:e=13;break;case R.API.image_compression.SLOW:e=14;break;default:e=12}return e}(i),f=this.decode.FLATE_DECODE,d="/Predictor ".concat(L," /Colors ").concat(b," /BitsPerComponent ").concat(u," /Columns ").concat(o),t=wa(w,Math.ceil(o*b*u/8),b,u,i),_&&(p=wa(y,Math.ceil(o*v/8),1,v,i))):(f=void 0,d=void 0,t=w,_&&(p=y)),(this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t))&&(t=this.__addimage__.arrayBufferToBinaryString(t)),(p&&this.__addimage__.isArrayBuffer(p)||this.__addimage__.isArrayBufferView(p))&&(p=this.__addimage__.arrayBufferToBinaryString(p)),{alias:r,data:t,index:e,filter:f,decodeParameters:d,transparency:A,palette:x,sMask:p,predictor:L,width:o,height:h,bitsPerComponent:u,sMaskBitsPerComponent:v,colorSpace:m}}},function(t){t.processGIF89A=function(e,n,r,i){var a=new Ia(e),s=a.width,o=a.height,h=[];a.decodeAndBlitFrameRGBA(0,h);var l={data:h,width:s,height:o},c=new ja(100).encode(l,100);return t.processJPEG.call(this,c,n,r,i)},t.processGIF87A=t.processGIF89A}(R.API),Ea.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:i,green:r,blue:n,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Ea.prototype.parseBGR=function(){this.pos=this.offset;var t="bit"+this.bitPP,e=this.width*this.height*4;if(e>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(e);try{this[t]()}catch(is){s.log("bit decode error:"+is)}},Ea.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),n=e%4;for(t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,i=0;i<e;i++)for(var a=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var h=this.palette[a>>7-o&1];this.data[s+4*o]=h.blue,this.data[s+4*o+1]=h.green,this.data[s+4*o+2]=h.red,this.data[s+4*o+3]=255}0!==n&&(this.pos+=4-n)}},Ea.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<t;i++){var a=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+2*i*4,o=a>>4,h=15&a,l=this.palette[o];if(this.data[s]=l.blue,this.data[s+1]=l.green,this.data[s+2]=l.red,this.data[s+3]=255,2*i+1>=this.width)break;l=this.palette[h],this.data[s+4]=l.blue,this.data[s+4+1]=l.green,this.data[s+4+2]=l.red,this.data[s+4+3]=255}0!==e&&(this.pos+=4-e)}},Ea.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+4*r;if(i<this.palette.length){var s=this.palette[i];this.data[a]=s.red,this.data[a+1]=s.green,this.data[a+2]=s.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}0!==t&&(this.pos+=4-t)}},Ea.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<this.width;i++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(a&e)/e*255|0,o=(a>>5&e)/e*255|0,h=(a>>10&e)/e*255|0,l=a>>15?255:0,c=r*this.width*4+4*i;this.data[c]=h,this.data[c+1]=o,this.data[c+2]=s,this.data[c+3]=l}this.pos+=t}},Ea.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(s&e)/e*255|0,h=(s>>5&n)/n*255|0,l=(s>>11)/e*255|0,c=i*this.width*4+4*a;this.data[c]=l,this.data[c+1]=h,this.data[c+2]=o,this.data[c+3]=255}this.pos+=t}},Ea.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*n;this.data[s]=a,this.data[s+1]=i,this.data[s+2]=r,this.data[s+3]=255}this.pos+=this.width%4}},Ea.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*n;this.data[o]=a,this.data[o+1]=i,this.data[o+2]=r,this.data[o+3]=s}},Ea.prototype.getData=function(){return this.data},
/**
   * @license
   * Copyright (c) 2018 Aras Abbasi
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){t.processBMP=function(e,n,r,i){var a=new Ea(e,!1),s=a.width,o=a.height,h={data:a.getData(),width:s,height:o},l=new ja(100).encode(h,100);return t.processJPEG.call(this,l,n,r,i)}}(R.API),Oa.prototype.getData=function(){return this.data},
/**
   * @license
   * Copyright (c) 2019 Aras Abbasi
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){t.processWEBP=function(e,n,r,i){var a=new Oa(e),s=a.width,o=a.height,h={data:a.getData(),width:s,height:o},l=new ja(100).encode(h,100);return t.processJPEG.call(this,l,n,r,i)}}(R.API),
/**
   * @license
   *
   * Copyright (c) 2021 Antti Palola, https://github.com/Pantura
   *
   * Permission is hereby granted, free of charge, to any person obtaining
   * a copy of this software and associated documentation files (the
   * "Software"), to deal in the Software without restriction, including
   * without limitation the rights to use, copy, modify, merge, publish,
   * distribute, sublicense, and/or sell copies of the Software, and to
   * permit persons to whom the Software is furnished to do so, subject to
   * the following conditions:
   *
   * The above copyright notice and this permission notice shall be
   * included in all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
   * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
   * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
   * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
   * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
   * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
   * ====================================================================
   */
function(t){t.processRGBA=function(t,e,n){for(var r=t.data,i=r.length,a=new Uint8Array(i/4*3),s=new Uint8Array(i/4),o=0,h=0,l=0;l<i;l+=4){var c=r[l],u=r[l+1],f=r[l+2],d=r[l+3];a[o++]=c,a[o++]=u,a[o++]=f,s[h++]=d}var p=this.__addimage__.arrayBufferToBinaryString(a);return{alpha:this.__addimage__.arrayBufferToBinaryString(s),data:p,index:e,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}}}(R.API),
/**
   * @license
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){t.setLanguage=function(t){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]&&(this.internal.languageSettings.languageCode=t,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this}}(R.API),pa=R.API,ga=pa.getCharWidthsArray=function(t,e){var n,i,a=(e=e||{}).font||this.internal.getFont(),s=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),h=e.widths?e.widths:a.metadata.Unicode.widths,l=h.fof?h.fof:1,c=e.kerning?e.kerning:a.metadata.Unicode.kerning,u=c.fof?c.fof:1,f=!1!==e.doKerning,d=0,p=t.length,g=0,m=h[0]||l,b=[];for(n=0;n<p;n++)i=t.charCodeAt(n),"function"==typeof a.metadata.widthOfString?b.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(i))+o*(1e3/s)||0)/1e3):(d=f&&"object"===r(c[i])&&!isNaN(parseInt(c[i][g],10))?c[i][g]/u:0,b.push((h[i]||m)/l+d)),g=i;return b},ma=pa.getStringUnitWidth=function(t,e){var n=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),i=e.charSpace||this.internal.getCharSpace();return pa.processArabic&&(t=pa.processArabic(t)),"function"==typeof r.metadata.widthOfString?r.metadata.widthOfString(t,n,i)/n:ga.apply(this,arguments).reduce(function(t,e){return t+e},0)},ba=function(t,e,n,r){for(var i=[],a=0,s=t.length,o=0;a!==s&&o+e[a]<n;)o+=e[a],a++;i.push(t.slice(0,a));var h=a;for(o=0;a!==s;)o+e[a]>r&&(i.push(t.slice(h,a)),o=0,h=a),o+=e[a],a++;return h!==a&&i.push(t.slice(h,a)),i},va=function(t,e,n){n||(n={});var r,i,a,s,o,h,l,c=[],u=[c],f=n.textIndent||0,d=0,p=0,g=t.split(" "),m=ga.apply(this,[" ",n])[0];if(h=-1===n.lineIndent?g[0].length+2:n.lineIndent||0){var b=Array(h).join(" "),v=[];g.map(function(t){(t=t.split(/\s*\n/)).length>1?v=v.concat(t.map(function(t,e){return(e&&t.length?"\n":"")+t})):v.push(t[0])}),g=v,h=ma.apply(this,[b,n])}for(a=0,s=g.length;a<s;a++){var w=0;if(r=g[a],h&&"\n"==r[0]&&(r=r.substr(1),w=1),f+d+(p=(i=ga.apply(this,[r,n])).reduce(function(t,e){return t+e},0))>e||w){if(p>e){for(o=ba.apply(this,[r,i,e-(f+d),e]),c.push(o.shift()),c=[o.pop()];o.length;)u.push([o.shift()]);p=i.slice(r.length-(c[0]?c[0].length:0)).reduce(function(t,e){return t+e},0)}else c=[r];u.push(c),f=p+h,d=m}else c.push(r),f+=d+p,d=m}return l=h?function(t,e){return(e?b:"")+t.join(" ")}:function(t){return t.join(" ")},u.map(l)},pa.splitTextToSize=function(t,e,n){var r,i=(n=n||{}).fontSize||this.internal.getFontSize(),a=function(t){if(t.widths&&t.kerning)return{widths:t.widths,kerning:t.kerning};var e=this.internal.getFont(t.fontName,t.fontStyle),n="Unicode";return e.metadata[n]?{widths:e.metadata[n].widths||{0:1},kerning:e.metadata[n].kerning||{}}:{font:e.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,n);r=Array.isArray(t)?t:String(t).split(/\r?\n/);var s=1*this.internal.scaleFactor*e/i;a.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/i:0,a.lineIndent=n.lineIndent;var o,h,l=[];for(o=0,h=r.length;o<h;o++)l=l.concat(va.apply(this,[r[o],s,a]));return l},function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="0123456789abcdef",n="klmnopqrstuvwxyz",i={},a={},s=0;s<16;s++)i[n[s]]=e[s],a[e[s]]=n[s];var o=function(t){return"0x"+parseInt(t,10).toString(16)},h=t.__fontmetrics__.compress=function(t){var e,n,i,s,l=["{"];for(var c in t){if(e=t[c],isNaN(parseInt(c,10))?n="'"+c+"'":(c=parseInt(c,10),n=(n=o(c).slice(2)).slice(0,-1)+a[n.slice(-1)]),"number"==typeof e)e<0?(i=o(e).slice(3),s="-"):(i=o(e).slice(2),s=""),i=s+i.slice(0,-1)+a[i.slice(-1)];else{if("object"!==r(e))throw new Error("Don't know what to do with value type "+r(e)+".");i=h(e)}l.push(n+i)}return l.push("}"),l.join("")},l=t.__fontmetrics__.uncompress=function(t){if("string"!=typeof t)throw new Error("Invalid argument passed to uncompress.");for(var e,n,r,a,s={},o=1,h=s,l=[],c="",u="",f=t.length-1,d=1;d<f;d+=1)"'"==(a=t[d])?e?(r=e.join(""),e=void 0):e=[]:e?e.push(a):"{"==a?(l.push([h,r]),h={},r=void 0):"}"==a?((n=l.pop())[0][n[1]]=h,r=void 0,h=n[0]):"-"==a?o=-1:void 0===r?i.hasOwnProperty(a)?(c+=i[a],r=parseInt(c,16)*o,o=1,c=""):c+=a:i.hasOwnProperty(a)?(u+=i[a],h[r]=parseInt(u,16)*o,o=1,r=void 0,u=""):u+=a;return s},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},f={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(t){var e=t.font,n=f.Unicode[e.postScriptName];n&&(e.metadata.Unicode={},e.metadata.Unicode.widths=n.widths,e.metadata.Unicode.kerning=n.kerning);var r=u.Unicode[e.postScriptName];r&&(e.metadata.Unicode.encoding=r,e.encoding=r.codePages[0])}])}(R.API),
/**
   * @license
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){var e=function(t){for(var e=t.length,n=new Uint8Array(e),r=0;r<e;r++)n[r]=t.charCodeAt(r);return n};t.API.events.push(["addFont",function(n){var r=void 0,i=n.font,a=n.instance;if(!i.isStandardFont){if(void 0===a)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if("string"!=typeof(r=!1===a.existsFileInVFS(i.postScriptName)?a.loadFile(i.postScriptName):a.getFileFromVFS(i.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");!function(n,r){r=/^\x00\x01\x00\x00/.test(r)?e(r):e(f(r)),n.metadata=t.API.TTFFont.open(r),n.metadata.Unicode=n.metadata.Unicode||{encoding:{},kerning:{},widths:[]},n.metadata.glyIdsUsed=[0]}(i,r)}}])}(R),function(e){e.addSvgAsImage=function(e,n,a,o,h,l,c,u){if(isNaN(n)||isNaN(a))throw s.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(h))throw s.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var f=document.createElement("canvas");f.width=o,f.height=h;var d=f.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,f.width,f.height);var p={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},g=this;return(i.canvg?Promise.resolve(i.canvg):"object"===(void 0===t?"undefined":r(t))&&"undefined"!=typeof module?new Promise(function(t,e){try{t(require("canvg"))}catch(is){e(is)}}):"function"==typeof define&&define.amd?new Promise(function(t,e){try{require(["canvg"],t)}catch(is){e(is)}}):Promise.reject(new Error("Could not load canvg"))).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t}).then(function(t){return t.fromString(d,e,p)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(t){return t.render(p)}).then(function(){g.addImage(f.toDataURL("image/jpeg",1),n,a,o,h,c,u)})}}(R.API),
/**
   * @license
   * ====================================================================
   * Copyright (c) 2013 Eduardo Menezes de Morais, eduardo.morais@usp.br
   *
   * Permission is hereby granted, free of charge, to any person obtaining
   * a copy of this software and associated documentation files (the
   * "Software"), to deal in the Software without restriction, including
   * without limitation the rights to use, copy, modify, merge, publish,
   * distribute, sublicense, and/or sell copies of the Software, and to
   * permit persons to whom the Software is furnished to do so, subject to
   * the following conditions:
   *
   * The above copyright notice and this permission notice shall be
   * included in all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
   * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
   * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
   * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
   * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
   * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
   * ====================================================================
   */
function(t){t.putTotalPages=function(t){var e,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),n=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var i=0;i<this.internal.pages[r].length;i++)this.internal.pages[r][i]=this.internal.pages[r][i].replace(e,n);return this}}(R.API),function(t){t.viewerPreferences=function(t,e){var n;t=t||{},e=e||!1;var i,a,s,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},h=Object.keys(o),l=[],c=0,u=0,f=0;function d(t,e){var n,r=!1;for(n=0;n<t.length;n+=1)t[n]===e&&(r=!0);return r}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,"reset"===t||!0===e){var p=h.length;for(f=0;f<p;f+=1)n[h[f]].value=n[h[f]].defaultValue,n[h[f]].explicitSet=!1}if("object"===r(t))for(a in t)if(s=t[a],d(h,a)&&void 0!==s){if("boolean"===n[a].type&&"boolean"==typeof s)n[a].value=s;else if("name"===n[a].type&&d(n[a].valueSet,s))n[a].value=s;else if("integer"===n[a].type&&Number.isInteger(s))n[a].value=s;else if("array"===n[a].type){for(c=0;c<s.length;c+=1)if(i=!0,1===s[c].length&&"number"==typeof s[c][0])l.push(String(s[c]-1));else if(s[c].length>1){for(u=0;u<s[c].length;u+=1)"number"!=typeof s[c][u]&&(i=!1);!0===i&&l.push([s[c][0]-1,s[c][1]-1].join(" "))}n[a].value="["+l.join(" ")+"]"}else n[a].value=n[a].defaultValue;n[a].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){var t,e=[];for(t in n)!0===n[t].explicitSet&&("name"===n[t].type?e.push("/"+t+" /"+n[t].value):e.push("/"+t+" "+n[t].value));0!==e.length&&this.internal.write("/ViewerPreferences\n<<\n"+e.join("\n")+"\n>>")}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this}}(R.API),R.API.addMetadata=function(t,e){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:t,namespaceUri:null!=e?e:"http://jspdf.default.namespaceuri/",rawXml:"boolean"==typeof e&&e},this.internal.events.subscribe("putCatalog",Ma),this.internal.events.subscribe("postPutResources",Ba)),this},function(t){var e=t.API,n=e.pdfEscape16=function(t,e){for(var n,r=e.metadata.Unicode.widths,i=["","0","00","000","0000"],a=[""],s=0,o=t.length;s<o;++s){if(n=e.metadata.characterToGlyph(t.charCodeAt(s)),e.metadata.glyIdsUsed.push(n),e.metadata.toUnicode[n]=t.charCodeAt(s),-1==r.indexOf(n)&&(r.push(n),r.push([parseInt(e.metadata.widthOfGlyph(n),10)])),"0"==n)return a.join("");n=n.toString(16),a.push(i[4-n.length],n)}return a.join("")},r=function(t){var e,n,r,i,a,s,o;for(a="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",r=[],s=0,o=(n=Object.keys(t).sort(function(t,e){return t-e})).length;s<o;s++)e=n[s],r.length>=100&&(a+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar",r=[]),void 0!==t[e]&&null!==t[e]&&"function"==typeof t[e].toString&&(i=("0000"+t[e].toString(16)).slice(-4),e=("0000"+(+e).toString(16)).slice(-4),r.push("<"+e+"><"+i+">"));return r.length&&(a+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar\n"),a+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};e.events.push(["putFont",function(e){!function(e){var n=e.font,i=e.out,a=e.newObject,s=e.putStream;if(n.metadata instanceof t.API.TTFFont&&"Identity-H"===n.encoding){for(var o=n.metadata.Unicode.widths,h=n.metadata.subset.encode(n.metadata.glyIdsUsed,1),l="",c=0;c<h.length;c++)l+=String.fromCharCode(h[c]);var u=a();s({data:l,addLength1:!0,objectId:u}),i("endobj");var f=a();s({data:r(n.metadata.toUnicode),addLength1:!0,objectId:f}),i("endobj");var d=a();i("<<"),i("/Type /FontDescriptor"),i("/FontName /"+C(n.fontName)),i("/FontFile2 "+u+" 0 R"),i("/FontBBox "+t.API.PDFObject.convert(n.metadata.bbox)),i("/Flags "+n.metadata.flags),i("/StemV "+n.metadata.stemV),i("/ItalicAngle "+n.metadata.italicAngle),i("/Ascent "+n.metadata.ascender),i("/Descent "+n.metadata.decender),i("/CapHeight "+n.metadata.capHeight),i(">>"),i("endobj");var p=a();i("<<"),i("/Type /Font"),i("/BaseFont /"+C(n.fontName)),i("/FontDescriptor "+d+" 0 R"),i("/W "+t.API.PDFObject.convert(o)),i("/CIDToGIDMap /Identity"),i("/DW 1000"),i("/Subtype /CIDFontType2"),i("/CIDSystemInfo"),i("<<"),i("/Supplement 0"),i("/Registry (Adobe)"),i("/Ordering ("+n.encoding+")"),i(">>"),i(">>"),i("endobj"),n.objectNumber=a(),i("<<"),i("/Type /Font"),i("/Subtype /Type0"),i("/ToUnicode "+f+" 0 R"),i("/BaseFont /"+C(n.fontName)),i("/Encoding /"+n.encoding),i("/DescendantFonts ["+p+" 0 R]"),i(">>"),i("endobj"),n.isAlreadyPutted=!0}}(e)}]),e.events.push(["putFont",function(e){!function(e){var n=e.font,i=e.out,a=e.newObject,s=e.putStream;if(n.metadata instanceof t.API.TTFFont&&"WinAnsiEncoding"===n.encoding){for(var o=n.metadata.rawData,h="",l=0;l<o.length;l++)h+=String.fromCharCode(o[l]);var c=a();s({data:h,addLength1:!0,objectId:c}),i("endobj");var u=a();s({data:r(n.metadata.toUnicode),addLength1:!0,objectId:u}),i("endobj");var f=a();i("<<"),i("/Descent "+n.metadata.decender),i("/CapHeight "+n.metadata.capHeight),i("/StemV "+n.metadata.stemV),i("/Type /FontDescriptor"),i("/FontFile2 "+c+" 0 R"),i("/Flags 96"),i("/FontBBox "+t.API.PDFObject.convert(n.metadata.bbox)),i("/FontName /"+C(n.fontName)),i("/ItalicAngle "+n.metadata.italicAngle),i("/Ascent "+n.metadata.ascender),i(">>"),i("endobj"),n.objectNumber=a();for(var d=0;d<n.metadata.hmtx.widths.length;d++)n.metadata.hmtx.widths[d]=parseInt(n.metadata.hmtx.widths[d]*(1e3/n.metadata.head.unitsPerEm));i("<</Subtype/TrueType/Type/Font/ToUnicode "+u+" 0 R/BaseFont/"+C(n.fontName)+"/FontDescriptor "+f+" 0 R/Encoding/"+n.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(n.metadata.hmtx.widths)+">>"),i("endobj"),n.isAlreadyPutted=!0}}(e)}]);var i=function(t){var e,r=t.text||"",i=t.x,a=t.y,s=t.options||{},o=t.mutex||{},h=o.pdfEscape,l=o.activeFontKey,c=o.fonts,u=l,f="",d=0,p="",g=c[u].encoding;if("Identity-H"!==c[u].encoding)return{text:r,x:i,y:a,options:s,mutex:o};for(p=r,u=l,Array.isArray(r)&&(p=r[0]),d=0;d<p.length;d+=1)c[u].metadata.hasOwnProperty("cmap")&&(e=c[u].metadata.cmap.unicode.codeMap[p[d].charCodeAt(0)]),e||p[d].charCodeAt(0)<256&&c[u].metadata.hasOwnProperty("Unicode")?f+=p[d]:f+="";var m="";return parseInt(u.slice(1))<14||"WinAnsiEncoding"===g?m=h(f,u).split("").map(function(t){return t.charCodeAt(0).toString(16)}).join(""):"Identity-H"===g&&(m=n(f,c[u])),o.isHex=!0,{text:m,x:i,y:a,options:s,mutex:o}};e.events.push(["postProcessText",function(t){var e=t.text||"",n=[],r={text:e,x:t.x,y:t.y,options:t.options,mutex:t.mutex};if(Array.isArray(e)){var a=0;for(a=0;a<e.length;a+=1)Array.isArray(e[a])&&3===e[a].length?n.push([i(Object.assign({},r,{text:e[a][0]})).text,e[a][1],e[a][2]]):n.push(i(Object.assign({},r,{text:e[a]})).text);t.text=n}else t.text=i(Object.assign({},r,{text:e})).text}])}(R),
/**
   * @license
   * jsPDF virtual FileSystem functionality
   *
   * Licensed under the MIT License.
   * http://opensource.org/licenses/mit-license
   */
function(t){var e=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(t){return e.call(this),void 0!==this.internal.vFS[t]},t.addFileToVFS=function(t,n){return e.call(this),this.internal.vFS[t]=n,this},t.getFileFromVFS=function(t){return e.call(this),void 0!==this.internal.vFS[t]?this.internal.vFS[t]:null}}(R.API),
/**
   * @license
   * Unicode Bidi Engine based on the work of Alex Shensis (@asthensis)
   * MIT License
   */
function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(t){var n,r,i,a,s,o,h,l=e,c=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],f={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},d={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},p=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],g=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),m=!1,b=0;this.__bidiEngine__={};var v=function(t){var e=t.charCodeAt(),n=e>>8,r=d[n];return void 0!==r?l[256*r+(255&e)]:252===n||253===n?"AL":g.test(n)?"L":8===n?"R":"N"},w=function(t){for(var e,n=0;n<t.length;n++){if("L"===(e=v(t.charAt(n))))return!1;if("R"===e)return!0}return!1},y=function(t,e,s,o){var h,l,c,u,f=e[o];switch(f){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":m=!1;break;case"N":case"AN":break;case"EN":m&&(f="AN");break;case"AL":m=!0,f="R";break;case"WS":case"BN":f="N";break;case"CS":o<1||o+1>=e.length||"EN"!==(h=s[o-1])&&"AN"!==h||"EN"!==(l=e[o+1])&&"AN"!==l?f="N":m&&(l="AN"),f=l===h?l:"N";break;case"ES":f="EN"===(h=o>0?s[o-1]:"B")&&o+1<e.length&&"EN"===e[o+1]?"EN":"N";break;case"ET":if(o>0&&"EN"===s[o-1]){f="EN";break}if(m){f="N";break}for(c=o+1,u=e.length;c<u&&"ET"===e[c];)c++;f=c<u&&"EN"===e[c]?"EN":"N";break;case"NSM":if(i&&!a){for(u=e.length,c=o+1;c<u&&"NSM"===e[c];)c++;if(c<u){var d=t[o],p=d>=1425&&d<=2303||64286===d;if(h=e[c],p&&("R"===h||"AL"===h)){f="R";break}}}f=o<1||"B"===(h=e[o-1])?"N":s[o-1];break;case"B":m=!1,n=!0,f=b;break;case"S":r=!0,f="N"}return f},_=function(t,e,n){var r=t.split("");return n&&x(r,n,{hiLevel:b}),r.reverse(),e&&e.reverse(),r.join("")},x=function(t,e,i){var a,s,o,h,l,d=-1,p=t.length,g=0,w=[],_=b?u:c,x=[];for(m=!1,n=!1,r=!1,s=0;s<p;s++)x[s]=v(t[s]);for(o=0;o<p;o++){if(l=g,w[o]=y(t,x,w,o),a=240&(g=_[l][f[w[o]]]),g&=15,e[o]=h=_[g][5],a>0)if(16===a){for(s=d;s<o;s++)e[s]=1;d=-1}else d=-1;if(_[g][6])-1===d&&(d=o);else if(d>-1){for(s=d;s<o;s++)e[s]=h;d=-1}"B"===x[o]&&(e[o]=0),i.hiLevel|=h}r&&function(t,e,n){for(var r=0;r<n;r++)if("S"===t[r]){e[r]=b;for(var i=r-1;i>=0&&"WS"===t[i];i--)e[i]=b}}(x,e,p)},A=function(t,e,r,i,a){if(!(a.hiLevel<t)){if(1===t&&1===b&&!n)return e.reverse(),void(r&&r.reverse());for(var s,o,h,l,c=e.length,u=0;u<c;){if(i[u]>=t){for(h=u+1;h<c&&i[h]>=t;)h++;for(l=u,o=h-1;l<o;l++,o--)s=e[l],e[l]=e[o],e[o]=s,r&&(s=r[l],r[l]=r[o],r[o]=s);u=h}u++}}},L=function(t,e,n){var r=t.split(""),i={hiLevel:b};return n||(n=[]),x(r,n,i),function(t,e,n){if(0!==n.hiLevel&&h)for(var r,i=0;i<t.length;i++)1===e[i]&&(r=p.indexOf(t[i]))>=0&&(t[i]=p[r+1])}(r,n,i),A(2,r,e,n,i),A(1,r,e,n,i),r.join("")};return this.__bidiEngine__.doBidiReorder=function(t,e,n){if(function(t,e){if(e)for(var n=0;n<t.length;n++)e[n]=n;void 0===a&&(a=w(t)),void 0===o&&(o=w(t))}(t,e),i||!s||o)if(i&&s&&a^o)b=a?1:0,t=_(t,e,n);else if(!i&&s&&o)b=a?1:0,t=L(t,e,n),t=_(t,e);else if(!i||a||s||o){if(i&&!s&&a^o)t=_(t,e),a?(b=0,t=L(t,e,n)):(b=1,t=L(t,e,n),t=_(t,e));else if(i&&a&&!s&&o)b=1,t=L(t,e,n),t=_(t,e);else if(!i&&!s&&a^o){var r=h;a?(b=1,t=L(t,e,n),b=0,h=!1,t=L(t,e,n),h=r):(b=0,t=L(t,e,n),t=_(t,e),b=1,h=!1,t=L(t,e,n),h=r,t=_(t,e))}}else b=0,t=L(t,e,n);else b=a?1:0,t=L(t,e,n);return t},this.__bidiEngine__.setOptions=function(t){t&&(i=t.isInputVisual,s=t.isOutputVisual,a=t.isInputRtl,o=t.isOutputRtl,h=t.isSymmetricSwapping)},this.__bidiEngine__.setOptions(t),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(t){var e=t.text;t.x,t.y;var r=t.options||{};t.mutex,r.lang;var i=[];if(r.isInputVisual="boolean"!=typeof r.isInputVisual||r.isInputVisual,n.setOptions(r),"[object Array]"===Object.prototype.toString.call(e)){var a=0;for(i=[],a=0;a<e.length;a+=1)"[object Array]"===Object.prototype.toString.call(e[a])?i.push([n.doBidiReorder(e[a][0]),e[a][1],e[a][2]]):i.push([n.doBidiReorder(e[a])]);t.text=i}else t.text=n.doBidiReorder(e);n.setOptions({isInputVisual:!0})}])}(R),R.API.TTFFont=function(){function t(t){var e;if(this.rawData=t,e=this.contents=new Ta(t),this.contents.pos=4,"ttcf"===e.readString(4))throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new rs(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new qa(this.contents),this.head=new Ua(this),this.name=new Ja(this),this.cmap=new Wa(this),this.toUnicode={},this.hhea=new Va(this),this.maxp=new Xa(this),this.hmtx=new Ka(this),this.post=new Ya(this),this.os2=new Ga(this),this.loca=new ns(this),this.glyf=new Qa(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var t,e,n,r,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var e,n,r,i;for(i=[],e=0,n=(r=this.bbox).length;e<n;e++)t=r[e],i.push(Math.round(t*this.scaleFactor));return i}.call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),32768&(e=r>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(i=this.familyClass)||2===i||3===i||4===i||5===i||7===i,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(t){var e;return(null!=(e=this.cmap.unicode)?e.codeMap[t]:void 0)||0},t.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},t.prototype.widthOfString=function(t,e,n){var r,i,a,s;for(a=0,i=0,s=(t=""+t).length;0<=s?i<s:i>s;i=0<=s?++i:--i)r=t.charCodeAt(i),a+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/e)||0;return a*(e/1e3)},t.prototype.lineHeight=function(t,e){var n;return null==e&&(e=!1),n=e?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},t}();var Ra,Ta=function(){function t(t){this.data=null!=t?t:[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(t){return this.data[this.pos++]=t},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},t.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},t.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},t.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},t.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},t.prototype.readString=function(t){var e,n;for(n=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)n[e]=String.fromCharCode(this.readByte());return n.join("")},t.prototype.writeString=function(t){var e,n,r;for(r=[],e=0,n=t.length;0<=n?e<n:e>n;e=0<=n?++e:--e)r.push(this.writeByte(t.charCodeAt(e)));return r},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(t){return this.writeInt16(t)},t.prototype.readLongLong=function(){var t,e,n,r,i,a,s,o;return t=this.readByte(),e=this.readByte(),n=this.readByte(),r=this.readByte(),i=this.readByte(),a=this.readByte(),s=this.readByte(),o=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^i)+65536*(255^a)+256*(255^s)+(255^o)+1):72057594037927940*t+281474976710656*e+1099511627776*n+4294967296*r+16777216*i+65536*a+256*s+o},t.prototype.writeLongLong=function(t){var e,n;return e=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(t){return this.writeInt32(t)},t.prototype.read=function(t){var e,n;for(e=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)e.push(this.readByte());return e},t.prototype.write=function(t){var e,n,r,i;for(i=[],n=0,r=t.length;n<r;n++)e=t[n],i.push(this.writeByte(e));return i},t}(),qa=function(){var t;function e(t){var e,n,r;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},n=0,r=this.tableCount;0<=r?n<r:n>r;n=0<=r?++n:--n)e={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[e.tag]=e}return e.prototype.encode=function(e){var n,r,i,a,s,o,h,l,c,u,f,d,p;for(p in f=Object.keys(e).length,o=Math.log(2),c=16*Math.floor(Math.log(f)/o),a=Math.floor(c/o),l=16*f-c,(r=new Ta).writeInt(this.scalarType),r.writeShort(f),r.writeShort(c),r.writeShort(a),r.writeShort(l),i=16*f,h=r.pos+i,s=null,d=[],e)for(u=e[p],r.writeString(p),r.writeInt(t(u)),r.writeInt(h),r.writeInt(u.length),d=d.concat(u),"head"===p&&(s=h),h+=u.length;h%4;)d.push(0),h++;return r.write(d),n=2981146554-t(r.data),r.pos=s+8,r.writeUInt32(n),r.data},t=function(t){var e,n,r,i;for(t=$a.call(t);t.length%4;)t.push(0);for(r=new Ta(t),n=0,e=0,i=t.length;e<i;e=e+=4)n+=r.readUInt32();return 4294967295&n},e}(),Da={}.hasOwnProperty,za=function(t,e){for(var n in e)Da.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Ua=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var e;return(e=new Ta).writeInt(this.version),e.writeInt(this.revision),e.writeInt(this.checkSumAdjustment),e.writeInt(this.magicNumber),e.writeShort(this.flags),e.writeShort(this.unitsPerEm),e.writeLongLong(this.created),e.writeLongLong(this.modified),e.writeShort(this.xMin),e.writeShort(this.yMin),e.writeShort(this.xMax),e.writeShort(this.yMax),e.writeShort(this.macStyle),e.writeShort(this.lowestRecPPEM),e.writeShort(this.fontDirectionHint),e.writeShort(t),e.writeShort(this.glyphDataFormat),e.data},e}(Ra=function(){function t(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t}()),Ha=function(){function t(t,e){var n,r,i,a,s,o,h,l,c,u,f,d,p,g,m,b,v;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),c=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=t.readByte();break;case 4:for(f=t.readUInt16(),u=f/2,t.pos+=6,i=function(){var e,n;for(n=[],o=e=0;0<=u?e<u:e>u;o=0<=u?++e:--e)n.push(t.readUInt16());return n}(),t.pos+=2,p=function(){var e,n;for(n=[],o=e=0;0<=u?e<u:e>u;o=0<=u?++e:--e)n.push(t.readUInt16());return n}(),h=function(){var e,n;for(n=[],o=e=0;0<=u?e<u:e>u;o=0<=u?++e:--e)n.push(t.readUInt16());return n}(),l=function(){var e,n;for(n=[],o=e=0;0<=u?e<u:e>u;o=0<=u?++e:--e)n.push(t.readUInt16());return n}(),r=(this.length-t.pos+this.offset)/2,s=function(){var e,n;for(n=[],o=e=0;0<=r?e<r:e>r;o=0<=r?++e:--e)n.push(t.readUInt16());return n}(),o=m=0,v=i.length;m<v;o=++m)for(g=i[o],n=b=d=p[o];d<=g?b<=g:b>=g;n=d<=g?++b:--b)0===l[o]?a=n+h[o]:0!==(a=s[l[o]/2+(n-d)-(u-o)]||0)&&(a+=h[o]),this.codeMap[n]=65535&a}t.pos=c}return t.encode=function(t,e){var n,r,i,a,s,o,h,l,c,u,f,d,p,g,m,b,v,w,y,_,x,A,L,N,S,k,P,F,I,C,j,E,O,B,M,R,T,q,D,z,U,H,W,V,G,Y;switch(F=new Ta,a=Object.keys(t).sort(function(t,e){return t-e}),e){case"macroman":for(p=0,g=function(){var t=[];for(d=0;d<256;++d)t.push(0);return t}(),b={0:0},i={},I=0,O=a.length;I<O;I++)null==b[W=t[r=a[I]]]&&(b[W]=++p),i[r]={old:t[r],new:b[t[r]]},g[r]=b[t[r]];return F.writeUInt16(1),F.writeUInt16(0),F.writeUInt32(12),F.writeUInt16(0),F.writeUInt16(262),F.writeUInt16(0),F.write(g),{charMap:i,subtable:F.data,maxGlyphID:p+1};case"unicode":for(k=[],c=[],v=0,b={},n={},m=h=null,C=0,B=a.length;C<B;C++)null==b[y=t[r=a[C]]]&&(b[y]=++v),n[r]={old:y,new:b[y]},s=b[y]-r,null!=m&&s===h||(m&&c.push(m),k.push(r),h=s),m=r;for(m&&c.push(m),c.push(65535),k.push(65535),N=2*(L=k.length),A=2*Math.pow(Math.log(L)/Math.LN2,2),u=Math.log(A/2)/Math.LN2,x=2*L-A,o=[],_=[],f=[],d=j=0,M=k.length;j<M;d=++j){if(S=k[d],l=c[d],65535===S){o.push(0),_.push(0);break}if(S-(P=n[S].new)>=32768)for(o.push(0),_.push(2*(f.length+L-d)),r=E=S;S<=l?E<=l:E>=l;r=S<=l?++E:--E)f.push(n[r].new);else o.push(P-S),_.push(0)}for(F.writeUInt16(3),F.writeUInt16(1),F.writeUInt32(12),F.writeUInt16(4),F.writeUInt16(16+8*L+2*f.length),F.writeUInt16(0),F.writeUInt16(N),F.writeUInt16(A),F.writeUInt16(u),F.writeUInt16(x),U=0,R=c.length;U<R;U++)r=c[U],F.writeUInt16(r);for(F.writeUInt16(0),H=0,T=k.length;H<T;H++)r=k[H],F.writeUInt16(r);for(V=0,q=o.length;V<q;V++)s=o[V],F.writeUInt16(s);for(G=0,D=_.length;G<D;G++)w=_[G],F.writeUInt16(w);for(Y=0,z=f.length;Y<z;Y++)p=f[Y],F.writeUInt16(p);return{charMap:n,subtable:F.data,maxGlyphID:v+1}}},t}(),Wa=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="cmap",e.prototype.parse=function(t){var e,n,r;for(t.pos=this.offset,this.version=t.readUInt16(),r=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)e=new Ha(t,this.offset),this.tables.push(e),e.isUnicode&&null==this.unicode&&(this.unicode=e);return!0},e.encode=function(t,e){var n,r;return null==e&&(e="macroman"),n=Ha.encode(t,e),(r=new Ta).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},e}(Ra),Va=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(Ra),Ga=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var e,n;for(n=[],e=0;e<10;++e)n.push(t.readByte());return n}(),this.charRange=function(){var e,n;for(n=[],e=0;e<4;++e)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var e,n;for(n=[],e=0;e<2;e=++e)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(Ra),Ya=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="post",e.prototype.parse=function(t){var e,n,r;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:case 196608:break;case 131072:var i;for(n=t.readUInt16(),this.glyphNameIndex=[],i=0;0<=n?i<n:i>n;i=0<=n?++i:--i)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],r=[];t.pos<this.offset+this.length;)e=t.readByte(),r.push(this.names.push(t.readString(e)));return r;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 262144:return this.map=function(){var e,n,r;for(r=[],i=e=0,n=this.file.maxp.numGlyphs;0<=n?e<n:e>n;i=0<=n?++e:--e)r.push(t.readUInt32());return r}.call(this)}},e}(Ra),Za=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},Ja=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="name",e.prototype.parse=function(t){var e,n,r,i,a,s,o,h,l,c,u;for(t.pos=this.offset,t.readShort(),e=t.readShort(),s=t.readShort(),n=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+s+t.readShort()});for(o={},i=l=0,c=n.length;l<c;i=++l)r=n[i],t.pos=r.offset,h=t.readString(r.length),a=new Za(h,r),null==o[u=r.nameID]&&(o[u]=[]),o[r.nameID].push(a);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(is){this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},e}(Ra),Xa=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(Ra),Ka=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="hmtx",e.prototype.parse=function(t){var e,n,r,i,a,s,o;for(t.pos=this.offset,this.metrics=[],e=0,s=this.file.hhea.numberOfMetrics;0<=s?e<s:e>s;e=0<=s?++e:--e)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var n,i;for(i=[],e=n=0;0<=r?n<r:n>r;e=0<=r?++n:--n)i.push(t.readInt16());return i}(),this.widths=function(){var t,e,n,r;for(r=[],t=0,e=(n=this.metrics).length;t<e;t++)i=n[t],r.push(i.advance);return r}.call(this),n=this.widths[this.widths.length-1],o=[],e=a=0;0<=r?a<r:a>r;e=0<=r?++a:--a)o.push(this.widths.push(n));return o},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(Ra),$a=[].slice,Qa=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var e,n,r,i,a,s,o,h,l,c;return t in this.cache?this.cache[t]:(i=this.file.loca,e=this.file.contents,n=i.indexOf(t),0===(r=i.lengthOf(t))?this.cache[t]=null:(e.pos=this.offset+n,a=(s=new Ta(e.read(r))).readShort(),h=s.readShort(),c=s.readShort(),o=s.readShort(),l=s.readShort(),this.cache[t]=-1===a?new es(s,h,c,o,l):new ts(s,a,h,c,o,l),this.cache[t]))},e.prototype.encode=function(t,e,n){var r,i,a,s,o;for(a=[],i=[],s=0,o=e.length;s<o;s++)r=t[e[s]],i.push(a.length),r&&(a=a.concat(r.encode(n)));return i.push(a.length),{table:a,offsets:i}},e}(Ra),ts=function(){function t(t,e,n,r,i,a){this.raw=t,this.numberOfContours=e,this.xMin=n,this.yMin=r,this.xMax=i,this.yMax=a,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t}(),es=function(){function t(t,e,n,r,i){var a,s;for(this.raw=t,this.xMin=e,this.yMin=n,this.xMax=r,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;s=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&s;)a.pos+=1&s?4:2,128&s?a.pos+=8:64&s?a.pos+=4:8&s&&(a.pos+=2)}return t.prototype.encode=function(){var t,e,n;for(e=new Ta($a.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)e.pos=this.glyphOffsets[t];return e.data},t}(),ns=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return za(e,t),e.prototype.tag="loca",e.prototype.parse=function(t){var e,n;return t.pos=this.offset,e=this.file.head.indexToLocFormat,this.offsets=0===e?function(){var e,r;for(r=[],n=0,e=this.length;n<e;n+=2)r.push(2*t.readUInt16());return r}.call(this):function(){var e,r;for(r=[],n=0,e=this.length;n<e;n+=4)r.push(t.readUInt32());return r}.call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,e){for(var n=new Uint32Array(this.offsets.length),r=0,i=0,a=0;a<n.length;++a)if(n[a]=r,i<e.length&&e[i]==a){++i,n[a]=r;var s=this.offsets[a],o=this.offsets[a+1]-s;o>0&&(r+=o)}for(var h=new Array(4*n.length),l=0;l<n.length;++l)h[4*l+3]=255&n[l],h[4*l+2]=(65280&n[l])>>8,h[4*l+1]=(16711680&n[l])>>16,h[4*l]=(4278190080&n[l])>>24;return h},e}(Ra),rs=function(){function t(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var t,e,n,r,i;for(e in r=this.font.cmap.tables[0].codeMap,t={},i=this.subset)n=i[e],t[e]=r[n];return t},t.prototype.glyphsFor=function(t){var e,n,r,i,a,s,o;for(r={},a=0,s=t.length;a<s;a++)r[i=t[a]]=this.font.glyf.glyphFor(i);for(i in e=[],r)(null!=(n=r[i])?n.compound:void 0)&&e.push.apply(e,n.glyphIDs);if(e.length>0)for(i in o=this.glyphsFor(e))n=o[i],r[i]=n;return r},t.prototype.encode=function(t,e){var n,r,i,a,s,o,h,l,c,u,f,d,p,g,m;for(r in n=Wa.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),f={0:0},m=n.charMap)f[(o=m[r]).old]=o.new;for(d in u=n.maxGlyphID,a)d in f||(f[d]=u++);return l=function(t){var e,n;for(e in n={},t)n[t[e]]=e;return n}(f),c=Object.keys(l).sort(function(t,e){return t-e}),p=function(){var t,e,n;for(n=[],t=0,e=c.length;t<e;t++)s=c[t],n.push(l[s]);return n}(),i=this.font.glyf.encode(a,p,f),h=this.font.loca.encode(i.offsets,p),g={cmap:this.font.cmap.raw(),glyf:i.table,loca:h,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(g["OS/2"]=this.font.os2.raw()),this.font.directory.encode(g)},t}();R.API.PDFObject=function(){var t;function e(){}return t=function(t,e){return(Array(e+1).join("0")+t).slice(-e)},e.convert=function(n){var r,i,a,s;if(Array.isArray(n))return"["+function(){var t,i,a;for(a=[],t=0,i=n.length;t<i;t++)r=n[t],a.push(e.convert(r));return a}().join(" ")+"]";if("string"==typeof n)return"/"+n;if(null!=n?n.isString:void 0)return"("+n+")";if(n instanceof Date)return"(D:"+t(n.getUTCFullYear(),4)+t(n.getUTCMonth(),2)+t(n.getUTCDate(),2)+t(n.getUTCHours(),2)+t(n.getUTCMinutes(),2)+t(n.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(n)){for(i in a=["<<"],n)s=n[i],a.push("/"+i+" "+e.convert(s));return a.push(">>"),a.join("\n")}return""+n},e}(),t.AcroForm=St,t.AcroFormAppearance=Lt,t.AcroFormButton=bt,t.AcroFormCheckBox=_t,t.AcroFormChoiceField=dt,t.AcroFormComboBox=gt,t.AcroFormEditBox=mt,t.AcroFormListBox=pt,t.AcroFormPasswordField=At,t.AcroFormPushButton=vt,t.AcroFormRadioButton=wt,t.AcroFormTextField=xt,t.GState=E,t.ShadingPattern=B,t.TilingPattern=M,t.default=R,t.jsPDF=R,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=jspdf.umd.min.js.map

    </script>
    <script>
        // Slideout panel funkce
        function openSlideout(panelId) {
            document.getElementById('slideoutOverlay').classList.add('open');
            document.getElementById(panelId).classList.add('open');
            document.body.style.overflow = 'hidden';
            
            if (panelId === 'prehledNedostatku') {
                renderGlobalIssues();
            }
        }
        
        function closeSlideout(panelId) {
            document.getElementById('slideoutOverlay').classList.remove('open');
            document.getElementById(panelId).classList.remove('open');
            document.body.style.overflow = '';
        }
        
        function closeAllSlideouts() {
            document.querySelectorAll('.slideout-panel').forEach(panel => {
                panel.classList.remove('open');
            });
            document.getElementById('slideoutOverlay').classList.remove('open');
            document.body.style.overflow = '';
        }
        
        // Dropdown menu
        function toggleActionDropdown() {
            const dropdown = document.getElementById('akceRizeniDropdown');
            dropdown.classList.toggle('open');
            
            // Close on click outside
            if (dropdown.classList.contains('open')) {
                setTimeout(() => {
                    document.addEventListener('click', closeDropdownOnClickOutside);
                }, 0);
            }
        }
        
        function closeDropdownOnClickOutside(e) {
            const dropdown = document.getElementById('akceRizeniDropdown');
            const btn = document.getElementById('btnAkceRizeni');
            if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
                dropdown.classList.remove('open');
                document.removeEventListener('click', closeDropdownOnClickOutside);
            }
        }
        
        function showActionModal(action) {
            document.getElementById('akceRizeniDropdown').classList.remove('open');
            alert('Akce "' + action + '" - bude implementováno');
        }
        
        function exportNedostatky() {
            alert('Export nedostatků - bude implementováno');
        }
        
        function editUdaj(udaj) {
            alert('Úprava údaje "' + udaj + '" - bude implementováno');
        }
        
        // Inicializace badge při načtení
        document.addEventListener('DOMContentLoaded', function() {
            updateGlobalIssuesBadge();
            initSimulationPanel();
        });
    </script>
    
    <!-- ==========================================
         SIMULAČNÍ PANEL - DevTools pro maketu
         ========================================== -->
    <div class="sim-panel minimized" id="simPanel">
        <div class="sim-panel-header" onclick="toggleSimPanel()">
            <div class="sim-panel-title">
                <span class="material-icons-outlined">science</span>
                <span class="sim-panel-title-text">Simulace</span>
            </div>
            <div class="sim-panel-toggle">
                <span class="material-icons-outlined" id="simPanelToggleIcon">expand_more</span>
            </div>
        </div>
        <div class="sim-panel-body" id="simPanelBody">
            <div class="sim-section">
                <div class="sim-section-title">Platnost právní úpravy</div>
                <div class="sim-scenarios">
                    <label class="sim-radio">
                        <input type="radio" name="platnost" value="do2027" checked onchange="applyPlatnost(this.value)">
                        <span class="sim-radio-label">
                            <strong>Do 31. 12. 2027</strong>
                            <small>Současný stav — krajské SÚ, samostatné DO</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="platnost" value="od2028" onchange="applyPlatnost(this.value)">
                        <span class="sim-radio-label">
                            <strong>Od 1. 1. 2028</strong>
                            <small>Jednotná státní stavební správa, integrované DO</small>
                        </span>
                    </label>
                </div>
            </div>
            <div class="sim-section">
                <div class="sim-section-title">Podání žádosti</div>
                <div class="sim-scenarios">
                    <label class="sim-radio">
                        <input type="radio" name="typPodani" value="portal" checked onchange="applyTypPodani(this.value)">
                        <span class="sim-radio-label">
                            <strong>Portál stavebníka</strong>
                            <small>Elektronická žádost — strukturovaná data</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="typPodani" value="vlozena" onchange="applyTypPodani(this.value)">
                        <span class="sim-radio-label">
                            <strong>Vložená žádost</strong>
                            <small>Listinná / datová schránka — PDF dokument</small>
                        </span>
                    </label>
                </div>
            </div>
            <div class="sim-section">
                <div class="sim-section-title">Rychlost řízení</div>
                <div class="sim-scenarios">
                    <label class="sim-radio">
                        <input type="radio" name="rychlostRizeni" value="zrychlene" checked onchange="applyRychlostRizeni(this.value)">
                        <span class="sim-radio-label">
                            <strong>Zrychlené řízení</strong>
                            <small>Bez ústního jednání, do 30 dnů</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="rychlostRizeni" value="standardni" onchange="applyRychlostRizeni(this.value)">
                        <span class="sim-radio-label">
                            <strong>Standardní řízení</strong>
                            <small>S ústním jednáním, do 60 dnů</small>
                        </span>
                    </label>
                </div>
            </div>
            <div class="sim-section">
                <div class="sim-section-title">Scénář žádosti</div>
                <div class="sim-scenarios">
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="zakladni" checked onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Základní</strong>
                            <small>FO žadatel, bez zástupce, vlastník</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="zastupce-pm" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Zástupce — plná moc</strong>
                            <small>FO + zástupce na základě listinné PM</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="zastupce-reza" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Zástupce — REZA</strong>
                            <small>FO + zástupce z registru el. zastupování</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="pravnicka-osoba" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Právnická osoba</strong>
                            <small>PO žadatel (s.r.o.), jednatel</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="osvc" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>OSVČ</strong>
                            <small>Fyzická osoba podnikající</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="spoluvlastnici" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Spoluvlastníci</strong>
                            <small>Více žadatelů — manželé</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="neni-vlastnik" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Není vlastník</strong>
                            <small>Žadatel nemá právo k pozemku</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="s-vyjimkami" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>S výjimkami</strong>
                            <small>Obsahuje žádost o výjimku</small>
                        </span>
                    </label>
                    <label class="sim-radio">
                        <input type="radio" name="scenar" value="komplexni" onchange="applyScenario(this.value)">
                        <span class="sim-radio-label">
                            <strong>Komplexní</strong>
                            <small>PO + REZA + není vlastník + výjimka</small>
                        </span>
                    </label>
                </div>
            </div>
            <div class="sim-section">
                <div class="sim-section-title">Aktuální nastavení</div>
                <div class="sim-info" id="simInfo">
                    <div class="sim-info-row">
                        <span class="sim-info-label">Platnost:</span>
                        <span class="sim-info-value" id="simInfoPlatnost">Do 31. 12. 2027</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Podání:</span>
                        <span class="sim-info-value" id="simInfoPodani">Portál stavebníka</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Rychlost:</span>
                        <span class="sim-info-value" id="simInfoRychlost">Zrychlené řízení</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Typ žadatele:</span>
                        <span class="sim-info-value" id="simInfoTyp">Fyzická osoba</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Zástupce:</span>
                        <span class="sim-info-value" id="simInfoZastupce">Bez zástupce</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Vlastnictví:</span>
                        <span class="sim-info-value" id="simInfoVlastnictvi">Vlastník pozemku</span>
                    </div>
                    <div class="sim-info-row">
                        <span class="sim-info-label">Zvláštnosti:</span>
                        <span class="sim-info-value" id="simInfoZvlastnosti">—</span>
                    </div>
                </div>
            </div>
            <div class="sim-actions">
                <button class="sim-btn" onclick="copyScenarioUrl()">
                    <span class="material-icons-outlined">link</span>
                    Kopírovat URL
                </button>
                <button class="sim-btn" onclick="resetScenario()">
                    <span class="material-icons-outlined">refresh</span>
                    Reset
                </button>
            </div>
        </div>
    </div>
    
    <style>
        /* ==========================================
           PLATNOST PRÁVNÍ ÚPRAVY - INFO BOXY
           ========================================== */
        .platnost-info-box {
            display: flex;
            gap: 12px;
            padding: 14px 16px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 1px solid #90caf9;
            border-radius: 10px;
            margin: 16px 0;
        }
        
        .platnost-info-icon {
            flex-shrink: 0;
            width: 36px;
            height: 36px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .platnost-info-icon .material-icons-outlined {
            font-size: 20px;
            color: #1565c0;
        }
        
        .platnost-info-content {
            flex: 1;
        }
        
        .platnost-info-title {
            font-size: 13px;
            font-weight: 600;
            color: #1565c0;
            margin-bottom: 4px;
        }
        
        .platnost-info-text {
            font-size: 12px;
            color: #424242;
            line-height: 1.5;
        }
        
        /* Integrované DO badge list */
        .integrated-do-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }
        
        .integrated-do-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #fff;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
            color: #2e7d32;
        }
        .integrated-do-badge .material-icons-outlined {
            font-size: 14px;
        }
        
        /* Info box uvnitř matrix skupiny */
        .matrix-group .platnost-info-box {
            margin: 0 0 12px 0;
        }
        
        /* Varianta pro integrované DO */
        .integrated-do-info {
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            border-color: #a5d6a7;
        }
        .integrated-do-info .platnost-info-icon {
            background: #e8f5e9;
        }
        .integrated-do-info .platnost-info-icon .material-icons-outlined {
            color: #2e7d32;
        }
        .integrated-do-info .platnost-info-title {
            color: #2e7d32;
        }
    </style>
    
    <style>
        /* ==========================================
           SIMULAČNÍ PANEL - STYLY
           ========================================== */
        .sim-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 320px;
            background: #1a1a2e;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            z-index: 10000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .sim-panel.minimized {
            width: auto;
        }
        
        .sim-panel.minimized .sim-panel-body {
            display: none;
        }
        
        .sim-panel.minimized .sim-panel-title-text {
            display: none;
        }
        
        .sim-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            user-select: none;
        }
        
        .sim-panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-weight: 600;
            font-size: 13px;
        }
        
        .sim-panel-title .material-icons-outlined {
            font-size: 20px;
        }
        
        .sim-panel-toggle {
            color: rgba(255,255,255,0.8);
        }
        
        .sim-panel-toggle .material-icons-outlined {
            font-size: 20px;
            transition: transform 0.3s;
        }
        
        .sim-panel.minimized .sim-panel-toggle .material-icons-outlined {
            transform: rotate(180deg);
        }
        
        .sim-panel-body {
            padding: 16px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .sim-section {
            margin-bottom: 16px;
        }
        
        .sim-section:last-child {
            margin-bottom: 0;
        }
        
        .sim-section-title {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #8b8b9e;
            margin-bottom: 10px;
        }
        
        .sim-scenarios {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .sim-radio {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: #252542;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            border: 1px solid transparent;
        }
        
        .sim-radio:hover {
            background: #2d2d4a;
        }
        
        .sim-radio input {
            margin-top: 3px;
            accent-color: #667eea;
        }
        
        .sim-radio input:checked + .sim-radio-label strong {
            color: #a5b4fc;
        }
        
        .sim-radio:has(input:checked) {
            border-color: #667eea;
            background: #2d2d4a;
        }
        
        .sim-radio-label {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .sim-radio-label strong {
            font-size: 12px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        .sim-radio-label small {
            font-size: 10px;
            color: #8b8b9e;
        }
        
        .sim-info {
            background: #252542;
            border-radius: 8px;
            padding: 12px;
        }
        
        .sim-info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #333355;
        }
        
        .sim-info-row:last-child {
            border-bottom: none;
        }
        
        .sim-info-label {
            font-size: 11px;
            color: #8b8b9e;
        }
        
        .sim-info-value {
            font-size: 11px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        .sim-actions {
            display: flex;
            gap: 8px;
        }
        
        .sim-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 12px;
            background: #252542;
            border: none;
            border-radius: 8px;
            color: #a5b4fc;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .sim-btn:hover {
            background: #333355;
        }
        
        .sim-btn .material-icons-outlined {
            font-size: 16px;
        }
        
        /* Toast pro kopírování URL */
        .sim-toast {
            position: fixed;
            bottom: 100px;
            left: 20px;
            padding: 12px 20px;
            background: #333;
            color: #fff;
            border-radius: 8px;
            font-size: 13px;
            z-index: 10001;
            animation: simToastIn 0.3s ease;
        }
        
        @keyframes simToastIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    
    <script>
        // ==========================================
        // SIMULAČNÍ PANEL - JAVASCRIPT
        // ==========================================
        
        // Definice scénářů
        const scenarios = {
            'zakladni': {
                nazev: 'Základní',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: [],
                zvlastnostiText: '—',
                zadatel: {
                    jmeno: 'Jan',
                    prijmeni: 'Novák',
                    datumNarozeni: '15. 3. 1985',
                    trvaleBytem: 'Květná 123, 110 00 Praha 1',
                    email: 'jan.novak@email.cz',
                    telefon: '+420 601 234 567',
                    ds: 'abc123x'
                }
            },
            'zastupce-pm': {
                nazev: 'Zástupce — plná moc',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: 'pm',
                zastupceText: 'Listinná plná moc',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: ['plna-moc'],
                zvlastnostiText: 'Plná moc v příloze',
                zadatel: {
                    jmeno: 'Marie',
                    prijmeni: 'Svobodová',
                    datumNarozeni: '22. 7. 1978',
                    trvaleBytem: 'Lipová 45, 551 01 Jaroměř',
                    email: 'marie.svobodova@email.cz',
                    telefon: '+420 602 345 678',
                    ds: null
                },
                zastupceData: {
                    jmeno: 'Ing. Pavel',
                    prijmeni: 'Projektant',
                    datumNarozeni: '10. 5. 1970',
                    adresa: 'Projektová 789, 500 02 Hradec Králové',
                    ds: 'proj456x',
                    typPM: 'Listinná plná moc',
                    platnostPM: 'Neomezená'
                }
            },
            'zastupce-reza': {
                nazev: 'Zástupce — REZA',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: 'reza',
                zastupceText: 'REZA (el. zastupování)',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: ['reza'],
                zvlastnostiText: 'Zástupce z REZA',
                zadatel: {
                    jmeno: 'Petr',
                    prijmeni: 'Horák',
                    datumNarozeni: '3. 11. 1982',
                    trvaleBytem: 'Zahradní 567, 551 01 Jaroměř',
                    email: 'petr.horak@email.cz',
                    telefon: '+420 603 456 789',
                    ds: 'horak01'
                },
                zastupceData: {
                    jmeno: 'JUDr. Anna',
                    prijmeni: 'Advokátová',
                    ico: '12345678',
                    adresa: 'Právní 123, 110 00 Praha 1',
                    ds: 'advo123x',
                    typPM: 'REZA — Registr elektronického zastupování',
                    platnostPM: 'Do 31. 12. 2026',
                    rozsah: 'Stavební řízení'
                }
            },
            'pravnicka-osoba': {
                nazev: 'Právnická osoba',
                typZadatele: 'po',
                typZadateleText: 'Právnická osoba',
                zastupce: 'statutar',
                zastupceText: 'Jednatel (statutární orgán)',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: [],
                zvlastnostiText: '—',
                zadatel: {
                    nazev: 'STAVBY NOVÁK s.r.o.',
                    ico: '28563412',
                    sidlo: 'Průmyslová 456, 551 01 Jaroměř',
                    ds: 'stavnov1',
                    jednatel: 'Ing. Jan Novák'
                }
            },
            'osvc': {
                nazev: 'OSVČ',
                typZadatele: 'fo-podnikatel',
                typZadateleText: 'Fyzická osoba podnikající',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: [],
                zvlastnostiText: '—',
                zadatel: {
                    jmeno: 'Karel',
                    prijmeni: 'Podnikavý',
                    datumNarozeni: '18. 9. 1975',
                    trvaleBytem: 'Obchodní 321, 551 01 Jaroměř',
                    ico: '87654321',
                    misto: 'Obchodní 321, 551 01 Jaroměř',
                    email: 'karel@podnikavy.cz',
                    telefon: '+420 604 567 890',
                    ds: 'podn321x'
                }
            },
            'spoluvlastnici': {
                nazev: 'Spoluvlastníci',
                typZadatele: 'fo-vice',
                typZadateleText: 'Více žadatelů (manželé)',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: true,
                vlastnikText: 'Spoluvlastníci pozemku',
                zvlastnosti: ['vice-zadatelu'],
                zvlastnostiText: '2 žadatelé',
                zadatele: [
                    {
                        jmeno: 'Jan',
                        prijmeni: 'Manžel',
                        datumNarozeni: '5. 4. 1980',
                        trvaleBytem: 'Rodinná 111, 551 01 Jaroměř',
                        email: 'jan.manzel@email.cz',
                        telefon: '+420 605 678 901',
                        ds: 'manz01'
                    },
                    {
                        jmeno: 'Jana',
                        prijmeni: 'Manželová',
                        datumNarozeni: '12. 8. 1982',
                        trvaleBytem: 'Rodinná 111, 551 01 Jaroměř',
                        email: 'jana.manzelova@email.cz',
                        telefon: '+420 606 789 012',
                        ds: null
                    }
                ]
            },
            'neni-vlastnik': {
                nazev: 'Není vlastník',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: false,
                vlastnikText: 'NENÍ vlastník pozemku',
                zvlastnosti: ['souhlas-vlastnika'],
                zvlastnostiText: 'Souhlas vlastníka § 187',
                zadatel: {
                    jmeno: 'Tomáš',
                    prijmeni: 'Nájemce',
                    datumNarozeni: '25. 1. 1990',
                    trvaleBytem: 'Nájemní 222, 551 01 Jaroměř',
                    email: 'tomas.najemce@email.cz',
                    telefon: '+420 607 890 123',
                    ds: null
                },
                vlastnikPozemku: {
                    jmeno: 'Město Jaroměř',
                    typ: 'po',
                    souhlas: true
                }
            },
            's-vyjimkami': {
                nazev: 'S výjimkami',
                typZadatele: 'fo',
                typZadateleText: 'Fyzická osoba',
                zastupce: null,
                zastupceText: 'Bez zástupce',
                vlastnik: true,
                vlastnikText: 'Vlastník pozemku',
                zvlastnosti: ['vyjimka'],
                zvlastnostiText: 'Žádost o výjimku',
                zadatel: {
                    jmeno: 'Jiří',
                    prijmeni: 'Výjimečný',
                    datumNarozeni: '14. 2. 1978',
                    trvaleBytem: 'Speciální 444, 551 01 Jaroměř',
                    email: 'jiri@vyjimecny.cz',
                    telefon: '+420 609 012 345',
                    ds: 'vyji444'
                },
                vyjimka: {
                    typ: 'Odstupová vzdálenost',
                    popis: 'Snížení odstupové vzdálenosti od hranice pozemku z 2 m na 1,5 m',
                    oduvodneni: 'Stávající zástavba, terénní podmínky'
                }
            },
            'komplexni': {
                nazev: 'Komplexní',
                typZadatele: 'po',
                typZadateleText: 'Právnická osoba',
                zastupce: 'reza',
                zastupceText: 'REZA (el. zastupování)',
                vlastnik: false,
                vlastnikText: 'NENÍ vlastník pozemku',
                zvlastnosti: ['reza', 'souhlas-vlastnika', 'vyjimka'],
                zvlastnostiText: 'REZA + Souhlas + Výjimka',
                zadatel: {
                    nazev: 'DEVELOPMENT PLUS a.s.',
                    ico: '99887766',
                    sidlo: 'Developerská 999, 110 00 Praha 1',
                    ds: 'devplus1'
                },
                zastupceData: {
                    nazev: 'PROJEKTY PRO VÁS s.r.o.',
                    ico: '11223344',
                    sidlo: 'Projekční 555, 500 02 Hradec Králové',
                    ds: 'projvas1',
                    typPM: 'REZA — Registr elektronického zastupování',
                    platnostPM: 'Do 31. 12. 2027',
                    rozsah: 'Veškerá stavební řízení'
                },
                vlastnikPozemku: {
                    jmeno: 'Státní pozemkový úřad',
                    typ: 'po',
                    souhlas: true
                },
                vyjimka: {
                    typ: 'Požární odstup',
                    popis: 'Snížení požárního odstupu od sousední budovy',
                    oduvodneni: 'Kompenzováno protipožárním opatřením'
                }
            }
        };
        
        let currentScenario = 'zakladni';
        
        // Inicializace panelu
        function initSimulationPanel() {
            // Načíst parametry z URL
            const urlParams = new URLSearchParams(window.location.search);
            
            // Načíst platnost z URL
            const platnostFromUrl = urlParams.get('platnost');
            if (platnostFromUrl && (platnostFromUrl === 'do2027' || platnostFromUrl === 'od2028')) {
                platnostPravniUpravy = platnostFromUrl;
                document.querySelector(`input[name="platnost"][value="${platnostFromUrl}"]`).checked = true;
            }
            updateSimInfoPlatnost();
            
            // Načíst typ podání z URL
            const typPodaniFromUrl = urlParams.get('typPodani');
            if (typPodaniFromUrl && (typPodaniFromUrl === 'portal' || typPodaniFromUrl === 'vlozena')) {
                typPodaniZadosti = typPodaniFromUrl;
                document.querySelector(`input[name="typPodani"][value="${typPodaniFromUrl}"]`).checked = true;
            }
            
            // Načíst rychlost řízení z URL
            const rychlostFromUrl = urlParams.get('rychlost');
            if (rychlostFromUrl && (rychlostFromUrl === 'zrychlene' || rychlostFromUrl === 'standardni')) {
                rychlostRizeni = rychlostFromUrl;
                document.querySelector(`input[name="rychlostRizeni"][value="${rychlostFromUrl}"]`).checked = true;
            }
            // Vždy aplikovat rychlost řízení (pro správné zobrazení badge a karty), bez toastu
            applyRychlostRizeni(rychlostRizeni, false);
            
            updateSimInfo();
            
            // Načíst scénář z URL
            const scenarFromUrl = urlParams.get('scenar');
            
            if (scenarFromUrl && scenarios[scenarFromUrl]) {
                currentScenario = scenarFromUrl;
                document.querySelector(`input[name="scenar"][value="${scenarFromUrl}"]`).checked = true;
                applyScenario(scenarFromUrl, false);
            }
            
            // Aplikovat změny podle platnosti
            applyPlatnostChanges();
        }
        
        // Přepnout panel (minimalizovat/maximalizovat)
        function toggleSimPanel() {
            const panel = document.getElementById('simPanel');
            panel.classList.toggle('minimized');
        }
        
        // Aplikovat scénář
        function applyScenario(scenarioId, updateUrl = true) {
            currentScenario = scenarioId;
            const scenario = scenarios[scenarioId];
            
            if (!scenario) return;
            
            // Aktualizovat info panel
            document.getElementById('simInfoTyp').textContent = scenario.typZadateleText;
            document.getElementById('simInfoZastupce').textContent = scenario.zastupceText;
            document.getElementById('simInfoVlastnictvi').textContent = scenario.vlastnikText;
            document.getElementById('simInfoZvlastnosti').textContent = scenario.zvlastnostiText;
            
            // Aktualizovat URL
            if (updateUrl) {
                const url = new URL(window.location);
                url.searchParams.set('scenar', scenarioId);
                window.history.replaceState({}, '', url);
            }
            
            // Aktualizovat data v kontrole žádosti
            updateKontrolaZadostiData(scenario);
            
            // Aktualizovat checklist
            updateKontrolaZadostiChecklist(scenario);
            
            // Toast
            showSimToast(`Scénář: ${scenario.nazev}`);
        }
        
        // Aktualizovat strukturovaná data v kontrole žádosti
        function updateKontrolaZadostiData(scenario) {
            const sectionZadatel = document.getElementById('dataSectionZadatel');
            const sectionZastupce = document.getElementById('dataSectionZastupce');
            
            if (!sectionZadatel) return;
            
            // Helper funkce pro generování kontrolních prvků
            function getSectionControls(sectionId) {
                const currentStatus = zadostSectionState[sectionId];
                let statusHtml = '';
                let btnOkActive = '';
                let btnVadaActive = '';
                
                if (currentStatus === 'ok') {
                    statusHtml = '<span class="material-icons-outlined">check_circle</span> V pořádku';
                    btnOkActive = ' active';
                } else if (currentStatus === 'vada') {
                    statusHtml = '<span class="material-icons-outlined">error</span> Označeno jako vada';
                    btnVadaActive = ' active';
                } else {
                    statusHtml = '<span class="material-icons-outlined">radio_button_unchecked</span> Nezkontrolováno';
                }
                
                return `
                    <div class="zadost-section-controls">
                        <div class="zadost-section-status${currentStatus ? ' status-' + currentStatus : ''}" id="sectionStatus${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}">
                            ${statusHtml}
                        </div>
                        <div class="zadost-section-actions">
                            <button class="zadost-section-btn btn-ok${btnOkActive}" onclick="setSectionStatus('${sectionId}', 'ok')">
                                <span class="material-icons-outlined">check</span>
                                V pořádku
                            </button>
                            <button class="zadost-section-btn btn-vada${btnVadaActive}" onclick="setSectionStatus('${sectionId}', 'vada')">
                                <span class="material-icons-outlined">error_outline</span>
                                Vada
                            </button>
                        </div>
                    </div>
                `;
            }
            
            // Helper pro status badge v hlavičce
            function getStatusBadge(sectionId) {
                const currentStatus = zadostSectionState[sectionId];
                if (currentStatus === 'ok') {
                    return '<span class="section-status-badge ok" id="statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1) + '">✓</span>';
                } else if (currentStatus === 'vada') {
                    return '<span class="section-status-badge vada" id="statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1) + '">!</span>';
                }
                return '<span class="section-status-badge" id="statusBadge' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1) + '"></span>';
            }
            
            // Aktualizovat sekci Údaje o podání (podatel vs. žadatel)
            const podaniPodatel = document.getElementById('podaniPodatel');
            const podaniVztah = document.getElementById('podaniVztah');
            const podaniVerifyActions = document.getElementById('podaniVerifyActions');
            
            if (podaniPodatel && podaniVztah && podaniVerifyActions) {
                // Určit jméno podavatele
                let podatelJmeno = '';
                if (scenario.zastupce && scenario.zastupceData) {
                    // Podatel je zástupce
                    const zast = scenario.zastupceData;
                    podatelJmeno = zast.nazev || (zast.jmeno + ' ' + zast.prijmeni);
                } else if (scenario.typZadatele === 'po' && scenario.zadatel) {
                    // Podatel je jednatel PO
                    podatelJmeno = scenario.zadatel.jednatel || scenario.zadatel.nazev;
                } else if (scenario.zadatel) {
                    // Podatel je sám žadatel
                    podatelJmeno = scenario.zadatel.jmeno + ' ' + scenario.zadatel.prijmeni;
                } else if (scenario.zadatele && scenario.zadatele[0]) {
                    // Více žadatelů - první je podatel
                    podatelJmeno = scenario.zadatele[0].jmeno + ' ' + scenario.zadatele[0].prijmeni;
                }
                
                podaniPodatel.textContent = podatelJmeno;
                
                // Určit vztah k žadateli a akční tlačítka
                const isReza = scenario.zastupce === 'reza';
                const isPM = scenario.zastupce === 'pm';
                const isPovereni = scenario.zastupce === 'povereni';
                const isStatutar = scenario.zastupce === 'statutar';
                
                if (!scenario.zastupce || scenario.zastupce === null) {
                    // Podatel je sám žadatel
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #34a853;">check_circle</span>
                            Podatel je sám žadatel
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'none';
                } else if (isReza) {
                    // Zástupce s elektronickou plnou mocí (REZA)
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #1a73e8;">supervisor_account</span>
                            Zástupce na základě plné moci
                            <span style="padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 4px; font-size: 10px; font-weight: 600;">REZA</span>
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'flex';
                    podaniVerifyActions.innerHTML = `
                        <button class="zastupce-verify-btn reza" onclick="openRezaModal(scenarios[currentScenario].zastupceData || {})">
                            <span class="material-icons-outlined">verified_user</span>
                            Zobrazit plnou moc v REZA
                        </button>
                    `;
                } else if (isPM) {
                    // Zástupce s listinnou plnou mocí
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #e65100;">supervisor_account</span>
                            Zástupce na základě plné moci
                            <span style="padding: 2px 8px; background: #fff3e0; color: #e65100; border-radius: 4px; font-size: 10px; font-weight: 600;">LISTINNÁ</span>
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'flex';
                    podaniVerifyActions.innerHTML = `
                        <button class="zastupce-verify-btn prilohy" onclick="openPrilohyPMModal()">
                            <span class="material-icons-outlined">search</span>
                            Najít plnou moc v přílohách
                        </button>
                    `;
                } else if (isPovereni) {
                    // Pověřená osoba
                    const isPovereniReza = scenario.povereniTyp === 'reza';
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #7b1fa2;">badge</span>
                            Pověřená osoba
                            <span style="padding: 2px 8px; background: ${isPovereniReza ? '#e8f5e9' : '#fff3e0'}; color: ${isPovereniReza ? '#2e7d32' : '#e65100'}; border-radius: 4px; font-size: 10px; font-weight: 600;">${isPovereniReza ? 'REZA' : 'LISTINNÉ'}</span>
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'flex';
                    if (isPovereniReza) {
                        podaniVerifyActions.innerHTML = `
                            <button class="zastupce-verify-btn reza" onclick="openRezaModal({typZastoupeni: 'povereni', ...scenarios[currentScenario].zastupceData})">
                                <span class="material-icons-outlined">verified_user</span>
                                Zobrazit pověření v REZA
                            </button>
                        `;
                    } else {
                        podaniVerifyActions.innerHTML = `
                            <button class="zastupce-verify-btn prilohy" onclick="openPrilohyPMModal()">
                                <span class="material-icons-outlined">search</span>
                                Najít pověření v přílohách
                            </button>
                        `;
                    }
                } else if (isStatutar) {
                    // Statutární zástupce
                    podaniVztah.innerHTML = `
                        <span style="display: inline-flex; align-items: center; gap: 6px;">
                            <span class="material-icons-outlined" style="font-size: 18px; color: #2e7d32;">verified</span>
                            Statutární zástupce právnické osoby
                            <span style="padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 4px; font-size: 10px; font-weight: 600;">REZA</span>
                        </span>
                    `;
                    podaniVerifyActions.style.display = 'flex';
                    podaniVerifyActions.innerHTML = `
                        <button class="zastupce-verify-btn reza" onclick="openRezaModal({typZastoupeni: 'statutar', jmeno: '${scenario.zadatel?.jednatel || ""}', zmocnitel: '${scenario.zadatel?.nazev || ""}', zmocnitelId: '${scenario.zadatel?.ico || ""}'})">
                            <span class="material-icons-outlined">verified_user</span>
                            Ověřeno v REZA
                        </button>
                    `;
                }
            }
            
            // Aktualizovat sekci žadatele
            if (scenario.typZadatele === 'fo') {
                const z = scenario.zadatel;
                sectionZadatel.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">person</span>
                        Žadatel — Fyzická osoba
                        ${getStatusBadge('zadatel')}
                    </div>
                    <div class="zadost-data-grid">
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Jméno</div>
                            <div class="zadost-data-value">${z.jmeno}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Příjmení</div>
                            <div class="zadost-data-value">${z.prijmeni}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datum narození</div>
                            <div class="zadost-data-value">${z.datumNarozeni}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Místo trvalého pobytu</div>
                            <div class="zadost-data-value">${z.trvaleBytem}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">E-mail</div>
                            <div class="zadost-data-value">${z.email}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Telefon</div>
                            <div class="zadost-data-value">${z.telefon}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datová schránka</div>
                            <div class="zadost-data-value">${z.ds || '<span style="color:#9aa0a6;">Nemá zřízenu</span>'}</div>
                        </div>
                    </div>
                    ${getSectionControls('zadatel')}
                `;
            } else if (scenario.typZadatele === 'fo-podnikatel') {
                const z = scenario.zadatel;
                sectionZadatel.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">badge</span>
                        Žadatel — Fyzická osoba podnikající
                        ${getStatusBadge('zadatel')}
                    </div>
                    <div class="zadost-data-grid">
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Jméno</div>
                            <div class="zadost-data-value">${z.jmeno}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Příjmení</div>
                            <div class="zadost-data-value">${z.prijmeni}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datum narození</div>
                            <div class="zadost-data-value">${z.datumNarozeni}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Místo trvalého pobytu</div>
                            <div class="zadost-data-value">${z.trvaleBytem}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">IČO</div>
                            <div class="zadost-data-value"><strong>${z.ico}</strong></div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Místo podnikání</div>
                            <div class="zadost-data-value">${z.misto}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">E-mail</div>
                            <div class="zadost-data-value">${z.email}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datová schránka</div>
                            <div class="zadost-data-value">${z.ds}</div>
                        </div>
                    </div>
                    ${getSectionControls('zadatel')}
                `;
            } else if (scenario.typZadatele === 'po') {
                const z = scenario.zadatel;
                sectionZadatel.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">business</span>
                        Žadatel — Právnická osoba
                        ${getStatusBadge('zadatel')}
                    </div>
                    <div class="zadost-data-grid">
                        <div class="zadost-data-item full-width">
                            <div class="zadost-data-label">Název / Obchodní firma</div>
                            <div class="zadost-data-value"><strong>${z.nazev}</strong></div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">IČO</div>
                            <div class="zadost-data-value"><strong>${z.ico}</strong></div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Sídlo</div>
                            <div class="zadost-data-value">${z.sidlo}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datová schránka</div>
                            <div class="zadost-data-value">${z.ds}</div>
                        </div>
                        ${z.jednatel ? `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Jednatel</div>
                            <div class="zadost-data-value">${z.jednatel}</div>
                        </div>
                        ` : ''}
                    </div>
                    ${getSectionControls('zadatel')}
                `;
            } else if (scenario.typZadatele === 'fo-vice') {
                let html = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">group</span>
                        Žadatelé — Spoluvlastníci (${scenario.zadatele.length})
                        ${getStatusBadge('zadatel')}
                    </div>
                `;
                scenario.zadatele.forEach((z, index) => {
                    html += `
                        <div style="padding: 8px 16px; background: #f8f9fa; font-weight: 600; font-size: 12px; color: #5f6368; border-bottom: 1px solid #e0e0e0;">
                            Žadatel ${index + 1}
                        </div>
                        <div class="zadost-data-grid">
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Jméno</div>
                                <div class="zadost-data-value">${z.jmeno}</div>
                            </div>
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Příjmení</div>
                                <div class="zadost-data-value">${z.prijmeni}</div>
                            </div>
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Datum narození</div>
                                <div class="zadost-data-value">${z.datumNarozeni}</div>
                            </div>
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Trvalé bydliště</div>
                                <div class="zadost-data-value">${z.trvaleBytem}</div>
                            </div>
                            <div class="zadost-data-item">
                                <div class="zadost-data-label">Datová schránka</div>
                                <div class="zadost-data-value">${z.ds || '<span style="color:#9aa0a6;">Nemá zřízenu</span>'}</div>
                            </div>
                        </div>
                    `;
                });
                html += getSectionControls('zadatel');
                sectionZadatel.innerHTML = html;
            }
            
            // Aktualizovat CSS třídu sekce podle stavu
            sectionZadatel.classList.remove('status-ok', 'status-vada');
            if (zadostSectionState.zadatel === 'ok') {
                sectionZadatel.classList.add('status-ok');
            } else if (zadostSectionState.zadatel === 'vada') {
                sectionZadatel.classList.add('status-vada');
            }
            
            // Aktualizovat sekci zástupce
            // Určit, zda je sekce Zástupce relevantní (potřebuje ruční kontrolu)
            const isRezaZastupce = scenario.zastupce === 'reza';
            const isPmZastupce = scenario.zastupce === 'pm';
            const isStatutarZastupce = scenario.zastupce === 'statutar';
            
            // Zástupce je relevantní jen u listinné PM (potřeba najít v přílohách)
            zastupceRelevant = isPmZastupce;
            
            if (scenario.zastupce && scenario.zastupceData) {
                const zast = scenario.zastupceData;
                const isReza = scenario.zastupce === 'reza';
                const isPO = zast.ico && zast.nazev;
                
                // Určit typ zastoupení pro tlačítka
                const typZastoupeni = zast.typZastoupeni || 'plna-moc'; // plna-moc, povereni
                
                let zastupceHtml = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">supervisor_account</span>
                        Zástupce na základě ${isReza ? 'REZA' : 'plné moci'}
                        ${isReza ? '<span style="margin-left: 8px; padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 4px; font-size: 10px; font-weight: 600;">REZA</span>' : '<span style="margin-left: 8px; padding: 2px 8px; background: #fff3e0; color: #e65100; border-radius: 4px; font-size: 10px; font-weight: 600;">LISTINNÁ</span>'}
                        ${getStatusBadge('zastupce')}
                    </div>
                    <div class="zadost-data-grid">
                `;
                
                if (isPO) {
                    zastupceHtml += `
                        <div class="zadost-data-item full-width">
                            <div class="zadost-data-label">Název / Obchodní firma</div>
                            <div class="zadost-data-value"><strong>${zast.nazev}</strong></div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">IČO</div>
                            <div class="zadost-data-value">${zast.ico}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Sídlo</div>
                            <div class="zadost-data-value">${zast.sidlo}</div>
                        </div>
                    `;
                } else {
                    zastupceHtml += `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Jméno a příjmení</div>
                            <div class="zadost-data-value">${zast.jmeno} ${zast.prijmeni}</div>
                        </div>
                        ${zast.datumNarozeni ? `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datum narození</div>
                            <div class="zadost-data-value">${zast.datumNarozeni}</div>
                        </div>
                        ` : ''}
                        ${zast.ico ? `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">IČO</div>
                            <div class="zadost-data-value">${zast.ico}</div>
                        </div>
                        ` : ''}
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Adresa</div>
                            <div class="zadost-data-value">${zast.adresa}</div>
                        </div>
                    `;
                }
                
                zastupceHtml += `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Datová schránka</div>
                            <div class="zadost-data-value">${zast.ds}</div>
                        </div>
                        <div class="zadost-data-item full-width" style="background: ${isReza ? '#e8f5e9' : '#fff3e0'};">
                            <div class="zadost-data-label">Typ zmocnění</div>
                            <div class="zadost-data-value">${zast.typPM}</div>
                        </div>
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Platnost</div>
                            <div class="zadost-data-value">${zast.platnostPM}</div>
                        </div>
                        ${zast.rozsah ? `
                        <div class="zadost-data-item">
                            <div class="zadost-data-label">Rozsah zmocnění</div>
                            <div class="zadost-data-value">${zast.rozsah}</div>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                // Přidat ověřovací tlačítka a kontroly podle typu
                if (isReza) {
                    // REZA - automaticky ověřeno, jen info tlačítko
                    zastupceHtml += `
                    <div class="zastupce-verify-actions">
                        <button class="zastupce-verify-btn reza" onclick="openRezaModal(${JSON.stringify(zast).replace(/"/g, '&quot;')})">
                            <span class="material-icons-outlined">verified_user</span>
                            Zobrazit v REZA
                        </button>
                    </div>
                    <div class="zadost-section-controls">
                        <div class="zadost-section-status status-ok" id="sectionStatusZastupce">
                            <span class="material-icons-outlined">check_circle</span> Ověřeno v REZA
                        </div>
                    </div>
                    `;
                    // Automaticky nastavit na OK
                    setTimeout(() => setSectionAutoOk('zastupce', 'Ověřeno v REZA'), 100);
                } else {
                    // Listinná PM - potřeba ruční kontroly
                    zastupceHtml += `
                    <div class="zastupce-verify-actions">
                        <button class="zastupce-verify-btn prilohy" onclick="openPrilohyPMModal()">
                            <span class="material-icons-outlined">search</span>
                            Najít plnou moc v přílohách
                        </button>
                    </div>
                    `;
                    zastupceHtml += getSectionControls('zastupce');
                }
                
                sectionZastupce.innerHTML = zastupceHtml;
            } else if (scenario.zastupce === 'statutar') {
                sectionZastupce.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">supervisor_account</span>
                        Zástupce — Statutární orgán
                        <span style="margin-left: 8px; padding: 2px 8px; background: #e8f5e9; color: #2e7d32; border-radius: 4px; font-size: 10px; font-weight: 600;">REZA</span>
                        ${getStatusBadge('zastupce')}
                    </div>
                    <div class="zadost-data-empty" style="background: #e8f5e9; color: #2e7d32;">
                        <span class="material-icons-outlined">verified</span>
                        Za právnickou osobu jedná jednatel jako statutární orgán
                    </div>
                    <div class="zastupce-verify-actions">
                        <button class="zastupce-verify-btn reza" onclick="openRezaModal({typZastoupeni: 'statutar', jmeno: '${scenario.zadatel?.jednatel || "Ing. Pavel Horák"}', zmocnitel: '${scenario.zadatel?.nazev || ""}', zmocnitelId: '${scenario.zadatel?.ico || ""}'})">
                            <span class="material-icons-outlined">verified_user</span>
                            Ověřeno v REZA
                        </button>
                    </div>
                    <div class="zadost-section-controls">
                        <div class="zadost-section-status status-ok" id="sectionStatusZastupce">
                            <span class="material-icons-outlined">check_circle</span> Ověřeno v REZA
                        </div>
                    </div>
                `;
                // Automaticky nastavit na OK
                setTimeout(() => setSectionAutoOk('zastupce', 'Ověřeno v REZA'), 100);
            } else {
                // Žádný zástupce - automaticky OK
                sectionZastupce.innerHTML = `
                    <div class="zadost-data-section-header">
                        <span class="material-icons-outlined">supervisor_account</span>
                        Zástupce
                        ${getStatusBadge('zastupce')}
                    </div>
                    <div class="zadost-data-empty">
                        <span class="material-icons-outlined">person_off</span>
                        Žadatel jedná sám za sebe, zástupce není uveden
                    </div>
                    <div class="zadost-section-controls">
                        <div class="zadost-section-status status-ok" id="sectionStatusZastupce">
                            <span class="material-icons-outlined">check_circle</span> Není potřeba kontrolovat
                        </div>
                    </div>
                `;
                // Automaticky nastavit na OK
                setTimeout(() => setSectionAutoOk('zastupce', 'Není potřeba kontrolovat'), 100);
            }
            
            // Aktualizovat CSS třídu sekce zástupce podle stavu
            sectionZastupce.classList.remove('status-ok', 'status-vada');
            if (zadostSectionState.zastupce === 'ok') {
                sectionZastupce.classList.add('status-ok');
            } else if (zadostSectionState.zastupce === 'vada') {
                sectionZastupce.classList.add('status-vada');
            }
            
            // Aktualizovat sekci Přílohy podle scénáře
            const prilohyList = document.getElementById('prilohyList');
            const prilohyVerifyActions = document.getElementById('prilohyVerifyActions');
            
            if (prilohyList) {
                let prilohyHtml = '';
                
                // Plná moc
                if (scenario.zastupce === 'pm') {
                    prilohyHtml += `
                        <div class="priloha-inline-item pending">
                            <span class="material-icons-outlined">description</span>
                            Plná moc — <strong>ke kontrole</strong>
                        </div>
                    `;
                    prilohyVerifyActions.style.display = 'flex';
                } else if (scenario.zastupce === 'reza' || scenario.zastupce === 'statutar') {
                    prilohyHtml += `
                        <div class="priloha-inline-item na">
                            <span class="material-icons-outlined">remove_circle_outline</span>
                            Plná moc — ověřeno v REZA
                        </div>
                    `;
                } else {
                    prilohyHtml += `
                        <div class="priloha-inline-item na">
                            <span class="material-icons-outlined">remove_circle_outline</span>
                            Plná moc — neaplikuje se (žadatel jedná sám)
                        </div>
                    `;
                }
                
                // Souhlas vlastníka pozemku
                if (!scenario.vlastnik) {
                    prilohyHtml += `
                        <div class="priloha-inline-item pending">
                            <span class="material-icons-outlined">description</span>
                            Souhlas vlastníka pozemku — <strong>ke kontrole</strong>
                        </div>
                    `;
                    prilohyVerifyActions.style.display = 'flex';
                } else {
                    prilohyHtml += `
                        <div class="priloha-inline-item na">
                            <span class="material-icons-outlined">remove_circle_outline</span>
                            Souhlas vlastníka pozemku — neaplikuje se (žadatel je vlastník)
                        </div>
                    `;
                }
                
                // Pokud nejsou žádné přílohy ke kontrole, skrýt tlačítko
                if (!scenario.zastupce || scenario.zastupce !== 'pm') {
                    if (scenario.vlastnik) {
                        prilohyVerifyActions.style.display = 'none';
                    }
                }
                
                prilohyList.innerHTML = prilohyHtml;
            }
            
            // Aktualizovat sekci výjimek
            const sectionVyjimky = document.getElementById('dataSectionVyjimky');
            if (sectionVyjimky) {
                if (scenario.vyjimka) {
                    // Zobrazit sekci výjimek
                    sectionVyjimky.style.display = 'block';
                    sectionVyjimky.innerHTML = `
                        <div class="zadost-data-section-header">
                            <span class="material-icons-outlined">rule</span>
                            Výjimky z obecných požadavků
                            <span style="margin-left: 8px; padding: 2px 8px; background: #fff3e0; color: #ef6c00; border-radius: 4px; font-size: 10px; font-weight: 600;">ŽÁDÁNO</span>
                            ${getStatusBadge('vyjimky')}
                        </div>
                        <div class="zadost-data-grid">
                            <div class="zadost-data-item full-width">
                                <div class="zadost-data-label">Typ výjimky</div>
                                <div class="zadost-data-value"><strong>${scenario.vyjimka.typ}</strong></div>
                            </div>
                            <div class="zadost-data-item full-width">
                                <div class="zadost-data-label">Popis</div>
                                <div class="zadost-data-value">${scenario.vyjimka.popis}</div>
                            </div>
                            <div class="zadost-data-item full-width">
                                <div class="zadost-data-label">Odůvodnění žadatele</div>
                                <div class="zadost-data-value" style="background: #fffde7; padding: 8px; border-radius: 4px; font-style: italic;">${scenario.vyjimka.oduvodneni}</div>
                            </div>
                        </div>
                        ${getSectionControls('vyjimky')}
                    `;
                    // Reset stavu výjimek
                    resetSectionControls('vyjimky');
                } else {
                    // Skrýt sekci výjimek a nastavit automaticky OK
                    sectionVyjimky.style.display = 'none';
                    zadostSectionState.vyjimky = 'ok';
                }
            }
            
            // Aktualizovat deficiency panel
            setTimeout(() => updateDeficiencyPanel(), 150);
        }
        
        // Aktualizovat checklist podle scénáře
        function updateKontrolaZadostiChecklist(scenario) {
            const checklist = document.querySelector('.zadost-checklist');
            if (!checklist) return;
            
            // Reset všech položek
            checklist.querySelectorAll('.checklist-item').forEach(item => {
                item.classList.remove('disabled', 'checked-ok', 'checked-error');
                const actions = item.querySelector('.checklist-actions');
                if (actions) {
                    actions.innerHTML = `
                        <button class="checklist-btn ok" onclick="toggleChecklistItem(this, 'ok')" title="V pořádku">
                            <span class="material-icons-outlined">check</span>
                        </button>
                        <button class="checklist-btn error" onclick="toggleChecklistItem(this, 'error')" title="Vadné">
                            <span class="material-icons-outlined">close</span>
                        </button>
                    `;
                }
            });
            
            // Nastavit disabled položky podle scénáře
            const setDisabled = (text) => {
                checklist.querySelectorAll('.checklist-item').forEach(item => {
                    if (item.querySelector('.checklist-text').textContent.includes(text)) {
                        item.classList.add('disabled');
                        item.querySelector('.checklist-actions').innerHTML = `
                            <button class="checklist-btn na" disabled title="Neaplikuje se">
                                <span class="material-icons-outlined">remove</span>
                            </button>
                        `;
                    }
                });
            };
            
            const setEnabled = (text) => {
                checklist.querySelectorAll('.checklist-item').forEach(item => {
                    if (item.querySelector('.checklist-text').textContent.includes(text)) {
                        item.classList.remove('disabled');
                        item.querySelector('.checklist-actions').innerHTML = `
                            <button class="checklist-btn ok" onclick="toggleChecklistItem(this, 'ok')" title="V pořádku">
                                <span class="material-icons-outlined">check</span>
                            </button>
                            <button class="checklist-btn error" onclick="toggleChecklistItem(this, 'error')" title="Vadné">
                                <span class="material-icons-outlined">close</span>
                            </button>
                        `;
                    }
                });
            };
            
            // Typ žadatele
            if (scenario.typZadatele === 'fo') {
                setDisabled('Fyzická osoba podnikající');
                setDisabled('Právnická osoba uvedla');
            } else if (scenario.typZadatele === 'fo-podnikatel') {
                setDisabled('Právnická osoba uvedla');
                setEnabled('Fyzická osoba podnikající');
            } else if (scenario.typZadatele === 'po') {
                setDisabled('Fyzická osoba uvedla jméno');
                setDisabled('Fyzická osoba podnikající');
                setEnabled('Právnická osoba uvedla');
            } else if (scenario.typZadatele === 'fo-vice') {
                setDisabled('Fyzická osoba podnikající');
                setDisabled('Právnická osoba uvedla');
            }
            
            // Plná moc
            if (scenario.zastupce === 'pm' || scenario.zastupce === 'reza') {
                setEnabled('Plná moc');
            } else {
                setDisabled('Plná moc');
            }
            
            // Vlastnictví
            if (!scenario.vlastnik) {
                setEnabled('Souhlas vlastníka');
                setEnabled('Čestné prohlášení');
            } else {
                setDisabled('Souhlas vlastníka');
                setDisabled('Čestné prohlášení');
            }
            
            // Výjimky
            if (scenario.vyjimka) {
                setEnabled('Popis a odůvodnění výjimky');
            } else {
                setDisabled('Popis a odůvodnění výjimky');
            }
        }
        
        // Kopírovat URL scénáře
        function copyScenarioUrl() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                showSimToast('URL zkopírována do schránky');
            });
        }
        
        // Reset na základní scénář
        function resetScenario() {
            document.querySelector('input[name="scenar"][value="zakladni"]').checked = true;
            applyScenario('zakladni');
        }
        
        // Toast pro simulační panel
        function showSimToast(message) {
            const existing = document.querySelector('.sim-toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = 'sim-toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 2000);
        }
        
        // Inicializace při načtení stránky
        document.addEventListener('DOMContentLoaded', function() {
            initSimulationPanel();
        });
    

        // ═══════════════════════════════════════════
        // BLOCK EDITOR FUNCTIONS
        // ═══════════════════════════════════════════

        function edBuildDeficiencies() {
            // Set today's date
            document.getElementById('vyzvaDate').textContent = new Date().toLocaleDateString('cs-CZ');
            
            const container = document.getElementById('edDefList');
            container.innerHTML = '';
            // Clear user defs from previous opens
            document.getElementById('edUserDefs').innerHTML = '';
            
            // ─── Collect real deficiencies from all control sources ───
            const defItems = [];
            
            // 1) Kontrola žádosti — section-level deficiencies with notes
            if (controls.zadost.done && controls.zadost.result === 'vady') {
                for (const [key, value] of Object.entries(zadostSectionState)) {
                    if (value === 'vada') {
                        const sName = sectionNames[key] || key;
                        const note = zadostDeficiencyNotes[key] || '';
                        defItems.push({
                            source: 'Kontrola žádosti',
                            controlKey: 'zadost',
                            text: note ? (sName + ': ' + note) : ('Sekce „' + sName + '" — označena jako vadná, doplňte/opravte údaje.'),
                            subs: []
                        });
                    }
                }
            }
            
            // 2) Kontrola dokumentace (PD) — real issues from docCheckState
            if (controls.dokumentace.done && controls.dokumentace.result === 'vady' && controls.dokumentace.issues) {
                const issues = controls.dokumentace.issues;
                if (issues.length > 0) {
                    const autoIssues = issues.filter(i => i.source === 'auto');
                    const manualIssues = issues.filter(i => i.source === 'manual');
                    
                    if (autoIssues.length > 0) {
                        defItems.push({
                            source: 'Kontrola PD — automatická',
                            controlKey: 'dokumentace',
                            text: 'Automaticky zjištěné nedostatky v projektové dokumentaci:',
                            subs: autoIssues.map(i => i.shortText || i.text)
                        });
                    }
                    if (manualIssues.length > 0) {
                        defItems.push({
                            source: 'Kontrola PD — manuální',
                            controlKey: 'dokumentace',
                            text: 'Nedostatky v projektové dokumentaci zjištěné kontrolou:',
                            subs: manualIssues.map(i => i.shortText || i.text)
                        });
                    }
                } else {
                    defItems.push({
                        source: 'Kontrola dokumentace',
                        controlKey: 'dokumentace',
                        text: 'Projektová dokumentace vykazuje vady — uvést do souladu s požadavky stavebního zákona.',
                        subs: []
                    });
                }
            }
            
            // 3) Kontrola dokladové části — missing DO and VTI/VDI
            if (controls.identifikace.done && (controls.identifikace.result === 'vady' || controls.identifikace.result === 'vyzidat_do')) {
                const chybiDO = controls.identifikace.chybiDO || [];
                const chybiVTI = controls.identifikace.chybiVTI_VDI || [];
                
                if (chybiDO.length > 0) {
                    defItems.push({
                        source: 'Kontrola dokladové části — DO',
                        controlKey: 'identifikace',
                        text: 'Předložit chybějící závazná stanoviska dotčených orgánů dle § 184 odst. 2 písm. e) stavebního zákona:',
                        subs: chybiDO.map(n => n)
                    });
                }
                if (chybiVTI.length > 0) {
                    defItems.push({
                        source: 'Kontrola dokladové části — VTI/VDI',
                        controlKey: 'identifikace',
                        text: 'Předložit chybějící vyjádření vlastníků technické/dopravní infrastruktury:',
                        subs: chybiVTI.map(n => n)
                    });
                }
            }
            
            // 4) Kontrola souladu s ÚPD
            if (controls.up.done && controls.up.result === 'warning') {
                // Get text from globalIssues
                const updIssues = globalIssues.vyzva.filter(i => i.source === 'upd-control');
                if (updIssues.length > 0) {
                    defItems.push({
                        source: 'Kontrola souladu s ÚPD',
                        controlKey: 'up',
                        text: updIssues[0].text,
                        subs: []
                    });
                } else {
                    defItems.push({
                        source: 'Kontrola souladu s ÚPD',
                        controlKey: 'up',
                        text: 'Záměr není v souladu s územně plánovací dokumentací — doložte soulad nebo podejte žádost o výjimku.',
                        subs: []
                    });
                }
            }
            
            // 5) Any remaining globalIssues.vyzva not yet covered
            const coveredSources = new Set(['upd-control']);
            globalIssues.vyzva.forEach(gi => {
                if (!gi.resolved && !coveredSources.has(gi.source)) {
                    // Check if this issue is already covered by above
                    const alreadyCovered = defItems.some(d => d.text.includes(gi.text.substring(0, 30)));
                    if (!alreadyCovered) {
                        defItems.push({
                            source: gi.controlName || 'Kontroly řízení',
                            controlKey: 'global',
                            text: gi.text,
                            subs: []
                        });
                    }
                }
            });
            
            // Fallback if nothing found
            if (defItems.length === 0) {
                defItems.push({
                    source: 'Kontroly řízení',
                    controlKey: 'generic',
                    text: 'Odstranit nedostatky zjištěné při kontrole žádosti.',
                    subs: []
                });
            }
            
            // ─── Render ───
            defItems.forEach((item, idx) => {
                let subsHtml = '';
                if (item.subs.length > 0) {
                    subsHtml = '<div class="def-sub-ed">' + item.subs.map(s => 
                        '<div class="def-sub-item-ed">' +
                        '<div class="def-cb checked" onclick="edToggleCb(this)"><span class="material-icons-outlined">check</span></div>' +
                        '<span>' + s + '</span></div>'
                    ).join('') + '</div>';
                }
                
                container.innerHTML += 
                    '<div class="deficiency-item-ed from-control">' +
                    '<div class="def-cb checked" onclick="edToggleCb(this)"><span class="material-icons-outlined">check</span></div>' +
                    '<div class="def-body-ed">' +
                    '<div class="def-source-ed control">' + item.source + '</div>' +
                    '<div class="def-text-ed">' + item.text + '</div>' +
                    subsHtml +
                    '</div></div>';
            });
            
            edUpdateCounts();
        }

        function edToggleCb(el) {
            el.classList.toggle('checked');
            el.innerHTML = el.classList.contains('checked') ? '<span class="material-icons-outlined">check</span>' : '';
            edUpdateCounts();
        }

        function edSelectLhuta(el, type) {
            document.querySelectorAll('#controlVyzva .lhuta-opt').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            const usn = document.getElementById('edUsneseniLhuta');
            if (type === 'rel') {
                const v = el.querySelector('input[type=number]').value;
                usn.textContent = v + ' dnů od doručení';
            } else {
                const d = el.querySelector('input[type=date]').value;
                usn.textContent = new Date(d).toLocaleDateString('cs-CZ');
            }
        }

        // ═══════════════════════════════════════════
        // RICH TEXT MODAL for user deficiency items
        // ═══════════════════════════════════════════
        let edCurrentEditTarget = null;

        function edAddUserDef() {
            edCurrentEditTarget = null;
            document.getElementById('rteContent').innerHTML = '';
            document.getElementById('rteModal').classList.add('open');
            setTimeout(() => document.getElementById('rteContent').focus(), 100);
        }

        function edEditUserDef(el) {
            edCurrentEditTarget = el;
            const existing = el.querySelector('.def-rich-text');
            document.getElementById('rteContent').innerHTML = existing ? existing.innerHTML : '';
            document.getElementById('rteModal').classList.add('open');
            setTimeout(() => document.getElementById('rteContent').focus(), 100);
        }

        function rteExec(cmd, val) {
            document.execCommand(cmd, false, val || null);
            document.getElementById('rteContent').focus();
        }

        function rteClose() {
            document.getElementById('rteModal').classList.remove('open');
            edCurrentEditTarget = null;
        }

        function rteSave() {
            const html = document.getElementById('rteContent').innerHTML.trim();
            if (!html || html === '<br>') { rteClose(); return; }

            if (edCurrentEditTarget) {
                // Edit existing
                edCurrentEditTarget.querySelector('.def-rich-text').innerHTML = html;
            } else {
                // Create new item
                const container = document.getElementById('edUserDefs');
                const div = document.createElement('div');
                div.className = 'deficiency-item-ed user-added';
                div.style.cursor = 'pointer';
                div.onclick = function(e) {
                    if (e.target.closest('.def-cb') || e.target.closest('.def-remove-btn')) return;
                    edEditUserDef(div);
                };
                div.innerHTML = 
                    '<div class="def-cb checked" onclick="edToggleCb(this)"><span class="material-icons-outlined">check</span></div>' +
                    '<div class="def-body-ed" style="flex:1">' +
                    '<div style="display:flex;justify-content:space-between;align-items:center">' +
                    '<div class="def-source-ed manual">Vlastní bod</div>' +
                    '<button class="def-remove-btn" onclick="edRemoveUserDef(this)" title="Odebrat" style="border:none;background:none;color:#c5221f;cursor:pointer;padding:2px;border-radius:4px"><span class="material-icons-outlined" style="font-size:14px">close</span></button>' +
                    '</div>' +
                    '<div class="def-rich-text" style="font-size:11px;line-height:1.5;color:#202124;margin-top:3px">' + html + '</div>' +
                    '</div>';
                container.appendChild(div);
            }
            
            edUpdateCounts();
            rteClose();
        }

        function edRemoveUserDef(btn) {
            const item = btn.closest('.deficiency-item-ed');
            if (item) { item.remove(); edUpdateCounts(); }
        }

        // ESC to close RTE modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('rteModal').classList.contains('open')) {
                rteClose();
                e.stopPropagation();
            }
        });
        // Click backdrop to close
        document.getElementById('rteModal')?.addEventListener('click', function(e) {
            if (e.target === this) rteClose();
        });

        function edUpdateCounts() {
            const controlChecked = document.querySelectorAll('#edDefList .deficiency-item-ed > .def-cb.checked').length;
            const userItems = document.querySelectorAll('#edUserDefs .deficiency-item-ed').length;
            document.getElementById('edPropsControl').textContent = controlChecked;
            document.getElementById('edPropsUser').textContent = userItems;
            document.getElementById('edPropsTotal').textContent = (controlChecked + userItems) + ' bodů';
        }

        function edScrollTo(id, sideItem) {
            document.querySelectorAll('.editor-sidebar .sidebar-item').forEach(i => i.classList.remove('active'));
            if (sideItem) sideItem.classList.add('active');
            const bl = document.getElementById(id);
            if (bl) {
                bl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                bl.style.boxShadow = '0 0 0 3px #004289';
                setTimeout(() => bl.style.boxShadow = '', 1200);
            }
        }

        // ═══════════════════════════════════════════
        // PDF GENERATION
        // ═══════════════════════════════════════════
        function edFinalize() {
            showToast('Generuji PDF…');
            // Small delay so toast renders before heavy PDF work
            setTimeout(function() { edGeneratePDF(); }, 100);
        }

        function edGeneratePDF() {
          try {
            const { jsPDF } = window.jspdf;
            if (!jsPDF) { showToast('Chyba: jsPDF knihovna nenalezena'); return; }
            const doc = new jsPDF({ unit: 'mm', format: 'a4' });
            const W = 210, H = 297, ML = 25, MR = 20, MT = 25;
            const PW = W - ML - MR;
            let y = MT;

            // Helper: wrapped text, returns new y
            function addWrapped(text, x, yy, opts) {
                const fontSize = opts.fontSize || 10;
                const lineHeight = opts.lineHeight || 1.4;
                const maxW = opts.maxWidth || PW;
                const align = opts.align || 'left';
                const style = opts.style || 'normal';
                doc.setFontSize(fontSize);
                doc.setFont('helvetica', style);
                const lines = doc.splitTextToSize(text, maxW);
                const lh = fontSize * lineHeight * 0.352778; // pt to mm
                lines.forEach(line => {
                    if (yy > H - 20) { doc.addPage(); yy = MT; }
                    if (align === 'center') {
                        doc.text(line, W / 2, yy, { align: 'center' });
                    } else if (align === 'right') {
                        doc.text(line, W - MR, yy, { align: 'right' });
                    } else {
                        doc.text(line, x, yy);
                    }
                    yy += lh;
                });
                return yy;
            }

            // ─── Header ───
            doc.setDrawColor(0, 66, 137);
            doc.setLineWidth(0.5);
            y = addWrapped('DOPRAVNÍ A ENERGETICKÝ STAVEBNÍ ÚŘAD', ML, y, { fontSize: 13, style: 'bold', align: 'center' });
            y = addWrapped('Odbor staveb drah · Oddělení Plzeň', ML, y, { fontSize: 9, align: 'center' });
            y += 2;
            doc.line(ML, y, W - MR, y);
            y += 6;

            // File numbers
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text('Spis. zn.: SZ DESU/004539/26', ML, y);
            doc.text('Vyřizuje: Ing. Kálal', W - MR, y, { align: 'right' });
            y += 4;
            doc.text('Č.j.: DESU/121/004594/26', ML, y);
            doc.text('Datum: ' + new Date().toLocaleDateString('cs-CZ'), W - MR, y, { align: 'right' });
            y += 10;

            // ─── Title I ───
            y = addWrapped('I. VÝZVA', ML, y, { fontSize: 13, style: 'bold', align: 'center' });
            y = addWrapped('K ODSTRANĚNÍ NEDOSTATKŮ ŽÁDOSTI', ML, y, { fontSize: 11, style: 'bold', align: 'center' });
            y += 6;

            // Identification
            y = addWrapped('Industrial Center CR 2 s.r.o., IČO: 12345678, zastoupena na základě plné moci společností RotaGroup a.s., podal žádost o povolení záměru:', ML, y, { fontSize: 10 });
            y += 2;
            y = addWrapped('„Novostavba RD včetně přípojek"', ML, y, { fontSize: 10, style: 'bolditalic', align: 'center' });
            y += 2;
            y = addWrapped('na pozemcích parc. č. 123/4, 123/5, 124/1 v k.ú. Plzeň-město', ML, y, { fontSize: 10 });
            y += 4;

            // Legal text
            y = addWrapped('Dopravní a energetický stavební úřad jako stavební úřad příslušný podle § 33 odst. 2 zákona č. 283/2021 Sb., stavební zákon, přezkoumal podanou žádost a zjistil, že neobsahuje všechny požadované náležitosti a přílohy, a proto', ML, y, { fontSize: 10 });
            y += 4;
            y = addWrapped('V Y Z Ý V Á', ML, y, { fontSize: 12, style: 'bold', align: 'center' });
            y += 3;

            // Lhůta
            const lhutaText = document.getElementById('edUsneseniLhuta').textContent;
            y = addWrapped('stavebníka, aby nejpozději do ' + lhutaText + ' odstranil následující nedostatky žádosti:', ML, y, { fontSize: 10 });
            y += 4;

            // ─── Deficiency items ───
            let defNum = 1;
            // From controls
            document.querySelectorAll('#edDefList .deficiency-item-ed').forEach(item => {
                const cb = item.querySelector(':scope > .def-cb');
                if (!cb || !cb.classList.contains('checked')) return;
                const text = item.querySelector('.def-text-ed')?.textContent || '';
                const source = item.querySelector('.def-source-ed')?.textContent || '';
                
                if (y > H - 30) { doc.addPage(); y = MT; }
                y = addWrapped(defNum + '. ' + text, ML + 4, y, { fontSize: 10, maxWidth: PW - 8 });
                
                // Sub-items
                item.querySelectorAll('.def-sub-item-ed').forEach(sub => {
                    const subCb = sub.querySelector('.def-cb');
                    if (!subCb || !subCb.classList.contains('checked')) return;
                    const subText = sub.querySelector('span')?.textContent || '';
                    if (subText) {
                        y = addWrapped('– ' + subText, ML + 10, y, { fontSize: 9, maxWidth: PW - 16 });
                    }
                });
                y += 2;
                defNum++;
            });

            // User items
            document.querySelectorAll('#edUserDefs .deficiency-item-ed').forEach(item => {
                const cb = item.querySelector(':scope > .def-cb');
                if (!cb || !cb.classList.contains('checked')) return;
                const richEl = item.querySelector('.def-rich-text');
                const text = richEl ? richEl.innerText : '';
                if (!text.trim()) return;
                
                if (y > H - 30) { doc.addPage(); y = MT; }
                y = addWrapped(defNum + '. ' + text.trim(), ML + 4, y, { fontSize: 10, maxWidth: PW - 8 });
                y += 2;
                defNum++;
            });

            y += 4;

            // Warning
            y = addWrapped('Pokud nebudou nedostatky ve stanovené lhůtě odstraněny, stavební úřad řízení usnesením zastaví podle § 66 odst. 1 písm. c) správního řádu.', ML, y, { fontSize: 10, style: 'italic' });
            y += 10;

            // ═══ II. USNESENÍ ═══
            doc.setDrawColor(0, 66, 137);
            doc.setLineWidth(0.3);
            doc.line(ML, y, W - MR, y);
            y += 6;
            y = addWrapped('II. USNESENÍ O PŘERUŠENÍ ŘÍZENÍ', ML, y, { fontSize: 12, style: 'bold', align: 'center' });
            y += 4;

            y = addWrapped('Dopravní a energetický stavební úřad podle § 185 odst. 2 stavebního zákona', ML, y, { fontSize: 10 });
            y += 3;
            y = addWrapped('P Ř E R U Š U J E', ML, y, { fontSize: 12, style: 'bold', align: 'center' });
            y += 3;
            y = addWrapped('řízení o povolení záměru „Novostavba RD včetně přípojek" na pozemcích parc. č. 123/4, 123/5, 124/1 v k.ú. Plzeň-město, a to nejdéle na dobu ' + lhutaText + ' této výzvy.', ML, y, { fontSize: 10 });
            y += 6;

            // Poučení
            y = addWrapped('Poučení:', ML, y, { fontSize: 10, style: 'bold' });
            y = addWrapped('Proti tomuto usnesení se podle § 185 odst. 2 stavebního zákona nelze odvolat.', ML, y, { fontSize: 10 });
            y += 12;

            // Signature
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            doc.text('Ing. Jitka Kotásková', W - MR, y, { align: 'right' });
            y += 4;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.text('ředitelka odboru staveb drah', W - MR, y, { align: 'right' });
            y += 10;

            // Delivery
            doc.setLineWidth(0.2);
            doc.line(ML, y, W - MR, y);
            y += 4;
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.text('Obdrží:', ML, y);
            y += 4;
            doc.setFont('helvetica', 'normal');
            doc.text('RotaGroup a.s., IDDS: 78hx792 (v zastoupení Industrial Center CR 2 s.r.o.)', ML, y);

            // Save & download
            const filename = 'Vyzva_k_doplneni_DESU-004539-26.pdf';
            try {
                // Create blob and download via anchor element
                const blob = doc.output('blob');
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 2000);
            } catch(e1) {
                console.warn('Blob download failed, trying doc.save', e1);
                try { doc.save(filename); } catch(e2) {
                    console.warn('doc.save failed, opening in new window', e2);
                    window.open(doc.output('bloburl'), '_blank');
                }
            }
            showToast('PDF "' + filename + '" vygenerováno');
            edFinalizeUI();
          } catch(err) {
            console.error('PDF generation error:', err);
            showToast('Chyba při generování PDF: ' + err.message);
          }
        }

        function edFinalizeUI() {
            showToast('Výzva k doplnění + Usnesení o přerušení — PDF vygenerováno a odesláno');
            setTimeout(() => {
                closeControl('controlVyzva');
                document.getElementById('summaryTitle').textContent = 'Řízení přerušeno';
                document.getElementById('summaryDesc').textContent = 'Výzva k doplnění odeslána. Čeká se na reakci stavebníka.';
                document.getElementById('btnZahajit').disabled = true;
                document.getElementById('btnZahajit').innerHTML = '<span class="material-icons-outlined">pause_circle</span>Řízení přerušeno';
            }, 1500);
        }

    </script>
</body>
</html>
